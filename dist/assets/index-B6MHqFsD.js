import{ab as V,t as l,k as r,L as n,K as _,a7 as N,N as T,M as q,S as G}from"./index-D7jH1FVY.js";import{T as x}from"./TanStackGrid-Dj2Kv21o.js";import{S as J}from"./SkuAliasCell-DLkDfSgV.js";import{c as D}from"./months-BTPgK-LH.js";import{u as Z,C as h}from"./workspace-BOh-scKZ.js";import{b as $,a as A,t as H}from"./accountantReport-GcMHz4wq.js";import{s as Q}from"./index-U8lnWn0J.js";import{C as X}from"./index-ygadgiJ9.js";import"./Dropdown-YtRXoqxq.js";import"./orderEditorFactory-D8Fdr7b4.js";import"./store-B7Jj2JIL.js";import"./prefill-BMr140Jw.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-DxIIzQ0o.js";import"./useBubbleLock-DNuYBdSj.js";const{Paragraph:Y,Text:E,Title:ee}=_;function m(i){return Number.isFinite(i)?Number(i).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"}function d(i){return Number.isFinite(i)?Math.round(Number(i)).toLocaleString("de-DE"):"-"}function p(i){if(!i)return"-";const[o,s,u]=String(i).split("-").map(Number);if(!o||!s||!u)return"-";const c=new Date(o,s-1,u);return Number.isNaN(c.getTime())?"-":c.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function S(i){const o=String(i||"").trim().replace(/\./g,"").replace(",","."),s=Number(o);return Number.isFinite(s)?s:null}async function re(i){var u;const o=String(i||"");if(!o)return;if((u=navigator.clipboard)!=null&&u.writeText){await navigator.clipboard.writeText(o);return}const s=document.createElement("textarea");s.value=o,s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s)}function be(){const{state:i,loading:o,error:s}=Z(),u=V(),[c,C]=l.useState(()=>D()),[g,K]=l.useState(!1),[y,U]=l.useState(""),[v,W]=Q.useMessage(),[k,M]=l.useState(!1),[L,w]=l.useState(""),j=i,f=u.workspaceId||"Workspace",t=l.useMemo(()=>$(j,{month:c,scope:g?"core_plus_journal":"core"},{inventoryValueOverrideEur:S(y)}),[g,y,c,j,f]),O=l.useMemo(()=>[{header:"Alias",accessorKey:"alias",meta:{width:260,minWidth:240},cell:({row:e})=>r.jsx(J,{alias:e.original.alias,sku:e.original.sku})},{header:"Kategorie",accessorKey:"category"},{header:"Amazon",cell:({row:e})=>d(e.original.amazonUnits)},{header:"3PL",cell:({row:e})=>d(e.original.threePLUnits)},{header:"In Transit",cell:({row:e})=>d(e.original.inTransitUnits)},{header:"Warenwert EUR",cell:({row:e})=>m(e.original.rowValueEur)}],[]),z=l.useMemo(()=>[{header:"PO",accessorKey:"poNumber"},{header:"Supplier",accessorKey:"supplier"},{header:"SKU Alias",accessorKey:"skuAliases"},{header:"Paid Date",cell:({row:e})=>p(e.original.paidDate)},{header:"Ist EUR",cell:({row:e})=>m(e.original.actualEur)},{header:"USD",cell:({row:e})=>m(e.original.amountUsd)},{header:"Issues",cell:({row:e})=>{var a;return((a=e.original.issues)==null?void 0:a.join(" | "))||"-"}}],[]),I=l.useMemo(()=>[{header:"PO",accessorKey:"poNumber"},{header:"Supplier",accessorKey:"supplier"},{header:"SKU Alias",accessorKey:"skuAliases"},{header:"Arrival",cell:({row:e})=>p(e.original.arrivalDate)},{header:"Units",cell:({row:e})=>d(e.original.units||0)},{header:"Goods EUR",cell:({row:e})=>m(e.original.goodsEur)},{header:"Issues",cell:({row:e})=>{var a;return((a=e.original.issues)==null?void 0:a.join(" | "))||"-"}}],[]),P=l.useMemo(()=>[{header:"Monat relevant",cell:({row:e})=>e.original.monthMarker?r.jsx(n,{color:"green",children:e.original.monthMarkerReason||"ja"}):r.jsx(n,{color:"default",children:"nein"})},{header:"PO",accessorKey:"poNumber"},{header:"Supplier",accessorKey:"supplier"},{header:"SKU Alias",accessorKey:"skuAliases"},{header:"Units",cell:({row:e})=>d(e.original.units||0)},{header:"Deposit EUR (Monat)",cell:({row:e})=>m(e.original.depositActualEurMonth)},{header:"Deposit USD (Monat)",cell:({row:e})=>m(e.original.depositAmountUsdMonth)},{header:"ETD",cell:({row:e})=>p(e.original.etdDate)},{header:"ETA",cell:({row:e})=>p(e.original.etaDate)},{header:"Ankunft",cell:({row:e})=>p(e.original.arrivalDate||e.original.etaDate)},{header:"Source",accessorKey:"arrivalSource"},{header:"Issues",cell:({row:e})=>{var a;return((a=e.original.issues)==null?void 0:a.join(" | "))||"-"}}],[]),R=l.useMemo(()=>[{header:"Severity",accessorKey:"severity"},{header:"Code",accessorKey:"code"},{header:"Message",accessorKey:"message"},{header:"Entity",cell:({row:e})=>e.original.entityType||"-"},{header:"ID",cell:({row:e})=>e.original.entityId||"-"}],[]);async function F(){var e;if(!k){M(!0);try{const a=await A(j,{month:c,scope:g?"core_plus_journal":"core"},{workspaceName:f,inventoryValueOverrideEur:S(y)});w(((e=a==null?void 0:a.emailDraft)==null?void 0:e.text)||""),await H(a.zipBlob,a.zipFileName),v.success(`Paket erstellt: ${a.zipFileName}`)}catch(a){console.error(a),v.error(a instanceof Error?a.message:"Export fehlgeschlagen")}finally{M(!1)}}}async function B(){var e;try{let a=L;if(!a){const b=await A(j,{month:c,scope:g?"core_plus_journal":"core"},{workspaceName:f,inventoryValueOverrideEur:S(y)});a=((e=b==null?void 0:b.emailDraft)==null?void 0:e.text)||"",w(a)}await re(a),v.success("E-Mail Text kopiert.")}catch(a){console.error(a),v.error(a instanceof Error?a.message:"Kopieren fehlgeschlagen")}}return r.jsxs("div",{className:"v2-page",children:[W,r.jsxs(h,{className:"v2-intro-card",children:[r.jsx("div",{className:"v2-page-head",children:r.jsxs("div",{children:[r.jsx(ee,{level:3,children:"Buchhalter Export"}),r.jsx(Y,{children:"One-Click Monats-Paket mit Preview: Warenbestand, Lieferanzahlungen, Wareneingaenge und E-Mail Text."})]})}),r.jsxs("div",{className:"v2-toolbar",children:[r.jsxs("div",{className:"v2-toolbar-row",children:[r.jsxs("div",{className:"v2-toolbar-field",children:[r.jsx(E,{children:"Monat"}),r.jsx(N,{type:"month",value:c,onChange:e=>C(e.target.value||D()),style:{width:180,maxWidth:"100%"}})]}),r.jsxs("div",{className:"v2-toolbar-field",children:[r.jsx(E,{children:"Scope"}),r.jsx(X,{checked:g,onChange:e=>K(e.target.checked),children:"Zahlungsjournal zusaetzlich"})]}),r.jsxs("div",{className:"v2-toolbar-field",children:[r.jsx(E,{children:"Warenwert Override EUR (optional)"}),r.jsx(N,{placeholder:"z.B. 150000",value:y,onChange:e=>U(e.target.value),style:{width:220,maxWidth:"100%"}})]})]}),r.jsxs("div",{className:"v2-toolbar-row v2-toolbar-actions",children:[r.jsxs("div",{className:"v2-actions-inline",children:[r.jsx(T,{type:"primary",onClick:()=>{F()},loading:k,children:"Paket erstellen"}),r.jsx(T,{onClick:()=>{B()},children:"E-Mail Text kopieren"})]}),r.jsxs(n,{color:"blue",children:["Anzahlungen: ",t.deposits.length]}),r.jsxs(n,{color:"blue",children:["Wareneingaenge: ",t.arrivals.length]}),r.jsxs(n,{color:"blue",children:["Kombi-Zeilen: ",(t.poLedger||[]).length]}),r.jsxs(n,{color:"default",children:["Monat markiert: ",(t.poLedger||[]).filter(e=>e.monthMarker).length]}),r.jsxs(n,{color:t.quality.length?"red":"green",children:["Issues: ",t.quality.length]})]})]})]}),s?r.jsx(q,{type:"error",showIcon:!0,message:"Workspace Fehler",description:s}):null,r.jsx(h,{title:"Monatszusammenfassung",children:r.jsxs(G,{wrap:!0,children:[r.jsxs(n,{color:"default",children:["Snapshot: ",p(t.inventory.snapshotAsOf)]}),r.jsxs(n,{color:"green",children:["Warenwert: ",t.inventory.totalValueEur!=null?`${m(t.inventory.totalValueEur)} EUR`:"-"]}),r.jsxs(n,{color:"default",children:["Amazon: ",d(t.inventory.totalAmazonUnits)]}),r.jsxs(n,{color:"default",children:["3PL: ",d(t.inventory.total3plUnits)]}),r.jsxs(n,{color:"default",children:["Transit: ",d(t.inventory.totalInTransitUnits)]}),r.jsxs(n,{color:t.inventory.manualOverrideUsed?"orange":"default",children:["Override: ",t.inventory.manualOverrideUsed?"ja":"nein"]})]})}),r.jsx(h,{title:"Warenbestand Preview",loading:o,children:r.jsx(x,{data:t.inventoryRows||[],columns:O,minTableWidth:980,tableLayout:"auto"})}),r.jsx(h,{title:"Lieferanzahlungen Preview",loading:o,children:r.jsx(x,{data:t.deposits||[],columns:z,minTableWidth:1180,tableLayout:"auto"})}),r.jsx(h,{title:"Anzahlungen + Wareneingang (PO)",loading:o,children:r.jsx(x,{data:t.poLedger||[],columns:P,minTableWidth:1600,tableLayout:"auto"})}),r.jsx(h,{title:"Wareneingang Preview",loading:o,children:r.jsx(x,{data:t.arrivals||[],columns:I,minTableWidth:1100,tableLayout:"auto"})}),r.jsx(h,{title:"Quality Issues",loading:o,children:r.jsx(x,{data:t.quality||[],columns:R,minTableWidth:960,tableLayout:"auto"})})]})}export{be as default};
