import{d}from"./deepEqual-CGWqzo0t.js";import{f as o,r as y,w}from"./store-DGjnfDd_.js";function A(f){if(typeof structuredClone=="function")try{return structuredClone(f)}catch{}if(f!==void 0)return JSON.parse(JSON.stringify(f))}function s(f){return A(f??{})}function i(f,c){Object.keys(f).forEach(e=>{delete f[e]}),c&&typeof c=="object"&&Object.entries(c).forEach(([e,a])=>{f[e]=a})}function _(f,c={}){const r={key:c.key||"draft",enableDraftCache:c.enableDraftCache!==!1,draftCacheNamespace:c.draftCacheNamespace||"drafts/v1"},e=s(f);let a=s(f);const m=typeof window<"u"&&window.__DEBUG_FORMS__===!0;function u(t){if(!m)return;const n=[];d(e,a)||n.push("draft/saved are not deep-equal after save."),e===a&&n.push("draft and saved share the same reference."),Array.isArray(e==null?void 0:e.payments)&&e.payments===(a==null?void 0:a.payments)&&n.push("payments array reference is shared."),Array.isArray(e==null?void 0:e.items)&&e.items===(a==null?void 0:a.items)&&n.push("items array reference is shared."),n.length&&console.warn(`[useDraftForm] Shared references detected after ${t}`,{warnings:n,draft:e,saved:a})}function l(){r.enableDraftCache&&w(r.key,e,r.draftCacheNamespace)}function h(t){if(typeof t=="function"){const n=t(s(e));n&&typeof n=="object"&&i(e,s(n))}else if(t&&typeof t=="object"){const n=t===e?t:{...e,...t};i(e,s(n))}l()}function C(){i(e,s(a)),o(r.key,r.draftCacheNamespace)}function p(){if(!r.enableDraftCache)return{exists:!1,draft:null};const t=y(r.key,r.draftCacheNamespace);return t!=null&&t.data?{exists:!0,draft:s(t.data),updatedAt:t.updatedAt}:{exists:!1,draft:null}}function D(){if(!r.enableDraftCache)return;const t=y(r.key,r.draftCacheNamespace);t!=null&&t.data&&i(e,s(t.data))}function k(){o(r.key,r.draftCacheNamespace),i(e,s(a))}function b(){a=s(e),u("markClean")}async function N(t){if(typeof t!="function")return;const n=t(e);n&&typeof n.then=="function"&&await n,a=s(e),u("commit"),o(r.key,r.draftCacheNamespace)}return{get draft(){return e},get saved(){return a},get isDirty(){return!d(e,a)},setDraft:h,resetDraft:C,loadDraftIfAvailable:p,restoreDraft:D,discardDraft:k,markClean:b,commit:N}}export{A as s,_ as u};
