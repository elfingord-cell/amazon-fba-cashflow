import{t as m,I as hn,_ as fn,J as pn,K as bn,L as ht,M as gn,N as yn,O as Yt,P as ft,Q as pt,p as vn,R as xn,S as Le,U as mt,k as n,V as A,W as Mn,X as E,T as pe,Y as we,Z as kn,$ as rt,a0 as re,a1 as Sn}from"./index-Dsq1NbgA.js";import{v as _,a as X,E as Nn}from"./chartPalette-B57jtk3U.js";import{b as jn,c as Cn}from"./cashflow-BIZjDysg.js";import{c as Fe,m as en,f as Y,a as Ut}from"./months-D57QP-bs.js";import{b as wn,a as zn,n as Fn,c as In}from"./tableModels-D8alIB6N.js";import{r as An,b as En,a as Pn,c as Dn}from"./phantomFo-C9Q6wVDR.js";import{e as Rn}from"./forecastVersioning-D_WXxsjA.js";import{u as Tn,C as Oe}from"./workspace-DYbhLcOY.js";import{S as Vt}from"./index-D7DbeJV5.js";import{R as ze}from"./InfoCircleOutlined-DeB8MOFj.js";import{S as it}from"./index-BR9pWJTQ.js";import{S as Bn}from"./index-Bihs0Hvp.js";import{F as On}from"./Table-iT3qSGmN.js";import"./planProducts-8EK0Neth.js";import"./productCompletenessV2-Bl9JV_fd.js";import"./orderUtils-Cu9aWhso.js";import"./foSuggestion-DyBAXRuI.js";import"./abcClassification-DMTDJ3gR.js";import"./inventoryProjection-BWCMGWlk.js";import"./Dropdown-BjfOTMXt.js";import"./DownOutlined-QrMw0MBW.js";import"./index-3pXHqFLf.js";import"./useBubbleLock-l6JBo3uo.js";import"./index-DGYOOpUo.js";import"./Pagination-C71sWMmV.js";var Ln={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},_n=function(o,i){return m.createElement(hn,fn({},o,{ref:i,icon:Ln}))},Kn=m.forwardRef(_n);function $n(t){if(t==null||typeof t=="string"&&t.trim()==="")return null;const o=Number(t);return Number.isFinite(o)?o:null}function Un(t){const o=Array.isArray(t.rows)?t.rows:[];if(!o.length)return[];const i=Number(t.initialOpening);let c=Number.isFinite(i)?i:0;return o.map((r,h)=>{const u=c,g=Number(r==null?void 0:r.net),b=Number.isFinite(g)?g:0,w=$n(r==null?void 0:r.actualClosing),z=u+b,j=w??z;return c=j,{month:String((r==null?void 0:r.month)||""),opening:u,net:b,plannedClosing:z,closing:j,actualClosing:w,lockedActual:w!=null}})}function Vn(t){return/^\d{4}-\d{2}$/.test(String(t||"").trim())}function bt(t,o=Fe()){const i=String(t||"").trim();return Vn(i)?i:o}function _e(t){if(t==null||t==="")return null;if(typeof t=="number")return Number.isFinite(t)?t:null;const o=vn(t);return Number.isFinite(o)?Number(o):null}function Qt(t){const o=Yt(t);return Number.isFinite(o)?ht(Number(o),pt,ft):null}function Qn(t){const o=Yt(t);return!Number.isFinite(o)||Number(o)<=0?null:ht(Number(o),pt,ft)}function Wn(t){return String(t||"").trim().toLowerCase()==="recommendation"?"recommendation":"manual"}function qn(t){return String(t||"").trim().toLowerCase()==="forecast_direct"?"forecast_direct":"hybrid"}function Hn(t,o){return Array.isArray(t)?t.map((i,c)=>{const r=i&&typeof i=="object"?i:{};return{id:String(r.id||`inc-${c+1}`),month:bt(r.month,o),revenueEur:_e(r.revenueEur),payoutPct:_e(r.payoutPct),source:String(r.source||"manual")==="forecast"?"forecast":"manual"}}):[]}function Wt(t){return t.slice().sort((o,i)=>o.month===i.month?o.id.localeCompare(i.id):o.month.localeCompare(i.month))}function tn(t){return{id:`inc-${t}`,month:t,revenueEur:null,payoutPct:null,source:"forecast"}}function Zn(t,o,i){const c=en(o,Math.max(1,Math.round(i||1))),r=new Set(c),h=new Map;return Wt(t).forEach(u=>{r.has(u.month)&&h.set(u.month,u)}),Wt(c.map(u=>h.get(u)||tn(u)))}function Gn(t){return!t||typeof t!="object"?null:JSON.parse(JSON.stringify(t))}function Jn(t){const o=t.monthlyActuals&&typeof t.monthlyActuals=="object"?t.monthlyActuals:{},i={};return Object.entries(o).forEach(([c,r])=>{const h=bt(c),u=_e(r==null?void 0:r.realRevenueEUR),g=_e(r==null?void 0:r.realPayoutRatePct),b={};Number.isFinite(u)&&(b.realRevenueEUR=Number(u)),Number.isFinite(g)&&(b.realPayoutRatePct=Number(g)),Object.keys(b).length&&(i[h]=b)}),i}function Xn(t){const o=Array.isArray(t.months)?t.months.map(x=>String(x||"").trim()).filter(Boolean):[],i={};if(!o.length)return i;const c=t.state&&typeof t.state=="object"?t.state:{},r=c.settings&&typeof c.settings=="object"?c.settings:{},h=c.forecast&&typeof c.forecast=="object"?c.forecast:{},u=bt(r.startMonth,Fe()),g=Math.max(1,Math.round(Number(r.horizonMonths||18)||18)),b=en(u,g),w=new Set(b),z=Zn(Hn(c.incomings,u),u,g),j=new Map(z.map(x=>[x.month,x])),F=wn(c),le=zn(c,F),ce=h.forecastImport&&typeof h.forecastImport=="object"?h.forecastImport:{},Ie=Fn(h.forecastManual||{}),be=In({allMonths:b,products:le,manualDraft:Ie,forecastImport:ce}),D={};b.forEach(x=>{D[x]=Number(be.get(x)||0)});const ge=Jn(c),ee=!(r.cashInRecommendationSeasonalityEnabled==null?r.cashInRecommendationIgnoreQ4!==!0:r.cashInRecommendationSeasonalityEnabled!==!1),ye=Qt(r.cashInRecommendationBaselineNormalPct)??pn;Qt(r.cashInRecommendationBaselineQ4Pct);const ve=bn({months:b,incomings:z,monthlyActuals:ge,currentMonth:Fe(),seasonalityEnabled:!ee,ignoreQ4:ee,maxMonth:Fe(),baselineNormalPct:ye,learningState:Gn(r.cashInLearning),now:new Date,minSamples:4}),xe=new Map;z.forEach(x=>{var se;const T=Number((se=(ve.byMonth||{})[x.month])==null?void 0:se.quotePct);Number.isFinite(T)&&xe.set(x.month,ht(T,pt,ft))});const P=gn(r.cashInCalibrationMode),Q=yn({incomings:z,months:b,forecastRevenueByMonth:D,mode:P,currentMonth:Fe(),now:new Date,monthlyActuals:ge,learningState:r.revenueCalibration,sourceForecastVersionId:h.activeVersionId}),te=Wn(r.cashInQuoteMode),ue=qn(r.cashInRevenueBasisMode),Me=r.cashInCalibrationEnabled!==!1,ne=jn(b,c,null);return b.forEach(x=>{var Pe;const T=j.get(x)||tn(x),se=Number(be.get(x)||0),M=((Pe=Q.byMonth)==null?void 0:Pe[x])||null,et=Number((M==null?void 0:M.factorBasis)||1),Ke=Number((M==null?void 0:M.factorConservative)||1),K=P==="conservative"?Ke:et,ke=Me&&Number.isFinite(K)?K:1,oe=se*ke,tt=Me?oe:se,$e=Me?"forecast_calibrated":"forecast_raw",N=_e(T.revenueEur),Ae=T.source==="manual"&&Number.isFinite(N)&&Number(N)>0,me=ue==="hybrid"&&Ae?Number(N):tt,$=ue==="hybrid"&&Ae?"manual_override":$e,B=Qn(T.payoutPct),L=xe.get(x)??null,W=te==="manual"&&Number.isFinite(B)?"manual":"recommendation",Ee=W==="manual"?Number(B):Number.isFinite(L)?Number(L):null,O=ne[x]||{};let U=Number.isFinite(Number(O.revenueUsedEUR))?Number(O.revenueUsedEUR):null,Ue=O.revenueSource?String(O.revenueSource):null,V=Number.isFinite(Number(O.payoutPctUsed))?Number(O.payoutPctUsed):null,Ve=O.payoutSource?String(O.payoutSource):null;const Se=Number.isFinite(Number(O.payoutEUR))?Number(O.payoutEUR):null;(!Number.isFinite(U)||Ue!==$||Number.isFinite(me)&&Number(me)>0&&Number.isFinite(U)&&Number(U)<=0)&&(U=Number.isFinite(me)?Number(me):null,Ue=U!=null?$:null),(!Number.isFinite(V)||Number(V)<=0||Ve!==W)&&(V=Number.isFinite(Ee)?Number(Ee):null,Ve=V!=null?W:null);const ae=Number.isFinite(U)&&Number.isFinite(V)?Number(U)*(Number(V)/100):null;let Ne=Number.isFinite(ae)?Number(ae):Number.isFinite(Se)?Number(Se):0;Number.isFinite(ae)&&Number(ae)>0&&(!Number.isFinite(Se)||Number(Se)<=0)&&(Ne=Number(ae)),w.has(x)&&(i[x]=Number.isFinite(Ne)?Math.max(0,Ne):0)}),o.forEach(x=>{if(Object.prototype.hasOwnProperty.call(i,x))return;const T=Number((ne[x]||{}).payoutEUR);i[x]=Number.isFinite(T)?Math.max(0,T):0}),i}const{Paragraph:qt,Text:v,Title:lt}=Mn,ct=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],Yn=[{value:Le.CORE,label:"Kernportfolio"},{value:Le.PLAN,label:"Planprodukte"},{value:Le.IDEAS,label:"Ideenprodukte"}],Ht=[Le.CORE,Le.PLAN],Zt={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function es(t){return String(t||"").trim().toLowerCase()==="recommendation"?"recommendation":"manual"}function R(t){const o=Number(t);return Number.isFinite(o)?o.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function Gt(t){return Number.isFinite(t)?t<0?`−${R(Math.abs(t))}`:R(t):"-"}function ts(t,o=0){const i=Number(t);return Number.isFinite(i)?i.toLocaleString("de-DE",{minimumFractionDigits:o,maximumFractionDigits:o}):"-"}function Jt(t){const o=Number(t);return Number.isFinite(o)?`${o.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function ns(t){if(!t)return"-";const o=new Date(t);return Number.isNaN(o.getTime())?t:o.toLocaleDateString("de-DE")}function ss(t){return Zt[t]||Zt.insufficient}function os(t){return t==="ok"?"✅":t==="warn"?"⚠️":"❌"}function as(t,o){const i=structuredClone(t||{});(!i.settings||typeof i.settings!="object")&&(i.settings={});const c=i.settings;return c.cashInQuoteMode=o.quoteMode,c.cashInCalibrationEnabled=o.calibrationEnabled,c.cashInRevenueBasisMode=o.revenueBasisMode,i}function ie(t,o){const[i,c=""]=String(t||"").split("?"),r=new URLSearchParams(c);Object.entries(o).forEach(([u,g])=>{if(g==null||g===""){r.delete(u);return}r.set(u,g)});const h=r.toString();return h?`${i}?${h}`:i}function dt(t){return ie("/v2/inventory/projektion",{source:"dashboard",risk:t.risk||"under_safety",abc:t.abc||"ab",month:t.month||null,sku:t.sku||null,mode:t.mode||null,expand:"all"})}function rs(t){return ie("/v2/products",{source:"dashboard",issues:t.issues,sku:t.sku||null,expand:"all"})}function nn(t){return ie("/v2/forecast",{source:"dashboard",sku:t.sku||null,month:t.month||null})}function is(t){return ie("/v2/orders/fo",{source:t.source,sku:t.sku||null,month:t.month||null,suggestedUnits:Number.isFinite(Number(t.suggestedUnits))?String(Math.max(0,Math.round(Number(t.suggestedUnits)))):"0",requiredArrivalDate:t.requiredArrivalDate||null,recommendedOrderDate:t.recommendedOrderDate||null,phantomId:null,firstRiskMonth:t.firstRiskMonth||null,orderMonth:t.orderMonth||null,leadTimeDays:Number.isFinite(Number(t.leadTimeDays))?String(Math.max(0,Math.round(Number(t.leadTimeDays)))):null,returnTo:t.returnTo})}function Xt(t){const o=String(t.route||"");if(o.startsWith("/v2/forecast"))return nn({sku:t.sku||null,month:t.month||null});if(o.startsWith("/v2/inventory/projektion")){const i=t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"under_safety":"all",c=t.sku?"all":t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"ab":"all";return dt({risk:i,abc:c,month:t.month||null,sku:t.sku||null,mode:t.mode||null})}if(o.startsWith("/v2/products")){const i=t.actionId==="revenue_inputs"||t.checkKey==="revenue_inputs"?"revenue":"needs_fix";return rs({issues:i,sku:t.sku||null})}return o}function ls(t){const o=typeof t.portfolioBucket=="string"?t.portfolioBucket:null;if(o)return o;const i=t.meta&&typeof t.meta=="object"?t.meta:{};return typeof i.portfolioBucket=="string"?String(i.portfolioBucket):null}function Xe(t,o){const i=ls(t);return!i||!mt.includes(i)?!0:o.has(i)}function cs(t,o){var h;if(!t.length)return[];const i=t.map(u=>{const g=(Array.isArray(u.entries)?u.entries:[]).filter(j=>Xe(j,o)),b=g.filter(j=>String(j.direction||"").toLowerCase()==="in").reduce((j,F)=>j+Math.abs(Number(F.amount||0)),0),w=g.filter(j=>String(j.direction||"").toLowerCase()==="out").reduce((j,F)=>j+Math.abs(Number(F.amount||0)),0),z=b-w;return{...u,inflow:b,outflow:w,net:z,entries:g}}),c=Number(((h=t[0])==null?void 0:h.opening)||0),r=Un({rows:i.map(u=>({month:u.month,net:u.net,actualClosing:u.actualClosing})),initialOpening:c});return i.map((u,g)=>{const b=r[g];return{...u,opening:Number((b==null?void 0:b.opening)??u.opening??0),closing:Number((b==null?void 0:b.closing)??u.closing??0),hasActualClosing:(b==null?void 0:b.lockedActual)===!0}})}function us(t,o,i){const c={fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0};return t.forEach(r=>{if(!r||typeof r!="object")return;const h=r;if(i&&!Xe(h,i)||String(h.direction||"").toLowerCase()!=="out")return;const u=Math.abs(Number(h.amount||0));if(!Number.isFinite(u)||u<=0)return;c.total+=u;const g=String(h.source||"").toLowerCase();if(g==="po"){c.po+=u;return}if(g==="fo"){const w=String(h.sourceId||"").trim(),z=h.meta&&typeof h.meta=="object"?h.meta:{};h.provisional===!0||z.phantom===!0||(w?(o==null?void 0:o.has(w))===!0:!1)?c.phantomFo+=u:c.fo+=u;return}const b=String(h.group||"").toLowerCase();if(g==="fixcosts"||b==="fixkosten"){c.fixcost+=u;return}c.other+=u}),c}function ms(t,o,i){const c={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};t.forEach(h=>{if(!h||typeof h!="object")return;const u=h;if(o&&!Xe(u,o)||String(u.direction||"").toLowerCase()!=="in")return;const g=Math.abs(Number(u.amount||0));if(!Number.isFinite(g)||g<=0)return;const b=String(u.source||"").toLowerCase(),w=String(u.kind||"").toLowerCase();b==="sales"||b==="sales-plan"||w==="sales-payout"||(c.other+=g,c.total+=g)});const r=Number(i);return c.amazon=Number.isFinite(r)?Math.max(0,r):0,c.amazonCore=c.amazon,c.amazonPlanned=0,c.amazonNew=0,c.total=c.amazon+c.other,c}function ut(t){const o={};return t.forEach(i=>{o[i]=0}),o}function Je(t){return Object.values(t).reduce((o,i)=>o+Math.abs(Number(i||0)),0)}function ds(t){const o=Number(t.paid||0),i=Number(t.open||0),c=Number(t.unknown||0);return o>0&&i<=0&&c<=0?"paid":i>0&&o<=0&&c<=0?"open":c>0&&o<=0&&i<=0?"unknown":"mixed"}function hs(t){const o=[],i=c=>{c.forEach(r=>{!Array.isArray(r.children)||r.children.length===0||(o.push(r.key),i(r.children))})};return i(t),o}function fs(t){const o=new Map;(Array.isArray(t.products)?t.products:[]).forEach(h=>{const u=String(h.sku||"").trim();if(!u)return;const g=String(h.alias||"").trim()||u;o.set(u,g)});const c=new Map,r=(h,u)=>{const g=(h==="po"?[u.poNo,u.id]:[u.foNo,u.foNumber,u.id]).map(F=>String(F||"").trim()).filter(Boolean);if(!g.length)return;const b=Array.isArray(u.items)&&u.items.length?u.items:[{sku:u.sku,units:u.units}],w=new Set;let z=0;b.forEach(F=>{const le=String(F.sku||"").trim();if(!le)return;w.add(o.get(le)||le);const ce=Number(F.units??F.qty??F.quantity??0);Number.isFinite(ce)&&(z+=ce)});const j={aliases:Array.from(w),units:Number.isFinite(z)?z:null};Array.from(new Set(g)).forEach(F=>{c.set(`${h}:${F}`,j)})};return(Array.isArray(t.pos)?t.pos:[]).forEach(h=>r("po",h)),(Array.isArray(t.fos)?t.fos:[]).forEach(h=>r("fo",h)),c}function ps(t){if(!t||typeof t!="object")return{toVersionId:null,foConflictsOpen:0};const o=t;return{toVersionId:o.toVersionId==null?null:String(o.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(o.foConflictsOpen||0)))}}function Us(){var wt,zt,Ft,It,At,Et,Pt,Dt,Rt,Tt,Bt,Ot,Lt,_t;const{state:t,loading:o,error:i,saveWith:c}=Tn(),r=xn(),[h,u]=m.useState("next6"),[g,b]=m.useState(()=>Ht.slice()),[w,z]=m.useState(""),[j,F]=m.useState(""),[le,ce]=m.useState(!1),[Ie,be]=m.useState(["inflows","outflows"]),D=t,ge=t.settings&&typeof t.settings=="object"?t.settings:{},Ye=t.forecast&&typeof t.forecast=="object"?t.forecast:{},ee=ge.cashInCalibrationEnabled!==!1,ye=String(ge.cashInRevenueBasisMode||"").trim().toLowerCase()==="forecast_direct"?"forecast_direct":"hybrid",ve=es(ge.cashInQuoteMode),xe=m.useCallback(async e=>{await c(s=>{const d=structuredClone(s);(!d.settings||typeof d.settings!="object")&&(d.settings={});const a=d.settings;return d.settings={...a,...e,lastUpdatedAt:new Date().toISOString()},d},"v2:dashboard:cashin-cockpit")},[c]),P=m.useMemo(()=>An(D,18),[t.settings]),Q=m.useMemo(()=>w&&P.includes(w)?w:P[P.length-1]||"",[w,P]),te=m.useMemo(()=>En({state:D,months:P,targetMonth:Q||null}),[P,Q,D]),ue=m.useMemo(()=>new Set(te.map(e=>e.id)),[te]),Me=m.useMemo(()=>Pn({state:D,suggestions:te}),[te,D]),ne=m.useMemo(()=>as(Me,{quoteMode:ve,revenueBasisMode:ye,calibrationEnabled:ee}),[ee,Me,ve,ye]),x=m.useMemo(()=>Cn(ne),[ne]),T=x.months||[],se=x.breakdown||[],M=m.useMemo(()=>{const e=ct.find(s=>s.value===h);return!e||e.count==null?T:T.slice(0,e.count)},[T,h]),et=m.useMemo(()=>{const e=ct.find(s=>s.value===h);return(e==null?void 0:e.label)||"Alle Monate"},[h]),Ke=m.useMemo(()=>new Set(M),[M]),K=m.useMemo(()=>new Set(g),[g]),ke=m.useMemo(()=>{const e=se.filter(s=>Ke.has(s.month));return cs(e,K)},[se,K,Ke]),oe=m.useMemo(()=>Dn({state:D,months:M}),[D,M]);m.useEffect(()=>{if(!P.length){z("");return}z(e=>e&&P.includes(e)?e:P[P.length-1])},[P]),m.useEffect(()=>{var e;if(!oe.months.length){F("");return}if(!j||!oe.monthMap.has(j)){const s=((e=oe.months.find(d=>!d.robust))==null?void 0:e.month)||oe.months[0].month;F(s)}},[oe,j]);const tt=m.useCallback((e,s)=>{mt.includes(e)&&b(d=>{const a=Array.from(new Set((d||[]).filter(f=>mt.includes(f)))),l=a.includes(e);if(s&&!l)return[...a,e];if(!s&&l){const f=a.filter(y=>y!==e);return f.length?f:a}return a})},[]),$e=m.useCallback(e=>{e&&(F(e),ce(!0))},[]),N=m.useMemo(()=>ke.map(e=>({...e})),[ke]),Ae=m.useMemo(()=>Xn({months:M,state:D}),[D,M]),me=m.useMemo(()=>new Map(N.map(e=>[e.month,e.hasActualClosing===!0])),[N]),$=m.useMemo(()=>{const e=new Map;return N.forEach(s=>{e.set(s.month,ms(Array.isArray(s.entries)?s.entries:[],K,Ae[s.month]??null))}),e},[K,Ae,N]),B=m.useMemo(()=>N.map(e=>$.get(e.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[$,N]),L=m.useMemo(()=>{const e=new Map;return N.forEach(s=>{e.set(s.month,us(Array.isArray(s.entries)?s.entries:[],ue,K))}),e},[K,ue,N]),W=m.useMemo(()=>N.map(e=>L.get(e.month)||{fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0}),[L,N]),Ee=m.useMemo(()=>B.map(e=>e.amazonCore),[B]),O=m.useMemo(()=>B.map(e=>e.amazonPlanned),[B]),U=m.useMemo(()=>B.map(e=>e.amazonNew),[B]),Ue=m.useMemo(()=>B.map(e=>e.amazon),[B]),V=m.useMemo(()=>B.map(e=>e.other),[B]),Ve=Ue.reduce((e,s)=>e+Number(s||0),0)+V.reduce((e,s)=>e+Number(s||0),0),Se=N.reduce((e,s)=>e+Number(s.outflow||0),0),Qe=N.reduce((e,s)=>e+Number(s.net||0),0),gt=m.useMemo(()=>N.length?Math.min(...N.map(e=>Number(e.closing||0))):null,[N]),ae=((zt=(wt=x.kpis)==null?void 0:wt.cashIn)==null?void 0:zt.calibrationApplied)===!0,Ne=Math.max(0,Math.round(Number(((It=(Ft=x.kpis)==null?void 0:Ft.cashIn)==null?void 0:It.calibrationCandidateCount)||0))),Pe=Math.max(0,Math.round(Number(((Et=(At=x.kpis)==null?void 0:At.cashIn)==null?void 0:Et.calibrationNonDefaultFactorMonthCount)||0))),De=String(((Dt=(Pt=x.kpis)==null?void 0:Pt.cashIn)==null?void 0:Dt.calibrationLatestCandidateMonth)||"").trim()||null,We=Number((Tt=(Rt=x.kpis)==null?void 0:Rt.cashIn)==null?void 0:Tt.calibrationLatestRawFactor),je=(Ot=(Bt=x.kpis)==null?void 0:Bt.cashIn)!=null&&Ot.calibrationReasonCounts&&typeof x.kpis.cashIn.calibrationReasonCounts=="object"?x.kpis.cashIn.calibrationReasonCounts:{},yt=m.useMemo(()=>(Array.isArray(ne.incomings)?ne.incomings:[]).reduce((s,d)=>{const a=d&&typeof d=="object"?d:{},l=Number(a.calibrationSellerboardMonthEndEur)>0,f=Number(a.calibrationRevenueToDateEur)>0&&String(a.calibrationCutoffDate||"").trim().length>0;return l||f?s+1:s},0),[ne]),vt=m.useMemo(()=>{if(!ee||ae)return null;if(yt<=0)return"Keine verwertbaren Kalibrierdaten gefunden. Das Diagramm entspricht aktuell dem Forecast-Umsatz.";if(Ne<=0){const e=Math.max(0,Math.round(Number(je.missing_forecast_revenue||0))),s=Math.max(0,Math.round(Number(je.missing_inputs||0))),d=Math.max(0,Math.round(Number(je.invalid_cutoff_date||0))),a=Math.max(0,Math.round(Number(je.invalid_factor||0))),l=Math.max(0,Math.round(Number(je.invalid_expected_revenue||0))),f=[];return e>0&&f.push(`Forecast-Umsatz fehlt/ist 0 in ${e} Kalibrier-Monat(en)`),s>0&&f.push(`Kalibrierdaten unvollständig in ${s} Monat(en)`),d>0&&f.push(`Cutoff-Datum ungültig in ${d} Monat(en)`),(a>0||l>0)&&f.push(`Faktor rechnerisch ungültig in ${a+l} Monat(en)`),f.length?`Kalibrierdaten sind vorhanden, aber aktuell nicht wirksam: ${f.join(" · ")}.`:"Kalibrierdaten sind vorhanden, aber aktuell im Planungsfenster nicht verwertbar. Das Diagramm bleibt beim Forecast-Umsatz."}if(Pe<=0){if(Number.isFinite(We)){const e=Number(We).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2});if(Math.abs(We-1)<=1e-6){const d=De?` (Quelle ${Y(De)})`:"";return`Kalibrierung aktiv, aber ohne Effekt: Startfaktor ${e}${d}. Das entspricht faktisch 1,00.`}const s=De?` (${Y(De)})`:"";return`Kalibrierdaten gefunden (Startfaktor ${e}${s}), aber im aktuellen Planungsfenster wirkt der Fade-Out bereits auf ~1,00.`}return"Kalibrierdaten sind vorhanden, aktuell aber ohne Effekt (Faktor ~1,00 im Planungsfenster)."}return"Kalibrierung aktiv, aber der Effekt ist im aktuellen Ausschnitt minimal."},[ae,Ne,yt,De,We,Pe,je,ee]),xt=m.useMemo(()=>{const e=structuredClone(Ye||{});return Rn(e),e},[Ye]),nt=ps(xt.lastImpactSummary),Mt=String(xt.activeVersionId||"").trim()||null,kt=nt.toVersionId&&Mt&&nt.toVersionId===Mt?nt.foConflictsOpen:0,p=j&&oe.monthMap.get(j)||null,st=p?ss(p.coverage.statusKey):null,qe=m.useMemo(()=>{if(!p)return!1;const e=Ut(Fe()),s=Ut(p.month);return s==null||e==null?!1:s<e},[p]),St=p?p.checks.filter(e=>e.key!=="sku_coverage"):[],Nt=m.useMemo(()=>{if(!p||p.coverage.statusKey==="full")return[];const e=p.month;return[{id:`coverage-warning:${e}`,message:`Coverage ist ${p.coverage.statusLabel}: ${Jt(p.coverage.ratio*100)} (${p.coverage.coveredSkus}/${p.coverage.activeSkus}).`,route:dt({risk:"under_safety",abc:"ab",month:e,mode:p.coverage.projectionMode})}]},[p]),sn=m.useMemo(()=>{if(!p)return[];const e=[],s=p.coverage.stockIssueCount,d=p.coverage.orderDutyIssueCount;return e.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:s===0?"ok":"fail",description:s===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${s} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),e.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:d===0?"ok":p.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:d===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${d} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),St.forEach(a=>{e.push({key:a.key,label:a.label,state:a.passed?"ok":"fail",description:a.detail,route:a.route||null})}),qe&&e.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),e},[p,qe,St]),jt=m.useMemo(()=>{const e=new Map;return M.forEach(s=>{e.set(Y(s),s)}),e},[M]),Ct=m.useCallback(e=>{if(!e||typeof e!="object")return;const s=e;let d=null;const a=Number(s.dataIndex);if(Number.isInteger(a)&&a>=0&&a<M.length&&(d=M[a]),!d){const l=[s.name,s.axisValue,s.value].map(f=>typeof f=="string"?f.trim():"").filter(Boolean);for(let f=0;f<l.length;f+=1){const y=jt.get(l[f]);if(y){d=y;break}}}d&&$e(d)},[jt,$e,M]),on=m.useMemo(()=>({click:Ct}),[Ct]),an=m.useMemo(()=>{const e="Amazon Kern",s="Amazon Plan",d="Amazon Neu",a=new Set([e,s,d]),l=M.map(C=>Y(C)),f=ke.map(C=>Number(C.closing||0)),y=W.map(C=>-C.fixcost),k=W.map(C=>-C.po),I=W.map(C=>-C.fo),H=W.map(C=>-C.phantomFo),Z=[e,s,d,"Sonstige In","Fixkosten","PO","FO","Phantom FO","Netto","Kontostand"];return{tooltip:{trigger:"axis",formatter:C=>{const he=Array.isArray(C)?C:[C],G=he[0],Re=[`<div><strong>${(G==null?void 0:G.axisValueLabel)||""}</strong></div>`];let Te=0,Be=!1;return he.forEach(Ze=>{const S=Ze,Ce=Number(S==null?void 0:S.value);Number.isFinite(Ce)&&(a.has(String((S==null?void 0:S.seriesName)||""))&&(Te+=Ce,Be=!0),Re.push(`<div>${(S==null?void 0:S.marker)||""}${(S==null?void 0:S.seriesName)||""}: ${R(Ce)}</div>`))}),Be&&Re.push(`<div><strong>Amazon gesamt: ${R(Te)}</strong></div>`),Re.join("")}},legend:{type:"scroll",top:0,left:0,right:0,itemGap:10,itemWidth:14,itemHeight:8,textStyle:{fontSize:12,color:X.textStrong},pageTextStyle:{fontSize:11,color:X.textMuted},data:Z},grid:{left:54,right:68,top:54,bottom:42},xAxis:{type:"category",data:l,triggerEvent:!0,axisLabel:{hideOverlap:!0,fontSize:12,color:X.textMuted,margin:12},axisLine:{lineStyle:{color:X.axisLine}}},yAxis:[{type:"value",name:"Cashflow",nameTextStyle:{fontSize:12,color:X.textMuted},axisLabel:{formatter:C=>Gt(C),fontSize:12,color:X.textMuted},splitLine:{lineStyle:{color:X.gridLine}}},{type:"value",name:"Kontostand",position:"right",nameTextStyle:{fontSize:12,color:X.textMuted},axisLabel:{formatter:C=>R(C),fontSize:12,color:X.textMuted},splitLine:{show:!1}}],series:[{name:e,type:"bar",stack:"cash",data:Ee,itemStyle:{color:_.amazonCore}},{name:s,type:"bar",stack:"cash",data:O,itemStyle:{color:_.amazonPlanned}},{name:d,type:"bar",stack:"cash",data:U,itemStyle:{color:_.amazonNew}},{name:"Sonstige In",type:"bar",stack:"cash",data:V,itemStyle:{color:_.otherInflow}},{name:"Fixkosten",type:"bar",stack:"cash",data:y,itemStyle:{color:_.fixcost}},{name:"PO",type:"bar",stack:"cash",data:k,itemStyle:{color:_.po}},{name:"FO",type:"bar",stack:"cash",data:I,itemStyle:{color:_.fo}},{name:"Phantom FO",type:"bar",stack:"cash",data:H,itemStyle:{color:_.phantomFo}},{name:"Netto",type:"line",smooth:!0,showSymbol:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:7,data:N.map(C=>Number(C.net||0)),itemStyle:{color:_.net},lineStyle:{width:2,color:_.net}},{name:"Kontostand",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!0,showSymbol:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:7,data:f,lineStyle:{width:2,color:_.robustPositive},itemStyle:{color:_.robustPositive}}]}},[Ee,U,O,V,W,N,ke,M]),He=m.useMemo(()=>fs(D),[t.fos,t.pos,t.products,D]),de=m.useMemo(()=>{const e={"outflows-po":new Map,"outflows-fo":new Map,"outflows-phantom-fo":new Map};N.forEach(d=>{const a=d.month;(Array.isArray(d.entries)?d.entries:[]).forEach(f=>{if(!f||typeof f!="object")return;const y=f;if(!Xe(y,K)||String(y.direction||"").toLowerCase()!=="out")return;const k=Math.abs(Number(y.amount||0));if(!Number.isFinite(k)||k<=0)return;const I=String(y.source||"").toLowerCase();if(I!=="po"&&I!=="fo")return;const H=String(y.sourceNumber||"").trim(),Z=String(y.sourceId||"").trim(),C=String(y.id||y.label||"").trim(),he=H||Z||C||"ohne-nummer",G=y.meta&&typeof y.meta=="object"?y.meta:{},Re=I==="fo"&&(y.provisional===!0||G.phantom===!0||(Z?ue.has(Z):!1)),Te=I==="po"?"outflows-po":Re?"outflows-phantom-fo":"outflows-fo",Be=e[Te],Ze=`${I}:${he}`;let S=Be.get(Ze);if(!S){const J=He.get(`${I}:${he}`)||(H?He.get(`${I}:${H}`):void 0)||(Z?He.get(`${I}:${Z}`):void 0);S={key:`order:${Te}:${I}:${he}`,label:`${String(I).toUpperCase()} ${he}`,values:ut(M),aliases:new Set((J==null?void 0:J.aliases)||[]),units:(J==null?void 0:J.units)??null,paymentMix:{paid:0,open:0,unknown:0},payments:new Map},Be.set(Ze,S)}S.values[a]+=-k,y.paid===!0?S.paymentMix.paid+=k:y.paid===!1?S.paymentMix.open+=k:S.paymentMix.unknown+=k;const Ce=String(G.alias||"").trim();Ce&&S.aliases.add(Ce);const Ge=Number(G.units??G.qty??G.quantity);if(Number.isFinite(Ge)&&Ge>0){const J=Number(S.units||0);S.units=Number.isFinite(J)?J+Ge:Ge}const Kt=String(y.label||"").trim()||"Zahlung",$t=String(y.date||"").trim()||null,dn=y.paid===!0?"paid":y.paid===!1?"open":"unknown",at=`${Kt}|${$t||""}|${dn}`;let fe=S.payments.get(at);fe||(fe={key:`payment:${S.key}:${at}`,label:Kt,values:ut(M),paymentDueDate:$t,paymentMix:{paid:0,open:0,unknown:0}},S.payments.set(at,fe)),fe.values[a]+=-k,y.paid===!0?fe.paymentMix.paid+=k:y.paid===!1?fe.paymentMix.open+=k:fe.paymentMix.unknown+=k})});const s=(d,a)=>Array.from(d.values()).sort((l,f)=>Je(f.values)-Je(l.values)).map(l=>{const f=Array.from(l.payments.values()).sort((k,I)=>Je(I.values)-Je(k.values)).map(k=>({key:k.key,label:k.label,values:k.values,rowType:"payment",paymentStatus:ds(k.paymentMix),paymentDueDate:k.paymentDueDate})),y=Number(l.units);return{key:l.key,label:l.label,values:l.values,rowType:"order",orderType:a,aliases:Array.from(l.aliases),units:Number.isFinite(y)&&y>0?y:null,paymentMix:l.paymentMix,children:f.length?f:void 0}});return{po:s(e["outflows-po"],"po"),fo:s(e["outflows-fo"],"fo"),phantom:s(e["outflows-phantom-fo"],"phantom")}},[K,He,ue,N,M]),ot=m.useMemo(()=>{const e=new Map(N.map(a=>[a.month,a])),s=a=>{const l=ut(M);return M.forEach(f=>{l[f]=Number(a(f)||0)}),l};return[{key:"inflows",label:"Einnahmen",rowType:"group",values:s(a=>{var l;return((l=$.get(a))==null?void 0:l.total)||0}),children:[{key:"inflows-amazon-core",label:"Amazon Kernprodukte",rowType:"category",values:s(a=>{var l;return((l=$.get(a))==null?void 0:l.amazonCore)||0})},{key:"inflows-amazon-plan",label:"Amazon geplante Produkte",rowType:"category",values:s(a=>{var l;return((l=$.get(a))==null?void 0:l.amazonPlanned)||0})},{key:"inflows-amazon-new",label:"Amazon neue Produkte",rowType:"category",values:s(a=>{var l;return((l=$.get(a))==null?void 0:l.amazonNew)||0})},{key:"inflows-other",label:"Sonstige Einzahlungen",rowType:"category",values:s(a=>{var l;return((l=$.get(a))==null?void 0:l.other)||0})}]},{key:"outflows",label:"Ausgaben",rowType:"group",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.total)||0)}),children:[{key:"outflows-po",label:"PO",rowType:"category",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.po)||0)}),children:de.po.length?de.po:void 0},{key:"outflows-fo",label:"FO",rowType:"category",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.fo)||0)}),children:de.fo.length?de.fo:void 0},{key:"outflows-phantom-fo",label:"Phantom FO",rowType:"category",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.phantomFo)||0)}),children:de.phantom.length?de.phantom:void 0},{key:"outflows-fixcost",label:"Fixkosten",rowType:"category",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.fixcost)||0)})},{key:"outflows-other",label:"Sonstige Auszahlungen",rowType:"category",values:s(a=>{var l;return-(((l=L.get(a))==null?void 0:l.other)||0)})}]},{key:"net",label:"Netto Cashflow",rowType:"total",values:s(a=>{var l;return Number(((l=e.get(a))==null?void 0:l.net)||0)})},{key:"closing",label:"Kontostand",rowType:"total",values:s(a=>{var l;return Number(((l=e.get(a))==null?void 0:l.closing)||0)})}]},[$,de,L,N,M]),q=m.useMemo(()=>hs(ot),[ot]);m.useEffect(()=>{const e=new Set(q);be(s=>s.filter(d=>e.has(d)))},[q]);const rn=m.useMemo(()=>{if(!q.length)return!1;const e=new Set(Ie);return q.every(s=>e.has(s))},[q,Ie]),ln=m.useCallback(()=>{be(e=>{const s=new Set(e);return q.length>0&&q.every(a=>s.has(a))?[]:q.slice()})},[q]),cn=m.useMemo(()=>[{title:"Position",key:"label",dataIndex:"label",fixed:"left",width:380,render:(e,s)=>{if(s.rowType==="order"){const a=Array.isArray(s.aliases)?s.aliases.filter(Boolean):[],l=a.length>2?`${a.slice(0,2).join(", ")} +${a.length-2}`:a.join(", "),f=s.paymentMix||{paid:0,open:0,unknown:0},y=f.paid+f.open+f.unknown,k=y>0?y:1,I=`${Math.max(0,Math.min(100,f.paid/k*100))}%`,H=`${Math.max(0,Math.min(100,f.open/k*100))}%`,Z=`${Math.max(0,Math.min(100,f.unknown/k*100))}%`;return n.jsxs("div",{className:"v2-dashboard-pnl-label-cell",children:[n.jsxs(A,{size:6,wrap:!0,children:[n.jsx(v,{strong:!0,children:s.label}),s.orderType==="phantom"?n.jsx(E,{color:"gold",children:"Phantom"}):null,l?n.jsxs(v,{type:"secondary",children:["Alias: ",l]}):null,Number.isFinite(Number(s.units))&&Number(s.units)>0?n.jsxs(E,{children:["Stk: ",ts(s.units,0)]}):null]}),y>0?n.jsxs("div",{className:"v2-dashboard-pnl-paybar",title:`Bezahlt ${R(f.paid)} · Offen ${R(f.open)} · Unklar ${R(f.unknown)}`,children:[n.jsx("span",{className:"is-paid",style:{width:I}}),n.jsx("span",{className:"is-open",style:{width:H}}),n.jsx("span",{className:"is-unknown",style:{width:Z}})]}):null]})}if(s.rowType==="payment"){const a=s.paymentStatus==="paid"?n.jsx(E,{color:"green",children:"Bezahlt"}):s.paymentStatus==="open"?n.jsx(E,{color:"orange",children:"Offen"}):s.paymentStatus==="mixed"?n.jsx(E,{color:"blue",children:"Gemischt"}):n.jsx(E,{children:"Unklar"});return n.jsxs(A,{size:6,wrap:!0,children:[n.jsx(v,{children:s.label}),s.paymentDueDate?n.jsxs(v,{type:"secondary",children:["Fällig: ",ns(s.paymentDueDate)]}):null,a]})}const d=s.key==="inflows"||s.key==="outflows"||s.key==="net"||s.key==="closing";return n.jsx(v,{strong:d,children:s.label})}},...M.map(e=>({title:Y(e),key:e,width:132,align:"right",render:(s,d)=>{const a=Number(d.values[e]),l=Number.isFinite(a),f=d.key==="closing",y=!f&&l&&a<0,k=f?l?R(a):"-":l?Gt(a):"-",I=f&&me.get(e)===!0,H=f&&I;return n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-end",width:"100%",gap:4},children:[n.jsx(v,{strong:d.key==="net"||d.key==="closing",type:y?"danger":void 0,children:k}),H?n.jsx(pe,{title:"IST-Kontostand Monatsende eingetragen. Dieser Wert ist fixiert und dient als Basis für Folgemonate.",children:n.jsx(Kn,{style:{fontSize:12,color:"rgba(15, 23, 42, 0.62)"}})}):null]})}}))],[me,M]);function un(){u("next6"),b(Ht.slice()),setRevenueBasisMode(methodikRevenueBasisMode),setCalibrationEnabled(methodikCalibrationEnabled),setQuoteMode("manual")}function mn(e){if(!p)return;const s=e.month||p.month;if(e.checkKey==="cash_in"){r(ie("/v2/abschluss/eingaben",{source:"dashboard",month:s}));return}if(e.checkKey==="fixcost"){r(ie("/v2/abschluss/fixkosten",{source:"dashboard",month:s}));return}if(e.checkKey==="vat"){r(ie("/v2/abschluss/ust",{source:"dashboard",month:s}));return}if(e.checkKey==="revenue_inputs"&&e.sku){r(ie("/v2/products",{source:"dashboard",issues:"revenue",sku:e.sku}));return}if(e.issueType==="order_duty"&&e.sku){r(is({sku:e.sku,month:s,suggestedUnits:e.suggestedUnits??null,requiredArrivalDate:e.requiredArrivalDate||null,recommendedOrderDate:e.recommendedOrderDate||null,source:"inventory_projection",firstRiskMonth:e.firstRiskMonth||null,orderMonth:e.orderMonth||null,leadTimeDays:e.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(e.issueType==="forecast_missing"&&e.sku){r(nn({sku:e.sku,month:s}));return}if((e.issueType==="stock_oos"||e.issueType==="stock_under_safety")&&e.sku){r(dt({risk:e.issueType==="stock_oos"?"oos":"under_safety",abc:e.abcClass&&(e.abcClass==="A"||e.abcClass==="B")?"ab":"all",month:e.firstRiskMonth||s,sku:e.sku,mode:p.coverage.projectionMode||null}));return}r(Xt({route:e.route,checkKey:e.checkKey,month:s,sku:e.sku||null,mode:p.coverage.projectionMode||null}))}return((_t=(Lt=t.settings)==null?void 0:Lt.featureFlags)==null?void 0:_t.executiveDashboardV2)!==!1?n.jsxs("div",{className:"v2-page",children:[n.jsxs(Oe,{className:"v2-intro-card",children:[n.jsxs(kn,{gutter:[10,10],className:"v2-page-head",children:[n.jsx(rt,{xs:24,xl:12,children:n.jsxs("div",{children:[n.jsx(lt,{level:3,children:"Dashboard"}),n.jsx(qt,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]})}),n.jsx(rt,{xs:24,md:12,xl:6,children:n.jsxs("div",{className:"v2-toolbar-field",children:[n.jsx(v,{children:"Zeitraum"}),n.jsx(Vt,{value:h,onChange:e=>u(e),options:ct.map(e=>({value:e.value,label:e.label})),style:{width:220,maxWidth:"100%"}})]})}),n.jsx(rt,{xs:24,md:12,xl:6,children:n.jsxs("div",{className:"v2-toolbar-field",children:[n.jsx(v,{children:"PFO bis"}),n.jsx(Vt,{value:Q||void 0,onChange:e=>z(String(e||"")),options:P.map(e=>({value:e,label:Y(e)})),style:{width:220,maxWidth:"100%"},disabled:!P.length})]})})]}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs(v,{type:"secondary",children:["Zeitraum: ",et," (",M.length," Monate) · PFO bis: ",Q?Y(Q):"—"]})})]}),i?n.jsx(we,{type:"error",showIcon:!0,message:i}):null,o?n.jsx(we,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,kt>0?n.jsx(we,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${kt} FOs prüfen`,description:n.jsx(re,{size:"small",onClick:()=>r("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,n.jsx(Sn,{title:p?`Monats-Check: ${Y(p.month)}`:"Monats-Check",placement:"right",width:520,open:le&&!!p,onClose:()=>ce(!1),destroyOnClose:!1,children:p?n.jsxs(A,{direction:"vertical",size:12,style:{width:"100%"},children:[n.jsxs(A,{wrap:!0,children:[n.jsx(E,{color:(st==null?void 0:st.color)||"default",children:p.coverage.statusLabel}),n.jsxs(v,{children:["Coverage ",Jt(p.coverage.ratio*100)," (",p.coverage.coveredSkus,"/",p.coverage.activeSkus,"),"," ","Bestand ",p.coverage.stockIssueCount,","," ","Bestellpflicht ",p.coverage.orderDutyIssueCount,","," ","Blocker ",p.coverage.blockerCount]}),qe?n.jsx(E,{children:"Vergangen (Info)"}):null]}),n.jsx(Oe,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:n.jsxs(A,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsxs(A,{wrap:!0,children:[n.jsx(pe,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:n.jsx(E,{icon:n.jsx(ze,{}),children:"Coverage"})}),n.jsx(pe,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:n.jsx(E,{icon:n.jsx(ze,{}),children:"Blocker"})})]}),sn.map(e=>n.jsxs("div",{className:"v2-dashboard-detail-card",children:[n.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsxs(v,{strong:!0,children:[os(e.state)," ",e.label]}),e.route?n.jsx(re,{size:"small",onClick:()=>r(Xt({route:e.route,month:p.month,mode:p.coverage.projectionMode})),children:"Öffnen"}):null]}),n.jsx(v,{type:"secondary",children:e.description})]},e.key))]})}),n.jsx(Oe,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:p.coverage.statusKey==="full"?n.jsx(we,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):qe?n.jsx(we,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):n.jsxs(A,{direction:"vertical",size:10,style:{width:"100%"},children:[n.jsxs("div",{children:[n.jsx(v,{strong:!0,children:"1) Blocker"}),p.blockers.length?n.jsx(A,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:p.blockers.map(e=>n.jsxs("div",{className:"v2-dashboard-detail-card",children:[n.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(E,{color:"red",children:"Blocker"}),n.jsx(re,{size:"small",onClick:()=>mn(e),children:"Öffnen"})]}),n.jsx(v,{children:e.message})]},e.id))}):n.jsx("div",{children:n.jsx(v,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),n.jsxs("div",{children:[n.jsx(v,{strong:!0,children:"2) Warnungen"}),Nt.length?n.jsx(A,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:Nt.map(e=>n.jsxs("div",{className:"v2-dashboard-detail-card",children:[n.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(E,{color:"gold",children:"Warnung"}),n.jsx(re,{size:"small",onClick:()=>r(e.route),children:"Öffnen"})]}),n.jsx(v,{children:e.message})]},e.id))}):n.jsx("div",{children:n.jsx(v,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):n.jsx(v,{type:"secondary",children:"Kein Monat gewählt."})}),n.jsxs("div",{className:"v2-calc-cockpit-shell",children:[n.jsxs("div",{className:"v2-calc-cockpit-status",children:[n.jsxs(A,{wrap:!0,children:[n.jsxs(v,{type:"secondary",children:["Min. Kontostand: ",n.jsx("strong",{children:R(gt)})]}),n.jsxs(v,{type:"secondary",children:["Summe Netto: ",n.jsx("strong",{children:R(Qe)})]})]}),n.jsx(re,{size:"small",onClick:un,children:"Zurücksetzen"})]}),n.jsxs("div",{className:"v2-calc-cockpit-modules",role:"group","aria-label":"Cockpit-Steuerung",children:[n.jsxs("div",{className:"v2-calc-cockpit-module",children:[n.jsxs(A,{size:6,children:[n.jsx(v,{strong:!0,children:"Portfolio-Scope"}),n.jsx(pe,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:n.jsx(ze,{})})]}),n.jsx("div",{children:n.jsx(v,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),n.jsx("div",{className:"v2-calc-cockpit-toggle-list",children:Yn.map(e=>{const s=g.includes(e.value),d=s&&g.length<=1;return n.jsxs("div",{className:"v2-calc-cockpit-toggle-row",children:[n.jsx(v,{children:e.label}),n.jsx(it,{size:"small",value:s?"on":"off",onChange:a=>tt(e.value,String(a)==="on"),options:[{label:"An",value:"on"},{label:"Aus",value:"off",disabled:d}]})]},e.value)})}),n.jsx(v,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard. Mindestens eine Produktgruppe bleibt aktiv."})]}),n.jsxs("div",{className:"v2-calc-cockpit-module",children:[n.jsxs(A,{size:6,children:[n.jsx(v,{strong:!0,children:"Umsatzbasis"}),n.jsx(pe,{title:"Plan-Umsatz (Hybrid): MANUELL-Monate nutzen deine Overrides, AUTO-Monate kommen aus der Absatzprognose.",children:n.jsx(ze,{})})]}),n.jsx("div",{children:n.jsx(v,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),n.jsx(it,{block:!0,value:ye,onChange:e=>{const s=String(e)==="forecast_direct"?"forecast_direct":"hybrid";xe({cashInRevenueBasisMode:s}).catch(()=>{})},options:[{label:"Plan-Umsatz (Hybrid)",value:"hybrid"},{label:"Forecast-Umsatz (direkt)",value:"forecast_direct"}]}),n.jsxs(A,{size:8,align:"center",wrap:!0,children:[n.jsx(v,{strong:!0,children:"Kalibrierung"}),n.jsx(Bn,{size:"small",checked:ee,onChange:e=>{xe({cashInCalibrationEnabled:e}).catch(()=>{})}}),n.jsx(pe,{title:"Kalibrierung wirkt nur auf automatische Monate. Manuelle Monatswerte bleiben unverändert.",children:n.jsx(ze,{})}),n.jsx(re,{size:"small",type:"link",onClick:()=>r("/v2/abschluss/eingaben"),children:"Cash-in Setup öffnen"})]}),ye==="forecast_direct"?n.jsx(v,{type:"secondary",children:"Referenzmodus: manuelle Umsatz-Overrides werden ignoriert."}):null,vt?n.jsx(v,{type:"warning",children:vt}):null]}),n.jsxs("div",{className:"v2-calc-cockpit-module",children:[n.jsxs(A,{size:6,children:[n.jsx(v,{strong:!0,children:"Amazon Auszahlungsquote"}),n.jsx(pe,{title:"Manuell nutzt deine Monatswerte. Empfohlen (Plan) berechnet die Quote aus Niveau, Saisonmuster und Sicherheitsmarge.",children:n.jsx(ze,{})})]}),n.jsx("div",{children:n.jsx(v,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),n.jsx(it,{block:!0,value:ve,onChange:e=>{const s=String(e)==="recommendation"?"recommendation":"manual";xe({cashInQuoteMode:s}).catch(()=>{})},options:[{label:"Manuell",value:"manual"},{label:"Empfohlen (Plan)",value:"recommendation"}]}),ve==="manual"?n.jsx(v,{type:"secondary",children:"Nutzt deine Monatswerte aus dem Tab Cash-in Setup."}):n.jsx(v,{type:"secondary",children:"Basiert auf aktuellem Niveau + Saisonmuster - Sicherheitsmarge."}),n.jsx(re,{size:"small",type:"link",onClick:()=>r("/v2/sandbox"),children:"Sandbox öffnen"})]})]})]}),n.jsxs(Oe,{className:"v2-dashboard-chart-card",children:[n.jsx(lt,{level:4,children:"Kontostand & Cashflow"}),n.jsxs("div",{className:"v2-dashboard-chart-summary",children:[n.jsxs(E,{color:"green",children:["Einzahlungen: ",R(Ve)]}),n.jsxs(E,{color:"red",children:["Auszahlungen: ",R(Se)]}),n.jsxs(E,{color:Qe>=0?"green":"red",children:["Netto: ",R(Qe)]}),te.length?n.jsxs(E,{color:"gold",children:["PFO: ",te.length]}):null,Q?n.jsxs(E,{color:"gold",children:["bis ",Y(Q)]}):null]}),n.jsx(v,{type:"secondary",className:"v2-dashboard-chart-hint",children:"Klick auf Monat oder Balken für Details. Legende ist scrollbar."}),n.jsx(Nn,{style:{height:430},option:an,onEvents:on})]}),n.jsxs(Oe,{children:[n.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsxs("div",{children:[n.jsx(lt,{level:4,children:"Monatliche PnL (Matrix)"}),n.jsx(qt,{type:"secondary",children:"Zeilen = Einnahmen/Ausgaben-Struktur, Spalten = gewählter Zeitraum. Bei PO/FO/Phantom siehst du auf Wunsch die einzelnen Zahlungen."})]}),n.jsx(re,{size:"small",onClick:ln,children:rn?"Alles zuklappen":"Alles aufklappen"})]}),n.jsx(On,{className:"v2-ant-table v2-dashboard-pnl-table",columns:cn,dataSource:ot,pagination:!1,size:"small",rowKey:"key",rowClassName:e=>e.rowType==="order"?"v2-dashboard-pnl-table-row-order":e.rowType==="payment"?"v2-dashboard-pnl-table-row-payment":e.key==="net"||e.key==="closing"?"v2-dashboard-pnl-table-row-total":Array.isArray(e.children)&&e.children.length?"v2-dashboard-pnl-table-row-group":"v2-dashboard-pnl-table-row-detail",expandable:{expandedRowKeys:Ie,onExpandedRowsChange:e=>be(e.map(s=>String(s)))},scroll:{x:"max-content"}})]})]}):n.jsx("div",{className:"v2-page",children:n.jsx(we,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{Us as default};
