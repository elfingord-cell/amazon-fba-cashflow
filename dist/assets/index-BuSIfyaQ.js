const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-calendar-timeline.es-BMHNqWja.js","assets/index-DrOkdIyL.js","assets/index-wbQclkoN.css"])))=>i.map(i=>d[i]);
import{al as Ut,t as s,_ as gt,a8 as En,am as Tn,an as fs,ao as et,ap as Le,aq as ce,a9 as yn,ar as sr,as as Ot,a0 as mn,at as fn,au as hs,av as ps,aw as Dn,ax as ot,ay as gs,az as Ha,aA as ta,aB as Bn,aC as vs,aD as ys,a1 as Ba,aE as bs,aa as qr,aF as rt,aG as Sr,aH as Ss,af as Ds,aI as xs,aJ as Cs,aK as Ms,aL as ks,Q as Ps,aM as ws,aN as js,ac as fa,aO as Is,aP as Ns,aQ as Es,aR as Ts,aS as Rs,aT as $s,aU as Os,aV as ha,aW as na,$ as Fs,K as Re,V as za,aX as Ya,aY as Wa,aZ as Ka,a_ as Va,a$ as qa,b0 as Za,W as Ga,b1 as Xa,b2 as Qa,b3 as Ja,b4 as ei,b5 as ti,b6 as ni,b7 as As,k as n,M as It,J as jn,a4 as ra,I as xr,a5 as ri,a2 as ye,a6 as ai,a7 as ii,S as ze,a3 as $t,P as dn,L as pt,O as vt,T as si}from"./index-DrOkdIyL.js";import{T as oi}from"./TanStackGrid-DNQbnxKh.js";import{D as yt}from"./DeNumberInput-DYC0ZMi2.js";import{S as li}from"./SkuAliasCell-CL-LWo3A.js";import{n as ui,m as ci,f as Ls}from"./months-DiLwPhVv.js";import{a as Us}from"./forecastVersioning-CgxN5ixE.js";import{r as In,a as tr,s as Xt,b as di}from"./productCompletenessV2-wFpo7RYV.js";import{u as Cr,C as Nt,T as _s}from"./workspace-hSJpURcw.js";import{u as mi}from"./modalCollaboration-CW7FC8LJ.js";import{b as Hs,a as yr,d as pa,c as ga,r as Tr,n as kn,i as Zt,e as Rr,f as Bs,s as va,F as zs,T as Ys,I as Ws,P as Ks,g as Cn,h as Vs,j as Pn,k as qs,l as Zs,m as _n,o as Gs,p as ir,q as Jt,t as zt,u as Xs,v as ya}from"./orderUtils-CdSgcPrO.js";import{C as en}from"./index-CwWsayj4.js";import{S as aa}from"./index-D76sItGD.js";import{g as Qs,a as Js,i as ba,u as eo,S as Ct}from"./index-Bs0NWQOM.js";import{s as sn}from"./index-f0YJWE_y.js";import{b as Sa,n as $r,i as Zr,a as to}from"./orderEditorFactory-B9TeLUbV.js";import{b as no,c as fi}from"./categoryOrder-C77cYWrY.js";import"./index-D1FgTqkK.js";import"./Dropdown-QmF6_rIx.js";import"./foSuggestion-Ck1952gl.js";import"./useBubbleLock-BNNYgWjU.js";import"./store-CuqvLxCQ.js";import"./prefill-BZ-aTdxD.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-Bobc_K1p.js";function hi(e,...t){const r=e||{};return t.reduce((a,i)=>(Object.keys(i||{}).forEach(u=>{const c=r[u],d=i[u];if(c&&typeof c=="object")if(d&&typeof d=="object")a[u]=hi(c,a[u],d);else{const{_default:h}=c;h&&(a[u]=a[u]||{},a[u][h]=gt(a[u][h],d))}else a[u]=gt(a[u],d)}),a),{})}function ro(e,...t){return s.useMemo(()=>hi.apply(void 0,[e].concat(t)),[t,e])}function ao(...e){return s.useMemo(()=>e.reduce((t,r={})=>(Object.keys(r).forEach(a=>{t[a]=Object.assign(Object.assign({},t[a]),r[a])}),t),{}),[e])}function Gr(e,t){const r=Object.assign({},e);return Object.keys(t).forEach(a=>{if(a!=="_default"){const i=t[a],u=r[a]||{};r[a]=i?Gr(u,i):u}}),r}const io=(e,t,r)=>{const a=ro.apply(void 0,[r].concat(Ut(e))),i=ao.apply(void 0,Ut(t));return s.useMemo(()=>[Gr(a,r),Gr(i,r)],[a,i,r])};var pi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){var r=1e3,a=6e4,i=36e5,u="millisecond",c="second",d="minute",h="hour",g="day",f="week",p="month",S="quarter",P="year",D="date",R="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,N=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,A={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(F){var x=["th","st","nd","rd"],C=F%100;return"["+F+(x[(C-20)%10]||x[C]||x[0])+"]"}},T=function(F,x,C){var U=String(F);return!U||U.length>=x?F:""+Array(x+1-U.length).join(C)+F},E={s:T,z:function(F){var x=-F.utcOffset(),C=Math.abs(x),U=Math.floor(C/60),y=C%60;return(x<=0?"+":"-")+T(U,2,"0")+":"+T(y,2,"0")},m:function F(x,C){if(x.date()<C.date())return-F(C,x);var U=12*(C.year()-x.year())+(C.month()-x.month()),y=x.clone().add(U,p),H=C-y<0,B=x.clone().add(U+(H?-1:1),p);return+(-(U+(C-y)/(H?y-B:B-y))||0)},a:function(F){return F<0?Math.ceil(F)||0:Math.floor(F)},p:function(F){return{M:p,y:P,w:f,d:g,D,h,m:d,s:c,ms:u,Q:S}[F]||String(F||"").toLowerCase().replace(/s$/,"")},u:function(F){return F===void 0}},V="en",W={};W[V]=A;var Y="$isDayjsObject",K=function(F){return F instanceof $||!(!F||!F[Y])},Q=function F(x,C,U){var y;if(!x)return V;if(typeof x=="string"){var H=x.toLowerCase();W[H]&&(y=H),C&&(W[H]=C,y=H);var B=x.split("-");if(!y&&B.length>1)return F(B[0])}else{var O=x.name;W[O]=x,y=O}return!U&&y&&(V=y),y||!U&&V},w=function(F,x){if(K(F))return F.clone();var C=typeof x=="object"?x:{};return C.date=F,C.args=arguments,new $(C)},k=E;k.l=Q,k.i=K,k.w=function(F,x){return w(F,{locale:x.$L,utc:x.$u,x:x.$x,$offset:x.$offset})};var $=function(){function F(C){this.$L=Q(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[Y]=!0}var x=F.prototype;return x.parse=function(C){this.$d=function(U){var y=U.date,H=U.utc;if(y===null)return new Date(NaN);if(k.u(y))return new Date;if(y instanceof Date)return new Date(y);if(typeof y=="string"&&!/Z$/i.test(y)){var B=y.match(b);if(B){var O=B[2]-1||0,L=(B[7]||"0").substring(0,3);return H?new Date(Date.UTC(B[1],O,B[3]||1,B[4]||0,B[5]||0,B[6]||0,L)):new Date(B[1],O,B[3]||1,B[4]||0,B[5]||0,B[6]||0,L)}}return new Date(y)}(C),this.init()},x.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},x.$utils=function(){return k},x.isValid=function(){return this.$d.toString()!==R},x.isSame=function(C,U){var y=w(C);return this.startOf(U)<=y&&y<=this.endOf(U)},x.isAfter=function(C,U){return w(C)<this.startOf(U)},x.isBefore=function(C,U){return this.endOf(U)<w(C)},x.$g=function(C,U,y){return k.u(C)?this[U]:this.set(y,C)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(C,U){var y=this,H=!!k.u(U)||U,B=k.p(C),O=function(ne,re){var ae=k.w(y.$u?Date.UTC(y.$y,re,ne):new Date(y.$y,re,ne),y);return H?ae:ae.endOf(g)},L=function(ne,re){return k.w(y.toDate()[ne].apply(y.toDate("s"),(H?[0,0,0,0]:[23,59,59,999]).slice(re)),y)},Z=this.$W,I=this.$M,oe=this.$D,se="set"+(this.$u?"UTC":"");switch(B){case P:return H?O(1,0):O(31,11);case p:return H?O(1,I):O(0,I+1);case f:var X=this.$locale().weekStart||0,de=(Z<X?Z+7:Z)-X;return O(H?oe-de:oe+(6-de),I);case g:case D:return L(se+"Hours",0);case h:return L(se+"Minutes",1);case d:return L(se+"Seconds",2);case c:return L(se+"Milliseconds",3);default:return this.clone()}},x.endOf=function(C){return this.startOf(C,!1)},x.$set=function(C,U){var y,H=k.p(C),B="set"+(this.$u?"UTC":""),O=(y={},y[g]=B+"Date",y[D]=B+"Date",y[p]=B+"Month",y[P]=B+"FullYear",y[h]=B+"Hours",y[d]=B+"Minutes",y[c]=B+"Seconds",y[u]=B+"Milliseconds",y)[H],L=H===g?this.$D+(U-this.$W):U;if(H===p||H===P){var Z=this.clone().set(D,1);Z.$d[O](L),Z.init(),this.$d=Z.set(D,Math.min(this.$D,Z.daysInMonth())).$d}else O&&this.$d[O](L);return this.init(),this},x.set=function(C,U){return this.clone().$set(C,U)},x.get=function(C){return this[k.p(C)]()},x.add=function(C,U){var y,H=this;C=Number(C);var B=k.p(U),O=function(I){var oe=w(H);return k.w(oe.date(oe.date()+Math.round(I*C)),H)};if(B===p)return this.set(p,this.$M+C);if(B===P)return this.set(P,this.$y+C);if(B===g)return O(1);if(B===f)return O(7);var L=(y={},y[d]=a,y[h]=i,y[c]=r,y)[B]||1,Z=this.$d.getTime()+C*L;return k.w(Z,this)},x.subtract=function(C,U){return this.add(-1*C,U)},x.format=function(C){var U=this,y=this.$locale();if(!this.isValid())return y.invalidDate||R;var H=C||"YYYY-MM-DDTHH:mm:ssZ",B=k.z(this),O=this.$H,L=this.$m,Z=this.$M,I=y.weekdays,oe=y.months,se=y.meridiem,X=function(re,ae,we,Ce){return re&&(re[ae]||re(U,H))||we[ae].slice(0,Ce)},de=function(re){return k.s(O%12||12,re,"0")},ne=se||function(re,ae,we){var Ce=re<12?"AM":"PM";return we?Ce.toLowerCase():Ce};return H.replace(N,function(re,ae){return ae||function(we){switch(we){case"YY":return String(U.$y).slice(-2);case"YYYY":return k.s(U.$y,4,"0");case"M":return Z+1;case"MM":return k.s(Z+1,2,"0");case"MMM":return X(y.monthsShort,Z,oe,3);case"MMMM":return X(oe,Z);case"D":return U.$D;case"DD":return k.s(U.$D,2,"0");case"d":return String(U.$W);case"dd":return X(y.weekdaysMin,U.$W,I,2);case"ddd":return X(y.weekdaysShort,U.$W,I,3);case"dddd":return I[U.$W];case"H":return String(O);case"HH":return k.s(O,2,"0");case"h":return de(1);case"hh":return de(2);case"a":return ne(O,L,!0);case"A":return ne(O,L,!1);case"m":return String(L);case"mm":return k.s(L,2,"0");case"s":return String(U.$s);case"ss":return k.s(U.$s,2,"0");case"SSS":return k.s(U.$ms,3,"0");case"Z":return B}return null}(re)||B.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(C,U,y){var H,B=this,O=k.p(U),L=w(C),Z=(L.utcOffset()-this.utcOffset())*a,I=this-L,oe=function(){return k.m(B,L)};switch(O){case P:H=oe()/12;break;case p:H=oe();break;case S:H=oe()/3;break;case f:H=(I-Z)/6048e5;break;case g:H=(I-Z)/864e5;break;case h:H=I/i;break;case d:H=I/a;break;case c:H=I/r;break;default:H=I}return y?H:k.a(H)},x.daysInMonth=function(){return this.endOf(p).$D},x.$locale=function(){return W[this.$L]},x.locale=function(C,U){if(!C)return this.$L;var y=this.clone(),H=Q(C,U,!0);return H&&(y.$L=H),y},x.clone=function(){return k.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},F}(),q=$.prototype;return w.prototype=q,[["$ms",u],["$s",c],["$m",d],["$H",h],["$W",g],["$M",p],["$y",P],["$D",D]].forEach(function(F){q[F[1]]=function(x){return this.$g(x,F[0],F[1])}}),w.extend=function(F,x){return F.$i||(F(x,$,w),F.$i=!0),w},w.locale=Q,w.isDayjs=K,w.unix=function(F){return w(1e3*F)},w.en=W[V],w.Ls=W,w.p={},w})})(pi);var so=pi.exports;const Pt=En(so);var gi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){return function(r,a){a.prototype.weekday=function(i){var u=this.$locale().weekStart||0,c=this.$W,d=(c<u?c+7:c)-u;return this.$utils().u(i)?d:this.subtract(d,"day").add(i,"day")}}})})(gi);var oo=gi.exports;const lo=En(oo);var vi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){return function(r,a,i){var u=a.prototype,c=function(p){return p&&(p.indexOf?p:p.s)},d=function(p,S,P,D,R){var b=p.name?p:p.$locale(),N=c(b[S]),A=c(b[P]),T=N||A.map(function(V){return V.slice(0,D)});if(!R)return T;var E=b.weekStart;return T.map(function(V,W){return T[(W+(E||0))%7]})},h=function(){return i.Ls[i.locale()]},g=function(p,S){return p.formats[S]||function(P){return P.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(D,R,b){return R||b.slice(1)})}(p.formats[S.toUpperCase()])},f=function(){var p=this;return{months:function(S){return S?S.format("MMMM"):d(p,"months")},monthsShort:function(S){return S?S.format("MMM"):d(p,"monthsShort","months",3)},firstDayOfWeek:function(){return p.$locale().weekStart||0},weekdays:function(S){return S?S.format("dddd"):d(p,"weekdays")},weekdaysMin:function(S){return S?S.format("dd"):d(p,"weekdaysMin","weekdays",2)},weekdaysShort:function(S){return S?S.format("ddd"):d(p,"weekdaysShort","weekdays",3)},longDateFormat:function(S){return g(p.$locale(),S)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};u.localeData=function(){return f.bind(this)()},i.localeData=function(){var p=h();return{firstDayOfWeek:function(){return p.weekStart||0},weekdays:function(){return i.weekdays()},weekdaysShort:function(){return i.weekdaysShort()},weekdaysMin:function(){return i.weekdaysMin()},months:function(){return i.months()},monthsShort:function(){return i.monthsShort()},longDateFormat:function(S){return g(p,S)},meridiem:p.meridiem,ordinal:p.ordinal}},i.months=function(){return d(h(),"months")},i.monthsShort=function(){return d(h(),"monthsShort","months",3)},i.weekdays=function(p){return d(h(),"weekdays",null,null,p)},i.weekdaysShort=function(p){return d(h(),"weekdaysShort","weekdays",3,p)},i.weekdaysMin=function(p){return d(h(),"weekdaysMin","weekdays",2,p)}}})})(vi);var uo=vi.exports;const co=En(uo);var yi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){var r="week",a="year";return function(i,u,c){var d=u.prototype;d.week=function(h){if(h===void 0&&(h=null),h!==null)return this.add(7*(h-this.week()),"day");var g=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var f=c(this).startOf(a).add(1,a).date(g),p=c(this).endOf(r);if(f.isBefore(p))return 1}var S=c(this).startOf(a).date(g).startOf(r).subtract(1,"millisecond"),P=this.diff(S,r,!0);return P<0?c(this).startOf("week").week():Math.ceil(P)},d.weeks=function(h){return h===void 0&&(h=null),this.week(h)}}})})(yi);var mo=yi.exports;const fo=En(mo);var bi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){return function(r,a){a.prototype.weekYear=function(){var i=this.month(),u=this.week(),c=this.year();return u===1&&i===11?c+1:i===0&&u>=52?c-1:c}}})})(bi);var ho=bi.exports;const po=En(ho);var Si={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){return function(r,a){var i=a.prototype,u=i.format;i.format=function(c){var d=this,h=this.$locale();if(!this.isValid())return u.bind(this)(c);var g=this.$utils(),f=(c||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(p){switch(p){case"Q":return Math.ceil((d.$M+1)/3);case"Do":return h.ordinal(d.$D);case"gggg":return d.weekYear();case"GGGG":return d.isoWeekYear();case"wo":return h.ordinal(d.week(),"W");case"w":case"ww":return g.s(d.week(),p==="w"?1:2,"0");case"W":case"WW":return g.s(d.isoWeek(),p==="W"?1:2,"0");case"k":case"kk":return g.s(String(d.$H===0?24:d.$H),p==="k"?1:2,"0");case"X":return Math.floor(d.$d.getTime()/1e3);case"x":return d.$d.getTime();case"z":return"["+d.offsetName()+"]";case"zzz":return"["+d.offsetName("long")+"]";default:return p}});return u.bind(this)(f)}}})})(Si);var go=Si.exports;const vo=En(go);var Di={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Tn,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},a=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,i=/\d/,u=/\d\d/,c=/\d\d?/,d=/\d*[^-_:/,()\s\d]+/,h={},g=function(b){return(b=+b)+(b>68?1900:2e3)},f=function(b){return function(N){this[b]=+N}},p=[/[+-]\d\d:?(\d\d)?|Z/,function(b){(this.zone||(this.zone={})).offset=function(N){if(!N||N==="Z")return 0;var A=N.match(/([+-]|\d\d)/g),T=60*A[1]+(+A[2]||0);return T===0?0:A[0]==="+"?-T:T}(b)}],S=function(b){var N=h[b];return N&&(N.indexOf?N:N.s.concat(N.f))},P=function(b,N){var A,T=h.meridiem;if(T){for(var E=1;E<=24;E+=1)if(b.indexOf(T(E,0,N))>-1){A=E>12;break}}else A=b===(N?"pm":"PM");return A},D={A:[d,function(b){this.afternoon=P(b,!1)}],a:[d,function(b){this.afternoon=P(b,!0)}],Q:[i,function(b){this.month=3*(b-1)+1}],S:[i,function(b){this.milliseconds=100*+b}],SS:[u,function(b){this.milliseconds=10*+b}],SSS:[/\d{3}/,function(b){this.milliseconds=+b}],s:[c,f("seconds")],ss:[c,f("seconds")],m:[c,f("minutes")],mm:[c,f("minutes")],H:[c,f("hours")],h:[c,f("hours")],HH:[c,f("hours")],hh:[c,f("hours")],D:[c,f("day")],DD:[u,f("day")],Do:[d,function(b){var N=h.ordinal,A=b.match(/\d+/);if(this.day=A[0],N)for(var T=1;T<=31;T+=1)N(T).replace(/\[|\]/g,"")===b&&(this.day=T)}],w:[c,f("week")],ww:[u,f("week")],M:[c,f("month")],MM:[u,f("month")],MMM:[d,function(b){var N=S("months"),A=(S("monthsShort")||N.map(function(T){return T.slice(0,3)})).indexOf(b)+1;if(A<1)throw new Error;this.month=A%12||A}],MMMM:[d,function(b){var N=S("months").indexOf(b)+1;if(N<1)throw new Error;this.month=N%12||N}],Y:[/[+-]?\d+/,f("year")],YY:[u,function(b){this.year=g(b)}],YYYY:[/\d{4}/,f("year")],Z:p,ZZ:p};function R(b){var N,A;N=b,A=h&&h.formats;for(var T=(b=N.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(w,k,$){var q=$&&$.toUpperCase();return k||A[$]||r[$]||A[q].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(F,x,C){return x||C.slice(1)})})).match(a),E=T.length,V=0;V<E;V+=1){var W=T[V],Y=D[W],K=Y&&Y[0],Q=Y&&Y[1];T[V]=Q?{regex:K,parser:Q}:W.replace(/^\[|\]$/g,"")}return function(w){for(var k={},$=0,q=0;$<E;$+=1){var F=T[$];if(typeof F=="string")q+=F.length;else{var x=F.regex,C=F.parser,U=w.slice(q),y=x.exec(U)[0];C.call(k,y),w=w.replace(y,"")}}return function(H){var B=H.afternoon;if(B!==void 0){var O=H.hours;B?O<12&&(H.hours+=12):O===12&&(H.hours=0),delete H.afternoon}}(k),k}}return function(b,N,A){A.p.customParseFormat=!0,b&&b.parseTwoDigitYear&&(g=b.parseTwoDigitYear);var T=N.prototype,E=T.parse;T.parse=function(V){var W=V.date,Y=V.utc,K=V.args;this.$u=Y;var Q=K[1];if(typeof Q=="string"){var w=K[2]===!0,k=K[3]===!0,$=w||k,q=K[2];k&&(q=K[2]),h=this.$locale(),!w&&q&&(h=A.Ls[q]),this.$d=function(U,y,H,B){try{if(["x","X"].indexOf(y)>-1)return new Date((y==="X"?1e3:1)*U);var O=R(y)(U),L=O.year,Z=O.month,I=O.day,oe=O.hours,se=O.minutes,X=O.seconds,de=O.milliseconds,ne=O.zone,re=O.week,ae=new Date,we=I||(L||Z?1:ae.getDate()),Ce=L||ae.getFullYear(),fe=0;L&&!Z||(fe=Z>0?Z-1:ae.getMonth());var be,me=oe||0,je=se||0,Ie=X||0,Be=de||0;return ne?new Date(Date.UTC(Ce,fe,we,me,je,Ie,Be+60*ne.offset*1e3)):H?new Date(Date.UTC(Ce,fe,we,me,je,Ie,Be)):(be=new Date(Ce,fe,we,me,je,Ie,Be),re&&(be=B(be).week(re).toDate()),be)}catch{return new Date("")}}(W,Q,Y,A),this.init(),q&&q!==!0&&(this.$L=this.locale(q).$L),$&&W!=this.format(Q)&&(this.$d=new Date("")),h={}}else if(Q instanceof Array)for(var F=Q.length,x=1;x<=F;x+=1){K[1]=Q[x-1];var C=A.apply(this,K);if(C.isValid()){this.$d=C.$d,this.$L=C.$L,this.init();break}x===F&&(this.$d=new Date(""))}else E.call(this,V)}}})})(Di);var yo=Di.exports;const bo=En(yo);Pt.extend(bo);Pt.extend(vo);Pt.extend(lo);Pt.extend(co);Pt.extend(fo);Pt.extend(po);Pt.extend(function(e,t){var r=t.prototype,a=r.format;r.format=function(u){var c=(u||"").replace("Wo","wo");return a.bind(this)(c)}});var So={bn_BD:"bn-bd",by_BY:"be",en_GB:"en-gb",en_US:"en",fr_BE:"fr",fr_CA:"fr-ca",hy_AM:"hy-am",kmr_IQ:"ku",nl_BE:"nl-be",pt_BR:"pt-br",zh_CN:"zh-cn",zh_HK:"zh-hk",zh_TW:"zh-tw"},Mn=function(t){var r=So[t];return r||t.split("_")[0]},Do={getNow:function(){var t=Pt();return typeof t.tz=="function"?t.tz():t},getFixedDate:function(t){return Pt(t,["YYYY-M-DD","YYYY-MM-DD"])},getEndDate:function(t){return t.endOf("month")},getWeekDay:function(t){var r=t.locale("en");return r.weekday()+r.localeData().firstDayOfWeek()},getYear:function(t){return t.year()},getMonth:function(t){return t.month()},getDate:function(t){return t.date()},getHour:function(t){return t.hour()},getMinute:function(t){return t.minute()},getSecond:function(t){return t.second()},getMillisecond:function(t){return t.millisecond()},addYear:function(t,r){return t.add(r,"year")},addMonth:function(t,r){return t.add(r,"month")},addDate:function(t,r){return t.add(r,"day")},setYear:function(t,r){return t.year(r)},setMonth:function(t,r){return t.month(r)},setDate:function(t,r){return t.date(r)},setHour:function(t,r){return t.hour(r)},setMinute:function(t,r){return t.minute(r)},setSecond:function(t,r){return t.second(r)},setMillisecond:function(t,r){return t.millisecond(r)},isAfter:function(t,r){return t.isAfter(r)},isValidate:function(t){return t.isValid()},locale:{getWeekFirstDay:function(t){return Pt().locale(Mn(t)).localeData().firstDayOfWeek()},getWeekFirstDate:function(t,r){return r.locale(Mn(t)).weekday(0)},getWeek:function(t,r){return r.locale(Mn(t)).week()},getShortWeekDays:function(t){return Pt().locale(Mn(t)).localeData().weekdaysMin()},getShortMonths:function(t){return Pt().locale(Mn(t)).localeData().monthsShort()},format:function(t,r,a){return r.locale(Mn(t)).format(a)},parse:function(t,r,a){for(var i=Mn(t),u=0;u<a.length;u+=1){var c=a[u],d=r;if(c.includes("wo")||c.includes("Wo")){for(var h=d.split("-")[0],g=d.split("-")[1],f=Pt(h,"YYYY").startOf("year").locale(i),p=0;p<=52;p+=1){var S=f.add(p,"week");if(S.format("Wo")===g)return S}return null}var P=Pt(d,c,!0).locale(i);if(P.isValid())return P}return null}}};function xo(e,t){return e!==void 0?e:t?"bottomRight":"bottomLeft"}var tn=s.createContext(null),Co={bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}}};function xi(e){var t=e.popupElement,r=e.popupStyle,a=e.popupClassName,i=e.popupAlign,u=e.transitionName,c=e.getPopupContainer,d=e.children,h=e.range,g=e.placement,f=e.builtinPlacements,p=f===void 0?Co:f,S=e.direction,P=e.visible,D=e.onClose,R=s.useContext(tn),b=R.prefixCls,N="".concat(b,"-dropdown"),A=xo(g,S==="rtl");return s.createElement(fs,{showAction:[],hideAction:["click"],popupPlacement:A,builtinPlacements:p,prefixCls:N,popupTransitionName:u,popup:t,popupAlign:i,popupVisible:P,popupClassName:gt(a,et(et({},"".concat(N,"-range"),h),"".concat(N,"-rtl"),S==="rtl")),popupStyle:r,stretch:"minWidth",getPopupContainer:c,onPopupVisibleChange:function(E){E||D()}},d)}function ia(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0",a=String(e);a.length<t;)a="".concat(r).concat(a);return a}function Rn(e){return e==null?[]:Array.isArray(e)?e:[e]}function nr(e,t,r){var a=Ut(e);return a[t]=r,a}function Mr(e,t){var r={},a=t||Object.keys(e);return a.forEach(function(i){e[i]!==void 0&&(r[i]=e[i])}),r}function Ci(e,t,r){if(r)return r;switch(e){case"time":return t.fieldTimeFormat;case"datetime":return t.fieldDateTimeFormat;case"month":return t.fieldMonthFormat;case"year":return t.fieldYearFormat;case"quarter":return t.fieldQuarterFormat;case"week":return t.fieldWeekFormat;default:return t.fieldDateFormat}}function Mi(e,t,r){var a=r!==void 0?r:t[t.length-1],i=t.find(function(u){return e[u]});return a!==i?e[i]:void 0}function ki(e){return Mr(e,["placement","builtinPlacements","popupAlign","getPopupContainer","transitionName","direction"])}function sa(e,t,r,a){var i=s.useMemo(function(){return e||function(c,d){var h=c;return t&&d.type==="date"?t(h,d.today):r&&d.type==="month"?r(h,d.locale):d.originNode}},[e,r,t]),u=s.useCallback(function(c,d){return i(c,Le(Le({},d),{},{range:a}))},[i,a]);return u}function Pi(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=s.useState([!1,!1]),i=ce(a,2),u=i[0],c=i[1],d=function(f,p){c(function(S){return nr(S,p,f)})},h=s.useMemo(function(){return u.map(function(g,f){if(g)return!0;var p=e[f];return p?!!(!r[f]&&!p||p&&t(p,{activeIndex:f})):!1})},[e,u,t,r]);return[h,d]}function wi(e,t,r,a,i){var u="",c=[];return e&&c.push(i?"hh":"HH"),t&&c.push("mm"),r&&c.push("ss"),u=c.join(":"),a&&(u+=".SSS"),i&&(u+=" A"),u}function Mo(e,t,r,a,i,u){var c=e.fieldDateTimeFormat,d=e.fieldDateFormat,h=e.fieldTimeFormat,g=e.fieldMonthFormat,f=e.fieldYearFormat,p=e.fieldWeekFormat,S=e.fieldQuarterFormat,P=e.yearFormat,D=e.cellYearFormat,R=e.cellQuarterFormat,b=e.dayFormat,N=e.cellDateFormat,A=wi(t,r,a,i,u);return Le(Le({},e),{},{fieldDateTimeFormat:c||"YYYY-MM-DD ".concat(A),fieldDateFormat:d||"YYYY-MM-DD",fieldTimeFormat:h||A,fieldMonthFormat:g||"YYYY-MM",fieldYearFormat:f||"YYYY",fieldWeekFormat:p||"gggg-wo",fieldQuarterFormat:S||"YYYY-[Q]Q",yearFormat:P||"YYYY",cellYearFormat:D||"YYYY",cellQuarterFormat:R||"[Q]Q",cellDateFormat:N||b||"D"})}function ji(e,t){var r=t.showHour,a=t.showMinute,i=t.showSecond,u=t.showMillisecond,c=t.use12Hours;return yn.useMemo(function(){return Mo(e,r,a,i,u,c)},[e,r,a,i,u,c])}function Kn(e,t,r){return r??t.some(function(a){return e.includes(a)})}var ko=["showNow","showHour","showMinute","showSecond","showMillisecond","use12Hours","hourStep","minuteStep","secondStep","millisecondStep","hideDisabledOptions","defaultValue","disabledHours","disabledMinutes","disabledSeconds","disabledMilliseconds","disabledTime","changeOnScroll","defaultOpenValue"];function Po(e){var t=Mr(e,ko),r=e.format,a=e.picker,i=null;return r&&(i=r,Array.isArray(i)&&(i=i[0]),i=sr(i)==="object"?i.format:i),a==="time"&&(t.format=i),[t,i]}function wo(e){return e&&typeof e=="string"}function Ii(e,t,r,a){return[e,t,r,a].some(function(i){return i!==void 0})}function Ni(e,t,r,a,i){var u=t,c=r,d=a;if(!e&&!u&&!c&&!d&&!i)u=!0,c=!0,d=!0;else if(e){var h,g,f,p=[u,c,d].some(function(D){return D===!1}),S=[u,c,d].some(function(D){return D===!0}),P=p?!0:!S;u=(h=u)!==null&&h!==void 0?h:P,c=(g=c)!==null&&g!==void 0?g:P,d=(f=d)!==null&&f!==void 0?f:P}return[u,c,d,i]}function Ei(e){var t=e.showTime,r=Po(e),a=ce(r,2),i=a[0],u=a[1],c=t&&sr(t)==="object"?t:{},d=Le(Le({defaultOpenValue:c.defaultOpenValue||c.defaultValue},i),c),h=d.showMillisecond,g=d.showHour,f=d.showMinute,p=d.showSecond,S=Ii(g,f,p,h),P=Ni(S,g,f,p,h),D=ce(P,3);return g=D[0],f=D[1],p=D[2],[d,Le(Le({},d),{},{showHour:g,showMinute:f,showSecond:p,showMillisecond:h}),d.format,u]}function Ti(e,t,r,a,i){var u=e==="time";if(e==="datetime"||u){for(var c=a,d=Ci(e,i,null),h=d,g=[t,r],f=0;f<g.length;f+=1){var p=Rn(g[f])[0];if(wo(p)){h=p;break}}var S=c.showHour,P=c.showMinute,D=c.showSecond,R=c.showMillisecond,b=c.use12Hours,N=Kn(h,["a","A","LT","LLL","LTS"],b),A=Ii(S,P,D,R);A||(S=Kn(h,["H","h","k","LT","LLL"]),P=Kn(h,["m","LT","LLL"]),D=Kn(h,["s","LTS"]),R=Kn(h,["SSS"]));var T=Ni(A,S,P,D,R),E=ce(T,3);S=E[0],P=E[1],D=E[2];var V=t||wi(S,P,D,R,N);return Le(Le({},c),{},{format:V,showHour:S,showMinute:P,showSecond:D,showMillisecond:R,use12Hours:N})}return null}function jo(e,t,r){if(t===!1)return null;var a=t&&sr(t)==="object"?t:{};return a.clearIcon||r||s.createElement("span",{className:"".concat(e,"-clear-btn")})}var Or=7;function xn(e,t,r){return!e&&!t||e===t?!0:!e||!t?!1:r()}function Xr(e,t,r){return xn(t,r,function(){var a=Math.floor(e.getYear(t)/10),i=Math.floor(e.getYear(r)/10);return a===i})}function Nn(e,t,r){return xn(t,r,function(){return e.getYear(t)===e.getYear(r)})}function Da(e,t){var r=Math.floor(e.getMonth(t)/3);return r+1}function Io(e,t,r){return xn(t,r,function(){return Nn(e,t,r)&&Da(e,t)===Da(e,r)})}function oa(e,t,r){return xn(t,r,function(){return Nn(e,t,r)&&e.getMonth(t)===e.getMonth(r)})}function la(e,t,r){return xn(t,r,function(){return Nn(e,t,r)&&oa(e,t,r)&&e.getDate(t)===e.getDate(r)})}function Ri(e,t,r){return xn(t,r,function(){return e.getHour(t)===e.getHour(r)&&e.getMinute(t)===e.getMinute(r)&&e.getSecond(t)===e.getSecond(r)})}function $i(e,t,r){return xn(t,r,function(){return la(e,t,r)&&Ri(e,t,r)&&e.getMillisecond(t)===e.getMillisecond(r)})}function Xn(e,t,r,a){return xn(r,a,function(){var i=e.locale.getWeekFirstDate(t,r),u=e.locale.getWeekFirstDate(t,a);return Nn(e,i,u)&&e.locale.getWeek(t,r)===e.locale.getWeek(t,a)})}function Lt(e,t,r,a,i){switch(i){case"date":return la(e,r,a);case"week":return Xn(e,t.locale,r,a);case"month":return oa(e,r,a);case"quarter":return Io(e,r,a);case"year":return Nn(e,r,a);case"decade":return Xr(e,r,a);case"time":return Ri(e,r,a);default:return $i(e,r,a)}}function kr(e,t,r,a){return!t||!r||!a?!1:e.isAfter(a,t)&&e.isAfter(r,a)}function ur(e,t,r,a,i){return Lt(e,t,r,a,i)?!0:e.isAfter(r,a)}function No(e,t,r){var a=t.locale.getWeekFirstDay(e),i=t.setDate(r,1),u=t.getWeekDay(i),c=t.addDate(i,a-u);return t.getMonth(c)===t.getMonth(r)&&t.getDate(c)>1&&(c=t.addDate(c,-7)),c}function wt(e,t){var r=t.generateConfig,a=t.locale,i=t.format;return e?typeof i=="function"?i(e):r.locale.format(a.locale,e,i):""}function Dr(e,t,r){var a=t,i=["getHour","getMinute","getSecond","getMillisecond"],u=["setHour","setMinute","setSecond","setMillisecond"];return u.forEach(function(c,d){r?a=e[c](a,e[i[d]](r)):a=e[c](a,0)}),a}function Eo(e,t,r,a,i){var u=Ot(function(c,d){return!!(r&&r(c,d)||a&&e.isAfter(a,c)&&!Lt(e,t,a,c,d.type)||i&&e.isAfter(c,i)&&!Lt(e,t,i,c,d.type))});return u}function To(e,t,r){return s.useMemo(function(){var a=Ci(e,t,r),i=Rn(a),u=i[0],c=sr(u)==="object"&&u.type==="mask"?u.format:null;return[i.map(function(d){return typeof d=="string"||typeof d=="function"?d:d.format}),c]},[e,t,r])}function Ro(e,t,r){return typeof e[0]=="function"||r?!0:t}function $o(e,t,r,a){var i=Ot(function(u,c){var d=Le({type:t},c);if(delete d.activeIndex,!e.isValidate(u)||r&&r(u,d))return!0;if((t==="date"||t==="time")&&a){var h,g=c&&c.activeIndex===1?"end":"start",f=((h=a.disabledTime)===null||h===void 0?void 0:h.call(a,u,g,{from:d.from}))||{},p=f.disabledHours,S=f.disabledMinutes,P=f.disabledSeconds,D=f.disabledMilliseconds,R=a.disabledHours,b=a.disabledMinutes,N=a.disabledSeconds,A=p||R,T=S||b,E=P||N,V=e.getHour(u),W=e.getMinute(u),Y=e.getSecond(u),K=e.getMillisecond(u);if(A&&A().includes(V)||T&&T(V).includes(W)||E&&E(V,W).includes(Y)||D&&D(V,W,Y).includes(K))return!0}return!1});return i}function cr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=s.useMemo(function(){var a=e&&Rn(e);return t&&a&&(a[1]=a[1]||a[0]),a},[e,t]);return r}function Oi(e,t){var r=e.generateConfig,a=e.locale,i=e.picker,u=i===void 0?"date":i,c=e.prefixCls,d=c===void 0?"rc-picker":c,h=e.styles,g=h===void 0?{}:h,f=e.classNames,p=f===void 0?{}:f,S=e.order,P=S===void 0?!0:S,D=e.components,R=D===void 0?{}:D,b=e.inputRender,N=e.allowClear,A=e.clearIcon,T=e.needConfirm,E=e.multiple,V=e.format,W=e.inputReadOnly,Y=e.disabledDate,K=e.minDate,Q=e.maxDate,w=e.showTime,k=e.value,$=e.defaultValue,q=e.pickerValue,F=e.defaultPickerValue,x=cr(k),C=cr($),U=cr(q),y=cr(F),H=u==="date"&&w?"datetime":u,B=H==="time"||H==="datetime",O=B||E,L=T??B,Z=Ei(e),I=ce(Z,4),oe=I[0],se=I[1],X=I[2],de=I[3],ne=ji(a,se),re=s.useMemo(function(){return Ti(H,X,de,oe,ne)},[H,X,de,oe,ne]),ae=s.useMemo(function(){return Le(Le({},e),{},{prefixCls:d,locale:ne,picker:u,styles:g,classNames:p,order:P,components:Le({input:b},R),clearIcon:jo(d,N,A),showTime:re,value:x,defaultValue:C,pickerValue:U,defaultPickerValue:y},t==null?void 0:t())},[e]),we=To(H,ne,V),Ce=ce(we,2),fe=Ce[0],be=Ce[1],me=Ro(fe,W,E),je=Eo(r,a,Y,K,Q),Ie=$o(r,u,je,re),Be=s.useMemo(function(){return Le(Le({},ae),{},{needConfirm:L,inputReadOnly:me,disabledDate:je})},[ae,L,me,je]);return[Be,H,O,fe,be,Ie]}function Oo(e,t,r){var a=mn(t,{value:e}),i=ce(a,2),u=i[0],c=i[1],d=yn.useRef(e),h=yn.useRef(),g=function(){fn.cancel(h.current)},f=Ot(function(){c(d.current),r&&u!==d.current&&r(d.current)}),p=Ot(function(S,P){g(),d.current=S,S||P?f():h.current=fn(f)});return yn.useEffect(function(){return g},[]),[u,p]}function Fi(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,i=r.every(function(f){return f})?!1:e,u=Oo(i,t||!1,a),c=ce(u,2),d=c[0],h=c[1];function g(f){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!p.inherit||d)&&h(f,p.force)}return[d,g]}function Ai(e){var t=s.useRef();return s.useImperativeHandle(e,function(){var r;return{nativeElement:(r=t.current)===null||r===void 0?void 0:r.nativeElement,focus:function(i){var u;(u=t.current)===null||u===void 0||u.focus(i)},blur:function(){var i;(i=t.current)===null||i===void 0||i.blur()}}}),t}function Li(e,t){return s.useMemo(function(){return e||(t?(hs(!1,"`ranges` is deprecated. Please use `presets` instead."),Object.entries(t).map(function(r){var a=ce(r,2),i=a[0],u=a[1];return{label:i,value:u}})):[])},[e,t])}function ua(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=s.useRef(t);a.current=t,ps(function(){if(e)a.current(e);else{var i=fn(function(){a.current(e)},r);return function(){fn.cancel(i)}}},[e])}function Ui(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=s.useState(0),i=ce(a,2),u=i[0],c=i[1],d=s.useState(!1),h=ce(d,2),g=h[0],f=h[1],p=s.useRef([]),S=s.useRef(null),P=s.useRef(null),D=function(E){S.current=E},R=function(E){return S.current===E},b=function(E){f(E)},N=function(E){return E&&(P.current=E),P.current},A=function(E){var V=p.current,W=new Set(V.filter(function(K){return E[K]||t[K]})),Y=V[V.length-1]===0?1:0;return W.size>=2||e[Y]?null:Y};return ua(g||r,function(){g||(p.current=[],D(null))}),s.useEffect(function(){g&&p.current.push(u)},[g,u]),[g,b,N,u,c,A,p.current,D,R]}function Fo(e,t,r,a,i,u){var c=r[r.length-1],d=function(g,f){var p=ce(e,2),S=p[0],P=p[1],D=Le(Le({},f),{},{from:Mi(e,r)});return c===1&&t[0]&&S&&!Lt(a,i,S,g,D.type)&&a.isAfter(S,g)||c===0&&t[1]&&P&&!Lt(a,i,P,g,D.type)&&a.isAfter(g,P)?!0:u==null?void 0:u(g,D)};return d}function Qn(e,t,r,a){switch(t){case"date":case"week":return e.addMonth(r,a);case"month":case"quarter":return e.addYear(r,a);case"year":return e.addYear(r,a*10);case"decade":return e.addYear(r,a*100);default:return r}}var Fr=[];function _i(e,t,r,a,i,u,c,d){var h=arguments.length>8&&arguments[8]!==void 0?arguments[8]:Fr,g=arguments.length>9&&arguments[9]!==void 0?arguments[9]:Fr,f=arguments.length>10&&arguments[10]!==void 0?arguments[10]:Fr,p=arguments.length>11?arguments[11]:void 0,S=arguments.length>12?arguments[12]:void 0,P=arguments.length>13?arguments[13]:void 0,D=c==="time",R=u||0,b=function(U){var y=e.getNow();return D&&(y=Dr(e,y)),h[U]||r[U]||y},N=ce(g,2),A=N[0],T=N[1],E=mn(function(){return b(0)},{value:A}),V=ce(E,2),W=V[0],Y=V[1],K=mn(function(){return b(1)},{value:T}),Q=ce(K,2),w=Q[0],k=Q[1],$=s.useMemo(function(){var C=[W,w][R];return D?C:Dr(e,C,f[R])},[D,W,w,R,e,f]),q=function(U){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"panel",H=[Y,k][R];H(U);var B=[W,w];B[R]=U,p&&(!Lt(e,t,W,B[0],c)||!Lt(e,t,w,B[1],c))&&p(B,{source:y,range:R===1?"end":"start",mode:a})},F=function(U,y){if(d){var H={date:"month",week:"month",month:"year",quarter:"year"},B=H[c];if(B&&!Lt(e,t,U,y,B))return Qn(e,c,y,-1);if(c==="year"&&U){var O=Math.floor(e.getYear(U)/10),L=Math.floor(e.getYear(y)/10);if(O!==L)return Qn(e,c,y,-1)}}return y},x=s.useRef(null);return Dn(function(){if(i&&!h[R]){var C=D?null:e.getNow();if(x.current!==null&&x.current!==R?C=[W,w][R^1]:r[R]?C=R===0?r[0]:F(r[0],r[1]):r[R^1]&&(C=r[R^1]),C){S&&e.isAfter(S,C)&&(C=S);var U=d?Qn(e,c,C,1):C;P&&e.isAfter(U,P)&&(C=d?Qn(e,c,P,-1):P),q(C,"reset")}}},[i,R,r[R]]),s.useEffect(function(){i?x.current=R:x.current=null},[i,R]),Dn(function(){i&&h&&h[R]&&q(h[R],"reset")},[i,R]),[$,q]}function Hi(e,t){var r=s.useRef(e),a=s.useState({}),i=ce(a,2),u=i[1],c=function(g){return g&&t!==void 0?t:r.current},d=function(g){r.current=g,u({})};return[c,d,c(!0)]}var Ao=[];function Bi(e,t,r){var a=function(c){return c.map(function(d){return wt(d,{generateConfig:e,locale:t,format:r[0]})})},i=function(c,d){for(var h=Math.max(c.length,d.length),g=-1,f=0;f<h;f+=1){var p=c[f]||null,S=d[f]||null;if(p!==S&&!$i(e,p,S)){g=f;break}}return[g<0,g!==0]};return[a,i]}function zi(e,t){return Ut(e).sort(function(r,a){return t.isAfter(r,a)?1:-1})}function Lo(e){var t=Hi(e),r=ce(t,2),a=r[0],i=r[1],u=Ot(function(){i(e)});return s.useEffect(function(){u()},[e]),[a,i]}function Yi(e,t,r,a,i,u,c,d,h){var g=mn(u,{value:c}),f=ce(g,2),p=f[0],S=f[1],P=p||Ao,D=Lo(P),R=ce(D,2),b=R[0],N=R[1],A=Bi(e,t,r),T=ce(A,2),E=T[0],V=T[1],W=Ot(function(K){var Q=Ut(K);if(a)for(var w=0;w<2;w+=1)Q[w]=Q[w]||null;else i&&(Q=zi(Q.filter(function(C){return C}),e));var k=V(b(),Q),$=ce(k,2),q=$[0],F=$[1];if(!q&&(N(Q),d)){var x=E(Q);d(Q,x,{range:F?"end":"start"})}}),Y=function(){h&&h(b())};return[P,S,b,W,Y]}function Wi(e,t,r,a,i,u,c,d,h,g){var f=e.generateConfig,p=e.locale,S=e.picker,P=e.onChange,D=e.allowEmpty,R=e.order,b=u.some(function(q){return q})?!1:R,N=Bi(f,p,c),A=ce(N,2),T=A[0],E=A[1],V=Hi(t),W=ce(V,2),Y=W[0],K=W[1],Q=Ot(function(){K(t)});s.useEffect(function(){Q()},[t]);var w=Ot(function(q){var F=q===null,x=Ut(q||Y());if(F)for(var C=Math.max(u.length,x.length),U=0;U<C;U+=1)u[U]||(x[U]=null);b&&x[0]&&x[1]&&(x=zi(x,f)),i(x);var y=x,H=ce(y,2),B=H[0],O=H[1],L=!B,Z=!O,I=D?(!L||D[0])&&(!Z||D[1]):!0,oe=!R||L||Z||Lt(f,p,B,O,S)||f.isAfter(O,B),se=(u[0]||!B||!g(B,{activeIndex:0}))&&(u[1]||!O||!g(O,{from:B,activeIndex:1})),X=F||I&&oe&&se;if(X){r(x);var de=E(x,t),ne=ce(de,1),re=ne[0];P&&!re&&P(F&&x.every(function(ae){return!ae})?null:x,T(x))}return X}),k=Ot(function(q,F){var x=nr(Y(),q,a()[q]);K(x),F&&w()}),$=!d&&!h;return ua(!$,function(){$&&(w(),i(t),Q())},2),[k,w]}function Ki(e,t,r,a,i){return t!=="date"&&t!=="time"?!1:r!==void 0?r:a!==void 0?a:!i&&(e==="date"||e==="time")}function Uo(e,t,r,a,i,u){var c=e;function d(p,S,P){var D=u[p](c),R=P.find(function(T){return T.value===D});if(!R||R.disabled){var b=P.filter(function(T){return!T.disabled}),N=Ut(b).reverse(),A=N.find(function(T){return T.value<=D})||b[0];A&&(D=A.value,c=u[S](c,D))}return D}var h=d("getHour","setHour",t()),g=d("getMinute","setMinute",r(h)),f=d("getSecond","setSecond",a(h,g));return d("getMillisecond","setMillisecond",i(h,g,f)),c}function dr(){return[]}function mr(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:2,c=[],d=r>=1?r|0:1,h=e;h<=t;h+=d){var g=i.includes(h);(!g||!a)&&c.push({label:ia(h,u),value:h,disabled:g})}return c}function ca(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=t||{},i=a.use12Hours,u=a.hourStep,c=u===void 0?1:u,d=a.minuteStep,h=d===void 0?1:d,g=a.secondStep,f=g===void 0?1:g,p=a.millisecondStep,S=p===void 0?100:p,P=a.hideDisabledOptions,D=a.disabledTime,R=a.disabledHours,b=a.disabledMinutes,N=a.disabledSeconds,A=s.useMemo(function(){return r||e.getNow()},[r,e]),T=s.useCallback(function(y){var H=(D==null?void 0:D(y))||{};return[H.disabledHours||R||dr,H.disabledMinutes||b||dr,H.disabledSeconds||N||dr,H.disabledMilliseconds||dr]},[D,R,b,N]),E=s.useMemo(function(){return T(A)},[A,T]),V=ce(E,4),W=V[0],Y=V[1],K=V[2],Q=V[3],w=s.useCallback(function(y,H,B,O){var L=mr(0,23,c,P,y()),Z=i?L.map(function(X){return Le(Le({},X),{},{label:ia(X.value%12||12,2)})}):L,I=function(de){return mr(0,59,h,P,H(de))},oe=function(de,ne){return mr(0,59,f,P,B(de,ne))},se=function(de,ne,re){return mr(0,999,S,P,O(de,ne,re),3)};return[Z,I,oe,se]},[P,c,i,S,h,f]),k=s.useMemo(function(){return w(W,Y,K,Q)},[w,W,Y,K,Q]),$=ce(k,4),q=$[0],F=$[1],x=$[2],C=$[3],U=function(H,B){var O=function(){return q},L=F,Z=x,I=C;if(B){var oe=T(B),se=ce(oe,4),X=se[0],de=se[1],ne=se[2],re=se[3],ae=w(X,de,ne,re),we=ce(ae,4),Ce=we[0],fe=we[1],be=we[2],me=we[3];O=function(){return Ce},L=fe,Z=be,I=me}var je=Uo(H,O,L,Z,I,e);return je};return[U,q,F,x,C]}function _o(e){var t=e.mode,r=e.internalMode,a=e.renderExtraFooter,i=e.showNow,u=e.showTime,c=e.onSubmit,d=e.onNow,h=e.invalid,g=e.needConfirm,f=e.generateConfig,p=e.disabledDate,S=s.useContext(tn),P=S.prefixCls,D=S.locale,R=S.button,b=R===void 0?"button":R,N=f.getNow(),A=ca(f,u,N),T=ce(A,1),E=T[0],V=a==null?void 0:a(t),W=p(N,{type:t}),Y=function(){if(!W){var F=E(N);d(F)}},K="".concat(P,"-now"),Q="".concat(K,"-btn"),w=i&&s.createElement("li",{className:K},s.createElement("a",{className:gt(Q,W&&"".concat(Q,"-disabled")),"aria-disabled":W,onClick:Y},r==="date"?D.today:D.now)),k=g&&s.createElement("li",{className:"".concat(P,"-ok")},s.createElement(b,{disabled:h,onClick:c},D.ok)),$=(w||k)&&s.createElement("ul",{className:"".concat(P,"-ranges")},w,k);return!V&&!$?null:s.createElement("div",{className:"".concat(P,"-footer")},V&&s.createElement("div",{className:"".concat(P,"-footer-extra")},V),$)}function Vi(e,t,r){function a(i,u){var c=i.findIndex(function(h){return Lt(e,t,h,u,r)});if(c===-1)return[].concat(Ut(i),[u]);var d=Ut(i);return d.splice(c,1),d}return a}var $n=s.createContext(null);function Pr(){return s.useContext($n)}function zn(e,t){var r=e.prefixCls,a=e.generateConfig,i=e.locale,u=e.disabledDate,c=e.minDate,d=e.maxDate,h=e.cellRender,g=e.hoverValue,f=e.hoverRangeValue,p=e.onHover,S=e.values,P=e.pickerValue,D=e.onSelect,R=e.prevIcon,b=e.nextIcon,N=e.superPrevIcon,A=e.superNextIcon,T=a.getNow(),E={now:T,values:S,pickerValue:P,prefixCls:r,disabledDate:u,minDate:c,maxDate:d,cellRender:h,hoverValue:g,hoverRangeValue:f,onHover:p,locale:i,generateConfig:a,onSelect:D,panelType:t,prevIcon:R,nextIcon:b,superPrevIcon:N,superNextIcon:A};return[E,T]}var Sn=s.createContext({});function or(e){for(var t=e.rowNum,r=e.colNum,a=e.baseDate,i=e.getCellDate,u=e.prefixColumn,c=e.rowClassName,d=e.titleFormat,h=e.getCellText,g=e.getCellClassName,f=e.headerCells,p=e.cellSelection,S=p===void 0?!0:p,P=e.disabledDate,D=Pr(),R=D.prefixCls,b=D.panelType,N=D.now,A=D.disabledDate,T=D.cellRender,E=D.onHover,V=D.hoverValue,W=D.hoverRangeValue,Y=D.generateConfig,K=D.values,Q=D.locale,w=D.onSelect,k=P||A,$="".concat(R,"-cell"),q=s.useContext(Sn),F=q.onCellDblClick,x=function(Z){return K.some(function(I){return I&&Lt(Y,Q,Z,I,b)})},C=[],U=0;U<t;U+=1){for(var y=[],H=void 0,B=function(){var Z=U*r+O,I=i(a,Z),oe=k==null?void 0:k(I,{type:b});O===0&&(H=I,u&&y.push(u(H)));var se=!1,X=!1,de=!1;if(S&&W){var ne=ce(W,2),re=ne[0],ae=ne[1];se=kr(Y,re,ae,I),X=Lt(Y,Q,I,re,b),de=Lt(Y,Q,I,ae,b)}var we=d?wt(I,{locale:Q,format:d,generateConfig:Y}):void 0,Ce=s.createElement("div",{className:"".concat($,"-inner")},h(I));y.push(s.createElement("td",{key:O,title:we,className:gt($,Le(et(et(et(et(et(et({},"".concat($,"-disabled"),oe),"".concat($,"-hover"),(V||[]).some(function(fe){return Lt(Y,Q,I,fe,b)})),"".concat($,"-in-range"),se&&!X&&!de),"".concat($,"-range-start"),X),"".concat($,"-range-end"),de),"".concat(R,"-cell-selected"),!W&&b!=="week"&&x(I)),g(I))),onClick:function(){oe||w(I)},onDoubleClick:function(){!oe&&F&&F()},onMouseEnter:function(){oe||E==null||E(I)},onMouseLeave:function(){oe||E==null||E(null)}},T?T(I,{prefixCls:R,originNode:Ce,today:N,type:b,locale:Q}):Ce))},O=0;O<r;O+=1)B();C.push(s.createElement("tr",{key:U,className:c==null?void 0:c(H)},y))}return s.createElement("div",{className:"".concat(R,"-body")},s.createElement("table",{className:"".concat(R,"-content")},f&&s.createElement("thead",null,s.createElement("tr",null,f)),s.createElement("tbody",null,C)))}var fr={visibility:"hidden"};function Yn(e){var t=e.offset,r=e.superOffset,a=e.onChange,i=e.getStart,u=e.getEnd,c=e.children,d=Pr(),h=d.prefixCls,g=d.prevIcon,f=g===void 0?"‹":g,p=d.nextIcon,S=p===void 0?"›":p,P=d.superPrevIcon,D=P===void 0?"«":P,R=d.superNextIcon,b=R===void 0?"»":R,N=d.minDate,A=d.maxDate,T=d.generateConfig,E=d.locale,V=d.pickerValue,W=d.panelType,Y="".concat(h,"-header"),K=s.useContext(Sn),Q=K.hidePrev,w=K.hideNext,k=K.hideHeader,$=s.useMemo(function(){if(!N||!t||!u)return!1;var L=u(t(-1,V));return!ur(T,E,L,N,W)},[N,t,V,u,T,E,W]),q=s.useMemo(function(){if(!N||!r||!u)return!1;var L=u(r(-1,V));return!ur(T,E,L,N,W)},[N,r,V,u,T,E,W]),F=s.useMemo(function(){if(!A||!t||!i)return!1;var L=i(t(1,V));return!ur(T,E,A,L,W)},[A,t,V,i,T,E,W]),x=s.useMemo(function(){if(!A||!r||!i)return!1;var L=i(r(1,V));return!ur(T,E,A,L,W)},[A,r,V,i,T,E,W]),C=function(Z){t&&a(t(Z,V))},U=function(Z){r&&a(r(Z,V))};if(k)return null;var y="".concat(Y,"-prev-btn"),H="".concat(Y,"-next-btn"),B="".concat(Y,"-super-prev-btn"),O="".concat(Y,"-super-next-btn");return s.createElement("div",{className:Y},r&&s.createElement("button",{type:"button","aria-label":E.previousYear,onClick:function(){return U(-1)},tabIndex:-1,className:gt(B,q&&"".concat(B,"-disabled")),disabled:q,style:Q?fr:{}},D),t&&s.createElement("button",{type:"button","aria-label":E.previousMonth,onClick:function(){return C(-1)},tabIndex:-1,className:gt(y,$&&"".concat(y,"-disabled")),disabled:$,style:Q?fr:{}},f),s.createElement("div",{className:"".concat(Y,"-view")},c),t&&s.createElement("button",{type:"button","aria-label":E.nextMonth,onClick:function(){return C(1)},tabIndex:-1,className:gt(H,F&&"".concat(H,"-disabled")),disabled:F,style:w?fr:{}},S),r&&s.createElement("button",{type:"button","aria-label":E.nextYear,onClick:function(){return U(1)},tabIndex:-1,className:gt(O,x&&"".concat(O,"-disabled")),disabled:x,style:w?fr:{}},b))}function wr(e){var t=e.prefixCls,r=e.panelName,a=r===void 0?"date":r,i=e.locale,u=e.generateConfig,c=e.pickerValue,d=e.onPickerValueChange,h=e.onModeChange,g=e.mode,f=g===void 0?"date":g,p=e.disabledDate,S=e.onSelect,P=e.onHover,D=e.showWeek,R="".concat(t,"-").concat(a,"-panel"),b="".concat(t,"-cell"),N=f==="week",A=zn(e,f),T=ce(A,2),E=T[0],V=T[1],W=u.locale.getWeekFirstDay(i.locale),Y=u.setDate(c,1),K=No(i.locale,u,Y),Q=u.getMonth(c),w=D===void 0?N:D,k=w?function(L){var Z=p==null?void 0:p(L,{type:"week"});return s.createElement("td",{key:"week",className:gt(b,"".concat(b,"-week"),et({},"".concat(b,"-disabled"),Z)),onClick:function(){Z||S(L)},onMouseEnter:function(){Z||P==null||P(L)},onMouseLeave:function(){Z||P==null||P(null)}},s.createElement("div",{className:"".concat(b,"-inner")},u.locale.getWeek(i.locale,L)))}:null,$=[],q=i.shortWeekDays||(u.locale.getShortWeekDays?u.locale.getShortWeekDays(i.locale):[]);k&&$.push(s.createElement("th",{key:"empty"},s.createElement("span",{style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},i.week)));for(var F=0;F<Or;F+=1)$.push(s.createElement("th",{key:F},q[(F+W)%Or]));var x=function(Z,I){return u.addDate(Z,I)},C=function(Z){return wt(Z,{locale:i,format:i.cellDateFormat,generateConfig:u})},U=function(Z){var I=et(et({},"".concat(t,"-cell-in-view"),oa(u,Z,c)),"".concat(t,"-cell-today"),la(u,Z,V));return I},y=i.shortMonths||(u.locale.getShortMonths?u.locale.getShortMonths(i.locale):[]),H=s.createElement("button",{type:"button","aria-label":i.yearSelect,key:"year",onClick:function(){h("year",c)},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(c,{locale:i,format:i.yearFormat,generateConfig:u})),B=s.createElement("button",{type:"button","aria-label":i.monthSelect,key:"month",onClick:function(){h("month",c)},tabIndex:-1,className:"".concat(t,"-month-btn")},i.monthFormat?wt(c,{locale:i,format:i.monthFormat,generateConfig:u}):y[Q]),O=i.monthBeforeYear?[B,H]:[H,B];return s.createElement($n.Provider,{value:E},s.createElement("div",{className:gt(R,D&&"".concat(R,"-show-week"))},s.createElement(Yn,{offset:function(Z){return u.addMonth(c,Z)},superOffset:function(Z){return u.addYear(c,Z)},onChange:d,getStart:function(Z){return u.setDate(Z,1)},getEnd:function(Z){var I=u.setDate(Z,1);return I=u.addMonth(I,1),u.addDate(I,-1)}},O),s.createElement(or,ot({titleFormat:i.fieldDateFormat},e,{colNum:Or,rowNum:6,baseDate:K,headerCells:$,getCellDate:x,getCellText:C,getCellClassName:U,prefixColumn:k,cellSelection:!N}))))}var Ho=1/3;function Bo(e,t){var r=s.useRef(!1),a=s.useRef(null),i=s.useRef(null),u=function(){return r.current},c=function(){fn.cancel(a.current),r.current=!1},d=s.useRef(),h=function(){var p=e.current;if(i.current=null,d.current=0,p){var S=p.querySelector('[data-value="'.concat(t,'"]')),P=p.querySelector("li"),D=function R(){c(),r.current=!0,d.current+=1;var b=p.scrollTop,N=P.offsetTop,A=S.offsetTop,T=A-N;if(A===0&&S!==P||!gs(p)){d.current<=5&&(a.current=fn(R));return}var E=b+(T-b)*Ho,V=Math.abs(T-E);if(i.current!==null&&i.current<V){c();return}if(i.current=V,V<=1){p.scrollTop=T,c();return}p.scrollTop=E,a.current=fn(R)};S&&P&&D()}},g=Ot(h);return[g,c,u]}var zo=300;function Yo(e){return e.map(function(t){var r=t.value,a=t.label,i=t.disabled;return[r,a,i].join(",")}).join(";")}function Vn(e){var t=e.units,r=e.value,a=e.optionalValue,i=e.type,u=e.onChange,c=e.onHover,d=e.onDblClick,h=e.changeOnScroll,g=Pr(),f=g.prefixCls,p=g.cellRender,S=g.now,P=g.locale,D="".concat(f,"-time-panel"),R="".concat(f,"-time-panel-cell"),b=s.useRef(null),N=s.useRef(),A=function(){clearTimeout(N.current)},T=Bo(b,r??a),E=ce(T,3),V=E[0],W=E[1],Y=E[2];Dn(function(){return V(),A(),function(){W(),A()}},[r,a,Yo(t)]);var K=function(k){A();var $=k.target;!Y()&&h&&(N.current=setTimeout(function(){var q=b.current,F=q.querySelector("li").offsetTop,x=Array.from(q.querySelectorAll("li")),C=x.map(function(O){return O.offsetTop-F}),U=C.map(function(O,L){return t[L].disabled?Number.MAX_SAFE_INTEGER:Math.abs(O-$.scrollTop)}),y=Math.min.apply(Math,Ut(U)),H=U.findIndex(function(O){return O===y}),B=t[H];B&&!B.disabled&&u(B.value)},zo))},Q="".concat(D,"-column");return s.createElement("ul",{className:Q,ref:b,"data-type":i,onScroll:K},t.map(function(w){var k=w.label,$=w.value,q=w.disabled,F=s.createElement("div",{className:"".concat(R,"-inner")},k);return s.createElement("li",{key:$,className:gt(R,et(et({},"".concat(R,"-selected"),r===$),"".concat(R,"-disabled"),q)),onClick:function(){q||u($)},onDoubleClick:function(){!q&&d&&d()},onMouseEnter:function(){c($)},onMouseLeave:function(){c(null)},"data-value":$},p?p($,{prefixCls:f,originNode:F,today:S,type:"time",subType:i,locale:P}):F)}))}function gn(e){return e<12}function Wo(e){var t=e.showHour,r=e.showMinute,a=e.showSecond,i=e.showMillisecond,u=e.use12Hours,c=e.changeOnScroll,d=Pr(),h=d.prefixCls,g=d.values,f=d.generateConfig,p=d.locale,S=d.onSelect,P=d.onHover,D=P===void 0?function(){}:P,R=d.pickerValue,b=(g==null?void 0:g[0])||null,N=s.useContext(Sn),A=N.onCellDblClick,T=ca(f,e,b),E=ce(T,5),V=E[0],W=E[1],Y=E[2],K=E[3],Q=E[4],w=function(De){var Oe=b&&f[De](b),qe=R&&f[De](R);return[Oe,qe]},k=w("getHour"),$=ce(k,2),q=$[0],F=$[1],x=w("getMinute"),C=ce(x,2),U=C[0],y=C[1],H=w("getSecond"),B=ce(H,2),O=B[0],L=B[1],Z=w("getMillisecond"),I=ce(Z,2),oe=I[0],se=I[1],X=q===null?null:gn(q)?"am":"pm",de=s.useMemo(function(){return u?gn(q)?W.filter(function(ue){return gn(ue.value)}):W.filter(function(ue){return!gn(ue.value)}):W},[q,W,u]),ne=function(De,Oe){var qe,Ye=De.filter(function(ft){return!ft.disabled});return Oe??(Ye==null||(qe=Ye[0])===null||qe===void 0?void 0:qe.value)},re=ne(W,q),ae=s.useMemo(function(){return Y(re)},[Y,re]),we=ne(ae,U),Ce=s.useMemo(function(){return K(re,we)},[K,re,we]),fe=ne(Ce,O),be=s.useMemo(function(){return Q(re,we,fe)},[Q,re,we,fe]),me=ne(be,oe),je=s.useMemo(function(){if(!u)return[];var ue=f.getNow(),De=f.setHour(ue,6),Oe=f.setHour(ue,18),qe=function(ft,Dt){var Et=p.cellMeridiemFormat;return Et?wt(ft,{generateConfig:f,locale:p,format:Et}):Dt};return[{label:qe(De,"AM"),value:"am",disabled:W.every(function(Ye){return Ye.disabled||!gn(Ye.value)})},{label:qe(Oe,"PM"),value:"pm",disabled:W.every(function(Ye){return Ye.disabled||gn(Ye.value)})}]},[W,u,f,p]),Ie=function(De){var Oe=V(De);S(Oe)},Be=s.useMemo(function(){var ue=b||R||f.getNow(),De=function(qe){return qe!=null};return De(q)?(ue=f.setHour(ue,q),ue=f.setMinute(ue,U),ue=f.setSecond(ue,O),ue=f.setMillisecond(ue,oe)):De(F)?(ue=f.setHour(ue,F),ue=f.setMinute(ue,y),ue=f.setSecond(ue,L),ue=f.setMillisecond(ue,se)):De(re)&&(ue=f.setHour(ue,re),ue=f.setMinute(ue,we),ue=f.setSecond(ue,fe),ue=f.setMillisecond(ue,me)),ue},[b,R,q,U,O,oe,re,we,fe,me,F,y,L,se,f]),Ue=function(De,Oe){return De===null?null:f[Oe](Be,De)},ke=function(De){return Ue(De,"setHour")},Ve=function(De){return Ue(De,"setMinute")},lt=function(De){return Ue(De,"setSecond")},mt=function(De){return Ue(De,"setMillisecond")},G=function(De){return De===null?null:De==="am"&&!gn(q)?f.setHour(Be,q-12):De==="pm"&&gn(q)?f.setHour(Be,q+12):Be},$e=function(De){Ie(ke(De))},it=function(De){Ie(Ve(De))},Fe=function(De){Ie(lt(De))},tt=function(De){Ie(mt(De))},le=function(De){Ie(G(De))},Ge=function(De){D(ke(De))},Te=function(De){D(Ve(De))},Xe=function(De){D(lt(De))},Se=function(De){D(mt(De))},m=function(De){D(G(De))},Ne={onDblClick:A,changeOnScroll:c};return s.createElement("div",{className:"".concat(h,"-content")},t&&s.createElement(Vn,ot({units:de,value:q,optionalValue:F,type:"hour",onChange:$e,onHover:Ge},Ne)),r&&s.createElement(Vn,ot({units:ae,value:U,optionalValue:y,type:"minute",onChange:it,onHover:Te},Ne)),a&&s.createElement(Vn,ot({units:Ce,value:O,optionalValue:L,type:"second",onChange:Fe,onHover:Xe},Ne)),i&&s.createElement(Vn,ot({units:be,value:oe,optionalValue:se,type:"millisecond",onChange:tt,onHover:Se},Ne)),u&&s.createElement(Vn,ot({units:je,value:X,type:"meridiem",onChange:le,onHover:m},Ne)))}function qi(e){var t=e.prefixCls,r=e.value,a=e.locale,i=e.generateConfig,u=e.showTime,c=u||{},d=c.format,h="".concat(t,"-time-panel"),g=zn(e,"time"),f=ce(g,1),p=f[0];return s.createElement($n.Provider,{value:p},s.createElement("div",{className:gt(h)},s.createElement(Yn,null,r?wt(r,{locale:a,format:d,generateConfig:i}):" "),s.createElement(Wo,u)))}function Ko(e){var t=e.prefixCls,r=e.generateConfig,a=e.showTime,i=e.onSelect,u=e.value,c=e.pickerValue,d=e.onHover,h="".concat(t,"-datetime-panel"),g=ca(r,a),f=ce(g,1),p=f[0],S=function(b){return u?Dr(r,b,u):Dr(r,b,c)},P=function(b){d==null||d(b&&S(b))},D=function(b){var N=S(b);i(p(N,N))};return s.createElement("div",{className:h},s.createElement(wr,ot({},e,{onSelect:D,onHover:P})),s.createElement(qi,e))}function Vo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d="".concat(t,"-decade-panel"),h=zn(e,"decade"),g=ce(h,1),f=g[0],p=function(W){var Y=Math.floor(a.getYear(W)/100)*100;return a.setYear(W,Y)},S=function(W){var Y=p(W);return a.addYear(Y,99)},P=p(i),D=S(i),R=a.addYear(P,-10),b=function(W,Y){return a.addYear(W,Y*10)},N=function(W){var Y=r.cellYearFormat,K=wt(W,{locale:r,format:Y,generateConfig:a}),Q=wt(a.addYear(W,9),{locale:r,format:Y,generateConfig:a});return"".concat(K,"-").concat(Q)},A=function(W){return et({},"".concat(t,"-cell-in-view"),Xr(a,W,P)||Xr(a,W,D)||kr(a,P,D,W))},T=u?function(V,W){var Y=a.setDate(V,1),K=a.setMonth(Y,0),Q=a.setYear(K,Math.floor(a.getYear(K)/10)*10),w=a.addYear(Q,10),k=a.addDate(w,-1);return u(Q,W)&&u(k,W)}:null,E="".concat(wt(P,{locale:r,format:r.yearFormat,generateConfig:a}),"-").concat(wt(D,{locale:r,format:r.yearFormat,generateConfig:a}));return s.createElement($n.Provider,{value:f},s.createElement("div",{className:d},s.createElement(Yn,{superOffset:function(W){return a.addYear(i,W*100)},onChange:c,getStart:p,getEnd:S},E),s.createElement(or,ot({},e,{disabledDate:T,colNum:3,rowNum:4,baseDate:R,getCellDate:b,getCellText:N,getCellClassName:A}))))}function qo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d=e.onModeChange,h="".concat(t,"-month-panel"),g=zn(e,"month"),f=ce(g,1),p=f[0],S=a.setMonth(i,0),P=r.shortMonths||(a.locale.getShortMonths?a.locale.getShortMonths(r.locale):[]),D=function(E,V){return a.addMonth(E,V)},R=function(E){var V=a.getMonth(E);return r.monthFormat?wt(E,{locale:r,format:r.monthFormat,generateConfig:a}):P[V]},b=function(){return et({},"".concat(t,"-cell-in-view"),!0)},N=u?function(T,E){var V=a.setDate(T,1),W=a.setMonth(V,a.getMonth(V)+1),Y=a.addDate(W,-1);return u(V,E)&&u(Y,E)}:null,A=s.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){d("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(i,{locale:r,format:r.yearFormat,generateConfig:a}));return s.createElement($n.Provider,{value:p},s.createElement("div",{className:h},s.createElement(Yn,{superOffset:function(E){return a.addYear(i,E)},onChange:c,getStart:function(E){return a.setMonth(E,0)},getEnd:function(E){return a.setMonth(E,11)}},A),s.createElement(or,ot({},e,{disabledDate:N,titleFormat:r.fieldMonthFormat,colNum:3,rowNum:4,baseDate:S,getCellDate:D,getCellText:R,getCellClassName:b}))))}function Zo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.onPickerValueChange,c=e.onModeChange,d="".concat(t,"-quarter-panel"),h=zn(e,"quarter"),g=ce(h,1),f=g[0],p=a.setMonth(i,0),S=function(N,A){return a.addMonth(N,A*3)},P=function(N){return wt(N,{locale:r,format:r.cellQuarterFormat,generateConfig:a})},D=function(){return et({},"".concat(t,"-cell-in-view"),!0)},R=s.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){c("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(i,{locale:r,format:r.yearFormat,generateConfig:a}));return s.createElement($n.Provider,{value:f},s.createElement("div",{className:d},s.createElement(Yn,{superOffset:function(N){return a.addYear(i,N)},onChange:u,getStart:function(N){return a.setMonth(N,0)},getEnd:function(N){return a.setMonth(N,11)}},R),s.createElement(or,ot({},e,{titleFormat:r.fieldQuarterFormat,colNum:4,rowNum:1,baseDate:p,getCellDate:S,getCellText:P,getCellClassName:D}))))}function Go(e){var t=e.prefixCls,r=e.generateConfig,a=e.locale,i=e.value,u=e.hoverValue,c=e.hoverRangeValue,d=a.locale,h="".concat(t,"-week-panel-row"),g=function(p){var S={};if(c){var P=ce(c,2),D=P[0],R=P[1],b=Xn(r,d,D,p),N=Xn(r,d,R,p);S["".concat(h,"-range-start")]=b,S["".concat(h,"-range-end")]=N,S["".concat(h,"-range-hover")]=!b&&!N&&kr(r,D,R,p)}return u&&(S["".concat(h,"-hover")]=u.some(function(A){return Xn(r,d,p,A)})),gt(h,et({},"".concat(h,"-selected"),!c&&Xn(r,d,i,p)),S)};return s.createElement(wr,ot({},e,{mode:"week",panelName:"week",rowClassName:g}))}function Xo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d=e.onModeChange,h="".concat(t,"-year-panel"),g=zn(e,"year"),f=ce(g,1),p=f[0],S=function(Y){var K=Math.floor(a.getYear(Y)/10)*10;return a.setYear(Y,K)},P=function(Y){var K=S(Y);return a.addYear(K,9)},D=S(i),R=P(i),b=a.addYear(D,-1),N=function(Y,K){return a.addYear(Y,K)},A=function(Y){return wt(Y,{locale:r,format:r.cellYearFormat,generateConfig:a})},T=function(Y){return et({},"".concat(t,"-cell-in-view"),Nn(a,Y,D)||Nn(a,Y,R)||kr(a,D,R,Y))},E=u?function(W,Y){var K=a.setMonth(W,0),Q=a.setDate(K,1),w=a.addYear(Q,1),k=a.addDate(w,-1);return u(Q,Y)&&u(k,Y)}:null,V=s.createElement("button",{type:"button",key:"decade","aria-label":r.decadeSelect,onClick:function(){d("decade")},tabIndex:-1,className:"".concat(t,"-decade-btn")},wt(D,{locale:r,format:r.yearFormat,generateConfig:a}),"-",wt(R,{locale:r,format:r.yearFormat,generateConfig:a}));return s.createElement($n.Provider,{value:p},s.createElement("div",{className:h},s.createElement(Yn,{superOffset:function(Y){return a.addYear(i,Y*10)},onChange:c,getStart:S,getEnd:P},V),s.createElement(or,ot({},e,{disabledDate:E,titleFormat:r.fieldYearFormat,colNum:3,rowNum:4,baseDate:b,getCellDate:N,getCellText:A,getCellClassName:T}))))}var Qo={date:wr,datetime:Ko,week:Go,month:qo,quarter:Zo,year:Xo,decade:Vo,time:qi};function Jo(e,t){var r,a=e.locale,i=e.generateConfig,u=e.direction,c=e.prefixCls,d=e.tabIndex,h=d===void 0?0:d,g=e.multiple,f=e.defaultValue,p=e.value,S=e.onChange,P=e.onSelect,D=e.defaultPickerValue,R=e.pickerValue,b=e.onPickerValueChange,N=e.mode,A=e.onPanelChange,T=e.picker,E=T===void 0?"date":T,V=e.showTime,W=e.hoverValue,Y=e.hoverRangeValue,K=e.cellRender,Q=e.dateRender,w=e.monthCellRender,k=e.components,$=k===void 0?{}:k,q=e.hideHeader,F=((r=s.useContext(tn))===null||r===void 0?void 0:r.prefixCls)||c||"rc-picker",x=s.useRef();s.useImperativeHandle(t,function(){return{nativeElement:x.current}});var C=Ei(e),U=ce(C,4),y=U[0],H=U[1],B=U[2],O=U[3],L=ji(a,H),Z=E==="date"&&V?"datetime":E,I=s.useMemo(function(){return Ti(Z,B,O,y,L)},[Z,B,O,y,L]),oe=i.getNow(),se=mn(E,{value:N,postState:function(m){return m||"date"}}),X=ce(se,2),de=X[0],ne=X[1],re=de==="date"&&I?"datetime":de,ae=Vi(i,a,Z),we=mn(f,{value:p}),Ce=ce(we,2),fe=Ce[0],be=Ce[1],me=s.useMemo(function(){var Se=Rn(fe).filter(function(m){return m});return g?Se:Se.slice(0,1)},[fe,g]),je=Ot(function(Se){be(Se),S&&(Se===null||me.length!==Se.length||me.some(function(m,Ne){return!Lt(i,a,m,Se[Ne],Z)}))&&(S==null||S(g?Se:Se[0]))}),Ie=Ot(function(Se){if(P==null||P(Se),de===E){var m=g?ae(me,Se):[Se];je(m)}}),Be=mn(D||me[0]||oe,{value:R}),Ue=ce(Be,2),ke=Ue[0],Ve=Ue[1];s.useEffect(function(){me[0]&&!R&&Ve(me[0])},[me[0]]);var lt=function(m,Ne){A==null||A(m||R,Ne||de)},mt=function(m){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;Ve(m),b==null||b(m),Ne&&lt(m)},G=function(m,Ne){ne(m),Ne&&mt(Ne),lt(Ne,m)},$e=function(m){if(Ie(m),mt(m),de!==E){var Ne=["decade","year"],ue=[].concat(Ne,["month"]),De={quarter:[].concat(Ne,["quarter"]),week:[].concat(Ut(ue),["week"]),date:[].concat(Ut(ue),["date"])},Oe=De[E]||ue,qe=Oe.indexOf(de),Ye=Oe[qe+1];Ye&&G(Ye,m)}},it=s.useMemo(function(){var Se,m;if(Array.isArray(Y)){var Ne=ce(Y,2);Se=Ne[0],m=Ne[1]}else Se=Y;return!Se&&!m?null:(Se=Se||m,m=m||Se,i.isAfter(Se,m)?[m,Se]:[Se,m])},[Y,i]),Fe=sa(K,Q,w),tt=$[re]||Qo[re]||wr,le=s.useContext(Sn),Ge=s.useMemo(function(){return Le(Le({},le),{},{hideHeader:q})},[le,q]),Te="".concat(F,"-panel"),Xe=Mr(e,["showWeek","prevIcon","nextIcon","superPrevIcon","superNextIcon","disabledDate","minDate","maxDate","onHover"]);return s.createElement(Sn.Provider,{value:Ge},s.createElement("div",{ref:x,tabIndex:h,className:gt(Te,et({},"".concat(Te,"-rtl"),u==="rtl"))},s.createElement(tt,ot({},Xe,{showTime:I,prefixCls:F,locale:L,generateConfig:i,onModeChange:G,pickerValue:ke,onPickerValueChange:function(m){mt(m,!0)},value:me[0],onSelect:$e,values:me,cellRender:Fe,hoverRangeValue:it,hoverValue:W}))))}var Ar=s.memo(s.forwardRef(Jo));function el(e){var t=e.picker,r=e.multiplePanel,a=e.pickerValue,i=e.onPickerValueChange,u=e.needConfirm,c=e.onSubmit,d=e.range,h=e.hoverValue,g=s.useContext(tn),f=g.prefixCls,p=g.generateConfig,S=s.useCallback(function(A,T){return Qn(p,t,A,T)},[p,t]),P=s.useMemo(function(){return S(a,1)},[a,S]),D=function(T){i(S(T,-1))},R={onCellDblClick:function(){u&&c()}},b=t==="time",N=Le(Le({},e),{},{hoverValue:null,hoverRangeValue:null,hideHeader:b});return d?N.hoverRangeValue=h:N.hoverValue=h,r?s.createElement("div",{className:"".concat(f,"-panels")},s.createElement(Sn.Provider,{value:Le(Le({},R),{},{hideNext:!0})},s.createElement(Ar,N)),s.createElement(Sn.Provider,{value:Le(Le({},R),{},{hidePrev:!0})},s.createElement(Ar,ot({},N,{pickerValue:P,onPickerValueChange:D})))):s.createElement(Sn.Provider,{value:Le({},R)},s.createElement(Ar,N))}function xa(e){return typeof e=="function"?e():e}function tl(e){var t=e.prefixCls,r=e.presets,a=e.onClick,i=e.onHover;return r.length?s.createElement("div",{className:"".concat(t,"-presets")},s.createElement("ul",null,r.map(function(u,c){var d=u.label,h=u.value;return s.createElement("li",{key:c,onClick:function(){a(xa(h))},onMouseEnter:function(){i(xa(h))},onMouseLeave:function(){i(null)}},d)}))):null}function Zi(e){var t=e.panelRender,r=e.internalMode,a=e.picker,i=e.showNow,u=e.range,c=e.multiple,d=e.activeInfo,h=d===void 0?[0,0,0]:d,g=e.presets,f=e.onPresetHover,p=e.onPresetSubmit,S=e.onFocus,P=e.onBlur,D=e.onPanelMouseDown,R=e.direction,b=e.value,N=e.onSelect,A=e.isInvalid,T=e.defaultOpenValue,E=e.onOk,V=e.onSubmit,W=s.useContext(tn),Y=W.prefixCls,K="".concat(Y,"-panel"),Q=R==="rtl",w=s.useRef(null),k=s.useRef(null),$=s.useState(0),q=ce($,2),F=q[0],x=q[1],C=s.useState(0),U=ce(C,2),y=U[0],H=U[1],B=s.useState(0),O=ce(B,2),L=O[0],Z=O[1],I=function($e){$e.width&&x($e.width)},oe=ce(h,3),se=oe[0],X=oe[1],de=oe[2],ne=s.useState(0),re=ce(ne,2),ae=re[0],we=re[1];s.useEffect(function(){we(10)},[se]),s.useEffect(function(){if(u&&k.current){var G,$e=((G=w.current)===null||G===void 0?void 0:G.offsetWidth)||0,it=k.current.getBoundingClientRect();if(!it.height||it.right<0){we(function(Ge){return Math.max(0,Ge-1)});return}var Fe=(Q?X-$e:se)-it.left;if(Z(Fe),F&&F<de){var tt=Q?it.right-(X-$e+F):se+$e-it.left-F,le=Math.max(0,tt);H(le)}else H(0)}},[ae,Q,F,se,X,de,u]);function Ce(G){return G.filter(function($e){return $e})}var fe=s.useMemo(function(){return Ce(Rn(b))},[b]),be=a==="time"&&!fe.length,me=s.useMemo(function(){return be?Ce([T]):fe},[be,fe,T]),je=be?T:fe,Ie=s.useMemo(function(){return me.length?me.some(function(G){return A(G)}):!0},[me,A]),Be=function(){be&&N(T),E(),V()},Ue=s.createElement("div",{className:"".concat(Y,"-panel-layout")},s.createElement(tl,{prefixCls:Y,presets:g,onClick:p,onHover:f}),s.createElement("div",null,s.createElement(el,ot({},e,{value:je})),s.createElement(_o,ot({},e,{showNow:c?!1:i,invalid:Ie,onSubmit:Be}))));t&&(Ue=t(Ue));var ke="".concat(K,"-container"),Ve="marginLeft",lt="marginRight",mt=s.createElement("div",{onMouseDown:D,tabIndex:-1,className:gt(ke,"".concat(Y,"-").concat(r,"-panel-container")),style:et(et({},Q?lt:Ve,y),Q?Ve:lt,"auto"),onFocus:S,onBlur:P},Ue);return u&&(mt=s.createElement("div",{onMouseDown:D,ref:k,className:gt("".concat(Y,"-range-wrapper"),"".concat(Y,"-").concat(a,"-range-wrapper"))},s.createElement("div",{ref:w,className:"".concat(Y,"-range-arrow"),style:{left:L}}),s.createElement(Ha,{onResize:I},mt))),mt}function Gi(e,t){var r=e.format,a=e.maskFormat,i=e.generateConfig,u=e.locale,c=e.preserveInvalidOnBlur,d=e.inputReadOnly,h=e.required,g=e["aria-required"],f=e.onSubmit,p=e.onFocus,S=e.onBlur,P=e.onInputChange,D=e.onInvalid,R=e.open,b=e.onOpenChange,N=e.onKeyDown,A=e.onChange,T=e.activeHelp,E=e.name,V=e.autoComplete,W=e.id,Y=e.value,K=e.invalid,Q=e.placeholder,w=e.disabled,k=e.activeIndex,$=e.allHelp,q=e.picker,F=function(L,Z){var I=i.locale.parse(u.locale,L,[Z]);return I&&i.isValidate(I)?I:null},x=r[0],C=s.useCallback(function(O){return wt(O,{locale:u,format:x,generateConfig:i})},[u,i,x]),U=s.useMemo(function(){return Y.map(C)},[Y,C]),y=s.useMemo(function(){var O=q==="time"?8:10,L=typeof x=="function"?x(i.getNow()).length:x.length;return Math.max(O,L)+2},[x,q,i]),H=function(L){for(var Z=0;Z<r.length;Z+=1){var I=r[Z];if(typeof I=="string"){var oe=F(L,I);if(oe)return oe}}return!1},B=function(L){function Z(se){return L!==void 0?se[L]:se}var I=ta(e,{aria:!0,data:!0}),oe=Le(Le({},I),{},{format:a,validateFormat:function(X){return!!H(X)},preserveInvalidOnBlur:c,readOnly:d,required:h,"aria-required":g,name:E,autoComplete:V,size:y,id:Z(W),value:Z(U)||"",invalid:Z(K),placeholder:Z(Q),active:k===L,helped:$||T&&k===L,disabled:Z(w),onFocus:function(X){p(X,L)},onBlur:function(X){S(X,L)},onSubmit:f,onChange:function(X){P();var de=H(X);if(de){D(!1,L),A(de,L);return}D(!!X,L)},onHelp:function(){b(!0,{index:L})},onKeyDown:function(X){var de=!1;if(N==null||N(X,function(){de=!0}),!X.defaultPrevented&&!de)switch(X.key){case"Escape":b(!1,{index:L});break;case"Enter":R||b(!0);break}}},t==null?void 0:t({valueTexts:U}));return Object.keys(oe).forEach(function(se){oe[se]===void 0&&delete oe[se]}),oe};return[B,C]}var nl=["onMouseEnter","onMouseLeave"];function Xi(e){return s.useMemo(function(){return Mr(e,nl)},[e])}var rl=["icon","type"],al=["onClear"];function jr(e){var t=e.icon,r=e.type,a=Bn(e,rl),i=s.useContext(tn),u=i.prefixCls;return t?s.createElement("span",ot({className:"".concat(u,"-").concat(r)},a),t):null}function Qr(e){var t=e.onClear,r=Bn(e,al);return s.createElement(jr,ot({},r,{type:"clear",role:"button",onMouseDown:function(i){i.preventDefault()},onClick:function(i){i.stopPropagation(),t()}}))}var Lr=["YYYY","MM","DD","HH","mm","ss","SSS"],Ca="顧",il=function(){function e(t){ys(this,e),et(this,"format",void 0),et(this,"maskFormat",void 0),et(this,"cells",void 0),et(this,"maskCells",void 0),this.format=t;var r=Lr.map(function(d){return"(".concat(d,")")}).join("|"),a=new RegExp(r,"g");this.maskFormat=t.replace(a,function(d){return Ca.repeat(d.length)});var i=new RegExp("(".concat(Lr.join("|"),")")),u=(t.split(i)||[]).filter(function(d){return d}),c=0;this.cells=u.map(function(d){var h=Lr.includes(d),g=c,f=c+d.length;return c=f,{text:d,mask:h,start:g,end:f}}),this.maskCells=this.cells.filter(function(d){return d.mask})}return vs(e,[{key:"getSelection",value:function(r){var a=this.maskCells[r]||{},i=a.start,u=a.end;return[i||0,u||0]}},{key:"match",value:function(r){for(var a=0;a<this.maskFormat.length;a+=1){var i=this.maskFormat[a],u=r[a];if(!u||i!==Ca&&i!==u)return!1}return!0}},{key:"size",value:function(){return this.maskCells.length}},{key:"getMaskCellIndex",value:function(r){for(var a=Number.MAX_SAFE_INTEGER,i=0,u=0;u<this.maskCells.length;u+=1){var c=this.maskCells[u],d=c.start,h=c.end;if(r>=d&&r<=h)return u;var g=Math.min(Math.abs(r-d),Math.abs(r-h));g<a&&(a=g,i=u)}return i}}]),e}();function sl(e){var t={YYYY:[0,9999,new Date().getFullYear()],MM:[1,12],DD:[1,31],HH:[0,23],mm:[0,59],ss:[0,59],SSS:[0,999]};return t[e]}var ol=["active","showActiveCls","suffixIcon","format","validateFormat","onChange","onInput","helped","onHelp","onSubmit","onKeyDown","preserveInvalidOnBlur","invalid","clearIcon"],Jr=s.forwardRef(function(e,t){var r=e.active,a=e.showActiveCls,i=a===void 0?!0:a,u=e.suffixIcon,c=e.format,d=e.validateFormat,h=e.onChange;e.onInput;var g=e.helped,f=e.onHelp,p=e.onSubmit,S=e.onKeyDown,P=e.preserveInvalidOnBlur,D=P===void 0?!1:P,R=e.invalid,b=e.clearIcon,N=Bn(e,ol),A=e.value,T=e.onFocus,E=e.onBlur,V=e.onMouseUp,W=s.useContext(tn),Y=W.prefixCls,K=W.input,Q=K===void 0?"input":K,w="".concat(Y,"-input"),k=s.useState(!1),$=ce(k,2),q=$[0],F=$[1],x=s.useState(A),C=ce(x,2),U=C[0],y=C[1],H=s.useState(""),B=ce(H,2),O=B[0],L=B[1],Z=s.useState(null),I=ce(Z,2),oe=I[0],se=I[1],X=s.useState(null),de=ce(X,2),ne=de[0],re=de[1],ae=U||"";s.useEffect(function(){y(A)},[A]);var we=s.useRef(),Ce=s.useRef();s.useImperativeHandle(t,function(){return{nativeElement:we.current,inputElement:Ce.current,focus:function(Se){Ce.current.focus(Se)},blur:function(){Ce.current.blur()}}});var fe=s.useMemo(function(){return new il(c||"")},[c]),be=s.useMemo(function(){return g?[0,0]:fe.getSelection(oe)},[fe,oe,g]),me=ce(be,2),je=me[0],Ie=me[1],Be=function(Se){Se&&Se!==c&&Se!==A&&f()},Ue=Ot(function(Xe){d(Xe)&&h(Xe),y(Xe),Be(Xe)}),ke=function(Se){if(!c){var m=Se.target.value;Be(m),y(m),h(m)}},Ve=function(Se){var m=Se.clipboardData.getData("text");d(m)&&Ue(m)},lt=s.useRef(!1),mt=function(){lt.current=!0},G=function(Se){var m=Se.target,Ne=m.selectionStart,ue=fe.getMaskCellIndex(Ne);se(ue),re({}),V==null||V(Se),lt.current=!1},$e=function(Se){F(!0),se(0),L(""),T(Se)},it=function(Se){E(Se)},Fe=function(Se){F(!1),it(Se)};ua(r,function(){!r&&!D&&y(A)});var tt=function(Se){Se.key==="Enter"&&d(ae)&&p(),S==null||S(Se)},le=function(Se){tt(Se);var m=Se.key,Ne=null,ue=null,De=Ie-je,Oe=c.slice(je,Ie),qe=function(Et){se(function(nt){var ht=nt+Et;return ht=Math.max(ht,0),ht=Math.min(ht,fe.size()-1),ht})},Ye=function(Et){var nt=sl(Oe),ht=ce(nt,3),Ft=ht[0],At=ht[1],Yt=ht[2],Gt=ae.slice(je,Ie),dt=Number(Gt);if(isNaN(dt))return String(Yt||(Et>0?Ft:At));var _t=dt+Et,Ht=At-Ft+1;return String(Ft+(Ht+_t-Ft)%Ht)};switch(m){case"Backspace":case"Delete":Ne="",ue=Oe;break;case"ArrowLeft":Ne="",qe(-1);break;case"ArrowRight":Ne="",qe(1);break;case"ArrowUp":Ne="",ue=Ye(1);break;case"ArrowDown":Ne="",ue=Ye(-1);break;default:isNaN(Number(m))||(Ne=O+m,ue=Ne);break}if(Ne!==null&&(L(Ne),Ne.length>=De&&(qe(1),L(""))),ue!==null){var ft=ae.slice(0,je)+ia(ue,De)+ae.slice(Ie);Ue(ft.slice(0,c.length))}re({})},Ge=s.useRef();Dn(function(){if(!(!q||!c||lt.current)){if(!fe.match(ae)){Ue(c);return}return Ce.current.setSelectionRange(je,Ie),Ge.current=fn(function(){Ce.current.setSelectionRange(je,Ie)}),function(){fn.cancel(Ge.current)}}},[fe,c,q,ae,oe,je,Ie,ne,Ue]);var Te=c?{onFocus:$e,onBlur:Fe,onKeyDown:le,onMouseDown:mt,onMouseUp:G,onPaste:Ve}:{};return s.createElement("div",{ref:we,className:gt(w,et(et({},"".concat(w,"-active"),r&&i),"".concat(w,"-placeholder"),g))},s.createElement(Q,ot({ref:Ce,"aria-invalid":R,autoComplete:"off"},N,{onKeyDown:tt,onBlur:it},Te,{value:ae,onChange:ke})),s.createElement(jr,{type:"suffix",icon:u}),b)}),ll=["id","prefix","clearIcon","suffixIcon","separator","activeIndex","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","value","onChange","onSubmit","onInputChange","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onActiveInfo","placement","onMouseDown","required","aria-required","autoFocus","tabIndex"],ul=["index"];function cl(e,t){var r=e.id,a=e.prefix,i=e.clearIcon,u=e.suffixIcon,c=e.separator,d=c===void 0?"~":c,h=e.activeIndex;e.activeHelp,e.allHelp;var g=e.focused;e.onFocus,e.onBlur,e.onKeyDown,e.locale,e.generateConfig;var f=e.placeholder,p=e.className,S=e.style,P=e.onClick,D=e.onClear,R=e.value;e.onChange,e.onSubmit,e.onInputChange,e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var b=e.disabled,N=e.invalid;e.inputReadOnly;var A=e.direction;e.onOpenChange;var T=e.onActiveInfo;e.placement;var E=e.onMouseDown;e.required,e["aria-required"];var V=e.autoFocus,W=e.tabIndex,Y=Bn(e,ll),K=A==="rtl",Q=s.useContext(tn),w=Q.prefixCls,k=s.useMemo(function(){if(typeof r=="string")return[r];var ne=r||{};return[ne.start,ne.end]},[r]),$=s.useRef(),q=s.useRef(),F=s.useRef(),x=function(re){var ae;return(ae=[q,F][re])===null||ae===void 0?void 0:ae.current};s.useImperativeHandle(t,function(){return{nativeElement:$.current,focus:function(re){if(sr(re)==="object"){var ae,we=re||{},Ce=we.index,fe=Ce===void 0?0:Ce,be=Bn(we,ul);(ae=x(fe))===null||ae===void 0||ae.focus(be)}else{var me;(me=x(re??0))===null||me===void 0||me.focus()}},blur:function(){var re,ae;(re=x(0))===null||re===void 0||re.blur(),(ae=x(1))===null||ae===void 0||ae.blur()}}});var C=Xi(Y),U=s.useMemo(function(){return Array.isArray(f)?f:[f,f]},[f]),y=Gi(Le(Le({},e),{},{id:k,placeholder:U})),H=ce(y,1),B=H[0],O=s.useState({position:"absolute",width:0}),L=ce(O,2),Z=L[0],I=L[1],oe=Ot(function(){var ne=x(h);if(ne){var re=ne.nativeElement.getBoundingClientRect(),ae=$.current.getBoundingClientRect(),we=re.left-ae.left;I(function(Ce){return Le(Le({},Ce),{},{width:re.width,left:we})}),T([re.left,re.right,ae.width])}});s.useEffect(function(){oe()},[h]);var se=i&&(R[0]&&!b[0]||R[1]&&!b[1]),X=V&&!b[0],de=V&&!X&&!b[1];return s.createElement(Ha,{onResize:oe},s.createElement("div",ot({},C,{className:gt(w,"".concat(w,"-range"),et(et(et(et({},"".concat(w,"-focused"),g),"".concat(w,"-disabled"),b.every(function(ne){return ne})),"".concat(w,"-invalid"),N.some(function(ne){return ne})),"".concat(w,"-rtl"),K),p),style:S,ref:$,onClick:P,onMouseDown:function(re){var ae=re.target;ae!==q.current.inputElement&&ae!==F.current.inputElement&&re.preventDefault(),E==null||E(re)}}),a&&s.createElement("div",{className:"".concat(w,"-prefix")},a),s.createElement(Jr,ot({ref:q},B(0),{autoFocus:X,tabIndex:W,"date-range":"start"})),s.createElement("div",{className:"".concat(w,"-range-separator")},d),s.createElement(Jr,ot({ref:F},B(1),{autoFocus:de,tabIndex:W,"date-range":"end"})),s.createElement("div",{className:"".concat(w,"-active-bar"),style:Z}),s.createElement(jr,{type:"suffix",icon:u}),se&&s.createElement(Qr,{icon:i,onClear:D})))}var dl=s.forwardRef(cl);function Ma(e,t){var r=e??t;return Array.isArray(r)?r:[r,r]}function hr(e){return e===1?"end":"start"}function ml(e,t){var r=Oi(e,function(){var at=e.disabled,He=e.allowEmpty,Ze=Ma(at,!1),St=Ma(He,!1);return{disabled:Ze,allowEmpty:St}}),a=ce(r,6),i=a[0],u=a[1],c=a[2],d=a[3],h=a[4],g=a[5],f=i.prefixCls,p=i.styles,S=i.classNames,P=i.defaultValue,D=i.value,R=i.needConfirm,b=i.onKeyDown,N=i.disabled,A=i.allowEmpty,T=i.disabledDate,E=i.minDate,V=i.maxDate,W=i.defaultOpen,Y=i.open,K=i.onOpenChange,Q=i.locale,w=i.generateConfig,k=i.picker,$=i.showNow,q=i.showToday,F=i.showTime,x=i.mode,C=i.onPanelChange,U=i.onCalendarChange,y=i.onOk,H=i.defaultPickerValue,B=i.pickerValue,O=i.onPickerValueChange,L=i.inputReadOnly,Z=i.suffixIcon,I=i.onFocus,oe=i.onBlur,se=i.presets,X=i.ranges,de=i.components,ne=i.cellRender,re=i.dateRender,ae=i.monthCellRender,we=i.onClick,Ce=Ai(t),fe=Fi(Y,W,N,K),be=ce(fe,2),me=be[0],je=be[1],Ie=function(He,Ze){(N.some(function(St){return!St})||!He)&&je(He,Ze)},Be=Yi(w,Q,d,!0,!1,P,D,U,y),Ue=ce(Be,5),ke=Ue[0],Ve=Ue[1],lt=Ue[2],mt=Ue[3],G=Ue[4],$e=lt(),it=Ui(N,A,me),Fe=ce(it,9),tt=Fe[0],le=Fe[1],Ge=Fe[2],Te=Fe[3],Xe=Fe[4],Se=Fe[5],m=Fe[6],Ne=Fe[7],ue=Fe[8],De=function(He,Ze){le(!0),I==null||I(He,{range:hr(Ze??Te)})},Oe=function(He,Ze){le(!1),oe==null||oe(He,{range:hr(Ze??Te)})},qe=s.useMemo(function(){if(!F)return null;var at=F.disabledTime,He=at?function(Ze){var St=hr(Te),Tt=Mi($e,m,Te);return at(Ze,St,{from:Tt})}:void 0;return Le(Le({},F),{},{disabledTime:He})},[F,Te,$e,m]),Ye=mn([k,k],{value:x}),ft=ce(Ye,2),Dt=ft[0],Et=ft[1],nt=Dt[Te]||k,ht=nt==="date"&&qe?"datetime":nt,Ft=ht===k&&ht!=="time",At=Ki(k,nt,$,q,!0),Yt=Wi(i,ke,Ve,lt,mt,N,d,tt,me,g),Gt=ce(Yt,2),dt=Gt[0],_t=Gt[1],Ht=Fo($e,N,m,w,Q,T),hn=Pi($e,g,A),on=ce(hn,2),nn=on[0],pn=on[1],ln=_i(w,Q,$e,Dt,me,Te,u,Ft,H,B,qe==null?void 0:qe.defaultOpenValue,O,E,V),l=ce(ln,2),_=l[0],j=l[1],ie=Ot(function(at,He,Ze){var St=nr(Dt,Te,He);if((St[0]!==Dt[0]||St[1]!==Dt[1])&&Et(St),C&&Ze!==!1){var Tt=Ut($e);at&&(Tt[Te]=at),C(Tt,St)}}),xe=function(He,Ze){return nr($e,Ze,He)},Me=function(He,Ze){var St=$e;He&&(St=xe(He,Te)),Ne(Te);var Tt=Se(St);mt(St),dt(Te,Tt===null),Tt===null?Ie(!1,{force:!0}):Ze||Ce.current.focus({index:Tt})},Ee=function(He){var Ze,St=He.target.getRootNode();if(!Ce.current.nativeElement.contains((Ze=St.activeElement)!==null&&Ze!==void 0?Ze:document.activeElement)){var Tt=N.findIndex(function(ms){return!ms});Tt>=0&&Ce.current.focus({index:Tt})}Ie(!0),we==null||we(He)},o=function(){_t(null),Ie(!1,{force:!0})},v=s.useState(null),z=ce(v,2),M=z[0],ee=z[1],he=s.useState(null),pe=ce(he,2),J=pe[0],ge=pe[1],Pe=s.useMemo(function(){return J||$e},[$e,J]);s.useEffect(function(){me||ge(null)},[me]);var te=s.useState([0,0,0]),ve=ce(te,2),_e=ve[0],Qe=ve[1],We=Li(se,X),ut=function(He){ge(He),ee("preset")},xt=function(He){var Ze=_t(He);Ze&&Ie(!1,{force:!0})},Qt=function(He){Me(He)},bt=function(He){ge(He?xe(He,Te):null),ee("cell")},Wt=function(He){Ie(!0),De(He)},ct=function(){Ge("panel")},Bt=function(He){var Ze=nr($e,Te,He);mt(Ze),!R&&!c&&u===ht&&Me(He)},rn=function(){Ie(!1)},Ir=sa(ne,re,ae,hr(Te)),Nr=$e[Te]||null,Er=Ot(function(at){return g(at,{activeIndex:Te})}),Ke=s.useMemo(function(){var at=ta(i,!1),He=Ba(i,[].concat(Ut(Object.keys(at)),["onChange","onCalendarChange","style","className","onPanelChange","disabledTime"]));return He},[i]),Ae=s.createElement(Zi,ot({},Ke,{showNow:At,showTime:qe,range:!0,multiplePanel:Ft,activeInfo:_e,disabledDate:Ht,onFocus:Wt,onBlur:Oe,onPanelMouseDown:ct,picker:k,mode:nt,internalMode:ht,onPanelChange:ie,format:h,value:Nr,isInvalid:Er,onChange:null,onSelect:Bt,pickerValue:_,defaultOpenValue:Rn(F==null?void 0:F.defaultOpenValue)[Te],onPickerValueChange:j,hoverValue:Pe,onHover:bt,needConfirm:R,onSubmit:Me,onOk:G,presets:We,onPresetHover:ut,onPresetSubmit:xt,onNow:Qt,cellRender:Ir})),Kt=function(He,Ze){var St=xe(He,Ze);mt(St)},an=function(){Ge("input")},lr=function(He,Ze){var St=m.length,Tt=m[St-1];if(St&&Tt!==Ze&&R&&!A[Tt]&&!ue(Tt)&&$e[Tt]){Ce.current.focus({index:Tt});return}Ge("input"),Ie(!0,{inherit:!0}),Te!==Ze&&me&&!R&&c&&Me(null,!0),Xe(Ze),De(He,Ze)},us=function(He,Ze){if(Ie(!1),!R&&Ge()==="input"){var St=Se($e);dt(Te,St===null)}Oe(He,Ze)},cs=function(He,Ze){He.key==="Tab"&&Me(null,!0),b==null||b(He,Ze)},ds=s.useMemo(function(){return{prefixCls:f,locale:Q,generateConfig:w,button:de.button,input:de.input}},[f,Q,w,de.button,de.input]);return Dn(function(){me&&Te!==void 0&&ie(null,k,!1)},[me,Te,k]),Dn(function(){var at=Ge();!me&&at==="input"&&(Ie(!1),Me(null,!0)),!me&&c&&!R&&at==="panel"&&(Ie(!0),Me())},[me]),s.createElement(tn.Provider,{value:ds},s.createElement(xi,ot({},ki(i),{popupElement:Ae,popupStyle:p.popup,popupClassName:S.popup,visible:me,onClose:rn,range:!0}),s.createElement(dl,ot({},i,{ref:Ce,suffixIcon:Z,activeIndex:tt||me?Te:null,activeHelp:!!J,allHelp:!!J&&M==="preset",focused:tt,onFocus:lr,onBlur:us,onKeyDown:cs,onSubmit:Me,value:Pe,maskFormat:h,onChange:Kt,onInputChange:an,format:d,inputReadOnly:L,disabled:N,open:me,onOpenChange:Ie,onClick:Ee,onClear:o,invalid:nn,onInvalid:pn,onActiveInfo:Qe}))))}var fl=s.forwardRef(ml);function hl(e){var t=e.prefixCls,r=e.value,a=e.onRemove,i=e.removeIcon,u=i===void 0?"×":i,c=e.formatDate,d=e.disabled,h=e.maxTagCount,g=e.placeholder,f="".concat(t,"-selector"),p="".concat(t,"-selection"),S="".concat(p,"-overflow");function P(b,N){return s.createElement("span",{className:gt("".concat(p,"-item")),title:typeof b=="string"?b:null},s.createElement("span",{className:"".concat(p,"-item-content")},b),!d&&N&&s.createElement("span",{onMouseDown:function(T){T.preventDefault()},onClick:N,className:"".concat(p,"-item-remove")},u))}function D(b){var N=c(b),A=function(E){E&&E.stopPropagation(),a(b)};return P(N,A)}function R(b){var N="+ ".concat(b.length," ...");return P(N)}return s.createElement("div",{className:f},s.createElement(bs,{prefixCls:S,data:r,renderItem:D,renderRest:R,itemKey:function(N){return c(N)},maxCount:h}),!r.length&&s.createElement("span",{className:"".concat(t,"-selection-placeholder")},g))}var pl=["id","open","prefix","clearIcon","suffixIcon","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","internalPicker","value","onChange","onSubmit","onInputChange","multiple","maxTagCount","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onMouseDown","required","aria-required","autoFocus","tabIndex","removeIcon"];function gl(e,t){e.id;var r=e.open,a=e.prefix,i=e.clearIcon,u=e.suffixIcon;e.activeHelp,e.allHelp;var c=e.focused;e.onFocus,e.onBlur,e.onKeyDown;var d=e.locale,h=e.generateConfig,g=e.placeholder,f=e.className,p=e.style,S=e.onClick,P=e.onClear,D=e.internalPicker,R=e.value,b=e.onChange,N=e.onSubmit;e.onInputChange;var A=e.multiple,T=e.maxTagCount;e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var E=e.disabled,V=e.invalid;e.inputReadOnly;var W=e.direction;e.onOpenChange;var Y=e.onMouseDown;e.required,e["aria-required"];var K=e.autoFocus,Q=e.tabIndex,w=e.removeIcon,k=Bn(e,pl),$=W==="rtl",q=s.useContext(tn),F=q.prefixCls,x=s.useRef(),C=s.useRef();s.useImperativeHandle(t,function(){return{nativeElement:x.current,focus:function(X){var de;(de=C.current)===null||de===void 0||de.focus(X)},blur:function(){var X;(X=C.current)===null||X===void 0||X.blur()}}});var U=Xi(k),y=function(X){b([X])},H=function(X){var de=R.filter(function(ne){return ne&&!Lt(h,d,ne,X,D)});b(de),r||N()},B=Gi(Le(Le({},e),{},{onChange:y}),function(se){var X=se.valueTexts;return{value:X[0]||"",active:c}}),O=ce(B,2),L=O[0],Z=O[1],I=!!(i&&R.length&&!E),oe=A?s.createElement(s.Fragment,null,s.createElement(hl,{prefixCls:F,value:R,onRemove:H,formatDate:Z,maxTagCount:T,disabled:E,removeIcon:w,placeholder:g}),s.createElement("input",{className:"".concat(F,"-multiple-input"),value:R.map(Z).join(","),ref:C,readOnly:!0,autoFocus:K,tabIndex:Q}),s.createElement(jr,{type:"suffix",icon:u}),I&&s.createElement(Qr,{icon:i,onClear:P})):s.createElement(Jr,ot({ref:C},L(),{autoFocus:K,tabIndex:Q,suffixIcon:u,clearIcon:I&&s.createElement(Qr,{icon:i,onClear:P}),showActiveCls:!1}));return s.createElement("div",ot({},U,{className:gt(F,et(et(et(et(et({},"".concat(F,"-multiple"),A),"".concat(F,"-focused"),c),"".concat(F,"-disabled"),E),"".concat(F,"-invalid"),V),"".concat(F,"-rtl"),$),f),style:p,ref:x,onClick:S,onMouseDown:function(X){var de,ne=X.target;ne!==((de=C.current)===null||de===void 0?void 0:de.inputElement)&&X.preventDefault(),Y==null||Y(X)}}),a&&s.createElement("div",{className:"".concat(F,"-prefix")},a),oe)}var vl=s.forwardRef(gl);function yl(e,t){var r=Oi(e),a=ce(r,6),i=a[0],u=a[1],c=a[2],d=a[3],h=a[4],g=a[5],f=i,p=f.prefixCls,S=f.styles,P=f.classNames,D=f.order,R=f.defaultValue,b=f.value,N=f.needConfirm,A=f.onChange,T=f.onKeyDown,E=f.disabled,V=f.disabledDate,W=f.minDate,Y=f.maxDate,K=f.defaultOpen,Q=f.open,w=f.onOpenChange,k=f.locale,$=f.generateConfig,q=f.picker,F=f.showNow,x=f.showToday,C=f.showTime,U=f.mode,y=f.onPanelChange,H=f.onCalendarChange,B=f.onOk,O=f.multiple,L=f.defaultPickerValue,Z=f.pickerValue,I=f.onPickerValueChange,oe=f.inputReadOnly,se=f.suffixIcon,X=f.removeIcon,de=f.onFocus,ne=f.onBlur,re=f.presets,ae=f.components,we=f.cellRender,Ce=f.dateRender,fe=f.monthCellRender,be=f.onClick,me=Ai(t);function je(Ke){return Ke===null?null:O?Ke:Ke[0]}var Ie=Vi($,k,u),Be=Fi(Q,K,[E],w),Ue=ce(Be,2),ke=Ue[0],Ve=Ue[1],lt=function(Ae,Kt,an){if(H){var lr=Le({},an);delete lr.range,H(je(Ae),je(Kt),lr)}},mt=function(Ae){B==null||B(je(Ae))},G=Yi($,k,d,!1,D,R,b,lt,mt),$e=ce(G,5),it=$e[0],Fe=$e[1],tt=$e[2],le=$e[3],Ge=$e[4],Te=tt(),Xe=Ui([E]),Se=ce(Xe,4),m=Se[0],Ne=Se[1],ue=Se[2],De=Se[3],Oe=function(Ae){Ne(!0),de==null||de(Ae,{})},qe=function(Ae){Ne(!1),ne==null||ne(Ae,{})},Ye=mn(q,{value:U}),ft=ce(Ye,2),Dt=ft[0],Et=ft[1],nt=Dt==="date"&&C?"datetime":Dt,ht=Ki(q,Dt,F,x),Ft=A&&function(Ke,Ae){A(je(Ke),je(Ae))},At=Wi(Le(Le({},i),{},{onChange:Ft}),it,Fe,tt,le,[],d,m,ke,g),Yt=ce(At,2),Gt=Yt[1],dt=Pi(Te,g),_t=ce(dt,2),Ht=_t[0],hn=_t[1],on=s.useMemo(function(){return Ht.some(function(Ke){return Ke})},[Ht]),nn=function(Ae,Kt){if(I){var an=Le(Le({},Kt),{},{mode:Kt.mode[0]});delete an.range,I(Ae[0],an)}},pn=_i($,k,Te,[Dt],ke,De,u,!1,L,Z,Rn(C==null?void 0:C.defaultOpenValue),nn,W,Y),ln=ce(pn,2),l=ln[0],_=ln[1],j=Ot(function(Ke,Ae,Kt){if(Et(Ae),y&&Kt!==!1){var an=Ke||Te[Te.length-1];y(an,Ae)}}),ie=function(){Gt(tt()),Ve(!1,{force:!0})},xe=function(Ae){!E&&!me.current.nativeElement.contains(document.activeElement)&&me.current.focus(),Ve(!0),be==null||be(Ae)},Me=function(){Gt(null),Ve(!1,{force:!0})},Ee=s.useState(null),o=ce(Ee,2),v=o[0],z=o[1],M=s.useState(null),ee=ce(M,2),he=ee[0],pe=ee[1],J=s.useMemo(function(){var Ke=[he].concat(Ut(Te)).filter(function(Ae){return Ae});return O?Ke:Ke.slice(0,1)},[Te,he,O]),ge=s.useMemo(function(){return!O&&he?[he]:Te.filter(function(Ke){return Ke})},[Te,he,O]);s.useEffect(function(){ke||pe(null)},[ke]);var Pe=Li(re),te=function(Ae){pe(Ae),z("preset")},ve=function(Ae){var Kt=O?Ie(tt(),Ae):[Ae],an=Gt(Kt);an&&!O&&Ve(!1,{force:!0})},_e=function(Ae){ve(Ae)},Qe=function(Ae){pe(Ae),z("cell")},We=function(Ae){Ve(!0),Oe(Ae)},ut=function(Ae){if(ue("panel"),!(O&&nt!==q)){var Kt=O?Ie(tt(),Ae):[Ae];le(Kt),!N&&!c&&u===nt&&ie()}},xt=function(){Ve(!1)},Qt=sa(we,Ce,fe),bt=s.useMemo(function(){var Ke=ta(i,!1),Ae=Ba(i,[].concat(Ut(Object.keys(Ke)),["onChange","onCalendarChange","style","className","onPanelChange"]));return Le(Le({},Ae),{},{multiple:i.multiple})},[i]),Wt=s.createElement(Zi,ot({},bt,{showNow:ht,showTime:C,disabledDate:V,onFocus:We,onBlur:qe,picker:q,mode:Dt,internalMode:nt,onPanelChange:j,format:h,value:Te,isInvalid:g,onChange:null,onSelect:ut,pickerValue:l,defaultOpenValue:C==null?void 0:C.defaultOpenValue,onPickerValueChange:_,hoverValue:J,onHover:Qe,needConfirm:N,onSubmit:ie,onOk:Ge,presets:Pe,onPresetHover:te,onPresetSubmit:ve,onNow:_e,cellRender:Qt})),ct=function(Ae){le(Ae)},Bt=function(){ue("input")},rn=function(Ae){ue("input"),Ve(!0,{inherit:!0}),Oe(Ae)},Ir=function(Ae){Ve(!1),qe(Ae)},Nr=function(Ae,Kt){Ae.key==="Tab"&&ie(),T==null||T(Ae,Kt)},Er=s.useMemo(function(){return{prefixCls:p,locale:k,generateConfig:$,button:ae.button,input:ae.input}},[p,k,$,ae.button,ae.input]);return Dn(function(){ke&&De!==void 0&&j(null,q,!1)},[ke,De,q]),Dn(function(){var Ke=ue();!ke&&Ke==="input"&&(Ve(!1),ie()),!ke&&c&&!N&&Ke==="panel"&&ie()},[ke]),s.createElement(tn.Provider,{value:Er},s.createElement(xi,ot({},ki(i),{popupElement:Wt,popupStyle:S.popup,popupClassName:P.popup,visible:ke,onClose:xt}),s.createElement(vl,ot({},i,{ref:me,suffixIcon:se,removeIcon:X,activeHelp:!!he,allHelp:!!he&&v==="preset",focused:m,onFocus:rn,onBlur:Ir,onKeyDown:Nr,onSubmit:ie,value:ge,maskFormat:h,onChange:ct,onInputChange:Bt,internalPicker:u,format:d,inputReadOnly:oe,disabled:E,open:ke,onOpenChange:Ve,onClick:xe,onClear:Me,invalid:on,onInvalid:function(Ae){hn(Ae,0)}}))))}var bl=s.forwardRef(yl);const Ur=(e,t)=>{const{componentCls:r,controlHeight:a}=e,i=t?`${r}-${t}`:"",u=Js(e);return[{[`${r}-multiple${i}`]:{paddingBlock:u.containerPadding,paddingInlineStart:u.basePadding,minHeight:a,[`${r}-selection-item`]:{height:u.itemHeight,lineHeight:rt(u.itemLineHeight)}}}]},Sl=e=>{const{componentCls:t,calc:r,lineWidth:a}=e,i=qr(e,{fontHeight:e.fontSize,selectHeight:e.controlHeightSM,multipleSelectItemHeight:e.multipleItemHeightSM,borderRadius:e.borderRadiusSM,borderRadiusSM:e.borderRadiusXS,controlHeight:e.controlHeightSM}),u=qr(e,{fontHeight:r(e.multipleItemHeightLG).sub(r(a).mul(2).equal()).equal(),fontSize:e.fontSizeLG,selectHeight:e.controlHeightLG,multipleSelectItemHeight:e.multipleItemHeightLG,borderRadius:e.borderRadiusLG,borderRadiusSM:e.borderRadius,controlHeight:e.controlHeightLG});return[Ur(i,"small"),Ur(e),Ur(u,"large"),{[`${t}${t}-multiple`]:Object.assign(Object.assign({width:"100%",cursor:"text",[`${t}-selector`]:{flex:"auto",padding:0,position:"relative","&:after":{margin:0},[`${t}-selection-placeholder`]:{position:"absolute",top:"50%",insetInlineStart:e.inputPaddingHorizontalBase,insetInlineEnd:0,transform:"translateY(-50%)",transition:`all ${e.motionDurationSlow}`,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flex:1,color:e.colorTextPlaceholder,pointerEvents:"none"}}},Qs(e)),{[`${t}-multiple-input`]:{width:0,height:0,border:0,visibility:"hidden",position:"absolute",zIndex:-1}})}]},Dl=e=>{const{pickerCellCls:t,pickerCellInnerCls:r,cellHeight:a,borderRadiusSM:i,motionDurationMid:u,cellHoverBg:c,lineWidth:d,lineType:h,colorPrimary:g,cellActiveWithRangeBg:f,colorTextLightSolid:p,colorTextDisabled:S,cellBgDisabled:P,colorFillSecondary:D}=e;return{"&::before":{position:"absolute",top:"50%",insetInlineStart:0,insetInlineEnd:0,zIndex:1,height:a,transform:"translateY(-50%)",content:'""',pointerEvents:"none"},[r]:{position:"relative",zIndex:2,display:"inline-block",minWidth:a,height:a,lineHeight:rt(a),borderRadius:i,transition:`background ${u}`},[`&:hover:not(${t}-in-view):not(${t}-disabled),
    &:hover:not(${t}-selected):not(${t}-range-start):not(${t}-range-end):not(${t}-disabled)`]:{[r]:{background:c}},[`&-in-view${t}-today ${r}`]:{"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:1,border:`${rt(d)} ${h} ${g}`,borderRadius:i,content:'""'}},[`&-in-view${t}-in-range,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{position:"relative",[`&:not(${t}-disabled):before`]:{background:f}},[`&-in-view${t}-selected,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{[`&:not(${t}-disabled) ${r}`]:{color:p,background:g},[`&${t}-disabled ${r}`]:{background:D}},[`&-in-view${t}-range-start:not(${t}-disabled):before`]:{insetInlineStart:"50%"},[`&-in-view${t}-range-end:not(${t}-disabled):before`]:{insetInlineEnd:"50%"},[`&-in-view${t}-range-start:not(${t}-range-end) ${r}`]:{borderStartStartRadius:i,borderEndStartRadius:i,borderStartEndRadius:0,borderEndEndRadius:0},[`&-in-view${t}-range-end:not(${t}-range-start) ${r}`]:{borderStartStartRadius:0,borderEndStartRadius:0,borderStartEndRadius:i,borderEndEndRadius:i},"&-disabled":{color:S,cursor:"not-allowed",[r]:{background:"transparent"},"&::before":{background:P}},[`&-disabled${t}-today ${r}::before`]:{borderColor:S}}},xl=e=>{const{componentCls:t,pickerCellCls:r,pickerCellInnerCls:a,pickerYearMonthCellWidth:i,pickerControlIconSize:u,cellWidth:c,paddingSM:d,paddingXS:h,paddingXXS:g,colorBgContainer:f,lineWidth:p,lineType:S,borderRadiusLG:P,colorPrimary:D,colorTextHeading:R,colorSplit:b,pickerControlIconBorderWidth:N,colorIcon:A,textHeight:T,motionDurationMid:E,colorIconHover:V,fontWeightStrong:W,cellHeight:Y,pickerCellPaddingVertical:K,colorTextDisabled:Q,colorText:w,fontSize:k,motionDurationSlow:$,withoutTimeCellHeight:q,pickerQuarterPanelContentHeight:F,borderRadiusSM:x,colorTextLightSolid:C,cellHoverBg:U,timeColumnHeight:y,timeColumnWidth:H,timeCellHeight:B,controlItemBgActive:O,marginXXS:L,pickerDatePanelPaddingHorizontal:Z,pickerControlIconMargin:I}=e,oe=e.calc(c).mul(7).add(e.calc(Z).mul(2)).equal();return{[t]:{"&-panel":{display:"inline-flex",flexDirection:"column",textAlign:"center",background:f,borderRadius:P,outline:"none","&-focused":{borderColor:D},"&-rtl":{[`${t}-prev-icon,
              ${t}-super-prev-icon`]:{transform:"rotate(45deg)"},[`${t}-next-icon,
              ${t}-super-next-icon`]:{transform:"rotate(-135deg)"},[`${t}-time-panel`]:{[`${t}-content`]:{direction:"ltr","> *":{direction:"rtl"}}}}},"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel,\n        &-week-panel,\n        &-date-panel,\n        &-time-panel":{display:"flex",flexDirection:"column",width:oe},"&-header":{display:"flex",padding:`0 ${rt(h)}`,color:R,borderBottom:`${rt(p)} ${S} ${b}`,"> *":{flex:"none"},button:{padding:0,color:A,lineHeight:rt(T),background:"transparent",border:0,cursor:"pointer",transition:`color ${E}`,fontSize:"inherit",display:"inline-flex",alignItems:"center",justifyContent:"center","&:empty":{display:"none"}},"> button":{minWidth:"1.6em",fontSize:k,"&:hover":{color:V},"&:disabled":{opacity:.25,pointerEvents:"none"}},"&-view":{flex:"auto",fontWeight:W,lineHeight:rt(T),"> button":{color:"inherit",fontWeight:"inherit",verticalAlign:"top","&:not(:first-child)":{marginInlineStart:h},"&:hover":{color:D}}}},"&-prev-icon,\n        &-next-icon,\n        &-super-prev-icon,\n        &-super-next-icon":{position:"relative",width:u,height:u,"&::before":{position:"absolute",top:0,insetInlineStart:0,width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:N,borderInlineStartWidth:N,content:'""'}},"&-super-prev-icon,\n        &-super-next-icon":{"&::after":{position:"absolute",top:I,insetInlineStart:I,display:"inline-block",width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:N,borderInlineStartWidth:N,content:'""'}},"&-prev-icon, &-super-prev-icon":{transform:"rotate(-45deg)"},"&-next-icon, &-super-next-icon":{transform:"rotate(135deg)"},"&-content":{width:"100%",tableLayout:"fixed",borderCollapse:"collapse","th, td":{position:"relative",minWidth:Y,fontWeight:"normal"},th:{height:e.calc(Y).add(e.calc(K).mul(2)).equal(),color:w,verticalAlign:"middle"}},"&-cell":Object.assign({padding:`${rt(K)} 0`,color:Q,cursor:"pointer","&-in-view":{color:w}},Dl(e)),"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-content`]:{height:e.calc(q).mul(4).equal()},[a]:{padding:`0 ${rt(h)}`}},"&-quarter-panel":{[`${t}-content`]:{height:F}},"&-decade-panel":{[a]:{padding:`0 ${rt(e.calc(h).div(2).equal())}`},[`${t}-cell::before`]:{display:"none"}},"&-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-body`]:{padding:`0 ${rt(h)}`},[a]:{width:i}},"&-date-panel":{[`${t}-body`]:{padding:`${rt(h)} ${rt(Z)}`},[`${t}-content th`]:{boxSizing:"border-box",padding:0}},"&-week-panel-row":{td:{"&:before":{transition:`background ${E}`},"&:first-child:before":{borderStartStartRadius:x,borderEndStartRadius:x},"&:last-child:before":{borderStartEndRadius:x,borderEndEndRadius:x}},"&:hover td:before":{background:U},"&-range-start td, &-range-end td, &-selected td, &-hover td":{[`&${r}`]:{"&:before":{background:D},[`&${t}-cell-week`]:{color:new Sr(C).setA(.5).toHexString()},[a]:{color:C}}},"&-range-hover td:before":{background:O}},"&-week-panel, &-date-panel-show-week":{[`${t}-body`]:{padding:`${rt(h)} ${rt(d)}`},[`${t}-content th`]:{width:"auto"}},"&-datetime-panel":{display:"flex",[`${t}-time-panel`]:{borderInlineStart:`${rt(p)} ${S} ${b}`},[`${t}-date-panel,
          ${t}-time-panel`]:{transition:`opacity ${$}`},"&-active":{[`${t}-date-panel,
            ${t}-time-panel`]:{opacity:.3,"&-active":{opacity:1}}}},"&-time-panel":{width:"auto",minWidth:"auto",[`${t}-content`]:{display:"flex",flex:"auto",height:y},"&-column":{flex:"1 0 auto",width:H,margin:`${rt(g)} 0`,padding:0,overflowY:"hidden",textAlign:"start",listStyle:"none",transition:`background ${E}`,overflowX:"hidden","&::-webkit-scrollbar":{width:8,backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:e.colorTextTertiary,borderRadius:e.borderRadiusSM},"&":{scrollbarWidth:"thin",scrollbarColor:`${e.colorTextTertiary} transparent`},"&::after":{display:"block",height:`calc(100% - ${rt(B)})`,content:'""'},"&:not(:first-child)":{borderInlineStart:`${rt(p)} ${S} ${b}`},"&-active":{background:new Sr(O).setA(.2).toHexString()},"&:hover":{overflowY:"auto"},"> li":{margin:0,padding:0,[`&${t}-time-panel-cell`]:{marginInline:L,[`${t}-time-panel-cell-inner`]:{display:"block",width:e.calc(H).sub(e.calc(L).mul(2)).equal(),height:B,margin:0,paddingBlock:0,paddingInlineEnd:0,paddingInlineStart:e.calc(H).sub(B).div(2).equal(),color:w,lineHeight:rt(B),borderRadius:x,cursor:"pointer",transition:`background ${E}`,"&:hover":{background:U}},"&-selected":{[`${t}-time-panel-cell-inner`]:{background:O}},"&-disabled":{[`${t}-time-panel-cell-inner`]:{color:Q,background:"transparent",cursor:"not-allowed"}}}}}}}}},Cl=e=>{const{componentCls:t,textHeight:r,lineWidth:a,paddingSM:i,antCls:u,colorPrimary:c,cellActiveWithRangeBg:d,colorPrimaryBorder:h,lineType:g,colorSplit:f}=e;return{[`${t}-dropdown`]:{[`${t}-footer`]:{borderTop:`${rt(a)} ${g} ${f}`,"&-extra":{padding:`0 ${rt(i)}`,lineHeight:rt(e.calc(r).sub(e.calc(a).mul(2)).equal()),textAlign:"start","&:not(:last-child)":{borderBottom:`${rt(a)} ${g} ${f}`}}},[`${t}-panels + ${t}-footer ${t}-ranges`]:{justifyContent:"space-between"},[`${t}-ranges`]:{marginBlock:0,paddingInline:rt(i),overflow:"hidden",textAlign:"start",listStyle:"none",display:"flex",justifyContent:"center",alignItems:"center","> li":{lineHeight:rt(e.calc(r).sub(e.calc(a).mul(2)).equal()),display:"inline-block"},[`${t}-now-btn-disabled`]:{pointerEvents:"none",color:e.colorTextDisabled},[`${t}-preset > ${u}-tag-blue`]:{color:c,background:d,borderColor:h,cursor:"pointer"},[`${t}-ok`]:{paddingBlock:e.calc(a).mul(2).equal(),marginInlineStart:"auto"}}}}},Ml=e=>{const{componentCls:t,controlHeightLG:r,paddingXXS:a,padding:i}=e;return{pickerCellCls:`${t}-cell`,pickerCellInnerCls:`${t}-cell-inner`,pickerYearMonthCellWidth:e.calc(r).mul(1.5).equal(),pickerQuarterPanelContentHeight:e.calc(r).mul(1.4).equal(),pickerCellPaddingVertical:e.calc(a).add(e.calc(a).div(2)).equal(),pickerCellBorderGap:2,pickerControlIconSize:7,pickerControlIconMargin:4,pickerControlIconBorderWidth:1.5,pickerDatePanelPaddingHorizontal:e.calc(i).add(e.calc(a).div(2)).equal()}},kl=e=>{const{colorBgContainerDisabled:t,controlHeight:r,controlHeightSM:a,controlHeightLG:i,paddingXXS:u,lineWidth:c}=e,d=u*2,h=c*2,g=Math.min(r-d,r-h),f=Math.min(a-d,a-h),p=Math.min(i-d,i-h);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(u/2),cellHoverBg:e.controlItemBgHover,cellActiveWithRangeBg:e.controlItemBgActive,cellHoverWithRangeBg:new Sr(e.colorPrimary).lighten(35).toHexString(),cellRangeBorderColor:new Sr(e.colorPrimary).lighten(20).toHexString(),cellBgDisabled:t,timeColumnWidth:i*1.4,timeColumnHeight:28*8,timeCellHeight:28,cellWidth:a*1.5,cellHeight:a,textHeight:i,withoutTimeCellHeight:i*1.65,multipleItemBg:e.colorFillSecondary,multipleItemBorderColor:"transparent",multipleItemHeight:g,multipleItemHeightSM:f,multipleItemHeightLG:p,multipleSelectorBgDisabled:t,multipleItemColorDisabled:e.colorTextDisabled,multipleItemBorderColorDisabled:"transparent"}},Pl=e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ss(e)),kl(e)),Ds(e)),{presetsWidth:120,presetsMaxWidth:200,zIndexPopup:e.zIndexPopupBase+50}),wl=e=>{const{componentCls:t}=e;return{[t]:[Object.assign(Object.assign(Object.assign(Object.assign({},xs(e)),Cs(e)),Ms(e)),ks(e)),{"&-outlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${rt(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-filled":{[`&${t}-multiple ${t}-selection-item`]:{background:e.colorBgContainer,border:`${rt(e.lineWidth)} ${e.lineType} ${e.colorSplit}`}},"&-borderless":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${rt(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-underlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${rt(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}}}]}},_r=(e,t)=>({padding:`${rt(e)} ${rt(t)}`}),jl=e=>{const{componentCls:t,colorError:r,colorWarning:a}=e;return{[`${t}:not(${t}-disabled):not([disabled])`]:{[`&${t}-status-error`]:{[`${t}-active-bar`]:{background:r}},[`&${t}-status-warning`]:{[`${t}-active-bar`]:{background:a}}}}},Il=e=>{var t;const{componentCls:r,antCls:a,paddingInline:i,lineWidth:u,lineType:c,colorBorder:d,borderRadius:h,motionDurationMid:g,colorTextDisabled:f,colorTextPlaceholder:p,colorTextQuaternary:S,fontSizeLG:P,inputFontSizeLG:D,fontSizeSM:R,inputFontSizeSM:b,controlHeightSM:N,paddingInlineSM:A,paddingXS:T,marginXS:E,colorIcon:V,lineWidthBold:W,colorPrimary:Y,motionDurationSlow:K,zIndexPopup:Q,paddingXXS:w,sizePopupArrow:k,colorBgElevated:$,borderRadiusLG:q,boxShadowSecondary:F,borderRadiusSM:x,colorSplit:C,cellHoverBg:U,presetsWidth:y,presetsMaxWidth:H,boxShadowPopoverArrow:B,fontHeight:O,lineHeightLG:L}=e;return[{[r]:Object.assign(Object.assign(Object.assign({},fa(e)),_r(e.paddingBlock,e.paddingInline)),{position:"relative",display:"inline-flex",alignItems:"center",lineHeight:1,borderRadius:h,transition:`border ${g}, box-shadow ${g}, background ${g}`,[`${r}-prefix`]:{flex:"0 0 auto",marginInlineEnd:e.inputAffixPadding},[`${r}-input`]:{position:"relative",display:"inline-flex",alignItems:"center",width:"100%","> input":Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",color:"inherit",fontSize:(t=e.inputFontSize)!==null&&t!==void 0?t:e.fontSize,lineHeight:e.lineHeight,transition:`all ${g}`},Os(p)),{flex:"auto",minWidth:1,height:"auto",padding:0,background:"transparent",border:0,fontFamily:"inherit","&:focus":{boxShadow:"none",outline:0},"&[disabled]":{background:"transparent",color:f,cursor:"not-allowed"}}),"&-placeholder":{"> input":{color:p}}},"&-large":Object.assign(Object.assign({},_r(e.paddingBlockLG,e.paddingInlineLG)),{[`${r}-input > input`]:{fontSize:D??P,lineHeight:L}}),"&-small":Object.assign(Object.assign({},_r(e.paddingBlockSM,e.paddingInlineSM)),{[`${r}-input > input`]:{fontSize:b??R}}),[`${r}-suffix`]:{display:"flex",flex:"none",alignSelf:"center",marginInlineStart:e.calc(T).div(2).equal(),color:S,lineHeight:1,pointerEvents:"none",transition:`opacity ${g}, color ${g}`,"> *":{verticalAlign:"top","&:not(:last-child)":{marginInlineEnd:E}}},[`${r}-clear`]:{position:"absolute",top:"50%",insetInlineEnd:0,color:S,lineHeight:1,transform:"translateY(-50%)",cursor:"pointer",opacity:0,transition:`opacity ${g}, color ${g}`,"> *":{verticalAlign:"top"},"&:hover":{color:V}},"&:hover":{[`${r}-clear`]:{opacity:1},[`${r}-suffix:not(:last-child)`]:{opacity:0}},[`${r}-separator`]:{position:"relative",display:"inline-block",width:"1em",height:P,color:S,fontSize:P,verticalAlign:"top",cursor:"default",[`${r}-focused &`]:{color:V},[`${r}-range-separator &`]:{[`${r}-disabled &`]:{cursor:"not-allowed"}}},"&-range":{position:"relative",display:"inline-flex",[`${r}-active-bar`]:{bottom:e.calc(u).mul(-1).equal(),height:W,background:Y,opacity:0,transition:`all ${K} ease-out`,pointerEvents:"none"},[`&${r}-focused`]:{[`${r}-active-bar`]:{opacity:1}},[`${r}-range-separator`]:{alignItems:"center",padding:`0 ${rt(T)}`,lineHeight:1}},"&-range, &-multiple":{[`${r}-clear`]:{insetInlineEnd:i},[`&${r}-small`]:{[`${r}-clear`]:{insetInlineEnd:A}}},"&-dropdown":Object.assign(Object.assign(Object.assign({},fa(e)),xl(e)),{pointerEvents:"none",position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:Q,[`&${r}-dropdown-hidden`]:{display:"none"},"&-rtl":{direction:"rtl"},[`&${r}-dropdown-placement-bottomLeft,
            &${r}-dropdown-placement-bottomRight`]:{[`${r}-range-arrow`]:{top:0,display:"block",transform:"translateY(-100%)"}},[`&${r}-dropdown-placement-topLeft,
            &${r}-dropdown-placement-topRight`]:{[`${r}-range-arrow`]:{bottom:0,display:"block",transform:"translateY(100%) rotate(180deg)"}},[`&${a}-slide-up-appear, &${a}-slide-up-enter`]:{[`${r}-range-arrow${r}-range-arrow`]:{transition:"none"}},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topRight`]:{animationName:Ts},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomRight`]:{animationName:Es},[`&${a}-slide-up-leave ${r}-panel-container`]:{pointerEvents:"none"},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topRight`]:{animationName:Ns},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomRight`]:{animationName:Is},[`${r}-panel > ${r}-time-panel`]:{paddingTop:w},[`${r}-range-wrapper`]:{display:"flex",position:"relative"},[`${r}-range-arrow`]:Object.assign(Object.assign({position:"absolute",zIndex:1,display:"none",paddingInline:e.calc(i).mul(1.5).equal(),boxSizing:"content-box",transition:`all ${K} ease-out`},$s(e,$,B)),{"&:before":{insetInlineStart:e.calc(i).mul(1.5).equal()}}),[`${r}-panel-container`]:{overflow:"hidden",verticalAlign:"top",background:$,borderRadius:q,boxShadow:F,transition:`margin ${K}`,display:"inline-block",pointerEvents:"auto",[`${r}-panel-layout`]:{display:"flex",flexWrap:"nowrap",alignItems:"stretch"},[`${r}-presets`]:{display:"flex",flexDirection:"column",minWidth:y,maxWidth:H,ul:{height:0,flex:"auto",listStyle:"none",overflow:"auto",margin:0,padding:T,borderInlineEnd:`${rt(u)} ${c} ${C}`,li:Object.assign(Object.assign({},Rs),{borderRadius:x,paddingInline:T,paddingBlock:e.calc(N).sub(O).div(2).equal(),cursor:"pointer",transition:`all ${K}`,"+ li":{marginTop:E},"&:hover":{background:U}})}},[`${r}-panels`]:{display:"inline-flex",flexWrap:"nowrap","&:last-child":{[`${r}-panel`]:{borderWidth:0}}},[`${r}-panel`]:{verticalAlign:"top",background:"transparent",borderRadius:0,borderWidth:0,[`${r}-content, table`]:{textAlign:"center"},"&-focused":{borderColor:d}}}}),"&-dropdown-range":{padding:`${rt(e.calc(k).mul(2).div(3).equal())} 0`,"&-hidden":{display:"none"}},"&-rtl":{direction:"rtl",[`${r}-separator`]:{transform:"scale(-1, 1)"},[`${r}-footer`]:{"&-extra":{direction:"rtl"}}}})},ha(e,"slide-up"),ha(e,"slide-down"),ba(e,"move-up"),ba(e,"move-down")]},Qi=Ps("DatePicker",e=>{const t=qr(ws(e),Ml(e),{inputPaddingHorizontalBase:e.calc(e.paddingSM).sub(1).equal(),multipleSelectItemHeight:e.multipleItemHeight,selectHeight:e.controlHeight});return[Cl(t),Il(t),wl(t),jl(t),Sl(t),js(e,{focusElCls:`${e.componentCls}-focused`})]},Pl);var Nl={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z"}}]},name:"swap-right",theme:"outlined"},El=function(t,r){return s.createElement(na,ot({},t,{ref:r,icon:Nl}))},Tl=s.forwardRef(El);const Ji=(e,t,r,a,i)=>{const{classNames:u,styles:c}=Fs(e),[d,h]=io([u,t],[c,r],{popup:{_default:"root"}});return s.useMemo(()=>{var g,f;const p=Object.assign(Object.assign({},d),{popup:Object.assign(Object.assign({},d.popup),{root:gt((g=d.popup)===null||g===void 0?void 0:g.root,a)})}),S=Object.assign(Object.assign({},h),{popup:Object.assign(Object.assign({},h.popup),{root:Object.assign(Object.assign({},(f=h.popup)===null||f===void 0?void 0:f.root),i)})});return[p,S]},[d,h,a,i])};function Rl(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.yearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.quarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.monthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.weekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.placeholder:e.lang.placeholder}function $l(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.rangeYearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.rangeQuarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.rangeMonthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.rangeWeekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.rangePlaceholder:e.lang.rangePlaceholder}function es(e,t){const{allowClear:r=!0}=e,{clearIcon:a,removeIcon:i}=eo(Object.assign(Object.assign({},e),{prefixCls:t,componentName:"DatePicker"}));return[s.useMemo(()=>r===!1?!1:Object.assign({clearIcon:a},r===!0?{}:r),[r,a]),i]}const[Ol,Fl]=["week","WeekPicker"],[Al,Ll]=["month","MonthPicker"],[Ul,_l]=["year","YearPicker"],[Hl,Bl]=["quarter","QuarterPicker"],[da,ka]=["time","TimePicker"];var zl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"},Yl=function(t,r){return s.createElement(na,ot({},t,{ref:r,icon:zl}))},Wl=s.forwardRef(Yl),Kl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},Vl=function(t,r){return s.createElement(na,ot({},t,{ref:r,icon:Kl}))},ql=s.forwardRef(Vl);const ts=({picker:e,hasFeedback:t,feedbackIcon:r,suffixIcon:a})=>a===null||a===!1?null:a===!0||a===void 0?yn.createElement(yn.Fragment,null,e===da?yn.createElement(ql,null):yn.createElement(Wl,null),t&&r):a,Zl=e=>s.createElement(Re,Object.assign({size:"small",type:"primary"},e));function ns(e){return s.useMemo(()=>Object.assign({button:Zl},e),[e])}var Gl=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};const Xl=e=>s.forwardRef((r,a)=>{var i;const{prefixCls:u,getPopupContainer:c,components:d,className:h,style:g,placement:f,size:p,disabled:S,bordered:P=!0,placeholder:D,popupStyle:R,popupClassName:b,dropdownClassName:N,status:A,rootClassName:T,variant:E,picker:V,styles:W,classNames:Y,suffixIcon:K}=r,Q=Gl(r,["prefixCls","getPopupContainer","components","className","style","placement","size","disabled","bordered","placeholder","popupStyle","popupClassName","dropdownClassName","status","rootClassName","variant","picker","styles","classNames","suffixIcon"]),w=V===da?"timePicker":"datePicker",k=s.useRef(null),{getPrefixCls:$,direction:q,getPopupContainer:F,rangePicker:x}=s.useContext(za),C=$("picker",u),{compactSize:U,compactItemClassnames:y}=Ya(C,q),H=$(),[B,O]=Wa("rangePicker",E,P),L=Ka(C),[Z,I,oe]=Qi(C,L),[se,X]=Ji(w,Y,W,b||N,R),[de]=es(r,C),ne=ns(d),re=Va(ke=>{var Ve;return(Ve=p??U)!==null&&Ve!==void 0?Ve:ke}),ae=s.useContext(qa),we=S??ae,Ce=s.useContext(Za),{hasFeedback:fe,status:be,feedbackIcon:me}=Ce,je=s.createElement(ts,{picker:V,hasFeedback:fe,feedbackIcon:me,suffixIcon:K});s.useImperativeHandle(a,()=>k.current);const[Ie]=Ga("Calendar",Xa),Be=Object.assign(Object.assign({},Ie),r.locale),[Ue]=Qa("DatePicker",(i=X.popup.root)===null||i===void 0?void 0:i.zIndex);return Z(s.createElement(Ja,{space:!0},s.createElement(fl,Object.assign({separator:s.createElement("span",{"aria-label":"to",className:`${C}-separator`},s.createElement(Tl,null)),disabled:we,ref:k,placement:f,placeholder:$l(Be,V,D),suffixIcon:je,prevIcon:s.createElement("span",{className:`${C}-prev-icon`}),nextIcon:s.createElement("span",{className:`${C}-next-icon`}),superPrevIcon:s.createElement("span",{className:`${C}-super-prev-icon`}),superNextIcon:s.createElement("span",{className:`${C}-super-next-icon`}),transitionName:`${H}-slide-up`,picker:V},Q,{className:gt({[`${C}-${re}`]:re,[`${C}-${B}`]:O},ei(C,ti(be,A),fe),I,y,h,x==null?void 0:x.className,oe,L,T,se.root),style:Object.assign(Object.assign(Object.assign({},x==null?void 0:x.style),g),X.root),locale:Be.lang,prefixCls:C,getPopupContainer:c||F,generateConfig:e,components:ne,direction:q,classNames:{popup:gt(I,oe,L,T,se.popup.root)},styles:{popup:Object.assign(Object.assign({},X.popup.root),{zIndex:Ue})},allowClear:de}))))});var Ql=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};const Jl=e=>{const t=(h,g)=>{const f=g===ka?"timePicker":"datePicker";return s.forwardRef((S,P)=>{var D;const{prefixCls:R,getPopupContainer:b,components:N,style:A,className:T,rootClassName:E,size:V,bordered:W,placement:Y,placeholder:K,popupStyle:Q,popupClassName:w,dropdownClassName:k,disabled:$,status:q,variant:F,onCalendarChange:x,styles:C,classNames:U,suffixIcon:y}=S,H=Ql(S,["prefixCls","getPopupContainer","components","style","className","rootClassName","size","bordered","placement","placeholder","popupStyle","popupClassName","dropdownClassName","disabled","status","variant","onCalendarChange","styles","classNames","suffixIcon"]),{getPrefixCls:B,direction:O,getPopupContainer:L,[f]:Z}=s.useContext(za),I=B("picker",R),{compactSize:oe,compactItemClassnames:se}=Ya(I,O),X=s.useRef(null),[de,ne]=Wa("datePicker",F,W),re=Ka(I),[ae,we,Ce]=Qi(I,re);s.useImperativeHandle(P,()=>X.current);const fe={showToday:!0},be=h||S.picker,me=B(),{onSelect:je,multiple:Ie}=H,Be=je&&h==="time"&&!Ie,Ue=(ue,De,Oe)=>{x==null||x(ue,De,Oe),Be&&je(ue)},[ke,Ve]=Ji(f,U,C,w||k,Q),[lt,mt]=es(S,I),G=ns(N),$e=Va(ue=>{var De;return(De=V??oe)!==null&&De!==void 0?De:ue}),it=s.useContext(qa),Fe=$??it,tt=s.useContext(Za),{hasFeedback:le,status:Ge,feedbackIcon:Te}=tt,Xe=s.createElement(ts,{picker:be,hasFeedback:le,feedbackIcon:Te,suffixIcon:y}),[Se]=Ga("DatePicker",Xa),m=Object.assign(Object.assign({},Se),S.locale),[Ne]=Qa("DatePicker",(D=Ve.popup.root)===null||D===void 0?void 0:D.zIndex);return ae(s.createElement(Ja,{space:!0},s.createElement(bl,Object.assign({ref:X,placeholder:Rl(m,be,K),suffixIcon:Xe,placement:Y,prevIcon:s.createElement("span",{className:`${I}-prev-icon`}),nextIcon:s.createElement("span",{className:`${I}-next-icon`}),superPrevIcon:s.createElement("span",{className:`${I}-super-prev-icon`}),superNextIcon:s.createElement("span",{className:`${I}-super-next-icon`}),transitionName:`${me}-slide-up`,picker:h,onCalendarChange:Ue},fe,H,{locale:m.lang,className:gt({[`${I}-${$e}`]:$e,[`${I}-${de}`]:ne},ei(I,ti(Ge,q),le),we,se,Z==null?void 0:Z.className,T,Ce,re,E,ke.root),style:Object.assign(Object.assign(Object.assign({},Z==null?void 0:Z.style),A),Ve.root),prefixCls:I,getPopupContainer:b||L,generateConfig:e,components:G,direction:O,disabled:Fe,classNames:{popup:gt(we,Ce,re,E,ke.popup.root)},styles:{popup:Object.assign(Object.assign({},Ve.popup.root),{zIndex:Ne})},allowClear:lt,removeIcon:mt}))))})},r=t(),a=t(Ol,Fl),i=t(Al,Ll),u=t(Ul,_l),c=t(Hl,Bl),d=t(da,ka);return{DatePicker:r,WeekPicker:a,MonthPicker:i,YearPicker:u,TimePicker:d,QuarterPicker:c}},rs=e=>{const{DatePicker:t,WeekPicker:r,MonthPicker:a,YearPicker:i,TimePicker:u,QuarterPicker:c}=Jl(e),d=Xl(e),h=t;return h.WeekPicker=r,h.MonthPicker=a,h.YearPicker=i,h.RangePicker=d,h.TimePicker=u,h.QuarterPicker=c,h},Wn=rs(Do),eu=ni(Wn,"popupAlign",void 0,"picker");Wn._InternalPanelDoNotUseOrYouWillBeFired=eu;const tu=ni(Wn.RangePicker,"popupAlign",void 0,"picker");Wn._InternalRangePanelDoNotUseOrYouWillBeFired=tu;Wn.generatePicker=rs;const Ln=24*60*60*1e3;function as(e){if(!e)return null;const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return null;const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?null:i}function is(e){const t=e.state.settings||{},r=ui(t.startMonth),a=e.dates.filter(p=>!!(p&&/^\d{4}-\d{2}-\d{2}$/.test(p))).sort()[0],i=r||(a==null?void 0:a.slice(0,7))||new Date().toISOString().slice(0,7),u=Number.isFinite(Number(e.fallbackHorizon))?Number(e.fallbackHorizon):12,c=Number(t.horizonMonths||0),d=Number.isFinite(c)&&c>0?Math.round(c):Math.max(1,Math.round(u)),h=ci(i,d),g=as(`${i}-01`)||new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),1)),f=new Date(g.getTime());return f.setUTCMonth(f.getUTCMonth()+d),{startMonth:i,horizonMonths:d,months:h,visibleStartMs:g.getTime(),visibleEndMs:f.getTime()}}function bn(e){const t=Number.isFinite(Number(e.fallbackMs))?Number(e.fallbackMs):Ln,r=Number.isFinite(e.startMs)?e.startMs:Date.now(),a=Number.isFinite(e.endMs)?e.endMs:r+t,i=a>r?a:r+t;return{startMs:r,endMs:i}}function cn(e){const t=as(e);return t?t.getTime():null}const{Text:nu}=jn;function ru(e){const t=e==null?void 0:e[0];return!t||typeof t.toDate!="function"?"":t.toDate().toLocaleDateString("de-DE",{month:"short",year:"numeric"})}function ss({className:e,groups:t,items:r,visibleStartMs:a,visibleEndMs:i,sidebarWidth:u=290,lineHeight:c=56,itemHeightRatio:d=.7,stackItems:h=!0,sidebarHeaderLabel:g="SKU / Orders",emptyMessage:f="Keine Einträge für den aktuellen Filter.",showTodayMarker:p=!0,itemRenderer:S,onItemSelect:P}){const[D,R]=s.useState(null),[b,N]=s.useState(null);s.useEffect(()=>{if(typeof window>"u")return;let k=!0;return As(()=>import("./react-calendar-timeline.es-BMHNqWja.js"),__vite__mapDeps([0,1,2])).then($=>{k&&R($)}).catch($=>{k&&N($ instanceof Error?$.message:"Timeline library konnte nicht geladen werden.")}),()=>{k=!1}},[]);const A=s.useMemo(()=>t.map(k=>({id:k.id,title:k.title,rightTitle:k.rightTitle,height:k.height,stackItems:k.stackItems})),[t]),T=s.useMemo(()=>{const k=Math.max(6e4,Math.floor(Ln/2));return r.map($=>{const q=Math.max(6e4,Number.isFinite(Number($.minDurationMs))?Number($.minDurationMs):k),F=bn({startMs:Number($.startMs||0),endMs:Number($.endMs||0),fallbackMs:q}),x={...$.itemProps||{}};return $.tooltip&&!x.title&&(x.title=$.tooltip),{id:$.id,group:$.group,title:$.title,start_time:F.startMs,end_time:F.endMs,className:$.className,style:$.style,meta:$.meta,itemProps:x,canSelect:$.canSelect!==!1,canMove:!1,canResize:!1,canChangeGroup:!1}})},[r]);if(!A.length||!T.length)return n.jsx(It,{type:"info",showIcon:!0,message:f});if(b)return n.jsx(It,{type:"warning",showIcon:!0,message:`Timeline konnte nicht geladen werden: ${b}`});if(!D)return n.jsx("div",{className:"v2-orders-gantt-loading",children:n.jsx(nu,{type:"secondary",children:"Timeline wird geladen..."})});const E=D.default,V=D.TimelineHeaders,W=D.SidebarHeader,Y=D.DateHeader,K=D.TimelineMarkers,Q=D.TodayMarker,w=bn({startMs:a,endMs:i,fallbackMs:30*Ln});return n.jsx("div",{className:["v2-orders-gantt-wrap",e||""].filter(Boolean).join(" "),children:n.jsxs(E,{className:"v2-orders-gantt",groups:A,items:T,defaultTimeStart:w.startMs,defaultTimeEnd:w.endMs,visibleTimeStart:w.startMs,visibleTimeEnd:w.endMs,onTimeChange:(k,$,q)=>{q(w.startMs,w.endMs)},canMove:!1,canResize:!1,canChangeGroup:!1,canSelect:!0,stackItems:h,lineHeight:c,itemHeightRatio:d,sidebarWidth:u,rightSidebarWidth:0,minZoom:7*Ln,maxZoom:Math.max(w.endMs-w.startMs,7*Ln),dragSnap:Ln,buffer:1,itemRenderer:S,onItemSelect:k=>{P&&P(String(k||""))},children:[n.jsxs(V,{className:"v2-orders-gantt-headers",children:[n.jsx(W,{children:({getRootProps:k})=>{const $=k();return n.jsx("div",{...$,children:n.jsx("div",{className:"v2-orders-gantt-sidebar-header",children:g})})}}),n.jsx(Y,{unit:"primaryHeader"}),n.jsx(Y,{unit:"month",labelFormat:ru})]}),n.jsx(K,{children:p?n.jsx(Q,{children:({styles:k})=>n.jsx("div",{style:{...k,width:2,background:"rgba(220, 38, 38, 0.82)",zIndex:35}})}):void 0})]})})}const{Paragraph:au,Text:Je,Title:iu}=jn;function Mt(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?"—":i.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function kt(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function pr(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function su(e){return Array.isArray(e)?e.map(t=>t).map(t=>({month:String(t.month||""),daysCovered:Math.max(0,Number(t.daysCovered||0)),forecastMonthUnits:Number.isFinite(Number(t.forecastMonthUnits))?Number(t.forecastMonthUnits):null,demandUnitsInWindow:Number.isFinite(Number(t.demandUnitsInWindow))?Number(t.demandUnitsInWindow):0,usedFallback:!!t.usedFallback})).filter(t=>/^\d{4}-\d{2}$/.test(t.month)):[]}function Hr(e){const t=kn(e);return t==="ACTIVE"?n.jsx(pt,{color:"green",children:"Active"}):t==="CONVERTED"?n.jsx(pt,{color:"blue",children:"Converted"}):t==="ARCHIVED"?n.jsx(pt,{color:"default",children:"Archived"}):n.jsx(pt,{color:"gold",children:"Draft"})}function ou(e){const t=String(e||"").trim().toLowerCase();return t?t==="review_needed"?"Review nötig":t==="reviewed_updated"?"Aktualisiert":t==="superseded"?"Superseded":t==="ignored"?"Ignoriert":String(e||"—"):"—"}function lu(e){return e==="ACTIVE"?"DRAFT":"ACTIVE"}function uu(e){return e==="supplier"?"Supplier":e==="freight"?"Shipping China -> 3PL":e==="duty"?"Custom Duties":e==="eust"?"Einfuhrumsatzsteuer":"EUSt Erstattung"}function cu(e){if(typeof e.active=="boolean")return e.active;const t=String(e.status||"").trim().toLowerCase();return t?t==="active"||t==="aktiv":!0}function Pa(e){let t=0;const r=/(\d+)(?!.*\d)/;return(e||[]).forEach(a=>{const i=a,u=r.exec(String(i.poNo||""));if(!u)return;const c=Number(u[1]);Number.isFinite(c)&&c>t&&(t=c)}),t>0?String(t+1):String((e||[]).length+1)}function Hn(e){const t=String(e||"").trim();if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return null;const r=new Date(`${t}T00:00:00Z`);return Number.isNaN(r.getTime())?null:t}function wa(e,t){return!e&&!t?0:e?t?e.localeCompare(t):-1:1}function du(e){return new URLSearchParams(e).get("view")==="timeline"?"timeline":"table"}function mu(e){return Hn(e==null?void 0:e.etaDate)||"9999-12-31"}function Br(e){return Hn(e.targetDeliveryDate)||Hn(e.deliveryDate)||Hn(e.etaDate)}function Jn(e){return Math.round(e*100)/100}function fu(e){const t=Number(e);return Number.isFinite(t)?t:null}function qt(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function wn(e){const t=String(e||"").trim().toUpperCase();return t==="AIR"||t==="SEA"||t==="RAIL"?t:"RAIL"}function Un(e){return Number(qt(e.fxRate)??0)}function rr(e,t){const r=e.transportLeadTimesDays||{},i=[wn(t),"RAIL","SEA","AIR"],u=new Set;for(let c=0;c<i.length;c+=1){const d=i[c];if(u.has(d))continue;u.add(d);const h=Number(r[d.toLowerCase()]);if(!(!Number.isFinite(h)||h<0))return{days:Math.max(0,Math.round(h)),sourceMode:d}}return{days:0,sourceMode:null}}function ma(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function br(e){const t=ma(e);return Number(qt(t.unitPriceUsd)??qt(e==null?void 0:e.unitPriceUsd)??qt(e==null?void 0:e.unitPrice)??0)}function hu(e){const t=ma(e);return Number(qt(e==null?void 0:e.logisticsPerUnitEur)??qt(e==null?void 0:e.freightPerUnitEur)??qt(t.logisticsPerUnitEur)??qt(t.freightEur)??0)}function zr(e){const t=e.product||{},r=e.supplier||{},a=e.settings||{},i=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"fo"}),u=br(t),c=Un(a),d=hu(t),h=Math.max(0,Jn(d)),g=wn(e.transportMode||"RAIL"),f=rr(a,g).days,p=Number(i.fields.productionLeadTimeDays.value||45),S=i.fields.ddp.value===!0,P=String(r.incotermDefault||i.fields.incoterm.value||(S?"DDP":"EXW")).toUpperCase();return{transportMode:g,incoterm:P,unitPrice:u,currency:"USD",freight:h,freightCurrency:"EUR",dutyRatePct:Number(i.fields.dutyRatePct.value||0),eustRatePct:Number(i.fields.eustRatePct.value||0),fxRate:c,productionLeadTimeDays:Math.max(0,Math.round(p)),logisticsLeadTimeDays:Math.max(0,Math.round(f)),bufferDays:Math.max(0,Math.round(fu(a.defaultBufferDays)??0))}}function pu(e){const t=e.product||{},r=e.settings||{},a=ma(t),i=wn(e.transportMode||"RAIL"),u=rr(r,i);let c="Fallback";qt(t.productionLeadTimeDaysDefault)!=null?c="Produkt-Override":qt(a.productionDays)!=null?c="Beschaffungs-Template":qt(r.defaultProductionLeadTimeDays)!=null&&(c="Settings-Default");let d="Fallback";return u.sourceMode&&(d=`Settings-Default (${u.sourceMode})`),{production:c,logistics:d}}function gu({embedded:e=!1}={}){var Ee;const t=ra(),r=xr(),{state:a,loading:i,saving:u,error:c,lastSavedAt:d,saveWith:h}=Cr(),g=ri(),[f,p]=s.useState(""),[S,P]=s.useState("ALL"),[D,R]=s.useState(!1),[b,N]=s.useState(null),[A,T]=s.useState(!1),[E,V]=s.useState(null),[W,Y]=s.useState(""),[K,Q]=s.useState(""),[w,k]=s.useState([]),[$,q]=s.useState(!1),[F,x]=s.useState(""),[C,U]=s.useState(""),[y,H]=s.useState("earliest"),[B,O]=s.useState(""),[L,Z]=s.useState(!1),[I]=ye.useForm(),oe=s.useMemo(()=>du(t.search),[t.search]),se=a,X=a.settings||{},de=s.useMemo(()=>ai(X),[X]),ne=s.useMemo(()=>ii({userId:g.userId,userEmail:g.email},de),[de,g.email,g.userId]),re=s.useMemo(()=>`fo:edit:${String(b||"new")}`,[b]),ae=mi({workspaceId:g.workspaceId,modalScope:re,isOpen:D,userId:g.userId,userEmail:g.email,userDisplayName:ne,displayNames:de});function we(o){const v=new URLSearchParams(t.search);o==="timeline"?v.set("view","timeline"):v.delete("view");const z=v.toString();r({pathname:t.pathname,search:z?`?${z}`:""},{replace:!0})}const Ce=s.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(o=>o).map(o=>({id:String(o.id||""),name:String(o.name||"—"),productionLeadTimeDaysDefault:Number(o.productionLeadTimeDaysDefault)||0,incotermDefault:String(o.incotermDefault||"EXW").toUpperCase(),currencyDefault:String(o.currencyDefault||"EUR").toUpperCase(),raw:o})).filter(o=>o.id),[a.suppliers]),fe=s.useMemo(()=>new Map(Ce.map(o=>[o.id,o.raw])),[Ce]),be=s.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(o=>o).map(o=>({sku:String(o.sku||""),alias:String(o.alias||o.sku||""),status:String(o.status||"active"),supplierId:String(o.supplierId||""),productionLeadTimeDaysDefault:Number(o.productionLeadTimeDaysDefault)||0,raw:o})).filter(o=>o.sku),[a.products]),me=s.useMemo(()=>new Map(be.map(o=>[o.sku,o])),[be]),je=s.useMemo(()=>Us(a.forecast||{}),[a.forecast]),Ie=s.useMemo(()=>Hs(se),[a.forecast,a.inventory,a.pos,a.fos]),Be=s.useMemo(()=>{const o=(Array.isArray(a.fos)?a.fos:[]).map(z=>{const M=z,ee=String(M.sku||""),he=me.get(ee),pe=Ce.find(We=>We.id===String(M.supplierId||"")),J=yr({targetDeliveryDate:M.targetDeliveryDate,productionLeadTimeDays:M.productionLeadTimeDays,logisticsLeadTimeDays:M.logisticsLeadTimeDays,bufferDays:M.bufferDays}),ge={orderDate:String(M.orderDate||J.orderDate||""),etdDate:String(M.etdDate||J.etdDate||""),etaDate:String(M.etaDate||J.etaDate||"")},Pe=pa({units:M.units,unitPrice:M.unitPrice,currency:M.currency,freight:M.freight,freightCurrency:M.freightCurrency,dutyRatePct:M.dutyRatePct,eustRatePct:M.eustRatePct,fxRate:M.fxRate}),te=Number(M.productionLeadTimeDays||0)+Number(M.logisticsLeadTimeDays||0)+Number(M.bufferDays||0),ve=ga({context:Ie,sku:ee,leadTimeDays:te,product:Tr(be.map(We=>We.raw),ee),settings:X,horizonMonths:12});let _e="—",Qe=null;return ve&&(ve.status==="no_fo_needed"?_e="Keine FO erforderlich":ve.status==="ok"?(Qe=Number(ve.recommendedUnits||0),_e=`${kt(Qe,0)} Units`):_e="Nicht berechenbar"),{id:String(M.id||""),sku:ee,alias:(he==null?void 0:he.alias)||ee||"—",supplierId:String(M.supplierId||""),supplierName:(pe==null?void 0:pe.name)||"—",units:Number(M.units||0),targetDeliveryDate:M.targetDeliveryDate?String(M.targetDeliveryDate):null,orderDate:ge.orderDate||null,etdDate:ge.etdDate||null,etaDate:ge.etaDate||null,landedCostEur:Jn(Pe.landedCostEur),status:kn(M.status),convertedPoNo:M.convertedPoNo?String(M.convertedPoNo):null,forecastBasisLabel:String(M.forecastBasisVersionName||M.forecastBasisVersionId||"—"),forecastConflictState:String(M.forecastConflictState||"").trim()||null,recommendationText:_e,recommendationUnits:Qe,raw:M}}),v=f.trim().toLowerCase();return o.filter(z=>S!=="ALL"&&z.status!==S?!1:v?[z.alias,z.sku,z.supplierName,z.status].join(" ").toLowerCase().includes(v):!0).sort((z,M)=>(z.targetDeliveryDate||"").localeCompare(M.targetDeliveryDate||""))},[me,be,Ie,f,X,a.fos,S,Ce]),Ue=s.useMemo(()=>{const o=new Map;return(Array.isArray(a.fos)?a.fos:[]).forEach(v=>{const z=v,M=String(z.id||"").trim();M&&o.set(M,z)}),o},[a.fos]),ke=s.useMemo(()=>w.map(o=>Ue.get(o)||null).filter(o=>!!o).filter(o=>Zt(o.status)),[Ue,w]),Ve=s.useMemo(()=>ke.map(o=>Br(o)).filter(o=>!!o).sort((o,v)=>wa(o,v))[0]||"",[ke]),lt=s.useMemo(()=>y==="manual"?Hn(B)||null:Hn(Ve)||null,[Ve,B,y]),G=s.useMemo(()=>Array.from(new Set(ke.map(o=>String(o.supplierId||"").trim()).filter(Boolean))),[ke]).length>1,$e=s.useMemo(()=>Array.from(new Set(ke.map(o=>String(o.transportMode||"").trim().toUpperCase()).filter(Boolean))),[ke]),it=s.useMemo(()=>Array.from(new Set(ke.map(o=>String(o.incoterm||"").trim().toUpperCase()).filter(Boolean))),[ke]),Fe=$e.length>1||it.length>1,tt=s.useMemo(()=>lt?ke.map(o=>{const v=Br(o),z=wa(v,lt),M=z<0?"Zu spät bei gemeinsamer PO":z>0?"Früher als Ziel":"Passt";return{id:String(o.id||""),sku:String(o.sku||""),targetDate:v,deviation:M,status:z}}):[],[lt,ke]);function le(o,v){k(z=>v?Array.from(new Set([...z,o])):z.filter(M=>M!==o))}function Ge(o){V(o.id),Y(Pa(Array.isArray(a.pos)?a.pos:[])),Q(o.orderDate||""),T(!0)}const Te=s.useMemo(()=>is({state:se,dates:Be.flatMap(o=>[o.orderDate,o.etdDate,o.etaDate,o.targetDeliveryDate]),fallbackHorizon:12}),[Be,se]),Xe=s.useMemo(()=>{const o=[],v=[],z=new Map;return Be.forEach(M=>{const ee=Zt(M.status);o.push({id:M.id,title:n.jsxs("div",{className:"v2-orders-gantt-meta",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(en,{checked:w.includes(M.id),disabled:!ee,onChange:te=>le(M.id,te.target.checked)}),n.jsxs(Je,{strong:!0,children:["FO ",String(M.id||"").slice(-6).toUpperCase()]}),Hr(M.status)]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[M.alias," (",M.sku,") · ",M.supplierName]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:["Target ",Mt(M.targetDeliveryDate)," · ETA ",Mt(M.etaDate)]}),n.jsxs("div",{className:"v2-orders-gantt-actionline",children:[n.jsx(Re,{size:"small",onClick:()=>_(M.raw),children:ee?"Bearbeiten":"Details"}),n.jsx(Re,{size:"small",disabled:!ee,onClick:()=>Ge(M),children:"Convert"}),M.convertedPoNo?n.jsx(Re,{size:"small",onClick:()=>{const te=new URLSearchParams;te.set("source","fo_convert"),te.set("poNo",String(M.convertedPoNo||"")),r(`/v2/orders/po?${te.toString()}`)},children:"PO öffnen"}):null]})]})});const he=cn(M.orderDate),pe=cn(M.etdDate),J=cn(M.etaDate||M.targetDeliveryDate),ge=he??pe,Pe=pe;if(ge!=null&&Pe!=null){const te=bn({startMs:ge,endMs:Pe}),ve=`${M.id}:production`;v.push({id:ve,group:M.id,title:`FO ${String(M.id||"").slice(-6).toUpperCase()} · Produktion`,startMs:te.startMs,endMs:te.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-production",tooltip:[`FO: ${String(M.id||"").slice(-6).toUpperCase()}`,`Produkt: ${M.alias} (${M.sku})`,`Produktion: ${Mt(M.orderDate)} bis ${Mt(M.etdDate)}`].join(`
`)}),z.set(ve,M)}if(J!=null){const ve=bn({startMs:pe??he??J,endMs:J}),_e=`${M.id}:transit`;v.push({id:_e,group:M.id,title:`FO ${String(M.id||"").slice(-6).toUpperCase()} · Transit`,startMs:ve.startMs,endMs:ve.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-transit",tooltip:[`FO: ${String(M.id||"").slice(-6).toUpperCase()}`,`Produkt: ${M.alias} (${M.sku})`,`Transit: ${Mt(M.etdDate||M.orderDate)} bis ${Mt(M.etaDate||M.targetDeliveryDate)}`].join(`
`)}),z.set(_e,M)}}),{groups:o,items:v,itemRowMap:z}},[w,r,Be,a.pos]);s.useEffect(()=>{k(o=>o.filter(v=>{const z=Ue.get(v);return!!z&&Zt(z==null?void 0:z.status)}))},[Ue]);const Se=s.useMemo(()=>[{header:"Merge",meta:{width:84,minWidth:84},cell:({row:o})=>{const v=Zt(o.original.status);return n.jsx(en,{checked:w.includes(o.original.id),disabled:!v,onChange:z=>{le(o.original.id,z.target.checked)}})}},{header:"FO",cell:({row:o})=>String(o.original.id||"").slice(-6).toUpperCase()},{header:"Produkt",meta:{width:220,minWidth:220},cell:({row:o})=>n.jsx(li,{alias:o.original.alias,sku:o.original.sku})},{header:"Supplier",accessorKey:"supplierName"},{header:"Units",cell:({row:o})=>kt(o.original.units,0)},{header:"Target",cell:({row:o})=>Mt(o.original.targetDeliveryDate)},{header:"Order",cell:({row:o})=>Mt(o.original.orderDate)},{header:"ETD / ETA",meta:{sortAccessor:mu},cell:({row:o})=>n.jsxs(ze,{direction:"vertical",size:0,children:[n.jsxs(Je,{children:["ETD ",Mt(o.original.etdDate)]}),n.jsxs(Je,{type:"secondary",children:["ETA ",Mt(o.original.etaDate)]})]})},{header:"Landed EUR",cell:({row:o})=>pr(o.original.landedCostEur)},{header:"Empfehlung",cell:({row:o})=>o.original.recommendationText},{header:"Forecast-Basis",meta:{width:210,minWidth:210},cell:({row:o})=>n.jsxs(ze,{direction:"vertical",size:0,children:[n.jsx(Je,{children:o.original.forecastBasisLabel||"—"}),n.jsx(Je,{type:"secondary",children:ou(o.original.forecastConflictState)})]})},{header:"Status",cell:({row:o})=>Hr(o.original.status)},{header:"Aktionen",meta:{width:250,minWidth:250},cell:({row:o})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(Re,{size:"small",onClick:()=>{_(o.original.raw)},children:Zt(o.original.status)?"Bearbeiten":"Details"}),n.jsx(Re,{size:"small",disabled:!Zt(o.original.status),onClick:()=>{Ge(o.original)},children:"Convert"}),o.original.convertedPoNo?n.jsx(Re,{size:"small",onClick:()=>{const v=new URLSearchParams;v.set("source","fo_convert"),v.set("poNo",String(o.original.convertedPoNo||"")),r(`/v2/orders/po?${v.toString()}`)},children:"PO öffnen"}):null,n.jsx(Re,{size:"small",danger:!0,disabled:!Zt(o.original.status),onClick:()=>{$t.confirm({title:"FO loeschen?",onOk:async()=>{await h(v=>{const z=dn(v);return z.fos=(Array.isArray(z.fos)?z.fos:[]).filter(M=>String(M.id||"")!==o.original.id),z},"v2:fo:delete")}})},children:"Loeschen"})]})}],[w,r,h,a.pos]),m=ye.useWatch([],I),Ne=s.useMemo(()=>b&&Be.find(o=>o.id===b)||null,[b,Be]),ue=s.useMemo(()=>kn((m==null?void 0:m.status)||(Ne==null?void 0:Ne.status)||"DRAFT"),[m==null?void 0:m.status,Ne==null?void 0:Ne.status]),De=!Zt(ue),Oe=ae.readOnly||De,qe=String((Ne==null?void 0:Ne.convertedPoNo)||((Ee=Ne==null?void 0:Ne.raw)==null?void 0:Ee.convertedPoNo)||"").trim(),Ye=s.useMemo(()=>{var v;const o=String((m==null?void 0:m.sku)||"").trim();return o&&((v=me.get(o))==null?void 0:v.raw)||null},[m==null?void 0:m.sku,me]),ft=s.useMemo(()=>In({state:se,product:Ye||void 0,sku:String((m==null?void 0:m.sku)||""),supplierId:String((m==null?void 0:m.supplierId)||(Ye==null?void 0:Ye.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:m==null?void 0:m.unitPrice,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,incoterm:m==null?void 0:m.incoterm,currency:m==null?void 0:m.currency,fxRate:m==null?void 0:m.fxRate}}),[m==null?void 0:m.currency,m==null?void 0:m.dutyRatePct,m==null?void 0:m.eustRatePct,m==null?void 0:m.fxRate,m==null?void 0:m.incoterm,m==null?void 0:m.logisticsLeadTimeDays,m==null?void 0:m.productionLeadTimeDays,m==null?void 0:m.sku,m==null?void 0:m.supplierId,m==null?void 0:m.unitPrice,Ye,se]),Dt=s.useMemo(()=>In({state:se,product:Ye||void 0,sku:String((m==null?void 0:m.sku)||""),supplierId:String((m==null?void 0:m.supplierId)||(Ye==null?void 0:Ye.supplierId)||""),orderContext:"fo"}),[m==null?void 0:m.sku,m==null?void 0:m.supplierId,Ye,se]),Et=s.useMemo(()=>tr({product:Ye,state:se,supplierId:String((m==null?void 0:m.supplierId)||(Ye==null?void 0:Ye.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:m==null?void 0:m.unitPrice,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,incoterm:m==null?void 0:m.incoterm}}),[m==null?void 0:m.dutyRatePct,m==null?void 0:m.eustRatePct,m==null?void 0:m.incoterm,m==null?void 0:m.logisticsLeadTimeDays,m==null?void 0:m.productionLeadTimeDays,m==null?void 0:m.supplierId,m==null?void 0:m.unitPrice,Ye,se]);function nt(o){if(o==="unitPrice"){I.setFieldValue("unitPrice",br(Ye));return}if(o==="productionLeadTimeDays"){I.setFieldValue("productionLeadTimeDays",Number(Dt.fields.productionLeadTimeDays.value||0));return}if(o==="logisticsLeadTimeDays"){const v=wn(I.getFieldValue("transportMode"));I.setFieldValue("logisticsLeadTimeDays",rr(X,v).days);return}if(o==="dutyRatePct"){I.setFieldValue("dutyRatePct",Number(Dt.fields.dutyRatePct.value||0));return}if(o==="eustRatePct"){I.setFieldValue("eustRatePct",Number(Dt.fields.eustRatePct.value||0));return}if(o==="incoterm"){const v=fe.get(String(I.getFieldValue("supplierId")||""));I.setFieldValue("incoterm",String((v==null?void 0:v.incotermDefault)||Dt.fields.incoterm.value||"EXW").toUpperCase());return}if(o==="currency"){I.setFieldValue("currency","USD");return}I.setFieldValue("fxRate",Un(X))}function ht(o,v){const z=String((Ye==null?void 0:Ye.sku)||(m==null?void 0:m.sku)||"").trim();z&&$t.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${z}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{$t.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await h(M=>{const ee=dn(M),he=Array.isArray(ee.products)?[...ee.products]:[],pe=he.findIndex(ge=>String(ge.sku||"").trim().toLowerCase()===z.toLowerCase());if(pe<0)return ee;const J=he[pe];return he[pe]={...di({product:J,field:o,value:v}),updatedAt:Pn()},ee.products=he,ee},"v2:fo:adopt-masterdata"),sn.success("Produkt-Stammdaten aktualisiert.")}})}})}const Ft=s.useMemo(()=>{var z;const o=String((m==null?void 0:m.sku)||"").trim(),v=o&&((z=me.get(o))==null?void 0:z.raw)||null;return pu({product:v,settings:X,transportMode:(m==null?void 0:m.transportMode)||null})},[m==null?void 0:m.sku,m==null?void 0:m.transportMode,me,X]),At=s.useMemo(()=>yr({targetDeliveryDate:m==null?void 0:m.targetDeliveryDate,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,bufferDays:m==null?void 0:m.bufferDays}),[m]),Yt=s.useMemo(()=>{const o=Math.max(0,Number((m==null?void 0:m.units)||0)),v=Math.max(0,Number((m==null?void 0:m.freight)||0));return Jn(o*v)},[m==null?void 0:m.freight,m==null?void 0:m.units]),Gt=s.useMemo(()=>pa({units:m==null?void 0:m.units,unitPrice:m==null?void 0:m.unitPrice,currency:m==null?void 0:m.currency,freight:Yt,freightCurrency:m==null?void 0:m.freightCurrency,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,fxRate:m==null?void 0:m.fxRate}),[m,Yt]),dt=s.useMemo(()=>{const o=(m==null?void 0:m.sku)||"";if(!o)return null;const v=Number((m==null?void 0:m.productionLeadTimeDays)||0)+Number((m==null?void 0:m.logisticsLeadTimeDays)||0)+Number((m==null?void 0:m.bufferDays)||0),z=Tr(be.map(M=>M.raw),o);return ga({context:Ie,sku:o,leadTimeDays:v,product:z,settings:X,horizonMonths:12,requiredArrivalMonth:m!=null&&m.targetDeliveryDate?String(m.targetDeliveryDate).slice(0,7):null})},[m,be,Ie,X]),_t=s.useMemo(()=>su(dt==null?void 0:dt.coverageDemandBreakdown),[dt==null?void 0:dt.coverageDemandBreakdown]),Ht=s.useMemo(()=>_t.reduce((o,v)=>o+Number(v.demandUnitsInWindow||0),0),[_t]),hn=s.useMemo(()=>m?Rr({supplierTerms:Array.isArray(m.paymentTerms)?m.paymentTerms:[],schedule:At,unitPrice:m.unitPrice,units:m.units,currency:m.currency,freight:Yt,freightCurrency:m.freightCurrency,dutyRatePct:m.dutyRatePct,eustRatePct:m.eustRatePct,fxRate:m.fxRate,incoterm:m.incoterm,vatRefundLagMonths:X.vatRefundLagMonths,paymentDueDefaults:X.paymentDueDefaults}).map(v=>{const z=v.currency==="EUR"?Number(v.amount||0):Bs(v.amount,v.currency,m.fxRate);return{id:String(v.id||""),label:String(v.label||""),category:v.category,currency:String(v.currency||"EUR"),amount:Number(v.amount||0),plannedEur:Number.isFinite(z)?z:0,dueDate:v.dueDate?String(v.dueDate):null,triggerEvent:String(v.triggerEvent||"ORDER_DATE"),offsetDays:Number(v.offsetDays||0),offsetMonths:Number(v.offsetMonths||0)}}):[],[m,At,Yt,X.paymentDueDefaults,X.vatRefundLagMonths]),on=s.useMemo(()=>va((m==null?void 0:m.paymentTerms)||[]),[m==null?void 0:m.paymentTerms]);s.useEffect(()=>{!D||!ae.readOnly||!ae.remoteDraftPatch||I.setFieldsValue(ae.remoteDraftPatch)},[I,ae.readOnly,ae.remoteDraftPatch,ae.remoteDraftVersion,D]);function nn(o,v){var Qe;const z=be.find(We=>cu(We.raw))||be[0]||null,M=String((v==null?void 0:v.sku)||(o==null?void 0:o.sku)||(z==null?void 0:z.sku)||""),ee=me.get(M)||z,he=String((v==null?void 0:v.supplierId)||(o==null?void 0:o.supplierId)||(ee==null?void 0:ee.supplierId)||((Qe=Ce[0])==null?void 0:Qe.id)||""),pe=fe.get(he)||null,J=Number((v==null?void 0:v.units)??(o==null?void 0:o.units)??0),ge=zr({state:se,product:(ee==null?void 0:ee.raw)||null,supplier:pe||null,settings:X,supplierId:he}),Pe=Cn(o==null?void 0:o.payments,pe||void 0),te=qt(o==null?void 0:o.units),ve=qt(o==null?void 0:o.freight),_e=te!=null&&ve!=null?Jn(ve/te):null;return{id:o!=null&&o.id?String(o.id):void 0,sku:M,supplierId:he,status:kn((o==null?void 0:o.status)||(v==null?void 0:v.status)||"DRAFT"),targetDeliveryDate:String((v==null?void 0:v.targetDeliveryDate)||(o==null?void 0:o.targetDeliveryDate)||new Date().toISOString().slice(0,10)),units:J,transportMode:wn((o==null?void 0:o.transportMode)||ge.transportMode||"RAIL"),incoterm:String((o==null?void 0:o.incoterm)||ge.incoterm||"EXW").toUpperCase(),unitPrice:Number((o==null?void 0:o.unitPrice)??ge.unitPrice??0),currency:String((o==null?void 0:o.currency)||ge.currency||"USD").toUpperCase(),freight:Number(_e??(v==null?void 0:v.freight)??ge.freight??0),freightCurrency:"EUR",dutyRatePct:Number((o==null?void 0:o.dutyRatePct)??ge.dutyRatePct??0),eustRatePct:Number((o==null?void 0:o.eustRatePct)??ge.eustRatePct??0),fxRate:Number((o==null?void 0:o.fxRate)??ge.fxRate??Un(X)),productionLeadTimeDays:Number((o==null?void 0:o.productionLeadTimeDays)??ge.productionLeadTimeDays??45),logisticsLeadTimeDays:Number((o==null?void 0:o.logisticsLeadTimeDays)??ge.logisticsLeadTimeDays??45),bufferDays:Number((o==null?void 0:o.bufferDays)??ge.bufferDays??X.defaultBufferDays??0),paymentTerms:Pe}}function pn(o,v){const z=String(o||"").trim();if(!z)return;const M=me.get(z)||null;if(!M)return;const ee=I.getFieldsValue(),he=String(M.supplierId||ee.supplierId||""),pe=fe.get(he)||null,J=zr({state:se,product:M.raw,supplier:pe||null,settings:X,supplierId:he,transportMode:"RAIL",units:Number(ee.units??0)});I.setFieldsValue({supplierId:he||ee.supplierId,transportMode:J.transportMode,incoterm:J.incoterm,unitPrice:br(M.raw),currency:J.currency,freight:J.freight,freightCurrency:"EUR",dutyRatePct:J.dutyRatePct,eustRatePct:J.eustRatePct,fxRate:Un(X),productionLeadTimeDays:J.productionLeadTimeDays,logisticsLeadTimeDays:J.logisticsLeadTimeDays,bufferDays:J.bufferDays,paymentTerms:Cn([],pe||void 0)})}function ln(o){var Pe;const v=String(o||"").trim(),z=I.getFieldsValue(),M=String(z.sku||"").trim(),ee=M&&((Pe=me.get(M))==null?void 0:Pe.raw)||null,he=fe.get(v)||null,pe=wn(z.transportMode||"RAIL"),J=zr({state:se,product:ee,supplier:he||null,settings:X,supplierId:v,transportMode:pe,units:Number(z.units||0)}),ge=qt(he==null?void 0:he.productionLeadTimeDaysDefault);I.setFieldsValue({supplierId:v,incoterm:String((he==null?void 0:he.incotermDefault)||J.incoterm||z.incoterm||"EXW").toUpperCase(),productionLeadTimeDays:Number(ge??J.productionLeadTimeDays??z.productionLeadTimeDays??0),logisticsLeadTimeDays:rr(X,pe).days,paymentTerms:Cn([],he||void 0),unitPrice:br(ee),currency:"USD",fxRate:Un(X),freight:J.freight,freightCurrency:"EUR"})}function l(o){N(null);const v=nn(null,o);I.setFieldsValue({...v,...o||{}}),R(!0)}function _(o){N(String(o.id||"")),I.setFieldsValue(nn(o)),R(!0)}function j(){if(ke.length<2){sn.warning("Bitte mindestens 2 aktive FOs fuer den Merge auswaehlen.");return}const v=Ve||"";x(Pa(Array.isArray(a.pos)?a.pos:[])),U(""),H("earliest"),O(v),Z(!1),q(!0)}async function ie(o){var Qt;if(ae.readOnly)throw new Error("Dieser FO wird gerade von einem anderen Nutzer bearbeitet.");const v=String(o.sku||"").trim(),z=v?Tr(be.map(bt=>bt.raw),v):null,M=String((z==null?void 0:z.supplierId)||"").trim(),ee=String(o.supplierId||M||"").trim();if(!ee)throw new Error("Supplier ist erforderlich.");if(!z&&!o.supplierId)throw new Error("SKU nicht gefunden. Bitte Produkt prüfen.");const he=b&&((Qt=Be.find(bt=>bt.id===b))==null?void 0:Qt.raw)||null,pe=kn((he==null?void 0:he.status)||"DRAFT"),J=kn(o.status||pe||"DRAFT");let ge=J;he&&!Zt(pe)?ge=pe:Zt(J)||(ge=he?pe:"DRAFT");const Pe={...o,supplierId:ee,status:ge},te=tr({product:z,state:se,supplierId:ee,orderContext:"fo",orderOverrides:{unitPrice:Pe.unitPrice,productionLeadTimeDays:Pe.productionLeadTimeDays,logisticsLeadTimeDays:Pe.logisticsLeadTimeDays,dutyRatePct:Pe.dutyRatePct,eustRatePct:Pe.eustRatePct,incoterm:Pe.incoterm}});if(te.blocked)throw new Error(`Blockierende Stammdaten fehlen: ${te.issues.map(bt=>bt.label).join(", ")}`);const ve=(o.paymentTerms||[]).map(bt=>({id:bt.id,label:String(bt.label||"Milestone"),percent:Number(bt.percent||0),triggerEvent:String(bt.triggerEvent||"ORDER_DATE").toUpperCase(),offsetDays:Number(bt.offsetDays||0),offsetMonths:Number(bt.offsetMonths||0)})),_e=va(ve);if(Math.abs(_e-100)>.01)throw new Error("Supplier Payment Terms muessen in Summe 100% ergeben.");const Qe=yr({targetDeliveryDate:Pe.targetDeliveryDate,productionLeadTimeDays:Pe.productionLeadTimeDays,logisticsLeadTimeDays:Pe.logisticsLeadTimeDays,bufferDays:Pe.bufferDays}),We=Math.max(0,Number(Pe.freight||0)),ut=Jn(We*Math.max(0,Number(Pe.units||0))),xt=qs({existing:he,supplierTerms:ve,values:{...Pe,freight:ut,freightCurrency:"EUR",forecastBasisVersionId:(je==null?void 0:je.id)||null,forecastBasisVersionName:(je==null?void 0:je.name)||null,forecastBasisSetAt:Pn()},schedule:Qe,vatRefundLagMonths:X.vatRefundLagMonths,paymentDueDefaults:X.paymentDueDefaults});await h(bt=>{const Wt=dn(bt),ct=Array.isArray(Wt.fos)?[...Wt.fos]:[],Bt=ct.findIndex(rn=>String(rn.id||"")===String(xt.id));return Bt>=0?ct[Bt]=xt:ct.push(xt),Wt.fos=ct,Wt},b?"v2:fo:update":"v2:fo:create"),ae.clearDraft(),R(!1),N(null),I.resetFields()}async function xe(){const o=E;if(!o)return;const v=String(W||"").trim();if(!v)throw new Error("PO Nummer ist erforderlich.");await h(z=>{var We,ut;const M=dn(z),ee=Array.isArray(M.pos)?[...M.pos]:[],he=Array.isArray(M.fos)?[...M.fos]:[];if(ee.some(xt=>String(xt.poNo||"")===v))throw new Error(`PO Nummer ${v} existiert bereits.`);const pe=he.findIndex(xt=>String(xt.id||"")===o);if(pe<0)throw new Error("FO nicht gefunden.");const J={...he[pe]};if(!Zt(J.status))throw new Error("Nur aktive FOs (Draft/Active) koennen konvertiert werden.");const ge=Zs({fo:J,poNumber:v,orderDateOverride:K||String(J.orderDate||"")});ee.push(ge);const te=new Map((Array.isArray(M.suppliers)?M.suppliers:[]).map(xt=>xt).map(xt=>[String(xt.id||""),xt])).get(String(J.supplierId||""))||null,ve=Cn(J.payments,te||void 0),_e=_n({orderDate:K||J.orderDate,productionLeadTimeDays:J.productionLeadTimeDays,logisticsLeadTimeDays:J.logisticsLeadTimeDays,bufferDays:J.bufferDays,deliveryDate:J.targetDeliveryDate}),Qe=Rr({supplierTerms:ve,schedule:_e,unitPrice:J.unitPrice,units:J.units,currency:J.currency,freight:J.freight,freightCurrency:J.freightCurrency,dutyRatePct:J.dutyRatePct,eustRatePct:J.eustRatePct,fxRate:J.fxRate,incoterm:J.incoterm,vatRefundLagMonths:(We=M.settings)==null?void 0:We.vatRefundLagMonths,paymentDueDefaults:(ut=M.settings)==null?void 0:ut.paymentDueDefaults});return he[pe]={...J,..._e,payments:Qe,status:"CONVERTED",convertedPoId:ge.id,convertedPoNo:ge.poNo,updatedAt:Pn()},M.pos=ee,M.fos=he,M},"v2:fo:convert"),T(!1),V(null),k(z=>z.filter(M=>M!==o)),sn.success(`FO wurde in PO ${v} konvertiert.`)}async function Me(){const o=ke;if(o.length<2)throw new Error("Bitte mindestens 2 FOs auswaehlen.");if(G)throw new Error("Merge ist nur mit gleichem Lieferanten erlaubt.");if(Fe&&!L)throw new Error("Bitte gemischte Transport/Incoterm explizit bestaetigen.");const v=String(F||"").trim();if(!v)throw new Error("PO Nummer ist erforderlich.");const z=lt;if(y==="manual"&&!z)throw new Error("Bitte ein manuelles Ziel-Lieferdatum setzen.");await h(M=>{var Qe;const ee=dn(M),he=Array.isArray(ee.pos)?[...ee.pos]:[],pe=Array.isArray(ee.fos)?[...ee.fos]:[];if(he.some(We=>String(We.poNo||"")===v))throw new Error(`PO Nummer ${v} existiert bereits.`);const J=o.map(We=>String(We.id||"")),ge=pe.filter(We=>J.includes(String(We.id||""))).map(We=>({...We}));if(ge.length!==o.length)throw new Error("Nicht alle ausgewaehlten FOs konnten geladen werden.");if(ge.some(We=>!Zt(We.status)))throw new Error("Enthaelt bereits konvertierte oder archivierte FOs.");const Pe=Gs({fos:ge,poNumber:v,orderDateOverride:C||null,targetDeliveryDate:z});he.push(Pe);const te=new Map((Array.isArray(ee.suppliers)?ee.suppliers:[]).map(We=>We).map(We=>[String(We.id||""),We])),ve=(Qe=ee.settings)==null?void 0:Qe.vatRefundLagMonths,_e=pe.map(We=>{var Bt;const ut=We,xt=String(ut.id||"");if(!J.includes(xt))return ut;const Qt=te.get(String(ut.supplierId||""))||null,bt=Cn(ut.payments,Qt||void 0),Wt=_n({orderDate:C||Pe.orderDate||ut.orderDate,productionLeadTimeDays:ut.productionLeadTimeDays,logisticsLeadTimeDays:ut.logisticsLeadTimeDays,bufferDays:ut.bufferDays,deliveryDate:z||ut.targetDeliveryDate}),ct=Rr({supplierTerms:bt,schedule:Wt,unitPrice:ut.unitPrice,units:ut.units,currency:ut.currency,freight:ut.freight,freightCurrency:ut.freightCurrency,dutyRatePct:ut.dutyRatePct,eustRatePct:ut.eustRatePct,fxRate:ut.fxRate,incoterm:ut.incoterm,vatRefundLagMonths:ve,paymentDueDefaults:(Bt=ee.settings)==null?void 0:Bt.paymentDueDefaults});return{...ut,...Wt,payments:ct,status:"CONVERTED",convertedPoId:Pe.id,convertedPoNo:Pe.poNo,updatedAt:Pn()}});return ee.pos=he,ee.fos=_e,ee},"v2:fo:merge-convert"),q(!1),k([]),Z(!1),U(""),O(""),x(""),H("earliest"),sn.success(`FO-Merge erstellt PO ${v}.`)}return s.useEffect(()=>{const o=new URLSearchParams(t.search),v=o.get("source"),z=ge=>{const Pe=new URLSearchParams(t.search);ge.forEach(ve=>Pe.delete(ve));const te=Pe.toString();r({pathname:t.pathname,search:te?`?${te}`:""},{replace:!0})};if(v==="orders_sku"){const ge=String(o.get("foId")||"").trim();if(ge){const Pe=(Array.isArray(a.fos)?a.fos:[]).map(te=>te).find(te=>String(te.id||"")===ge);Pe&&_(Pe)}z(["source","foId"]);return}if(v!=="inventory_projection")return;const M=String(o.get("sku")||"").trim();if(!M){z(["source"]);return}const ee=me.get(M)||null,he=Math.max(0,Math.round(Number(o.get("suggestedUnits")||0))),pe=String(o.get("requiredArrivalDate")||""),J={sku:M,units:he,status:"ACTIVE"};ee!=null&&ee.supplierId&&(J.supplierId=String(ee.supplierId)),pe&&(J.targetDeliveryDate=pe),l(J),z(["source","sku","month","suggestedUnits","projectedEnd","mode","requiredArrivalDate","recommendedOrderDate","returnTo","nextSku","nextMonth","nextSuggestedUnits","nextRequiredArrivalDate","nextRecommendedOrderDate"])},[t.pathname,t.search,r,me,a.fos]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(Nt,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(iu,{level:3,children:"Forecast Orders"}),n.jsx(au,{children:"FO ist ein Planobjekt je SKU (inkl. Plan-Meilensteinen). Zahlungen werden erst nach PO-Conversion im PO-Flow bestätigt."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(Re,{type:"primary",onClick:()=>l(),children:"Create FO"}),n.jsx(aa,{value:oe,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:o=>we(String(o)==="timeline"?"timeline":"table")}),u?n.jsx(pt,{color:"processing",children:"Speichern..."}):null,d?n.jsxs(pt,{color:"green",children:["Gespeichert: ",new Date(d).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(It,{type:"error",showIcon:!0,message:c}):null,i?n.jsx(It,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(Nt,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(vt,{placeholder:"Alias, SKU, Supplier",value:f,onChange:o=>p(o.target.value),style:{width:280}}),n.jsx(Ct,{value:S,onChange:o=>P(o),options:[{value:"ALL",label:"Alle Status"},...zs.map(o=>({value:o,label:o}))],style:{width:190}}),n.jsx(Re,{onClick:j,disabled:ke.length<2,children:"Create PO from FOs"}),n.jsxs(pt,{children:[ke.length," ausgewählt"]})]}),oe==="table"?n.jsx(oi,{data:Be,columns:Se,minTableWidth:1400,tableLayout:"auto"}):n.jsx(ss,{className:"v2-orders-gantt--fo",groups:Xe.groups,items:Xe.items,visibleStartMs:Te.visibleStartMs,visibleEndMs:Te.visibleEndMs,sidebarWidth:340,lineHeight:72,sidebarHeaderLabel:"FO / Produkt",emptyMessage:"Keine Forecast Orders für die aktuelle Suche/Filter.",onItemSelect:o=>{const v=Xe.itemRowMap.get(o);v&&_(v.raw)}})]}),n.jsxs($t,{title:b?"FO bearbeiten":"FO anlegen",open:D,width:1120,onCancel:()=>{ae.clearDraft(),R(!1)},onOk:()=>{if(Oe){if(De&&!ae.readOnly){$t.info({title:"Read-only FO",content:"Konvertierte oder archivierte FOs sind schreibgeschuetzt. Bitte ueber PO weiterarbeiten."});return}$t.warning({title:"Nur Lesemodus",content:`${ae.remoteUserLabel||"Kollege"} bearbeitet diesen FO. Bitte Bearbeitung übernehmen oder warten.`});return}I.validateFields().then(o=>ie(o)).catch(()=>{})},children:[ae.banner?n.jsx(It,{style:{marginBottom:10},type:ae.banner.tone,showIcon:!0,message:ae.banner.text,action:ae.readOnly?n.jsx(Re,{size:"small",onClick:ae.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,ae.readOnly&&ae.remoteDraftVersion>0?n.jsxs(pt,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",ae.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,n.jsxs(ze,{style:{width:"100%",marginBottom:10},wrap:!0,children:[n.jsx(Je,{type:"secondary",children:"Status:"}),Hr(ue),Zt(ue)?n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>I.setFieldValue("status",lu(ue)),children:ue==="ACTIVE"?"Als Draft markieren":"Als Active markieren"}):n.jsx(pt,{color:"default",children:"Read-only"}),qe?n.jsx(Re,{size:"small",onClick:()=>{const o=new URLSearchParams;o.set("source","fo_convert"),o.set("poNo",qe),r(`/v2/orders/po?${o.toString()}`)},children:"Zugehoerige PO oeffnen"}):null]}),n.jsxs(ye,{name:"v2-fo-modal",form:I,layout:"vertical",disabled:Oe,onValuesChange:o=>{Oe||ae.publishDraftPatch(o)},children:[n.jsx(ye.Item,{name:"id",hidden:!0,children:n.jsx(vt,{})}),n.jsx(ye.Item,{name:"status",hidden:!0,children:n.jsx(vt,{})}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"sku",label:"Produkt (SKU)",style:{minWidth:230,flex:1},rules:[{required:!0,message:"SKU ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:be.map(o=>({value:o.sku,label:`${o.alias} (${o.sku})`})),onChange:o=>{pn(String(o||""))}})}),n.jsx(ye.Item,{name:"supplierId",label:"Supplier",style:{minWidth:230,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:Ce.map(o=>({value:o.id,label:o.name})),onChange:o=>{ln(String(o||""))}})})]}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"units",label:"Units",style:{width:130},rules:[{required:!0,message:"Units sind erforderlich."}],children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(ye.Item,{name:"targetDeliveryDate",label:"Target Delivery",style:{width:190},rules:[{required:!0,message:"Zieltermin ist erforderlich."}],children:n.jsx(vt,{type:"date"})}),n.jsx(ye.Item,{name:"transportMode",label:"Transport",style:{width:140},children:n.jsx(Ct,{options:Ys.map(o=>({value:o,label:o})),onChange:o=>{const v=wn(o);I.setFieldsValue({transportMode:v,logisticsLeadTimeDays:rr(X,v).days})}})}),n.jsx(ye.Item,{name:"incoterm",label:"Incoterm",style:{width:130},children:n.jsx(Ct,{options:Ws.map(o=>({value:o,label:o}))})}),n.jsx(ye.Item,{name:"currency",label:"Currency",style:{width:130},children:n.jsx(Ct,{options:Ks.map(o=>({value:o,label:o}))})}),n.jsx(ye.Item,{name:"fxRate",label:"FX Rate",style:{width:140},children:n.jsx(yt,{mode:"fx",min:0})})]}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"unitPrice",label:"Unit Price (USD/Stück)",style:{width:190},children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{name:"freight",label:"Shipping costs (EUR/Stück)",style:{width:210},children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{name:"freightCurrency",label:"Shipping Currency",style:{width:160},children:n.jsx(Ct,{disabled:!0,options:[{value:"EUR",label:"EUR"}]})}),n.jsx(ye.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(yt,{mode:"percent",min:0,max:100})}),n.jsx(ye.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(yt,{mode:"percent",min:0,max:100})})]}),n.jsx("div",{style:{marginTop:-6,marginBottom:10},children:n.jsxs(Je,{type:"secondary",children:["Shipping total: ",pr(Yt)," (",kt((m==null?void 0:m.units)||0,0)," x ",kt((m==null?void 0:m.freight)||0,2)," EUR/Stück)"]})}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"productionLeadTimeDays",label:"Production Lead Days",style:{width:220},children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(ye.Item,{name:"logisticsLeadTimeDays",label:"Logistics Lead Days",style:{width:220},children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(ye.Item,{name:"bufferDays",label:"Buffer Days",style:{width:180},children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(Re,{disabled:Oe,onClick:()=>{const o=I.getFieldsValue(),v=fe.get(String(o.supplierId||"")),z=Cn([],v||void 0);I.setFieldsValue({incoterm:String((v==null?void 0:v.incotermDefault)||o.incoterm||"EXW").toUpperCase(),currency:"USD",fxRate:Un(X),paymentTerms:z})},children:"Supplier Terms"})]}),n.jsx("div",{style:{marginTop:-2,marginBottom:10},children:n.jsxs(Je,{type:"secondary",children:["Quelle Leadtime: Produktion = ",Ft.production," · Logistik = ",Ft.logistics]})}),Et.blocked?n.jsx(It,{type:"error",showIcon:!0,style:{marginBottom:12},message:"Blockierende Stammdaten fehlen",description:Et.issues.map(o=>o.label).join(", ")}):null,n.jsx(Nt,{size:"small",style:{marginBottom:12},children:n.jsxs(ze,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(Je,{strong:!0,children:"Stammdaten-Herkunft (FO)"}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Price"}),n.jsx("span",{className:Xt(ft.fields.unitPriceUsd.source,!0),children:ft.fields.unitPriceUsd.label}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("unitPrice"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("unitPriceUsd",m==null?void 0:m.unitPrice),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Production Lead"}),n.jsx("span",{className:Xt(ft.fields.productionLeadTimeDays.source,!0),children:ft.fields.productionLeadTimeDays.label}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("productionLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("productionLeadTimeDays",m==null?void 0:m.productionLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Logistics Lead"}),n.jsx("span",{className:Xt(ft.fields.transitDays.source,!1),children:ft.fields.transitDays.label}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("logisticsLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("transitDays",m==null?void 0:m.logisticsLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Xt(ft.fields.dutyRatePct.source,!1),children:ft.fields.dutyRatePct.label}),n.jsx("span",{className:Xt(ft.fields.eustRatePct.source,!1),children:ft.fields.eustRatePct.label}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("dutyRatePct"),children:"Duty reset"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("eustRatePct"),children:"EUSt reset"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("dutyRatePct",m==null?void 0:m.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("eustRatePct",m==null?void 0:m.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Incoterm"}),n.jsx("span",{className:Xt(ft.fields.incoterm.source,!0),children:ft.fields.incoterm.label}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>nt("incoterm"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",disabled:Oe,onClick:()=>ht("ddp",String((m==null?void 0:m.incoterm)||"").toUpperCase()==="DDP"),children:"Als Produktwert uebernehmen"})]})]})}),n.jsx(Nt,{size:"small",style:{marginBottom:12},children:n.jsxs(ze,{direction:"vertical",size:4,children:[n.jsx(Je,{strong:!0,children:"Schedule Preview"}),n.jsxs(Je,{children:["Order Date: ",Mt(At.orderDate)]}),n.jsxs(Je,{children:["Production End: ",Mt(At.productionEndDate)]}),n.jsxs(Je,{children:["ETD: ",Mt(At.etdDate)]}),n.jsxs(Je,{children:["ETA: ",Mt(At.etaDate)]}),n.jsxs(Je,{children:["Landed Cost: ",pr(Gt.landedCostEur)]})]})}),n.jsx(Nt,{size:"small",style:{marginBottom:12},children:n.jsxs(ze,{direction:"vertical",size:4,children:[n.jsx(Je,{strong:!0,children:"FO Empfehlung"}),Ie.baselineMonth?null:n.jsx(Je,{type:"secondary",children:"Kein Inventory Snapshot vorhanden."}),dt?n.jsxs(n.Fragment,{children:[n.jsxs(Je,{children:["Baseline: ",String(dt.baselineMonth||"—")]}),n.jsxs(Je,{children:["Status: ",String(dt.status||"—")]}),n.jsx(Je,{type:"secondary",children:"Empfehlung basiert auf Forecast + Coverage DOH + MOQ."}),n.jsxs(Je,{children:["Reichweite-Bedarf (",kt(dt.coverageDaysForOrder,0)," Tage): ",kt(dt.coverageDemandUnits,0)]}),_t.length?n.jsx("div",{className:"v2-fo-breakdown-wrap",children:n.jsxs("table",{className:"v2-fo-breakdown-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Monat"}),n.jsx("th",{children:"Tage im Fenster"}),n.jsx("th",{children:"Forecast Monat"}),n.jsx("th",{children:"Beitrags-Units"})]})}),n.jsxs("tbody",{children:[_t.map(o=>n.jsxs("tr",{children:[n.jsx("td",{children:o.month}),n.jsx("td",{children:kt(o.daysCovered,0)}),n.jsxs("td",{children:[o.forecastMonthUnits==null?"—":kt(o.forecastMonthUnits,0),o.usedFallback?n.jsx("span",{className:"v2-fo-breakdown-flag",children:" (Fallback)"}):null]}),n.jsx("td",{children:kt(o.demandUnitsInWindow,0)})]},`${o.month}-${o.daysCovered}`)),n.jsxs("tr",{className:"is-total",children:[n.jsx("td",{children:"Summe"}),n.jsx("td",{children:kt(dt.coverageDaysForOrder,0)}),n.jsx("td",{children:"—"}),n.jsx("td",{children:kt(Ht,0)})]})]})]})}):null,n.jsxs(Je,{children:["Rohwert (aufgerundet): ",kt(dt.recommendedUnitsRaw,0)]}),n.jsxs(Je,{children:["Empfohlene Units: ",kt(dt.recommendedUnits,0)]}),dt.moqApplied?n.jsxs(Je,{type:"warning",children:["MOQ-Aufrundung: ",kt(dt.recommendedUnitsRaw,0)," → ",kt(dt.recommendedUnits,0)]}):null,n.jsxs(Je,{children:["Arrival: ",Mt(dt.requiredArrivalDate)]}),n.jsxs(Je,{children:["Order: ",Mt(dt.orderDateAdjusted||dt.orderDate)]})]}):n.jsx(Je,{type:"secondary",children:"Bitte SKU waehlen."})]})}),n.jsxs(Nt,{size:"small",children:[n.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(Je,{strong:!0,children:"Supplier Payment Terms"}),n.jsxs(Je,{type:Math.abs(on-100)<=.01?"secondary":"danger",children:["Summe: ",kt(on,2),"%"]})]}),n.jsx(ye.List,{name:"paymentTerms",children:(o,{add:v,remove:z})=>n.jsxs(ze,{direction:"vertical",size:8,style:{width:"100%"},children:[o.map(M=>n.jsxs(ze,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(ye.Item,{...M,name:[M.name,"label"],style:{flex:2,minWidth:220},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(vt,{placeholder:"Label"})}),n.jsx(ye.Item,{...M,name:[M.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(yt,{mode:"percent",min:0,max:100})}),n.jsx(ye.Item,{...M,name:[M.name,"triggerEvent"],style:{width:170},rules:[{required:!0,message:"Trigger fehlt."}],children:n.jsx(Ct,{options:Vs.map(ee=>({value:ee,label:ee}))})}),n.jsx(ye.Item,{...M,name:[M.name,"offsetDays"],style:{width:110},children:n.jsx(yt,{mode:"int"})}),n.jsx(Re,{danger:!0,disabled:Oe,onClick:()=>z(M.name),children:"X"})]},M.key)),n.jsxs(ze,{children:[n.jsx(Re,{disabled:Oe,onClick:()=>v({label:"Milestone",percent:0,triggerEvent:"ORDER_DATE",offsetDays:0,offsetMonths:0}),children:"Milestone"}),n.jsx(Re,{disabled:Oe,onClick:()=>{const M=String(I.getFieldValue("supplierId")||""),ee=fe.get(M)||null;I.setFieldsValue({paymentTerms:Cn([],ee||void 0)})},children:"Terms laden"})]})]})}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx(Je,{strong:!0,children:"Zahlungsfaelligkeiten (Plan)"}),n.jsx(It,{type:"info",showIcon:!0,style:{marginTop:8},message:"FOs erzeugen nur Plan-Meilensteine. Zahlungen werden ausschließlich in POs bestätigt."}),n.jsx("div",{className:"v2-stats-table-wrap",style:{marginTop:8},children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Label"}),n.jsx("th",{children:"Soll"}),n.jsx("th",{children:"Waehrung"}),n.jsx("th",{children:"Fällig"}),n.jsx("th",{children:"Regel"})]})}),n.jsx("tbody",{children:hn.length?hn.map(o=>n.jsxs("tr",{children:[n.jsx("td",{children:uu(o.category)}),n.jsx("td",{children:o.label}),n.jsx("td",{children:pr(o.plannedEur)}),n.jsx("td",{children:o.currency}),n.jsx("td",{children:Mt(o.dueDate)}),n.jsx("td",{children:`${o.triggerEvent} + ${kt(o.offsetDays,0)}d + ${kt(o.offsetMonths,0)}m`})]},o.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Keine Zahlungszeilen."})})})]})})]})]})]})]}),n.jsx($t,{title:"Einzel-FO in PO konvertieren",open:A,onCancel:()=>T(!1),onOk:()=>{xe().catch(o=>{$t.error({title:"Konvertierung fehlgeschlagen",content:o instanceof Error?o.message:String(o)})})},children:n.jsxs(ze,{direction:"vertical",style:{width:"100%"},children:[n.jsx(Je,{children:"PO Nummer"}),n.jsx(vt,{value:W,onChange:o=>Y(o.target.value)}),n.jsx(Je,{children:"Order Date (optional)"}),n.jsx(vt,{type:"date",value:K,onChange:o=>Q(o.target.value)})]})}),n.jsx($t,{title:"Mehrere FOs zu einer PO bündeln",open:$,width:960,onCancel:()=>q(!1),onOk:()=>{Me().catch(o=>{$t.error({title:"Merge fehlgeschlagen",content:o instanceof Error?o.message:String(o)})})},children:n.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:12,children:[n.jsxs(Je,{type:"secondary",children:[ke.length," FO(s) ausgewählt. Ergebnis ist eine Multi-SKU-PO mit PO-basierten Zahlungsmeilensteinen."]}),n.jsxs(ze,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Je,{children:"PO Nummer"}),n.jsx(vt,{value:F,onChange:o=>x(o.target.value)})]}),n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Je,{children:"Order Date (optional)"}),n.jsx(vt,{type:"date",value:C,onChange:o=>U(o.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(Je,{strong:!0,children:"Ziel-Liefertermin der PO"}),n.jsxs(ze,{direction:"vertical",style:{marginTop:6,width:"100%"},children:[n.jsxs(en,{checked:y==="earliest",onChange:o=>H(o.target.checked?"earliest":"manual"),children:["Frühester FO-Zieltermin verwenden (",Mt(Ve||null),")"]}),n.jsx(en,{checked:y==="manual",onChange:o=>H(o.target.checked?"manual":"earliest"),children:"Manuelles Ziel setzen"}),y==="manual"?n.jsx(vt,{type:"date",value:B,onChange:o=>O(o.target.value),style:{maxWidth:240}}):null]})]}),G?n.jsx(It,{type:"error",showIcon:!0,message:"FO-Merge nur bei gleichem Lieferanten erlaubt."}):null,Fe?n.jsx(It,{type:"warning",showIcon:!0,message:"Gemischte Incoterms/Transportmodi erkannt.",description:n.jsxs("div",{children:[n.jsxs("div",{children:["Incoterms: ",it.join(", ")||"—"]}),n.jsxs("div",{children:["Transport: ",$e.join(", ")||"—"]}),n.jsx(en,{checked:L,onChange:o=>Z(o.target.checked),style:{marginTop:8},children:"Ich habe den Mix geprüft und möchte trotzdem bündeln."})]})}):null,n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"FO"}),n.jsx("th",{children:"SKU"}),n.jsx("th",{children:"Units"}),n.jsx("th",{children:"FO Ziel"}),n.jsx("th",{children:"Abweichung zur PO"})]})}),n.jsx("tbody",{children:ke.length?ke.map(o=>{const v=Br(o),z=tt.find(M=>M.id===String(o.id||""));return n.jsxs("tr",{children:[n.jsx("td",{children:String(o.id||"").slice(-6).toUpperCase()}),n.jsx("td",{children:String(o.sku||"—")}),n.jsx("td",{children:kt(o.units,0)}),n.jsx("td",{children:Mt(v)}),n.jsx("td",{children:z?z.status<0?n.jsx(pt,{color:"red",children:z.deviation}):z.status>0?n.jsx(pt,{color:"gold",children:z.deviation}):n.jsx(pt,{color:"green",children:z.deviation}):"—"})]},String(o.id||""))}):n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:"Keine FOs gewählt."})})})]})})]})})]})}const{Paragraph:vu,Text:st,Title:yu}=jn,ja={slug:"po",entityLabel:"PO",numberField:"poNo"},os=24*60*60*1e3;function On(e){if(!e)return null;const t=String(e||"").trim(),[r,a,i]=t.split("-").map(Number);if(!r||!a||!i)return null;const u=new Date(Date.UTC(r,a-1,i));return Number.isNaN(u.getTime())?null:u}function bu(e){const t=String(e||"").trim();return!t||!/^\d{4}-\d{2}-\d{2}$/.test(t)?null:t}function Su(e){return bu(e==null?void 0:e.etaDate)||"9999-12-31"}function Fn(e,t){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return 0;const a=(Math.min(Math.max(e.getTime(),t.startMs),t.endMs)-t.startMs)/os;return Math.max(0,Math.min(100,a/t.totalDays*100))}function Du(e){const t=e.state.settings||{},r=ui(t.startMonth);if(r)return r;const a=e.rows.map(i=>i.orderDate).filter(i=>!!(i&&/^\d{4}-\d{2}-\d{2}$/.test(i))).sort()[0];return a?a.slice(0,7):new Date().toISOString().slice(0,7)}function xu(e){const t=e.settings||{},r=Number(t.horizonMonths||0);return!Number.isFinite(r)||r<=0?12:Math.round(r)}function Rt(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?"—":i.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function qn(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function un(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function Cu(e){return String(e||"").slice(-6).toUpperCase()}function Mu(e){return e==="paid_only"?n.jsx(pt,{color:"green",children:"Bezahlt"}):e==="mixed"?n.jsx(pt,{color:"gold",children:"Teilweise bezahlt"}):n.jsx(pt,{color:"blue",children:"Offen"})}function ar(e){const r=(Array.isArray(e.eventIds)?e.eventIds:[]).map(i=>String(i||"").trim()).filter(Boolean);if(r.length)return Array.from(new Set(r));const a=String(e.id||"").trim();return a?[a]:[]}function Ia(e){const t=e.map(r=>String(r||"").trim()).filter(r=>/^\d{4}-\d{2}-\d{2}$/.test(r)).sort();return t.length?t[t.length-1]:null}function ea(e){const t=String(e.eventType||"").toLowerCase(),r=`${String(e.typeLabel||"")} ${String(e.label||"")}`.toLowerCase();return r.includes("deposit")?1:r.includes("balance")?2:t==="freight"||r.includes("shipping")||r.includes("fracht")?3:t==="tax_duty_combined"||t==="duty"||t==="eust"||r.includes("zoll")||r.includes("umsatzsteuer")?4:5}function gr(e){return[...e].sort((t,r)=>{const a=String(t.dueDate||"").localeCompare(String(r.dueDate||""));if(a!==0)return a;const i=ea(t)-ea(r);return i!==0?i:String(t.label||"").localeCompare(String(r.label||""))})}function Na(e){if(!e.length)return e;const t=e.filter(g=>g.eventType==="duty"),r=e.filter(g=>g.eventType==="eust");if(!t.length||!r.length)return gr(e);const a=gr(t),i=gr(r),u=Math.min(a.length,i.length),c=new Set,d=[];for(let g=0;g<u;g+=1){const f=a[g],p=i[g];c.add(f.id),c.add(p.id);const S=Array.from(new Set([f.paymentId,p.paymentId].map(b=>String(b||"").trim()).filter(Boolean))),P=f.status==="paid"&&p.status==="paid"&&S.length===1,D=Array.from(new Set([...ar(f),...ar(p)])),R=[f.paidEurActual,p.paidEurActual].every(b=>Number.isFinite(Number(b)))?Number(f.paidEurActual||0)+Number(p.paidEurActual||0):null;d.push({id:`tax-duty-${D.join("+")||`${f.id}+${p.id}`}`,eventIds:D,typeLabel:"Umsatzsteuer + Zoll",label:"Umsatzsteuer + Zoll",dueDate:Ia([f.dueDate,p.dueDate]),plannedEur:Number(f.plannedEur||0)+Number(p.plannedEur||0),status:P?"paid":"open",paidDate:P?Ia([f.paidDate,p.paidDate]):null,paidEurActual:P?R:null,paymentId:P?S[0]:null,method:P&&String(f.method||p.method||"")||null,paidBy:P&&String(f.paidBy||p.paidBy||"")||null,note:P?String(f.note||p.note||""):"",invoiceDriveUrl:P?String(f.invoiceDriveUrl||p.invoiceDriveUrl||""):"",invoiceFolderDriveUrl:P?String(f.invoiceFolderDriveUrl||p.invoiceFolderDriveUrl||""):"",eventType:"tax_duty_combined",direction:"out"})}const h=e.filter(g=>!c.has(g.id));return gr([...h,...d])}function er(e){return e.eventType==="tax_duty_combined"?"Umsatzsteuer + Zoll":e.eventType==="duty"?"Forwarder-Rechnung (Zoll)":e.eventType==="eust"?"Forwarder-Rechnung (EUSt)":e.eventType==="vat_refund"?"EUSt-Erstattung":e.eventType==="freight"?"Shipping":e.eventType==="fx_fee"?"FX Gebuehr":String(e.typeLabel||e.label||"").trim()||"Payment"}function Ea(e){return ea({eventType:e.eventType,label:e.label,typeLabel:e.typeLabel})}function ku(){return[{value:"Alibaba Trade Assurance",label:"Alibaba Trade Assurance"},{value:"Wise Transfer",label:"Wise Transfer"},{value:"PayPal",label:"PayPal"},{value:"SEPA Bank Transfer",label:"SEPA Bank Transfer"},{value:"Kreditkarte",label:"Kreditkarte"}]}function Pu(e){const t=new Set;return Object.entries(e.displayNameMap||{}).forEach(([r,a])=>{const i=String(a||r||"").trim();i&&t.add(i)}),e.syncEmail&&t.add(String(e.syncEmail).trim()),t.size?Array.from(t).sort((r,a)=>r.localeCompare(a,"de-DE",{sensitivity:"base"})).map(r=>({value:r,label:r})):[]}function vr(e){const t=String(e||"").trim();return t.length>0&&Zr(t)}function wu(e){const t=String(e.paidDate||"").trim()||"YYYY-MM-DD",r=String(e.poNo||"").trim()||"PO",a=String(e.alias||"").trim().replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")||"Alias",i=Number.isFinite(Number(e.units))?Math.max(0,Math.round(Number(e.units))):0,u=Array.from(new Set((e.selectedRows||[]).map(d=>er(d)))).map(d=>d.replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")),c=u.length?u.join("+"):"Payment";return`${t}_PO-${r}_${a}_${i}u_${c}.pdf`.replace(/-+/g,"-")}function Yr(e){const t=Number(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function ju(e){const t=e.settings||{};return{fxRate:Number(t.fxRate||0),fxFeePct:Number(t.fxFeePct||0),dutyRatePct:Number(t.dutyRatePct||0),dutyIncludeFreight:t.dutyIncludeFreight!==!1,eustRatePct:Number(t.eustRatePct||0),vatRefundEnabled:t.vatRefundEnabled!==!1,vatRefundLagMonths:Number(t.vatRefundLagMonths||0),freightLagDays:Number(t.freightLagDays||0),paymentDueDefaults:t.paymentDueDefaults||{},cny:t.cny||{start:"",end:""},cnyBlackoutByYear:t.cnyBlackoutByYear||{}}}function Wr(){return[{label:"Deposit",percent:30,anchor:"ORDER_DATE",lagDays:0},{label:"Balance",percent:70,anchor:"PROD_DONE",lagDays:0}]}function Zn(e){return Math.round((e||[]).reduce((t,r)=>t+Number(r.percent||0),0)*100)/100}function jt(e){const t=Number(e);return Number.isFinite(t)?t:null}function ls(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function An(e){const t=e.product||{},r=e.settings||{},a=ls(t),i=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),u=String(a.transportMode||"SEA").toLowerCase(),c=r.transportLeadTimesDays||{},d=jt(i.fields.transitDays.value)??jt(a.transitDays)??jt(c[u])??45,h=jt(i.fields.productionLeadTimeDays.value)??jt(t.productionLeadTimeDaysDefault??a.productionDays)??jt(e.supplierDefaultProdDays)??jt(r.defaultProductionLeadTimeDays)??60,g=jt(i.fields.unitPriceUsd.value)??jt(a.unitPriceUsd)??0,f=jt(a.fxRate??r.fxRate)??0,p=Math.max(0,jt(i.fields.logisticsPerUnitEur.value)??jt(t.logisticsPerUnitEur??t.freightPerUnitEur??a.freightEur)??0),S=Math.max(0,Math.round(p*Math.max(0,Number(e.units||0))*100)/100);return{transport:u,prodDays:Math.max(0,Math.round(h)),transitDays:Math.max(0,Math.round(d)),unitCostUsd:g,unitExtraUsd:0,extraFlatUsd:0,freightEur:S,dutyRatePct:jt(i.fields.dutyRatePct.value)??jt(t.dutyRatePct??a.dutyPct??r.dutyRatePct)??0,eustRatePct:jt(i.fields.eustRatePct.value)??jt(t.eustRatePct??a.vatImportPct??r.eustRatePct)??0,fxOverride:f,ddp:i.fields.ddp.value===!0||a.ddp===!0}}function Iu(e){const t=e.product||{},r=ls(t),a=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),i=Math.max(0,jt(a.fields.logisticsPerUnitEur.value)??jt(t.logisticsPerUnitEur??t.freightPerUnitEur??r.freightEur)??0);return Math.max(0,Math.round(i*Math.max(0,Number(e.units||0))*100)/100)}function Vt(e,t=""){return{id:String(e.id||zt("poi")),sku:String(e.sku||t||"").trim(),units:Math.max(0,Math.round(Number(e.units||0))),unitCostUsd:Number(e.unitCostUsd||0),unitExtraUsd:Number(e.unitExtraUsd||0),extraFlatUsd:Number(e.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(e.prodDays||0))),transitDays:Math.max(0,Math.round(Number(e.transitDays||0))),freightEur:Math.max(0,Number(e.freightEur||0))}}function Nu(e){const t=e!=null&&e.paymentLog&&typeof e.paymentLog=="object"?e.paymentLog:{};return Object.values(t).filter(r=>String((r==null?void 0:r.status)||"")==="paid").length}function Ta(e,t){const r=ir({items:e==null?void 0:e.items,orderDate:e==null?void 0:e.orderDate,fxRate:(e==null?void 0:e.fxOverride)??t.fxRate,fallback:e});return{goodsUsd:Yr(r.goodsUsd),goodsEur:Yr(r.goodsEur),freightEur:Yr(r.freightEur),units:Math.round(r.units),prodDays:Math.round(r.prodDays),transitDays:Math.round(r.transitDays)}}function Ra(e,t){const r=Pn(),a=Jt(e.items,t).map(d=>({id:String(d.id||zt("poi")),sku:String(d.sku||"").trim(),units:Math.max(0,Math.round(Number(d.units||0))),unitCostUsd:Number(d.unitCostUsd||0),unitExtraUsd:Number(d.unitExtraUsd||0),extraFlatUsd:Number(d.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(d.prodDays||0))),transitDays:Math.max(0,Math.round(Number(d.transitDays||0))),freightEur:Math.max(0,Number(d.freightEur||0))})),i=ir({items:a,orderDate:e.orderDate,fxRate:e.fxOverride,fallback:t}),u=a[0]||null,c=(e.milestones||[]).map(d=>({id:String(d.id||zt("ms")),label:String(d.label||"Milestone"),percent:Number(d.percent||0),anchor:String(d.anchor||"ORDER_DATE"),lagDays:Number(d.lagDays||0)}));return{...t||{},id:String(e.id||(t==null?void 0:t.id)||zt("po")),poNo:String(e.poNo||"").trim(),sku:String((u==null?void 0:u.sku)||(t==null?void 0:t.sku)||"").trim(),supplierId:String(e.supplierId||"").trim(),orderDate:e.orderDate||null,etdManual:e.etdManual||null,etaManual:e.etaManual||null,arrivalDate:e.arrivalDate||null,units:Math.max(0,Math.round(i.units||0)),unitCostUsd:Number((u==null?void 0:u.unitCostUsd)||0),unitExtraUsd:Number((u==null?void 0:u.unitExtraUsd)||0),extraFlatUsd:Number((u==null?void 0:u.extraFlatUsd)||0),prodDays:Number(i.prodDays||0),transitDays:Number(i.transitDays||0),transport:String(e.transport||"sea").toLowerCase(),freightEur:Number(i.freightEur||0),freightMode:"total",freightPerUnitEur:0,dutyRatePct:Number(e.dutyRatePct||0),dutyIncludeFreight:e.dutyIncludeFreight!==!1,eustRatePct:Number(e.eustRatePct||0),fxOverride:Number(e.fxOverride||0),ddp:e.ddp===!0,items:a,milestones:c,archived:e.archived===!0,createdAt:(t==null?void 0:t.createdAt)||r,updatedAt:r,paymentLog:(t==null?void 0:t.paymentLog)||{},autoEvents:(t==null?void 0:t.autoEvents)||void 0}}function Eu({embedded:e=!1}={}){const t=ra(),r=xr(),{state:a,loading:i,saving:u,error:c,lastSavedAt:d,saveWith:h}=Cr(),g=ri(),[f,p]=s.useState(""),[S,P]=s.useState("active"),[D,R]=s.useState("all"),[b,N]=s.useState(!1),[A,T]=s.useState(!1),[E,V]=s.useState(null),[W,Y]=s.useState([]),[K]=ye.useForm(),[Q]=ye.useForm(),[w,k]=s.useState(!1),[$,q]=s.useState(null),[F,x]=s.useState(null),[C,U]=s.useState([]),[y,H]=s.useState(null),[B,O]=s.useState(null),L=s.useRef(null),Z=s.useMemo(()=>new URLSearchParams(t.search).get("view")==="timeline"?"timeline":"table",[t.search]),I=a,oe=a.settings||{},se=s.useMemo(()=>ai(oe),[oe]),X=s.useMemo(()=>ii({userId:g.userId,userEmail:g.email},se),[se,g.email,g.userId]),de=s.useMemo(()=>`po:edit:${String(E||"new")}`,[E]),ne=mi({workspaceId:g.workspaceId,modalScope:de,isOpen:A,userId:g.userId,userEmail:g.email,userDisplayName:X,displayNames:se}),re=s.useMemo(()=>ju(I),[a.settings]),ae=s.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(l=>l).map(l=>({id:String(l.id||""),name:String(l.name||"—"),productionLeadTimeDaysDefault:Number(l.productionLeadTimeDaysDefault||0),paymentTermsDefault:Array.isArray(l.paymentTermsDefault)?l.paymentTermsDefault:[],raw:l})).filter(l=>l.id),[a.suppliers]),we=s.useMemo(()=>new Map(ae.map(l=>[l.id,l.name])),[ae]),Ce=s.useMemo(()=>new Map(ae.map(l=>[l.id,l])),[ae]),fe=s.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(l=>l).map(l=>({sku:String(l.sku||""),alias:String(l.alias||l.sku||""),supplierId:String(l.supplierId||""),raw:l})).filter(l=>l.sku),[a.products]),be=s.useMemo(()=>new Map(fe.map(l=>[l.sku,l])),[fe]),me=s.useMemo(()=>{const l=Array.isArray(a.payments)?a.payments:[];return(Array.isArray(a.pos)?a.pos:[]).map(_=>{var Pe;const j=_,ie=ir({items:j.items,orderDate:j.orderDate,fxRate:j.fxOverride??re.fxRate,fallback:j}),xe=String(ie.firstSku||j.sku||""),Me=_n({orderDate:j.orderDate,productionLeadTimeDays:ie.prodDays||j.prodDays,logisticsLeadTimeDays:ie.transitDays||j.transitDays,bufferDays:0}),Ee=String(j.etdManual||Me.etdDate||""),o=String(j.etaManual||Me.etaDate||""),v=Number(ie.goodsEur||0),z=ie.items.length,M=Array.isArray(j.items)?j.items.map(te=>String((te==null?void 0:te.sku)||"")).join(" "):"",ee=(()=>{try{const te=structuredClone(j);return Sa(te,ja,re,l)}catch{return[]}})(),he=(()=>{try{return Na(ee.map(te=>({id:String(te.id||""),eventIds:[String(te.id||"")],typeLabel:String(te.typeLabel||""),label:String(te.label||""),dueDate:te.dueDate?String(te.dueDate):null,plannedEur:Number(te.plannedEur||0),status:te.status==="paid"?"paid":"open",paidDate:te.paidDate?String(te.paidDate):null,paidEurActual:Number.isFinite(Number(te.paidEurActual))?Number(te.paidEurActual):null,paymentId:te.paymentId?String(te.paymentId):null,method:te.method?String(te.method):null,paidBy:te.paidBy?String(te.paidBy):null,note:String(te.note||""),invoiceDriveUrl:String(te.invoiceDriveUrl||""),invoiceFolderDriveUrl:String(te.invoiceFolderDriveUrl||""),eventType:te.eventType?String(te.eventType):null,direction:te.direction==="in"?"in":te.direction==="neutral"?"neutral":"out"})).filter(te=>te.eventType!=="vat_refund").filter(te=>te.id&&te.plannedEur>0)).map(te=>({id:te.id,eventIds:ar(te),typeLabel:te.typeLabel,label:te.label,dueDate:te.dueDate,plannedEur:te.plannedEur,status:te.status,paidDate:te.paidDate,eventType:te.eventType,direction:te.direction||"out"})).sort((te,ve)=>{const _e=String(te.dueDate||"").localeCompare(String(ve.dueDate||""));if(_e!==0)return _e;const Qe=Ea(te)-Ea(ve);return Qe!==0?Qe:String(te.label||"").localeCompare(String(ve.label||""))})}catch{return[]}})(),pe=ee.filter(te=>te.status==="paid").reduce((te,ve)=>te+Number(ve.plannedEur||0),0),J=ee.filter(te=>te.status!=="paid").reduce((te,ve)=>te+Number(ve.plannedEur||0),0),ge=J<=0&&pe>0?"paid_only":J>0&&pe>0?"mixed":"open";return{id:String(j.id||""),poNo:String(j.poNo||""),sku:xe,alias:((Pe=be.get(xe))==null?void 0:Pe.alias)||xe||"—",skuCount:z,supplierName:we.get(String(j.supplierId||""))||"—",orderDate:j.orderDate?String(j.orderDate):null,productionEndDate:Me.productionEndDate?String(Me.productionEndDate):null,etdDate:Ee||null,etaDate:o||null,arrivalDate:j.arrivalDate?String(j.arrivalDate):null,goodsEur:v,openEur:J,paidEur:pe,statusText:ge,itemSkusText:M,timelineMarkers:he,raw:j}}).sort((_,j)=>String(_.poNo||"").localeCompare(String(j.poNo||"")))},[re,be,a.payments,a.pos,we]),je=s.useMemo(()=>{const l=f.trim().toLowerCase();return me.filter(_=>{const j=_.raw.archived===!0;return S==="active"&&j||S==="archived"&&!j||D!=="all"&&_.statusText!==D||b&&_.openEur<=0?!1:l?[_.poNo,_.sku,_.alias,_.supplierName,_.itemSkusText].join(" ").toLowerCase().includes(l):!0})},[S,me,b,D,f]),Ie=s.useMemo(()=>Du({state:I,rows:je}),[je,I]),Be=s.useMemo(()=>xu(I),[I]),Ue=s.useMemo(()=>ci(Ie,Be),[Be,Ie]),ke=s.useMemo(()=>{if(!Ue.length)return null;const l=On(`${Ue[0]}-01`);if(!l)return null;const _=new Date(l.getTime());return _.setUTCMonth(_.getUTCMonth()+Be),{startMs:l.getTime(),endMs:_.getTime(),totalDays:Math.max(1,(_.getTime()-l.getTime())/os)}},[Be,Ue]),Ve=s.useMemo(()=>ke?Fn(new Date,ke):0,[ke]);function lt(l){const _=new URLSearchParams(t.search);l==="timeline"?_.set("view","timeline"):_.delete("view");const j=_.toString();r({pathname:t.pathname,search:j?`?${j}`:""},{replace:!0})}const mt=s.useMemo(()=>[{header:"PO",accessorKey:"poNo",meta:{width:98}},{header:"Produkt",meta:{width:260},cell:({row:l})=>l.original.skuCount>1?n.jsxs("div",{className:"v2-proj-alias",children:[n.jsxs("div",{className:"v2-proj-alias-main",title:`${l.original.skuCount} SKUs`,children:[n.jsxs("span",{children:[l.original.skuCount," SKUs"]}),n.jsx(pt,{className:"v2-po-sku-count-tag",style:{marginInlineStart:6},children:"Multi-SKU"})]}),n.jsxs(st,{className:"v2-proj-sku-secondary",type:"secondary",title:l.original.sku,children:["Start-SKU: ",l.original.sku]})]}):n.jsx(li,{alias:l.original.alias,sku:l.original.sku})},{header:"Supplier",accessorKey:"supplierName",meta:{width:150}},{header:"Order",meta:{width:112},cell:({row:l})=>Rt(l.original.orderDate)},{header:"ETD / ETA",meta:{width:162,sortAccessor:Su},cell:({row:l})=>n.jsxs(ze,{direction:"vertical",size:0,children:[n.jsxs(st,{children:["ETD ",Rt(l.original.etdDate)]}),n.jsxs(st,{type:"secondary",children:["ETA ",Rt(l.original.etaDate)]})]})},{header:"Warenwert",meta:{width:130,align:"right"},cell:({row:l})=>un(l.original.goodsEur)},{header:"Open / Paid",meta:{width:160,align:"right"},cell:({row:l})=>n.jsxs(ze,{direction:"vertical",size:0,children:[n.jsxs(st,{children:["Open: ",un(l.original.openEur)]}),n.jsxs(st,{type:"secondary",children:["Paid: ",un(l.original.paidEur)]})]})},{header:"Status",meta:{width:110},cell:({row:l})=>Mu(l.original.statusText)},{header:"Aktionen",meta:{width:190,minWidth:190},cell:({row:l})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(Re,{size:"small",onClick:()=>Ht(l.original.raw),children:"Bearbeiten"}),n.jsx(Re,{size:"small",danger:!0,onClick:()=>{$t.confirm({title:"PO loeschen?",onOk:async()=>{await h(_=>{const j=dn(_);return j.pos=(Array.isArray(j.pos)?j.pos:[]).filter(ie=>String(ie.id||"")!==l.original.id),j},"v2:po:delete")}})},children:"Loeschen"})]})}],[h]),G=ye.useWatch([],K),$e=ye.useWatch("supplierId",K),it=s.useMemo(()=>Jt(G==null?void 0:G.items,null).map(l=>Vt(l)),[G==null?void 0:G.items]),Fe=s.useMemo(()=>{var _;if(!G)return null;const l=E&&((_=me.find(j=>j.id===E))==null?void 0:_.raw)||null;return Ra({...G,items:it},l)},[me,it,G,E]),tt=s.useMemo(()=>ir({items:it,orderDate:G==null?void 0:G.orderDate,fxRate:(G==null?void 0:G.fxOverride)??re.fxRate,fallback:it.length?Fe:null}),[it,Fe,G==null?void 0:G.fxOverride,G==null?void 0:G.orderDate,re.fxRate]),le=it[0]||null,Ge=s.useMemo(()=>{var l;return le!=null&&le.sku&&((l=be.get(le.sku))==null?void 0:l.raw)||null},[le==null?void 0:le.sku,be]),Te=s.useMemo(()=>In({state:I,product:Ge||void 0,sku:String((le==null?void 0:le.sku)||""),supplierId:String((G==null?void 0:G.supplierId)||(Ge==null?void 0:Ge.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:le==null?void 0:le.unitCostUsd,prodDays:le==null?void 0:le.prodDays,transitDays:le==null?void 0:le.transitDays,dutyRatePct:G==null?void 0:G.dutyRatePct,eustRatePct:G==null?void 0:G.eustRatePct,ddp:G==null?void 0:G.ddp,incoterm:G!=null&&G.ddp?"DDP":"EXW"}}),[G==null?void 0:G.ddp,G==null?void 0:G.dutyRatePct,G==null?void 0:G.eustRatePct,G==null?void 0:G.supplierId,le==null?void 0:le.prodDays,le==null?void 0:le.sku,le==null?void 0:le.transitDays,le==null?void 0:le.unitCostUsd,Ge,I]),Xe=s.useMemo(()=>In({state:I,product:Ge||void 0,sku:String((le==null?void 0:le.sku)||""),supplierId:String((G==null?void 0:G.supplierId)||(Ge==null?void 0:Ge.supplierId)||""),orderContext:"po"}),[G==null?void 0:G.supplierId,le==null?void 0:le.sku,Ge,I]),Se=s.useMemo(()=>tr({product:Ge,state:I,supplierId:String((G==null?void 0:G.supplierId)||(Ge==null?void 0:Ge.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:le==null?void 0:le.unitCostUsd,prodDays:le==null?void 0:le.prodDays,transitDays:le==null?void 0:le.transitDays,dutyRatePct:G==null?void 0:G.dutyRatePct,eustRatePct:G==null?void 0:G.eustRatePct,ddp:G==null?void 0:G.ddp,incoterm:G!=null&&G.ddp?"DDP":"EXW"}}),[G==null?void 0:G.ddp,G==null?void 0:G.dutyRatePct,G==null?void 0:G.eustRatePct,G==null?void 0:G.supplierId,le==null?void 0:le.prodDays,le==null?void 0:le.transitDays,le==null?void 0:le.unitCostUsd,Ge,I]);function m(l){if(!le)return;const _=Jt(K.getFieldValue("items"),null).map(ie=>Vt(ie)),j=_.findIndex(ie=>ie.id===le.id);if(l==="unitCostUsd"&&j>=0){_[j]={..._[j],unitCostUsd:Number(Xe.fields.unitPriceUsd.value||0)},K.setFieldValue("items",_);return}if(l==="prodDays"&&j>=0){_[j]={..._[j],prodDays:Math.round(Number(Xe.fields.productionLeadTimeDays.value||0))},K.setFieldValue("items",_);return}if(l==="transitDays"&&j>=0){_[j]={..._[j],transitDays:Math.round(Number(Xe.fields.transitDays.value||0))},K.setFieldValue("items",_);return}if(l==="dutyRatePct"){K.setFieldValue("dutyRatePct",Number(Xe.fields.dutyRatePct.value||0));return}if(l==="eustRatePct"){K.setFieldValue("eustRatePct",Number(Xe.fields.eustRatePct.value||0));return}K.setFieldValue("ddp",Xe.fields.ddp.value===!0)}function Ne(l,_){const j=String((le==null?void 0:le.sku)||"").trim();j&&$t.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${j}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{$t.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await h(ie=>{const xe=dn(ie),Me=Array.isArray(xe.products)?[...xe.products]:[],Ee=Me.findIndex(v=>String(v.sku||"").trim().toLowerCase()===j.toLowerCase());if(Ee<0)return xe;const o=Me[Ee];return Me[Ee]={...di({product:o,field:l,value:_}),updatedAt:Pn()},xe.products=Me,xe},"v2:po:adopt-masterdata"),sn.success("Produkt-Stammdaten aktualisiert.")}})}})}const ue=s.useMemo(()=>{const l=String($e||"");if(!l)return[];const _=new Set(it.map(j=>j.sku));return fe.filter(j=>j.supplierId===l).map(j=>({value:j.sku,label:`${j.alias} (${j.sku})`,disabled:_.has(j.sku)}))},[it,fe,$e]),De=s.useMemo(()=>{const l=[];return it.forEach(_=>{const j=[];_.units<=0&&j.push("Units <= 0"),_.unitCostUsd<=0&&j.push("Unit Cost fehlt"),_.prodDays<=0&&j.push("Prod Days fehlen"),_.transitDays<=0&&j.push("Transit Days fehlen"),j.length&&l.push(`${_.sku||"SKU?"}: ${j.join(", ")}`)}),l},[it]),Oe=s.useMemo(()=>{if(!Fe)return[];try{const l=structuredClone(Fe);return Sa(l,ja,re,Array.isArray(a.payments)?a.payments:[]).filter(j=>String(j.eventType||"")!=="vat_refund").map(j=>({id:String(j.id||""),eventIds:[String(j.id||"")],typeLabel:String(j.typeLabel||""),label:String(j.label||""),dueDate:j.dueDate?String(j.dueDate):null,plannedEur:Number(j.plannedEur||0),status:j.status==="paid"?"paid":"open",paidDate:j.paidDate?String(j.paidDate):null,paidEurActual:Number.isFinite(Number(j.paidEurActual))?Number(j.paidEurActual):null,paymentId:j.paymentId?String(j.paymentId):null,method:j.method?String(j.method):null,paidBy:j.paidBy?String(j.paidBy):null,note:String(j.note||""),invoiceDriveUrl:String(j.invoiceDriveUrl||""),invoiceFolderDriveUrl:String(j.invoiceFolderDriveUrl||""),eventType:j.eventType?String(j.eventType):null}))}catch{return[]}},[Fe,re,a.payments]),qe=s.useMemo(()=>Na(Oe),[Oe]);s.useEffect(()=>{if(!y||!A||E!==y.poId||!Fe)return;const l=qe.find(_=>_.id===y.eventId)||null;if(l){nn(l),H(null);return}O("payments"),H(null)},[qe,Fe,E,y,A]),s.useEffect(()=>{if(!A||!B)return;const l=j=>{j&&(j.scrollIntoView({block:"center",behavior:"smooth"}),j.focus())},_=window.requestAnimationFrame(()=>{if(B==="payments"){const j=L.current;j&&j.scrollIntoView({block:"center",behavior:"smooth"}),O(null);return}if(B==="shipping"){l(document.getElementById("v2-po-etd-manual")),O(null);return}B==="arrival"&&(l(document.getElementById("v2-po-arrival-date")),O(null))});return()=>{window.cancelAnimationFrame(_)}},[B,A]);const Ye=s.useMemo(()=>{const l=new Map;return(Array.isArray(a.payments)?a.payments:[]).forEach(_=>{const j=_,ie=String(j.id||"").trim();ie&&l.set(ie,j)}),l},[a.payments]),ft=s.useMemo(()=>Pu({displayNameMap:se,syncEmail:g.email}),[se,g.email]),Dt=s.useMemo(()=>ku(),[]),Et=ye.useWatch("selectedEventIds",Q),nt=ye.useWatch([],Q),ht=s.useMemo(()=>{const l=new Set((Et||[]).map(_=>String(_||"")));return qe.filter(_=>l.has(_.id))},[qe,Et]),Ft=s.useMemo(()=>{var xe,Me;if(!Fe||!nt)return"";const l=Jt(Fe.items,Fe),_=String(((xe=l[0])==null?void 0:xe.sku)||Fe.sku||""),j=l.length,ie=j>1?`Multi-SKU-${j}`:((Me=be.get(_))==null?void 0:Me.alias)||_||"Alias";return wu({paidDate:nt.paidDate,poNo:String(Fe.poNo||""),alias:ie,units:Number(Fe.units||0),selectedRows:ht})},[Fe,nt,ht,be]);s.useEffect(()=>{!A||!ne.readOnly||!ne.remoteDraftPatch||K.setFieldsValue(ne.remoteDraftPatch)},[K,ne.readOnly,ne.remoteDraftPatch,ne.remoteDraftVersion,A]);function At(l,_){var J,ge,Pe,te;const j=String((_==null?void 0:_.sku)||"").trim(),ie=Math.max(0,Math.round(Number((_==null?void 0:_.units)||0))),xe=j?String(((J=be.get(j))==null?void 0:J.supplierId)||""):"",Me=String((_==null?void 0:_.supplierId)||(l==null?void 0:l.supplierId)||xe||((ge=ae[0])==null?void 0:ge.id)||""),Ee=Ce.get(Me)||null,o=Jt(l==null?void 0:l.items,l).map(ve=>Vt(ve)),v=Jt(_==null?void 0:_.items,null).map(ve=>Vt(ve));let z=v.length?v:o;if(!z.length&&j){const ve=be.get(j)||null,_e=An({state:I,product:(ve==null?void 0:ve.raw)||null,settings:oe,supplierId:Me,supplierDefaultProdDays:Ee==null?void 0:Ee.productionLeadTimeDaysDefault,units:ie});z=[Vt({id:zt("poi"),sku:j,units:ie,unitCostUsd:_e.unitCostUsd,unitExtraUsd:_e.unitExtraUsd,extraFlatUsd:_e.extraFlatUsd,prodDays:_e.prodDays,transitDays:_e.transitDays,freightEur:_e.freightEur})]}if(!z.length&&(l!=null&&l.sku)){const ve=String(l.sku||"").trim(),_e=Math.max(0,Math.round(Number(l.units||0))),Qe=be.get(ve)||null,We=An({state:I,product:(Qe==null?void 0:Qe.raw)||null,settings:oe,supplierId:Me,supplierDefaultProdDays:Ee==null?void 0:Ee.productionLeadTimeDaysDefault,units:_e});z=[Vt({id:zt("poi"),sku:ve,units:_e,unitCostUsd:Number(l.unitCostUsd??We.unitCostUsd??0),unitExtraUsd:Number(l.unitExtraUsd??We.unitExtraUsd??0),extraFlatUsd:Number(l.extraFlatUsd??We.extraFlatUsd??0),prodDays:Number(l.prodDays??We.prodDays??0),transitDays:Number(l.transitDays??We.transitDays??0),freightEur:Number(l.freightEur??We.freightEur??0)})]}const M=z.filter(ve=>{var Qe;if(!Me)return!0;const _e=String(((Qe=be.get(ve.sku))==null?void 0:Qe.supplierId)||"");return _e?_e===Me:!0}),ee=be.get(String(((Pe=M[0])==null?void 0:Pe.sku)||j||(l==null?void 0:l.sku)||""))||null,he=An({state:I,product:(ee==null?void 0:ee.raw)||null,settings:oe,supplierId:Me,supplierDefaultProdDays:Ee==null?void 0:Ee.productionLeadTimeDaysDefault,units:((te=M[0])==null?void 0:te.units)||ie}),pe=ya((Ee==null?void 0:Ee.raw)||null).map(ve=>({id:ve.id,label:ve.label,percent:ve.percent,anchor:ve.anchor,lagDays:ve.lagDays}));return{id:l!=null&&l.id?String(l.id):void 0,poNo:String((l==null?void 0:l.poNo)||""),supplierId:Me,orderDate:String((_==null?void 0:_.orderDate)||(l==null?void 0:l.orderDate)||new Date().toISOString().slice(0,10)),etdManual:String((_==null?void 0:_.etdManual)||(l==null?void 0:l.etdManual)||""),etaManual:String((_==null?void 0:_.etaManual)||(l==null?void 0:l.etaManual)||""),arrivalDate:String((_==null?void 0:_.arrivalDate)||(l==null?void 0:l.arrivalDate)||""),transport:String((l==null?void 0:l.transport)||he.transport||"sea").toLowerCase(),dutyRatePct:Number((l==null?void 0:l.dutyRatePct)??he.dutyRatePct??oe.dutyRatePct??0),dutyIncludeFreight:(l==null?void 0:l.dutyIncludeFreight)!==!1,eustRatePct:Number((l==null?void 0:l.eustRatePct)??he.eustRatePct??oe.eustRatePct??0),fxOverride:Number((l==null?void 0:l.fxOverride)??he.fxOverride??oe.fxRate??0),ddp:(l==null?void 0:l.ddp)===!0?!0:!!he.ddp,archived:(l==null?void 0:l.archived)===!0,milestones:Array.isArray(l==null?void 0:l.milestones)?(l==null?void 0:l.milestones).map(ve=>({id:String(ve.id||zt("ms")),label:String(ve.label||"Milestone"),percent:Number(ve.percent||0),anchor:String(ve.anchor||"ORDER_DATE"),lagDays:Number(ve.lagDays||0)})):pe.length?pe:Wr(),items:M}}function Yt(l,_){var z;const j=String(_||"").trim();if(!j)return;const ie=be.get(j)||null;if(!ie)return;const xe=K.getFieldsValue(),Me=Jt(xe.items,null).map(M=>Vt(M));if(l<0||l>=Me.length)return;const Ee=String(xe.supplierId||ie.supplierId||""),o=Ce.get(Ee)||null,v=An({state:I,product:ie.raw,settings:oe,supplierId:Ee,supplierDefaultProdDays:o==null?void 0:o.productionLeadTimeDaysDefault,units:Number(((z=Me[l])==null?void 0:z.units)||0)});Me[l]=Vt({...Me[l],sku:j,unitCostUsd:v.unitCostUsd,unitExtraUsd:v.unitExtraUsd,extraFlatUsd:v.extraFlatUsd,prodDays:v.prodDays,transitDays:v.transitDays,freightEur:v.freightEur}),K.setFieldsValue({items:Me,supplierId:Ee||xe.supplierId,transport:xe.transport||v.transport,dutyRatePct:Number(xe.dutyRatePct||v.dutyRatePct||0),eustRatePct:Number(xe.eustRatePct||v.eustRatePct||0),fxOverride:Number(xe.fxOverride||v.fxOverride||0),ddp:xe.ddp===!0?!0:v.ddp})}function Gt(l){var o;const _=K.getFieldsValue(),j=Jt(_.items,null).map(v=>Vt(v)),ie=new Set(j.map(v=>v.sku)),xe=String(_.supplierId||""),Me=Ce.get(xe)||null,Ee=[];l.forEach(v=>{const z=String(v||"").trim();if(!z||ie.has(z))return;const M=be.get(z);if(!M||String(M.supplierId||"")!==xe)return;const ee=An({state:I,product:M.raw,settings:oe,supplierId:xe,supplierDefaultProdDays:Me==null?void 0:Me.productionLeadTimeDaysDefault,units:0});Ee.push(Vt({id:zt("poi"),sku:z,units:0,unitCostUsd:ee.unitCostUsd,unitExtraUsd:ee.unitExtraUsd,extraFlatUsd:ee.extraFlatUsd,prodDays:ee.prodDays,transitDays:ee.transitDays,freightEur:ee.freightEur}))}),Ee.length&&(K.setFieldsValue({items:[...j,...Ee],transport:_.transport||An({state:I,product:((o=be.get(Ee[0].sku))==null?void 0:o.raw)||null,settings:oe,supplierId:xe,supplierDefaultProdDays:Me==null?void 0:Me.productionLeadTimeDaysDefault,units:Ee[0].units}).transport}),Y([]))}function dt(l){const _=String(l||""),j=K.getFieldsValue(),ie=Jt(j.items,null).map(v=>Vt(v)),xe=ie.filter(v=>{var M;const z=String(((M=be.get(v.sku))==null?void 0:M.supplierId)||"");return z?z===_:!0});ie.length!==xe.length&&sn.info(`${ie.length-xe.length} SKU(s) wurden entfernt, da sie nicht zum Lieferanten passen.`);const Me=Ce.get(_)||null,Ee=ya((Me==null?void 0:Me.raw)||null).map(v=>({id:v.id,label:v.label,percent:v.percent,anchor:v.anchor,lagDays:v.lagDays})),o=!E&&(!Array.isArray(j.milestones)||Zn(j.milestones)===Zn(Wr()));K.setFieldsValue({supplierId:_,items:xe,milestones:o?Ee.length?Ee:Wr():j.milestones}),Y([])}function _t(l){V(null),O(null);const _=At(null,l);K.resetFields(),K.setFieldsValue({..._,...l||{}}),Y([]),T(!0)}function Ht(l,_=null){V(String(l.id||"")),O(_),K.resetFields(),K.setFieldsValue(At(l)),Y([]),T(!0)}function hn(l){const _=Array.isArray(l.items)?l.items:null;if(!(_!=null&&_.length)||!_.some(v=>v&&Object.prototype.hasOwnProperty.call(v,"units")))return;const ie=K.getFieldsValue(),xe=String(ie.supplierId||""),Me=Jt(ie.items,null).map(v=>Vt(v));let Ee=!1;const o=Me.map((v,z)=>{const M=_[z];if(!!!(M&&Object.prototype.hasOwnProperty.call(M,"units"))||!v.sku||Number(v.freightEur||0)>0)return v;const he=be.get(v.sku)||null;if(!he)return v;const pe=Iu({state:I,product:he.raw,supplierId:xe||he.supplierId,units:v.units});return pe<=0?v:(Ee=!0,{...v,freightEur:pe})});Ee&&K.setFieldValue("items",o)}function on(l,_){H({poId:l.id,eventId:_.id}),Ht(l.raw,"payments")}function nn(l){if(!E){sn.info("Bitte PO zuerst speichern, danach koennen Zahlungen verbucht werden.");return}const _=new Date().toISOString().slice(0,10),j=l||null,ie=(j==null?void 0:j.paymentId)||null,xe=ie?qe.filter(M=>M.paymentId===ie):j?[j]:qe.filter(M=>M.status!=="paid"),Me=xe.map(M=>M.id),Ee=Array.from(new Set(xe.flatMap(M=>ar(M)))),o=xe.reduce((M,ee)=>M+Number(ee.plannedEur||0),0),v=ie&&Ye.get(ie)||null,z=String((v==null?void 0:v.id)||ie||$r(zt("pay"))||zt("pay"));Q.setFieldsValue({selectedEventIds:Me,paidDate:String((v==null?void 0:v.paidDate)||(j==null?void 0:j.paidDate)||_),method:String((v==null?void 0:v.method)||(j==null?void 0:j.method)||"Alibaba Trade Assurance"),paidBy:String((v==null?void 0:v.payer)||(j==null?void 0:j.paidBy)||X||g.email||""),amountActualEur:Number.isFinite(Number(v==null?void 0:v.amountActualEurTotal))?Number(v==null?void 0:v.amountActualEurTotal):Math.round(o*100)/100,amountActualUsd:Number.isFinite(Number(v==null?void 0:v.amountActualUsdTotal))?Number(v==null?void 0:v.amountActualUsdTotal):null,paymentId:z,invoiceDriveUrl:String((v==null?void 0:v.invoiceDriveUrl)||(j==null?void 0:j.invoiceDriveUrl)||""),invoiceFolderDriveUrl:String((v==null?void 0:v.invoiceFolderDriveUrl)||(j==null?void 0:j.invoiceFolderDriveUrl)||""),note:String((v==null?void 0:v.note)||(j==null?void 0:j.note)||"")}),U(Ee),q(v!=null&&v.id?String(v.id):null),x(null),k(!0)}async function pn(l){if(ne.readOnly)throw new Error("Nur Lesemodus: keine Zahlungen speichern.");if(!E)throw new Error("PO muss zuerst gespeichert werden.");const _=Array.from(new Set((l.selectedEventIds||[]).map(pe=>String(pe||"").trim()).filter(Boolean)));if(!_.length)throw new Error("Bitte mindestens einen Zahlungsbaustein auswaehlen.");if(!l.paidDate)throw new Error("Bitte ein Zahlungsdatum setzen.");if(!l.method.trim())throw new Error("Bitte eine Zahlungsmethode waehlen.");if(!l.paidBy.trim())throw new Error("Bitte angeben, wer gezahlt hat.");const j=Number(l.amountActualEur);if(!Number.isFinite(j)||j<0)throw new Error("Bitte einen gueltigen Ist-Betrag in EUR eingeben.");if(l.invoiceDriveUrl&&!Zr(l.invoiceDriveUrl))throw new Error("Invoice-Link muss mit http:// oder https:// beginnen.");if(l.invoiceFolderDriveUrl&&!Zr(l.invoiceFolderDriveUrl))throw new Error("Folder-Link muss mit http:// oder https:// beginnen.");const ie=String($r(l.paymentId)||$r(zt("pay"))||zt("pay")),xe=qe.filter(pe=>_.includes(pe.id)),Me=Array.from(new Set(xe.flatMap(pe=>ar(pe))));if(!Me.length)throw new Error("Bitte mindestens einen gueltigen Zahlungsbaustein auswaehlen.");const Ee=Oe.filter(pe=>Me.includes(pe.id)),o=to(j,Ee.map(pe=>({id:pe.id,plannedEur:pe.plannedEur})));if(!o||!o.length)throw new Error("Konnte die Zahlung nicht auf die gewaehlten Bausteine verteilen.");const v=Number(l.amountActualUsd),z=Number.isFinite(v)?v:null,M=Ee.reduce((pe,J)=>pe+Number(J.plannedEur||0),0),ee=z!=null&&M>0?Ee.map(pe=>{const J=Number(pe.plannedEur||0)/M;return{eventId:pe.id,actual:Math.round(z*J*100)/100}}):[],he=new Map(ee.map(pe=>[pe.eventId,pe.actual]));await h(pe=>{var Qt,bt,Wt;const J=dn(pe),ge=Array.isArray(J.pos)?[...J.pos]:[],Pe=ge.findIndex(ct=>String(ct.id||"")===E);if(Pe<0)throw new Error("PO nicht gefunden.");const te={...ge[Pe]},ve=te.paymentLog&&typeof te.paymentLog=="object"?{...te.paymentLog}:{},_e=$?String($):null;C.forEach(ct=>{if(Me.includes(ct))return;const Bt=ve[ct]&&typeof ve[ct]=="object"?{...ve[ct]}:{};ve[ct]={...Bt,status:"open",paidDate:null,paymentId:null,amountActualEur:null,amountActualUsd:null,method:null,payer:null,note:null}}),o.forEach(ct=>{var rn;const Bt=ve[ct.eventId]&&typeof ve[ct.eventId]=="object"?{...ve[ct.eventId]}:{};ve[ct.eventId]={...Bt,paymentInternalId:String(Bt.paymentInternalId||zt("payrow")),status:"paid",paidDate:l.paidDate,paymentId:ie,amountActualEur:Number(ct.actual||0),amountActualUsd:he.get(ct.eventId)??null,method:l.method.trim(),payer:l.paidBy.trim(),note:((rn=l.note)==null?void 0:rn.trim())||null}}),te.paymentLog=ve,te.updatedAt=Pn(),ge[Pe]=te,J.pos=ge;const Qe=Array.isArray(J.payments)?[...J.payments]:[],We=Qe.findIndex(ct=>String(ct.id||"")===ie);if(We>=0&&(!_e||String(Qe[We].id||"")!==_e)){const ct=new Set(Qe[We].coveredEventIds||[]);if(!Me.some(rn=>ct.has(rn))&&ie!==_e)throw new Error(`Payment-ID ${ie} ist bereits vergeben.`)}const ut={id:ie,paidDate:l.paidDate,method:l.method.trim(),payer:l.paidBy.trim(),currency:"EUR",amountActualEurTotal:j,amountActualUsdTotal:z,coveredEventIds:Me,note:((Qt=l.note)==null?void 0:Qt.trim())||null,invoiceDriveUrl:((bt=l.invoiceDriveUrl)==null?void 0:bt.trim())||"",invoiceFolderDriveUrl:((Wt=l.invoiceFolderDriveUrl)==null?void 0:Wt.trim())||""},xt=Qe.findIndex(ct=>String(ct.id||"")===ie);return xt>=0?Qe[xt]={...Qe[xt],...ut}:Qe.push(ut),J.payments=Qe,J},"v2:po:payment-booking"),k(!1),q(null),U([]),x(null),Q.resetFields(),sn.success("Zahlung wurde gespeichert.")}async function ln(l,_=!1){var he,pe;if(ne.readOnly)throw new Error("Diese PO wird gerade von einem anderen Nutzer bearbeitet.");if(!l.poNo.trim())throw new Error("PO Nummer ist erforderlich.");const j=Jt(l.items,null).map(J=>Vt(J));if(!j.length)throw new Error("Bitte mindestens eine SKU in der PO erfassen.");const ie=String(l.supplierId||"").trim();if(!ie)throw new Error("Bitte einen Lieferanten auswaehlen.");const xe=j.find(J=>{var ge;return String(((ge=be.get(J.sku))==null?void 0:ge.supplierId)||"")!==ie});if(xe)throw new Error(`SKU ${xe.sku} gehoert nicht zum gewaehlten Lieferanten.`);const Me=j.find(J=>J.units<=0||J.unitCostUsd<=0||J.prodDays<=0||J.transitDays<=0);if(Me)throw new Error(`SKU ${Me.sku} ist unvollstaendig. Bitte Units, Unit Cost, Prod Days und Transit Days pflegen.`);const Ee=j.find(J=>{var te;const ge=((te=be.get(J.sku))==null?void 0:te.raw)||null;return ge?tr({product:ge,state:I,supplierId:ie,orderContext:"po",orderOverrides:{unitCostUsd:J.unitCostUsd,prodDays:J.prodDays,transitDays:J.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}}).blocked:!1});if(Ee){const J=((he=be.get(Ee.sku))==null?void 0:he.raw)||null,ge=tr({product:J,state:I,supplierId:ie,orderContext:"po",orderOverrides:{unitCostUsd:Ee.unitCostUsd,prodDays:Ee.prodDays,transitDays:Ee.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}});throw new Error(`SKU ${Ee.sku}: blockierende Stammdaten fehlen (${ge.issues.map(Pe=>Pe.label).join(", ")}).`)}const o=Zn(l.milestones||[]);if(Math.abs(o-100)>.01)throw new Error("Milestone Prozentwerte muessen 100% ergeben.");const v=E&&((pe=me.find(J=>J.id===E))==null?void 0:pe.raw)||null,z={...l,supplierId:ie,items:j},M=Ra(z,v);if(Nu(v)>0&&!_){const J=Ta(v,re),ge=Ta(M,re);if(J.goodsUsd!==ge.goodsUsd||J.goodsEur!==ge.goodsEur||J.freightEur!==ge.freightEur||J.units!==ge.units||J.prodDays!==ge.prodDays||J.transitDays!==ge.transitDays){$t.confirm({title:"Bereits bezahlte Events vorhanden",content:"Du hast Positionen oder Summen geaendert, obwohl bereits Zahlungen verbucht sind. Bitte bewusst bestaetigen.",okText:"Trotzdem speichern",cancelText:"Abbrechen",onOk:()=>void ln(z,!0)});return}}await h(J=>{const ge=dn(J),Pe=Array.isArray(ge.pos)?[...ge.pos]:[];if(Pe.find(_e=>String(_e.poNo||"")===M.poNo&&String(_e.id||"")!==String(M.id||"")))throw new Error(`PO Nummer ${M.poNo} existiert bereits.`);const ve=Pe.findIndex(_e=>String(_e.id||"")===String(M.id||""));return ve>=0?Pe[ve]=M:Pe.push(M),ge.pos=Pe,ge},E?"v2:po:update":"v2:po:create"),ne.clearDraft(),T(!1),O(null),H(null),V(null),Y([]),K.resetFields()}return s.useEffect(()=>{const l=new URLSearchParams(t.search),_=l.get("source"),j=z=>{let M=!1;if(z.forEach(he=>{l.has(he)&&(l.delete(he),M=!0)}),!M)return;const ee=l.toString();r({pathname:t.pathname,search:ee?`?${ee}`:""},{replace:!0})};if(_==="fo_convert"){const z=String(l.get("poNo")||"").trim();z&&p(z),j(["source","poNo"]);return}if(_!=="inventory_projection")return;const ie=String(l.get("sku")||"").trim();if(!ie)return;const xe=fe.find(z=>z.sku===ie)||null,Me=Math.max(0,Math.round(Number(l.get("suggestedUnits")||0))),Ee=String(l.get("requiredArrivalDate")||""),o=String(l.get("recommendedOrderDate")||""),v={sku:ie,units:Me};xe!=null&&xe.supplierId&&(v.supplierId=String(xe.supplierId)),Ee&&(v.etaManual=Ee),o&&(v.orderDate=o),_t(v),j(["source","sku","suggestedUnits","requiredArrivalDate","recommendedOrderDate"])},[t.pathname,t.search,r,fe]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(Nt,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(yu,{level:3,children:"Purchase Orders"}),n.jsx(vu,{children:"PO-Stammdaten, Milestones, Auto-Events und Payment-Status in einem konsistenten Arbeitsbereich."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(Re,{type:"primary",onClick:()=>_t(),children:"Neue PO"}),n.jsx(aa,{value:Z,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:l=>lt(String(l)==="timeline"?"timeline":"table")}),u?n.jsx(pt,{color:"processing",children:"Speichern..."}):null,d?n.jsxs(pt,{color:"green",children:["Gespeichert: ",new Date(d).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(It,{type:"error",showIcon:!0,message:c}):null,i?n.jsx(It,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(Nt,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(vt,{placeholder:"PO Nummer, SKU, Alias, Supplier",value:f,onChange:l=>p(l.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Ct,{value:S,onChange:l=>P(String(l)),options:[{value:"active",label:"Aktiv"},{value:"archived",label:"Archiv"},{value:"all",label:"Aktiv + Archiv"}],style:{width:170}}),n.jsx(Ct,{value:D,onChange:l=>R(String(l)),options:[{value:"all",label:"Status: Alle"},{value:"open",label:"Status: Offen"},{value:"mixed",label:"Status: Teilweise bezahlt"},{value:"paid_only",label:"Status: Bezahlt"}],style:{width:220}}),n.jsx(en,{checked:b,onChange:l=>N(l.target.checked),children:"Nur POs mit offenen Zahlungen"})]}),Z==="table"?n.jsx(oi,{data:je,columns:mt,minTableWidth:1360,tableLayout:"auto"}):n.jsxs("div",{className:"v2-po-timeline",children:[n.jsxs("div",{className:"v2-po-timeline-head",style:{"--po-timeline-cols":Ue.length},children:[n.jsx("div",{className:"v2-po-timeline-head-cell v2-po-timeline-head-cell--meta",children:"PO / Supplier"}),Ue.map(l=>n.jsx("div",{className:"v2-po-timeline-head-cell",children:Ls(l)},l))]}),je.length?null:n.jsx(It,{type:"info",showIcon:!0,message:"Keine POs für die aktuelle Suche/Filter."}),je.map(l=>{const _=On(l.orderDate),j=On(l.productionEndDate),ie=On(l.etdDate),xe=On(l.etaDate),Me=ke?Fn(_,ke):0,Ee=ke?Fn(j,ke):0,o=ke?Fn(ie,ke):0,v=ke?Fn(xe,ke):0,z=Math.max(.75,Ee-Me),M=Math.max(.75,v-o);return n.jsxs("div",{className:"v2-po-timeline-row",children:[n.jsxs("button",{type:"button",className:"v2-po-timeline-meta",onClick:()=>Ht(l.raw),children:[n.jsx("div",{className:"v2-po-timeline-title",children:l.poNo||"PO"}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:[l.supplierName," · ",l.skuCount>1?`Multi-SKU (${l.skuCount}), Start ${l.sku}`:l.alias]}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:["Order ",Rt(l.orderDate)," · ETA ",Rt(l.etaDate)]}),n.jsxs("div",{className:"v2-po-timeline-action-row",children:[n.jsx(Re,{size:"small",onClick:ee=>{ee.stopPropagation(),Ht(l.raw,"shipping")},children:"Versendet am..."}),n.jsx(Re,{size:"small",onClick:ee=>{ee.stopPropagation(),Ht(l.raw,"arrival")},children:"Empfangen am..."})]})]}),n.jsxs("div",{className:"v2-po-timeline-track",children:[n.jsx("div",{className:"v2-po-timeline-track-bg"}),ke?n.jsx("div",{className:"v2-po-timeline-today",style:{left:`${Ve}%`},title:"Heute"}):null,ke&&z>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--production",style:{left:`${Me}%`,width:`${z}%`},title:"Produktion"}):null,ke&&M>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--transit",style:{left:`${o}%`,width:`${M}%`},title:"Transit"}):null,ke?l.timelineMarkers.map(ee=>{const he=On(ee.dueDate),pe=Fn(he,ke),J=ee.status==="paid"?"v2-po-timeline-marker v2-po-timeline-marker--paid":"v2-po-timeline-marker v2-po-timeline-marker--open",ge=ee.direction==="in"?"v2-po-timeline-marker--incoming":"",Pe=[`${er(ee)} (${ee.status==="paid"?"bezahlt":"offen"})`,`Soll: ${un(ee.plannedEur)}`,`Faellig: ${Rt(ee.dueDate)}`,ee.paidDate?`Bezahlt am: ${Rt(ee.paidDate)}`:"Bezahlt am: —"].join(`
`);return n.jsx(si,{title:n.jsx("span",{style:{whiteSpace:"pre-line"},children:Pe}),children:n.jsx("button",{type:"button",className:`${J} ${ge}`.trim(),style:{left:`${pe}%`},onClick:()=>on(l,ee),"aria-label":`${er(ee)} fuer ${l.poNo}`})},ee.id)}):null]})]},l.id)}),n.jsxs("div",{className:"v2-po-timeline-legend",children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--production"})," Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--transit"})," Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--open"})," Zahlung offen"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--paid"})," Zahlung bezahlt"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-line"})," Heute"]})]})]})]}),n.jsxs($t,{title:E?"PO bearbeiten":"PO anlegen",open:A,width:1120,onCancel:()=>{ne.clearDraft(),T(!1),O(null),H(null),Y([])},onOk:()=>{if(ne.readOnly){$t.warning({title:"Nur Lesemodus",content:`${ne.remoteUserLabel||"Kollege"} bearbeitet diese PO. Bitte Bearbeitung übernehmen oder warten.`});return}K.validateFields().then(l=>ln(l)).catch(l=>{if(l&&typeof l=="object"&&"errorFields"in l)return;const _=l instanceof Error?l.message:l&&typeof l=="object"&&"message"in l?String(l.message||""):"";_&&sn.error(_)})},children:[ne.banner?n.jsx(It,{style:{marginBottom:10},type:ne.banner.tone,showIcon:!0,message:ne.banner.text,action:ne.readOnly?n.jsx(Re,{size:"small",onClick:ne.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,ne.readOnly&&ne.remoteDraftVersion>0?n.jsxs(pt,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",ne.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,n.jsxs(ye,{name:"v2-po-modal",form:K,layout:"vertical",disabled:ne.readOnly,onValuesChange:l=>{ne.readOnly||(hn(l),ne.publishDraftPatch(l))},children:[n.jsx(ye.Item,{name:"id",hidden:!0,children:n.jsx(vt,{})}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"poNo",label:"PO Nummer",style:{width:190},rules:[{required:!0,message:"PO Nummer ist erforderlich."}],children:n.jsx(vt,{})}),n.jsx(ye.Item,{name:"supplierId",label:"Supplier",style:{minWidth:260,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:ae.map(l=>({value:l.id,label:l.name})),onChange:l=>dt(String(l||""))})}),n.jsx(ye.Item,{name:"transport",label:"Transport",style:{width:150},children:n.jsx(Ct,{options:[{value:"sea",label:"SEA"},{value:"rail",label:"RAIL"},{value:"air",label:"AIR"}]})})]}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"orderDate",label:"Order Date",style:{width:190},rules:[{required:!0}],children:n.jsx(vt,{type:"date"})}),n.jsx(ye.Item,{name:"etdManual",label:"ETD Manual",style:{width:190},children:n.jsx(vt,{id:"v2-po-etd-manual",type:"date"})}),n.jsx(ye.Item,{name:"etaManual",label:"ETA Manual",style:{width:190},children:n.jsx(vt,{type:"date"})}),n.jsx(ye.Item,{name:"arrivalDate",label:"Empfangen am",style:{width:190},children:n.jsx(vt,{id:"v2-po-arrival-date",type:"date"})}),n.jsx(ye.Item,{name:"fxOverride",label:"FX Override",style:{width:150},children:n.jsx(yt,{mode:"fx",min:0})}),n.jsx(ye.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(yt,{mode:"percent",min:0,max:100})}),n.jsx(ye.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(yt,{mode:"percent",min:0,max:100})})]}),n.jsxs(ze,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(ye.Item,{name:"dutyIncludeFreight",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"Duty inkl. Freight"})}),n.jsx(ye.Item,{name:"ddp",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"DDP"})}),n.jsx(ye.Item,{name:"archived",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"Archiviert"})})]}),n.jsxs(Nt,{size:"small",className:"v2-po-items-card",style:{marginBottom:12},children:[n.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(st,{strong:!0,children:"PO Positionen (Supplier-first)"}),n.jsxs(st,{type:"secondary",children:[it.length," SKU(s)"]})]}),n.jsxs(ze,{style:{width:"100%",marginTop:8},align:"start",wrap:!0,children:[n.jsx(Ct,{mode:"multiple",allowClear:!0,placeholder:$e?"SKUs auswaehlen":"Zuerst Supplier waehlen",value:W,onChange:l=>Y((l||[]).map(_=>String(_||""))),options:ue,style:{minWidth:420,flex:1},optionFilterProp:"label",disabled:!$e||!ue.length}),n.jsx(Re,{onClick:()=>Gt(W),disabled:!$e||!W.length,children:"SKUs hinzufuegen"})]}),n.jsx(ye.List,{name:"items",children:(l,{add:_,remove:j})=>n.jsxs(ze,{direction:"vertical",size:8,style:{width:"100%",marginTop:10},children:[l.map(ie=>n.jsxs("div",{className:"v2-po-item-row",children:[n.jsxs("div",{className:"v2-po-item-row-main",children:[n.jsx(ye.Item,{...ie,name:[ie.name,"sku"],label:"SKU",className:"v2-po-item-col v2-po-item-col--sku",rules:[{required:!0,message:"SKU fehlt."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:fe.filter(xe=>String(xe.supplierId||"")===String($e||"")).map(xe=>({value:xe.sku,label:`${xe.alias} (${xe.sku})`})),onChange:xe=>Yt(Number(ie.name),String(xe||"")),disabled:!$e})}),n.jsx(ye.Item,{...ie,name:[ie.name,"units"],label:"Units",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Units fehlen."}],children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"unitCostUsd"],label:"Unit Cost USD",className:"v2-po-item-col",rules:[{required:!0,message:"Preis fehlt."}],children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"unitExtraUsd"],label:"Unit Extra USD",className:"v2-po-item-col",children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"extraFlatUsd"],label:"Extra Flat USD",className:"v2-po-item-col",children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"freightEur"],label:"Shipping EUR",className:"v2-po-item-col",children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"prodDays"],label:"Prod Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Prod fehlt."}],children:n.jsx(yt,{mode:"int",min:0})}),n.jsx(ye.Item,{...ie,name:[ie.name,"transitDays"],label:"Transit Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Transit fehlt."}],children:n.jsx(yt,{mode:"int",min:0})})]}),n.jsx(Re,{danger:!0,size:"small",style:{marginTop:31},onClick:()=>j(ie.name),children:"Entfernen"})]},ie.key)),n.jsx(Re,{onClick:()=>_(Vt({id:zt("poi"),sku:"",units:0,unitCostUsd:0,unitExtraUsd:0,extraFlatUsd:0,prodDays:0,transitDays:0,freightEur:0})),disabled:!$e,children:"Leere Position"})]})})]}),n.jsxs(Nt,{size:"small",className:"v2-po-aggregate-card",style:{marginBottom:12},children:[n.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(st,{strong:!0,children:"Aggregierte Sicht (kritischer Pfad)"}),n.jsx(pt,{className:"v2-po-critical-path-tag",children:"ETA folgt langsamster SKU"})]}),n.jsxs("div",{className:"v2-po-aggregate-grid",children:[n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Goods USD"}),n.jsx("div",{children:qn(tt.goodsUsd,2)})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Goods EUR"}),n.jsx("div",{children:un(tt.goodsEur)})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Freight EUR"}),n.jsx("div",{children:un(tt.freightEur)})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Units gesamt"}),n.jsx("div",{children:qn(tt.units,0)})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Prod/Transit (kritisch)"}),n.jsxs("div",{children:[qn(tt.prodDays,0)," / ",qn(tt.transitDays,0)," Tage"]})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"ETD / ETA"}),n.jsxs("div",{children:[Rt(tt.schedule.etdDate)," / ",Rt(tt.schedule.etaDate)]})]}),n.jsxs("div",{children:[n.jsx(st,{type:"secondary",children:"Ankunftsfenster"}),n.jsx("div",{children:tt.minEtaDate||tt.maxEtaDate?`${Rt(tt.minEtaDate)} - ${Rt(tt.maxEtaDate)}`:"—"})]})]})]}),n.jsx(Nt,{size:"small",style:{marginBottom:12},children:n.jsxs(ze,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(st,{strong:!0,children:"Stammdaten-Herkunft (PO)"}),le?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Primary SKU"}),n.jsx(st,{children:le.sku})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Cost USD"}),n.jsx("span",{className:Xt(Te.fields.unitPriceUsd.source,!0),children:Te.fields.unitPriceUsd.label}),n.jsx(Re,{size:"small",onClick:()=>m("unitCostUsd"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",onClick:()=>Ne("unitPriceUsd",le.unitCostUsd),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Prod / Transit"}),n.jsx("span",{className:Xt(Te.fields.productionLeadTimeDays.source,!0),children:Te.fields.productionLeadTimeDays.label}),n.jsx("span",{className:Xt(Te.fields.transitDays.source,!1),children:Te.fields.transitDays.label}),n.jsx(Re,{size:"small",onClick:()=>m("prodDays"),children:"Prod reset"}),n.jsx(Re,{size:"small",onClick:()=>m("transitDays"),children:"Transit reset"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Xt(Te.fields.dutyRatePct.source,!1),children:Te.fields.dutyRatePct.label}),n.jsx("span",{className:Xt(Te.fields.eustRatePct.source,!1),children:Te.fields.eustRatePct.label}),n.jsx(Re,{size:"small",onClick:()=>m("dutyRatePct"),children:"Duty reset"}),n.jsx(Re,{size:"small",onClick:()=>m("eustRatePct"),children:"EUSt reset"}),n.jsx(Re,{size:"small",onClick:()=>Ne("dutyRatePct",G==null?void 0:G.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(Re,{size:"small",onClick:()=>Ne("eustRatePct",G==null?void 0:G.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"DDP"}),n.jsx("span",{className:Xt(Te.fields.ddp.source,!0),children:Te.fields.ddp.label}),n.jsx(Re,{size:"small",onClick:()=>m("ddp"),children:"Zuruecksetzen"}),n.jsx(Re,{size:"small",onClick:()=>Ne("ddp",(G==null?void 0:G.ddp)===!0),children:"Als Produktwert uebernehmen"})]})]}):n.jsx(st,{type:"secondary",children:"Bitte mindestens eine SKU erfassen."})]})}),le!=null&&le.sku&&Se.blocked?n.jsx(It,{className:"v2-po-warning",type:"error",showIcon:!0,message:"Blockierende Stammdaten fehlen",description:Se.issues.map(l=>l.label).join(", ")}):null,$e&&!ue.length?n.jsx(It,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Dieser Lieferant hat aktuell keine zugeordneten SKUs. Bitte zuerst Stammdaten pflegen."}):null,De.length?n.jsx(It,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Einige Positionen sind unvollstaendig.",description:De.slice(0,6).join(" | ")}):null,n.jsxs(Nt,{size:"small",style:{marginBottom:12},children:[n.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(st,{strong:!0,children:"Milestones"}),n.jsxs(st,{type:Math.abs(Zn((G==null?void 0:G.milestones)||[])-100)<=.01?"secondary":"danger",children:["Summe: ",qn(Zn((G==null?void 0:G.milestones)||[]),2),"%"]})]}),n.jsx(ye.List,{name:"milestones",children:(l,{add:_,remove:j})=>n.jsxs(ze,{direction:"vertical",size:8,style:{width:"100%"},children:[l.map(ie=>n.jsxs(ze,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(ye.Item,{...ie,name:[ie.name,"label"],style:{minWidth:240,flex:2},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(vt,{placeholder:"Label"})}),n.jsx(ye.Item,{...ie,name:[ie.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(yt,{mode:"percent",min:0,max:100})}),n.jsx(ye.Item,{...ie,name:[ie.name,"anchor"],style:{width:160},rules:[{required:!0,message:"Anchor fehlt."}],children:n.jsx(Ct,{options:Xs.map(xe=>({value:xe,label:xe}))})}),n.jsx(ye.Item,{...ie,name:[ie.name,"lagDays"],style:{width:120},children:n.jsx(yt,{mode:"int"})}),n.jsx(Re,{danger:!0,onClick:()=>j(ie.name),children:"X"})]},ie.key)),n.jsx(Re,{onClick:()=>_({id:zt("ms"),label:"Milestone",percent:0,anchor:"ORDER_DATE",lagDays:0}),children:"Milestone"})]})})]}),n.jsx("div",{ref:L,children:n.jsxs(Nt,{size:"small",children:[n.jsxs(ze,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(st,{strong:!0,children:"Event / Payment Preview"}),n.jsx(Re,{size:"small",onClick:()=>nn(null),disabled:!E||!qe.length||ne.readOnly,children:"Sammelzahlung buchen"})]}),Fe?n.jsxs(ze,{direction:"vertical",size:4,style:{width:"100%",marginTop:8},children:[n.jsxs(st,{children:["Timeline: Order ",Rt(Fe.orderDate)," · ETD ",Rt(Fe.etdManual||_n({orderDate:Fe.orderDate,productionLeadTimeDays:Fe.prodDays,logisticsLeadTimeDays:Fe.transitDays,bufferDays:0}).etdDate)," · ETA ",Rt(Fe.etaManual||_n({orderDate:Fe.orderDate,productionLeadTimeDays:Fe.prodDays,logisticsLeadTimeDays:Fe.transitDays,bufferDays:0}).etaDate)]}),E?null:n.jsx(It,{type:"info",showIcon:!0,message:"PO zuerst speichern, danach koennen Zahlungen (inkl. Sammelzahlung) verbucht werden."}),n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Due"}),n.jsx("th",{children:"Planned EUR"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode / Von"}),n.jsx("th",{children:"Invoice / Folder"}),n.jsx("th",{children:"Aktionen"})]})}),n.jsx("tbody",{children:qe.map(l=>n.jsxs("tr",{children:[n.jsx("td",{children:Cu(String(l.id||""))}),n.jsx("td",{children:er(l)}),n.jsx("td",{children:Rt(l.dueDate)}),n.jsx("td",{children:un(l.plannedEur)}),n.jsx("td",{children:l.paidEurActual!=null?un(l.paidEurActual):"—"}),n.jsx("td",{children:l.status==="paid"?"Bezahlt":"Offen"}),n.jsx("td",{children:Rt(l.paidDate)}),n.jsx("td",{children:l.method||l.paidBy?n.jsxs(ze,{direction:"vertical",size:0,children:[n.jsx(st,{children:l.method||"—"}),n.jsx(st,{type:"secondary",children:l.paidBy||"—"})]}):"—"}),n.jsx("td",{children:n.jsxs(ze,{direction:"vertical",size:0,children:[vr(l.invoiceDriveUrl)?n.jsx("a",{href:String(l.invoiceDriveUrl),target:"_blank",rel:"noreferrer",children:"Invoice"}):n.jsx(st,{type:"secondary",children:"Invoice —"}),vr(l.invoiceFolderDriveUrl)?n.jsx("a",{href:String(l.invoiceFolderDriveUrl),target:"_blank",rel:"noreferrer",children:"Folder"}):n.jsx(st,{type:"secondary",children:"Folder —"})]})}),n.jsx("td",{children:n.jsx(Re,{size:"small",onClick:()=>nn(l),disabled:!E||ne.readOnly,children:l.status==="paid"?"Bearbeiten":"Zahlung buchen"})})]},l.id))})]})})]}):n.jsx(st,{type:"secondary",children:"Preview erscheint nach Eingabe."})]})})]})]}),n.jsxs($t,{title:"PO Zahlung verbuchen",open:w,width:920,onCancel:()=>{k(!1),q(null),U([]),x(null),Q.resetFields()},onOk:()=>{x(null),Q.validateFields().then(l=>pn(l)).catch(l=>{l!=null&&l.errorFields||x(String(l instanceof Error?l.message:l))})},children:[F?n.jsx(It,{type:"error",showIcon:!0,message:F,style:{marginBottom:10}}):null,n.jsxs(ye,{form:Q,layout:"vertical",onFinish:l=>{x(null),pn(l).catch(_=>{x(String(_ instanceof Error?_.message:_))})},children:[n.jsx(ye.Item,{name:"selectedEventIds",label:"Welche Zahlungsbausteine sind in dieser Zahlung enthalten?",rules:[{required:!0,message:"Bitte mindestens einen Baustein waehlen."}],children:n.jsx(en.Group,{style:{width:"100%"},children:n.jsx(ze,{direction:"vertical",style:{width:"100%"},children:qe.map(l=>{const _=l.status==="paid"&&l.paymentId&&l.paymentId!==$&&!C.includes(l.id);return n.jsx(Nt,{size:"small",style:{width:"100%"},children:n.jsx(en,{value:l.id,disabled:_,children:n.jsxs(ze,{size:10,wrap:!0,children:[n.jsx(st,{strong:!0,children:er(l)}),n.jsxs(st,{type:"secondary",children:["Due ",Rt(l.dueDate)]}),n.jsx(st,{children:un(l.plannedEur)}),l.status==="paid"?n.jsx(pt,{color:"green",children:"Bereits bezahlt"}):n.jsx(pt,{children:"Offen"}),l.paymentId?n.jsxs(st,{type:"secondary",children:["Payment-ID ",l.paymentId]}):null]})})},l.id)})})})}),n.jsxs(ze,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(ye.Item,{name:"paidDate",label:"Zahlungsdatum",style:{width:170},rules:[{required:!0}],children:n.jsx(vt,{type:"date"})}),n.jsx(ye.Item,{name:"method",label:"Zahlungsmethode",style:{minWidth:240,flex:1},rules:[{required:!0}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:Dt,placeholder:"z. B. Alibaba Trade Assurance"})}),n.jsx(ye.Item,{name:"paidBy",label:"Bezahlt durch",style:{minWidth:220,flex:1},rules:[{required:!0}],children:n.jsx(vt,{placeholder:ft.map(l=>l.label).join(" / ")||"Name oder E-Mail"})})]}),n.jsxs(ze,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(ye.Item,{name:"amountActualEur",label:"Ist-Betrag EUR",style:{width:190},rules:[{required:!0}],children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{name:"amountActualUsd",label:"Ist-Betrag USD (optional)",style:{width:210},children:n.jsx(yt,{mode:"decimal",min:0})}),n.jsx(ye.Item,{name:"paymentId",label:"Payment-ID (intern)",style:{minWidth:300,flex:1},children:n.jsx(vt,{placeholder:"pay-..."})})]}),n.jsxs(ze,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(ye.Item,{name:"invoiceDriveUrl",label:"Invoice Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(vt,{placeholder:"https://..."})}),n.jsx(Re,{style:{marginTop:31},disabled:!vr(String((nt==null?void 0:nt.invoiceDriveUrl)||"")),onClick:()=>window.open(String((nt==null?void 0:nt.invoiceDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Link oeffnen"})]}),n.jsxs(ze,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(ye.Item,{name:"invoiceFolderDriveUrl",label:"Ordner-Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(vt,{placeholder:"https://..."})}),n.jsx(Re,{style:{marginTop:31},disabled:!vr(String((nt==null?void 0:nt.invoiceFolderDriveUrl)||"")),onClick:()=>window.open(String((nt==null?void 0:nt.invoiceFolderDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Ordner oeffnen"})]}),n.jsx(ye.Item,{name:"note",label:"Notiz",children:n.jsx(vt.TextArea,{rows:2,placeholder:"Optionaler Hinweis"})}),n.jsx(Nt,{size:"small",children:n.jsxs(ze,{direction:"vertical",style:{width:"100%"},size:6,children:[n.jsx(st,{strong:!0,children:"Dateiname-Vorschlag fuer Rechnung"}),n.jsx(st,{code:!0,children:Ft||"—"}),n.jsx("div",{children:n.jsx(Re,{size:"small",onClick:()=>{Ft&&(navigator.clipboard.writeText(Ft),sn.success("Dateiname kopiert."))},children:"Dateiname kopieren"})})]})})]})]})]})}const{Text:Kr}=jn,{RangePicker:Tu}=Wn,Ru={"3m":3,"6m":6,"12m":12,"18m":18},vn="-";function Vr(e){return String(e||"").trim()}function $u(e){const t=e.archived===!0,r=String(e.status||"").trim().toUpperCase()==="CANCELLED";return t||r?"closed":"planning"}function Ou(e){const t=kn(e.status);return t==="DRAFT"||t==="ACTIVE"?"planning":"closed"}function Fu(e,t,r){const a=fi(e.categoryLabel,t.categoryLabel,r);if(a!==0)return a;const i=String(e.alias||"").localeCompare(String(t.alias||""),"de-DE",{sensitivity:"base"});return i!==0?i:e.sku.localeCompare(t.sku,"de-DE",{sensitivity:"base"})}function $a(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):null}function Au(e){return Number.isFinite(e)?`${Number(e).toLocaleString("de-DE",{maximumFractionDigits:0})} Stk`:vn}function Oa(e){if(!e)return vn;const t=Pt(e);return t.isValid()?t.format("DD.MM.YYYY"):e}function Fa(e){const t=[e.destination,e.destinationName,e.targetWarehouse,e.warehouse,e.warehouseName,e.fulfillmentCenter,e.portTo];for(const r of t){const a=String(r||"").trim();if(a)return a}return null}function Aa(e,t){const r=String(t||"").trim().replace(/\s+/g,"");if(!r)return e;const a=r.toUpperCase();return a.startsWith(e)?a:`${e}${r}`}function Lu(e){const t=String(e||"");return t?Math.max(38,Math.round(t.length*6.4+12)):38}function Uu(e){var u;const t=((u=e==null?void 0:e.itemContext)==null?void 0:u.dimensions)||{},r=Number(t.width||0),a=Number(t.height||0),i=Math.min(Math.max(0,a/2),Math.max(0,r/2-1),10);return Number.isFinite(i)?Math.max(0,i):0}function _u(e,t){var f,p;const r=((f=e==null?void 0:e.itemContext)==null?void 0:f.dimensions)||{},a=Number(r.width||0),i=Number(r.left||0),u=Lu(t),c=typeof((p=e==null?void 0:e.timelineContext)==null?void 0:p.getTimelineState)=="function"?e.timelineContext.getTimelineState():null,d=Number((c==null?void 0:c.timelineWidth)||0);if(d<=0)return"right";const h=Math.max(0,d-(i+a)),g=Math.max(0,i);return h>=u+6?"right":g>=u+6?"left":"right"}function La(e){if(!e.length)return e;let t=0;for(let r=1;r<e.length;r+=1)e[r].endMs>=e[t].endMs&&(t=r);return e.map((r,a)=>({...r,tooltipData:{...r.tooltipData,showReferenceLabel:a===t}}))}function Gn(e){return String(e||"").trim()||vn}function Hu(e){const t=[{key:"Typ",value:Gn(e.type)},{key:"Nummer",value:Gn(e.identifier)},{key:"Phase",value:Gn(e.phase)},{key:"Menge",value:Au(e.units??null)},{key:"Zeitraum",value:`${Oa(String(e.startDate||""))} - ${Oa(String(e.endDate||""))}`},{key:"Supplier",value:Gn(e.supplier)}];return e.destination&&t.push({key:"Ziel",value:Gn(e.destination)}),n.jsx("div",{className:"v2-orders-gantt-tooltip",children:t.map(r=>n.jsxs("div",{className:"v2-orders-gantt-tooltip-row",children:[n.jsx("span",{className:"v2-orders-gantt-tooltip-key",children:r.key}),n.jsx("span",{className:"v2-orders-gantt-tooltip-value",children:r.value})]},r.key))})}function Bu(){const e=xr(),{state:t}=Cr(),[r,a]=s.useState(""),[i,u]=s.useState("all"),[c,d]=s.useState("all"),[h,g]=s.useState("all"),[f,p]=s.useState("planning"),[S,P]=s.useState("12m"),[D,R]=s.useState(null),b=t,N=s.useMemo(()=>no(b),[t.productCategories]),A=s.useMemo(()=>{const w=new Map;return(Array.isArray(t.productCategories)?t.productCategories:[]).forEach(k=>{const $=k,q=String($.id||"");q&&w.set(q,String($.name||"Ohne Kategorie"))}),w},[t.productCategories]),T=s.useMemo(()=>{const w=new Map;return(Array.isArray(t.suppliers)?t.suppliers:[]).forEach(k=>{const $=k,q=String($.id||"");q&&w.set(q,String($.name||vn))}),w},[t.suppliers]),E=s.useMemo(()=>{const w=new Map;return(Array.isArray(t.products)?t.products:[]).forEach(k=>{const $=k,q=Vr($.sku);q&&w.set(q,$)}),w},[t.products]),V=s.useMemo(()=>{const w=(Array.isArray(t.productCategories)?t.productCategories:[]).map(k=>k).map(k=>({value:String(k.id||""),label:String(k.name||"Ohne Kategorie")})).filter(k=>k.value).sort((k,$)=>fi(k.label,$.label,N));return[{value:"all",label:"Kategorie: Alle"},...w,{value:"__uncat__",label:"Ohne Kategorie"}]},[N,t.productCategories]),W=s.useMemo(()=>{const w=Array.from(T.entries()).map(([k,$])=>({value:k,label:$})).sort((k,$)=>k.label.localeCompare($.label,"de-DE",{sensitivity:"base"}));return[{value:"all",label:"Supplier: Alle"},...w]},[T]),Y=s.useCallback(w=>{const k=(w==null?void 0:w.item)||{},$=k.meta&&typeof k.meta=="object"?k.meta:{},q=String($.referenceLabel||""),F=$.showReferenceLabel===!0&&!!q,x=F?_u(w,q):"right",C=Uu(w),U=w.getItemProps({className:`${String(k.className||"")} v2-orders-gantt-pill v2-orders-gantt-pill--minimal`.trim(),style:{borderRadius:`${C}px`}});return n.jsx(si,{title:Hu($),placement:"top",mouseEnterDelay:.12,overlayClassName:"v2-orders-gantt-tooltip-overlay",children:n.jsx("div",{...U,children:F?n.jsx("span",{className:`v2-orders-gantt-ref v2-orders-gantt-ref--${x}`,children:q}):null})})},[]),K=s.useMemo(()=>{const w=new Map,k=[],$=(y,H="")=>{if(w.has(y))return w.get(y);const B=E.get(y)||{},O=String(B.supplierId||H||""),L=T.get(O)||vn,I=String(B.categoryId||"")||null,oe=I&&A.get(I)||"Ohne Kategorie",se=String(B.alias||y),X={sku:y,alias:se,supplierId:O,supplierName:L,categoryId:I,categoryLabel:oe,items:[],references:[]};return w.set(y,X),X};(Array.isArray(t.pos)?t.pos:[]).map(y=>y).forEach(y=>{var Ce;const H=$u(y);if(f==="planning"&&H!=="planning"||f==="closed"&&H!=="closed")return;const B=ir({items:y.items,orderDate:y.orderDate,fxRate:Number(((Ce=t.settings)==null?void 0:Ce.fxRate)||0),fallback:y}),O=_n({orderDate:y.orderDate,productionLeadTimeDays:B.prodDays||y.prodDays,logisticsLeadTimeDays:B.transitDays||y.transitDays,bufferDays:0}),L=String(y.orderDate||""),Z=String(y.etdManual||O.etdDate||""),I=String(y.etaManual||O.etaDate||""),oe=cn(L),se=cn(Z),X=cn(I),de=Fa(y);L&&k.push(L),Z&&k.push(Z),I&&k.push(I);const ne=String(y.poNo||String(y.id||"").slice(-6).toUpperCase()||"PO"),re=Aa("PO",ne),ae=String(y.supplierId||"");(Array.isArray(y.items)&&y.items.length?y.items:[{sku:y.sku,units:y.units}]).forEach((fe,be)=>{const me=Vr((fe==null?void 0:fe.sku)||y.sku);if(!me)return;const je=$(me,ae),Ie=$a((fe==null?void 0:fe.units)??(fe==null?void 0:fe.qty)??(fe==null?void 0:fe.quantity)??y.units),Be=je.supplierName!==vn?je.supplierName:null,Ue=[],ke=oe??se,Ve=se;if(ke!=null&&Ve!=null){const lt=bn({startMs:ke,endMs:Ve});Ue.push({id:`po:${String(y.id||ne)}:${me}:${be}:production`,startMs:lt.startMs,endMs:lt.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-production",tooltipData:{type:"PO",identifier:re,phase:"Production",units:Ie,startDate:L||Z,endDate:Z||L,supplier:Be,destination:de,referenceLabel:re,showReferenceLabel:!1},openTarget:{entity:"po",poNo:ne}})}if(X!=null){const mt=bn({startMs:se??oe??X,endMs:X});Ue.push({id:`po:${String(y.id||ne)}:${me}:${be}:transit`,startMs:mt.startMs,endMs:mt.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-transit",tooltipData:{type:"PO",identifier:re,phase:"Transit",units:Ie,startDate:Z||L||I,endDate:I||Z||L,supplier:Be,destination:de,referenceLabel:re,showReferenceLabel:!1},openTarget:{entity:"po",poNo:ne}})}La(Ue).forEach(lt=>{je.items.push(lt)}),je.references.push(re)})}),(Array.isArray(t.fos)?t.fos:[]).map(y=>y).forEach(y=>{const H=Ou(y);if(f==="planning"&&H!=="planning"||f==="closed"&&H!=="closed")return;const B=yr({targetDeliveryDate:y.targetDeliveryDate||y.deliveryDate||y.etaDate,productionLeadTimeDays:y.productionLeadTimeDays,logisticsLeadTimeDays:y.logisticsLeadTimeDays,bufferDays:y.bufferDays}),O=String(y.orderDate||B.orderDate||""),L=String(y.etdDate||B.etdDate||""),Z=String(y.etaDate||B.etaDate||y.targetDeliveryDate||""),I=cn(O),oe=cn(L),se=cn(Z),X=Fa(y),de=$a(y.units??y.qty??y.quantity);O&&k.push(O),L&&k.push(L),Z&&k.push(Z);const ne=Vr(y.sku);if(!ne)return;const re=$(ne,String(y.supplierId||"")),ae=String(y.id||""),we=Aa("FO",ae.slice(-6).toUpperCase()||vn),Ce=re.supplierName!==vn?re.supplierName:null,fe=[],be=I??oe,me=oe;if(be!=null&&me!=null){const je=bn({startMs:be,endMs:me});fe.push({id:`fo:${ae}:${ne}:production`,startMs:je.startMs,endMs:je.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-production",tooltipData:{type:"FO",identifier:we,phase:"Production",units:de,startDate:O||L,endDate:L||O,supplier:Ce,destination:X,referenceLabel:we,showReferenceLabel:!1},openTarget:{entity:"fo",foId:ae}})}if(se!=null){const Ie=bn({startMs:oe??I??se,endMs:se});fe.push({id:`fo:${ae}:${ne}:transit`,startMs:Ie.startMs,endMs:Ie.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-transit",tooltipData:{type:"FO",identifier:we,phase:"Transit",units:de,startDate:L||O||Z,endDate:Z||L||O,supplier:Ce,destination:X,referenceLabel:we,showReferenceLabel:!1},openTarget:{entity:"fo",foId:ae}})}La(fe).forEach(je=>{re.items.push(je)}),re.references.push(we)});const q=Array.from(w.values()).sort((y,H)=>Fu(y,H,N)),F=[],x=[],C=new Map,U=r.trim().toLowerCase();return q.forEach(y=>{if(i==="__uncat__"&&y.categoryId||i!=="all"&&i!=="__uncat__"&&y.categoryId!==i||c!=="all"&&y.supplierId!==c)return;const H=y.items.filter(O=>h==="all"||O.openTarget.entity===h);if(!H.length)return;const B=[y.sku,y.alias,y.supplierName,y.categoryLabel,...y.references].join(" ").toLowerCase();U&&!B.includes(U)||(F.push({id:y.sku,title:n.jsxs("div",{className:"v2-orders-gantt-meta v2-orders-gantt-meta--sku",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(Kr,{strong:!0,className:"v2-orders-gantt-sku-title",children:y.alias}),n.jsx(pt,{className:"v2-orders-gantt-lane-tag",children:y.sku})]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[y.supplierName," · ",y.categoryLabel]})]})}),H.forEach(O=>{x.push({id:O.id,group:y.sku,startMs:O.startMs,endMs:O.endMs,className:O.className,meta:O.tooltipData}),C.set(O.id,O.openTarget)}))}),{groups:F,items:x,targetByItemId:C,timelineWindow:is({state:b,dates:k,fallbackHorizon:12})}},[A,i,N,E,r,t.fos,t.pos,t.settings,b,f,T,c,h]),Q=s.useMemo(()=>{var F,x;const w=K.timelineWindow;if(S==="custom"){const C=(F=D==null?void 0:D[0])==null?void 0:F.startOf("day").valueOf(),U=(x=D==null?void 0:D[1])==null?void 0:x.endOf("day").valueOf();return Number.isFinite(C)&&Number.isFinite(U)&&Number(U)>Number(C)?{visibleStartMs:Number(C),visibleEndMs:Number(U)}:w}const k=Pt(w.visibleStartMs).startOf("month").valueOf(),$=Ru[S],q=Pt(k).add($,"month").endOf("day").valueOf();return{visibleStartMs:k,visibleEndMs:q}},[D,S,K.timelineWindow]);return n.jsxs(Nt,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(vt,{placeholder:"Suche SKU, Alias, PO/FO, Supplier",value:r,onChange:w=>a(w.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Ct,{value:i,options:V,onChange:w=>u(String(w||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Ct,{value:c,options:W,onChange:w=>d(String(w||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Ct,{value:h,onChange:w=>g(String(w||"all")),options:[{value:"all",label:"Typ: PO + FO"},{value:"po",label:"Typ: nur PO"},{value:"fo",label:"Typ: nur FO"}],style:{width:170}}),n.jsx(Ct,{value:f,onChange:w=>p(String(w||"planning")),options:[{value:"planning",label:"Status: Planungsrelevant"},{value:"all",label:"Status: Alle"},{value:"closed",label:"Status: Abgeschlossen"}],style:{width:220}})]}),n.jsxs("div",{className:"v2-toolbar-row v2-orders-gantt-range-row",style:{marginBottom:10},children:[n.jsx(Kr,{type:"secondary",children:"Zeitraum:"}),n.jsx(aa,{value:S,options:[{value:"3m",label:"3M"},{value:"6m",label:"6M"},{value:"12m",label:"12M"},{value:"18m",label:"18M"},{value:"custom",label:"Custom"}],onChange:w=>{const k=String(w||"12m");P(k),k==="custom"&&!D&&R([Pt(K.timelineWindow.visibleStartMs),Pt(K.timelineWindow.visibleEndMs)])}}),S==="custom"?n.jsx(Tu,{className:"v2-orders-gantt-range-picker",value:D||void 0,format:"DD.MM.YYYY",allowClear:!0,onChange:w=>{if(!w){R(null);return}R(w)}}):null]}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsxs(pt,{children:[K.groups.length," SKUs"]}),n.jsxs(pt,{children:[K.items.length," Segmente"]}),n.jsx(pt,{color:"green",children:"SKU Timeline"})]}),n.jsxs("div",{className:"v2-orders-gantt-legend",style:{marginBottom:10},children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-production"})," PO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-transit"})," PO Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-production"})," FO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-transit"})," FO Transit"]})]}),n.jsx(ss,{className:"v2-orders-gantt--sku",groups:K.groups,items:K.items,visibleStartMs:Q.visibleStartMs,visibleEndMs:Q.visibleEndMs,sidebarHeaderLabel:"SKU",sidebarWidth:500,lineHeight:66,itemHeightRatio:.58,stackItems:!0,showTodayMarker:!1,emptyMessage:"Keine SKU-Eintraege fuer die aktuelle Suche/Filter.",itemRenderer:Y,onItemSelect:w=>{const k=K.targetByItemId.get(w);if(k){if(k.entity==="po"&&k.poNo){const $=new URLSearchParams;$.set("source","fo_convert"),$.set("poNo",k.poNo),e(`/v2/orders/po?${$.toString()}`);return}if(k.entity==="fo"&&k.foId){const $=new URLSearchParams;$.set("source","orders_sku"),$.set("foId",k.foId),e(`/v2/orders/fo?${$.toString()}`)}}}}),n.jsxs(ze,{style:{marginTop:10},wrap:!0,children:[n.jsx(Kr,{type:"secondary",children:"Klick auf ein Segment oeffnet den zugehoerigen PO/FO Datensatz."}),n.jsx(Re,{size:"small",onClick:()=>e("/v2/orders/po?view=timeline"),children:"PO Timeline oeffnen"}),n.jsx(Re,{size:"small",onClick:()=>e("/v2/orders/fo?view=timeline"),children:"FO Timeline oeffnen"})]})]})}const{Paragraph:Ua,Title:_a}=jn;function zu(e){return e.includes("/orders/sku")?"sku":e.includes("/orders/fo")?"fo":"po"}function yc(){const e=ra(),t=xr(),{state:r}=Cr(),a=s.useMemo(()=>zu(e.pathname),[e.pathname]),i=s.useMemo(()=>(Array.isArray(r.payments)?r.payments:[]).map(c=>c).map(c=>({id:String(c.id||""),paidDate:String(c.paidDate||""),method:String(c.method||"—"),payer:String(c.payer||"—"),amountActualEurTotal:Number(c.amountActualEurTotal||0),coveredCount:Array.isArray(c.coveredEventIds)?c.coveredEventIds.length:0})).filter(c=>c.id).sort((c,d)=>String(d.paidDate||"").localeCompare(String(c.paidDate||""))).slice(0,12),[r.payments]),u=s.useMemo(()=>i.reduce((c,d)=>c+Number(d.amountActualEurTotal||0),0),[i]);return n.jsxs("div",{className:"v2-page",children:[n.jsx(Nt,{className:"v2-intro-card",children:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(_a,{level:3,children:"Bestellungen"}),n.jsx(Ua,{children:"Gemeinsamer Arbeitsbereich für Forecast Orders und Purchase Orders mit schneller FO-zu-PO Übergabe."})]})})}),n.jsxs(Nt,{style:{marginBottom:12},children:[n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(_a,{level:5,children:"Zahlungsprotokoll (PO-Ist)"}),n.jsx(Ua,{children:"Tatsächlich bestätigte Zahlungen werden nur auf POs gebucht. FOs bleiben Planobjekte."})]})}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:8},children:[n.jsxs(jn.Text,{type:"secondary",children:["Eintraege: ",i.length]}),n.jsxs(jn.Text,{type:"secondary",children:["Summe Ist: ",u.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]})]}),n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Payment-ID"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode"}),n.jsx("th",{children:"Durch"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Abgedeckte Events"})]})}),n.jsx("tbody",{children:i.length?i.map(c=>n.jsxs("tr",{children:[n.jsx("td",{children:c.id}),n.jsx("td",{children:c.paidDate||"—"}),n.jsx("td",{children:c.method}),n.jsx("td",{children:c.payer}),n.jsxs("td",{children:[Number(c.amountActualEurTotal||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]}),n.jsx("td",{children:c.coveredCount})]},c.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Noch keine Zahlungen verbucht."})})})]})})]}),n.jsx(_s,{activeKey:a,onChange:c=>t(`/v2/orders/${c}`),items:[{key:"po",label:"Bestellungen (PO)",children:n.jsx(Eu,{embedded:!0})},{key:"fo",label:"Forecast Orders (FO)",children:n.jsx(gu,{embedded:!0})},{key:"sku",label:"SKU Sicht",children:n.jsx(Bu,{})}]})]})}export{yc as default};
