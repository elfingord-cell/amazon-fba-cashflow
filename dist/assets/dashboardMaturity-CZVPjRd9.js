function b(o){return String(o||"").trim()}function k(o){const r=Number(o);return Number.isFinite(r)?r:0}function w(o){const r=Math.abs(k(o.amount));return String(o.direction||"").toLowerCase()==="out"?-r:r}function h(o){const r=String(o.source||"").toLowerCase();return r==="po"?"po":r==="fo"?"fo":r==="sales"?"sales":r==="fixcosts"?"fixcosts":r==="extras"?"extras":r==="dividends"?"dividends":r==="vat"?"vat":r==="launch-costs"?"extras":"unknown"}function v(o){const r=String(o.source||"").toLowerCase(),u=String(o.kind||"").toLowerCase(),e=String(o.group||"").toLowerCase();return r==="po"||r==="fo"?"po_fo":r==="sales"?"inflow":r==="fixcosts"||e==="fixkosten"?"fixcost":u.includes("duty")||u.includes("eust")||u.includes("vat")||e.includes("import")?"tax":String(o.direction||"").toLowerCase()==="in"?"inflow":String(o.direction||"").toLowerCase()==="out"?"outflow":"other"}function A(o){const r=Array.isArray(o.products)?o.products:[],u=new Map;r.forEach(i=>{const s=b(i.sku);if(!s)return;const t=String(i.alias||"").trim()||s;u.set(s,t)});const e=new Map,l=(i,s)=>{const t=(i==="po"?[s.poNo,s.id]:[s.foNo,s.foNumber,s.id]).map(n=>String(n||"").trim()).filter(Boolean);if(!t.length)return;const a=Array.isArray(s.items)&&s.items.length?s.items:[{sku:s.sku,units:s.units}],f=new Set;let c=0;a.forEach(n=>{const d=b(n.sku);if(!d)return;f.add(u.get(d)||d);const m=k(n.units??n.qty??n.quantity);c+=m});const p={aliases:Array.from(f),units:Number.isFinite(c)?c:null};Array.from(new Set(t)).forEach(n=>{e.set(`${i}:${n}`,p)})};return(Array.isArray(o.pos)?o.pos:[]).forEach(i=>l("po",i)),(Array.isArray(o.fos)?o.fos:[]).forEach(i=>l("fo",i)),e}function x(o){const r=new Map,u=A(o.state);return(Array.isArray(o.breakdown)?o.breakdown:[]).forEach(e=>{const l=String(e.month||"").trim();if(!l)return;const s=(Array.isArray(e.entries)?e.entries:[]).map(t=>{var S;const a=h(t),f=t.sourceNumber?String(t.sourceNumber):void 0,c=t.sourceId?String(t.sourceId):void 0,p=t.meta&&typeof t.meta=="object"?t.meta:{},n=a==="fo"&&(p.phantom===!0||(c?((S=o.provisionalFoIds)==null?void 0:S.has(c))===!0:!1)),d=t.provisional===!0||n,m=f&&(a==="po"||a==="fo")?`${a}:${f}`:null,g=m?u.get(m):null;return{month:l,group:v(t),label:String(t.label||"Eintrag"),tooltip:typeof t.tooltip=="string"?t.tooltip:void 0,amount:w(t),provisional:d,paid:typeof t.paid=="boolean"?t.paid:null,source:a,portfolioBucket:t.portfolioBucket?String(t.portfolioBucket):p.portfolioBucket?String(p.portfolioBucket):null,sourceNumber:f,sourceId:c,tooltipMeta:g?{aliases:g.aliases,units:g.units,milestone:String(t.label||""),dueDate:t.date?String(t.date):null}:void 0}});r.set(l,s)}),r}export{x as b};
