import{I as Ft,t as r,P as q,J as ve,k as t,K as Pt,L as G,M as U,N as Tt,S as k,O as N,T as V,Q as Lt}from"./index-DN7VFcDZ.js";import{E as _t}from"./index-Dj9Vid4B.js";import{c as Rt}from"./cashflow-D3IZ29ar.js";import{r as Ut,b as Vt,a as $t,c as Wt}from"./phantomFo-BuLiM2R4.js";import{e as qt}from"./forecastVersioning-BQxgIGTG.js";import{m as Ge,c as Qt,f as $}from"./months-BTPgK-LH.js";import{u as Ht,C as F}from"./workspace-DpK7WcpK.js";import{h as Zt,g as Gt,s as Jt}from"./uiPrefs-CxTlE9qM.js";import{S as Je}from"./index-CRiLTIeN.js";import{R as W}from"./InfoCircleOutlined-B8t9bA2D.js";import{C as Ye}from"./Collapse-CHw78zkA.js";import{S as ye}from"./index-CWZiztpp.js";import{C as Yt}from"./index-tvZ13nRk.js";import{F as Xt}from"./Table-tY3ytGVC.js";import"./planProducts-BpFPmIqP.js";import"./cashInRules-r9rlv23d.js";import"./productCompletenessV2-l-JWtL-P.js";import"./orderUtils-Jyw4ydD0.js";import"./foSuggestion-Ck1952gl.js";import"./abcClassification-CjzpwCXo.js";import"./inventoryProjection-Bhz1OY6y.js";import"./Dropdown-DPveZyNz.js";import"./DownOutlined-BokHnPkJ.js";import"./useBubbleLock-BhAInPbh.js";import"./index-eyO9lyJZ.js";import"./Pagination-14yzqtam.js";const{Paragraph:Xe,Text:h,Title:et}=Pt,xe=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],en=new Set(["cashflow","pnl"]),tn=["cashflow"],nn=[{value:q.CORE,label:"Kernportfolio"},{value:q.PLAN,label:"Planprodukte"},{value:q.IDEAS,label:"Ideenprodukte"}],tt=[q.CORE,q.PLAN],nt={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function st(n){const c=new Set;return n.forEach(i=>{const u=String(i||"").trim();en.has(u)&&c.add(u)}),Array.from(c)}function sn(n){return Array.isArray(n)?n:n?[n]:[]}function E(n){const c=Number(n);return Number.isFinite(c)?c.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function ot(n){return Number.isFinite(n)?n<0?`−${E(Math.abs(n))}`:E(n):"-"}function at(n){const c=Number(n);return Number.isFinite(c)?`${c.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function on(n){return nt[n]||nt.insufficient}function an(n){return n==="ok"?"✅":n==="warn"?"⚠️":"❌"}function rn(n,c){const i=structuredClone(n||{});(!i.settings||typeof i.settings!="object")&&(i.settings={});const u=i.settings;return u.cashInMode=c.safetyMode==="basis"?"basis":"conservative",u.cashInCalibrationEnabled=c.revenueBasisMode==="calibrated",u.cashInRecommendationIgnoreQ4=!c.q4SeasonalityEnabled,c.quoteMode==="recommendation"&&Array.isArray(i.incomings)&&(i.incomings=i.incomings.map(f=>!f||typeof f!="object"?f:{...f,payoutPct:null})),i}function P(n,c){const[i,u=""]=String(n||"").split("?"),f=new URLSearchParams(u);Object.entries(c).forEach(([g,x])=>{if(x==null||x===""){f.delete(g);return}f.set(g,x)});const m=f.toString();return m?`${i}?${m}`:i}function ke(n){return P("/v2/inventory/projektion",{source:"dashboard",risk:n.risk||"under_safety",abc:n.abc||"ab",month:n.month||null,sku:n.sku||null,mode:n.mode||null,expand:"all"})}function ln(n){return P("/v2/products",{source:"dashboard",issues:n.issues,sku:n.sku||null,expand:"all"})}function it(n){return P("/v2/forecast",{source:"dashboard",sku:n.sku||null,month:n.month||null})}function cn(n){return P("/v2/orders/fo",{source:n.source,sku:n.sku||null,month:n.month||null,suggestedUnits:Number.isFinite(Number(n.suggestedUnits))?String(Math.max(0,Math.round(Number(n.suggestedUnits)))):"0",requiredArrivalDate:n.requiredArrivalDate||null,recommendedOrderDate:n.recommendedOrderDate||null,phantomId:null,firstRiskMonth:n.firstRiskMonth||null,orderMonth:n.orderMonth||null,leadTimeDays:Number.isFinite(Number(n.leadTimeDays))?String(Math.max(0,Math.round(Number(n.leadTimeDays)))):null,returnTo:n.returnTo})}function rt(n){const c=String(n.route||"");if(c.startsWith("/v2/forecast"))return it({sku:n.sku||null,month:n.month||null});if(c.startsWith("/v2/inventory/projektion")){const i=n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"under_safety":"all",u=n.sku?"all":n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"ab":"all";return ke({risk:i,abc:u,month:n.month||null,sku:n.sku||null,mode:n.mode||null})}if(c.startsWith("/v2/products")){const i=n.actionId==="revenue_inputs"||n.checkKey==="revenue_inputs"?"revenue":"needs_fix";return ln({issues:i,sku:n.sku||null})}return c}function un(n){const c=typeof n.portfolioBucket=="string"?n.portfolioBucket:null;if(c)return c;const i=n.meta&&typeof n.meta=="object"?n.meta:{};return typeof i.portfolioBucket=="string"?String(i.portfolioBucket):null}function Se(n,c){const i=un(n);return!i||!ve.includes(i)?!0:c.has(i)}function dn(n,c){var f;if(!n.length)return[];const i=Number(((f=n[0])==null?void 0:f.opening)||0);let u=i;return n.map((m,g)=>{const x=g===0?i:u,K=(Array.isArray(m.entries)?m.entries:[]).filter(S=>Se(S,c)),p=K.filter(S=>String(S.direction||"").toLowerCase()==="in").reduce((S,Q)=>S+Math.abs(Number(Q.amount||0)),0),I=K.filter(S=>String(S.direction||"").toLowerCase()==="out").reduce((S,Q)=>S+Math.abs(Number(Q.amount||0)),0),z=p-I,T=x+z;return u=T,{...m,opening:x,inflow:p,outflow:I,net:z,closing:T,entries:K}})}function mn(n,c,i){const u={fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0};return n.forEach(f=>{if(!f||typeof f!="object")return;const m=f;if(i&&!Se(m,i)||String(m.direction||"").toLowerCase()!=="out")return;const g=Math.abs(Number(m.amount||0));if(!Number.isFinite(g)||g<=0)return;u.total+=g;const x=String(m.source||"").toLowerCase();if(x==="po"){u.po+=g;return}if(x==="fo"){const p=String(m.sourceId||"").trim(),I=m.meta&&typeof m.meta=="object"?m.meta:{};m.provisional===!0||I.phantom===!0||(p?(c==null?void 0:c.has(p))===!0:!1)?u.phantomFo+=g:u.fo+=g;return}const K=String(m.group||"").toLowerCase();if(x==="fixcosts"||K==="fixkosten"){u.fixcost+=g;return}u.other+=g}),u}function hn(n,c){const i={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};return n.forEach(u=>{if(!u||typeof u!="object")return;const f=u;if(c&&!Se(f,c)||String(f.direction||"").toLowerCase()!=="in")return;const m=Math.abs(Number(f.amount||0));if(!Number.isFinite(m)||m<=0)return;const g=String(f.source||"").toLowerCase(),x=String(f.kind||"").toLowerCase();if(g==="sales"||g==="sales-plan"||x==="sales-payout"){i.amazon+=m;const p=f.meta&&typeof f.meta=="object"?f.meta:{},I=p.cashIn&&typeof p.cashIn=="object"?p.cashIn:{},z=String(I.component||"").trim().toLowerCase(),T=String(f.portfolioBucket||p.portfolioBucket||"").trim(),S=Lt(T,q.CORE);g==="sales-plan"||z==="plan"?i.amazonNew+=m:S===q.CORE?i.amazonCore+=m:i.amazonPlanned+=m}else i.other+=m;i.total+=m}),i}function fn(n){if(!n||typeof n!="object")return{toVersionId:null,foConflictsOpen:0};const c=n;return{toVersionId:c.toVersionId==null?null:String(c.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(c.foConflictsOpen||0)))}}function $n(){var $e,We,qe,Qe;const{state:n,loading:c,error:i}=Ht(),u=Ft(),f=Zt("dashboard"),[m,g]=r.useState("next6"),[x,K]=r.useState(()=>tt.slice()),[p,I]=r.useState("forecast"),[z,T]=r.useState("manual"),[S,Q]=r.useState("basis"),[se,oe]=r.useState(!0),[je,lt]=r.useState(!1),[ee,ae]=r.useState(""),[J,re]=r.useState(""),[ct,Me]=r.useState(!1),[te,ut]=r.useState(()=>{const e=Gt("dashboard");return f?st(e):tn.slice()}),L=n,ie=n.settings&&typeof n.settings=="object"?n.settings:{},we=n.forecast&&typeof n.forecast=="object"?n.forecast:{},le=ie.cashInCalibrationEnabled!==!1,dt=Math.max(1,Math.round(Number(ie.cashInCalibrationHorizonMonths||6))),Ce=ie.cashInRecommendationIgnoreQ4===!0;r.useEffect(()=>{je||(I(le?"calibrated":"forecast"),oe(!Ce),lt(!0))},[je,le,Ce]);const j=r.useMemo(()=>Ut(L,18),[n.settings]),_=r.useMemo(()=>ee&&j.includes(ee)?ee:j[j.length-1]||"",[ee,j]),H=r.useMemo(()=>Vt({state:L,months:j,targetMonth:_||null}),[j,_,L]),ze=r.useMemo(()=>new Set(H.map(e=>e.id)),[H]),Ne=r.useMemo(()=>$t({state:L,suggestions:H}),[H,L]),Ee=r.useMemo(()=>rn(Ne,{quoteMode:z,safetyMode:S,revenueBasisMode:p,q4SeasonalityEnabled:se}),[Ne,se,z,p,S]),ce=r.useMemo(()=>Rt(Ee),[Ee]),ue=ce.months||[],Ie=ce.breakdown||[],v=r.useMemo(()=>{const e=xe.find(s=>s.value===m);return!e||e.count==null?ue:ue.slice(0,e.count)},[ue,m]),mt=r.useMemo(()=>{const e=xe.find(s=>s.value===m);return(e==null?void 0:e.label)||"Alle Monate"},[m]),Ae=r.useMemo(()=>new Set(v),[v]),Z=r.useMemo(()=>new Set(x),[x]),Y=r.useMemo(()=>{const e=Ie.filter(s=>Ae.has(s.month));return dn(e,Z)},[Ie,Z,Ae]),O=r.useMemo(()=>Wt({state:L,months:v}),[L,v]);r.useEffect(()=>{if(!j.length){ae("");return}ae(e=>e&&j.includes(e)?e:j[j.length-1])},[j]),r.useEffect(()=>{var e;if(!O.months.length){re("");return}if(!J||!O.monthMap.has(J)){const s=((e=O.months.find(a=>!a.robust))==null?void 0:e.month)||O.months[0].month;re(s)}},[O,J]),r.useEffect(()=>{Jt("dashboard",te)},[te]);const Ke=e=>{ut(st(sn(e)))},ht=r.useCallback(e=>{ve.includes(e)&&K(s=>{const a=Array.from(new Set((s||[]).filter(y=>ve.includes(y))));if(!a.includes(e))return[...a,e];const M=a.filter(y=>y!==e);return M.length?M:a})},[]),De=r.useCallback(e=>{e&&(re(e),Me(!0))},[]),b=r.useMemo(()=>Y.map(e=>({...e})),[Y]),B=r.useMemo(()=>{const e=new Map;return b.forEach(s=>{e.set(s.month,hn(Array.isArray(s.entries)?s.entries:[],Z))}),e},[Z,b]),A=r.useMemo(()=>b.map(e=>B.get(e.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[B,b]),D=r.useMemo(()=>{const e=new Map;return b.forEach(s=>{e.set(s.month,mn(Array.isArray(s.entries)?s.entries:[],ze,Z))}),e},[Z,ze,b]),X=r.useMemo(()=>b.map(e=>D.get(e.month)||{fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0}),[D,b]),Oe=r.useMemo(()=>A.map(e=>e.amazonCore),[A]),Be=r.useMemo(()=>A.map(e=>e.amazonPlanned),[A]),Fe=r.useMemo(()=>A.map(e=>e.amazonNew),[A]),ft=r.useMemo(()=>A.map(e=>e.amazon),[A]),de=r.useMemo(()=>A.map(e=>e.other),[A]),gt=ft.reduce((e,s)=>e+Number(s||0),0)+de.reduce((e,s)=>e+Number(s||0),0),pt=b.reduce((e,s)=>e+Number(s.outflow||0),0),me=b.reduce((e,s)=>e+Number(s.net||0),0),bt=r.useMemo(()=>b.length?Math.min(...b.map(e=>Number(e.closing||0))):null,[b]),yt=z==="recommendation",xt=((We=($e=ce.kpis)==null?void 0:$e.cashIn)==null?void 0:We.calibrationApplied)===!0,Pe=r.useMemo(()=>{const e=structuredClone(we||{});return qt(e),e},[we]),he=fn(Pe.lastImpactSummary),Te=String(Pe.activeVersionId||"").trim()||null,Le=he.toVersionId&&Te&&he.toVersionId===Te?he.foConflictsOpen:0,l=J&&O.monthMap.get(J)||null,fe=l?on(l.coverage.statusKey):null,ne=r.useMemo(()=>{if(!l)return!1;const e=Ge(Qt()),s=Ge(l.month);return s==null||e==null?!1:s<e},[l]),_e=l?l.checks.filter(e=>e.key!=="sku_coverage"):[],Re=r.useMemo(()=>{if(!l||l.coverage.statusKey==="full")return[];const e=l.month;return[{id:`coverage-warning:${e}`,message:`Coverage ist ${l.coverage.statusLabel}: ${at(l.coverage.ratio*100)} (${l.coverage.coveredSkus}/${l.coverage.activeSkus}).`,route:ke({risk:"under_safety",abc:"ab",month:e,mode:l.coverage.projectionMode})}]},[l]),vt=r.useMemo(()=>{if(!l)return[];const e=[],s=l.coverage.stockIssueCount,a=l.coverage.orderDutyIssueCount;return e.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:s===0?"ok":"fail",description:s===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${s} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),e.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:a===0?"ok":l.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:a===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${a} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),_e.forEach(o=>{e.push({key:o.key,label:o.label,state:o.passed?"ok":"fail",description:o.detail,route:o.route||null})}),ne&&e.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),e},[l,ne,_e]),Ue=r.useMemo(()=>{const e=new Map;return v.forEach(s=>{e.set($(s),s)}),e},[v]),Ve=r.useCallback(e=>{if(!e||typeof e!="object")return;const s=e;let a=null;const o=Number(s.dataIndex);if(Number.isInteger(o)&&o>=0&&o<v.length&&(a=v[o]),!a){const M=[s.name,s.axisValue,s.value].map(y=>typeof y=="string"?y.trim():"").filter(Boolean);for(let y=0;y<M.length;y+=1){const R=Ue.get(M[y]);if(R){a=R;break}}}a&&De(a)},[Ue,De,v]),kt=r.useMemo(()=>({click:Ve}),[Ve]),St=r.useMemo(()=>{const e="Amazon Kern",s="Amazon Plan",a="Amazon Neu",o=new Set([e,s,a]),M=v.map(d=>$(d)),y=Y.map(d=>Number(d.closing||0)),R=Y.map(d=>{var w;return!!((w=O.monthMap.get(d.month))!=null&&w.robust)}),zt=y.map((d,w)=>R[w]&&d>=0?d:null),Nt=y.map((d,w)=>R[w]&&d<0?d:null),Et=y.map((d,w)=>!R[w]&&d>=0?d:null),It=y.map((d,w)=>!R[w]&&d<0?d:null),At=X.map(d=>-d.fixcost),Kt=X.map(d=>-d.po),Dt=X.map(d=>-d.fo),Ot=X.map(d=>-d.phantomFo);return{tooltip:{trigger:"axis",formatter:d=>{const w=Array.isArray(d)?d:[d],ge=w[0],pe=[`<div><strong>${(ge==null?void 0:ge.axisValueLabel)||""}</strong></div>`];let He=0,Ze=!1;return w.forEach(Bt=>{const C=Bt,be=Number(C==null?void 0:C.value);Number.isFinite(be)&&(o.has(String((C==null?void 0:C.seriesName)||""))&&(He+=be,Ze=!0),pe.push(`<div>${(C==null?void 0:C.marker)||""}${(C==null?void 0:C.seriesName)||""}: ${E(be)}</div>`))}),Ze&&pe.push(`<div><strong>Amazon gesamt: ${E(He)}</strong></div>`),pe.join("")}},legend:{type:"scroll",top:0,left:0,right:0,itemGap:10,itemWidth:14,itemHeight:8,textStyle:{fontSize:12,color:"#334155"},pageTextStyle:{fontSize:11,color:"#64748b"},data:[e,s,a,"Sonstige In","Fixkosten","PO","FO","Phantom FO","Netto","Kontostand belastbar","Kontostand belastbar (<0)","Kontostand orientierend","Kontostand orientierend (<0)"]},grid:{left:54,right:68,top:54,bottom:42},xAxis:{type:"category",data:M,triggerEvent:!0,axisLabel:{hideOverlap:!0,fontSize:12,color:"#475569",margin:12},axisLine:{lineStyle:{color:"rgba(15,27,45,0.24)"}}},yAxis:[{type:"value",name:"Cashflow",nameTextStyle:{fontSize:12,color:"#475569"},axisLabel:{formatter:d=>ot(d),fontSize:12,color:"#475569"},splitLine:{lineStyle:{color:"rgba(15,27,45,0.10)"}}},{type:"value",name:"Kontostand",position:"right",nameTextStyle:{fontSize:12,color:"#475569"},axisLabel:{formatter:d=>E(d),fontSize:12,color:"#475569"},splitLine:{show:!1}}],series:[{name:e,type:"bar",stack:"cash",data:Oe,itemStyle:{color:"#166534"}},{name:s,type:"bar",stack:"cash",data:Be,itemStyle:{color:"#22c55e"}},{name:a,type:"bar",stack:"cash",data:Fe,itemStyle:{color:"#86efac"}},{name:"Sonstige In",type:"bar",stack:"cash",data:de,itemStyle:{color:"#6ee7b7"}},{name:"Fixkosten",type:"bar",stack:"cash",data:At,itemStyle:{color:"#7f1d1d"}},{name:"PO",type:"bar",stack:"cash",data:Kt,itemStyle:{color:"#e74c3c"}},{name:"FO",type:"bar",stack:"cash",data:Dt,itemStyle:{color:"#f97316"}},{name:"Phantom FO",type:"bar",stack:"cash",data:Ot,itemStyle:{color:"#fbbf24"}},{name:"Netto",type:"line",smooth:!0,showSymbol:!1,data:b.map(d=>Number(d.net||0)),itemStyle:{color:"#0f1b2d"},lineStyle:{width:2}},{name:"Kontostand belastbar",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:zt,lineStyle:{width:2,color:"#3bc2a7"},itemStyle:{color:"#3bc2a7"}},{name:"Kontostand belastbar (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:Nt,lineStyle:{width:2,color:"#b42318"},itemStyle:{color:"#b42318"}},{name:"Kontostand orientierend",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:Et,lineStyle:{width:2,type:"dashed",color:"#94a3b8"},itemStyle:{color:"#94a3b8"}},{name:"Kontostand orientierend (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:It,lineStyle:{width:2,type:"dashed",color:"#c2410c"},itemStyle:{color:"#c2410c"}}]}},[Oe,Fe,Be,de,X,O.monthMap,b,Y,v]),jt=r.useMemo(()=>{const e=new Map(b.map(a=>[a.month,a])),s=a=>{const o={};return v.forEach(M=>{o[M]=Number(a(M)||0)}),o};return[{key:"inflows",label:"Einnahmen",values:s(a=>{var o;return((o=B.get(a))==null?void 0:o.total)||0}),children:[{key:"inflows-amazon-core",label:"Amazon Kernprodukte",values:s(a=>{var o;return((o=B.get(a))==null?void 0:o.amazonCore)||0})},{key:"inflows-amazon-plan",label:"Amazon geplante Produkte",values:s(a=>{var o;return((o=B.get(a))==null?void 0:o.amazonPlanned)||0})},{key:"inflows-amazon-new",label:"Amazon neue Produkte",values:s(a=>{var o;return((o=B.get(a))==null?void 0:o.amazonNew)||0})},{key:"inflows-other",label:"Sonstige Einzahlungen",values:s(a=>{var o;return((o=B.get(a))==null?void 0:o.other)||0})}]},{key:"outflows",label:"Ausgaben",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.total)||0)}),children:[{key:"outflows-po",label:"PO",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.po)||0)})},{key:"outflows-fo",label:"FO",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.fo)||0)})},{key:"outflows-phantom-fo",label:"Phantom FO",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.phantomFo)||0)})},{key:"outflows-fixcost",label:"Fixkosten",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.fixcost)||0)})},{key:"outflows-other",label:"Sonstige Auszahlungen",values:s(a=>{var o;return-(((o=D.get(a))==null?void 0:o.other)||0)})}]},{key:"net",label:"Netto Cashflow",values:s(a=>{var o;return Number(((o=e.get(a))==null?void 0:o.net)||0)})},{key:"closing",label:"Kontostand",values:s(a=>{var o;return Number(((o=e.get(a))==null?void 0:o.closing)||0)})}]},[B,D,b,v]),Mt=r.useMemo(()=>[{title:"Position",key:"label",dataIndex:"label",fixed:"left",width:260,render:(e,s)=>{const a=s.key==="inflows"||s.key==="outflows"||s.key==="net"||s.key==="closing";return t.jsx(h,{strong:a,children:s.label})}},...v.map(e=>({title:$(e),key:e,width:132,align:"right",render:(s,a)=>{const o=Number(a.values[e]||0),M=a.key==="closing",y=!M&&o<0;return t.jsx(h,{strong:a.key==="net"||a.key==="closing",type:y?"danger":void 0,children:M?E(o):ot(o)})}}))],[v]);function wt(){g("next6"),K(tt.slice()),I(le?"calibrated":"forecast"),T("manual"),Q("basis"),oe(!0)}function Ct(e){if(!l)return;const s=e.month||l.month;if(e.checkKey==="cash_in"){u(P("/v2/abschluss/eingaben",{source:"dashboard",month:s}));return}if(e.checkKey==="fixcost"){u(P("/v2/abschluss/fixkosten",{source:"dashboard",month:s}));return}if(e.checkKey==="vat"){u(P("/v2/abschluss/ust",{source:"dashboard",month:s}));return}if(e.checkKey==="revenue_inputs"&&e.sku){u(P("/v2/products",{source:"dashboard",issues:"revenue",sku:e.sku}));return}if(e.issueType==="order_duty"&&e.sku){u(cn({sku:e.sku,month:s,suggestedUnits:e.suggestedUnits??null,requiredArrivalDate:e.requiredArrivalDate||null,recommendedOrderDate:e.recommendedOrderDate||null,source:"inventory_projection",firstRiskMonth:e.firstRiskMonth||null,orderMonth:e.orderMonth||null,leadTimeDays:e.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(e.issueType==="forecast_missing"&&e.sku){u(it({sku:e.sku,month:s}));return}if((e.issueType==="stock_oos"||e.issueType==="stock_under_safety")&&e.sku){u(ke({risk:e.issueType==="stock_oos"?"oos":"under_safety",abc:e.abcClass&&(e.abcClass==="A"||e.abcClass==="B")?"ab":"all",month:e.firstRiskMonth||s,sku:e.sku,mode:l.coverage.projectionMode||null}));return}u(rt({route:e.route,checkKey:e.checkKey,month:s,sku:e.sku||null,mode:l.coverage.projectionMode||null}))}return((Qe=(qe=n.settings)==null?void 0:qe.featureFlags)==null?void 0:Qe.executiveDashboardV2)!==!1?t.jsxs("div",{className:"v2-page",children:[t.jsxs(F,{className:"v2-intro-card",children:[t.jsxs("div",{className:"v2-page-head",children:[t.jsxs("div",{children:[t.jsx(et,{level:3,children:"Dashboard"}),t.jsx(Xe,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]}),t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(h,{children:"Zeitraum"}),t.jsx(Je,{value:m,onChange:e=>g(e),options:xe.map(e=>({value:e.value,label:e.label})),style:{width:220,maxWidth:"100%"}})]}),t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(h,{children:"PFO bis"}),t.jsx(Je,{value:_||void 0,onChange:e=>ae(String(e||"")),options:j.map(e=>({value:e,label:$(e)})),style:{width:220,maxWidth:"100%"},disabled:!j.length})]})]}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs(h,{type:"secondary",children:["Zeitraum: ",mt," (",v.length," Monate) · PFO bis: ",_?$(_):"—"]})})]}),i?t.jsx(G,{type:"error",showIcon:!0,message:i}):null,c?t.jsx(G,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,Le>0?t.jsx(G,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${Le} FOs prüfen`,description:t.jsx(U,{size:"small",onClick:()=>u("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,t.jsx(Tt,{title:l?`Monats-Check: ${$(l.month)}`:"Monats-Check",placement:"right",width:520,open:ct&&!!l,onClose:()=>Me(!1),destroyOnClose:!1,children:l?t.jsxs(k,{direction:"vertical",size:12,style:{width:"100%"},children:[t.jsxs(k,{wrap:!0,children:[t.jsx(N,{color:(fe==null?void 0:fe.color)||"default",children:l.coverage.statusLabel}),t.jsxs(h,{children:["Coverage ",at(l.coverage.ratio*100)," (",l.coverage.coveredSkus,"/",l.coverage.activeSkus,"),"," ","Bestand ",l.coverage.stockIssueCount,","," ","Bestellpflicht ",l.coverage.orderDutyIssueCount,","," ","Blocker ",l.coverage.blockerCount]}),ne?t.jsx(N,{children:"Vergangen (Info)"}):null]}),t.jsx(F,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:t.jsxs(k,{direction:"vertical",size:8,style:{width:"100%"},children:[t.jsxs(k,{wrap:!0,children:[t.jsx(V,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:t.jsx(N,{icon:t.jsx(W,{}),children:"Coverage"})}),t.jsx(V,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:t.jsx(N,{icon:t.jsx(W,{}),children:"Blocker"})})]}),vt.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs(h,{strong:!0,children:[an(e.state)," ",e.label]}),e.route?t.jsx(U,{size:"small",onClick:()=>u(rt({route:e.route,month:l.month,mode:l.coverage.projectionMode})),children:"Öffnen"}):null]}),t.jsx(h,{type:"secondary",children:e.description})]},e.key))]})}),t.jsx(F,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:l.coverage.statusKey==="full"?t.jsx(G,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):ne?t.jsx(G,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):t.jsxs(k,{direction:"vertical",size:10,style:{width:"100%"},children:[t.jsxs("div",{children:[t.jsx(h,{strong:!0,children:"1) Blocker"}),l.blockers.length?t.jsx(k,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:l.blockers.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(N,{color:"red",children:"Blocker"}),t.jsx(U,{size:"small",onClick:()=>Ct(e),children:"Öffnen"})]}),t.jsx(h,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(h,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),t.jsxs("div",{children:[t.jsx(h,{strong:!0,children:"2) Warnungen"}),Re.length?t.jsx(k,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:Re.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(N,{color:"gold",children:"Warnung"}),t.jsx(U,{size:"small",onClick:()=>u(e.route),children:"Öffnen"})]}),t.jsx(h,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(h,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):t.jsx(h,{type:"secondary",children:"Kein Monat gewählt."})}),t.jsx(Ye,{className:"v2-dashboard-module-collapse",activeKey:te,onChange:Ke,items:[{key:"cashflow",label:"Kontostand & Cashflow",children:t.jsxs(F,{className:"v2-dashboard-chart-card",children:[t.jsxs("div",{className:"v2-calc-cockpit-shell",children:[t.jsxs("div",{className:"v2-calc-cockpit-status",children:[t.jsxs(k,{wrap:!0,children:[t.jsxs(h,{type:"secondary",children:["Min. Kontostand: ",t.jsx("strong",{children:E(bt)})]}),t.jsxs(h,{type:"secondary",children:["Summe Netto: ",t.jsx("strong",{children:E(me)})]})]}),t.jsx(U,{size:"small",onClick:wt,children:"Zurücksetzen"})]}),t.jsxs("div",{className:"v2-calc-cockpit-modules",children:[t.jsxs(F,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(k,{size:6,children:[t.jsx(h,{strong:!0,children:"Portfolio-Scope"}),t.jsx(V,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:t.jsx(W,{})})]}),t.jsx("div",{children:t.jsx(h,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx("div",{className:"v2-calc-cockpit-chip-row",children:nn.map(e=>{const s=x.includes(e.value);return t.jsx(U,{size:"small",type:s?"primary":"default",onClick:()=>ht(e.value),children:e.label},e.value)})}),t.jsx(h,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard."})]}),t.jsxs(F,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(k,{size:6,children:[t.jsx(h,{strong:!0,children:"Umsatzbasis"}),t.jsx(V,{title:"Forecast-Umsatz = Absatzprognose × Verkaufspreis. Kalibrierter Umsatz = Forecast-Umsatz mit Kalibrierfaktor aus Eingaben.",children:t.jsx(W,{})})]}),t.jsx("div",{children:t.jsx(h,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(ye,{block:!0,value:p,onChange:e=>I(String(e)==="calibrated"?"calibrated":"forecast"),options:[{label:"Forecast-Umsatz",value:"forecast"},{label:"Kalibrierter Umsatz",value:"calibrated"}]}),t.jsxs(h,{type:"secondary",children:[p==="calibrated"?`Kalibrierung aktiv (wirkt über ${dt} Monate).`:"Kalibrierung aus."," ",t.jsx(U,{size:"small",type:"link",onClick:()=>u("/v2/abschluss/eingaben"),children:p==="calibrated"?"Eingaben öffnen":"In Eingaben aktivieren"})]}),p==="calibrated"&&!xt?t.jsx(h,{type:"warning",children:"Keine wirksamen Kalibrierdaten gefunden. Das Diagramm entspricht aktuell dem Forecast-Umsatz."}):null]}),t.jsxs(F,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(k,{size:6,children:[t.jsx(h,{strong:!0,children:"Amazon Auszahlungsquote"}),t.jsx(V,{title:"Manuell nutzt die Monatsquote aus Eingaben. Empfehlung berechnet die Quote automatisch als Vorschlag je Monat.",children:t.jsx(W,{})})]}),t.jsx("div",{children:t.jsx(h,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(ye,{block:!0,value:z,onChange:e=>T(String(e)==="recommendation"?"recommendation":"manual"),options:[{label:"Manuelle Quote",value:"manual"},{label:"Empfehlung",value:"recommendation"}]}),t.jsxs(k,{direction:"vertical",size:6,style:{width:"100%"},children:[t.jsxs(k,{size:6,children:[t.jsx(h,{strong:!0,children:"Sicherheitsmodus"}),t.jsx(V,{title:"Basis: keine Sicherheitsmarge. Konservativ: reduziert die Quote in zukünftigen Monaten um 1pp pro Monat (max. 5pp).",children:t.jsx(W,{})})]}),t.jsx(ye,{block:!0,value:S,onChange:e=>Q(String(e)==="conservative"?"conservative":"basis"),options:[{label:"Basis",value:"basis"},{label:"Konservativ",value:"conservative"}]})]}),yt?t.jsxs("div",{className:"v2-calc-cockpit-q4-row",children:[t.jsx(Yt,{checked:se,onChange:e=>oe(e.target.checked),children:"Saisonalität (Q4) berücksichtigen"}),t.jsx(V,{title:"Q4 berücksichtigt saisonale Besonderheiten für Oktober bis Dezember. Gilt nur für die Empfehlung.",children:t.jsx(W,{})})]}):null,t.jsx(h,{type:"secondary",children:z==="manual"?"Verwendet die manuell gepflegte Auszahlungsquote je Monat.":"Empfehlung wird je Monat automatisch berechnet und direkt im Chart angewendet."})]})]})]}),t.jsxs("div",{className:"v2-dashboard-chart-summary",children:[t.jsxs(N,{color:"green",children:["Einzahlungen: ",E(gt)]}),t.jsxs(N,{color:"red",children:["Auszahlungen: ",E(pt)]}),t.jsxs(N,{color:me>=0?"green":"red",children:["Netto: ",E(me)]}),H.length?t.jsxs(N,{color:"gold",children:["PFO: ",H.length]}):null,_?t.jsxs(N,{color:"gold",children:["bis ",$(_)]}):null]}),t.jsx(h,{type:"secondary",className:"v2-dashboard-chart-hint",children:"Klick auf Monat oder Balken für Details. Legende ist scrollbar."}),t.jsx(_t,{style:{height:430},option:St,onEvents:kt})]})}]}),t.jsx(Ye,{className:"v2-dashboard-module-collapse",activeKey:te,onChange:Ke,items:[{key:"pnl",label:"Monatliche PnL (Matrix)",children:t.jsxs(F,{children:[t.jsx(et,{level:4,children:"Monatliche PnL (Matrix)"}),t.jsx(Xe,{type:"secondary",children:"Zeilen = Einnahmen/Ausgaben-Struktur, Spalten = gewählter Zeitraum. Klappe Einnahmen und Ausgaben für Details auf."}),t.jsx(Xt,{className:"v2-dashboard-pnl-table",columns:Mt,dataSource:jt,pagination:!1,size:"small",rowKey:"key",rowClassName:e=>e.key==="net"||e.key==="closing"?"v2-dashboard-pnl-table-row-total":Array.isArray(e.children)&&e.children.length?"v2-dashboard-pnl-table-row-group":"v2-dashboard-pnl-table-row-detail",expandable:{defaultExpandAllRows:!0},scroll:{x:"max-content"}})]})}]})]}):t.jsx("div",{className:"v2-page",children:t.jsx(G,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{$n as default};
