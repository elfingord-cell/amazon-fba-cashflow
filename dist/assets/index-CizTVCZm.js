import{I as Ft,t as y,k as e,K as Tt,S as te,M as fe,O as R,L as G,T as Ot,R as dt,U as ve,a6 as Dt,V as It}from"./index-DN7VFcDZ.js";import{e as Ut,c as Bt}from"./cashflow-D3IZ29ar.js";import{c as zt,n as Lt,d as $t,h as Yt,i as Kt}from"./tableModels-BGPMgu0b.js";import{b as qt,n as ge,f as Vt}from"./months-BTPgK-LH.js";import{D as A}from"./DeNumberInput-C9hBbbMA.js";import{u as Gt,C as U}from"./workspace-DpK7WcpK.js";import{S as Jt}from"./index-CRiLTIeN.js";import{S as ht}from"./index-B4z7de4w.js";import{R as Wt}from"./InfoCircleOutlined-B8t9bA2D.js";import{S as Oe}from"./index-CWZiztpp.js";import"./planProducts-BpFPmIqP.js";import"./cashInRules-r9rlv23d.js";import"./productCompletenessV2-l-JWtL-P.js";import"./index-F8BvG45B.js";import"./DownOutlined-BokHnPkJ.js";import"./Dropdown-DPveZyNz.js";const{Paragraph:_t,Text:l,Title:se}=Tt,Ht=[{label:"Effektive Quote",value:"effective"},{label:"KSt + GewSt",value:"split"}],Qt=[{label:"EUR",value:"absolute"},{label:"% Umsatz",value:"percent_revenue"}],Zt=[{label:"Ausschüttungsquote %",value:"ratio"},{label:"Gewünschte Dividende EUR",value:"amount"}],k={reserveReleaseAvailableEur:0,reserveReleaseUseEur:0,taxMode:"effective",effectiveTaxRatePct:30,corporateTaxRatePct:15,tradeTaxRatePct:14,otherCostsManualEur:0,bufferMode:"absolute",bufferValue:0,payoutTargetMode:"ratio",payoutRatioPct:50,desiredDividendEur:0};function ze(s){return`${s}-${Math.random().toString(36).slice(2,9)}`}function T(s){if(s==null||s==="")return null;const n=Number(s);return Number.isFinite(n)?n:null}function E(s){const n=Number(T(s)||0);return Number.isFinite(n)?Math.max(0,Math.min(100,n)):0}function M(s){const n=Number(T(s)||0);return Number.isFinite(n)?Math.max(0,n):0}function S(s){const n=Number(s);return Number.isFinite(n)?n.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}):"—"}function De(s,n=1){const u=Number(s);return Number.isFinite(u)?`${u.toLocaleString("de-DE",{minimumFractionDigits:n,maximumFractionDigits:n})} %`:"—"}function Le(s){const n=s&&typeof s=="object"?s:{},u=String(n.taxMode||k.taxMode)==="split"?"split":"effective",c=String(n.bufferMode||k.bufferMode)==="percent_revenue"?"percent_revenue":"absolute",d=String(n.payoutTargetMode||k.payoutTargetMode)==="amount"?"amount":"ratio";return{reserveReleaseAvailableEur:M(n.reserveReleaseAvailableEur),reserveReleaseUseEur:M(n.reserveReleaseUseEur),taxMode:u,effectiveTaxRatePct:E(n.effectiveTaxRatePct??k.effectiveTaxRatePct),corporateTaxRatePct:E(n.corporateTaxRatePct??k.corporateTaxRatePct),tradeTaxRatePct:E(n.tradeTaxRatePct??k.tradeTaxRatePct),otherCostsManualEur:M(n.otherCostsManualEur),bufferMode:c,bufferValue:M(n.bufferValue),payoutTargetMode:d,payoutRatioPct:E(n.payoutRatioPct??k.payoutRatioPct),desiredDividendEur:M(n.desiredDividendEur)}}function Xt(s){return!s||typeof s!="object"?{}:Object.entries(s).reduce((n,[u,c])=>(/^\d{4}$/.test(String(u||""))&&(n[u]=Le(c)),n),{})}function es(s){return Array.isArray(s)?s.map((n,u)=>{const c=n&&typeof n=="object"?n:{},d=Number(c.year);return{id:String(c.id||ze(`cal-${u}`)),year:Number.isFinite(d)?Math.max(2e3,Math.round(d)):new Date().getFullYear()-1,revenueEur:T(c.revenueEur),netIncomeEur:T(c.netIncomeEur)}}).sort((n,u)=>u.year-n.year):[]}function ts(s){return Object.entries(s||{}).reduce((n,[u,c])=>(/^\d{4}$/.test(String(u||""))&&(n[u]=Le(c)),n),{})}function ft(s){return(Array.isArray(s)?s:[]).map(n=>({id:String(n.id||ze("cal")),year:Math.max(2e3,Math.round(Number(n.year||new Date().getFullYear()-1))),revenueEur:T(n.revenueEur),netIncomeEur:T(n.netIncomeEur)})).sort((n,u)=>u.year-n.year)}function Ie(s){const n=Object.fromEntries(Object.entries(s.assumptionsByYear||{}).sort((c,d)=>c[0].localeCompare(d[0])).map(([c,d])=>[c,Le(d)])),u=ft(s.calibrationRows||[]);return JSON.stringify({selectedYear:Math.round(Number(s.selectedYear||new Date().getFullYear())),assumptionsByYear:n,calibrationRows:u})}function mt(s){const n=new Set,c=new Date().getFullYear();[c-4,c-3,c-2,c-1,c,c+1].forEach(o=>{n.add(o)});const d=o=>{const g=ge(o);g&&n.add(Number(g.slice(0,4)))};Object.keys(s.assumptionsByYear||{}).forEach(o=>{/^\d{4}$/.test(o)&&n.add(Number(o))}),(s.calibrationRows||[]).forEach(o=>{Number.isFinite(o.year)&&n.add(Number(o.year))});const C=s.stateObj.forecast&&typeof s.stateObj.forecast=="object"?s.stateObj.forecast:{},J=C.forecastManual&&typeof C.forecastManual=="object"?C.forecastManual:{},v=C.forecastImport&&typeof C.forecastImport=="object"?C.forecastImport:{};return Object.values(J).forEach(o=>{!o||typeof o!="object"||Object.keys(o).forEach(d)}),Object.values(v).forEach(o=>{!o||typeof o!="object"||Object.keys(o).forEach(d)}),(Array.isArray(s.stateObj.incomings)?s.stateObj.incomings:[]).forEach(o=>{d(o.month)}),(Array.isArray(s.stateObj.extras)?s.stateObj.extras:[]).forEach(o=>{const g=o;d(g.month),d(String(g.date||"").slice(0,7))}),(Array.isArray(s.stateObj.dividends)?s.stateObj.dividends:[]).forEach(o=>{const g=o;d(g.month),d(String(g.date||"").slice(0,7))}),Object.keys(s.stateObj.monthlyActuals&&typeof s.stateObj.monthlyActuals=="object"?s.stateObj.monthlyActuals:{}).forEach(d),(Array.isArray(s.stateObj.fixcosts)?s.stateObj.fixcosts:[]).forEach(o=>{const g=o;d(g.startMonth),d(g.endMonth)}),Array.from(n).filter(o=>Number.isFinite(o)).sort((o,g)=>g-o)}function ss(s){return s.startsWith("/v2/forecast")?"Absatzprognose":s.startsWith("/v2/products")?"Produkte":s.startsWith("/v2/abschluss/fixkosten")?"Fixkosten":s.startsWith("/v2/settings")?"Settings":s.startsWith("/v2/abschluss/dividendenplanung")?"Dividendenplanung":"Modul"}function Ue(s){const n=Math.max(0,Math.min(60,s.baseTaxRatePct+s.taxDeltaPct)),u=s.ebt>0?s.ebt*(n/100):0,c=s.ebt-u,d=Math.max(0,s.baseBuffer*s.bufferMultiplier),C=s.calibrationAvailable?Math.max(0,s.calibrationFactor*(1+s.calibrationShiftPct/100)):1,J=(c+s.reserveUse-d)*C;return{taxRatePct:n,taxAmount:u,netIncome:c,buffer:d,calibrationFactor:C,distributable:J}}function rs(s){return s==="green"?"green":s==="yellow"?"gold":s==="orange"?"orange":"red"}function Be(s){return s==="green"?"Grün":s==="yellow"?"Gelb":s==="orange"?"Orange":"Rot"}function Ms(){const{state:s,loading:n,saving:u,error:c,lastSavedAt:d,saveWith:C}=Gt(),J=Ft(),v=s,g=new Date().getFullYear(),[m,$e]=y.useState(g),[B,Ye]=y.useState({[String(g)]:{...k}}),[O,Y]=y.useState([]),[Ke,re]=y.useState(!1),[qe,be]=y.useState(""),[vt,xe]=y.useState(!1),K=y.useRef(null),ne=y.useRef(""),je=y.useRef(!0),gt=y.useMemo(()=>mt({stateObj:v,assumptionsByYear:B,calibrationRows:O}),[B,O,v]);y.useEffect(()=>{const t=v.dividendPlanning&&typeof v.dividendPlanning=="object"?v.dividendPlanning:{},j=Xt(t.assumptionsByYear),f=es(t.calibrationRows),p=mt({stateObj:v,assumptionsByYear:j,calibrationRows:f}),x=Number(t.selectedYear),q=p.includes(g)?g:p[0]||g,D=Number.isFinite(x)?Math.round(x):q;j[String(D)]||(j[String(D)]={...k}),je.current=!0,$e(D),Ye(j),Y(f),ne.current=Ie({selectedYear:D,assumptionsByYear:j,calibrationRows:f}),re(!1),be("")},[g,v.dividendPlanning]),y.useEffect(()=>()=>{K.current!=null&&window.clearTimeout(K.current)},[]);const h=y.useMemo(()=>{const t=String(m);return B[t]||{...k}},[B,m]),ae=y.useMemo(()=>qt(`${m}-01`,12),[m]),i=y.useMemo(()=>{const t=h,j=zt(v),f=v.forecast&&typeof v.forecast=="object"?v.forecast:{},p=f.forecastImport&&typeof f.forecastImport=="object"?f.forecastImport:{},x=Lt(f.forecastManual&&typeof f.forecastManual=="object"?f.forecastManual:{}),q=$t(v,j).filter(r=>r.isActive),D=new Map;(Array.isArray(v.products)?v.products:[]).forEach(r=>{const a=r||{},b=String(a.sku||"").trim().toLowerCase();b&&D.set(b,a)});const F=[];let L=0,ye=0;q.forEach(r=>{const a=String(r.sku||"").trim();if(!a)return;const b=String(r.alias||a).trim(),N=D.get(a.toLowerCase())||null,I=Number(r.avgSellingPriceGrossEUR),he=Number(r.sellerboardMarginPct),ke=Number(N==null?void 0:N.landedUnitCostEur),Ct=Number.isFinite(I)&&I>0,at=Number.isFinite(he)&&he>0&&he<=100;let Ce=!1;const it=[];let we=0,ot=0,me=0;ae.forEach(ct=>{const lt=Yt(x,p,a,ct,r.plannedUnitsByMonth);if(!Number.isFinite(lt)){it.push(ct);return}const Fe=Number(lt);ot+=Fe;const ut=Kt("revenue",Fe,r);if(Number.isFinite(ut)){const Te=Number(ut);if(we+=Te,at){const wt=Te*(he/100);me+=Te-wt,Ce=!0;return}}if(Number.isFinite(ke)&&ke>0){me+=Fe*ke,Ce=!0;return}}),L+=we,ye+=me,F.push({sku:a,alias:b,revenue:we,units:ot,cogs:me,missingForecastMonths:it,hasPrice:Ct,hasMargin:at,hasCostBasis:Ce})});const We=(Array.isArray(v.extras)?v.extras:[]).reduce((r,a)=>{const b=a,N=ge(b.month||String(b.date||"").slice(0,7));if(!N||!N.startsWith(`${m}-`))return r;const I=Number(T(b.amountEur)||0);return I>=0?r:r+Math.abs(I)},0),_e=M(t.otherCostsManualEur),He=We+_e,Qe=Ut(v,{months:ae,today:new Date}).reduce((r,a)=>r+Math.abs(Number(a.amount||0)),0),$=L-ye-Qe-He,W=t.taxMode==="effective"?E(t.effectiveTaxRatePct):E(t.corporateTaxRatePct)+E(t.tradeTaxRatePct),Ze=$>0?$*(W/100):0,Me=$-Ze,Xe=M(t.reserveReleaseAvailableEur),jt=M(t.reserveReleaseUseEur),_=Math.min(Xe,jt),V=t.bufferMode==="percent_revenue"?L*(E(t.bufferValue)/100):M(t.bufferValue),pt=Me+_-V,H=O.filter(r=>{const a=Number.isFinite(r.year)&&r.year>=2e3,b=Number.isFinite(r.revenueEur)&&Number(r.revenueEur)>0,N=Number.isFinite(r.netIncomeEur);return a&&b&&N}),et=H.reduce((r,a)=>r+Number(a.revenueEur||0),0),yt=H.reduce((r,a)=>r+Number(a.netIncomeEur||0),0),Re=et>0?yt/et:null,ie=L>0?Me/L:null,Q=Number.isFinite(Re)&&Number.isFinite(ie)&&Math.abs(Number(ie))>1e-5,oe=Q?Math.max(.5,Math.min(1.5,Number(Re)/Number(ie))):1,Mt=Ue({ebt:$,reserveUse:_,baseTaxRatePct:W,baseBuffer:V,calibrationFactor:oe,calibrationAvailable:Q,taxDeltaPct:3,bufferMultiplier:1.2,calibrationShiftPct:-8}),Rt=Ue({ebt:$,reserveUse:_,baseTaxRatePct:W,baseBuffer:V,calibrationFactor:oe,calibrationAvailable:Q,taxDeltaPct:0,bufferMultiplier:1,calibrationShiftPct:0}),St=Ue({ebt:$,reserveUse:_,baseTaxRatePct:W,baseBuffer:V,calibrationFactor:oe,calibrationAvailable:Q,taxDeltaPct:-2,bufferMultiplier:.8,calibrationShiftPct:8}),Se=F.slice().sort((r,a)=>a.revenue-r.revenue),tt=Se.reduce((r,a)=>r+a.revenue,0),ce=new Set;if(tt>0){let r=0;Se.forEach((a,b)=>{if(a.revenue<=0)return;r+=a.revenue,(r/tt<=.8||b===0)&&ce.add(a.sku.toLowerCase())})}ce.size||Se.forEach(r=>ce.add(r.sku.toLowerCase()));const Ee=F.filter(r=>ce.has(r.sku.toLowerCase())),le=Ee.flatMap(r=>r.missingForecastMonths.map(a=>({sku:r.sku,month:a}))),Z=F.filter(r=>!r.hasPrice),X=F.filter(r=>!r.hasMargin),ue=F.filter(r=>!r.hasCostBasis&&r.units>0),st=Array.isArray(v.fixcosts)?v.fixcosts:[],Pe=`${m}-12`,rt=st.length>0,Et=rt&&st.some(r=>{const a=ge(r.startMonth)||Pe,b=ge(r.endMonth);return!(!(Number(T(r.amount)||0)>0)||a>Pe||b&&b<Pe)}),Pt=t.taxMode==="effective"?Number.isFinite(t.effectiveTaxRatePct):Number.isFinite(t.corporateTaxRatePct)&&Number.isFinite(t.tradeTaxRatePct),ee=[],w=r=>{ee.push({...r,routeLabel:ss(r.route)})};if(F.length||w({id:"no-active-products",severity:"critical",message:"Keine aktiven Produkte mit Forecast-Basis vorhanden.",route:"/v2/products"}),L<=0&&w({id:"no-revenue-basis",severity:"critical",message:`Keine Umsatzbasis für ${m}. Forecast oder VK-Preise fehlen.`,route:"/v2/forecast"}),le.length>0&&Ee.length>0){const r=Ee.length*ae.length,a=r>0?le.length/r:0,b=a>=.5?"critical":a>=.2?"major":"minor",N=le.slice(0,3).map(I=>`${I.sku} ${Vt(I.month)}`).join(", ");w({id:"forecast-gaps",severity:b,message:`${le.length}/${r} Forecast-Werte fehlen (${N||"Details"}).`,route:"/v2/forecast"})}if(Z.length>0){const r=Z.length>=Math.max(1,Math.round(F.length*.5))?"critical":"major",a=Z.slice(0,4).map(b=>b.sku).join(", ");w({id:"missing-price",severity:r,message:`VK-Preis fehlt für ${Z.length} SKU(s): ${a}${Z.length>4?" ...":""}`,route:"/v2/products?issues=revenue&expand=all"})}if(X.length>0){const r=X.length>=Math.max(1,Math.round(F.length*.5))?"major":"minor",a=X.slice(0,4).map(b=>b.sku).join(", ");w({id:"missing-margin",severity:r,message:`Marge fehlt für ${X.length} SKU(s): ${a}${X.length>4?" ...":""}`,route:"/v2/products?issues=revenue&expand=all"})}if(ue.length>0){const r=ue.slice(0,4).map(a=>a.sku).join(", ");w({id:"missing-cost-basis",severity:"major",message:`COGS-Basis fehlt für ${ue.length} SKU(s): ${r}${ue.length>4?" ...":""}`,route:"/v2/products?issues=needs_fix&expand=all"})}rt?Et||w({id:"fixcost-range",severity:"major",message:`Fixkosten sind nicht bis Jahresende ${m} hinterlegt.`,route:"/v2/abschluss/fixkosten"}):w({id:"no-fixcosts",severity:"critical",message:"Keine Fixkostenbasis vorhanden.",route:"/v2/abschluss/fixkosten"}),Pt||w({id:"missing-tax-assumption",severity:"critical",message:"Steuerannahme ist nicht vollständig gesetzt.",route:"/v2/settings"}),V<=0&&H.length===0?w({id:"buffer-or-calibration",severity:"major",message:"Weder Puffer noch Kalibrierung vorhanden.",route:"/v2/abschluss/dividendenplanung"}):H.length===0&&w({id:"no-calibration",severity:"minor",message:"Kalibrierung fehlt (optional, verbessert Realismus).",route:"/v2/abschluss/dividendenplanung"});const Nt=ee.filter(r=>r.severity==="critical").length,nt=ee.filter(r=>r.severity==="major").length,At=ee.filter(r=>r.severity==="minor").length;let de="green";Nt>0?de="red":nt>=2?de="orange":(nt>0||At>0)&&(de="yellow");const Ne=(()=>{try{const r=Bt(v);return Array.isArray(r==null?void 0:r.breakdown)?r.breakdown:[]}catch{return[]}})().filter(r=>String(r.month||"").startsWith(`${m}-`)).sort((r,a)=>String(r.month||"").localeCompare(String(a.month||""))),Ae=Ne.length?Ne[Ne.length-1]:null,kt=Ae?Number(Ae.closing||0):null;return{metrics:F,revenue:L,cogs:ye,fixcost:Qe,extrasOutflow:We,manualOtherCosts:_e,otherCosts:He,ebt:$,taxes:Ze,netIncome:Me,reserveUse:_,reserveAvailable:Xe,baseTaxRate:W,baseBuffer:V,distributableBase:pt,validCalibrationRows:H,historicalMargin:Re,planMargin:ie,calibrationAvailable:Q,calibrationFactor:oe,conservativeScenario:Mt,realisticScenario:Rt,aggressiveScenario:St,readinessIssues:ee,readinessLevel:de,latestLiquidityRow:Ae,latestLiquidityClosing:kt}},[h,O,m,v,ae]),z=y.useMemo(()=>({conservative:Math.max(0,i.conservativeScenario.distributable),realistic:Math.max(0,i.realisticScenario.distributable),aggressive:Math.max(0,i.aggressiveScenario.distributable)}),[i]),pe=y.useMemo(()=>h.payoutTargetMode==="amount"?M(h.desiredDividendEur):z.realistic*(E(h.payoutRatioPct)/100),[h.desiredDividendEur,h.payoutRatioPct,h.payoutTargetMode,z.realistic]),Ve=pe<=z.realistic,Ge=z.realistic-pe;async function bt(t){const j=ts(B);j[String(m)]||(j[String(m)]={...k});const f=ft(O),p=Ie({selectedYear:m,assumptionsByYear:j,calibrationRows:f});if(p===ne.current){re(!1);return}await C(x=>{const q=It(x),D=q;return D.dividendPlanning={selectedYear:m,assumptionsByYear:j,calibrationRows:f},q},t),ne.current=p,re(!1),be(`Gespeichert: ${new Date().toLocaleTimeString("de-DE")}`)}function Je(t=420){K.current!=null&&window.clearTimeout(K.current),K.current=window.setTimeout(()=>{if(K.current=null,u){Je(180);return}bt("v2:dividend-planning:auto")},Math.max(120,Number(t)||420))}y.useEffect(()=>{if(je.current){je.current=!1;return}const j=Ie({selectedYear:m,assumptionsByYear:B,calibrationRows:O})!==ne.current;re(j),j&&(be("Ungespeicherte Aenderungen"),Je(420))},[B,O,m]);function P(t,j){Ye(f=>{const p=String(m),x=f[p]||{...k};return{...f,[p]:{...x,[t]:j}}})}const xt=[{key:"revenue",label:"Umsatz (Plan, brutto)",value:i.revenue},{key:"cogs",label:"Wareneinsatz / COGS (Plan)",value:-i.cogs},{key:"fixcost",label:"Fixkosten (Plan)",value:-i.fixcost},{key:"other",label:"Sonstige Kosten (Plan)",value:-i.otherCosts},{key:"ebt",label:"Ergebnis vor Steuern (EBT)",value:i.ebt,strong:!0},{key:"tax",label:"Ertragsteuern (Plan)",value:-i.taxes},{key:"net",label:"Jahresüberschuss (Plan)",value:i.netIncome,strong:!0}];return e.jsxs("div",{className:"v2-page",children:[e.jsxs(U,{className:"v2-intro-card",children:[e.jsxs("div",{className:"v2-page-head",children:[e.jsxs("div",{children:[e.jsx(se,{level:3,children:"Dividendenplanung"}),e.jsx(_t,{children:"Planung für ein Geschäftsjahr mit Plan-GuV, ausschüttungsfähigem Betrag, Bandbreite und Reifegrad-Ampel."})]}),e.jsxs(te,{wrap:!0,align:"start",children:[e.jsxs("div",{className:"v2-toolbar-field",children:[e.jsx(l,{strong:!0,children:"Jahr"}),e.jsx(Jt,{value:m,onChange:t=>$e(Number(t)),options:gt.map(t=>({value:t,label:String(t)})),style:{minWidth:120}})]}),e.jsxs(fe,{className:`v2-dividend-traffic v2-dividend-traffic--${i.readinessLevel}`,onClick:()=>xe(!0),children:["Ampel: ",Be(i.readinessLevel)]})]})]}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs("div",{className:"v2-toolbar-row",children:[e.jsxs(R,{color:"blue",children:["Planung für Jahr ",m]}),e.jsxs(R,{color:rs(i.readinessLevel),children:["Reifegrad: ",Be(i.readinessLevel)]}),u?e.jsx(R,{color:"processing",children:"Speichern..."}):null,Ke?e.jsx(R,{color:"gold",children:"Ungespeicherte Aenderungen"}):e.jsx(R,{color:"green",children:"Synchron"}),d?e.jsxs(R,{color:"green",children:["Gespeichert: ",new Date(d).toLocaleTimeString("de-DE")]}):null,qe?e.jsx(R,{color:Ke?"gold":"blue",children:qe}):null]})})]}),c?e.jsx(G,{type:"error",showIcon:!0,message:c}):null,n?e.jsx(G,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,e.jsxs("div",{className:"v2-dividend-kpi-grid",children:[e.jsx(U,{children:e.jsx(ht,{title:"Jahresüberschuss (Plan)",value:i.netIncome,precision:2,formatter:t=>S(t)})}),e.jsxs(U,{children:[e.jsx(ht,{title:"Ausschüttungsfähiger Betrag (Plan)",value:i.distributableBase,precision:2,formatter:t=>S(t)}),e.jsx(l,{type:"secondary",children:"Formel: Jahresüberschuss + Rücklagennutzung − Puffer"})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"v2-dividend-band-head",children:[e.jsx(l,{strong:!0,children:"Dividenden-Bandbreite"}),e.jsx(Ot,{title:"Konservativ: höhere Steuerquote + größerer Puffer. Realistisch: Basiswerte (inkl. optionaler Kalibrierung). Aggressiv: niedrigere Steuerquote + kleinerer Puffer.",children:e.jsx(Wt,{})})]}),e.jsxs("div",{className:"v2-dividend-band-grid",children:[e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Konservativ"}),e.jsx("div",{children:S(z.conservative)})]}),e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Realistisch"}),e.jsx("div",{children:S(z.realistic)})]}),e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Aggressiv"}),e.jsx("div",{children:S(z.aggressive)})]})]})]})]}),i.latestLiquidityRow?i.latestLiquidityClosing!=null&&i.latestLiquidityClosing<0?e.jsx(G,{type:"warning",showIcon:!0,message:`Liquiditätswarnung: Kontostand zum ${String(i.latestLiquidityRow.month)} voraussichtlich negativ (${S(i.latestLiquidityClosing)}).`}):e.jsx(G,{type:"success",showIcon:!0,message:`Liquidität ok: letzter geplanter Kontostand in ${m} (${String(i.latestLiquidityRow.month)}) ist ${S(i.latestLiquidityClosing)}.`}):e.jsx(G,{type:"info",showIcon:!0,message:`Für ${m} liegt im Cashflow-Horizont aktuell kein Monatsabschluss vor. Liquiditätsprüfung daher nur eingeschränkt möglich.`}),e.jsxs(U,{children:[e.jsxs(se,{level:5,children:["Plan-GuV (",m,")"]}),e.jsx(l,{type:"secondary",children:"Umsatzbasis = Forecast-Units × Ø VK-Preis (brutto). COGS werden primär über Brutto-Marge je Produkt abgeleitet."}),e.jsx("div",{className:"v2-stats-table-wrap",children:e.jsxs("table",{className:"v2-stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Position"}),e.jsx("th",{style:{textAlign:"right"},children:"Wert"})]})}),e.jsx("tbody",{children:xt.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.strong?e.jsx(l,{strong:!0,children:t.label}):t.label}),e.jsx("td",{style:{textAlign:"right"},children:t.strong?e.jsx(l,{strong:!0,children:S(t.value)}):S(t.value)})]},t.key))})]})})]}),e.jsxs(dt,{gutter:[12,12],children:[e.jsx(ve,{xs:24,lg:12,children:e.jsxs(U,{children:[e.jsx(se,{level:5,children:"Annahmen / Ergänzungen"}),e.jsxs(te,{direction:"vertical",style:{width:"100%"},size:14,children:[e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{children:"Auflösbare Rücklagen aus UG→GmbH (EUR)"}),e.jsx(A,{mode:"decimal",min:0,value:h.reserveReleaseAvailableEur,onChange:t=>P("reserveReleaseAvailableEur",M(t))})]}),e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{children:"Davon in diesem Jahr nutzen (EUR)"}),e.jsx(A,{mode:"decimal",min:0,value:h.reserveReleaseUseEur,onChange:t=>P("reserveReleaseUseEur",M(t))}),h.reserveReleaseUseEur>h.reserveReleaseAvailableEur?e.jsx(l,{type:"warning",children:"Nutzung wird auf die verfügbaren Rücklagen begrenzt."}):null]}),e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{strong:!0,children:"Steuerannahme (Näherung)"}),e.jsx(Oe,{value:h.taxMode,options:Ht,onChange:t=>P("taxMode",String(t)==="split"?"split":"effective")}),h.taxMode==="effective"?e.jsxs("div",{children:[e.jsx(l,{children:"Effektive Steuerquote auf EBT (%)"}),e.jsx(A,{mode:"percent",min:0,max:100,value:h.effectiveTaxRatePct,onChange:t=>P("effectiveTaxRatePct",E(t))})]}):e.jsxs(dt,{gutter:[10,10],children:[e.jsxs(ve,{xs:24,md:12,children:[e.jsx(l,{children:"KSt (%)"}),e.jsx(A,{mode:"percent",min:0,max:100,value:h.corporateTaxRatePct,onChange:t=>P("corporateTaxRatePct",E(t))})]}),e.jsxs(ve,{xs:24,md:12,children:[e.jsx(l,{children:"GewSt (%)"}),e.jsx(A,{mode:"percent",min:0,max:100,value:h.tradeTaxRatePct,onChange:t=>P("tradeTaxRatePct",E(t))})]})]}),e.jsx(l,{type:"secondary",children:"Näherung, ersetzt keine Steuerberatung."})]})]})]})}),e.jsx(ve,{xs:24,lg:12,children:e.jsxs(U,{children:[e.jsx(se,{level:5,children:"Puffer, Zieldividende, Machbarkeit"}),e.jsxs(te,{direction:"vertical",style:{width:"100%"},size:14,children:[e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{children:"Zusätzliche sonstige Kosten (EUR)"}),e.jsx(A,{mode:"decimal",min:0,value:h.otherCostsManualEur,onChange:t=>P("otherCostsManualEur",M(t))}),e.jsxs(l,{type:"secondary",children:["Abgeleitete Extras (Out) in ",m,": ",S(i.extrasOutflow)]})]}),e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{children:"Sonstige Kosten-Puffer"}),e.jsx(Oe,{value:h.bufferMode,options:Qt,onChange:t=>P("bufferMode",String(t)==="percent_revenue"?"percent_revenue":"absolute")}),e.jsx(A,{mode:h.bufferMode==="percent_revenue"?"percent":"decimal",min:0,value:h.bufferValue,onChange:t=>P("bufferValue",M(t))}),e.jsxs(l,{type:"secondary",children:["Wirkt im Ausschüttungsbetrag als Sicherheitsabzug: ",S(i.baseBuffer)]})]}),e.jsxs("div",{className:"v2-dividend-field",children:[e.jsx(l,{children:"Ausschüttungsziel"}),e.jsx(Oe,{value:h.payoutTargetMode,options:Zt,onChange:t=>P("payoutTargetMode",String(t)==="amount"?"amount":"ratio")}),h.payoutTargetMode==="ratio"?e.jsx(A,{mode:"percent",min:0,max:100,value:h.payoutRatioPct,onChange:t=>P("payoutRatioPct",E(t))}):e.jsx(A,{mode:"decimal",min:0,value:h.desiredDividendEur,onChange:t=>P("desiredDividendEur",M(t))}),e.jsxs("div",{className:"v2-dividend-feasibility",children:[e.jsxs(R,{color:Ve?"green":"red",children:["Machbarkeit: ",Ve?"Ja (Plan)":"Nein (Plan)"]}),e.jsxs(R,{color:Ge>=0?"blue":"red",children:["Rest im Unternehmen: ",S(Ge)]})]}),e.jsxs(l,{type:"secondary",children:["Gewünschte Dividende: ",S(pe)]})]})]})]})})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"v2-dividend-calibration-head",children:[e.jsxs("div",{children:[e.jsx(se,{level:5,children:"Kalibrierung (Vorjahre)"}),e.jsx(l,{type:"secondary",children:"Jahr | Umsatz (Abschluss) | Jahresüberschuss (Abschluss)"})]}),e.jsx(fe,{onClick:()=>{Y(t=>[...t,{id:ze("cal"),year:m-1,revenueEur:null,netIncomeEur:null}])},children:"Vorjahr hinzufügen"})]}),e.jsx("div",{className:"v2-stats-table-wrap",children:e.jsxs("table",{className:"v2-stats-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Jahr"}),e.jsx("th",{children:"Umsatz (Abschluss)"}),e.jsx("th",{children:"Jahresüberschuss (Abschluss)"}),e.jsx("th",{children:"JÜ-Quote"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:O.length?O.map(t=>{const j=Number(t.revenueEur)>0&&Number.isFinite(t.netIncomeEur)?Number(t.netIncomeEur)/Number(t.revenueEur)*100:null;return e.jsxs("tr",{children:[e.jsx("td",{style:{width:120},children:e.jsx(A,{mode:"int",min:2e3,max:2100,value:t.year,onChange:f=>{Y(p=>p.map(x=>x.id===t.id?{...x,year:Math.max(2e3,Math.round(Number(f||t.year)))}:x))}})}),e.jsx("td",{style:{width:220},children:e.jsx(A,{mode:"decimal",min:0,value:t.revenueEur??void 0,onChange:f=>{Y(p=>p.map(x=>x.id===t.id?{...x,revenueEur:T(f)}:x))}})}),e.jsx("td",{style:{width:220},children:e.jsx(A,{mode:"decimal",value:t.netIncomeEur??void 0,onChange:f=>{Y(p=>p.map(x=>x.id===t.id?{...x,netIncomeEur:T(f)}:x))}})}),e.jsx("td",{style:{width:140},children:De(j,2)}),e.jsx("td",{style:{width:110},children:e.jsx(fe,{danger:!0,onClick:()=>{Y(f=>f.filter(p=>p.id!==t.id))},children:"Entfernen"})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(l,{type:"secondary",children:"Kalibrierung fehlt. Die Planung funktioniert trotzdem."})})})})]})}),e.jsxs("div",{className:"v2-dividend-calibration-meta",children:[e.jsxs(R,{color:i.calibrationAvailable?"green":"gold",children:["Kalibrierung ",i.calibrationAvailable?"aktiv":"nicht aktiv"]}),e.jsxs(R,{children:["Faktor (realistisch): ",i.calibrationFactor.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(R,{children:["Historische JÜ-Quote: ",De(Number.isFinite(i.historicalMargin)?Number(i.historicalMargin)*100:null,2)]}),e.jsxs(R,{children:["Plan JÜ-Quote: ",De(Number.isFinite(i.planMargin)?Number(i.planMargin)*100:null,2)]})]})]}),e.jsx(Dt,{title:`Reifegrad-Ampel (${Be(i.readinessLevel)})`,open:vt,onCancel:()=>xe(!1),footer:null,children:e.jsx(te,{direction:"vertical",style:{width:"100%"},children:i.readinessIssues.length===0?e.jsx(G,{type:"success",showIcon:!0,message:"Keine offenen Punkte. Die Schätzung ist für die Planung belastbar."}):i.readinessIssues.map(t=>e.jsxs("div",{className:"v2-dividend-issue-row",children:[e.jsxs(te,{wrap:!0,children:[e.jsx(R,{color:t.severity==="critical"?"red":t.severity==="major"?"orange":"gold",children:t.severity==="critical"?"Kritisch":t.severity==="major"?"Relevant":"Hinweis"}),e.jsx(l,{children:t.message})]}),e.jsxs(fe,{size:"small",onClick:()=>{xe(!1),J(t.route)},children:["Zu ",t.routeLabel]})]},t.id))})})]})}export{Ms as default};
