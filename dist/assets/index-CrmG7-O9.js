import{t as O,k as e,K as G,L as t,M as z,S as r,R as L,U as l,T as W,N as q,V as E}from"./index-DTYN3TOH.js";import{n as P,C as V,a as M,b as B,p as Z,c as X}from"./cashInRules-oX83SMz9.js";import{D as Q}from"./DeNumberInput-BS07c6SS.js";import{u as J,C as x}from"./workspace-DfgJwqS9.js";import{s as Y}from"./index-dm_ZnGRI.js";import{C as w}from"./index-C8xQ4yrc.js";import{R as ee}from"./InfoCircleOutlined-Dak4Ov0S.js";import{S as D}from"./index-C5jO90yL.js";import"./index-DBQM2_X8.js";import"./DownOutlined-C6NvF-xp.js";import"./Dropdown-BicCSbDJ.js";import"./useBubbleLock-C5yNDbdi.js";const{Paragraph:se,Text:d,Title:g}=G;function ne(i){return String(i||"").trim().toLowerCase()==="basis"?"basis":"conservative"}function C(i){const f=Z(i);return Number.isFinite(f)?X(Number(f),B,M):null}function j(i){return i?"An":"Aus"}function je(){const{state:i,loading:f,saving:T,error:S,lastSavedAt:A,saveWith:N}=J(),[R,_]=Y.useMessage(),h=i.settings||{},y=i.forecast&&typeof i.forecast=="object"?i.forecast:{},p=(y.settings&&typeof y.settings=="object"?y.settings:{}).useForecast===!0,v=ne(h.cashInMode),m=h.cashInCalibrationEnabled!==!1,I=P(h.cashInCalibrationHorizonMonths,6),k=h.cashInRecommendationIgnoreQ4===!0,F=C(h.cashInRecommendationBaselineNormalPct)??V,$=C(h.cashInRecommendationBaselineQ4Pct),K=O.useMemo(()=>{const s=v==="basis"?"Basis":"Konservativ";return[`Forecast: ${j(p)}`,`Cash-In Modus: ${s}`,`Kalibrierung: ${j(m)}${m?` (${I} Monate)`:""}`,`Q4 ignorieren: ${j(k)}`].join(" · ")},[m,I,v,k,p]);async function c(s,n){try{await N(o=>{const b=E(o),a=b,u=a.settings&&typeof a.settings=="object"?a.settings:{};return a.settings={...u,...s},b},n)}catch(o){R.error(o instanceof Error?o.message:"Methodik konnte nicht gespeichert werden.")}}async function U(s,n){try{await N(o=>{const b=E(o),a=b;(!a.forecast||typeof a.forecast!="object")&&(a.forecast={});const u=a.forecast,H=u.settings&&typeof u.settings=="object"?u.settings:{};return u.settings={...H,...s},b},n)}catch(o){R.error(o instanceof Error?o.message:"Forecast-Methodik konnte nicht gespeichert werden.")}}return e.jsxs("div",{className:"v2-page",children:[_,e.jsxs(x,{className:"v2-intro-card",children:[e.jsx("div",{className:"v2-page-head",children:e.jsxs("div",{children:[e.jsx(g,{level:3,children:"Methodik & Regeln"}),e.jsx(se,{children:"Zentraler Ort für globale Rechenlogik. Änderungen wirken global auf Dashboard, Soll/Ist, USt und weitere Auswertungen."})]})}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs("div",{className:"v2-toolbar-row",children:[T?e.jsx(t,{color:"processing",children:"Speichern..."}):e.jsx(t,{color:"green",children:"Synchron"}),A?e.jsxs(t,{color:"green",children:["Gespeichert: ",new Date(A).toLocaleTimeString("de-DE")]}):null]})})]}),S?e.jsx(z,{type:"error",showIcon:!0,message:S}):null,f?e.jsx(z,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,e.jsx(x,{children:e.jsxs(r,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs(r,{wrap:!0,children:[e.jsx(g,{level:5,style:{margin:0},children:"Aktive Rechenbasis (global)"}),e.jsx(t,{color:"blue",children:"GLOBAL"})]}),e.jsx(d,{children:K}),e.jsxs(L,{gutter:[12,12],children:[e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(t,{color:p?"green":"default",children:["Forecast: ",j(p)]})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(t,{children:["Cash-In: ",v==="basis"?"Basis":"Konservativ"]})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(t,{children:["Kalibrierung: ",j(m),m?` (${I} M)`:""]})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(t,{children:["Q4 ignorieren: ",j(k)]})})]})]})}),e.jsxs(L,{gutter:[12,12],children:[e.jsx(l,{xs:24,xl:12,children:e.jsxs(x,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(g,{level:5,style:{margin:0},children:"A) Forecast-Nutzung"}),e.jsx(t,{color:"blue",children:"GLOBAL"})]}),e.jsx(w,{checked:p,onChange:s=>{U({useForecast:s.target.checked},`v2:methodik:forecast-use:${s.target.checked?"on":"off"}`)},children:"Absatzprognose im Cashflow nutzen"}),e.jsx("div",{children:e.jsx(d,{type:"secondary",children:"Wirkt global auf Dashboard, Soll/Ist, USt, …"})})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(x,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(g,{level:5,style:{margin:0},children:"B) Cash-In Modus"}),e.jsx(t,{color:"blue",children:"GLOBAL"}),e.jsx(W,{title:"Konservativ: Abzug 1pp je Zukunftsmonat (max 5pp). Die finale Quote bleibt im Band 40..60%.",children:e.jsx(t,{icon:e.jsx(ee,{}),children:"Hilfe"})})]}),e.jsxs(r,{align:"center",wrap:!0,children:[e.jsx(d,{children:"Cash-In Modus:"}),e.jsx(D,{value:v,options:[{value:"basis",label:"Basis"},{value:"conservative",label:"Konservativ"}],onChange:s=>{const n=String(s||"").trim().toLowerCase()==="basis"?"basis":"conservative";c({cashInMode:n},`v2:methodik:cashin-mode:${n}`)},style:{width:220}})]})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(x,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(g,{level:5,style:{margin:0},children:"C) Umsatz-Kalibrierung"}),e.jsx(t,{color:"blue",children:"GLOBAL"})]}),e.jsxs(r,{wrap:!0,children:[e.jsx(w,{checked:m,onChange:s=>{c({cashInCalibrationEnabled:s.target.checked},`v2:methodik:calibration-enabled:${s.target.checked?"on":"off"}`)},children:"Umsatz-Kalibrierung aktiv"}),e.jsxs(r,{align:"center",children:[e.jsx(d,{children:"Wirkt über:"}),e.jsx(D,{value:I,options:[{value:3,label:"3 Monate"},{value:6,label:"6 Monate"},{value:12,label:"12 Monate"}],onChange:s=>{const n=P(s,6);c({cashInCalibrationHorizonMonths:n},`v2:methodik:calibration-horizon:${n}`)},style:{width:160}})]})]}),e.jsx("div",{children:e.jsx(d,{type:"secondary",children:"Kalibriert nur Umsatz (Cash-In), keine Units/Absatz."})})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(x,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(g,{level:5,style:{margin:0},children:"D) Empfehlung-Regeln (Erweitert)"}),e.jsx(t,{color:"blue",children:"GLOBAL"})]}),e.jsxs(r,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsx(w,{checked:k,onChange:s=>{c({cashInRecommendationIgnoreQ4:s.target.checked},`v2:methodik:recommendation-ignore-q4:${s.target.checked?"on":"off"}`)},children:"Q4 bei Empfehlung ignorieren"}),e.jsxs(r,{wrap:!0,children:[e.jsxs(r,{align:"center",children:[e.jsx(d,{children:"Baseline Normal %"}),e.jsx(Q,{value:F,mode:"percent",min:B,max:M,step:.1,style:{width:128},onChange:s=>{const n=C(s);Number.isFinite(n)&&c({cashInRecommendationBaselineNormalPct:n},"v2:methodik:recommendation-baseline-normal")}})]}),e.jsxs(r,{align:"center",children:[e.jsx(d,{children:"Baseline Q4 %"}),e.jsx(Q,{value:$??void 0,mode:"percent",min:B,max:M,step:.1,style:{width:128},onChange:s=>{if(s==null||String(s).trim()===""){c({cashInRecommendationBaselineQ4Pct:null},"v2:methodik:recommendation-baseline-q4:auto");return}const n=C(s);Number.isFinite(n)&&c({cashInRecommendationBaselineQ4Pct:n},"v2:methodik:recommendation-baseline-q4")}}),e.jsx(q,{size:"small",onClick:()=>{c({cashInRecommendationBaselineQ4Pct:null},"v2:methodik:recommendation-baseline-q4:auto")},children:"Auto"})]})]})]})]})})]})]})}export{je as default};
