import{I as an,t as l,P as ie,J as Qe,k as t,S as M,K as rn,L as z,M as me,N as G,O as ln,T as ae,Q as cn}from"./index-D7jH1FVY.js";import{E as un}from"./index-BUQvO9GH.js";import{c as dn}from"./cashflow-CGZq5oFU.js";import{r as mn,b as hn,a as fn,c as pn}from"./phantomFo-z2BnWxOq.js";import{e as gn}from"./forecastVersioning-C8CmpCaX.js";import{f as W,m as Dt,c as bn}from"./months-BTPgK-LH.js";import{u as yn,C as H}from"./workspace-BOh-scKZ.js";import{S as Ft}from"./index-DHM-xNG6.js";import{R as re}from"./InfoCircleOutlined-W98zD6L1.js";import{S as Ue}from"./index-CeSbA6eM.js";import{C as xn}from"./index-ygadgiJ9.js";import{F as vn}from"./Table-DDyQ8Gn8.js";import"./planProducts-B3Cdri-V.js";import"./cashInRules-oX83SMz9.js";import"./productCompletenessV2-CiPHRUgy.js";import"./orderUtils-BIuENAT3.js";import"./foSuggestion-Ck1952gl.js";import"./abcClassification-BPpZkpC9.js";import"./inventoryProjection-nTVtgHjF.js";import"./Dropdown-YtRXoqxq.js";import"./DownOutlined-DUcFHC8J.js";import"./useBubbleLock-DNuYBdSj.js";import"./index-BdbRizcT.js";import"./Pagination-Dxw0Fog1.js";const{Paragraph:Tt,Text:b,Title:Ve}=rn,We=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],kn=[{value:ie.CORE,label:"Kernportfolio"},{value:ie.PLAN,label:"Planprodukte"},{value:ie.IDEAS,label:"Ideenprodukte"}],Kt=[ie.CORE,ie.PLAN],Ot={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function T(n){const r=Number(n);return Number.isFinite(r)?r.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function Pt(n){return Number.isFinite(n)?n<0?`−${T(Math.abs(n))}`:T(n):"-"}function Sn(n,r=0){const i=Number(n);return Number.isFinite(i)?i.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r}):"-"}function Bt(n){const r=Number(n);return Number.isFinite(r)?`${r.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function Mn(n){if(!n)return"-";const r=new Date(n);return Number.isNaN(r.getTime())?n:r.toLocaleDateString("de-DE")}function jn(n){return Ot[n]||Ot.insufficient}function wn(n){return n==="ok"?"✅":n==="warn"?"⚠️":"❌"}function Nn(n,r){const i=structuredClone(n||{});(!i.settings||typeof i.settings!="object")&&(i.settings={}),(!i.forecast||typeof i.forecast!="object")&&(i.forecast={});const u=i.settings,f=i.forecast;(!f.settings||typeof f.settings!="object")&&(f.settings={});const d=f.settings;return d.useForecast=!0,u.cashInMode=r.safetyMode==="basis"?"basis":"conservative",u.cashInCalibrationEnabled=r.revenueBasisMode==="calibrated",u.cashInRecommendationIgnoreQ4=!r.q4SeasonalityEnabled,r.quoteMode==="recommendation"&&Array.isArray(i.incomings)&&(i.incomings=i.incomings.map(m=>!m||typeof m!="object"?m:{...m,payoutPct:null})),i}function J(n,r){const[i,u=""]=String(n||"").split("?"),f=new URLSearchParams(u);Object.entries(r).forEach(([m,v])=>{if(v==null||v===""){f.delete(m);return}f.set(m,v)});const d=f.toString();return d?`${i}?${d}`:i}function Ze(n){return J("/v2/inventory/projektion",{source:"dashboard",risk:n.risk||"under_safety",abc:n.abc||"ab",month:n.month||null,sku:n.sku||null,mode:n.mode||null,expand:"all"})}function Cn(n){return J("/v2/products",{source:"dashboard",issues:n.issues,sku:n.sku||null,expand:"all"})}function Lt(n){return J("/v2/forecast",{source:"dashboard",sku:n.sku||null,month:n.month||null})}function zn(n){return J("/v2/orders/fo",{source:n.source,sku:n.sku||null,month:n.month||null,suggestedUnits:Number.isFinite(Number(n.suggestedUnits))?String(Math.max(0,Math.round(Number(n.suggestedUnits)))):"0",requiredArrivalDate:n.requiredArrivalDate||null,recommendedOrderDate:n.recommendedOrderDate||null,phantomId:null,firstRiskMonth:n.firstRiskMonth||null,orderMonth:n.orderMonth||null,leadTimeDays:Number.isFinite(Number(n.leadTimeDays))?String(Math.max(0,Math.round(Number(n.leadTimeDays)))):null,returnTo:n.returnTo})}function $t(n){const r=String(n.route||"");if(r.startsWith("/v2/forecast"))return Lt({sku:n.sku||null,month:n.month||null});if(r.startsWith("/v2/inventory/projektion")){const i=n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"under_safety":"all",u=n.sku?"all":n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"ab":"all";return Ze({risk:i,abc:u,month:n.month||null,sku:n.sku||null,mode:n.mode||null})}if(r.startsWith("/v2/products")){const i=n.actionId==="revenue_inputs"||n.checkKey==="revenue_inputs"?"revenue":"needs_fix";return Cn({issues:i,sku:n.sku||null})}return r}function An(n){const r=typeof n.portfolioBucket=="string"?n.portfolioBucket:null;if(r)return r;const i=n.meta&&typeof n.meta=="object"?n.meta:{};return typeof i.portfolioBucket=="string"?String(i.portfolioBucket):null}function Ne(n,r){const i=An(n);return!i||!Qe.includes(i)?!0:r.has(i)}function En(n,r){var f;if(!n.length)return[];const i=Number(((f=n[0])==null?void 0:f.opening)||0);let u=i;return n.map((d,m)=>{const v=m===0?i:u,A=(Array.isArray(d.entries)?d.entries:[]).filter(j=>Ne(j,r)),w=A.filter(j=>String(j.direction||"").toLowerCase()==="in").reduce((j,P)=>j+Math.abs(Number(P.amount||0)),0),E=A.filter(j=>String(j.direction||"").toLowerCase()==="out").reduce((j,P)=>j+Math.abs(Number(P.amount||0)),0),O=w-E,N=v+O;return u=N,{...d,opening:v,inflow:w,outflow:E,net:O,closing:N,entries:A}})}function In(n,r,i){const u={fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0};return n.forEach(f=>{if(!f||typeof f!="object")return;const d=f;if(i&&!Ne(d,i)||String(d.direction||"").toLowerCase()!=="out")return;const m=Math.abs(Number(d.amount||0));if(!Number.isFinite(m)||m<=0)return;u.total+=m;const v=String(d.source||"").toLowerCase();if(v==="po"){u.po+=m;return}if(v==="fo"){const w=String(d.sourceId||"").trim(),E=d.meta&&typeof d.meta=="object"?d.meta:{};d.provisional===!0||E.phantom===!0||(w?(r==null?void 0:r.has(w))===!0:!1)?u.phantomFo+=m:u.fo+=m;return}const A=String(d.group||"").toLowerCase();if(v==="fixcosts"||A==="fixkosten"){u.fixcost+=m;return}u.other+=m}),u}function Dn(n,r){const i={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};return n.forEach(u=>{if(!u||typeof u!="object")return;const f=u;if(r&&!Ne(f,r)||String(f.direction||"").toLowerCase()!=="in")return;const d=Math.abs(Number(f.amount||0));if(!Number.isFinite(d)||d<=0)return;const m=String(f.source||"").toLowerCase(),v=String(f.kind||"").toLowerCase();if(m==="sales"||m==="sales-plan"||v==="sales-payout"){i.amazon+=d;const w=f.meta&&typeof f.meta=="object"?f.meta:{},E=w.cashIn&&typeof w.cashIn=="object"?w.cashIn:{},O=String(E.component||"").trim().toLowerCase(),N=String(f.portfolioBucket||w.portfolioBucket||"").trim(),j=cn(N,ie.CORE);m==="sales-plan"||O==="plan"?i.amazonNew+=d:j===ie.CORE?i.amazonCore+=d:i.amazonPlanned+=d}else i.other+=d;i.total+=d}),i}function qe(n){const r={};return n.forEach(i=>{r[i]=0}),r}function we(n){return Object.values(n).reduce((r,i)=>r+Math.abs(Number(i||0)),0)}function Fn(n){const r=Number(n.paid||0),i=Number(n.open||0),u=Number(n.unknown||0);return r>0&&i<=0&&u<=0?"paid":i>0&&r<=0&&u<=0?"open":u>0&&r<=0&&i<=0?"unknown":"mixed"}function Tn(n){const r=[],i=u=>{u.forEach(f=>{!Array.isArray(f.children)||f.children.length===0||(r.push(f.key),i(f.children))})};return i(n),r}function Kn(n){const r=new Map;(Array.isArray(n.products)?n.products:[]).forEach(d=>{const m=String(d.sku||"").trim();if(!m)return;const v=String(d.alias||"").trim()||m;r.set(m,v)});const u=new Map,f=(d,m)=>{const v=(d==="po"?[m.poNo,m.id]:[m.foNo,m.foNumber,m.id]).map(N=>String(N||"").trim()).filter(Boolean);if(!v.length)return;const A=Array.isArray(m.items)&&m.items.length?m.items:[{sku:m.sku,units:m.units}],w=new Set;let E=0;A.forEach(N=>{const j=String(N.sku||"").trim();if(!j)return;w.add(r.get(j)||j);const P=Number(N.units??N.qty??N.quantity??0);Number.isFinite(P)&&(E+=P)});const O={aliases:Array.from(w),units:Number.isFinite(E)?E:null};Array.from(new Set(v)).forEach(N=>{u.set(`${d}:${N}`,O)})};return(Array.isArray(n.pos)?n.pos:[]).forEach(d=>f("po",d)),(Array.isArray(n.fos)?n.fos:[]).forEach(d=>f("fo",d)),u}function On(n){if(!n||typeof n!="object")return{toVersionId:null,foConflictsOpen:0};const r=n;return{toVersionId:r.toVersionId==null?null:String(r.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(r.foConflictsOpen||0)))}}function cs(){var yt,xt,vt,kt,St,Mt,jt,wt,Nt,Ct,zt,At,Et,It;const{state:n,loading:r,error:i}=yn(),u=an(),[f,d]=l.useState("next6"),[m,v]=l.useState(()=>Kt.slice()),[A,w]=l.useState("forecast"),[E,O]=l.useState("manual"),[N,j]=l.useState("basis"),[P,Ce]=l.useState(!0),[Ge,_t]=l.useState(!1),[xe,ze]=l.useState(""),[he,Ae]=l.useState(""),[Rt,He]=l.useState(!1),[Ee,Ie]=l.useState(["inflows","outflows"]),L=n,De=n.settings&&typeof n.settings=="object"?n.settings:{},Je=n.forecast&&typeof n.forecast=="object"?n.forecast:{},Fe=De.cashInCalibrationEnabled!==!1,Ut=Math.max(1,Math.round(Number(De.cashInCalibrationHorizonMonths||6))),Xe=De.cashInRecommendationIgnoreQ4===!0;l.useEffect(()=>{Ge||(w(Fe?"calibrated":"forecast"),Ce(!Xe),_t(!0))},[Ge,Fe,Xe]);const K=l.useMemo(()=>mn(L,18),[n.settings]),X=l.useMemo(()=>xe&&K.includes(xe)?xe:K[K.length-1]||"",[xe,K]),le=l.useMemo(()=>hn({state:L,months:K,targetMonth:X||null}),[K,X,L]),ve=l.useMemo(()=>new Set(le.map(e=>e.id)),[le]),Ye=l.useMemo(()=>fn({state:L,suggestions:le}),[le,L]),fe=l.useMemo(()=>Nn(Ye,{quoteMode:E,safetyMode:N,revenueBasisMode:A,q4SeasonalityEnabled:P}),[Ye,P,E,A,N]),B=l.useMemo(()=>dn(fe),[fe]),Te=B.months||[],et=B.breakdown||[],k=l.useMemo(()=>{const e=We.find(s=>s.value===f);return!e||e.count==null?Te:Te.slice(0,e.count)},[Te,f]),Vt=l.useMemo(()=>{const e=We.find(s=>s.value===f);return(e==null?void 0:e.label)||"Alle Monate"},[f]),tt=l.useMemo(()=>new Set(k),[k]),q=l.useMemo(()=>new Set(m),[m]),pe=l.useMemo(()=>{const e=et.filter(s=>tt.has(s.month));return En(e,q)},[et,q,tt]),Q=l.useMemo(()=>pn({state:L,months:k}),[L,k]);l.useEffect(()=>{if(!K.length){ze("");return}ze(e=>e&&K.includes(e)?e:K[K.length-1])},[K]),l.useEffect(()=>{var e;if(!Q.months.length){Ae("");return}if(!he||!Q.monthMap.has(he)){const s=((e=Q.months.find(a=>!a.robust))==null?void 0:e.month)||Q.months[0].month;Ae(s)}},[Q,he]);const Wt=l.useCallback(e=>{Qe.includes(e)&&v(s=>{const a=Array.from(new Set((s||[]).filter(c=>Qe.includes(c))));if(!a.includes(e))return[...a,e];const y=a.filter(c=>c!==e);return y.length?y:a})},[]),nt=l.useCallback(e=>{e&&(Ae(e),He(!0))},[]),S=l.useMemo(()=>pe.map(e=>({...e})),[pe]),Z=l.useMemo(()=>{const e=new Map;return S.forEach(s=>{e.set(s.month,Dn(Array.isArray(s.entries)?s.entries:[],q))}),e},[q,S]),$=l.useMemo(()=>S.map(e=>Z.get(e.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[Z,S]),_=l.useMemo(()=>{const e=new Map;return S.forEach(s=>{e.set(s.month,In(Array.isArray(s.entries)?s.entries:[],ve,q))}),e},[q,ve,S]),ge=l.useMemo(()=>S.map(e=>_.get(e.month)||{fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0}),[_,S]),st=l.useMemo(()=>$.map(e=>e.amazonCore),[$]),ot=l.useMemo(()=>$.map(e=>e.amazonPlanned),[$]),at=l.useMemo(()=>$.map(e=>e.amazonNew),[$]),qt=l.useMemo(()=>$.map(e=>e.amazon),[$]),Ke=l.useMemo(()=>$.map(e=>e.other),[$]),Qt=qt.reduce((e,s)=>e+Number(s||0),0)+Ke.reduce((e,s)=>e+Number(s||0),0),Zt=S.reduce((e,s)=>e+Number(s.outflow||0),0),Oe=S.reduce((e,s)=>e+Number(s.net||0),0),Gt=l.useMemo(()=>S.length?Math.min(...S.map(e=>Number(e.closing||0))):null,[S]),Ht=E==="recommendation",rt=((xt=(yt=B.kpis)==null?void 0:yt.cashIn)==null?void 0:xt.calibrationApplied)===!0,it=Math.max(0,Math.round(Number(((kt=(vt=B.kpis)==null?void 0:vt.cashIn)==null?void 0:kt.calibrationCandidateCount)||0))),lt=Math.max(0,Math.round(Number(((Mt=(St=B.kpis)==null?void 0:St.cashIn)==null?void 0:Mt.calibrationNonDefaultFactorMonthCount)||0))),be=String(((wt=(jt=B.kpis)==null?void 0:jt.cashIn)==null?void 0:wt.calibrationLatestCandidateMonth)||"").trim()||null,ke=Number((Ct=(Nt=B.kpis)==null?void 0:Nt.cashIn)==null?void 0:Ct.calibrationLatestRawFactor),ce=(At=(zt=B.kpis)==null?void 0:zt.cashIn)!=null&&At.calibrationReasonCounts&&typeof B.kpis.cashIn.calibrationReasonCounts=="object"?B.kpis.cashIn.calibrationReasonCounts:{},ct=l.useMemo(()=>(Array.isArray(fe.incomings)?fe.incomings:[]).reduce((s,a)=>{const o=a&&typeof a=="object"?a:{},y=Number(o.calibrationSellerboardMonthEndEur)>0,c=Number(o.calibrationRevenueToDateEur)>0&&String(o.calibrationCutoffDate||"").trim().length>0;return y||c?s+1:s},0),[fe]),ut=l.useMemo(()=>{if(A!=="calibrated"||rt)return null;if(ct<=0)return"Keine verwertbaren Kalibrierdaten gefunden. Das Diagramm entspricht aktuell dem Forecast-Umsatz.";if(it<=0){const e=Math.max(0,Math.round(Number(ce.missing_forecast_revenue||0))),s=Math.max(0,Math.round(Number(ce.missing_inputs||0))),a=Math.max(0,Math.round(Number(ce.invalid_cutoff_date||0))),o=Math.max(0,Math.round(Number(ce.invalid_factor||0))),y=Math.max(0,Math.round(Number(ce.invalid_expected_revenue||0))),c=[];return e>0&&c.push(`Forecast-Umsatz fehlt/ist 0 in ${e} Kalibrier-Monat(en)`),s>0&&c.push(`Kalibrierdaten unvollständig in ${s} Monat(en)`),a>0&&c.push(`Cutoff-Datum ungültig in ${a} Monat(en)`),(o>0||y>0)&&c.push(`Faktor rechnerisch ungültig in ${o+y} Monat(en)`),c.length?`Kalibrierdaten sind vorhanden, aber aktuell nicht wirksam: ${c.join(" · ")}.`:"Kalibrierdaten sind vorhanden, aber aktuell im Planungsfenster nicht verwertbar. Das Diagramm bleibt beim Forecast-Umsatz."}if(lt<=0){if(Number.isFinite(ke)){const e=Number(ke).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2});if(Math.abs(ke-1)<=1e-6){const a=be?` (Quelle ${W(be)})`:"";return`Kalibrierung aktiv, aber ohne Effekt: Startfaktor ${e}${a}. Das entspricht faktisch 1,00.`}const s=be?` (${W(be)})`:"";return`Kalibrierdaten gefunden (Startfaktor ${e}${s}), aber im aktuellen Planungsfenster wirkt der Fade-Out bereits auf ~1,00.`}return"Kalibrierdaten sind vorhanden, aktuell aber ohne Effekt (Faktor ~1,00 im Planungsfenster)."}return"Kalibrierung aktiv, aber der Effekt ist im aktuellen Ausschnitt minimal."},[rt,it,ct,be,ke,lt,ce,A]),dt=l.useMemo(()=>{const e=structuredClone(Je||{});return gn(e),e},[Je]),Pe=On(dt.lastImpactSummary),mt=String(dt.activeVersionId||"").trim()||null,ht=Pe.toVersionId&&mt&&Pe.toVersionId===mt?Pe.foConflictsOpen:0,h=he&&Q.monthMap.get(he)||null,Be=h?jn(h.coverage.statusKey):null,Se=l.useMemo(()=>{if(!h)return!1;const e=Dt(bn()),s=Dt(h.month);return s==null||e==null?!1:s<e},[h]),ft=h?h.checks.filter(e=>e.key!=="sku_coverage"):[],pt=l.useMemo(()=>{if(!h||h.coverage.statusKey==="full")return[];const e=h.month;return[{id:`coverage-warning:${e}`,message:`Coverage ist ${h.coverage.statusLabel}: ${Bt(h.coverage.ratio*100)} (${h.coverage.coveredSkus}/${h.coverage.activeSkus}).`,route:Ze({risk:"under_safety",abc:"ab",month:e,mode:h.coverage.projectionMode})}]},[h]),Jt=l.useMemo(()=>{if(!h)return[];const e=[],s=h.coverage.stockIssueCount,a=h.coverage.orderDutyIssueCount;return e.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:s===0?"ok":"fail",description:s===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${s} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),e.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:a===0?"ok":h.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:a===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${a} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),ft.forEach(o=>{e.push({key:o.key,label:o.label,state:o.passed?"ok":"fail",description:o.detail,route:o.route||null})}),Se&&e.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),e},[h,Se,ft]),gt=l.useMemo(()=>{const e=new Map;return k.forEach(s=>{e.set(W(s),s)}),e},[k]),bt=l.useCallback(e=>{if(!e||typeof e!="object")return;const s=e;let a=null;const o=Number(s.dataIndex);if(Number.isInteger(o)&&o>=0&&o<k.length&&(a=k[o]),!a){const y=[s.name,s.axisValue,s.value].map(c=>typeof c=="string"?c.trim():"").filter(Boolean);for(let c=0;c<y.length;c+=1){const g=gt.get(y[c]);if(g){a=g;break}}}a&&nt(a)},[gt,nt,k]),Xt=l.useMemo(()=>({click:bt}),[bt]),Yt=l.useMemo(()=>{const e="Amazon Kern",s="Amazon Plan",a="Amazon Neu",o=new Set([e,s,a]),y=k.map(p=>W(p)),c=pe.map(p=>Number(p.closing||0)),g=pe.map(p=>{var D;return!!((D=Q.monthMap.get(p.month))!=null&&D.robust)}),x=c.map((p,D)=>g[D]&&p>=0?p:null),I=c.map((p,D)=>g[D]&&p<0?p:null),ee=c.map((p,D)=>!g[D]&&p>=0?p:null),U=c.map((p,D)=>!g[D]&&p<0?p:null),Le=ge.map(p=>-p.fixcost),ue=ge.map(p=>-p.po),te=ge.map(p=>-p.fo),_e=ge.map(p=>-p.phantomFo);return{tooltip:{trigger:"axis",formatter:p=>{const D=Array.isArray(p)?p:[p],C=D[0],de=[`<div><strong>${(C==null?void 0:C.axisValueLabel)||""}</strong></div>`];let ne=0,ye=!1;return D.forEach(je=>{const F=je,se=Number(F==null?void 0:F.value);Number.isFinite(se)&&(o.has(String((F==null?void 0:F.seriesName)||""))&&(ne+=se,ye=!0),de.push(`<div>${(F==null?void 0:F.marker)||""}${(F==null?void 0:F.seriesName)||""}: ${T(se)}</div>`))}),ye&&de.push(`<div><strong>Amazon gesamt: ${T(ne)}</strong></div>`),de.join("")}},legend:{type:"scroll",top:0,left:0,right:0,itemGap:10,itemWidth:14,itemHeight:8,textStyle:{fontSize:12,color:"#334155"},pageTextStyle:{fontSize:11,color:"#64748b"},data:[e,s,a,"Sonstige In","Fixkosten","PO","FO","Phantom FO","Netto","Kontostand belastbar","Kontostand belastbar (<0)","Kontostand orientierend","Kontostand orientierend (<0)"]},grid:{left:54,right:68,top:54,bottom:42},xAxis:{type:"category",data:y,triggerEvent:!0,axisLabel:{hideOverlap:!0,fontSize:12,color:"#475569",margin:12},axisLine:{lineStyle:{color:"rgba(15,27,45,0.24)"}}},yAxis:[{type:"value",name:"Cashflow",nameTextStyle:{fontSize:12,color:"#475569"},axisLabel:{formatter:p=>Pt(p),fontSize:12,color:"#475569"},splitLine:{lineStyle:{color:"rgba(15,27,45,0.10)"}}},{type:"value",name:"Kontostand",position:"right",nameTextStyle:{fontSize:12,color:"#475569"},axisLabel:{formatter:p=>T(p),fontSize:12,color:"#475569"},splitLine:{show:!1}}],series:[{name:e,type:"bar",stack:"cash",data:st,itemStyle:{color:"#166534"}},{name:s,type:"bar",stack:"cash",data:ot,itemStyle:{color:"#22c55e"}},{name:a,type:"bar",stack:"cash",data:at,itemStyle:{color:"#86efac"}},{name:"Sonstige In",type:"bar",stack:"cash",data:Ke,itemStyle:{color:"#6ee7b7"}},{name:"Fixkosten",type:"bar",stack:"cash",data:Le,itemStyle:{color:"#7f1d1d"}},{name:"PO",type:"bar",stack:"cash",data:ue,itemStyle:{color:"#e74c3c"}},{name:"FO",type:"bar",stack:"cash",data:te,itemStyle:{color:"#f97316"}},{name:"Phantom FO",type:"bar",stack:"cash",data:_e,itemStyle:{color:"#fbbf24"}},{name:"Netto",type:"line",smooth:!0,showSymbol:!1,data:S.map(p=>Number(p.net||0)),itemStyle:{color:"#0f1b2d"},lineStyle:{width:2}},{name:"Kontostand belastbar",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:x,lineStyle:{width:2,color:"#3bc2a7"},itemStyle:{color:"#3bc2a7"}},{name:"Kontostand belastbar (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:I,lineStyle:{width:2,color:"#b42318"},itemStyle:{color:"#b42318"}},{name:"Kontostand orientierend",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:ee,lineStyle:{width:2,type:"dashed",color:"#94a3b8"},itemStyle:{color:"#94a3b8"}},{name:"Kontostand orientierend (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,showSymbol:!1,data:U,lineStyle:{width:2,type:"dashed",color:"#c2410c"},itemStyle:{color:"#c2410c"}}]}},[st,at,ot,Ke,ge,Q.monthMap,S,pe,k]),Me=l.useMemo(()=>Kn(L),[n.fos,n.pos,n.products,L]),Y=l.useMemo(()=>{const e={"outflows-po":new Map,"outflows-fo":new Map,"outflows-phantom-fo":new Map};S.forEach(a=>{const o=a.month;(Array.isArray(a.entries)?a.entries:[]).forEach(c=>{if(!c||typeof c!="object")return;const g=c;if(!Ne(g,q)||String(g.direction||"").toLowerCase()!=="out")return;const x=Math.abs(Number(g.amount||0));if(!Number.isFinite(x)||x<=0)return;const I=String(g.source||"").toLowerCase();if(I!=="po"&&I!=="fo")return;const ee=String(g.sourceNumber||"").trim(),U=String(g.sourceId||"").trim(),Le=String(g.id||g.label||"").trim(),ue=ee||U||Le||"ohne-nummer",te=g.meta&&typeof g.meta=="object"?g.meta:{},_e=I==="fo"&&(g.provisional===!0||te.phantom===!0||(U?ve.has(U):!1)),Re=I==="po"?"outflows-po":_e?"outflows-phantom-fo":"outflows-fo",p=e[Re],D=`${I}:${ue}`;let C=p.get(D);if(!C){const V=Me.get(`${I}:${ue}`)||(ee?Me.get(`${I}:${ee}`):void 0)||(U?Me.get(`${I}:${U}`):void 0);C={key:`order:${Re}:${I}:${ue}`,label:`${String(I).toUpperCase()} ${ue}`,values:qe(k),aliases:new Set((V==null?void 0:V.aliases)||[]),units:(V==null?void 0:V.units)??null,paymentMix:{paid:0,open:0,unknown:0},payments:new Map},p.set(D,C)}C.values[o]+=-x,g.paid===!0?C.paymentMix.paid+=x:g.paid===!1?C.paymentMix.open+=x:C.paymentMix.unknown+=x;const de=String(te.alias||"").trim();de&&C.aliases.add(de);const ne=Number(te.units??te.qty??te.quantity);if(Number.isFinite(ne)&&ne>0){const V=Number(C.units||0);C.units=Number.isFinite(V)?V+ne:ne}const ye=String(g.label||"").trim()||"Zahlung",je=String(g.date||"").trim()||null,F=g.paid===!0?"paid":g.paid===!1?"open":"unknown",se=`${ye}|${je||""}|${F}`;let oe=C.payments.get(se);oe||(oe={key:`payment:${C.key}:${se}`,label:ye,values:qe(k),paymentDueDate:je,paymentMix:{paid:0,open:0,unknown:0}},C.payments.set(se,oe)),oe.values[o]+=-x,g.paid===!0?oe.paymentMix.paid+=x:g.paid===!1?oe.paymentMix.open+=x:oe.paymentMix.unknown+=x})});const s=(a,o)=>Array.from(a.values()).sort((y,c)=>we(c.values)-we(y.values)).map(y=>{const c=Array.from(y.payments.values()).sort((x,I)=>we(I.values)-we(x.values)).map(x=>({key:x.key,label:x.label,values:x.values,rowType:"payment",paymentStatus:Fn(x.paymentMix),paymentDueDate:x.paymentDueDate})),g=Number(y.units);return{key:y.key,label:y.label,values:y.values,rowType:"order",orderType:o,aliases:Array.from(y.aliases),units:Number.isFinite(g)&&g>0?g:null,paymentMix:y.paymentMix,children:c.length?c:void 0}});return{po:s(e["outflows-po"],"po"),fo:s(e["outflows-fo"],"fo"),phantom:s(e["outflows-phantom-fo"],"phantom")}},[q,Me,ve,S,k]),$e=l.useMemo(()=>{const e=new Map(S.map(a=>[a.month,a])),s=a=>{const o=qe(k);return k.forEach(y=>{o[y]=Number(a(y)||0)}),o};return[{key:"inflows",label:"Einnahmen",rowType:"group",values:s(a=>{var o;return((o=Z.get(a))==null?void 0:o.total)||0}),children:[{key:"inflows-amazon-core",label:"Amazon Kernprodukte",rowType:"category",values:s(a=>{var o;return((o=Z.get(a))==null?void 0:o.amazonCore)||0})},{key:"inflows-amazon-plan",label:"Amazon geplante Produkte",rowType:"category",values:s(a=>{var o;return((o=Z.get(a))==null?void 0:o.amazonPlanned)||0})},{key:"inflows-amazon-new",label:"Amazon neue Produkte",rowType:"category",values:s(a=>{var o;return((o=Z.get(a))==null?void 0:o.amazonNew)||0})},{key:"inflows-other",label:"Sonstige Einzahlungen",rowType:"category",values:s(a=>{var o;return((o=Z.get(a))==null?void 0:o.other)||0})}]},{key:"outflows",label:"Ausgaben",rowType:"group",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.total)||0)}),children:[{key:"outflows-po",label:"PO",rowType:"category",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.po)||0)}),children:Y.po.length?Y.po:void 0},{key:"outflows-fo",label:"FO",rowType:"category",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.fo)||0)}),children:Y.fo.length?Y.fo:void 0},{key:"outflows-phantom-fo",label:"Phantom FO",rowType:"category",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.phantomFo)||0)}),children:Y.phantom.length?Y.phantom:void 0},{key:"outflows-fixcost",label:"Fixkosten",rowType:"category",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.fixcost)||0)})},{key:"outflows-other",label:"Sonstige Auszahlungen",rowType:"category",values:s(a=>{var o;return-(((o=_.get(a))==null?void 0:o.other)||0)})}]},{key:"net",label:"Netto Cashflow",rowType:"total",values:s(a=>{var o;return Number(((o=e.get(a))==null?void 0:o.net)||0)})},{key:"closing",label:"Kontostand",rowType:"total",values:s(a=>{var o;return Number(((o=e.get(a))==null?void 0:o.closing)||0)})}]},[Z,Y,_,S,k]),R=l.useMemo(()=>Tn($e),[$e]);l.useEffect(()=>{const e=new Set(R);Ie(s=>s.filter(a=>e.has(a)))},[R]);const en=l.useMemo(()=>{if(!R.length)return!1;const e=new Set(Ee);return R.every(s=>e.has(s))},[R,Ee]),tn=l.useCallback(()=>{Ie(e=>{const s=new Set(e);return R.length>0&&R.every(o=>s.has(o))?[]:R.slice()})},[R]),nn=l.useMemo(()=>[{title:"Position",key:"label",dataIndex:"label",fixed:"left",width:380,render:(e,s)=>{if(s.rowType==="order"){const o=Array.isArray(s.aliases)?s.aliases.filter(Boolean):[],y=o.length>2?`${o.slice(0,2).join(", ")} +${o.length-2}`:o.join(", "),c=s.paymentMix||{paid:0,open:0,unknown:0},g=c.paid+c.open+c.unknown,x=g>0?g:1,I=`${Math.max(0,Math.min(100,c.paid/x*100))}%`,ee=`${Math.max(0,Math.min(100,c.open/x*100))}%`,U=`${Math.max(0,Math.min(100,c.unknown/x*100))}%`;return t.jsxs("div",{className:"v2-dashboard-pnl-label-cell",children:[t.jsxs(M,{size:6,wrap:!0,children:[t.jsx(b,{strong:!0,children:s.label}),s.orderType==="phantom"?t.jsx(z,{color:"gold",children:"Phantom"}):null,y?t.jsxs(b,{type:"secondary",children:["Alias: ",y]}):null,Number.isFinite(Number(s.units))&&Number(s.units)>0?t.jsxs(z,{children:["Stk: ",Sn(s.units,0)]}):null]}),g>0?t.jsxs("div",{className:"v2-dashboard-pnl-paybar",title:`Bezahlt ${T(c.paid)} · Offen ${T(c.open)} · Unklar ${T(c.unknown)}`,children:[t.jsx("span",{className:"is-paid",style:{width:I}}),t.jsx("span",{className:"is-open",style:{width:ee}}),t.jsx("span",{className:"is-unknown",style:{width:U}})]}):null]})}if(s.rowType==="payment"){const o=s.paymentStatus==="paid"?t.jsx(z,{color:"green",children:"Bezahlt"}):s.paymentStatus==="open"?t.jsx(z,{color:"orange",children:"Offen"}):s.paymentStatus==="mixed"?t.jsx(z,{color:"blue",children:"Gemischt"}):t.jsx(z,{children:"Unklar"});return t.jsxs(M,{size:6,wrap:!0,children:[t.jsx(b,{children:s.label}),s.paymentDueDate?t.jsxs(b,{type:"secondary",children:["Fällig: ",Mn(s.paymentDueDate)]}):null,o]})}const a=s.key==="inflows"||s.key==="outflows"||s.key==="net"||s.key==="closing";return t.jsx(b,{strong:a,children:s.label})}},...k.map(e=>({title:W(e),key:e,width:132,align:"right",render:(s,a)=>{const o=Number(a.values[e]||0),y=a.key==="closing",c=!y&&o<0;return t.jsx(b,{strong:a.key==="net"||a.key==="closing",type:c?"danger":void 0,children:y?T(o):Pt(o)})}}))],[k]);function sn(){d("next6"),v(Kt.slice()),w(Fe?"calibrated":"forecast"),O("manual"),j("basis"),Ce(!0)}function on(e){if(!h)return;const s=e.month||h.month;if(e.checkKey==="cash_in"){u(J("/v2/abschluss/eingaben",{source:"dashboard",month:s}));return}if(e.checkKey==="fixcost"){u(J("/v2/abschluss/fixkosten",{source:"dashboard",month:s}));return}if(e.checkKey==="vat"){u(J("/v2/abschluss/ust",{source:"dashboard",month:s}));return}if(e.checkKey==="revenue_inputs"&&e.sku){u(J("/v2/products",{source:"dashboard",issues:"revenue",sku:e.sku}));return}if(e.issueType==="order_duty"&&e.sku){u(zn({sku:e.sku,month:s,suggestedUnits:e.suggestedUnits??null,requiredArrivalDate:e.requiredArrivalDate||null,recommendedOrderDate:e.recommendedOrderDate||null,source:"inventory_projection",firstRiskMonth:e.firstRiskMonth||null,orderMonth:e.orderMonth||null,leadTimeDays:e.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(e.issueType==="forecast_missing"&&e.sku){u(Lt({sku:e.sku,month:s}));return}if((e.issueType==="stock_oos"||e.issueType==="stock_under_safety")&&e.sku){u(Ze({risk:e.issueType==="stock_oos"?"oos":"under_safety",abc:e.abcClass&&(e.abcClass==="A"||e.abcClass==="B")?"ab":"all",month:e.firstRiskMonth||s,sku:e.sku,mode:h.coverage.projectionMode||null}));return}u($t({route:e.route,checkKey:e.checkKey,month:s,sku:e.sku||null,mode:h.coverage.projectionMode||null}))}return((It=(Et=n.settings)==null?void 0:Et.featureFlags)==null?void 0:It.executiveDashboardV2)!==!1?t.jsxs("div",{className:"v2-page",children:[t.jsxs(H,{className:"v2-intro-card",children:[t.jsxs("div",{className:"v2-page-head",children:[t.jsxs("div",{children:[t.jsx(Ve,{level:3,children:"Dashboard"}),t.jsx(Tt,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]}),t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(b,{children:"Zeitraum"}),t.jsx(Ft,{value:f,onChange:e=>d(e),options:We.map(e=>({value:e.value,label:e.label})),style:{width:220,maxWidth:"100%"}})]}),t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(b,{children:"PFO bis"}),t.jsx(Ft,{value:X||void 0,onChange:e=>ze(String(e||"")),options:K.map(e=>({value:e,label:W(e)})),style:{width:220,maxWidth:"100%"},disabled:!K.length})]})]}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs(b,{type:"secondary",children:["Zeitraum: ",Vt," (",k.length," Monate) · PFO bis: ",X?W(X):"—"]})})]}),i?t.jsx(me,{type:"error",showIcon:!0,message:i}):null,r?t.jsx(me,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,ht>0?t.jsx(me,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${ht} FOs prüfen`,description:t.jsx(G,{size:"small",onClick:()=>u("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,t.jsx(ln,{title:h?`Monats-Check: ${W(h.month)}`:"Monats-Check",placement:"right",width:520,open:Rt&&!!h,onClose:()=>He(!1),destroyOnClose:!1,children:h?t.jsxs(M,{direction:"vertical",size:12,style:{width:"100%"},children:[t.jsxs(M,{wrap:!0,children:[t.jsx(z,{color:(Be==null?void 0:Be.color)||"default",children:h.coverage.statusLabel}),t.jsxs(b,{children:["Coverage ",Bt(h.coverage.ratio*100)," (",h.coverage.coveredSkus,"/",h.coverage.activeSkus,"),"," ","Bestand ",h.coverage.stockIssueCount,","," ","Bestellpflicht ",h.coverage.orderDutyIssueCount,","," ","Blocker ",h.coverage.blockerCount]}),Se?t.jsx(z,{children:"Vergangen (Info)"}):null]}),t.jsx(H,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:t.jsxs(M,{direction:"vertical",size:8,style:{width:"100%"},children:[t.jsxs(M,{wrap:!0,children:[t.jsx(ae,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:t.jsx(z,{icon:t.jsx(re,{}),children:"Coverage"})}),t.jsx(ae,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:t.jsx(z,{icon:t.jsx(re,{}),children:"Blocker"})})]}),Jt.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(M,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs(b,{strong:!0,children:[wn(e.state)," ",e.label]}),e.route?t.jsx(G,{size:"small",onClick:()=>u($t({route:e.route,month:h.month,mode:h.coverage.projectionMode})),children:"Öffnen"}):null]}),t.jsx(b,{type:"secondary",children:e.description})]},e.key))]})}),t.jsx(H,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:h.coverage.statusKey==="full"?t.jsx(me,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):Se?t.jsx(me,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):t.jsxs(M,{direction:"vertical",size:10,style:{width:"100%"},children:[t.jsxs("div",{children:[t.jsx(b,{strong:!0,children:"1) Blocker"}),h.blockers.length?t.jsx(M,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:h.blockers.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(M,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(z,{color:"red",children:"Blocker"}),t.jsx(G,{size:"small",onClick:()=>on(e),children:"Öffnen"})]}),t.jsx(b,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(b,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),t.jsxs("div",{children:[t.jsx(b,{strong:!0,children:"2) Warnungen"}),pt.length?t.jsx(M,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:pt.map(e=>t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[t.jsxs(M,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(z,{color:"gold",children:"Warnung"}),t.jsx(G,{size:"small",onClick:()=>u(e.route),children:"Öffnen"})]}),t.jsx(b,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(b,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):t.jsx(b,{type:"secondary",children:"Kein Monat gewählt."})}),t.jsxs(H,{className:"v2-dashboard-chart-card",children:[t.jsx(Ve,{level:4,children:"Kontostand & Cashflow"}),t.jsxs("div",{className:"v2-calc-cockpit-shell",children:[t.jsxs("div",{className:"v2-calc-cockpit-status",children:[t.jsxs(M,{wrap:!0,children:[t.jsxs(b,{type:"secondary",children:["Min. Kontostand: ",t.jsx("strong",{children:T(Gt)})]}),t.jsxs(b,{type:"secondary",children:["Summe Netto: ",t.jsx("strong",{children:T(Oe)})]})]}),t.jsx(G,{size:"small",onClick:sn,children:"Zurücksetzen"})]}),t.jsxs("div",{className:"v2-calc-cockpit-modules",children:[t.jsxs(H,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(M,{size:6,children:[t.jsx(b,{strong:!0,children:"Portfolio-Scope"}),t.jsx(ae,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:t.jsx(re,{})})]}),t.jsx("div",{children:t.jsx(b,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx("div",{className:"v2-calc-cockpit-chip-row",children:kn.map(e=>{const s=m.includes(e.value);return t.jsx(G,{size:"small",type:s?"primary":"default",onClick:()=>Wt(e.value),children:e.label},e.value)})}),t.jsx(b,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard."})]}),t.jsxs(H,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(M,{size:6,children:[t.jsx(b,{strong:!0,children:"Umsatzbasis"}),t.jsx(ae,{title:"Forecast-Umsatz = Absatzprognose × Verkaufspreis. Kalibrierter Umsatz = Forecast-Umsatz mit Kalibrierfaktor aus Eingaben.",children:t.jsx(re,{})})]}),t.jsx("div",{children:t.jsx(b,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(Ue,{block:!0,value:A,onChange:e=>w(String(e)==="calibrated"?"calibrated":"forecast"),options:[{label:"Forecast-Umsatz",value:"forecast"},{label:"Kalibrierter Umsatz",value:"calibrated"}]}),t.jsxs(b,{type:"secondary",children:[A==="calibrated"?`Kalibrierung aktiv (wirkt über ${Ut} Monate).`:"Kalibrierung aus."," ",t.jsx(G,{size:"small",type:"link",onClick:()=>u("/v2/abschluss/eingaben"),children:A==="calibrated"?"Eingaben öffnen":"In Eingaben aktivieren"})]}),ut?t.jsx(b,{type:"warning",children:ut}):null]}),t.jsxs(H,{size:"small",className:"v2-calc-cockpit-module",children:[t.jsxs(M,{size:6,children:[t.jsx(b,{strong:!0,children:"Amazon Auszahlungsquote"}),t.jsx(ae,{title:"Manuell nutzt die Monatsquote aus Eingaben. Empfehlung berechnet die Quote automatisch als Vorschlag je Monat.",children:t.jsx(re,{})})]}),t.jsx("div",{children:t.jsx(b,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(Ue,{block:!0,value:E,onChange:e=>O(String(e)==="recommendation"?"recommendation":"manual"),options:[{label:"Manuelle Quote",value:"manual"},{label:"Empfehlung",value:"recommendation"}]}),t.jsxs(M,{direction:"vertical",size:6,style:{width:"100%"},children:[t.jsxs(M,{size:6,children:[t.jsx(b,{strong:!0,children:"Sicherheitsmodus"}),t.jsx(ae,{title:"Basis: keine Sicherheitsmarge. Konservativ: reduziert die Quote in zukünftigen Monaten um 1pp pro Monat (max. 5pp).",children:t.jsx(re,{})})]}),t.jsx(Ue,{block:!0,value:N,onChange:e=>j(String(e)==="conservative"?"conservative":"basis"),options:[{label:"Basis",value:"basis"},{label:"Konservativ",value:"conservative"}]})]}),Ht?t.jsxs("div",{className:"v2-calc-cockpit-q4-row",children:[t.jsx(xn,{checked:P,onChange:e=>Ce(e.target.checked),children:"Saisonalität (Q4) berücksichtigen"}),t.jsx(ae,{title:"Q4 berücksichtigt saisonale Besonderheiten für Oktober bis Dezember. Gilt nur für die Empfehlung.",children:t.jsx(re,{})})]}):null,t.jsx(b,{type:"secondary",children:E==="manual"?"Verwendet die manuell gepflegte Auszahlungsquote je Monat.":"Empfehlung wird je Monat automatisch berechnet und direkt im Chart angewendet."})]})]})]}),t.jsxs("div",{className:"v2-dashboard-chart-summary",children:[t.jsxs(z,{color:"green",children:["Einzahlungen: ",T(Qt)]}),t.jsxs(z,{color:"red",children:["Auszahlungen: ",T(Zt)]}),t.jsxs(z,{color:Oe>=0?"green":"red",children:["Netto: ",T(Oe)]}),le.length?t.jsxs(z,{color:"gold",children:["PFO: ",le.length]}):null,X?t.jsxs(z,{color:"gold",children:["bis ",W(X)]}):null]}),t.jsx(b,{type:"secondary",className:"v2-dashboard-chart-hint",children:"Klick auf Monat oder Balken für Details. Legende ist scrollbar."}),t.jsx(un,{style:{height:430},option:Yt,onEvents:Xt})]}),t.jsxs(H,{children:[t.jsxs(M,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs("div",{children:[t.jsx(Ve,{level:4,children:"Monatliche PnL (Matrix)"}),t.jsx(Tt,{type:"secondary",children:"Zeilen = Einnahmen/Ausgaben-Struktur, Spalten = gewählter Zeitraum. Bei PO/FO/Phantom siehst du auf Wunsch die einzelnen Zahlungen."})]}),t.jsx(G,{size:"small",onClick:tn,children:en?"Alles zuklappen":"Alles aufklappen"})]}),t.jsx(vn,{className:"v2-dashboard-pnl-table",columns:nn,dataSource:$e,pagination:!1,size:"small",rowKey:"key",rowClassName:e=>e.rowType==="order"?"v2-dashboard-pnl-table-row-order":e.rowType==="payment"?"v2-dashboard-pnl-table-row-payment":e.key==="net"||e.key==="closing"?"v2-dashboard-pnl-table-row-total":Array.isArray(e.children)&&e.children.length?"v2-dashboard-pnl-table-row-group":"v2-dashboard-pnl-table-row-detail",expandable:{expandedRowKeys:Ee,onExpandedRowsChange:e=>Ie(e.map(s=>String(s)))},scroll:{x:"max-content"}})]})]}):t.jsx("div",{className:"v2-page",children:t.jsx(me,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{cs as default};
