import{t as c,k as t,S as ie,Q as ye,M as L,N as ue,L as Ce,R as ke,O as be,a0 as we}from"./index-D6pMtF0j.js";import{b as x,E as ce}from"./chartPalette-7khc0bAO.js";import{c as Fe}from"./cashflow-C2VWmt4k.js";import{D as Ie}from"./DataTable-CIb--nRu.js";import{c as De,m as H,a as ze,f as K}from"./months-BTPgK-LH.js";import{u as Le,C as w}from"./workspace-CPdCVGI9.js";import{D as J}from"./DeNumberInput-CX2Y0IgS.js";import{S as Te}from"./StatsTableShell-BNejfc6s.js";import{s as Ue}from"./index-7KSmUmnD.js";import{S as Ke}from"./index-aM_fcGg-.js";import{S as ne}from"./index-CkL_kwdS.js";import{F as Be}from"./Table-CdD2J4eb.js";import"./planProducts-C4xIiO35.js";import"./Dropdown-CGxjL3l8.js";import"./index-IqeLlo-_.js";import"./DownOutlined-BAIni2KE.js";import"./index-B8Utj4Z_.js";import"./useBubbleLock-CgXBP_Sr.js";import"./index-kRHecK7L.js";import"./Pagination-BNx-A3KD.js";function xe(o){return String(o||"").trim()}function je(o){const r=Number(o);return Number.isFinite(r)?r:0}function Oe(o){const r=Math.abs(je(o.amount));return String(o.direction||"").toLowerCase()==="out"?-r:r}function $e(o){const r=String(o.source||"").toLowerCase();return r==="po"?"po":r==="fo"?"fo":r==="sales"||r==="sales-plan"?"sales":r==="fixcosts"?"fixcosts":r==="extras"?"extras":r==="dividends"?"dividends":r==="vat"?"vat":r==="launch-costs"?"extras":"unknown"}function Qe(o){const r=String(o.source||"").toLowerCase(),y=String(o.kind||"").toLowerCase(),h=String(o.group||"").toLowerCase();return r==="po"||r==="fo"?"po_fo":r==="sales"||r==="sales-plan"?"inflow":r==="fixcosts"||h==="fixkosten"?"fixcost":y.includes("duty")||y.includes("eust")||y.includes("vat")||h.includes("import")?"tax":String(o.direction||"").toLowerCase()==="in"?"inflow":String(o.direction||"").toLowerCase()==="out"?"outflow":"other"}function We(o){const r=Array.isArray(o.products)?o.products:[],y=new Map;r.forEach(d=>{const i=xe(d.sku);if(!i)return;const s=String(d.alias||"").trim()||i;y.set(i,s)});const h=new Map,N=(d,i)=>{const s=(d==="po"?[i.poNo,i.id]:[i.foNo,i.foNumber,i.id]).map(S=>String(S||"").trim()).filter(Boolean);if(!s.length)return;const j=Array.isArray(i.items)&&i.items.length?i.items:[{sku:i.sku,units:i.units}],E=new Set;let A=0;j.forEach(S=>{const z=xe(S.sku);if(!z)return;E.add(y.get(z)||z);const O=je(S.units??S.qty??S.quantity);A+=O});const v={aliases:Array.from(E),units:Number.isFinite(A)?A:null};Array.from(new Set(s)).forEach(S=>{h.set(`${d}:${S}`,v)})};return(Array.isArray(o.pos)?o.pos:[]).forEach(d=>N("po",d)),(Array.isArray(o.fos)?o.fos:[]).forEach(d=>N("fo",d)),h}function Ge(o){const r=new Map,y=We(o.state);return(Array.isArray(o.breakdown)?o.breakdown:[]).forEach(h=>{const N=String(h.month||"").trim();if(!N)return;const i=(Array.isArray(h.entries)?h.entries:[]).map(s=>{var $;const j=$e(s),E=s.sourceNumber?String(s.sourceNumber):void 0,A=s.sourceId?String(s.sourceId):void 0,v=s.meta&&typeof s.meta=="object"?s.meta:{},S=j==="fo"&&(v.phantom===!0||(A?(($=o.provisionalFoIds)==null?void 0:$.has(A))===!0:!1)),z=s.provisional===!0||S,O=E&&(j==="po"||j==="fo")?`${j}:${E}`:null,C=O?y.get(O):null,l=v.cashIn&&typeof v.cashIn=="object"?v.cashIn:null;return{month:N,group:Qe(s),label:String(s.label||"Eintrag"),tooltip:typeof s.tooltip=="string"?s.tooltip:void 0,amount:Oe(s),provisional:z,paid:typeof s.paid=="boolean"?s.paid:null,source:j,portfolioBucket:s.portfolioBucket?String(s.portfolioBucket):v.portfolioBucket?String(v.portfolioBucket):null,sourceNumber:E,sourceId:A,tooltipMeta:C?{aliases:C.aliases,units:C.units,milestone:String(s.label||""),dueDate:s.date?String(s.date):null}:void 0,cashInMeta:l?{quoteSource:l.quoteSource?String(l.quoteSource):void 0,revenueSource:l.revenueSource?String(l.revenueSource):void 0,component:l.component?String(l.component):null,forecastRevenueRaw:Number.isFinite(Number(l.forecastRevenueRaw))?Number(l.forecastRevenueRaw):null,calibrationFactorApplied:Number.isFinite(Number(l.calibrationFactorApplied))?Number(l.calibrationFactorApplied):null,calibrationSourceMonth:l.calibrationSourceMonth?String(l.calibrationSourceMonth):null,calibrationMethod:l.calibrationMethod?String(l.calibrationMethod):null,planRevenueAfterCalibration:Number.isFinite(Number(l.planRevenueAfterCalibration))?Number(l.planRevenueAfterCalibration):null,payoutPct:Number.isFinite(Number(l.payoutPct))?Number(l.payoutPct):null,payoutAmount:Number.isFinite(Number(l.payoutAmount))?Number(l.payoutAmount):null}:void 0}});r.set(N,i)}),r}const{Paragraph:q,Text:F,Title:B}=Ce,ve=[{value:"last6",label:"Letzte 6 Monate",count:6},{value:"last12",label:"Letzte 12 Monate",count:12},{value:"all",label:"Alle Monate",count:null}],_e={inflow:"Einzahlungen",po_fo:"PO/FO",fixcost:"Fixkosten",tax:"Steuern & Import",outflow:"Auszahlungen",other:"Sonstige"};function m(o){const r=Number(o);return Number.isFinite(r)?r:null}function qe(o){return/^\d{4}-\d{2}$/.test(String(o||"").trim())}function T(o){return Math.round(o*100)/100}function ae(o){return Math.round(o*1e4)/1e4}function P(o){const r=Number(o);return Number.isFinite(r)?Number(r):null}function de(o,r){const y=Number(o),h=Number(r);return!Number.isFinite(y)||y<=0||!Number.isFinite(h)?null:h/y*100}function R(o){const r=Number(o);return Number.isFinite(r)?r.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}):"—"}function oe(o){const r=Number(o);return Number.isFinite(r)?r<0?`−${R(Math.abs(r))}`:R(r):"—"}function re(o){const r=Number(o);return Number.isFinite(r)?`${r.toLocaleString("de-DE",{minimumFractionDigits:1,maximumFractionDigits:1})} %`:"—"}function Pe(o,r){return!Number.isFinite(o)||!Number.isFinite(r)||Number(r)===0?null:Number(o)/Number(r)*100}function me(o,r,y){const h=o.filter(d=>!d.provisional).map(d=>{const i=r(d),s=y(d);return!Number.isFinite(i)||!Number.isFinite(s)||!i?null:Math.abs((Number(s)-Number(i))/Number(i))*100}).filter(d=>Number.isFinite(d));if(!h.length)return{accuracyPct:null,mapePct:null,sampleCount:0};const N=h.reduce((d,i)=>d+i,0)/h.length;return{accuracyPct:Math.max(0,100-N),mapePct:N,sampleCount:h.length}}function Ve(o,r){const y=m(o.plannedRevenue)||0,h=m(o.actualRevenue)||0,N=m(o.payoutDelta)||0,d=m(o.closingDelta)||0,i=m(r==null?void 0:r.closingDelta)||0,s=d-i,j=(m(o.plannedPayoutRatePct)||0)/100,E=(m(o.actualPayoutRatePct)||0)/100;let A=N,v=0;Number.isFinite(y)&&Number.isFinite(h)&&Number.isFinite(j)&&Number.isFinite(E)&&(A=(h-y)*j,v=h*(E-j));const S=s-N;return[{key:"rev_effect",label:"Umsatz-Effekt (auf Payout)",amount:T(A),kind:"component"},{key:"payout_effect",label:"Payout-Quote-Effekt",amount:T(v),kind:"component"},{key:"residual",label:"Sonstige Effekte (Kosten/Timing)",amount:T(S),kind:"component"},{key:"total",label:"Delta Kontostand (Monats-Effekt)",amount:T(s),kind:"total"}]}function gt(){const{state:o,loading:r,error:y,saving:h,saveWith:N}=Le(),[d,i]=c.useState("last12"),[s,j]=c.useState(""),[E,A]=c.useState({}),[v,S]=c.useState(!1),[z,O]=Ue.useMessage(),C=o,l=c.useMemo(()=>Fe(C),[C]),$=De(),I=H($),k=c.useMemo(()=>(Array.isArray(l.actualComparisons)?l.actualComparisons:[]).map(n=>{const a=String(n.month||"").trim(),u=H(a),g=u!=null&&I!=null&&u>=I,f=Pe(m(n.plannedPayout),m(n.plannedRevenue)),M=Pe(m(n.actualPayout),m(n.actualRevenue)),D=m(n.plannedClosing),_=m(n.actualClosing),te=Number.isFinite(D)&&D&&Number.isFinite(_)?(Number(_)-Number(D))/Number(D)*100:null;return{...n,month:a,provisional:g,plannedPayoutRatePct:f,actualPayoutRatePct:M,closingDeltaPct:te}}).filter(n=>n.month).sort((n,a)=>n.month.localeCompare(a.month)),[I,l.actualComparisons]),Q=c.useMemo(()=>C.monthlyActuals&&typeof C.monthlyActuals=="object"?C.monthlyActuals:{},[C]),W=c.useMemo(()=>{const e=new Set;return k.forEach(n=>{const a=H(n.month);!n.month||a==null||I==null||a<I&&e.add(n.month)}),Object.keys(Q).forEach(n=>{const a=H(n);a==null||I==null||a<I&&e.add(n)}),e.size||Array.from({length:12},(a,u)=>ze($,-(u+1))).forEach(a=>e.add(a)),Array.from(e).sort((n,a)=>a.localeCompare(n))},[$,I,Q,k]),G=c.useMemo(()=>{const e=new Map(k.map(a=>[a.month,a])),n={};return W.forEach(a=>{const u=e.get(a)||null,g=Q[a]&&typeof Q[a]=="object"?Q[a]:{},f=P(g.realRevenueEUR??(u==null?void 0:u.actualRevenue)),M=P(g.realPayoutEur??(u==null?void 0:u.actualPayout)),D=de(f,M)??P(g.realPayoutRatePct??(u==null?void 0:u.actualPayoutRatePct));n[a]={month:a,realClosingBalanceEur:P(g.realClosingBalanceEUR??(u==null?void 0:u.actualClosing)),realRevenueEur:f,realProfitEur:P(g.realProfitEur),realPayoutEur:M,sellerboardMarginPct:P(g.sellerboardMarginPct),payoutQuotePct:Number.isFinite(D)?ae(Number(D)):null}}),n},[W,Q,k]);c.useEffect(()=>{v||A(G)},[G,v]);const se=c.useMemo(()=>W.map(e=>E[e]||G[e]).filter(e=>!!e),[W,G,E]);function V(e,n){A(a=>{const g={...a[e]||G[e]||{month:e,realClosingBalanceEur:null,realRevenueEur:null,realProfitEur:null,realPayoutEur:null,sellerboardMarginPct:null,payoutQuotePct:null},...n},f=de(g.realRevenueEur,g.realPayoutEur);return g.payoutQuotePct=Number.isFinite(f)?ae(Number(f)):null,{...a,[e]:g}}),S(!0)}async function Se(){if(!W.length){z.warning("Keine abgeschlossenen Monate vorhanden.");return}try{await N(e=>{const n=we(e),a=n.monthlyActuals&&typeof n.monthlyActuals=="object"?n.monthlyActuals:{},u={};return Object.entries(a).forEach(([g,f])=>{if(!qe(g))return;const M=H(g);M==null||I==null||M<I||(u[g]={...f||{}})}),W.forEach(g=>{const f=a[g]&&typeof a[g]=="object"?{...a[g]}:{},M=E[g]||G[g];if(!M)return;const D=P(M.realClosingBalanceEur),_=P(M.realRevenueEur),te=P(M.realProfitEur),le=P(M.realPayoutEur),ge=P(M.sellerboardMarginPct),fe=de(_,le);Number.isFinite(D)?f.realClosingBalanceEUR=T(Number(D)):delete f.realClosingBalanceEUR,Number.isFinite(_)?f.realRevenueEUR=T(Number(_)):delete f.realRevenueEUR,Number.isFinite(te)?f.realProfitEur=T(Number(te)):delete f.realProfitEur,Number.isFinite(le)?f.realPayoutEur=T(Number(le)):delete f.realPayoutEur,Number.isFinite(ge)?f.sellerboardMarginPct=ae(Number(ge)):delete f.sellerboardMarginPct,Number.isFinite(fe)?f.realPayoutRatePct=ae(Number(fe)):delete f.realPayoutRatePct,Object.keys(f).length&&(u[g]=f)}),n.monthlyActuals=u,n},"v2:soll-ist:actuals"),S(!1),z.success("Ist-Werte gespeichert.")}catch(e){console.error(e),z.error(e instanceof Error?e.message:"Ist-Werte konnten nicht gespeichert werden.")}}const p=c.useMemo(()=>{const e=ve.find(n=>n.value===d);return!e||e.count==null?k:k.slice(-e.count)},[d,k]);c.useEffect(()=>{if(!p.length){j("");return}const e=new Set(p.map(n=>n.month));(!s||!e.has(s))&&j(p[p.length-1].month)},[s,p]);const b=c.useMemo(()=>p.find(e=>e.month===s)||p[p.length-1]||null,[s,p]),he=c.useMemo(()=>{if(!b)return null;const e=k.findIndex(n=>n.month===b.month);return e<=0?null:k[e-1]||null},[k,b]),U=c.useMemo(()=>p.filter(e=>!e.provisional),[p]),X=c.useMemo(()=>me(U,e=>m(e.plannedClosing),e=>m(e.actualClosing)),[U]),Y=c.useMemo(()=>me(U,e=>m(e.plannedRevenue),e=>m(e.actualRevenue)),[U]),ee=c.useMemo(()=>me(U,e=>m(e.plannedPayout),e=>m(e.actualPayout)),[U]),Z=c.useMemo(()=>b?Ve(b,he):[],[he,b]),pe=c.useMemo(()=>Ge({breakdown:Array.isArray(l.breakdown)?l.breakdown:[],state:C}),[l.breakdown,C]),Ne=c.useMemo(()=>{if(!b)return[];const e=pe.get(b.month)||[],n=new Map;return e.forEach(a=>{n.set(a.group,(n.get(a.group)||0)+Number(a.amount||0))}),Array.from(n.entries()).map(([a,u])=>({key:a,label:_e[a]||a,amount:T(u)})).sort((a,u)=>Math.abs(u.amount)-Math.abs(a.amount))},[pe,b]),Me=c.useMemo(()=>{const e=p.findIndex(a=>a.provisional),n=p.map(a=>K(a.month));return{tooltip:{trigger:"axis",valueFormatter:a=>R(a)},legend:{top:0},grid:{left:54,right:26,top:44,bottom:26},xAxis:{type:"category",data:n},yAxis:{type:"value",axisLabel:{formatter:a=>R(a)}},series:[{name:"Delta Kontostand",type:"bar",data:p.map(a=>Number(a.closingDelta||0)),itemStyle:{color:a=>e>=0&&a.dataIndex>=e?x.provisionalOverlay:a.value<0?x.negative:x.positive}},{name:"Kontostand Soll",type:"line",smooth:!0,data:p.map(a=>m(a.plannedClosing)),lineStyle:{width:2,type:"dashed",color:x.plannedClosing},itemStyle:{color:x.plannedClosing}},{name:"Kontostand-IST",type:"line",smooth:!0,data:p.map(a=>m(a.actualClosing)),lineStyle:{width:2,color:x.actualClosing},itemStyle:{color:x.actualClosing},markArea:e>=0?{itemStyle:{color:x.provisionalArea},data:[[{xAxis:n[e]},{xAxis:n[n.length-1]}]]}:void 0}]}},[p]),Ee=c.useMemo(()=>({tooltip:{trigger:"axis"},legend:{top:0},grid:{left:54,right:52,top:44,bottom:26},xAxis:{type:"category",data:p.map(e=>K(e.month))},yAxis:[{type:"value",name:"EUR",axisLabel:{formatter:e=>R(e)}},{type:"value",name:"%",min:0,max:100,axisLabel:{formatter:e=>`${e.toLocaleString("de-DE",{maximumFractionDigits:0})} %`}}],series:[{name:"Umsatz Soll",type:"bar",data:p.map(e=>m(e.plannedRevenue)),itemStyle:{color:x.plannedRevenue}},{name:"Umsatz Ist",type:"bar",data:p.map(e=>m(e.actualRevenue)),itemStyle:{color:x.actualRevenue}},{name:"Payout-Quote Soll",type:"line",yAxisIndex:1,smooth:!0,data:p.map(e=>m(e.plannedPayoutRatePct)),lineStyle:{width:2,type:"dashed",color:x.plannedPayoutRate},itemStyle:{color:x.plannedPayoutRate}},{name:"Payout-Quote Ist",type:"line",yAxisIndex:1,smooth:!0,data:p.map(e=>m(e.actualPayoutRatePct)),lineStyle:{width:2,color:x.actualPayoutRate},itemStyle:{color:x.actualPayoutRate}}]}),[p]),Ae=c.useMemo(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},valueFormatter:e=>R(e)},grid:{left:54,right:20,top:18,bottom:48},xAxis:{type:"category",data:Z.map(e=>e.label),axisLabel:{interval:0,rotate:20}},yAxis:{type:"value",axisLabel:{formatter:e=>R(e)}},series:[{type:"bar",data:Z.map(e=>e.amount),itemStyle:{color:e=>{const n=Z[e.dataIndex];return(n==null?void 0:n.kind)==="total"?x.totalDriver:e.value<0?x.negative:x.positive}}}]}),[Z]),Re=c.useMemo(()=>[{header:"Monat",accessorKey:"month",meta:{minWidth:150},cell:({row:e})=>t.jsxs(ie,{size:6,children:[t.jsx(ye,{size:"small",type:s===e.original.month?"primary":"default",onClick:()=>j(e.original.month),children:K(e.original.month)}),e.original.provisional?t.jsx(L,{color:"gold",children:"Vorlaeufig"}):t.jsx(L,{color:"green",children:"Abgeschlossen"})]})},{header:"Kontostand Soll",meta:{align:"right",width:150},cell:({row:e})=>R(e.original.plannedClosing)},{header:"Kontostand-IST",meta:{align:"right",width:150},cell:({row:e})=>R(e.original.actualClosing)},{header:"Delta Kontostand",meta:{align:"right",width:150},cell:({row:e})=>t.jsx("span",{className:Number(e.original.closingDelta||0)<0?"v2-negative":void 0,children:oe(e.original.closingDelta)})},{header:"Umsatz Soll",meta:{align:"right",width:140},cell:({row:e})=>R(e.original.plannedRevenue)},{header:"Umsatz Ist",meta:{align:"right",width:140},cell:({row:e})=>R(e.original.actualRevenue)},{header:"Payout Soll",meta:{align:"right",width:140},cell:({row:e})=>R(e.original.plannedPayout)},{header:"Payout Ist",meta:{align:"right",width:140},cell:({row:e})=>R(e.original.actualPayout)}],[s]);return r?t.jsx("div",{className:"v2-page",children:t.jsx(ue,{type:"info",showIcon:!0,message:"Workspace wird geladen..."})}):y?t.jsx("div",{className:"v2-page",children:t.jsx(ue,{type:"error",showIcon:!0,message:y})}):t.jsxs("div",{className:"v2-page",children:[O,t.jsxs(w,{className:"v2-intro-card",children:[t.jsxs("div",{className:"v2-page-head",children:[t.jsxs("div",{children:[t.jsx(B,{level:3,children:"Soll vs. Ist"}),t.jsx(q,{children:"Wie gut war die Planung gegen die real eingetretenen Werte. Fokus: Kontostand, Umsatz und Payout."})]}),t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(F,{children:"Zeitraum"}),t.jsx(Ke,{value:d,onChange:e=>i(e),options:ve.map(e=>({value:e.value,label:e.label})),style:{width:220,maxWidth:"100%"}})]})]}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(L,{color:"green",children:["Monate mit Istwerten: ",k.length]}),t.jsxs(L,{color:"blue",children:["Im Vergleich (abgeschlossen): ",U.length]}),t.jsx(L,{color:"gold",children:'Laufender Monat wird als "vorlaeufig" markiert'})]})})]}),k.length?null:t.jsx(ue,{type:"warning",showIcon:!0,message:"Noch keine Vergleichsdaten vorhanden",description:"Du kannst unten trotzdem Monats-Istwerte erfassen; die Analyse füllt sich danach."}),t.jsxs(w,{children:[t.jsxs(ie,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs("div",{children:[t.jsx(B,{level:4,style:{marginBottom:0},children:"Ist-Werte Monatsende (Sellerboard)"}),t.jsx(F,{type:"secondary",children:"Für jeden abgeschlossenen Monat: Kontostand, Umsatz, Gewinn, Auszahlung, Marge. Auszahlungsquote wird automatisch aus Auszahlung/Umsatz berechnet. Der eingetragene Kontostand-IST am Monatsende wird als Eröffnungsstand für den Folgemonat verwendet."})]}),t.jsxs(ie,{wrap:!0,children:[t.jsxs(L,{color:"blue",children:["Abgeschlossene Monate: ",se.length]}),v?t.jsx(L,{color:"gold",children:"Ungespeicherte Änderungen"}):t.jsx(L,{color:"green",children:"Synchron"}),h?t.jsx(L,{color:"processing",children:"Speichern..."}):null,t.jsx(ye,{type:"primary",onClick:()=>{Se()},disabled:!v||!se.length,loading:h,children:"Ist-Werte speichern"})]})]}),t.jsx("div",{style:{marginTop:12},children:t.jsx(Te,{children:t.jsxs("table",{className:"v2-stats-table","data-layout":"fixed",style:{minWidth:1300},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:140},children:"Monat"}),t.jsx("th",{style:{width:210},children:"Kontostand-IST (EUR)"}),t.jsx("th",{style:{width:190},children:"Umsatz IST (EUR)"}),t.jsx("th",{style:{width:190},children:"Gewinn IST (EUR)"}),t.jsx("th",{style:{width:190},children:"Auszahlung IST (EUR)"}),t.jsx("th",{style:{width:170},children:"Marge lt. Sellerboard (%)"}),t.jsx("th",{style:{width:170},children:"Auszahlungsquote (%)"})]})}),t.jsx("tbody",{children:se.map(e=>t.jsxs("tr",{children:[t.jsxs("td",{children:[t.jsx(F,{strong:!0,children:K(e.month)}),t.jsx("div",{children:t.jsx(F,{type:"secondary",children:e.month})})]}),t.jsx("td",{children:t.jsx(J,{value:e.realClosingBalanceEur??void 0,mode:"decimal",step:100,style:{width:"100%"},onChange:n=>{V(e.month,{realClosingBalanceEur:P(n)})}})}),t.jsx("td",{children:t.jsx(J,{value:e.realRevenueEur??void 0,mode:"decimal",step:100,min:0,style:{width:"100%"},onChange:n=>{V(e.month,{realRevenueEur:P(n)})}})}),t.jsx("td",{children:t.jsx(J,{value:e.realProfitEur??void 0,mode:"decimal",step:100,style:{width:"100%"},onChange:n=>{V(e.month,{realProfitEur:P(n)})}})}),t.jsx("td",{children:t.jsx(J,{value:e.realPayoutEur??void 0,mode:"decimal",step:100,style:{width:"100%"},onChange:n=>{V(e.month,{realPayoutEur:P(n)})}})}),t.jsx("td",{children:t.jsx(J,{value:e.sellerboardMarginPct??void 0,mode:"percent",step:.1,style:{width:"100%"},onChange:n=>{V(e.month,{sellerboardMarginPct:P(n)})}})}),t.jsx("td",{children:t.jsx(F,{strong:!0,children:re(e.payoutQuotePct)})})]},e.month))})]})})})]}),t.jsxs("div",{className:"v2-svi-kpi-grid",children:[t.jsxs(w,{children:[t.jsx(ne,{title:"Treffsicherheit Kontostand-IST",value:X.accuracyPct!=null?`${X.accuracyPct.toLocaleString("de-DE",{maximumFractionDigits:1})} %`:"—"}),t.jsxs(F,{type:"secondary",children:["MAPE: ",re(X.mapePct)," · n=",X.sampleCount]})]}),t.jsxs(w,{children:[t.jsx(ne,{title:"Treffsicherheit Umsatz",value:Y.accuracyPct!=null?`${Y.accuracyPct.toLocaleString("de-DE",{maximumFractionDigits:1})} %`:"—"}),t.jsxs(F,{type:"secondary",children:["MAPE: ",re(Y.mapePct)," · n=",Y.sampleCount]})]}),t.jsxs(w,{children:[t.jsx(ne,{title:"Treffsicherheit Payout",value:ee.accuracyPct!=null?`${ee.accuracyPct.toLocaleString("de-DE",{maximumFractionDigits:1})} %`:"—"}),t.jsxs(F,{type:"secondary",children:["MAPE: ",re(ee.mapePct)," · n=",ee.sampleCount]})]}),t.jsxs(w,{children:[t.jsx(ne,{title:"Aktueller Delta-Kontostand",value:b?oe(b.closingDelta):"—"}),t.jsx(F,{type:"secondary",children:b?`${K(b.month)} ${b.provisional?"(vorlaeufig)":"(abgeschlossen)"}`:"Kein Monat gewählt"})]})]}),t.jsxs(w,{children:[t.jsx(B,{level:4,children:"Kontostand-IST vs Soll"}),t.jsx(q,{type:"secondary",children:"Linien zeigen Kontostand-IST und Kontostand Soll, Balken darunter die Abweichung (IST minus Soll) pro Monat."}),t.jsx(ce,{style:{height:380},option:Me})]}),t.jsxs(ke,{gutter:[12,12],children:[t.jsx(be,{xs:24,xl:14,children:t.jsxs(w,{children:[t.jsx(B,{level:4,children:"Umsatz & Payout-Quote"}),t.jsx(q,{type:"secondary",children:"Umsatz in EUR als Balken, Payout-Quote als Linien (Soll vs. Ist)."}),t.jsx(ce,{style:{height:340},option:Ee})]})}),t.jsx(be,{xs:24,xl:10,children:t.jsxs(w,{children:[t.jsxs(B,{level:4,children:["Treiber Monat ",b?K(b.month):"—"]}),t.jsx(q,{type:"secondary",children:"Zerlegung des Monats-Effekts auf den Kontostand in Umsatz-/Payout-Effekt und Residuum."}),t.jsx(ce,{style:{height:260},option:Ae}),t.jsx("div",{className:"v2-svi-driver-list",children:Z.map(e=>t.jsxs("div",{className:`v2-svi-driver-row ${e.kind==="total"?"is-total":""}`,children:[t.jsx(F,{children:e.label}),t.jsx(F,{className:e.amount<0?"v2-negative":void 0,children:oe(e.amount)})]},e.key))})]})})]}),t.jsxs(w,{children:[t.jsx(B,{level:4,children:"Monatsvergleich"}),t.jsx(q,{type:"secondary",children:"Monat anklicken, um den Treiber- und Detailbereich zu aktualisieren."}),t.jsx(Ie,{data:p,columns:Re,minTableWidth:1240,tableLayout:"auto"})]}),t.jsxs(w,{children:[t.jsxs(B,{level:4,children:["Plan-Detail (Auszahlungen) für ",b?K(b.month):"—"]}),t.jsx(q,{type:"secondary",children:"Geplante Auszahlungsstruktur im ausgewählten Monat als Kontext für die Soll-vs-Ist-Differenz."}),t.jsx(Be,{className:"v2-ant-table",size:"small",pagination:!1,rowKey:"key",dataSource:Ne,columns:[{title:"Gruppe",dataIndex:"label",key:"label",sorter:(e,n)=>String(e.label||"").localeCompare(String(n.label||""),"de-DE")},{title:"Planbetrag",dataIndex:"amount",key:"amount",align:"right",sorter:(e,n)=>Number(e.amount||0)-Number(n.amount||0),render:e=>t.jsx("span",{className:e<0?"v2-negative":void 0,children:oe(e)})}],locale:{emptyText:"Keine geplanten Positionen im ausgewählten Monat."}})]})]})}export{gt as default};
