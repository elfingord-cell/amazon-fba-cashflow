import{X as Ke,t as i,Y as Oe,Z as Ae,$ as Ve,a0 as Ge,N as q,a1 as qe,a2 as He,a3 as ke,a4 as Ye,a5 as Xe,a6 as Je,a7 as d,k as n,J as Ze,S as V,M as S,I as oe,P as H,a8 as Ne,a9 as te,Q as Qe,aa as en,W as ye,ab as nn,R as Be}from"./index-Bu80Uwbp.js";import{D as Z}from"./DeNumberInput-DQCzJE4i.js";import{b as tn}from"./tableModels-DxjFmPmo.js";import{f as ie}from"./months-DiLwPhVv.js";import{u as rn,C as Pe}from"./workspace-CCwvBxSI.js";import{b as an,a as Re,c as sn,m as le,P as Le,n as on,d as ze}from"./planProducts-D4fZPYls.js";import{F as we}from"./Table-BOrCuHte.js";import{g as Ce,a as ln,P as cn}from"./index-DRBHlcso.js";import{S as L}from"./index-CchoASSq.js";import{C as un}from"./index-i0sE1Ifp.js";import{s as ce}from"./index-BRveqc8-.js";import"./index-C0GAWedD.js";import"./DownOutlined-DBjqZVAX.js";import"./productCompletenessV2-CGpzck-p.js";import"./Dropdown-Dn3rrflu.js";import"./index-DXAmib6p.js";import"./useBubbleLock-DTzDssvh.js";import"./Pagination-D7WYevyM.js";const dn=r=>{const{componentCls:a,iconCls:c,antCls:o,zIndexPopup:u,colorText:f,colorWarning:j,marginXXS:y,marginXS:g,fontSize:w,fontWeightStrong:_,colorTextHeading:E}=r;return{[a]:{zIndex:u,[`&${o}-popover`]:{fontSize:w},[`${a}-message`]:{marginBottom:g,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${a}-message-icon ${c}`]:{color:j,fontSize:w,lineHeight:1,marginInlineEnd:g},[`${a}-title`]:{fontWeight:_,color:E,"&:only-child":{fontWeight:"normal"}},[`${a}-description`]:{marginTop:y,color:f}},[`${a}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:g}}}}},mn=r=>{const{zIndexPopupBase:a}=r;return{zIndexPopup:a+60}},Te=Ke("Popconfirm",r=>dn(r),mn,{resetStyle:!1});var pn=function(r,a){var c={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.indexOf(o)<0&&(c[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(r);u<o.length;u++)a.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(r,o[u])&&(c[o[u]]=r[o[u]]);return c};const De=r=>{const{prefixCls:a,okButtonProps:c,cancelButtonProps:o,title:u,description:f,cancelText:j,okText:y,okType:g="primary",icon:w=i.createElement(Oe,null),showCancel:_=!0,close:E,onConfirm:F,onCancel:$,onPopupClick:U}=r,{getPrefixCls:I}=i.useContext(Ae),[x]=Ve("Popconfirm",Ge.Popconfirm),m=Ce(u),W=Ce(f);return i.createElement("div",{className:`${a}-inner-content`,onClick:U},i.createElement("div",{className:`${a}-message`},w&&i.createElement("span",{className:`${a}-message-icon`},w),i.createElement("div",{className:`${a}-message-text`},m&&i.createElement("div",{className:`${a}-title`},m),W&&i.createElement("div",{className:`${a}-description`},W))),i.createElement("div",{className:`${a}-buttons`},_&&i.createElement(q,Object.assign({onClick:$,size:"small"},o),j||(x==null?void 0:x.cancelText)),i.createElement(qe,{buttonProps:Object.assign(Object.assign({size:"small"},He(g)),c),actionFn:F,close:E,prefixCls:I("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},y||(x==null?void 0:x.okText))))},hn=r=>{const{prefixCls:a,placement:c,className:o,style:u}=r,f=pn(r,["prefixCls","placement","className","style"]),{getPrefixCls:j}=i.useContext(Ae),y=j("popconfirm",a),[g]=Te(y);return g(i.createElement(ln,{placement:c,className:ke(y,o),style:u,content:i.createElement(De,Object.assign({prefixCls:y},f))}))};var fn=function(r,a){var c={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.indexOf(o)<0&&(c[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(r);u<o.length;u++)a.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(r,o[u])&&(c[o[u]]=r[o[u]]);return c};const gn=i.forwardRef((r,a)=>{var c,o;const{prefixCls:u,placement:f="top",trigger:j="click",okType:y="primary",icon:g=i.createElement(Oe,null),children:w,overlayClassName:_,onOpenChange:E,onVisibleChange:F,overlayStyle:$,styles:U,classNames:I}=r,x=fn(r,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:m,className:W,style:Q,classNames:C,styles:re}=Ye("popconfirm"),[Y,O]=Xe(!1,{value:(c=r.open)!==null&&c!==void 0?c:r.visible,defaultValue:(o=r.defaultOpen)!==null&&o!==void 0?o:r.defaultVisible}),z=(P,N)=>{O(P,!0),F==null||F(P),E==null||E(P,N)},T=P=>{z(!1,P)},b=P=>{var N;return(N=r.onConfirm)===null||N===void 0?void 0:N.call(void 0,P)},X=P=>{var N;z(!1,P),(N=r.onCancel)===null||N===void 0||N.call(void 0,P)},me=(P,N)=>{const{disabled:e=!1}=r;e||z(P,N)},ee=m("popconfirm",u),pe=ke(ee,W,_,C.root,I==null?void 0:I.root),he=ke(C.body,I==null?void 0:I.body),[fe]=Te(ee);return fe(i.createElement(cn,Object.assign({},Je(x,["title"]),{trigger:j,placement:f,onOpenChange:me,open:Y,ref:a,classNames:{root:pe,body:he},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},re.root),Q),$),U==null?void 0:U.root),body:Object.assign(Object.assign({},re.body),U==null?void 0:U.body)},content:i.createElement(De,Object.assign({okType:y,icon:g},r,{prefixCls:ee,close:T,onConfirm:b,onCancel:X})),"data-popover-inject":!0}),w))}),_e=gn;_e._InternalPanelDoNotUseOrYouWillBeFired=hn;const{Paragraph:Me,Text:G,Title:Ee}=Ze,Ue={standalone:"Standalone",variant_of_existing:"Variant of Existing",category_adjacent:"Category Adjacent"};function ue(){return new Date().toISOString()}function Fe(r){return`${r}-${Math.random().toString(36).slice(2,9)}`}function l(r){if(r==null||r==="")return null;const a=Number(r);return Number.isFinite(a)?a:null}function $e(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}function k(r,a=0){const c=Number(r);return Number.isFinite(c)?c.toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a}):"—"}function de(r,a=0){const c=r&&typeof r=="object"?r:{},o=String(c.id||"").trim();return o||String(ze(c,a).id||"").trim()}function ve(r){const a=ze(r||{},0),c=Array.isArray(a.launchCosts)?a.launchCosts:[];return{id:a.id||"",alias:a.alias||"",plannedSku:a.plannedSku||"",relationType:a.relationType||Le[0],categoryId:a.categoryId||null,status:a.status||"active",portfolioBucket:Be(a.portfolioBucket,H.PLAN),includeInForecast:a.includeInForecast!==!1,launchCosts:c.map((o,u)=>{const f=o;return{id:String(f.id||`lc-${u+1}`),type:String(f.type||f.category||"Sonstiges"),amountEur:l(f.amountEur??f.amount),currency:String(f.currency||"EUR"),date:String(f.date||""),note:String(f.note||"")}}),baselineReferenceMonth:l(a.baselineReferenceMonth),baselineUnitsInReferenceMonth:l(a.baselineUnitsInReferenceMonth),seasonalityReferenceSku:a.seasonalityReferenceSku||"",baselineReferenceSku:a.baselineReferenceSku||"",avgSellingPriceGrossEUR:l(a.avgSellingPriceGrossEUR),sellerboardMarginPct:l(a.sellerboardMarginPct),launchDate:a.launchDate||$e(),rampUpWeeks:l(a.rampUpWeeks),softLaunchStartSharePct:l(a.softLaunchStartSharePct)}}function Bn(){const{state:r,loading:a,saving:c,error:o,lastSavedAt:u,saveWith:f}=rn(),[j,y]=i.useState(!1),[g,w]=i.useState(null),[_,E]=i.useState(!1),[F,$]=i.useState(null),[U,I]=i.useState(""),[x]=d.useForm(),m=d.useWatch([],x),W=r,Q=r.settings&&typeof r.settings=="object"?r.settings:{},C=i.useMemo(()=>tn(Q),[Q.horizonMonths,Q.startMonth]),re=i.useMemo(()=>(Array.isArray(r.productCategories)?r.productCategories:[]).map(e=>({id:String(e.id||""),name:String(e.name||"Ohne Kategorie")})).filter(e=>e.id),[r.productCategories]),Y=i.useMemo(()=>(Array.isArray(r.products)?r.products:[]).map(e=>{const t=e,s=String(t.sku||"").trim();if(!s)return null;const p=String(t.alias||s);return{value:s,label:`${p} · ${s}`}}).filter(Boolean),[r.products]),O=i.useMemo(()=>an({state:W,months:C}),[C,W]),z=i.useMemo(()=>g&&O.find(e=>String(e.id||"")===g)||null,[g,O]),T=i.useMemo(()=>F&&O.find(e=>String(e.id||"")===F)||null,[O,F]),b=i.useMemo(()=>{var t;if(!j)return null;const e=m||ve(z||void 0);return Re({planProduct:e,forecastImport:((t=r.forecast)==null?void 0:t.forecastImport)||{},months:C,fallbackIndex:0})},[m,z,j,C,r.forecast]),X=i.useMemo(()=>{var R;if(!j)return null;const e=m||ve(z||void 0),t=String(e.baselineReferenceSku||"").trim(),s=Number(e.baselineReferenceMonth||0);if(!t||s<1||s>12)return null;const p=((R=r.forecast)==null?void 0:R.forecastImport)||{},h=sn(p,t);if(!h)return null;const M=l((h.averagesByMonthNumber||{})[s]);return Number.isFinite(M)?{sku:t,baselineMonth:s,monthAverageUnits:M}:null},[m,z,j,r.forecast]);function me(){w(null),x.setFieldsValue({alias:"",plannedSku:"",relationType:"standalone",categoryId:null,status:"active",portfolioBucket:H.PLAN,includeInForecast:!0,launchCosts:[],baselineReferenceMonth:new Date().getMonth()+1,baselineUnitsInReferenceMonth:null,seasonalityReferenceSku:"",baselineReferenceSku:"",avgSellingPriceGrossEUR:null,sellerboardMarginPct:null,launchDate:$e(),rampUpWeeks:8,softLaunchStartSharePct:0}),y(!0)}function ee(e){w(String(e.id||"")),x.setFieldsValue(ve(e)),y(!0)}async function pe(e){await f(t=>{const s=ye(t),p=Array.isArray(s.planProducts)?s.planProducts:[];return s.planProducts=p.filter((h,M)=>de(h,M)!==e),s},"v2:plan-products:delete"),ce.success("Plan-Produkt entfernt.")}async function he(e){const t=String(e.alias||"").trim();if(!t)throw new Error("Alias ist erforderlich.");const s=e.includeInForecast!==!1;if(s&&!e.seasonalityReferenceSku)throw new Error("Bitte Referenz-SKU für Saisonalität wählen.");const p=Number(e.baselineReferenceMonth||0);if(s&&(!Number.isFinite(p)||p<1||p>12))throw new Error("Referenzmonat muss zwischen 1 und 12 liegen.");const h=Number(e.baselineUnitsInReferenceMonth||0);if(s&&(!Number.isFinite(h)||h<=0))throw new Error("Baseline Units im Referenzmonat müssen > 0 sein.");const M=Number(e.avgSellingPriceGrossEUR||0);if(s&&(!Number.isFinite(M)||M<=0))throw new Error("Bitte einen gültigen Preis (EUR) für Revenue-Berechnung pflegen.");const R=Number(e.sellerboardMarginPct||0);if(s&&(!Number.isFinite(R)||R<=0||R>100))throw new Error("Bitte eine gültige Brutto-Marge (%) > 0 und <= 100 pflegen.");const D=on(e.launchDate);if(!D)throw new Error("Launch-Datum ist erforderlich.");const K=Math.round(Number(e.rampUpWeeks||0));if(!Number.isFinite(K)||K<=0)throw new Error("Ramp-up Wochen müssen größer als 0 sein.");const J=Number(e.softLaunchStartSharePct||0);if(!Number.isFinite(J)||J<0||J>100)throw new Error("Soft-Launch Start in % muss zwischen 0 und 100 liegen.");await f(v=>{const A=ye(v),B=Array.isArray(A.planProducts)?[...A.planProducts]:[],ge=t.toLowerCase();if(B.find((Se,xe)=>{const Ie=Se;return String(Ie.alias||"").trim().toLowerCase()===ge?g?de(Ie,xe)!==g:!0:!1}))throw new Error(`Alias "${t}" existiert bereits bei einem Plan-Produkt.`);const ne=g||Fe("plan"),se=B.findIndex((Se,xe)=>de(Se,xe)===ne),be=se>=0?B[se]:null,We=nn(e.launchCosts,`plan-${ne}-lc`),je={id:ne,alias:t,plannedSku:String(e.plannedSku||"").trim(),relationType:String(e.relationType||"standalone"),categoryId:e.categoryId||null,status:e.status||"active",portfolioBucket:Be(e.portfolioBucket,H.PLAN),includeInForecast:s,launchCosts:We,baselineReferenceMonth:p,baselineUnitsInReferenceMonth:h,seasonalityReferenceSku:String(e.seasonalityReferenceSku||"").trim(),baselineReferenceSku:String(e.baselineReferenceSku||"").trim(),avgSellingPriceGrossEUR:M,sellerboardMarginPct:R,launchDate:D,rampUpWeeks:K,softLaunchStartSharePct:J,updatedAt:ue(),createdAt:g?String((be==null?void 0:be.createdAt)||ue()):ue()};return se>=0?B[se]=je:B.push(je),A.planProducts=B,A},g?"v2:plan-products:update":"v2:plan-products:create"),ce.success(g?"Plan-Produkt aktualisiert.":"Plan-Produkt angelegt."),y(!1),w(null),x.resetFields()}function fe(e){const t=String(e.id||"").trim();if(!t)return;$(t);const s=String(e.plannedSku||"").trim();I(s),E(!0)}async function P(){const e=String(F||"").trim(),t=String(U||"").trim();if(!e)throw new Error("Plan-Produkt nicht gefunden.");if(!t)throw new Error("Bitte SKU für die Übernahme wählen.");if(!Y.some(p=>p.value===t))throw new Error("Die gewählte SKU ist nicht in der Live-Produktdatenbank vorhanden.");await f(p=>{const h=ye(p),M=h,R=Array.isArray(h.planProducts)?[...h.planProducts]:[],D=R.findIndex((ae,ne)=>de(ae,ne)===e);if(D<0)throw new Error("Plan-Produkt wurde nicht gefunden.");const K=M.forecast&&typeof M.forecast=="object"?M.forecast:{},J=K.forecastImport&&typeof K.forecastImport=="object"?K.forecastImport:{},v=Re({planProduct:R[D],forecastImport:J,months:C,fallbackIndex:D}),A=ue(),B={id:Fe("plan-map"),planProductId:String(v.id||e),planProductAlias:String(v.alias||""),sku:t,plannedSku:String(v.plannedSku||""),mappedAt:A,launchDate:String(v.launchDate||""),rampUpWeeks:Number(v.rampUpWeeks||0)||null,softLaunchStartSharePct:Number(v.softLaunchStartSharePct||0),baselineReferenceMonth:Number(v.baselineReferenceMonth||0)||null,baselineUnitsInReferenceMonth:Number(v.baselineUnitsInReferenceMonth||0)||null,seasonalityReferenceSku:String(v.seasonalityReferenceSku||""),months:[...v.months],planUnitsByMonth:{...v.unitsByMonth||{}},planRevenueByMonth:{...v.revenueByMonth||{}},source:"plan_product"},ge=Array.isArray(h.planProductMappings)?[...h.planProductMappings]:[];return h.planProductMappings=[...ge.filter(ae=>String(ae.planProductId||"")!==B.planProductId),B],R[D]={...R[D],status:"archived",plannedSku:t,mappedSku:t,mappedAt:A,archivedAt:A,updatedAt:A},h.planProducts=R,h},"v2:plan-products:takeover"),ce.success(`Plan-Produkt wurde als Live-SKU ${t} übernommen und archiviert.`),E(!1),$(null),I(""),window.location.hash=`#/v2/products?source=plan-products&sku=${encodeURIComponent(t)}`}const N=i.useMemo(()=>O.map(e=>({...e,monthPreview:C.slice(0,3).map(t=>{var s;return`${ie(t)}: ${k((s=e.unitsByMonth)==null?void 0:s[t],0)}`}).join(" · ")})),[C,O]);return n.jsxs("div",{className:"v2-page",children:[n.jsxs(Pe,{className:"v2-intro-card",children:[n.jsxs("div",{className:"v2-page-head",children:[n.jsxs("div",{children:[n.jsx(Ee,{level:3,children:"Neue Produkte (Plan-Produkte)"}),n.jsx(Me,{children:"Pre-SKU Produkte mit Referenzmonat-Baseline und übernommener Saisonalität aus bestehender SKU. Monats-Units werden automatisch über den Forecast-Horizont berechnet."})]}),n.jsx(V,{children:n.jsx(q,{type:"primary",onClick:me,children:"Plan-Produkt hinzufügen"})})]}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsxs(S,{color:"blue",children:["Plan-Produkte: ",O.length]}),n.jsxs(S,{color:"green",children:["Aktiv: ",O.filter(e=>String(e.status||"")==="active").length]}),n.jsxs(S,{children:["Horizont: ",C.length," Monate"]}),c?n.jsx(S,{color:"processing",children:"Speichern..."}):null,u?n.jsxs(S,{color:"green",children:["Gespeichert: ",new Date(u).toLocaleTimeString("de-DE")]}):null]})})]}),o?n.jsx(oe,{type:"error",showIcon:!0,message:o}):null,a?n.jsx(oe,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsx(Pe,{children:n.jsx(we,{rowKey:e=>String(e.id||e.key||""),size:"small",pagination:!1,scroll:{x:"max-content"},dataSource:N,columns:[{title:"Alias",dataIndex:"alias",key:"alias",sorter:(e,t)=>String(e.alias||"").localeCompare(String(t.alias||""),"de-DE"),render:e=>n.jsxs(V,{size:6,children:[n.jsx(S,{color:"blue",children:"Plan"}),n.jsx(G,{strong:!0,children:e||"—"})]})},{title:"Pre-SKU",dataIndex:"plannedSku",key:"plannedSku",sorter:(e,t)=>String(e.plannedSku||"").localeCompare(String(t.plannedSku||""),"de-DE"),render:e=>e||n.jsx(G,{type:"secondary",children:"ohne SKU"})},{title:"Relation",dataIndex:"relationType",key:"relationType",sorter:(e,t)=>String(e.relationType||"").localeCompare(String(t.relationType||""),"de-DE"),render:e=>Ue[e]||e||"—"},{title:"Bucket",dataIndex:"portfolioBucket",key:"portfolioBucket",sorter:(e,t)=>String(e.portfolioBucket||"").localeCompare(String(t.portfolioBucket||""),"de-DE"),render:e=>n.jsx(S,{color:e===H.CORE?"green":e===H.PLAN?"gold":"blue",children:e||H.PLAN})},{title:"Forecast",dataIndex:"includeInForecast",key:"includeInForecast",sorter:(e,t)=>+!!e.includeInForecast-+!!t.includeInForecast,render:e=>e===!1?n.jsx(S,{children:"Nein"}):n.jsx(S,{color:"green",children:"Ja"})},{title:"Baseline",key:"baseline",sorter:(e,t)=>Number(l(e.baselineUnitsInReferenceMonth)||0)-Number(l(t.baselineUnitsInReferenceMonth)||0),render:(e,t)=>n.jsxs("span",{children:[le(t.baselineReferenceMonth)," · ",k(t.baselineUnitsInReferenceMonth,0)," Units"]})},{title:"Saisonalität von",dataIndex:"seasonalityReferenceSku",key:"seasonalityReferenceSku",sorter:(e,t)=>String(e.seasonalityReferenceSku||"").localeCompare(String(t.seasonalityReferenceSku||""),"de-DE"),render:e=>e||"—"},{title:"Preis (EUR)",dataIndex:"avgSellingPriceGrossEUR",key:"avgSellingPriceGrossEUR",align:"right",sorter:(e,t)=>Number(l(e.avgSellingPriceGrossEUR)||0)-Number(l(t.avgSellingPriceGrossEUR)||0),render:e=>k(e,2)},{title:"Brutto-Marge %",dataIndex:"sellerboardMarginPct",key:"sellerboardMarginPct",align:"right",sorter:(e,t)=>Number(l(e.sellerboardMarginPct)||0)-Number(l(t.sellerboardMarginPct)||0),render:e=>k(e,2)},{title:"Launch & Ramp",key:"launchRamp",sorter:(e,t)=>String(e.launchDate||"").localeCompare(String(t.launchDate||"")),render:(e,t)=>n.jsxs("span",{children:[String(t.launchDate||"—")," · ",k(l(t.rampUpWeeks),0),"W · Start ",k(l(t.softLaunchStartSharePct),0),"%"]})},{title:"Vorschau (Next 3)",dataIndex:"monthPreview",key:"monthPreview",sorter:(e,t)=>String(e.monthPreview||"").localeCompare(String(t.monthPreview||""),"de-DE")},{title:"Status",dataIndex:"status",key:"status",sorter:(e,t)=>String(e.status||"").localeCompare(String(t.status||""),"de-DE"),render:(e,t)=>{if(e==="archived"){const s=String(t.mappedSku||t.plannedSku||"");return n.jsxs(V,{direction:"vertical",size:2,children:[n.jsx(S,{children:"Archiviert"}),s?n.jsxs(G,{type:"secondary",children:["Live-SKU: ",s]}):null]})}return e==="draft"?n.jsx(S,{color:"gold",children:"Draft"}):n.jsx(S,{color:"green",children:"Aktiv"})}},{title:"Aktionen",key:"actions",render:(e,t)=>n.jsxs(V,{size:6,children:[n.jsx(q,{size:"small",onClick:()=>ee(t),children:"Bearbeiten"}),n.jsx(q,{size:"small",type:"primary",ghost:!0,onClick:()=>fe(t),disabled:String(t.status||"")==="archived",children:"Als gelauncht markieren"}),n.jsx(_e,{title:"Plan-Produkt löschen?",onConfirm:()=>{pe(String(t.id||""))},children:n.jsx(q,{size:"small",danger:!0,children:"Löschen"})})]})}],locale:{emptyText:"Noch keine Plan-Produkte angelegt."}})}),n.jsxs(Ne,{title:g?"Plan-Produkt bearbeiten":"Plan-Produkt anlegen",rootClassName:"v2-form-modal",open:j,onCancel:()=>{y(!1),w(null),x.resetFields()},onOk:()=>{x.validateFields().then(e=>he(e)).catch(()=>{})},width:980,children:[n.jsxs(d,{form:x,layout:"vertical",children:[n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:"alias",label:"Alias",rules:[{required:!0,message:"Alias ist erforderlich."}],children:n.jsx(te,{placeholder:"z. B. Messerblock Premium"})}),n.jsx(d.Item,{name:"plannedSku",label:"Planned SKU (optional)",children:n.jsx(te,{placeholder:"optional, falls intern bereits vergeben"})}),n.jsx(d.Item,{name:"portfolioBucket",label:"Portfolio Bucket",initialValue:H.PLAN,children:n.jsx(L,{options:Qe.map(e=>({value:e,label:e}))})}),n.jsx(d.Item,{name:"status",label:"Status",initialValue:"active",children:n.jsx(L,{options:[{value:"active",label:"Aktiv"},{value:"draft",label:"Draft"},{value:"archived",label:"Archiviert"}]})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(d.Item,{name:"includeInForecast",valuePropName:"checked",initialValue:!0,children:n.jsx(un,{children:"Im Forecast berücksichtigen"})})}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:"relationType",label:"Relation",rules:[{required:!0}],children:n.jsx(L,{options:Le.map(e=>({value:e,label:Ue[e]||e}))})}),n.jsx(d.Item,{name:"categoryId",label:"Kategorie",children:n.jsx(L,{allowClear:!0,options:re.map(e=>({value:e.id,label:e.name}))})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:"avgSellingPriceGrossEUR",label:"Preis (EUR) für Revenue",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0?Promise.resolve():Promise.reject(new Error("Preis ist erforderlich."))}}],children:n.jsx(Z,{mode:"decimal",min:0})}),n.jsx(d.Item,{name:"sellerboardMarginPct",label:"Brutto-Marge (%)",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0&&s<=100?Promise.resolve():Promise.reject(new Error("Marge muss > 0 und <= 100 sein."))}}],children:n.jsx(Z,{mode:"percent",min:0,max:100})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:"baselineReferenceMonth",label:"Referenzmonat",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>=1&&s<=12?Promise.resolve():Promise.reject(new Error("Referenzmonat ist erforderlich."))}}],children:n.jsx(L,{options:Array.from({length:12},(e,t)=>({value:t+1,label:`${le(t+1)} (${t+1})`}))})}),n.jsx(d.Item,{name:"baselineUnitsInReferenceMonth",label:"Baseline Units im Referenzmonat",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0?Promise.resolve():Promise.reject(new Error("Baseline Units sind erforderlich."))}}],children:n.jsx(Z,{mode:"int",min:0})}),n.jsx(d.Item,{name:"seasonalityReferenceSku",label:"Saisonalität übernehmen von SKU",rules:[{validator:(e,t)=>(m==null?void 0:m.includeInForecast)===!1||String(t||"").trim()?Promise.resolve():Promise.reject(new Error("Referenz-SKU ist erforderlich."))}],children:n.jsx(L,{showSearch:!0,optionFilterProp:"label",options:Y})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(d.Item,{name:"baselineReferenceSku",label:"Baseline-Referenz-SKU (optional)",children:n.jsx(L,{allowClear:!0,showSearch:!0,optionFilterProp:"label",options:Y})})}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:"launchDate",label:"Launch-Datum",rules:[{required:!0,message:"Launch-Datum ist erforderlich."}],children:n.jsx(te,{type:"date"})}),n.jsx(d.Item,{name:"rampUpWeeks",label:"Ramp-up (Wochen)",rules:[{required:!0,message:"Ramp-up Wochen sind erforderlich."}],children:n.jsx(Z,{mode:"int",min:1})}),n.jsx(d.Item,{name:"softLaunchStartSharePct",label:"Soft-Launch Start (%)",extra:"Startniveau am Launch-Tag. 0 = Start bei 0 %, 20 = Start bei 20 %.",children:n.jsx(Z,{mode:"percent",min:0,max:100})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx("div",{style:{gridColumn:"1 / -1"},children:n.jsx(d.List,{name:"launchCosts",children:(e,{add:t,remove:s})=>n.jsxs(V,{direction:"vertical",style:{width:"100%"},children:[e.map(p=>n.jsxs("div",{className:"v2-form-row",children:[n.jsx(d.Item,{name:[p.name,"type"],label:"Launch-Kosten Typ",style:{minWidth:180,flex:1},rules:[{required:!0,message:"Typ fehlt."}],children:n.jsx(L,{options:en.map(h=>({value:h,label:h}))})}),n.jsx(d.Item,{name:[p.name,"amountEur"],label:"Betrag (EUR)",style:{minWidth:160,flex:1},rules:[{required:!0,message:"Betrag fehlt."}],children:n.jsx(Z,{mode:"decimal",min:0})}),n.jsx(d.Item,{name:[p.name,"date"],label:"Datum",style:{minWidth:170},rules:[{required:!0,message:"Datum fehlt."}],children:n.jsx(te,{type:"date"})}),n.jsx(d.Item,{name:[p.name,"note"],label:"Notiz",style:{flex:2},children:n.jsx(te,{placeholder:"Optional"})}),n.jsx(d.Item,{style:{marginTop:30},children:n.jsx(q,{danger:!0,onClick:()=>s(p.name),children:"Entfernen"})})]},p.key)),n.jsx(q,{onClick:()=>t({type:"Sonstiges",amountEur:null,currency:"EUR",date:"",note:""}),children:"Launch-Kosten hinzufügen"})]})})})})]}),n.jsxs(Pe,{size:"small",children:[n.jsx(Ee,{level:5,children:"Forecast-Vorschau (berechnet)"}),n.jsx(Me,{type:"secondary",children:"Monatswerte werden aus Baseline im Referenzmonat, dem Saisonalitätsprofil der gewählten Referenz-SKU und einer taggenauen Launch-/Ramp-Aggregation berechnet."}),b!=null&&b.seasonality?n.jsxs(n.Fragment,{children:[n.jsxs(V,{wrap:!0,style:{marginBottom:8},children:[n.jsxs(S,{color:"blue",children:["Baseline: ",le(b.baselineReferenceMonth)," · ",k(b.baselineUnitsInReferenceMonth,0)," Units"]}),n.jsxs(S,{color:"green",children:["Referenz-SKU: ",b.seasonalityReferenceSku]}),n.jsxs(S,{color:"purple",children:["Launch: ",String(b.launchDate||"—")," · Ramp: ",k(l(b.rampUpWeeks),0),"W · Start: ",k(l(b.softLaunchStartSharePct),0),"%"]}),n.jsxs(S,{children:["Zeitraum: ",ie(b.seasonality.startMonth)," bis ",ie(b.seasonality.endMonth)]}),X?n.jsxs(S,{color:"purple",children:["Orientierung: ",X.sku," hat in ",le(X.baselineMonth)," im Schnitt ",k(X.monthAverageUnits,0)," Units"]}):null]}),n.jsx(we,{size:"small",pagination:!1,rowKey:e=>String(e.month||""),dataSource:C.map(e=>{var t,s,p,h;return{month:e,baseUnits:(t=b.baseUnitsByMonth)==null?void 0:t[e],rampFactor:(s=b.rampFactorByMonth)==null?void 0:s[e],units:(p=b.unitsByMonth)==null?void 0:p[e],revenue:(h=b.revenueByMonth)==null?void 0:h[e]}}),columns:[{title:"Monat",dataIndex:"month",key:"month",sorter:(e,t)=>String(e.month||"").localeCompare(String(t.month||"")),render:e=>ie(e)},{title:"Base Units",dataIndex:"baseUnits",key:"baseUnits",align:"right",sorter:(e,t)=>Number(l(e.baseUnits)||0)-Number(l(t.baseUnits)||0),render:e=>k(l(e),2)},{title:"Ramp-Faktor",dataIndex:"rampFactor",key:"rampFactor",align:"right",sorter:(e,t)=>Number(l(e.rampFactor)||0)-Number(l(t.rampFactor)||0),render:e=>k(l(e),2)},{title:"Units (Plan)",dataIndex:"units",key:"units",align:"right",sorter:(e,t)=>Number(l(e.units)||0)-Number(l(t.units)||0),render:e=>k(e,0)},{title:"Revenue (Plan)",dataIndex:"revenue",key:"revenue",align:"right",sorter:(e,t)=>Number(l(e.revenue)||0)-Number(l(t.revenue)||0),render:e=>k(e,2)}]})]}):n.jsx(oe,{type:"warning",showIcon:!0,message:"Saisonalitätsprofil noch nicht ableitbar",description:"Für die gewählte Referenz-SKU liegen noch keine verwertbaren Forecast-Monatswerte vor."})]})]}),n.jsx(Ne,{title:"Plan-Produkt in Live-SKU übernehmen",open:_,onCancel:()=>{E(!1),$(null),I("")},onOk:()=>{P().catch(e=>{ce.error(e instanceof Error?e.message:String(e))})},children:n.jsxs(V,{direction:"vertical",style:{width:"100%"},children:[n.jsx(oe,{type:"info",showIcon:!0,message:"Plan wird archiviert, Mapping bleibt für Plan-vs-Ist erhalten.",description:"Nach der Übernahme zählt im operativen Forecast/Cashflow nur noch die Live-SKU (CSV)."}),n.jsxs("div",{children:[n.jsx(G,{strong:!0,children:"Plan-Produkt: "}),n.jsx(G,{children:(T==null?void 0:T.alias)||"—"})]}),n.jsxs("div",{children:[n.jsx(G,{strong:!0,children:"Aktueller Status: "}),n.jsx(G,{children:(T==null?void 0:T.status)||"—"})]}),n.jsx(L,{value:U||void 0,showSearch:!0,optionFilterProp:"label",placeholder:"Live-SKU auswählen",options:Y,onChange:e=>I(String(e||""))})]})})]})}export{Bn as default};
