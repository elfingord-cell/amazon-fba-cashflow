const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-calendar-timeline.es-Ct5WWIrY.js","assets/index-elUAAuqx.js","assets/index-D5HC5bcp.css"])))=>i.map(i=>d[i]);
import{am as At,t as o,$ as ft,a9 as Tn,an as Rn,ao as ps,ap as Xe,aq as _e,ar as ce,aa as bn,as as lr,at as $t,a1 as mn,au as fn,av as gs,aw as vs,ax as xn,ay as it,az as ys,aA as za,aB as ra,aC as qn,aD as bs,aE as Ss,a2 as Ya,aF as Ds,ab as Gr,aG as Je,aH as Dr,aI as xs,ag as Cs,aJ as Ms,aK as ks,aL as Ps,aM as ws,Q as js,aN as Ns,aO as Is,ad as pa,aP as Es,aQ as Ts,aR as Rs,aS as $s,aT as Os,aU as Fs,aV as As,aW as ga,aX as aa,a0 as Ls,L as Ie,V as Wa,aY as Ka,aZ as qa,a_ as Va,a$ as Za,b0 as Ga,b1 as Xa,W as Qa,b2 as Ja,b3 as ei,b4 as ti,b5 as ni,b6 as ri,b7 as ai,_ as Us,k as n,I as kt,J as Nn,a5 as ia,K as Cr,a6 as ii,a3 as Se,a7 as si,a8 as oi,S as qe,a4 as Rt,P as dn,M as mt,O as gt,T as li}from"./index-elUAAuqx.js";import{T as ui}from"./TanStackGrid-BrER4EZn.js";import{D as vt}from"./DeNumberInput-Bxwtbnq1.js";import{S as ci}from"./SkuAliasCell-D6R1hwy5.js";import{n as di,m as mi,f as _s}from"./months-DiLwPhVv.js";import{a as Hs}from"./forecastVersioning-c8wz3TkU.js";import{r as In,a as ar,s as Zt,b as fi}from"./productCompletenessV2-C6U-GVjR.js";import{u as Mr,C as It,T as Bs}from"./workspace-DMXjunb_.js";import{u as hi}from"./modalCollaboration-Dztfojnp.js";import{e as zs,b as br,g as va,f as ya,r as Ir,n as wn,i as qt,h as Er,d as Ys,j as ba,F as Ws,T as Ks,I as qs,P as Vs,k as kn,l as Zs,m as vn,o as Gs,s as Xs,p as Qs,a as Wn,q as Js,c as or,t as Vt,u as zt,v as eo,w as Sa}from"./orderUtils-BfaSmxZO.js";import{C as Qt}from"./index-CVrItAb4.js";import{s as Jt}from"./index-4z8CX_jA.js";import{S as sa}from"./index-7FjmYHU5.js";import{g as to,a as no,i as Da,u as ro,S as Dt}from"./index-BytK8p14.js";import{b as Tr,n as Rr,i as Xr,a as ao}from"./orderEditorFactory-hbPkdMRR.js";import{b as io,c as pi}from"./categoryOrder-C77cYWrY.js";import{r as so,a as oo}from"./phantomFo-C1P5_prX.js";import"./index-DChuXDnn.js";import"./Dropdown-onqalcmq.js";import"./foSuggestion-Ck1952gl.js";import"./useBubbleLock-DQn9hN27.js";import"./store-BfTg1Dl2.js";import"./prefill-Q3SvZbkG.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-CFkOROtn.js";import"./abcClassification-BRLNgmfY.js";import"./inventoryProjection-xbzaWWBa.js";function gi(e,...t){const r=e||{};return t.reduce((a,i)=>(Object.keys(i||{}).forEach(u=>{const c=r[u],d=i[u];if(c&&typeof c=="object")if(d&&typeof d=="object")a[u]=gi(c,a[u],d);else{const{_default:p}=c;p&&(a[u]=a[u]||{},a[u][p]=ft(a[u][p],d))}else a[u]=ft(a[u],d)}),a),{})}function lo(e,...t){return o.useMemo(()=>gi.apply(void 0,[e].concat(t)),[t,e])}function uo(...e){return o.useMemo(()=>e.reduce((t,r={})=>(Object.keys(r).forEach(a=>{t[a]=Object.assign(Object.assign({},t[a]),r[a])}),t),{}),[e])}function Qr(e,t){const r=Object.assign({},e);return Object.keys(t).forEach(a=>{if(a!=="_default"){const i=t[a],u=r[a]||{};r[a]=i?Qr(u,i):u}}),r}const co=(e,t,r)=>{const a=lo.apply(void 0,[r].concat(At(e))),i=uo.apply(void 0,At(t));return o.useMemo(()=>[Qr(a,r),Qr(i,r)],[a,i,r])};var vi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){var r=1e3,a=6e4,i=36e5,u="millisecond",c="second",d="minute",p="hour",v="day",h="week",y="month",M="quarter",N="year",P="date",$="Invalid Date",S=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,w=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,F={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var g=["th","st","nd","rd"],k=D%100;return"["+D+(g[(k-20)%10]||g[k]||g[0])+"]"}},E=function(D,g,k){var L=String(D);return!L||L.length>=g?D:""+Array(g+1-L.length).join(k)+D},j={s:E,z:function(D){var g=-D.utcOffset(),k=Math.abs(g),L=Math.floor(k/60),R=k%60;return(g<=0?"+":"-")+E(L,2,"0")+":"+E(R,2,"0")},m:function D(g,k){if(g.date()<k.date())return-D(k,g);var L=12*(k.year()-g.year())+(k.month()-g.month()),R=g.clone().add(L,y),H=k-R<0,B=g.clone().add(L+(H?-1:1),y);return+(-(L+(k-R)/(H?R-B:B-R))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:y,y:N,w:h,d:v,D:P,h:p,m:d,s:c,ms:u,Q:M}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},K="en",U={};U[K]=F;var _="$isDayjsObject",X=function(D){return D instanceof G||!(!D||!D[_])},ne=function D(g,k,L){var R;if(!g)return K;if(typeof g=="string"){var H=g.toLowerCase();U[H]&&(R=H),k&&(U[H]=k,R=H);var B=g.split("-");if(!R&&B.length>1)return D(B[0])}else{var z=g.name;U[z]=g,R=z}return!L&&R&&(K=R),R||!L&&K},q=function(D,g){if(X(D))return D.clone();var k=typeof g=="object"?g:{};return k.date=D,k.args=arguments,new G(k)},A=j;A.l=ne,A.i=X,A.w=function(D,g){return q(D,{locale:g.$L,utc:g.$u,x:g.$x,$offset:g.$offset})};var G=function(){function D(k){this.$L=ne(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[_]=!0}var g=D.prototype;return g.parse=function(k){this.$d=function(L){var R=L.date,H=L.utc;if(R===null)return new Date(NaN);if(A.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var B=R.match(S);if(B){var z=B[2]-1||0,b=(B[7]||"0").substring(0,3);return H?new Date(Date.UTC(B[1],z,B[3]||1,B[4]||0,B[5]||0,B[6]||0,b)):new Date(B[1],z,B[3]||1,B[4]||0,B[5]||0,B[6]||0,b)}}return new Date(R)}(k),this.init()},g.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},g.$utils=function(){return A},g.isValid=function(){return this.$d.toString()!==$},g.isSame=function(k,L){var R=q(k);return this.startOf(L)<=R&&R<=this.endOf(L)},g.isAfter=function(k,L){return q(k)<this.startOf(L)},g.isBefore=function(k,L){return this.endOf(L)<q(k)},g.$g=function(k,L,R){return A.u(k)?this[L]:this.set(R,k)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(k,L){var R=this,H=!!A.u(L)||L,B=A.p(k),z=function(me,se){var Q=A.w(R.$u?Date.UTC(R.$y,se,me):new Date(R.$y,se,me),R);return H?Q:Q.endOf(v)},b=function(me,se){return A.w(R.toDate()[me].apply(R.toDate("s"),(H?[0,0,0,0]:[23,59,59,999]).slice(se)),R)},W=this.$W,O=this.$M,ae=this.$D,J="set"+(this.$u?"UTC":"");switch(B){case N:return H?z(1,0):z(31,11);case y:return H?z(1,O):z(0,O+1);case h:var Y=this.$locale().weekStart||0,oe=(W<Y?W+7:W)-Y;return z(H?ae-oe:ae+(6-oe),O);case v:case P:return b(J+"Hours",0);case p:return b(J+"Minutes",1);case d:return b(J+"Seconds",2);case c:return b(J+"Milliseconds",3);default:return this.clone()}},g.endOf=function(k){return this.startOf(k,!1)},g.$set=function(k,L){var R,H=A.p(k),B="set"+(this.$u?"UTC":""),z=(R={},R[v]=B+"Date",R[P]=B+"Date",R[y]=B+"Month",R[N]=B+"FullYear",R[p]=B+"Hours",R[d]=B+"Minutes",R[c]=B+"Seconds",R[u]=B+"Milliseconds",R)[H],b=H===v?this.$D+(L-this.$W):L;if(H===y||H===N){var W=this.clone().set(P,1);W.$d[z](b),W.init(),this.$d=W.set(P,Math.min(this.$D,W.daysInMonth())).$d}else z&&this.$d[z](b);return this.init(),this},g.set=function(k,L){return this.clone().$set(k,L)},g.get=function(k){return this[A.p(k)]()},g.add=function(k,L){var R,H=this;k=Number(k);var B=A.p(L),z=function(O){var ae=q(H);return A.w(ae.date(ae.date()+Math.round(O*k)),H)};if(B===y)return this.set(y,this.$M+k);if(B===N)return this.set(N,this.$y+k);if(B===v)return z(1);if(B===h)return z(7);var b=(R={},R[d]=a,R[p]=i,R[c]=r,R)[B]||1,W=this.$d.getTime()+k*b;return A.w(W,this)},g.subtract=function(k,L){return this.add(-1*k,L)},g.format=function(k){var L=this,R=this.$locale();if(!this.isValid())return R.invalidDate||$;var H=k||"YYYY-MM-DDTHH:mm:ssZ",B=A.z(this),z=this.$H,b=this.$m,W=this.$M,O=R.weekdays,ae=R.months,J=R.meridiem,Y=function(se,Q,xe,pe){return se&&(se[Q]||se(L,H))||xe[Q].slice(0,pe)},oe=function(se){return A.s(z%12||12,se,"0")},me=J||function(se,Q,xe){var pe=se<12?"AM":"PM";return xe?pe.toLowerCase():pe};return H.replace(w,function(se,Q){return Q||function(xe){switch(xe){case"YY":return String(L.$y).slice(-2);case"YYYY":return A.s(L.$y,4,"0");case"M":return W+1;case"MM":return A.s(W+1,2,"0");case"MMM":return Y(R.monthsShort,W,ae,3);case"MMMM":return Y(ae,W);case"D":return L.$D;case"DD":return A.s(L.$D,2,"0");case"d":return String(L.$W);case"dd":return Y(R.weekdaysMin,L.$W,O,2);case"ddd":return Y(R.weekdaysShort,L.$W,O,3);case"dddd":return O[L.$W];case"H":return String(z);case"HH":return A.s(z,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return me(z,b,!0);case"A":return me(z,b,!1);case"m":return String(b);case"mm":return A.s(b,2,"0");case"s":return String(L.$s);case"ss":return A.s(L.$s,2,"0");case"SSS":return A.s(L.$ms,3,"0");case"Z":return B}return null}(se)||B.replace(":","")})},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(k,L,R){var H,B=this,z=A.p(L),b=q(k),W=(b.utcOffset()-this.utcOffset())*a,O=this-b,ae=function(){return A.m(B,b)};switch(z){case N:H=ae()/12;break;case y:H=ae();break;case M:H=ae()/3;break;case h:H=(O-W)/6048e5;break;case v:H=(O-W)/864e5;break;case p:H=O/i;break;case d:H=O/a;break;case c:H=O/r;break;default:H=O}return R?H:A.a(H)},g.daysInMonth=function(){return this.endOf(y).$D},g.$locale=function(){return U[this.$L]},g.locale=function(k,L){if(!k)return this.$L;var R=this.clone(),H=ne(k,L,!0);return H&&(R.$L=H),R},g.clone=function(){return A.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},D}(),T=G.prototype;return q.prototype=T,[["$ms",u],["$s",c],["$m",d],["$H",p],["$W",v],["$M",y],["$y",N],["$D",P]].forEach(function(D){T[D[1]]=function(g){return this.$g(g,D[0],D[1])}}),q.extend=function(D,g){return D.$i||(D(g,G,q),D.$i=!0),q},q.locale=ne,q.isDayjs=X,q.unix=function(D){return q(1e3*D)},q.en=U[K],q.Ls=U,q.p={},q})})(vi);var mo=vi.exports;const Pt=Tn(mo);var yi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){return function(r,a){a.prototype.weekday=function(i){var u=this.$locale().weekStart||0,c=this.$W,d=(c<u?c+7:c)-u;return this.$utils().u(i)?d:this.subtract(d,"day").add(i,"day")}}})})(yi);var fo=yi.exports;const ho=Tn(fo);var bi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){return function(r,a,i){var u=a.prototype,c=function(y){return y&&(y.indexOf?y:y.s)},d=function(y,M,N,P,$){var S=y.name?y:y.$locale(),w=c(S[M]),F=c(S[N]),E=w||F.map(function(K){return K.slice(0,P)});if(!$)return E;var j=S.weekStart;return E.map(function(K,U){return E[(U+(j||0))%7]})},p=function(){return i.Ls[i.locale()]},v=function(y,M){return y.formats[M]||function(N){return N.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(P,$,S){return $||S.slice(1)})}(y.formats[M.toUpperCase()])},h=function(){var y=this;return{months:function(M){return M?M.format("MMMM"):d(y,"months")},monthsShort:function(M){return M?M.format("MMM"):d(y,"monthsShort","months",3)},firstDayOfWeek:function(){return y.$locale().weekStart||0},weekdays:function(M){return M?M.format("dddd"):d(y,"weekdays")},weekdaysMin:function(M){return M?M.format("dd"):d(y,"weekdaysMin","weekdays",2)},weekdaysShort:function(M){return M?M.format("ddd"):d(y,"weekdaysShort","weekdays",3)},longDateFormat:function(M){return v(y.$locale(),M)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};u.localeData=function(){return h.bind(this)()},i.localeData=function(){var y=p();return{firstDayOfWeek:function(){return y.weekStart||0},weekdays:function(){return i.weekdays()},weekdaysShort:function(){return i.weekdaysShort()},weekdaysMin:function(){return i.weekdaysMin()},months:function(){return i.months()},monthsShort:function(){return i.monthsShort()},longDateFormat:function(M){return v(y,M)},meridiem:y.meridiem,ordinal:y.ordinal}},i.months=function(){return d(p(),"months")},i.monthsShort=function(){return d(p(),"monthsShort","months",3)},i.weekdays=function(y){return d(p(),"weekdays",null,null,y)},i.weekdaysShort=function(y){return d(p(),"weekdaysShort","weekdays",3,y)},i.weekdaysMin=function(y){return d(p(),"weekdaysMin","weekdays",2,y)}}})})(bi);var po=bi.exports;const go=Tn(po);var Si={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){var r="week",a="year";return function(i,u,c){var d=u.prototype;d.week=function(p){if(p===void 0&&(p=null),p!==null)return this.add(7*(p-this.week()),"day");var v=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var h=c(this).startOf(a).add(1,a).date(v),y=c(this).endOf(r);if(h.isBefore(y))return 1}var M=c(this).startOf(a).date(v).startOf(r).subtract(1,"millisecond"),N=this.diff(M,r,!0);return N<0?c(this).startOf("week").week():Math.ceil(N)},d.weeks=function(p){return p===void 0&&(p=null),this.week(p)}}})})(Si);var vo=Si.exports;const yo=Tn(vo);var Di={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){return function(r,a){a.prototype.weekYear=function(){var i=this.month(),u=this.week(),c=this.year();return u===1&&i===11?c+1:i===0&&u>=52?c-1:c}}})})(Di);var bo=Di.exports;const So=Tn(bo);var xi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){return function(r,a){var i=a.prototype,u=i.format;i.format=function(c){var d=this,p=this.$locale();if(!this.isValid())return u.bind(this)(c);var v=this.$utils(),h=(c||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(y){switch(y){case"Q":return Math.ceil((d.$M+1)/3);case"Do":return p.ordinal(d.$D);case"gggg":return d.weekYear();case"GGGG":return d.isoWeekYear();case"wo":return p.ordinal(d.week(),"W");case"w":case"ww":return v.s(d.week(),y==="w"?1:2,"0");case"W":case"WW":return v.s(d.isoWeek(),y==="W"?1:2,"0");case"k":case"kk":return v.s(String(d.$H===0?24:d.$H),y==="k"?1:2,"0");case"X":return Math.floor(d.$d.getTime()/1e3);case"x":return d.$d.getTime();case"z":return"["+d.offsetName()+"]";case"zzz":return"["+d.offsetName("long")+"]";default:return y}});return u.bind(this)(h)}}})})(xi);var Do=xi.exports;const xo=Tn(Do);var Ci={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Rn,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},a=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,i=/\d/,u=/\d\d/,c=/\d\d?/,d=/\d*[^-_:/,()\s\d]+/,p={},v=function(S){return(S=+S)+(S>68?1900:2e3)},h=function(S){return function(w){this[S]=+w}},y=[/[+-]\d\d:?(\d\d)?|Z/,function(S){(this.zone||(this.zone={})).offset=function(w){if(!w||w==="Z")return 0;var F=w.match(/([+-]|\d\d)/g),E=60*F[1]+(+F[2]||0);return E===0?0:F[0]==="+"?-E:E}(S)}],M=function(S){var w=p[S];return w&&(w.indexOf?w:w.s.concat(w.f))},N=function(S,w){var F,E=p.meridiem;if(E){for(var j=1;j<=24;j+=1)if(S.indexOf(E(j,0,w))>-1){F=j>12;break}}else F=S===(w?"pm":"PM");return F},P={A:[d,function(S){this.afternoon=N(S,!1)}],a:[d,function(S){this.afternoon=N(S,!0)}],Q:[i,function(S){this.month=3*(S-1)+1}],S:[i,function(S){this.milliseconds=100*+S}],SS:[u,function(S){this.milliseconds=10*+S}],SSS:[/\d{3}/,function(S){this.milliseconds=+S}],s:[c,h("seconds")],ss:[c,h("seconds")],m:[c,h("minutes")],mm:[c,h("minutes")],H:[c,h("hours")],h:[c,h("hours")],HH:[c,h("hours")],hh:[c,h("hours")],D:[c,h("day")],DD:[u,h("day")],Do:[d,function(S){var w=p.ordinal,F=S.match(/\d+/);if(this.day=F[0],w)for(var E=1;E<=31;E+=1)w(E).replace(/\[|\]/g,"")===S&&(this.day=E)}],w:[c,h("week")],ww:[u,h("week")],M:[c,h("month")],MM:[u,h("month")],MMM:[d,function(S){var w=M("months"),F=(M("monthsShort")||w.map(function(E){return E.slice(0,3)})).indexOf(S)+1;if(F<1)throw new Error;this.month=F%12||F}],MMMM:[d,function(S){var w=M("months").indexOf(S)+1;if(w<1)throw new Error;this.month=w%12||w}],Y:[/[+-]?\d+/,h("year")],YY:[u,function(S){this.year=v(S)}],YYYY:[/\d{4}/,h("year")],Z:y,ZZ:y};function $(S){var w,F;w=S,F=p&&p.formats;for(var E=(S=w.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(q,A,G){var T=G&&G.toUpperCase();return A||F[G]||r[G]||F[T].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(D,g,k){return g||k.slice(1)})})).match(a),j=E.length,K=0;K<j;K+=1){var U=E[K],_=P[U],X=_&&_[0],ne=_&&_[1];E[K]=ne?{regex:X,parser:ne}:U.replace(/^\[|\]$/g,"")}return function(q){for(var A={},G=0,T=0;G<j;G+=1){var D=E[G];if(typeof D=="string")T+=D.length;else{var g=D.regex,k=D.parser,L=q.slice(T),R=g.exec(L)[0];k.call(A,R),q=q.replace(R,"")}}return function(H){var B=H.afternoon;if(B!==void 0){var z=H.hours;B?z<12&&(H.hours+=12):z===12&&(H.hours=0),delete H.afternoon}}(A),A}}return function(S,w,F){F.p.customParseFormat=!0,S&&S.parseTwoDigitYear&&(v=S.parseTwoDigitYear);var E=w.prototype,j=E.parse;E.parse=function(K){var U=K.date,_=K.utc,X=K.args;this.$u=_;var ne=X[1];if(typeof ne=="string"){var q=X[2]===!0,A=X[3]===!0,G=q||A,T=X[2];A&&(T=X[2]),p=this.$locale(),!q&&T&&(p=F.Ls[T]),this.$d=function(L,R,H,B){try{if(["x","X"].indexOf(R)>-1)return new Date((R==="X"?1e3:1)*L);var z=$(R)(L),b=z.year,W=z.month,O=z.day,ae=z.hours,J=z.minutes,Y=z.seconds,oe=z.milliseconds,me=z.zone,se=z.week,Q=new Date,xe=O||(b||W?1:Q.getDate()),pe=b||Q.getFullYear(),Ce=0;b&&!W||(Ce=W>0?W-1:Q.getMonth());var we,fe=ae||0,ye=J||0,re=Y||0,$e=oe||0;return me?new Date(Date.UTC(pe,Ce,xe,fe,ye,re,$e+60*me.offset*1e3)):H?new Date(Date.UTC(pe,Ce,xe,fe,ye,re,$e)):(we=new Date(pe,Ce,xe,fe,ye,re,$e),se&&(we=B(we).week(se).toDate()),we)}catch{return new Date("")}}(U,ne,_,F),this.init(),T&&T!==!0&&(this.$L=this.locale(T).$L),G&&U!=this.format(ne)&&(this.$d=new Date("")),p={}}else if(ne instanceof Array)for(var D=ne.length,g=1;g<=D;g+=1){X[1]=ne[g-1];var k=F.apply(this,X);if(k.isValid()){this.$d=k.$d,this.$L=k.$L,this.init();break}g===D&&(this.$d=new Date(""))}else j.call(this,K)}}})})(Ci);var Co=Ci.exports;const Mo=Tn(Co);Pt.extend(Mo);Pt.extend(xo);Pt.extend(ho);Pt.extend(go);Pt.extend(yo);Pt.extend(So);Pt.extend(function(e,t){var r=t.prototype,a=r.format;r.format=function(u){var c=(u||"").replace("Wo","wo");return a.bind(this)(c)}});var ko={bn_BD:"bn-bd",by_BY:"be",en_GB:"en-gb",en_US:"en",fr_BE:"fr",fr_CA:"fr-ca",hy_AM:"hy-am",kmr_IQ:"ku",nl_BE:"nl-be",pt_BR:"pt-br",zh_CN:"zh-cn",zh_HK:"zh-hk",zh_TW:"zh-tw"},Pn=function(t){var r=ko[t];return r||t.split("_")[0]},Po={getNow:function(){var t=Pt();return typeof t.tz=="function"?t.tz():t},getFixedDate:function(t){return Pt(t,["YYYY-M-DD","YYYY-MM-DD"])},getEndDate:function(t){return t.endOf("month")},getWeekDay:function(t){var r=t.locale("en");return r.weekday()+r.localeData().firstDayOfWeek()},getYear:function(t){return t.year()},getMonth:function(t){return t.month()},getDate:function(t){return t.date()},getHour:function(t){return t.hour()},getMinute:function(t){return t.minute()},getSecond:function(t){return t.second()},getMillisecond:function(t){return t.millisecond()},addYear:function(t,r){return t.add(r,"year")},addMonth:function(t,r){return t.add(r,"month")},addDate:function(t,r){return t.add(r,"day")},setYear:function(t,r){return t.year(r)},setMonth:function(t,r){return t.month(r)},setDate:function(t,r){return t.date(r)},setHour:function(t,r){return t.hour(r)},setMinute:function(t,r){return t.minute(r)},setSecond:function(t,r){return t.second(r)},setMillisecond:function(t,r){return t.millisecond(r)},isAfter:function(t,r){return t.isAfter(r)},isValidate:function(t){return t.isValid()},locale:{getWeekFirstDay:function(t){return Pt().locale(Pn(t)).localeData().firstDayOfWeek()},getWeekFirstDate:function(t,r){return r.locale(Pn(t)).weekday(0)},getWeek:function(t,r){return r.locale(Pn(t)).week()},getShortWeekDays:function(t){return Pt().locale(Pn(t)).localeData().weekdaysMin()},getShortMonths:function(t){return Pt().locale(Pn(t)).localeData().monthsShort()},format:function(t,r,a){return r.locale(Pn(t)).format(a)},parse:function(t,r,a){for(var i=Pn(t),u=0;u<a.length;u+=1){var c=a[u],d=r;if(c.includes("wo")||c.includes("Wo")){for(var p=d.split("-")[0],v=d.split("-")[1],h=Pt(p,"YYYY").startOf("year").locale(i),y=0;y<=52;y+=1){var M=h.add(y,"week");if(M.format("Wo")===v)return M}return null}var N=Pt(d,c,!0).locale(i);if(N.isValid())return N}return null}}};function wo(e,t){return e!==void 0?e:t?"bottomRight":"bottomLeft"}var en=o.createContext(null),jo={bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}}};function Mi(e){var t=e.popupElement,r=e.popupStyle,a=e.popupClassName,i=e.popupAlign,u=e.transitionName,c=e.getPopupContainer,d=e.children,p=e.range,v=e.placement,h=e.builtinPlacements,y=h===void 0?jo:h,M=e.direction,N=e.visible,P=e.onClose,$=o.useContext(en),S=$.prefixCls,w="".concat(S,"-dropdown"),F=wo(v,M==="rtl");return o.createElement(ps,{showAction:[],hideAction:["click"],popupPlacement:F,builtinPlacements:y,prefixCls:w,popupTransitionName:u,popup:t,popupAlign:i,popupVisible:N,popupClassName:ft(a,Xe(Xe({},"".concat(w,"-range"),p),"".concat(w,"-rtl"),M==="rtl")),popupStyle:r,stretch:"minWidth",getPopupContainer:c,onPopupVisibleChange:function(j){j||P()}},d)}function oa(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0",a=String(e);a.length<t;)a="".concat(r).concat(a);return a}function $n(e){return e==null?[]:Array.isArray(e)?e:[e]}function ir(e,t,r){var a=At(e);return a[t]=r,a}function kr(e,t){var r={},a=t||Object.keys(e);return a.forEach(function(i){e[i]!==void 0&&(r[i]=e[i])}),r}function ki(e,t,r){if(r)return r;switch(e){case"time":return t.fieldTimeFormat;case"datetime":return t.fieldDateTimeFormat;case"month":return t.fieldMonthFormat;case"year":return t.fieldYearFormat;case"quarter":return t.fieldQuarterFormat;case"week":return t.fieldWeekFormat;default:return t.fieldDateFormat}}function Pi(e,t,r){var a=r!==void 0?r:t[t.length-1],i=t.find(function(u){return e[u]});return a!==i?e[i]:void 0}function wi(e){return kr(e,["placement","builtinPlacements","popupAlign","getPopupContainer","transitionName","direction"])}function la(e,t,r,a){var i=o.useMemo(function(){return e||function(c,d){var p=c;return t&&d.type==="date"?t(p,d.today):r&&d.type==="month"?r(p,d.locale):d.originNode}},[e,r,t]),u=o.useCallback(function(c,d){return i(c,_e(_e({},d),{},{range:a}))},[i,a]);return u}function ji(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=o.useState([!1,!1]),i=ce(a,2),u=i[0],c=i[1],d=function(h,y){c(function(M){return ir(M,y,h)})},p=o.useMemo(function(){return u.map(function(v,h){if(v)return!0;var y=e[h];return y?!!(!r[h]&&!y||y&&t(y,{activeIndex:h})):!1})},[e,u,t,r]);return[p,d]}function Ni(e,t,r,a,i){var u="",c=[];return e&&c.push(i?"hh":"HH"),t&&c.push("mm"),r&&c.push("ss"),u=c.join(":"),a&&(u+=".SSS"),i&&(u+=" A"),u}function No(e,t,r,a,i,u){var c=e.fieldDateTimeFormat,d=e.fieldDateFormat,p=e.fieldTimeFormat,v=e.fieldMonthFormat,h=e.fieldYearFormat,y=e.fieldWeekFormat,M=e.fieldQuarterFormat,N=e.yearFormat,P=e.cellYearFormat,$=e.cellQuarterFormat,S=e.dayFormat,w=e.cellDateFormat,F=Ni(t,r,a,i,u);return _e(_e({},e),{},{fieldDateTimeFormat:c||"YYYY-MM-DD ".concat(F),fieldDateFormat:d||"YYYY-MM-DD",fieldTimeFormat:p||F,fieldMonthFormat:v||"YYYY-MM",fieldYearFormat:h||"YYYY",fieldWeekFormat:y||"gggg-wo",fieldQuarterFormat:M||"YYYY-[Q]Q",yearFormat:N||"YYYY",cellYearFormat:P||"YYYY",cellQuarterFormat:$||"[Q]Q",cellDateFormat:w||S||"D"})}function Ii(e,t){var r=t.showHour,a=t.showMinute,i=t.showSecond,u=t.showMillisecond,c=t.use12Hours;return bn.useMemo(function(){return No(e,r,a,i,u,c)},[e,r,a,i,u,c])}function Xn(e,t,r){return r??t.some(function(a){return e.includes(a)})}var Io=["showNow","showHour","showMinute","showSecond","showMillisecond","use12Hours","hourStep","minuteStep","secondStep","millisecondStep","hideDisabledOptions","defaultValue","disabledHours","disabledMinutes","disabledSeconds","disabledMilliseconds","disabledTime","changeOnScroll","defaultOpenValue"];function Eo(e){var t=kr(e,Io),r=e.format,a=e.picker,i=null;return r&&(i=r,Array.isArray(i)&&(i=i[0]),i=lr(i)==="object"?i.format:i),a==="time"&&(t.format=i),[t,i]}function To(e){return e&&typeof e=="string"}function Ei(e,t,r,a){return[e,t,r,a].some(function(i){return i!==void 0})}function Ti(e,t,r,a,i){var u=t,c=r,d=a;if(!e&&!u&&!c&&!d&&!i)u=!0,c=!0,d=!0;else if(e){var p,v,h,y=[u,c,d].some(function(P){return P===!1}),M=[u,c,d].some(function(P){return P===!0}),N=y?!0:!M;u=(p=u)!==null&&p!==void 0?p:N,c=(v=c)!==null&&v!==void 0?v:N,d=(h=d)!==null&&h!==void 0?h:N}return[u,c,d,i]}function Ri(e){var t=e.showTime,r=Eo(e),a=ce(r,2),i=a[0],u=a[1],c=t&&lr(t)==="object"?t:{},d=_e(_e({defaultOpenValue:c.defaultOpenValue||c.defaultValue},i),c),p=d.showMillisecond,v=d.showHour,h=d.showMinute,y=d.showSecond,M=Ei(v,h,y,p),N=Ti(M,v,h,y,p),P=ce(N,3);return v=P[0],h=P[1],y=P[2],[d,_e(_e({},d),{},{showHour:v,showMinute:h,showSecond:y,showMillisecond:p}),d.format,u]}function $i(e,t,r,a,i){var u=e==="time";if(e==="datetime"||u){for(var c=a,d=ki(e,i,null),p=d,v=[t,r],h=0;h<v.length;h+=1){var y=$n(v[h])[0];if(To(y)){p=y;break}}var M=c.showHour,N=c.showMinute,P=c.showSecond,$=c.showMillisecond,S=c.use12Hours,w=Xn(p,["a","A","LT","LLL","LTS"],S),F=Ei(M,N,P,$);F||(M=Xn(p,["H","h","k","LT","LLL"]),N=Xn(p,["m","LT","LLL"]),P=Xn(p,["s","LTS"]),$=Xn(p,["SSS"]));var E=Ti(F,M,N,P,$),j=ce(E,3);M=j[0],N=j[1],P=j[2];var K=t||Ni(M,N,P,$,w);return _e(_e({},c),{},{format:K,showHour:M,showMinute:N,showSecond:P,showMillisecond:$,use12Hours:w})}return null}function Ro(e,t,r){if(t===!1)return null;var a=t&&lr(t)==="object"?t:{};return a.clearIcon||r||o.createElement("span",{className:"".concat(e,"-clear-btn")})}var $r=7;function Cn(e,t,r){return!e&&!t||e===t?!0:!e||!t?!1:r()}function Jr(e,t,r){return Cn(t,r,function(){var a=Math.floor(e.getYear(t)/10),i=Math.floor(e.getYear(r)/10);return a===i})}function En(e,t,r){return Cn(t,r,function(){return e.getYear(t)===e.getYear(r)})}function xa(e,t){var r=Math.floor(e.getMonth(t)/3);return r+1}function $o(e,t,r){return Cn(t,r,function(){return En(e,t,r)&&xa(e,t)===xa(e,r)})}function ua(e,t,r){return Cn(t,r,function(){return En(e,t,r)&&e.getMonth(t)===e.getMonth(r)})}function ca(e,t,r){return Cn(t,r,function(){return En(e,t,r)&&ua(e,t,r)&&e.getDate(t)===e.getDate(r)})}function Oi(e,t,r){return Cn(t,r,function(){return e.getHour(t)===e.getHour(r)&&e.getMinute(t)===e.getMinute(r)&&e.getSecond(t)===e.getSecond(r)})}function Fi(e,t,r){return Cn(t,r,function(){return ca(e,t,r)&&Oi(e,t,r)&&e.getMillisecond(t)===e.getMillisecond(r)})}function tr(e,t,r,a){return Cn(r,a,function(){var i=e.locale.getWeekFirstDate(t,r),u=e.locale.getWeekFirstDate(t,a);return En(e,i,u)&&e.locale.getWeek(t,r)===e.locale.getWeek(t,a)})}function Ft(e,t,r,a,i){switch(i){case"date":return ca(e,r,a);case"week":return tr(e,t.locale,r,a);case"month":return ua(e,r,a);case"quarter":return $o(e,r,a);case"year":return En(e,r,a);case"decade":return Jr(e,r,a);case"time":return Oi(e,r,a);default:return Fi(e,r,a)}}function Pr(e,t,r,a){return!t||!r||!a?!1:e.isAfter(a,t)&&e.isAfter(r,a)}function dr(e,t,r,a,i){return Ft(e,t,r,a,i)?!0:e.isAfter(r,a)}function Oo(e,t,r){var a=t.locale.getWeekFirstDay(e),i=t.setDate(r,1),u=t.getWeekDay(i),c=t.addDate(i,a-u);return t.getMonth(c)===t.getMonth(r)&&t.getDate(c)>1&&(c=t.addDate(c,-7)),c}function wt(e,t){var r=t.generateConfig,a=t.locale,i=t.format;return e?typeof i=="function"?i(e):r.locale.format(a.locale,e,i):""}function xr(e,t,r){var a=t,i=["getHour","getMinute","getSecond","getMillisecond"],u=["setHour","setMinute","setSecond","setMillisecond"];return u.forEach(function(c,d){r?a=e[c](a,e[i[d]](r)):a=e[c](a,0)}),a}function Fo(e,t,r,a,i){var u=$t(function(c,d){return!!(r&&r(c,d)||a&&e.isAfter(a,c)&&!Ft(e,t,a,c,d.type)||i&&e.isAfter(c,i)&&!Ft(e,t,i,c,d.type))});return u}function Ao(e,t,r){return o.useMemo(function(){var a=ki(e,t,r),i=$n(a),u=i[0],c=lr(u)==="object"&&u.type==="mask"?u.format:null;return[i.map(function(d){return typeof d=="string"||typeof d=="function"?d:d.format}),c]},[e,t,r])}function Lo(e,t,r){return typeof e[0]=="function"||r?!0:t}function Uo(e,t,r,a){var i=$t(function(u,c){var d=_e({type:t},c);if(delete d.activeIndex,!e.isValidate(u)||r&&r(u,d))return!0;if((t==="date"||t==="time")&&a){var p,v=c&&c.activeIndex===1?"end":"start",h=((p=a.disabledTime)===null||p===void 0?void 0:p.call(a,u,v,{from:d.from}))||{},y=h.disabledHours,M=h.disabledMinutes,N=h.disabledSeconds,P=h.disabledMilliseconds,$=a.disabledHours,S=a.disabledMinutes,w=a.disabledSeconds,F=y||$,E=M||S,j=N||w,K=e.getHour(u),U=e.getMinute(u),_=e.getSecond(u),X=e.getMillisecond(u);if(F&&F().includes(K)||E&&E(K).includes(U)||j&&j(K,U).includes(_)||P&&P(K,U,_).includes(X))return!0}return!1});return i}function mr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=o.useMemo(function(){var a=e&&$n(e);return t&&a&&(a[1]=a[1]||a[0]),a},[e,t]);return r}function Ai(e,t){var r=e.generateConfig,a=e.locale,i=e.picker,u=i===void 0?"date":i,c=e.prefixCls,d=c===void 0?"rc-picker":c,p=e.styles,v=p===void 0?{}:p,h=e.classNames,y=h===void 0?{}:h,M=e.order,N=M===void 0?!0:M,P=e.components,$=P===void 0?{}:P,S=e.inputRender,w=e.allowClear,F=e.clearIcon,E=e.needConfirm,j=e.multiple,K=e.format,U=e.inputReadOnly,_=e.disabledDate,X=e.minDate,ne=e.maxDate,q=e.showTime,A=e.value,G=e.defaultValue,T=e.pickerValue,D=e.defaultPickerValue,g=mr(A),k=mr(G),L=mr(T),R=mr(D),H=u==="date"&&q?"datetime":u,B=H==="time"||H==="datetime",z=B||j,b=E??B,W=Ri(e),O=ce(W,4),ae=O[0],J=O[1],Y=O[2],oe=O[3],me=Ii(a,J),se=o.useMemo(function(){return $i(H,Y,oe,ae,me)},[H,Y,oe,ae,me]),Q=o.useMemo(function(){return _e(_e({},e),{},{prefixCls:d,locale:me,picker:u,styles:v,classNames:y,order:N,components:_e({input:S},$),clearIcon:Ro(d,w,F),showTime:se,value:g,defaultValue:k,pickerValue:L,defaultPickerValue:R},t==null?void 0:t())},[e]),xe=Ao(H,me,K),pe=ce(xe,2),Ce=pe[0],we=pe[1],fe=Lo(Ce,U,j),ye=Fo(r,a,_,X,ne),re=Uo(r,u,ye,se),$e=o.useMemo(function(){return _e(_e({},Q),{},{needConfirm:b,inputReadOnly:fe,disabledDate:ye})},[Q,b,fe,ye]);return[$e,H,z,Ce,we,re]}function _o(e,t,r){var a=mn(t,{value:e}),i=ce(a,2),u=i[0],c=i[1],d=bn.useRef(e),p=bn.useRef(),v=function(){fn.cancel(p.current)},h=$t(function(){c(d.current),r&&u!==d.current&&r(d.current)}),y=$t(function(M,N){v(),d.current=M,M||N?h():p.current=fn(h)});return bn.useEffect(function(){return v},[]),[u,y]}function Li(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,i=r.every(function(h){return h})?!1:e,u=_o(i,t||!1,a),c=ce(u,2),d=c[0],p=c[1];function v(h){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!y.inherit||d)&&p(h,y.force)}return[d,v]}function Ui(e){var t=o.useRef();return o.useImperativeHandle(e,function(){var r;return{nativeElement:(r=t.current)===null||r===void 0?void 0:r.nativeElement,focus:function(i){var u;(u=t.current)===null||u===void 0||u.focus(i)},blur:function(){var i;(i=t.current)===null||i===void 0||i.blur()}}}),t}function _i(e,t){return o.useMemo(function(){return e||(t?(gs(!1,"`ranges` is deprecated. Please use `presets` instead."),Object.entries(t).map(function(r){var a=ce(r,2),i=a[0],u=a[1];return{label:i,value:u}})):[])},[e,t])}function da(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=o.useRef(t);a.current=t,vs(function(){if(e)a.current(e);else{var i=fn(function(){a.current(e)},r);return function(){fn.cancel(i)}}},[e])}function Hi(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=o.useState(0),i=ce(a,2),u=i[0],c=i[1],d=o.useState(!1),p=ce(d,2),v=p[0],h=p[1],y=o.useRef([]),M=o.useRef(null),N=o.useRef(null),P=function(j){M.current=j},$=function(j){return M.current===j},S=function(j){h(j)},w=function(j){return j&&(N.current=j),N.current},F=function(j){var K=y.current,U=new Set(K.filter(function(X){return j[X]||t[X]})),_=K[K.length-1]===0?1:0;return U.size>=2||e[_]?null:_};return da(v||r,function(){v||(y.current=[],P(null))}),o.useEffect(function(){v&&y.current.push(u)},[v,u]),[v,S,w,u,c,F,y.current,P,$]}function Ho(e,t,r,a,i,u){var c=r[r.length-1],d=function(v,h){var y=ce(e,2),M=y[0],N=y[1],P=_e(_e({},h),{},{from:Pi(e,r)});return c===1&&t[0]&&M&&!Ft(a,i,M,v,P.type)&&a.isAfter(M,v)||c===0&&t[1]&&N&&!Ft(a,i,N,v,P.type)&&a.isAfter(v,N)?!0:u==null?void 0:u(v,P)};return d}function nr(e,t,r,a){switch(t){case"date":case"week":return e.addMonth(r,a);case"month":case"quarter":return e.addYear(r,a);case"year":return e.addYear(r,a*10);case"decade":return e.addYear(r,a*100);default:return r}}var Or=[];function Bi(e,t,r,a,i,u,c,d){var p=arguments.length>8&&arguments[8]!==void 0?arguments[8]:Or,v=arguments.length>9&&arguments[9]!==void 0?arguments[9]:Or,h=arguments.length>10&&arguments[10]!==void 0?arguments[10]:Or,y=arguments.length>11?arguments[11]:void 0,M=arguments.length>12?arguments[12]:void 0,N=arguments.length>13?arguments[13]:void 0,P=c==="time",$=u||0,S=function(L){var R=e.getNow();return P&&(R=xr(e,R)),p[L]||r[L]||R},w=ce(v,2),F=w[0],E=w[1],j=mn(function(){return S(0)},{value:F}),K=ce(j,2),U=K[0],_=K[1],X=mn(function(){return S(1)},{value:E}),ne=ce(X,2),q=ne[0],A=ne[1],G=o.useMemo(function(){var k=[U,q][$];return P?k:xr(e,k,h[$])},[P,U,q,$,e,h]),T=function(L){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"panel",H=[_,A][$];H(L);var B=[U,q];B[$]=L,y&&(!Ft(e,t,U,B[0],c)||!Ft(e,t,q,B[1],c))&&y(B,{source:R,range:$===1?"end":"start",mode:a})},D=function(L,R){if(d){var H={date:"month",week:"month",month:"year",quarter:"year"},B=H[c];if(B&&!Ft(e,t,L,R,B))return nr(e,c,R,-1);if(c==="year"&&L){var z=Math.floor(e.getYear(L)/10),b=Math.floor(e.getYear(R)/10);if(z!==b)return nr(e,c,R,-1)}}return R},g=o.useRef(null);return xn(function(){if(i&&!p[$]){var k=P?null:e.getNow();if(g.current!==null&&g.current!==$?k=[U,q][$^1]:r[$]?k=$===0?r[0]:D(r[0],r[1]):r[$^1]&&(k=r[$^1]),k){M&&e.isAfter(M,k)&&(k=M);var L=d?nr(e,c,k,1):k;N&&e.isAfter(L,N)&&(k=d?nr(e,c,N,-1):N),T(k,"reset")}}},[i,$,r[$]]),o.useEffect(function(){i?g.current=$:g.current=null},[i,$]),xn(function(){i&&p&&p[$]&&T(p[$],"reset")},[i,$]),[G,T]}function zi(e,t){var r=o.useRef(e),a=o.useState({}),i=ce(a,2),u=i[1],c=function(v){return v&&t!==void 0?t:r.current},d=function(v){r.current=v,u({})};return[c,d,c(!0)]}var Bo=[];function Yi(e,t,r){var a=function(c){return c.map(function(d){return wt(d,{generateConfig:e,locale:t,format:r[0]})})},i=function(c,d){for(var p=Math.max(c.length,d.length),v=-1,h=0;h<p;h+=1){var y=c[h]||null,M=d[h]||null;if(y!==M&&!Fi(e,y,M)){v=h;break}}return[v<0,v!==0]};return[a,i]}function Wi(e,t){return At(e).sort(function(r,a){return t.isAfter(r,a)?1:-1})}function zo(e){var t=zi(e),r=ce(t,2),a=r[0],i=r[1],u=$t(function(){i(e)});return o.useEffect(function(){u()},[e]),[a,i]}function Ki(e,t,r,a,i,u,c,d,p){var v=mn(u,{value:c}),h=ce(v,2),y=h[0],M=h[1],N=y||Bo,P=zo(N),$=ce(P,2),S=$[0],w=$[1],F=Yi(e,t,r),E=ce(F,2),j=E[0],K=E[1],U=$t(function(X){var ne=At(X);if(a)for(var q=0;q<2;q+=1)ne[q]=ne[q]||null;else i&&(ne=Wi(ne.filter(function(k){return k}),e));var A=K(S(),ne),G=ce(A,2),T=G[0],D=G[1];if(!T&&(w(ne),d)){var g=j(ne);d(ne,g,{range:D?"end":"start"})}}),_=function(){p&&p(S())};return[N,M,S,U,_]}function qi(e,t,r,a,i,u,c,d,p,v){var h=e.generateConfig,y=e.locale,M=e.picker,N=e.onChange,P=e.allowEmpty,$=e.order,S=u.some(function(T){return T})?!1:$,w=Yi(h,y,c),F=ce(w,2),E=F[0],j=F[1],K=zi(t),U=ce(K,2),_=U[0],X=U[1],ne=$t(function(){X(t)});o.useEffect(function(){ne()},[t]);var q=$t(function(T){var D=T===null,g=At(T||_());if(D)for(var k=Math.max(u.length,g.length),L=0;L<k;L+=1)u[L]||(g[L]=null);S&&g[0]&&g[1]&&(g=Wi(g,h)),i(g);var R=g,H=ce(R,2),B=H[0],z=H[1],b=!B,W=!z,O=P?(!b||P[0])&&(!W||P[1]):!0,ae=!$||b||W||Ft(h,y,B,z,M)||h.isAfter(z,B),J=(u[0]||!B||!v(B,{activeIndex:0}))&&(u[1]||!z||!v(z,{from:B,activeIndex:1})),Y=D||O&&ae&&J;if(Y){r(g);var oe=j(g,t),me=ce(oe,1),se=me[0];N&&!se&&N(D&&g.every(function(Q){return!Q})?null:g,E(g))}return Y}),A=$t(function(T,D){var g=ir(_(),T,a()[T]);X(g),D&&q()}),G=!d&&!p;return da(!G,function(){G&&(q(),i(t),ne())},2),[A,q]}function Vi(e,t,r,a,i){return t!=="date"&&t!=="time"?!1:r!==void 0?r:a!==void 0?a:!i&&(e==="date"||e==="time")}function Yo(e,t,r,a,i,u){var c=e;function d(y,M,N){var P=u[y](c),$=N.find(function(E){return E.value===P});if(!$||$.disabled){var S=N.filter(function(E){return!E.disabled}),w=At(S).reverse(),F=w.find(function(E){return E.value<=P})||S[0];F&&(P=F.value,c=u[M](c,P))}return P}var p=d("getHour","setHour",t()),v=d("getMinute","setMinute",r(p)),h=d("getSecond","setSecond",a(p,v));return d("getMillisecond","setMillisecond",i(p,v,h)),c}function fr(){return[]}function hr(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:2,c=[],d=r>=1?r|0:1,p=e;p<=t;p+=d){var v=i.includes(p);(!v||!a)&&c.push({label:oa(p,u),value:p,disabled:v})}return c}function ma(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=t||{},i=a.use12Hours,u=a.hourStep,c=u===void 0?1:u,d=a.minuteStep,p=d===void 0?1:d,v=a.secondStep,h=v===void 0?1:v,y=a.millisecondStep,M=y===void 0?100:y,N=a.hideDisabledOptions,P=a.disabledTime,$=a.disabledHours,S=a.disabledMinutes,w=a.disabledSeconds,F=o.useMemo(function(){return r||e.getNow()},[r,e]),E=o.useCallback(function(R){var H=(P==null?void 0:P(R))||{};return[H.disabledHours||$||fr,H.disabledMinutes||S||fr,H.disabledSeconds||w||fr,H.disabledMilliseconds||fr]},[P,$,S,w]),j=o.useMemo(function(){return E(F)},[F,E]),K=ce(j,4),U=K[0],_=K[1],X=K[2],ne=K[3],q=o.useCallback(function(R,H,B,z){var b=hr(0,23,c,N,R()),W=i?b.map(function(Y){return _e(_e({},Y),{},{label:oa(Y.value%12||12,2)})}):b,O=function(oe){return hr(0,59,p,N,H(oe))},ae=function(oe,me){return hr(0,59,h,N,B(oe,me))},J=function(oe,me,se){return hr(0,999,M,N,z(oe,me,se),3)};return[W,O,ae,J]},[N,c,i,M,p,h]),A=o.useMemo(function(){return q(U,_,X,ne)},[q,U,_,X,ne]),G=ce(A,4),T=G[0],D=G[1],g=G[2],k=G[3],L=function(H,B){var z=function(){return T},b=D,W=g,O=k;if(B){var ae=E(B),J=ce(ae,4),Y=J[0],oe=J[1],me=J[2],se=J[3],Q=q(Y,oe,me,se),xe=ce(Q,4),pe=xe[0],Ce=xe[1],we=xe[2],fe=xe[3];z=function(){return pe},b=Ce,W=we,O=fe}var ye=Yo(H,z,b,W,O,e);return ye};return[L,T,D,g,k]}function Wo(e){var t=e.mode,r=e.internalMode,a=e.renderExtraFooter,i=e.showNow,u=e.showTime,c=e.onSubmit,d=e.onNow,p=e.invalid,v=e.needConfirm,h=e.generateConfig,y=e.disabledDate,M=o.useContext(en),N=M.prefixCls,P=M.locale,$=M.button,S=$===void 0?"button":$,w=h.getNow(),F=ma(h,u,w),E=ce(F,1),j=E[0],K=a==null?void 0:a(t),U=y(w,{type:t}),_=function(){if(!U){var D=j(w);d(D)}},X="".concat(N,"-now"),ne="".concat(X,"-btn"),q=i&&o.createElement("li",{className:X},o.createElement("a",{className:ft(ne,U&&"".concat(ne,"-disabled")),"aria-disabled":U,onClick:_},r==="date"?P.today:P.now)),A=v&&o.createElement("li",{className:"".concat(N,"-ok")},o.createElement(S,{disabled:p,onClick:c},P.ok)),G=(q||A)&&o.createElement("ul",{className:"".concat(N,"-ranges")},q,A);return!K&&!G?null:o.createElement("div",{className:"".concat(N,"-footer")},K&&o.createElement("div",{className:"".concat(N,"-footer-extra")},K),G)}function Zi(e,t,r){function a(i,u){var c=i.findIndex(function(p){return Ft(e,t,p,u,r)});if(c===-1)return[].concat(At(i),[u]);var d=At(i);return d.splice(c,1),d}return a}var On=o.createContext(null);function wr(){return o.useContext(On)}function Vn(e,t){var r=e.prefixCls,a=e.generateConfig,i=e.locale,u=e.disabledDate,c=e.minDate,d=e.maxDate,p=e.cellRender,v=e.hoverValue,h=e.hoverRangeValue,y=e.onHover,M=e.values,N=e.pickerValue,P=e.onSelect,$=e.prevIcon,S=e.nextIcon,w=e.superPrevIcon,F=e.superNextIcon,E=a.getNow(),j={now:E,values:M,pickerValue:N,prefixCls:r,disabledDate:u,minDate:c,maxDate:d,cellRender:p,hoverValue:v,hoverRangeValue:h,onHover:y,locale:i,generateConfig:a,onSelect:P,panelType:t,prevIcon:$,nextIcon:S,superPrevIcon:w,superNextIcon:F};return[j,E]}var Dn=o.createContext({});function ur(e){for(var t=e.rowNum,r=e.colNum,a=e.baseDate,i=e.getCellDate,u=e.prefixColumn,c=e.rowClassName,d=e.titleFormat,p=e.getCellText,v=e.getCellClassName,h=e.headerCells,y=e.cellSelection,M=y===void 0?!0:y,N=e.disabledDate,P=wr(),$=P.prefixCls,S=P.panelType,w=P.now,F=P.disabledDate,E=P.cellRender,j=P.onHover,K=P.hoverValue,U=P.hoverRangeValue,_=P.generateConfig,X=P.values,ne=P.locale,q=P.onSelect,A=N||F,G="".concat($,"-cell"),T=o.useContext(Dn),D=T.onCellDblClick,g=function(W){return X.some(function(O){return O&&Ft(_,ne,W,O,S)})},k=[],L=0;L<t;L+=1){for(var R=[],H=void 0,B=function(){var W=L*r+z,O=i(a,W),ae=A==null?void 0:A(O,{type:S});z===0&&(H=O,u&&R.push(u(H)));var J=!1,Y=!1,oe=!1;if(M&&U){var me=ce(U,2),se=me[0],Q=me[1];J=Pr(_,se,Q,O),Y=Ft(_,ne,O,se,S),oe=Ft(_,ne,O,Q,S)}var xe=d?wt(O,{locale:ne,format:d,generateConfig:_}):void 0,pe=o.createElement("div",{className:"".concat(G,"-inner")},p(O));R.push(o.createElement("td",{key:z,title:xe,className:ft(G,_e(Xe(Xe(Xe(Xe(Xe(Xe({},"".concat(G,"-disabled"),ae),"".concat(G,"-hover"),(K||[]).some(function(Ce){return Ft(_,ne,O,Ce,S)})),"".concat(G,"-in-range"),J&&!Y&&!oe),"".concat(G,"-range-start"),Y),"".concat(G,"-range-end"),oe),"".concat($,"-cell-selected"),!U&&S!=="week"&&g(O)),v(O))),onClick:function(){ae||q(O)},onDoubleClick:function(){!ae&&D&&D()},onMouseEnter:function(){ae||j==null||j(O)},onMouseLeave:function(){ae||j==null||j(null)}},E?E(O,{prefixCls:$,originNode:pe,today:w,type:S,locale:ne}):pe))},z=0;z<r;z+=1)B();k.push(o.createElement("tr",{key:L,className:c==null?void 0:c(H)},R))}return o.createElement("div",{className:"".concat($,"-body")},o.createElement("table",{className:"".concat($,"-content")},h&&o.createElement("thead",null,o.createElement("tr",null,h)),o.createElement("tbody",null,k)))}var pr={visibility:"hidden"};function Zn(e){var t=e.offset,r=e.superOffset,a=e.onChange,i=e.getStart,u=e.getEnd,c=e.children,d=wr(),p=d.prefixCls,v=d.prevIcon,h=v===void 0?"‹":v,y=d.nextIcon,M=y===void 0?"›":y,N=d.superPrevIcon,P=N===void 0?"«":N,$=d.superNextIcon,S=$===void 0?"»":$,w=d.minDate,F=d.maxDate,E=d.generateConfig,j=d.locale,K=d.pickerValue,U=d.panelType,_="".concat(p,"-header"),X=o.useContext(Dn),ne=X.hidePrev,q=X.hideNext,A=X.hideHeader,G=o.useMemo(function(){if(!w||!t||!u)return!1;var b=u(t(-1,K));return!dr(E,j,b,w,U)},[w,t,K,u,E,j,U]),T=o.useMemo(function(){if(!w||!r||!u)return!1;var b=u(r(-1,K));return!dr(E,j,b,w,U)},[w,r,K,u,E,j,U]),D=o.useMemo(function(){if(!F||!t||!i)return!1;var b=i(t(1,K));return!dr(E,j,F,b,U)},[F,t,K,i,E,j,U]),g=o.useMemo(function(){if(!F||!r||!i)return!1;var b=i(r(1,K));return!dr(E,j,F,b,U)},[F,r,K,i,E,j,U]),k=function(W){t&&a(t(W,K))},L=function(W){r&&a(r(W,K))};if(A)return null;var R="".concat(_,"-prev-btn"),H="".concat(_,"-next-btn"),B="".concat(_,"-super-prev-btn"),z="".concat(_,"-super-next-btn");return o.createElement("div",{className:_},r&&o.createElement("button",{type:"button","aria-label":j.previousYear,onClick:function(){return L(-1)},tabIndex:-1,className:ft(B,T&&"".concat(B,"-disabled")),disabled:T,style:ne?pr:{}},P),t&&o.createElement("button",{type:"button","aria-label":j.previousMonth,onClick:function(){return k(-1)},tabIndex:-1,className:ft(R,G&&"".concat(R,"-disabled")),disabled:G,style:ne?pr:{}},h),o.createElement("div",{className:"".concat(_,"-view")},c),t&&o.createElement("button",{type:"button","aria-label":j.nextMonth,onClick:function(){return k(1)},tabIndex:-1,className:ft(H,D&&"".concat(H,"-disabled")),disabled:D,style:q?pr:{}},M),r&&o.createElement("button",{type:"button","aria-label":j.nextYear,onClick:function(){return L(1)},tabIndex:-1,className:ft(z,g&&"".concat(z,"-disabled")),disabled:g,style:q?pr:{}},S))}function jr(e){var t=e.prefixCls,r=e.panelName,a=r===void 0?"date":r,i=e.locale,u=e.generateConfig,c=e.pickerValue,d=e.onPickerValueChange,p=e.onModeChange,v=e.mode,h=v===void 0?"date":v,y=e.disabledDate,M=e.onSelect,N=e.onHover,P=e.showWeek,$="".concat(t,"-").concat(a,"-panel"),S="".concat(t,"-cell"),w=h==="week",F=Vn(e,h),E=ce(F,2),j=E[0],K=E[1],U=u.locale.getWeekFirstDay(i.locale),_=u.setDate(c,1),X=Oo(i.locale,u,_),ne=u.getMonth(c),q=P===void 0?w:P,A=q?function(b){var W=y==null?void 0:y(b,{type:"week"});return o.createElement("td",{key:"week",className:ft(S,"".concat(S,"-week"),Xe({},"".concat(S,"-disabled"),W)),onClick:function(){W||M(b)},onMouseEnter:function(){W||N==null||N(b)},onMouseLeave:function(){W||N==null||N(null)}},o.createElement("div",{className:"".concat(S,"-inner")},u.locale.getWeek(i.locale,b)))}:null,G=[],T=i.shortWeekDays||(u.locale.getShortWeekDays?u.locale.getShortWeekDays(i.locale):[]);A&&G.push(o.createElement("th",{key:"empty"},o.createElement("span",{style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},i.week)));for(var D=0;D<$r;D+=1)G.push(o.createElement("th",{key:D},T[(D+U)%$r]));var g=function(W,O){return u.addDate(W,O)},k=function(W){return wt(W,{locale:i,format:i.cellDateFormat,generateConfig:u})},L=function(W){var O=Xe(Xe({},"".concat(t,"-cell-in-view"),ua(u,W,c)),"".concat(t,"-cell-today"),ca(u,W,K));return O},R=i.shortMonths||(u.locale.getShortMonths?u.locale.getShortMonths(i.locale):[]),H=o.createElement("button",{type:"button","aria-label":i.yearSelect,key:"year",onClick:function(){p("year",c)},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(c,{locale:i,format:i.yearFormat,generateConfig:u})),B=o.createElement("button",{type:"button","aria-label":i.monthSelect,key:"month",onClick:function(){p("month",c)},tabIndex:-1,className:"".concat(t,"-month-btn")},i.monthFormat?wt(c,{locale:i,format:i.monthFormat,generateConfig:u}):R[ne]),z=i.monthBeforeYear?[B,H]:[H,B];return o.createElement(On.Provider,{value:j},o.createElement("div",{className:ft($,P&&"".concat($,"-show-week"))},o.createElement(Zn,{offset:function(W){return u.addMonth(c,W)},superOffset:function(W){return u.addYear(c,W)},onChange:d,getStart:function(W){return u.setDate(W,1)},getEnd:function(W){var O=u.setDate(W,1);return O=u.addMonth(O,1),u.addDate(O,-1)}},z),o.createElement(ur,it({titleFormat:i.fieldDateFormat},e,{colNum:$r,rowNum:6,baseDate:X,headerCells:G,getCellDate:g,getCellText:k,getCellClassName:L,prefixColumn:A,cellSelection:!w}))))}var Ko=1/3;function qo(e,t){var r=o.useRef(!1),a=o.useRef(null),i=o.useRef(null),u=function(){return r.current},c=function(){fn.cancel(a.current),r.current=!1},d=o.useRef(),p=function(){var y=e.current;if(i.current=null,d.current=0,y){var M=y.querySelector('[data-value="'.concat(t,'"]')),N=y.querySelector("li"),P=function $(){c(),r.current=!0,d.current+=1;var S=y.scrollTop,w=N.offsetTop,F=M.offsetTop,E=F-w;if(F===0&&M!==N||!ys(y)){d.current<=5&&(a.current=fn($));return}var j=S+(E-S)*Ko,K=Math.abs(E-j);if(i.current!==null&&i.current<K){c();return}if(i.current=K,K<=1){y.scrollTop=E,c();return}y.scrollTop=j,a.current=fn($)};M&&N&&P()}},v=$t(p);return[v,c,u]}var Vo=300;function Zo(e){return e.map(function(t){var r=t.value,a=t.label,i=t.disabled;return[r,a,i].join(",")}).join(";")}function Qn(e){var t=e.units,r=e.value,a=e.optionalValue,i=e.type,u=e.onChange,c=e.onHover,d=e.onDblClick,p=e.changeOnScroll,v=wr(),h=v.prefixCls,y=v.cellRender,M=v.now,N=v.locale,P="".concat(h,"-time-panel"),$="".concat(h,"-time-panel-cell"),S=o.useRef(null),w=o.useRef(),F=function(){clearTimeout(w.current)},E=qo(S,r??a),j=ce(E,3),K=j[0],U=j[1],_=j[2];xn(function(){return K(),F(),function(){U(),F()}},[r,a,Zo(t)]);var X=function(A){F();var G=A.target;!_()&&p&&(w.current=setTimeout(function(){var T=S.current,D=T.querySelector("li").offsetTop,g=Array.from(T.querySelectorAll("li")),k=g.map(function(z){return z.offsetTop-D}),L=k.map(function(z,b){return t[b].disabled?Number.MAX_SAFE_INTEGER:Math.abs(z-G.scrollTop)}),R=Math.min.apply(Math,At(L)),H=L.findIndex(function(z){return z===R}),B=t[H];B&&!B.disabled&&u(B.value)},Vo))},ne="".concat(P,"-column");return o.createElement("ul",{className:ne,ref:S,"data-type":i,onScroll:X},t.map(function(q){var A=q.label,G=q.value,T=q.disabled,D=o.createElement("div",{className:"".concat($,"-inner")},A);return o.createElement("li",{key:G,className:ft($,Xe(Xe({},"".concat($,"-selected"),r===G),"".concat($,"-disabled"),T)),onClick:function(){T||u(G)},onDoubleClick:function(){!T&&d&&d()},onMouseEnter:function(){c(G)},onMouseLeave:function(){c(null)},"data-value":G},y?y(G,{prefixCls:h,originNode:D,today:M,type:"time",subType:i,locale:N}):D)}))}function gn(e){return e<12}function Go(e){var t=e.showHour,r=e.showMinute,a=e.showSecond,i=e.showMillisecond,u=e.use12Hours,c=e.changeOnScroll,d=wr(),p=d.prefixCls,v=d.values,h=d.generateConfig,y=d.locale,M=d.onSelect,N=d.onHover,P=N===void 0?function(){}:N,$=d.pickerValue,S=(v==null?void 0:v[0])||null,w=o.useContext(Dn),F=w.onCellDblClick,E=ma(h,e,S),j=ce(E,5),K=j[0],U=j[1],_=j[2],X=j[3],ne=j[4],q=function(ge){var Re=S&&h[ge](S),st=$&&h[ge]($);return[Re,st]},A=q("getHour"),G=ce(A,2),T=G[0],D=G[1],g=q("getMinute"),k=ce(g,2),L=k[0],R=k[1],H=q("getSecond"),B=ce(H,2),z=B[0],b=B[1],W=q("getMillisecond"),O=ce(W,2),ae=O[0],J=O[1],Y=T===null?null:gn(T)?"am":"pm",oe=o.useMemo(function(){return u?gn(T)?U.filter(function(ue){return gn(ue.value)}):U.filter(function(ue){return!gn(ue.value)}):U},[T,U,u]),me=function(ge,Re){var st,Ke=ge.filter(function(dt){return!dt.disabled});return Re??(Ke==null||(st=Ke[0])===null||st===void 0?void 0:st.value)},se=me(U,T),Q=o.useMemo(function(){return _(se)},[_,se]),xe=me(Q,L),pe=o.useMemo(function(){return X(se,xe)},[X,se,xe]),Ce=me(pe,z),we=o.useMemo(function(){return ne(se,xe,Ce)},[ne,se,xe,Ce]),fe=me(we,ae),ye=o.useMemo(function(){if(!u)return[];var ue=h.getNow(),ge=h.setHour(ue,6),Re=h.setHour(ue,18),st=function(dt,lt){var Ot=y.cellMeridiemFormat;return Ot?wt(dt,{generateConfig:h,locale:y,format:Ot}):lt};return[{label:st(ge,"AM"),value:"am",disabled:U.every(function(Ke){return Ke.disabled||!gn(Ke.value)})},{label:st(Re,"PM"),value:"pm",disabled:U.every(function(Ke){return Ke.disabled||gn(Ke.value)})}]},[U,u,h,y]),re=function(ge){var Re=K(ge);M(Re)},$e=o.useMemo(function(){var ue=S||$||h.getNow(),ge=function(st){return st!=null};return ge(T)?(ue=h.setHour(ue,T),ue=h.setMinute(ue,L),ue=h.setSecond(ue,z),ue=h.setMillisecond(ue,ae)):ge(D)?(ue=h.setHour(ue,D),ue=h.setMinute(ue,R),ue=h.setSecond(ue,b),ue=h.setMillisecond(ue,J)):ge(se)&&(ue=h.setHour(ue,se),ue=h.setMinute(ue,xe),ue=h.setSecond(ue,Ce),ue=h.setMillisecond(ue,fe)),ue},[S,$,T,L,z,ae,se,xe,Ce,fe,D,R,b,J,h]),He=function(ge,Re){return ge===null?null:h[Re]($e,ge)},je=function(ge){return He(ge,"setHour")},Fe=function(ge){return He(ge,"setMinute")},Ue=function(ge){return He(ge,"setSecond")},ot=function(ge){return He(ge,"setMillisecond")},et=function(ge){return ge===null?null:ge==="am"&&!gn(T)?h.setHour($e,T-12):ge==="pm"&&gn(T)?h.setHour($e,T+12):$e},Ae=function(ge){re(je(ge))},V=function(ge){re(Fe(ge))},Ve=function(ge){re(Ue(ge))},tt=function(ge){re(ot(ge))},Le=function(ge){re(et(ge))},nt=function(ge){P(je(ge))},ee=function(ge){P(Fe(ge))},Be=function(ge){P(Ue(ge))},de=function(ge){P(ot(ge))},m=function(ge){P(et(ge))},Ne={onDblClick:F,changeOnScroll:c};return o.createElement("div",{className:"".concat(p,"-content")},t&&o.createElement(Qn,it({units:oe,value:T,optionalValue:D,type:"hour",onChange:Ae,onHover:nt},Ne)),r&&o.createElement(Qn,it({units:Q,value:L,optionalValue:R,type:"minute",onChange:V,onHover:ee},Ne)),a&&o.createElement(Qn,it({units:pe,value:z,optionalValue:b,type:"second",onChange:Ve,onHover:Be},Ne)),i&&o.createElement(Qn,it({units:we,value:ae,optionalValue:J,type:"millisecond",onChange:tt,onHover:de},Ne)),u&&o.createElement(Qn,it({units:ye,value:Y,type:"meridiem",onChange:Le,onHover:m},Ne)))}function Gi(e){var t=e.prefixCls,r=e.value,a=e.locale,i=e.generateConfig,u=e.showTime,c=u||{},d=c.format,p="".concat(t,"-time-panel"),v=Vn(e,"time"),h=ce(v,1),y=h[0];return o.createElement(On.Provider,{value:y},o.createElement("div",{className:ft(p)},o.createElement(Zn,null,r?wt(r,{locale:a,format:d,generateConfig:i}):" "),o.createElement(Go,u)))}function Xo(e){var t=e.prefixCls,r=e.generateConfig,a=e.showTime,i=e.onSelect,u=e.value,c=e.pickerValue,d=e.onHover,p="".concat(t,"-datetime-panel"),v=ma(r,a),h=ce(v,1),y=h[0],M=function(S){return u?xr(r,S,u):xr(r,S,c)},N=function(S){d==null||d(S&&M(S))},P=function(S){var w=M(S);i(y(w,w))};return o.createElement("div",{className:p},o.createElement(jr,it({},e,{onSelect:P,onHover:N})),o.createElement(Gi,e))}function Qo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d="".concat(t,"-decade-panel"),p=Vn(e,"decade"),v=ce(p,1),h=v[0],y=function(U){var _=Math.floor(a.getYear(U)/100)*100;return a.setYear(U,_)},M=function(U){var _=y(U);return a.addYear(_,99)},N=y(i),P=M(i),$=a.addYear(N,-10),S=function(U,_){return a.addYear(U,_*10)},w=function(U){var _=r.cellYearFormat,X=wt(U,{locale:r,format:_,generateConfig:a}),ne=wt(a.addYear(U,9),{locale:r,format:_,generateConfig:a});return"".concat(X,"-").concat(ne)},F=function(U){return Xe({},"".concat(t,"-cell-in-view"),Jr(a,U,N)||Jr(a,U,P)||Pr(a,N,P,U))},E=u?function(K,U){var _=a.setDate(K,1),X=a.setMonth(_,0),ne=a.setYear(X,Math.floor(a.getYear(X)/10)*10),q=a.addYear(ne,10),A=a.addDate(q,-1);return u(ne,U)&&u(A,U)}:null,j="".concat(wt(N,{locale:r,format:r.yearFormat,generateConfig:a}),"-").concat(wt(P,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(On.Provider,{value:h},o.createElement("div",{className:d},o.createElement(Zn,{superOffset:function(U){return a.addYear(i,U*100)},onChange:c,getStart:y,getEnd:M},j),o.createElement(ur,it({},e,{disabledDate:E,colNum:3,rowNum:4,baseDate:$,getCellDate:S,getCellText:w,getCellClassName:F}))))}function Jo(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d=e.onModeChange,p="".concat(t,"-month-panel"),v=Vn(e,"month"),h=ce(v,1),y=h[0],M=a.setMonth(i,0),N=r.shortMonths||(a.locale.getShortMonths?a.locale.getShortMonths(r.locale):[]),P=function(j,K){return a.addMonth(j,K)},$=function(j){var K=a.getMonth(j);return r.monthFormat?wt(j,{locale:r,format:r.monthFormat,generateConfig:a}):N[K]},S=function(){return Xe({},"".concat(t,"-cell-in-view"),!0)},w=u?function(E,j){var K=a.setDate(E,1),U=a.setMonth(K,a.getMonth(K)+1),_=a.addDate(U,-1);return u(K,j)&&u(_,j)}:null,F=o.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){d("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(i,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(On.Provider,{value:y},o.createElement("div",{className:p},o.createElement(Zn,{superOffset:function(j){return a.addYear(i,j)},onChange:c,getStart:function(j){return a.setMonth(j,0)},getEnd:function(j){return a.setMonth(j,11)}},F),o.createElement(ur,it({},e,{disabledDate:w,titleFormat:r.fieldMonthFormat,colNum:3,rowNum:4,baseDate:M,getCellDate:P,getCellText:$,getCellClassName:S}))))}function el(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.onPickerValueChange,c=e.onModeChange,d="".concat(t,"-quarter-panel"),p=Vn(e,"quarter"),v=ce(p,1),h=v[0],y=a.setMonth(i,0),M=function(w,F){return a.addMonth(w,F*3)},N=function(w){return wt(w,{locale:r,format:r.cellQuarterFormat,generateConfig:a})},P=function(){return Xe({},"".concat(t,"-cell-in-view"),!0)},$=o.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){c("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(i,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(On.Provider,{value:h},o.createElement("div",{className:d},o.createElement(Zn,{superOffset:function(w){return a.addYear(i,w)},onChange:u,getStart:function(w){return a.setMonth(w,0)},getEnd:function(w){return a.setMonth(w,11)}},$),o.createElement(ur,it({},e,{titleFormat:r.fieldQuarterFormat,colNum:4,rowNum:1,baseDate:y,getCellDate:M,getCellText:N,getCellClassName:P}))))}function tl(e){var t=e.prefixCls,r=e.generateConfig,a=e.locale,i=e.value,u=e.hoverValue,c=e.hoverRangeValue,d=a.locale,p="".concat(t,"-week-panel-row"),v=function(y){var M={};if(c){var N=ce(c,2),P=N[0],$=N[1],S=tr(r,d,P,y),w=tr(r,d,$,y);M["".concat(p,"-range-start")]=S,M["".concat(p,"-range-end")]=w,M["".concat(p,"-range-hover")]=!S&&!w&&Pr(r,P,$,y)}return u&&(M["".concat(p,"-hover")]=u.some(function(F){return tr(r,d,y,F)})),ft(p,Xe({},"".concat(p,"-selected"),!c&&tr(r,d,i,y)),M)};return o.createElement(jr,it({},e,{mode:"week",panelName:"week",rowClassName:v}))}function nl(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,i=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,d=e.onModeChange,p="".concat(t,"-year-panel"),v=Vn(e,"year"),h=ce(v,1),y=h[0],M=function(_){var X=Math.floor(a.getYear(_)/10)*10;return a.setYear(_,X)},N=function(_){var X=M(_);return a.addYear(X,9)},P=M(i),$=N(i),S=a.addYear(P,-1),w=function(_,X){return a.addYear(_,X)},F=function(_){return wt(_,{locale:r,format:r.cellYearFormat,generateConfig:a})},E=function(_){return Xe({},"".concat(t,"-cell-in-view"),En(a,_,P)||En(a,_,$)||Pr(a,P,$,_))},j=u?function(U,_){var X=a.setMonth(U,0),ne=a.setDate(X,1),q=a.addYear(ne,1),A=a.addDate(q,-1);return u(ne,_)&&u(A,_)}:null,K=o.createElement("button",{type:"button",key:"decade","aria-label":r.decadeSelect,onClick:function(){d("decade")},tabIndex:-1,className:"".concat(t,"-decade-btn")},wt(P,{locale:r,format:r.yearFormat,generateConfig:a}),"-",wt($,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(On.Provider,{value:y},o.createElement("div",{className:p},o.createElement(Zn,{superOffset:function(_){return a.addYear(i,_*10)},onChange:c,getStart:M,getEnd:N},K),o.createElement(ur,it({},e,{disabledDate:j,titleFormat:r.fieldYearFormat,colNum:3,rowNum:4,baseDate:S,getCellDate:w,getCellText:F,getCellClassName:E}))))}var rl={date:jr,datetime:Xo,week:tl,month:Jo,quarter:el,year:nl,decade:Qo,time:Gi};function al(e,t){var r,a=e.locale,i=e.generateConfig,u=e.direction,c=e.prefixCls,d=e.tabIndex,p=d===void 0?0:d,v=e.multiple,h=e.defaultValue,y=e.value,M=e.onChange,N=e.onSelect,P=e.defaultPickerValue,$=e.pickerValue,S=e.onPickerValueChange,w=e.mode,F=e.onPanelChange,E=e.picker,j=E===void 0?"date":E,K=e.showTime,U=e.hoverValue,_=e.hoverRangeValue,X=e.cellRender,ne=e.dateRender,q=e.monthCellRender,A=e.components,G=A===void 0?{}:A,T=e.hideHeader,D=((r=o.useContext(en))===null||r===void 0?void 0:r.prefixCls)||c||"rc-picker",g=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:g.current}});var k=Ri(e),L=ce(k,4),R=L[0],H=L[1],B=L[2],z=L[3],b=Ii(a,H),W=j==="date"&&K?"datetime":j,O=o.useMemo(function(){return $i(W,B,z,R,b)},[W,B,z,R,b]),ae=i.getNow(),J=mn(j,{value:w,postState:function(m){return m||"date"}}),Y=ce(J,2),oe=Y[0],me=Y[1],se=oe==="date"&&O?"datetime":oe,Q=Zi(i,a,W),xe=mn(h,{value:y}),pe=ce(xe,2),Ce=pe[0],we=pe[1],fe=o.useMemo(function(){var de=$n(Ce).filter(function(m){return m});return v?de:de.slice(0,1)},[Ce,v]),ye=$t(function(de){we(de),M&&(de===null||fe.length!==de.length||fe.some(function(m,Ne){return!Ft(i,a,m,de[Ne],W)}))&&(M==null||M(v?de:de[0]))}),re=$t(function(de){if(N==null||N(de),oe===j){var m=v?Q(fe,de):[de];ye(m)}}),$e=mn(P||fe[0]||ae,{value:$}),He=ce($e,2),je=He[0],Fe=He[1];o.useEffect(function(){fe[0]&&!$&&Fe(fe[0])},[fe[0]]);var Ue=function(m,Ne){F==null||F(m||$,Ne||oe)},ot=function(m){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;Fe(m),S==null||S(m),Ne&&Ue(m)},et=function(m,Ne){me(m),Ne&&ot(Ne),Ue(Ne,m)},Ae=function(m){if(re(m),ot(m),oe!==j){var Ne=["decade","year"],ue=[].concat(Ne,["month"]),ge={quarter:[].concat(Ne,["quarter"]),week:[].concat(At(ue),["week"]),date:[].concat(At(ue),["date"])},Re=ge[j]||ue,st=Re.indexOf(oe),Ke=Re[st+1];Ke&&et(Ke,m)}},V=o.useMemo(function(){var de,m;if(Array.isArray(_)){var Ne=ce(_,2);de=Ne[0],m=Ne[1]}else de=_;return!de&&!m?null:(de=de||m,m=m||de,i.isAfter(de,m)?[m,de]:[de,m])},[_,i]),Ve=la(X,ne,q),tt=G[se]||rl[se]||jr,Le=o.useContext(Dn),nt=o.useMemo(function(){return _e(_e({},Le),{},{hideHeader:T})},[Le,T]),ee="".concat(D,"-panel"),Be=kr(e,["showWeek","prevIcon","nextIcon","superPrevIcon","superNextIcon","disabledDate","minDate","maxDate","onHover"]);return o.createElement(Dn.Provider,{value:nt},o.createElement("div",{ref:g,tabIndex:p,className:ft(ee,Xe({},"".concat(ee,"-rtl"),u==="rtl"))},o.createElement(tt,it({},Be,{showTime:O,prefixCls:D,locale:b,generateConfig:i,onModeChange:et,pickerValue:je,onPickerValueChange:function(m){ot(m,!0)},value:fe[0],onSelect:Ae,values:fe,cellRender:Ve,hoverRangeValue:V,hoverValue:U}))))}var Fr=o.memo(o.forwardRef(al));function il(e){var t=e.picker,r=e.multiplePanel,a=e.pickerValue,i=e.onPickerValueChange,u=e.needConfirm,c=e.onSubmit,d=e.range,p=e.hoverValue,v=o.useContext(en),h=v.prefixCls,y=v.generateConfig,M=o.useCallback(function(F,E){return nr(y,t,F,E)},[y,t]),N=o.useMemo(function(){return M(a,1)},[a,M]),P=function(E){i(M(E,-1))},$={onCellDblClick:function(){u&&c()}},S=t==="time",w=_e(_e({},e),{},{hoverValue:null,hoverRangeValue:null,hideHeader:S});return d?w.hoverRangeValue=p:w.hoverValue=p,r?o.createElement("div",{className:"".concat(h,"-panels")},o.createElement(Dn.Provider,{value:_e(_e({},$),{},{hideNext:!0})},o.createElement(Fr,w)),o.createElement(Dn.Provider,{value:_e(_e({},$),{},{hidePrev:!0})},o.createElement(Fr,it({},w,{pickerValue:N,onPickerValueChange:P})))):o.createElement(Dn.Provider,{value:_e({},$)},o.createElement(Fr,w))}function Ca(e){return typeof e=="function"?e():e}function sl(e){var t=e.prefixCls,r=e.presets,a=e.onClick,i=e.onHover;return r.length?o.createElement("div",{className:"".concat(t,"-presets")},o.createElement("ul",null,r.map(function(u,c){var d=u.label,p=u.value;return o.createElement("li",{key:c,onClick:function(){a(Ca(p))},onMouseEnter:function(){i(Ca(p))},onMouseLeave:function(){i(null)}},d)}))):null}function Xi(e){var t=e.panelRender,r=e.internalMode,a=e.picker,i=e.showNow,u=e.range,c=e.multiple,d=e.activeInfo,p=d===void 0?[0,0,0]:d,v=e.presets,h=e.onPresetHover,y=e.onPresetSubmit,M=e.onFocus,N=e.onBlur,P=e.onPanelMouseDown,$=e.direction,S=e.value,w=e.onSelect,F=e.isInvalid,E=e.defaultOpenValue,j=e.onOk,K=e.onSubmit,U=o.useContext(en),_=U.prefixCls,X="".concat(_,"-panel"),ne=$==="rtl",q=o.useRef(null),A=o.useRef(null),G=o.useState(0),T=ce(G,2),D=T[0],g=T[1],k=o.useState(0),L=ce(k,2),R=L[0],H=L[1],B=o.useState(0),z=ce(B,2),b=z[0],W=z[1],O=function(Ae){Ae.width&&g(Ae.width)},ae=ce(p,3),J=ae[0],Y=ae[1],oe=ae[2],me=o.useState(0),se=ce(me,2),Q=se[0],xe=se[1];o.useEffect(function(){xe(10)},[J]),o.useEffect(function(){if(u&&A.current){var et,Ae=((et=q.current)===null||et===void 0?void 0:et.offsetWidth)||0,V=A.current.getBoundingClientRect();if(!V.height||V.right<0){xe(function(nt){return Math.max(0,nt-1)});return}var Ve=(ne?Y-Ae:J)-V.left;if(W(Ve),D&&D<oe){var tt=ne?V.right-(Y-Ae+D):J+Ae-V.left-D,Le=Math.max(0,tt);H(Le)}else H(0)}},[Q,ne,D,J,Y,oe,u]);function pe(et){return et.filter(function(Ae){return Ae})}var Ce=o.useMemo(function(){return pe($n(S))},[S]),we=a==="time"&&!Ce.length,fe=o.useMemo(function(){return we?pe([E]):Ce},[we,Ce,E]),ye=we?E:Ce,re=o.useMemo(function(){return fe.length?fe.some(function(et){return F(et)}):!0},[fe,F]),$e=function(){we&&w(E),j(),K()},He=o.createElement("div",{className:"".concat(_,"-panel-layout")},o.createElement(sl,{prefixCls:_,presets:v,onClick:y,onHover:h}),o.createElement("div",null,o.createElement(il,it({},e,{value:ye})),o.createElement(Wo,it({},e,{showNow:c?!1:i,invalid:re,onSubmit:$e}))));t&&(He=t(He));var je="".concat(X,"-container"),Fe="marginLeft",Ue="marginRight",ot=o.createElement("div",{onMouseDown:P,tabIndex:-1,className:ft(je,"".concat(_,"-").concat(r,"-panel-container")),style:Xe(Xe({},ne?Ue:Fe,R),ne?Fe:Ue,"auto"),onFocus:M,onBlur:N},He);return u&&(ot=o.createElement("div",{onMouseDown:P,ref:A,className:ft("".concat(_,"-range-wrapper"),"".concat(_,"-").concat(a,"-range-wrapper"))},o.createElement("div",{ref:q,className:"".concat(_,"-range-arrow"),style:{left:b}}),o.createElement(za,{onResize:O},ot))),ot}function Qi(e,t){var r=e.format,a=e.maskFormat,i=e.generateConfig,u=e.locale,c=e.preserveInvalidOnBlur,d=e.inputReadOnly,p=e.required,v=e["aria-required"],h=e.onSubmit,y=e.onFocus,M=e.onBlur,N=e.onInputChange,P=e.onInvalid,$=e.open,S=e.onOpenChange,w=e.onKeyDown,F=e.onChange,E=e.activeHelp,j=e.name,K=e.autoComplete,U=e.id,_=e.value,X=e.invalid,ne=e.placeholder,q=e.disabled,A=e.activeIndex,G=e.allHelp,T=e.picker,D=function(b,W){var O=i.locale.parse(u.locale,b,[W]);return O&&i.isValidate(O)?O:null},g=r[0],k=o.useCallback(function(z){return wt(z,{locale:u,format:g,generateConfig:i})},[u,i,g]),L=o.useMemo(function(){return _.map(k)},[_,k]),R=o.useMemo(function(){var z=T==="time"?8:10,b=typeof g=="function"?g(i.getNow()).length:g.length;return Math.max(z,b)+2},[g,T,i]),H=function(b){for(var W=0;W<r.length;W+=1){var O=r[W];if(typeof O=="string"){var ae=D(b,O);if(ae)return ae}}return!1},B=function(b){function W(J){return b!==void 0?J[b]:J}var O=ra(e,{aria:!0,data:!0}),ae=_e(_e({},O),{},{format:a,validateFormat:function(Y){return!!H(Y)},preserveInvalidOnBlur:c,readOnly:d,required:p,"aria-required":v,name:j,autoComplete:K,size:R,id:W(U),value:W(L)||"",invalid:W(X),placeholder:W(ne),active:A===b,helped:G||E&&A===b,disabled:W(q),onFocus:function(Y){y(Y,b)},onBlur:function(Y){M(Y,b)},onSubmit:h,onChange:function(Y){N();var oe=H(Y);if(oe){P(!1,b),F(oe,b);return}P(!!Y,b)},onHelp:function(){S(!0,{index:b})},onKeyDown:function(Y){var oe=!1;if(w==null||w(Y,function(){oe=!0}),!Y.defaultPrevented&&!oe)switch(Y.key){case"Escape":S(!1,{index:b});break;case"Enter":$||S(!0);break}}},t==null?void 0:t({valueTexts:L}));return Object.keys(ae).forEach(function(J){ae[J]===void 0&&delete ae[J]}),ae};return[B,k]}var ol=["onMouseEnter","onMouseLeave"];function Ji(e){return o.useMemo(function(){return kr(e,ol)},[e])}var ll=["icon","type"],ul=["onClear"];function Nr(e){var t=e.icon,r=e.type,a=qn(e,ll),i=o.useContext(en),u=i.prefixCls;return t?o.createElement("span",it({className:"".concat(u,"-").concat(r)},a),t):null}function ea(e){var t=e.onClear,r=qn(e,ul);return o.createElement(Nr,it({},r,{type:"clear",role:"button",onMouseDown:function(i){i.preventDefault()},onClick:function(i){i.stopPropagation(),t()}}))}var Ar=["YYYY","MM","DD","HH","mm","ss","SSS"],Ma="顧",cl=function(){function e(t){Ss(this,e),Xe(this,"format",void 0),Xe(this,"maskFormat",void 0),Xe(this,"cells",void 0),Xe(this,"maskCells",void 0),this.format=t;var r=Ar.map(function(d){return"(".concat(d,")")}).join("|"),a=new RegExp(r,"g");this.maskFormat=t.replace(a,function(d){return Ma.repeat(d.length)});var i=new RegExp("(".concat(Ar.join("|"),")")),u=(t.split(i)||[]).filter(function(d){return d}),c=0;this.cells=u.map(function(d){var p=Ar.includes(d),v=c,h=c+d.length;return c=h,{text:d,mask:p,start:v,end:h}}),this.maskCells=this.cells.filter(function(d){return d.mask})}return bs(e,[{key:"getSelection",value:function(r){var a=this.maskCells[r]||{},i=a.start,u=a.end;return[i||0,u||0]}},{key:"match",value:function(r){for(var a=0;a<this.maskFormat.length;a+=1){var i=this.maskFormat[a],u=r[a];if(!u||i!==Ma&&i!==u)return!1}return!0}},{key:"size",value:function(){return this.maskCells.length}},{key:"getMaskCellIndex",value:function(r){for(var a=Number.MAX_SAFE_INTEGER,i=0,u=0;u<this.maskCells.length;u+=1){var c=this.maskCells[u],d=c.start,p=c.end;if(r>=d&&r<=p)return u;var v=Math.min(Math.abs(r-d),Math.abs(r-p));v<a&&(a=v,i=u)}return i}}]),e}();function dl(e){var t={YYYY:[0,9999,new Date().getFullYear()],MM:[1,12],DD:[1,31],HH:[0,23],mm:[0,59],ss:[0,59],SSS:[0,999]};return t[e]}var ml=["active","showActiveCls","suffixIcon","format","validateFormat","onChange","onInput","helped","onHelp","onSubmit","onKeyDown","preserveInvalidOnBlur","invalid","clearIcon"],ta=o.forwardRef(function(e,t){var r=e.active,a=e.showActiveCls,i=a===void 0?!0:a,u=e.suffixIcon,c=e.format,d=e.validateFormat,p=e.onChange;e.onInput;var v=e.helped,h=e.onHelp,y=e.onSubmit,M=e.onKeyDown,N=e.preserveInvalidOnBlur,P=N===void 0?!1:N,$=e.invalid,S=e.clearIcon,w=qn(e,ml),F=e.value,E=e.onFocus,j=e.onBlur,K=e.onMouseUp,U=o.useContext(en),_=U.prefixCls,X=U.input,ne=X===void 0?"input":X,q="".concat(_,"-input"),A=o.useState(!1),G=ce(A,2),T=G[0],D=G[1],g=o.useState(F),k=ce(g,2),L=k[0],R=k[1],H=o.useState(""),B=ce(H,2),z=B[0],b=B[1],W=o.useState(null),O=ce(W,2),ae=O[0],J=O[1],Y=o.useState(null),oe=ce(Y,2),me=oe[0],se=oe[1],Q=L||"";o.useEffect(function(){R(F)},[F]);var xe=o.useRef(),pe=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:xe.current,inputElement:pe.current,focus:function(de){pe.current.focus(de)},blur:function(){pe.current.blur()}}});var Ce=o.useMemo(function(){return new cl(c||"")},[c]),we=o.useMemo(function(){return v?[0,0]:Ce.getSelection(ae)},[Ce,ae,v]),fe=ce(we,2),ye=fe[0],re=fe[1],$e=function(de){de&&de!==c&&de!==F&&h()},He=$t(function(Be){d(Be)&&p(Be),R(Be),$e(Be)}),je=function(de){if(!c){var m=de.target.value;$e(m),R(m),p(m)}},Fe=function(de){var m=de.clipboardData.getData("text");d(m)&&He(m)},Ue=o.useRef(!1),ot=function(){Ue.current=!0},et=function(de){var m=de.target,Ne=m.selectionStart,ue=Ce.getMaskCellIndex(Ne);J(ue),se({}),K==null||K(de),Ue.current=!1},Ae=function(de){D(!0),J(0),b(""),E(de)},V=function(de){j(de)},Ve=function(de){D(!1),V(de)};da(r,function(){!r&&!P&&R(F)});var tt=function(de){de.key==="Enter"&&d(Q)&&y(),M==null||M(de)},Le=function(de){tt(de);var m=de.key,Ne=null,ue=null,ge=re-ye,Re=c.slice(ye,re),st=function(Ot){J(function(bt){var ht=bt+Ot;return ht=Math.max(ht,0),ht=Math.min(ht,Ce.size()-1),ht})},Ke=function(Ot){var bt=dl(Re),ht=ce(bt,3),Lt=ht[0],ct=ht[1],Ut=ht[2],Yt=Q.slice(ye,re),Qe=Number(Yt);if(isNaN(Qe))return String(Ut||(Ot>0?Lt:ct));var Et=Qe+Ot,Gt=ct-Lt+1;return String(Lt+(Gt+Et-Lt)%Gt)};switch(m){case"Backspace":case"Delete":Ne="",ue=Re;break;case"ArrowLeft":Ne="",st(-1);break;case"ArrowRight":Ne="",st(1);break;case"ArrowUp":Ne="",ue=Ke(1);break;case"ArrowDown":Ne="",ue=Ke(-1);break;default:isNaN(Number(m))||(Ne=z+m,ue=Ne);break}if(Ne!==null&&(b(Ne),Ne.length>=ge&&(st(1),b(""))),ue!==null){var dt=Q.slice(0,ye)+oa(ue,ge)+Q.slice(re);He(dt.slice(0,c.length))}se({})},nt=o.useRef();xn(function(){if(!(!T||!c||Ue.current)){if(!Ce.match(Q)){He(c);return}return pe.current.setSelectionRange(ye,re),nt.current=fn(function(){pe.current.setSelectionRange(ye,re)}),function(){fn.cancel(nt.current)}}},[Ce,c,T,Q,ae,ye,re,me,He]);var ee=c?{onFocus:Ae,onBlur:Ve,onKeyDown:Le,onMouseDown:ot,onMouseUp:et,onPaste:Fe}:{};return o.createElement("div",{ref:xe,className:ft(q,Xe(Xe({},"".concat(q,"-active"),r&&i),"".concat(q,"-placeholder"),v))},o.createElement(ne,it({ref:pe,"aria-invalid":$,autoComplete:"off"},w,{onKeyDown:tt,onBlur:V},ee,{value:Q,onChange:je})),o.createElement(Nr,{type:"suffix",icon:u}),S)}),fl=["id","prefix","clearIcon","suffixIcon","separator","activeIndex","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","value","onChange","onSubmit","onInputChange","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onActiveInfo","placement","onMouseDown","required","aria-required","autoFocus","tabIndex"],hl=["index"];function pl(e,t){var r=e.id,a=e.prefix,i=e.clearIcon,u=e.suffixIcon,c=e.separator,d=c===void 0?"~":c,p=e.activeIndex;e.activeHelp,e.allHelp;var v=e.focused;e.onFocus,e.onBlur,e.onKeyDown,e.locale,e.generateConfig;var h=e.placeholder,y=e.className,M=e.style,N=e.onClick,P=e.onClear,$=e.value;e.onChange,e.onSubmit,e.onInputChange,e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var S=e.disabled,w=e.invalid;e.inputReadOnly;var F=e.direction;e.onOpenChange;var E=e.onActiveInfo;e.placement;var j=e.onMouseDown;e.required,e["aria-required"];var K=e.autoFocus,U=e.tabIndex,_=qn(e,fl),X=F==="rtl",ne=o.useContext(en),q=ne.prefixCls,A=o.useMemo(function(){if(typeof r=="string")return[r];var me=r||{};return[me.start,me.end]},[r]),G=o.useRef(),T=o.useRef(),D=o.useRef(),g=function(se){var Q;return(Q=[T,D][se])===null||Q===void 0?void 0:Q.current};o.useImperativeHandle(t,function(){return{nativeElement:G.current,focus:function(se){if(lr(se)==="object"){var Q,xe=se||{},pe=xe.index,Ce=pe===void 0?0:pe,we=qn(xe,hl);(Q=g(Ce))===null||Q===void 0||Q.focus(we)}else{var fe;(fe=g(se??0))===null||fe===void 0||fe.focus()}},blur:function(){var se,Q;(se=g(0))===null||se===void 0||se.blur(),(Q=g(1))===null||Q===void 0||Q.blur()}}});var k=Ji(_),L=o.useMemo(function(){return Array.isArray(h)?h:[h,h]},[h]),R=Qi(_e(_e({},e),{},{id:A,placeholder:L})),H=ce(R,1),B=H[0],z=o.useState({position:"absolute",width:0}),b=ce(z,2),W=b[0],O=b[1],ae=$t(function(){var me=g(p);if(me){var se=me.nativeElement.getBoundingClientRect(),Q=G.current.getBoundingClientRect(),xe=se.left-Q.left;O(function(pe){return _e(_e({},pe),{},{width:se.width,left:xe})}),E([se.left,se.right,Q.width])}});o.useEffect(function(){ae()},[p]);var J=i&&($[0]&&!S[0]||$[1]&&!S[1]),Y=K&&!S[0],oe=K&&!Y&&!S[1];return o.createElement(za,{onResize:ae},o.createElement("div",it({},k,{className:ft(q,"".concat(q,"-range"),Xe(Xe(Xe(Xe({},"".concat(q,"-focused"),v),"".concat(q,"-disabled"),S.every(function(me){return me})),"".concat(q,"-invalid"),w.some(function(me){return me})),"".concat(q,"-rtl"),X),y),style:M,ref:G,onClick:N,onMouseDown:function(se){var Q=se.target;Q!==T.current.inputElement&&Q!==D.current.inputElement&&se.preventDefault(),j==null||j(se)}}),a&&o.createElement("div",{className:"".concat(q,"-prefix")},a),o.createElement(ta,it({ref:T},B(0),{autoFocus:Y,tabIndex:U,"date-range":"start"})),o.createElement("div",{className:"".concat(q,"-range-separator")},d),o.createElement(ta,it({ref:D},B(1),{autoFocus:oe,tabIndex:U,"date-range":"end"})),o.createElement("div",{className:"".concat(q,"-active-bar"),style:W}),o.createElement(Nr,{type:"suffix",icon:u}),J&&o.createElement(ea,{icon:i,onClear:P})))}var gl=o.forwardRef(pl);function ka(e,t){var r=e??t;return Array.isArray(r)?r:[r,r]}function gr(e){return e===1?"end":"start"}function vl(e,t){var r=Ai(e,function(){var rt=e.disabled,We=e.allowEmpty,Ze=ka(rt,!1),yt=ka(We,!1);return{disabled:Ze,allowEmpty:yt}}),a=ce(r,6),i=a[0],u=a[1],c=a[2],d=a[3],p=a[4],v=a[5],h=i.prefixCls,y=i.styles,M=i.classNames,N=i.defaultValue,P=i.value,$=i.needConfirm,S=i.onKeyDown,w=i.disabled,F=i.allowEmpty,E=i.disabledDate,j=i.minDate,K=i.maxDate,U=i.defaultOpen,_=i.open,X=i.onOpenChange,ne=i.locale,q=i.generateConfig,A=i.picker,G=i.showNow,T=i.showToday,D=i.showTime,g=i.mode,k=i.onPanelChange,L=i.onCalendarChange,R=i.onOk,H=i.defaultPickerValue,B=i.pickerValue,z=i.onPickerValueChange,b=i.inputReadOnly,W=i.suffixIcon,O=i.onFocus,ae=i.onBlur,J=i.presets,Y=i.ranges,oe=i.components,me=i.cellRender,se=i.dateRender,Q=i.monthCellRender,xe=i.onClick,pe=Ui(t),Ce=Li(_,U,w,X),we=ce(Ce,2),fe=we[0],ye=we[1],re=function(We,Ze){(w.some(function(yt){return!yt})||!We)&&ye(We,Ze)},$e=Ki(q,ne,d,!0,!1,N,P,L,R),He=ce($e,5),je=He[0],Fe=He[1],Ue=He[2],ot=He[3],et=He[4],Ae=Ue(),V=Hi(w,F,fe),Ve=ce(V,9),tt=Ve[0],Le=Ve[1],nt=Ve[2],ee=Ve[3],Be=Ve[4],de=Ve[5],m=Ve[6],Ne=Ve[7],ue=Ve[8],ge=function(We,Ze){Le(!0),O==null||O(We,{range:gr(Ze??ee)})},Re=function(We,Ze){Le(!1),ae==null||ae(We,{range:gr(Ze??ee)})},st=o.useMemo(function(){if(!D)return null;var rt=D.disabledTime,We=rt?function(Ze){var yt=gr(ee),Tt=Pi(Ae,m,ee);return rt(Ze,yt,{from:Tt})}:void 0;return _e(_e({},D),{},{disabledTime:We})},[D,ee,Ae,m]),Ke=mn([A,A],{value:g}),dt=ce(Ke,2),lt=dt[0],Ot=dt[1],bt=lt[ee]||A,ht=bt==="date"&&st?"datetime":bt,Lt=ht===A&&ht!=="time",ct=Vi(A,bt,G,T,!0),Ut=qi(i,je,Fe,Ue,ot,w,d,tt,fe,v),Yt=ce(Ut,2),Qe=Yt[0],Et=Yt[1],Gt=Ho(Ae,w,m,q,ne,E),on=ji(Ae,v,F),ln=ce(on,2),hn=ln[0],Mn=ln[1],un=Bi(q,ne,Ae,lt,fe,ee,u,Lt,H,B,st==null?void 0:st.defaultOpenValue,z,j,K),Wt=ce(un,2),tn=Wt[0],pn=Wt[1],_t=$t(function(rt,We,Ze){var yt=ir(lt,ee,We);if((yt[0]!==lt[0]||yt[1]!==lt[1])&&Ot(yt),k&&Ze!==!1){var Tt=At(Ae);rt&&(Tt[ee]=rt),k(Tt,yt)}}),nn=function(We,Ze){return ir(Ae,Ze,We)},Ht=function(We,Ze){var yt=Ae;We&&(yt=nn(We,ee)),Ne(ee);var Tt=de(yt);ot(yt),Qe(ee,Tt===null),Tt===null?re(!1,{force:!0}):Ze||pe.current.focus({index:Tt})},l=function(We){var Ze,yt=We.target.getRootNode();if(!pe.current.nativeElement.contains((Ze=yt.activeElement)!==null&&Ze!==void 0?Ze:document.activeElement)){var Tt=w.findIndex(function(hs){return!hs});Tt>=0&&pe.current.focus({index:Tt})}re(!0),xe==null||xe(We)},s=function(){Et(null),re(!1,{force:!0})},f=o.useState(null),C=ce(f,2),x=C[0],Z=C[1],te=o.useState(null),ve=ce(te,2),I=ve[0],ie=ve[1],le=o.useMemo(function(){return I||Ae},[Ae,I]);o.useEffect(function(){fe||ie(null)},[fe]);var he=o.useState([0,0,0]),Ee=ce(he,2),ke=Ee[0],De=Ee[1],Me=_i(J,Y),Oe=function(We){ie(We),Z("preset")},Ye=function(We){var Ze=Et(We);Ze&&re(!1,{force:!0})},be=function(We){Ht(We)},ze=function(We){ie(We?nn(We,ee):null),Z("cell")},ut=function(We){re(!0),ge(We)},pt=function(){nt("panel")},St=function(We){var Ze=ir(Ae,ee,We);ot(Ze),!$&&!c&&u===ht&&Ht(We)},rn=function(){re(!1)},Xt=la(me,se,Q,gr(ee)),Fn=Ae[ee]||null,An=$t(function(rt){return v(rt,{activeIndex:ee})}),Pe=o.useMemo(function(){var rt=ra(i,!1),We=Ya(i,[].concat(At(Object.keys(rt)),["onChange","onCalendarChange","style","className","onPanelChange","disabledTime"]));return We},[i]),Te=o.createElement(Xi,it({},Pe,{showNow:ct,showTime:st,range:!0,multiplePanel:Lt,activeInfo:ke,disabledDate:Gt,onFocus:ut,onBlur:Re,onPanelMouseDown:pt,picker:A,mode:bt,internalMode:ht,onPanelChange:_t,format:p,value:Fn,isInvalid:An,onChange:null,onSelect:St,pickerValue:tn,defaultOpenValue:$n(D==null?void 0:D.defaultOpenValue)[ee],onPickerValueChange:pn,hoverValue:le,onHover:ze,needConfirm:$,onSubmit:Ht,onOk:et,presets:Me,onPresetHover:Oe,onPresetSubmit:Ye,onNow:be,cellRender:Xt})),xt=function(We,Ze){var yt=nn(We,Ze);ot(yt)},an=function(){nt("input")},cr=function(We,Ze){var yt=m.length,Tt=m[yt-1];if(yt&&Tt!==Ze&&$&&!F[Tt]&&!ue(Tt)&&Ae[Tt]){pe.current.focus({index:Tt});return}nt("input"),re(!0,{inherit:!0}),ee!==Ze&&fe&&!$&&c&&Ht(null,!0),Be(Ze),ge(We,Ze)},ds=function(We,Ze){if(re(!1),!$&&nt()==="input"){var yt=de(Ae);Qe(ee,yt===null)}Re(We,Ze)},ms=function(We,Ze){We.key==="Tab"&&Ht(null,!0),S==null||S(We,Ze)},fs=o.useMemo(function(){return{prefixCls:h,locale:ne,generateConfig:q,button:oe.button,input:oe.input}},[h,ne,q,oe.button,oe.input]);return xn(function(){fe&&ee!==void 0&&_t(null,A,!1)},[fe,ee,A]),xn(function(){var rt=nt();!fe&&rt==="input"&&(re(!1),Ht(null,!0)),!fe&&c&&!$&&rt==="panel"&&(re(!0),Ht())},[fe]),o.createElement(en.Provider,{value:fs},o.createElement(Mi,it({},wi(i),{popupElement:Te,popupStyle:y.popup,popupClassName:M.popup,visible:fe,onClose:rn,range:!0}),o.createElement(gl,it({},i,{ref:pe,suffixIcon:W,activeIndex:tt||fe?ee:null,activeHelp:!!I,allHelp:!!I&&x==="preset",focused:tt,onFocus:cr,onBlur:ds,onKeyDown:ms,onSubmit:Ht,value:le,maskFormat:p,onChange:xt,onInputChange:an,format:d,inputReadOnly:b,disabled:w,open:fe,onOpenChange:re,onClick:l,onClear:s,invalid:hn,onInvalid:Mn,onActiveInfo:De}))))}var yl=o.forwardRef(vl);function bl(e){var t=e.prefixCls,r=e.value,a=e.onRemove,i=e.removeIcon,u=i===void 0?"×":i,c=e.formatDate,d=e.disabled,p=e.maxTagCount,v=e.placeholder,h="".concat(t,"-selector"),y="".concat(t,"-selection"),M="".concat(y,"-overflow");function N(S,w){return o.createElement("span",{className:ft("".concat(y,"-item")),title:typeof S=="string"?S:null},o.createElement("span",{className:"".concat(y,"-item-content")},S),!d&&w&&o.createElement("span",{onMouseDown:function(E){E.preventDefault()},onClick:w,className:"".concat(y,"-item-remove")},u))}function P(S){var w=c(S),F=function(j){j&&j.stopPropagation(),a(S)};return N(w,F)}function $(S){var w="+ ".concat(S.length," ...");return N(w)}return o.createElement("div",{className:h},o.createElement(Ds,{prefixCls:M,data:r,renderItem:P,renderRest:$,itemKey:function(w){return c(w)},maxCount:p}),!r.length&&o.createElement("span",{className:"".concat(t,"-selection-placeholder")},v))}var Sl=["id","open","prefix","clearIcon","suffixIcon","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","internalPicker","value","onChange","onSubmit","onInputChange","multiple","maxTagCount","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onMouseDown","required","aria-required","autoFocus","tabIndex","removeIcon"];function Dl(e,t){e.id;var r=e.open,a=e.prefix,i=e.clearIcon,u=e.suffixIcon;e.activeHelp,e.allHelp;var c=e.focused;e.onFocus,e.onBlur,e.onKeyDown;var d=e.locale,p=e.generateConfig,v=e.placeholder,h=e.className,y=e.style,M=e.onClick,N=e.onClear,P=e.internalPicker,$=e.value,S=e.onChange,w=e.onSubmit;e.onInputChange;var F=e.multiple,E=e.maxTagCount;e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var j=e.disabled,K=e.invalid;e.inputReadOnly;var U=e.direction;e.onOpenChange;var _=e.onMouseDown;e.required,e["aria-required"];var X=e.autoFocus,ne=e.tabIndex,q=e.removeIcon,A=qn(e,Sl),G=U==="rtl",T=o.useContext(en),D=T.prefixCls,g=o.useRef(),k=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:g.current,focus:function(Y){var oe;(oe=k.current)===null||oe===void 0||oe.focus(Y)},blur:function(){var Y;(Y=k.current)===null||Y===void 0||Y.blur()}}});var L=Ji(A),R=function(Y){S([Y])},H=function(Y){var oe=$.filter(function(me){return me&&!Ft(p,d,me,Y,P)});S(oe),r||w()},B=Qi(_e(_e({},e),{},{onChange:R}),function(J){var Y=J.valueTexts;return{value:Y[0]||"",active:c}}),z=ce(B,2),b=z[0],W=z[1],O=!!(i&&$.length&&!j),ae=F?o.createElement(o.Fragment,null,o.createElement(bl,{prefixCls:D,value:$,onRemove:H,formatDate:W,maxTagCount:E,disabled:j,removeIcon:q,placeholder:v}),o.createElement("input",{className:"".concat(D,"-multiple-input"),value:$.map(W).join(","),ref:k,readOnly:!0,autoFocus:X,tabIndex:ne}),o.createElement(Nr,{type:"suffix",icon:u}),O&&o.createElement(ea,{icon:i,onClear:N})):o.createElement(ta,it({ref:k},b(),{autoFocus:X,tabIndex:ne,suffixIcon:u,clearIcon:O&&o.createElement(ea,{icon:i,onClear:N}),showActiveCls:!1}));return o.createElement("div",it({},L,{className:ft(D,Xe(Xe(Xe(Xe(Xe({},"".concat(D,"-multiple"),F),"".concat(D,"-focused"),c),"".concat(D,"-disabled"),j),"".concat(D,"-invalid"),K),"".concat(D,"-rtl"),G),h),style:y,ref:g,onClick:M,onMouseDown:function(Y){var oe,me=Y.target;me!==((oe=k.current)===null||oe===void 0?void 0:oe.inputElement)&&Y.preventDefault(),_==null||_(Y)}}),a&&o.createElement("div",{className:"".concat(D,"-prefix")},a),ae)}var xl=o.forwardRef(Dl);function Cl(e,t){var r=Ai(e),a=ce(r,6),i=a[0],u=a[1],c=a[2],d=a[3],p=a[4],v=a[5],h=i,y=h.prefixCls,M=h.styles,N=h.classNames,P=h.order,$=h.defaultValue,S=h.value,w=h.needConfirm,F=h.onChange,E=h.onKeyDown,j=h.disabled,K=h.disabledDate,U=h.minDate,_=h.maxDate,X=h.defaultOpen,ne=h.open,q=h.onOpenChange,A=h.locale,G=h.generateConfig,T=h.picker,D=h.showNow,g=h.showToday,k=h.showTime,L=h.mode,R=h.onPanelChange,H=h.onCalendarChange,B=h.onOk,z=h.multiple,b=h.defaultPickerValue,W=h.pickerValue,O=h.onPickerValueChange,ae=h.inputReadOnly,J=h.suffixIcon,Y=h.removeIcon,oe=h.onFocus,me=h.onBlur,se=h.presets,Q=h.components,xe=h.cellRender,pe=h.dateRender,Ce=h.monthCellRender,we=h.onClick,fe=Ui(t);function ye(Pe){return Pe===null?null:z?Pe:Pe[0]}var re=Zi(G,A,u),$e=Li(ne,X,[j],q),He=ce($e,2),je=He[0],Fe=He[1],Ue=function(Te,xt,an){if(H){var cr=_e({},an);delete cr.range,H(ye(Te),ye(xt),cr)}},ot=function(Te){B==null||B(ye(Te))},et=Ki(G,A,d,!1,P,$,S,Ue,ot),Ae=ce(et,5),V=Ae[0],Ve=Ae[1],tt=Ae[2],Le=Ae[3],nt=Ae[4],ee=tt(),Be=Hi([j]),de=ce(Be,4),m=de[0],Ne=de[1],ue=de[2],ge=de[3],Re=function(Te){Ne(!0),oe==null||oe(Te,{})},st=function(Te){Ne(!1),me==null||me(Te,{})},Ke=mn(T,{value:L}),dt=ce(Ke,2),lt=dt[0],Ot=dt[1],bt=lt==="date"&&k?"datetime":lt,ht=Vi(T,lt,D,g),Lt=F&&function(Pe,Te){F(ye(Pe),ye(Te))},ct=qi(_e(_e({},i),{},{onChange:Lt}),V,Ve,tt,Le,[],d,m,je,v),Ut=ce(ct,2),Yt=Ut[1],Qe=ji(ee,v),Et=ce(Qe,2),Gt=Et[0],on=Et[1],ln=o.useMemo(function(){return Gt.some(function(Pe){return Pe})},[Gt]),hn=function(Te,xt){if(O){var an=_e(_e({},xt),{},{mode:xt.mode[0]});delete an.range,O(Te[0],an)}},Mn=Bi(G,A,ee,[lt],je,ge,u,!1,b,W,$n(k==null?void 0:k.defaultOpenValue),hn,U,_),un=ce(Mn,2),Wt=un[0],tn=un[1],pn=$t(function(Pe,Te,xt){if(Ot(Te),R&&xt!==!1){var an=Pe||ee[ee.length-1];R(an,Te)}}),_t=function(){Yt(tt()),Fe(!1,{force:!0})},nn=function(Te){!j&&!fe.current.nativeElement.contains(document.activeElement)&&fe.current.focus(),Fe(!0),we==null||we(Te)},Ht=function(){Yt(null),Fe(!1,{force:!0})},l=o.useState(null),s=ce(l,2),f=s[0],C=s[1],x=o.useState(null),Z=ce(x,2),te=Z[0],ve=Z[1],I=o.useMemo(function(){var Pe=[te].concat(At(ee)).filter(function(Te){return Te});return z?Pe:Pe.slice(0,1)},[ee,te,z]),ie=o.useMemo(function(){return!z&&te?[te]:ee.filter(function(Pe){return Pe})},[ee,te,z]);o.useEffect(function(){je||ve(null)},[je]);var le=_i(se),he=function(Te){ve(Te),C("preset")},Ee=function(Te){var xt=z?re(tt(),Te):[Te],an=Yt(xt);an&&!z&&Fe(!1,{force:!0})},ke=function(Te){Ee(Te)},De=function(Te){ve(Te),C("cell")},Me=function(Te){Fe(!0),Re(Te)},Oe=function(Te){if(ue("panel"),!(z&&bt!==T)){var xt=z?re(tt(),Te):[Te];Le(xt),!w&&!c&&u===bt&&_t()}},Ye=function(){Fe(!1)},be=la(xe,pe,Ce),ze=o.useMemo(function(){var Pe=ra(i,!1),Te=Ya(i,[].concat(At(Object.keys(Pe)),["onChange","onCalendarChange","style","className","onPanelChange"]));return _e(_e({},Te),{},{multiple:i.multiple})},[i]),ut=o.createElement(Xi,it({},ze,{showNow:ht,showTime:k,disabledDate:K,onFocus:Me,onBlur:st,picker:T,mode:lt,internalMode:bt,onPanelChange:pn,format:p,value:ee,isInvalid:v,onChange:null,onSelect:Oe,pickerValue:Wt,defaultOpenValue:k==null?void 0:k.defaultOpenValue,onPickerValueChange:tn,hoverValue:I,onHover:De,needConfirm:w,onSubmit:_t,onOk:nt,presets:le,onPresetHover:he,onPresetSubmit:Ee,onNow:ke,cellRender:be})),pt=function(Te){Le(Te)},St=function(){ue("input")},rn=function(Te){ue("input"),Fe(!0,{inherit:!0}),Re(Te)},Xt=function(Te){Fe(!1),st(Te)},Fn=function(Te,xt){Te.key==="Tab"&&_t(),E==null||E(Te,xt)},An=o.useMemo(function(){return{prefixCls:y,locale:A,generateConfig:G,button:Q.button,input:Q.input}},[y,A,G,Q.button,Q.input]);return xn(function(){je&&ge!==void 0&&pn(null,T,!1)},[je,ge,T]),xn(function(){var Pe=ue();!je&&Pe==="input"&&(Fe(!1),_t()),!je&&c&&!w&&Pe==="panel"&&_t()},[je]),o.createElement(en.Provider,{value:An},o.createElement(Mi,it({},wi(i),{popupElement:ut,popupStyle:M.popup,popupClassName:N.popup,visible:je,onClose:Ye}),o.createElement(xl,it({},i,{ref:fe,suffixIcon:J,removeIcon:Y,activeHelp:!!te,allHelp:!!te&&f==="preset",focused:m,onFocus:rn,onBlur:Xt,onKeyDown:Fn,onSubmit:_t,value:ie,maskFormat:p,onChange:pt,onInputChange:St,internalPicker:u,format:d,inputReadOnly:ae,disabled:j,open:je,onOpenChange:Fe,onClick:nn,onClear:Ht,invalid:ln,onInvalid:function(Te){on(Te,0)}}))))}var Ml=o.forwardRef(Cl);const Lr=(e,t)=>{const{componentCls:r,controlHeight:a}=e,i=t?`${r}-${t}`:"",u=no(e);return[{[`${r}-multiple${i}`]:{paddingBlock:u.containerPadding,paddingInlineStart:u.basePadding,minHeight:a,[`${r}-selection-item`]:{height:u.itemHeight,lineHeight:Je(u.itemLineHeight)}}}]},kl=e=>{const{componentCls:t,calc:r,lineWidth:a}=e,i=Gr(e,{fontHeight:e.fontSize,selectHeight:e.controlHeightSM,multipleSelectItemHeight:e.multipleItemHeightSM,borderRadius:e.borderRadiusSM,borderRadiusSM:e.borderRadiusXS,controlHeight:e.controlHeightSM}),u=Gr(e,{fontHeight:r(e.multipleItemHeightLG).sub(r(a).mul(2).equal()).equal(),fontSize:e.fontSizeLG,selectHeight:e.controlHeightLG,multipleSelectItemHeight:e.multipleItemHeightLG,borderRadius:e.borderRadiusLG,borderRadiusSM:e.borderRadius,controlHeight:e.controlHeightLG});return[Lr(i,"small"),Lr(e),Lr(u,"large"),{[`${t}${t}-multiple`]:Object.assign(Object.assign({width:"100%",cursor:"text",[`${t}-selector`]:{flex:"auto",padding:0,position:"relative","&:after":{margin:0},[`${t}-selection-placeholder`]:{position:"absolute",top:"50%",insetInlineStart:e.inputPaddingHorizontalBase,insetInlineEnd:0,transform:"translateY(-50%)",transition:`all ${e.motionDurationSlow}`,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flex:1,color:e.colorTextPlaceholder,pointerEvents:"none"}}},to(e)),{[`${t}-multiple-input`]:{width:0,height:0,border:0,visibility:"hidden",position:"absolute",zIndex:-1}})}]},Pl=e=>{const{pickerCellCls:t,pickerCellInnerCls:r,cellHeight:a,borderRadiusSM:i,motionDurationMid:u,cellHoverBg:c,lineWidth:d,lineType:p,colorPrimary:v,cellActiveWithRangeBg:h,colorTextLightSolid:y,colorTextDisabled:M,cellBgDisabled:N,colorFillSecondary:P}=e;return{"&::before":{position:"absolute",top:"50%",insetInlineStart:0,insetInlineEnd:0,zIndex:1,height:a,transform:"translateY(-50%)",content:'""',pointerEvents:"none"},[r]:{position:"relative",zIndex:2,display:"inline-block",minWidth:a,height:a,lineHeight:Je(a),borderRadius:i,transition:`background ${u}`},[`&:hover:not(${t}-in-view):not(${t}-disabled),
    &:hover:not(${t}-selected):not(${t}-range-start):not(${t}-range-end):not(${t}-disabled)`]:{[r]:{background:c}},[`&-in-view${t}-today ${r}`]:{"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:1,border:`${Je(d)} ${p} ${v}`,borderRadius:i,content:'""'}},[`&-in-view${t}-in-range,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{position:"relative",[`&:not(${t}-disabled):before`]:{background:h}},[`&-in-view${t}-selected,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{[`&:not(${t}-disabled) ${r}`]:{color:y,background:v},[`&${t}-disabled ${r}`]:{background:P}},[`&-in-view${t}-range-start:not(${t}-disabled):before`]:{insetInlineStart:"50%"},[`&-in-view${t}-range-end:not(${t}-disabled):before`]:{insetInlineEnd:"50%"},[`&-in-view${t}-range-start:not(${t}-range-end) ${r}`]:{borderStartStartRadius:i,borderEndStartRadius:i,borderStartEndRadius:0,borderEndEndRadius:0},[`&-in-view${t}-range-end:not(${t}-range-start) ${r}`]:{borderStartStartRadius:0,borderEndStartRadius:0,borderStartEndRadius:i,borderEndEndRadius:i},"&-disabled":{color:M,cursor:"not-allowed",[r]:{background:"transparent"},"&::before":{background:N}},[`&-disabled${t}-today ${r}::before`]:{borderColor:M}}},wl=e=>{const{componentCls:t,pickerCellCls:r,pickerCellInnerCls:a,pickerYearMonthCellWidth:i,pickerControlIconSize:u,cellWidth:c,paddingSM:d,paddingXS:p,paddingXXS:v,colorBgContainer:h,lineWidth:y,lineType:M,borderRadiusLG:N,colorPrimary:P,colorTextHeading:$,colorSplit:S,pickerControlIconBorderWidth:w,colorIcon:F,textHeight:E,motionDurationMid:j,colorIconHover:K,fontWeightStrong:U,cellHeight:_,pickerCellPaddingVertical:X,colorTextDisabled:ne,colorText:q,fontSize:A,motionDurationSlow:G,withoutTimeCellHeight:T,pickerQuarterPanelContentHeight:D,borderRadiusSM:g,colorTextLightSolid:k,cellHoverBg:L,timeColumnHeight:R,timeColumnWidth:H,timeCellHeight:B,controlItemBgActive:z,marginXXS:b,pickerDatePanelPaddingHorizontal:W,pickerControlIconMargin:O}=e,ae=e.calc(c).mul(7).add(e.calc(W).mul(2)).equal();return{[t]:{"&-panel":{display:"inline-flex",flexDirection:"column",textAlign:"center",background:h,borderRadius:N,outline:"none","&-focused":{borderColor:P},"&-rtl":{[`${t}-prev-icon,
              ${t}-super-prev-icon`]:{transform:"rotate(45deg)"},[`${t}-next-icon,
              ${t}-super-next-icon`]:{transform:"rotate(-135deg)"},[`${t}-time-panel`]:{[`${t}-content`]:{direction:"ltr","> *":{direction:"rtl"}}}}},"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel,\n        &-week-panel,\n        &-date-panel,\n        &-time-panel":{display:"flex",flexDirection:"column",width:ae},"&-header":{display:"flex",padding:`0 ${Je(p)}`,color:$,borderBottom:`${Je(y)} ${M} ${S}`,"> *":{flex:"none"},button:{padding:0,color:F,lineHeight:Je(E),background:"transparent",border:0,cursor:"pointer",transition:`color ${j}`,fontSize:"inherit",display:"inline-flex",alignItems:"center",justifyContent:"center","&:empty":{display:"none"}},"> button":{minWidth:"1.6em",fontSize:A,"&:hover":{color:K},"&:disabled":{opacity:.25,pointerEvents:"none"}},"&-view":{flex:"auto",fontWeight:U,lineHeight:Je(E),"> button":{color:"inherit",fontWeight:"inherit",verticalAlign:"top","&:not(:first-child)":{marginInlineStart:p},"&:hover":{color:P}}}},"&-prev-icon,\n        &-next-icon,\n        &-super-prev-icon,\n        &-super-next-icon":{position:"relative",width:u,height:u,"&::before":{position:"absolute",top:0,insetInlineStart:0,width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:w,borderInlineStartWidth:w,content:'""'}},"&-super-prev-icon,\n        &-super-next-icon":{"&::after":{position:"absolute",top:O,insetInlineStart:O,display:"inline-block",width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:w,borderInlineStartWidth:w,content:'""'}},"&-prev-icon, &-super-prev-icon":{transform:"rotate(-45deg)"},"&-next-icon, &-super-next-icon":{transform:"rotate(135deg)"},"&-content":{width:"100%",tableLayout:"fixed",borderCollapse:"collapse","th, td":{position:"relative",minWidth:_,fontWeight:"normal"},th:{height:e.calc(_).add(e.calc(X).mul(2)).equal(),color:q,verticalAlign:"middle"}},"&-cell":Object.assign({padding:`${Je(X)} 0`,color:ne,cursor:"pointer","&-in-view":{color:q}},Pl(e)),"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-content`]:{height:e.calc(T).mul(4).equal()},[a]:{padding:`0 ${Je(p)}`}},"&-quarter-panel":{[`${t}-content`]:{height:D}},"&-decade-panel":{[a]:{padding:`0 ${Je(e.calc(p).div(2).equal())}`},[`${t}-cell::before`]:{display:"none"}},"&-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-body`]:{padding:`0 ${Je(p)}`},[a]:{width:i}},"&-date-panel":{[`${t}-body`]:{padding:`${Je(p)} ${Je(W)}`},[`${t}-content th`]:{boxSizing:"border-box",padding:0}},"&-week-panel-row":{td:{"&:before":{transition:`background ${j}`},"&:first-child:before":{borderStartStartRadius:g,borderEndStartRadius:g},"&:last-child:before":{borderStartEndRadius:g,borderEndEndRadius:g}},"&:hover td:before":{background:L},"&-range-start td, &-range-end td, &-selected td, &-hover td":{[`&${r}`]:{"&:before":{background:P},[`&${t}-cell-week`]:{color:new Dr(k).setA(.5).toHexString()},[a]:{color:k}}},"&-range-hover td:before":{background:z}},"&-week-panel, &-date-panel-show-week":{[`${t}-body`]:{padding:`${Je(p)} ${Je(d)}`},[`${t}-content th`]:{width:"auto"}},"&-datetime-panel":{display:"flex",[`${t}-time-panel`]:{borderInlineStart:`${Je(y)} ${M} ${S}`},[`${t}-date-panel,
          ${t}-time-panel`]:{transition:`opacity ${G}`},"&-active":{[`${t}-date-panel,
            ${t}-time-panel`]:{opacity:.3,"&-active":{opacity:1}}}},"&-time-panel":{width:"auto",minWidth:"auto",[`${t}-content`]:{display:"flex",flex:"auto",height:R},"&-column":{flex:"1 0 auto",width:H,margin:`${Je(v)} 0`,padding:0,overflowY:"hidden",textAlign:"start",listStyle:"none",transition:`background ${j}`,overflowX:"hidden","&::-webkit-scrollbar":{width:8,backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:e.colorTextTertiary,borderRadius:e.borderRadiusSM},"&":{scrollbarWidth:"thin",scrollbarColor:`${e.colorTextTertiary} transparent`},"&::after":{display:"block",height:`calc(100% - ${Je(B)})`,content:'""'},"&:not(:first-child)":{borderInlineStart:`${Je(y)} ${M} ${S}`},"&-active":{background:new Dr(z).setA(.2).toHexString()},"&:hover":{overflowY:"auto"},"> li":{margin:0,padding:0,[`&${t}-time-panel-cell`]:{marginInline:b,[`${t}-time-panel-cell-inner`]:{display:"block",width:e.calc(H).sub(e.calc(b).mul(2)).equal(),height:B,margin:0,paddingBlock:0,paddingInlineEnd:0,paddingInlineStart:e.calc(H).sub(B).div(2).equal(),color:q,lineHeight:Je(B),borderRadius:g,cursor:"pointer",transition:`background ${j}`,"&:hover":{background:L}},"&-selected":{[`${t}-time-panel-cell-inner`]:{background:z}},"&-disabled":{[`${t}-time-panel-cell-inner`]:{color:ne,background:"transparent",cursor:"not-allowed"}}}}}}}}},jl=e=>{const{componentCls:t,textHeight:r,lineWidth:a,paddingSM:i,antCls:u,colorPrimary:c,cellActiveWithRangeBg:d,colorPrimaryBorder:p,lineType:v,colorSplit:h}=e;return{[`${t}-dropdown`]:{[`${t}-footer`]:{borderTop:`${Je(a)} ${v} ${h}`,"&-extra":{padding:`0 ${Je(i)}`,lineHeight:Je(e.calc(r).sub(e.calc(a).mul(2)).equal()),textAlign:"start","&:not(:last-child)":{borderBottom:`${Je(a)} ${v} ${h}`}}},[`${t}-panels + ${t}-footer ${t}-ranges`]:{justifyContent:"space-between"},[`${t}-ranges`]:{marginBlock:0,paddingInline:Je(i),overflow:"hidden",textAlign:"start",listStyle:"none",display:"flex",justifyContent:"center",alignItems:"center","> li":{lineHeight:Je(e.calc(r).sub(e.calc(a).mul(2)).equal()),display:"inline-block"},[`${t}-now-btn-disabled`]:{pointerEvents:"none",color:e.colorTextDisabled},[`${t}-preset > ${u}-tag-blue`]:{color:c,background:d,borderColor:p,cursor:"pointer"},[`${t}-ok`]:{paddingBlock:e.calc(a).mul(2).equal(),marginInlineStart:"auto"}}}}},Nl=e=>{const{componentCls:t,controlHeightLG:r,paddingXXS:a,padding:i}=e;return{pickerCellCls:`${t}-cell`,pickerCellInnerCls:`${t}-cell-inner`,pickerYearMonthCellWidth:e.calc(r).mul(1.5).equal(),pickerQuarterPanelContentHeight:e.calc(r).mul(1.4).equal(),pickerCellPaddingVertical:e.calc(a).add(e.calc(a).div(2)).equal(),pickerCellBorderGap:2,pickerControlIconSize:7,pickerControlIconMargin:4,pickerControlIconBorderWidth:1.5,pickerDatePanelPaddingHorizontal:e.calc(i).add(e.calc(a).div(2)).equal()}},Il=e=>{const{colorBgContainerDisabled:t,controlHeight:r,controlHeightSM:a,controlHeightLG:i,paddingXXS:u,lineWidth:c}=e,d=u*2,p=c*2,v=Math.min(r-d,r-p),h=Math.min(a-d,a-p),y=Math.min(i-d,i-p);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(u/2),cellHoverBg:e.controlItemBgHover,cellActiveWithRangeBg:e.controlItemBgActive,cellHoverWithRangeBg:new Dr(e.colorPrimary).lighten(35).toHexString(),cellRangeBorderColor:new Dr(e.colorPrimary).lighten(20).toHexString(),cellBgDisabled:t,timeColumnWidth:i*1.4,timeColumnHeight:28*8,timeCellHeight:28,cellWidth:a*1.5,cellHeight:a,textHeight:i,withoutTimeCellHeight:i*1.65,multipleItemBg:e.colorFillSecondary,multipleItemBorderColor:"transparent",multipleItemHeight:v,multipleItemHeightSM:h,multipleItemHeightLG:y,multipleSelectorBgDisabled:t,multipleItemColorDisabled:e.colorTextDisabled,multipleItemBorderColorDisabled:"transparent"}},El=e=>Object.assign(Object.assign(Object.assign(Object.assign({},xs(e)),Il(e)),Cs(e)),{presetsWidth:120,presetsMaxWidth:200,zIndexPopup:e.zIndexPopupBase+50}),Tl=e=>{const{componentCls:t}=e;return{[t]:[Object.assign(Object.assign(Object.assign(Object.assign({},Ms(e)),ks(e)),Ps(e)),ws(e)),{"&-outlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${Je(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-filled":{[`&${t}-multiple ${t}-selection-item`]:{background:e.colorBgContainer,border:`${Je(e.lineWidth)} ${e.lineType} ${e.colorSplit}`}},"&-borderless":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${Je(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-underlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${Je(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}}}]}},Ur=(e,t)=>({padding:`${Je(e)} ${Je(t)}`}),Rl=e=>{const{componentCls:t,colorError:r,colorWarning:a}=e;return{[`${t}:not(${t}-disabled):not([disabled])`]:{[`&${t}-status-error`]:{[`${t}-active-bar`]:{background:r}},[`&${t}-status-warning`]:{[`${t}-active-bar`]:{background:a}}}}},$l=e=>{var t;const{componentCls:r,antCls:a,paddingInline:i,lineWidth:u,lineType:c,colorBorder:d,borderRadius:p,motionDurationMid:v,colorTextDisabled:h,colorTextPlaceholder:y,colorTextQuaternary:M,fontSizeLG:N,inputFontSizeLG:P,fontSizeSM:$,inputFontSizeSM:S,controlHeightSM:w,paddingInlineSM:F,paddingXS:E,marginXS:j,colorIcon:K,lineWidthBold:U,colorPrimary:_,motionDurationSlow:X,zIndexPopup:ne,paddingXXS:q,sizePopupArrow:A,colorBgElevated:G,borderRadiusLG:T,boxShadowSecondary:D,borderRadiusSM:g,colorSplit:k,cellHoverBg:L,presetsWidth:R,presetsMaxWidth:H,boxShadowPopoverArrow:B,fontHeight:z,lineHeightLG:b}=e;return[{[r]:Object.assign(Object.assign(Object.assign({},pa(e)),Ur(e.paddingBlock,e.paddingInline)),{position:"relative",display:"inline-flex",alignItems:"center",lineHeight:1,borderRadius:p,transition:`border ${v}, box-shadow ${v}, background ${v}`,[`${r}-prefix`]:{flex:"0 0 auto",marginInlineEnd:e.inputAffixPadding},[`${r}-input`]:{position:"relative",display:"inline-flex",alignItems:"center",width:"100%","> input":Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",color:"inherit",fontSize:(t=e.inputFontSize)!==null&&t!==void 0?t:e.fontSize,lineHeight:e.lineHeight,transition:`all ${v}`},As(y)),{flex:"auto",minWidth:1,height:"auto",padding:0,background:"transparent",border:0,fontFamily:"inherit","&:focus":{boxShadow:"none",outline:0},"&[disabled]":{background:"transparent",color:h,cursor:"not-allowed"}}),"&-placeholder":{"> input":{color:y}}},"&-large":Object.assign(Object.assign({},Ur(e.paddingBlockLG,e.paddingInlineLG)),{[`${r}-input > input`]:{fontSize:P??N,lineHeight:b}}),"&-small":Object.assign(Object.assign({},Ur(e.paddingBlockSM,e.paddingInlineSM)),{[`${r}-input > input`]:{fontSize:S??$}}),[`${r}-suffix`]:{display:"flex",flex:"none",alignSelf:"center",marginInlineStart:e.calc(E).div(2).equal(),color:M,lineHeight:1,pointerEvents:"none",transition:`opacity ${v}, color ${v}`,"> *":{verticalAlign:"top","&:not(:last-child)":{marginInlineEnd:j}}},[`${r}-clear`]:{position:"absolute",top:"50%",insetInlineEnd:0,color:M,lineHeight:1,transform:"translateY(-50%)",cursor:"pointer",opacity:0,transition:`opacity ${v}, color ${v}`,"> *":{verticalAlign:"top"},"&:hover":{color:K}},"&:hover":{[`${r}-clear`]:{opacity:1},[`${r}-suffix:not(:last-child)`]:{opacity:0}},[`${r}-separator`]:{position:"relative",display:"inline-block",width:"1em",height:N,color:M,fontSize:N,verticalAlign:"top",cursor:"default",[`${r}-focused &`]:{color:K},[`${r}-range-separator &`]:{[`${r}-disabled &`]:{cursor:"not-allowed"}}},"&-range":{position:"relative",display:"inline-flex",[`${r}-active-bar`]:{bottom:e.calc(u).mul(-1).equal(),height:U,background:_,opacity:0,transition:`all ${X} ease-out`,pointerEvents:"none"},[`&${r}-focused`]:{[`${r}-active-bar`]:{opacity:1}},[`${r}-range-separator`]:{alignItems:"center",padding:`0 ${Je(E)}`,lineHeight:1}},"&-range, &-multiple":{[`${r}-clear`]:{insetInlineEnd:i},[`&${r}-small`]:{[`${r}-clear`]:{insetInlineEnd:F}}},"&-dropdown":Object.assign(Object.assign(Object.assign({},pa(e)),wl(e)),{pointerEvents:"none",position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:ne,[`&${r}-dropdown-hidden`]:{display:"none"},"&-rtl":{direction:"rtl"},[`&${r}-dropdown-placement-bottomLeft,
            &${r}-dropdown-placement-bottomRight`]:{[`${r}-range-arrow`]:{top:0,display:"block",transform:"translateY(-100%)"}},[`&${r}-dropdown-placement-topLeft,
            &${r}-dropdown-placement-topRight`]:{[`${r}-range-arrow`]:{bottom:0,display:"block",transform:"translateY(100%) rotate(180deg)"}},[`&${a}-slide-up-appear, &${a}-slide-up-enter`]:{[`${r}-range-arrow${r}-range-arrow`]:{transition:"none"}},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topRight`]:{animationName:$s},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomRight`]:{animationName:Rs},[`&${a}-slide-up-leave ${r}-panel-container`]:{pointerEvents:"none"},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topRight`]:{animationName:Ts},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomRight`]:{animationName:Es},[`${r}-panel > ${r}-time-panel`]:{paddingTop:q},[`${r}-range-wrapper`]:{display:"flex",position:"relative"},[`${r}-range-arrow`]:Object.assign(Object.assign({position:"absolute",zIndex:1,display:"none",paddingInline:e.calc(i).mul(1.5).equal(),boxSizing:"content-box",transition:`all ${X} ease-out`},Fs(e,G,B)),{"&:before":{insetInlineStart:e.calc(i).mul(1.5).equal()}}),[`${r}-panel-container`]:{overflow:"hidden",verticalAlign:"top",background:G,borderRadius:T,boxShadow:D,transition:`margin ${X}`,display:"inline-block",pointerEvents:"auto",[`${r}-panel-layout`]:{display:"flex",flexWrap:"nowrap",alignItems:"stretch"},[`${r}-presets`]:{display:"flex",flexDirection:"column",minWidth:R,maxWidth:H,ul:{height:0,flex:"auto",listStyle:"none",overflow:"auto",margin:0,padding:E,borderInlineEnd:`${Je(u)} ${c} ${k}`,li:Object.assign(Object.assign({},Os),{borderRadius:g,paddingInline:E,paddingBlock:e.calc(w).sub(z).div(2).equal(),cursor:"pointer",transition:`all ${X}`,"+ li":{marginTop:j},"&:hover":{background:L}})}},[`${r}-panels`]:{display:"inline-flex",flexWrap:"nowrap","&:last-child":{[`${r}-panel`]:{borderWidth:0}}},[`${r}-panel`]:{verticalAlign:"top",background:"transparent",borderRadius:0,borderWidth:0,[`${r}-content, table`]:{textAlign:"center"},"&-focused":{borderColor:d}}}}),"&-dropdown-range":{padding:`${Je(e.calc(A).mul(2).div(3).equal())} 0`,"&-hidden":{display:"none"}},"&-rtl":{direction:"rtl",[`${r}-separator`]:{transform:"scale(-1, 1)"},[`${r}-footer`]:{"&-extra":{direction:"rtl"}}}})},ga(e,"slide-up"),ga(e,"slide-down"),Da(e,"move-up"),Da(e,"move-down")]},es=js("DatePicker",e=>{const t=Gr(Ns(e),Nl(e),{inputPaddingHorizontalBase:e.calc(e.paddingSM).sub(1).equal(),multipleSelectItemHeight:e.multipleItemHeight,selectHeight:e.controlHeight});return[jl(t),$l(t),Tl(t),Rl(t),kl(t),Is(e,{focusElCls:`${e.componentCls}-focused`})]},El);var Ol={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z"}}]},name:"swap-right",theme:"outlined"},Fl=function(t,r){return o.createElement(aa,it({},t,{ref:r,icon:Ol}))},Al=o.forwardRef(Fl);const ts=(e,t,r,a,i)=>{const{classNames:u,styles:c}=Ls(e),[d,p]=co([u,t],[c,r],{popup:{_default:"root"}});return o.useMemo(()=>{var v,h;const y=Object.assign(Object.assign({},d),{popup:Object.assign(Object.assign({},d.popup),{root:ft((v=d.popup)===null||v===void 0?void 0:v.root,a)})}),M=Object.assign(Object.assign({},p),{popup:Object.assign(Object.assign({},p.popup),{root:Object.assign(Object.assign({},(h=p.popup)===null||h===void 0?void 0:h.root),i)})});return[y,M]},[d,p,a,i])};function Ll(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.yearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.quarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.monthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.weekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.placeholder:e.lang.placeholder}function Ul(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.rangeYearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.rangeQuarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.rangeMonthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.rangeWeekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.rangePlaceholder:e.lang.rangePlaceholder}function ns(e,t){const{allowClear:r=!0}=e,{clearIcon:a,removeIcon:i}=ro(Object.assign(Object.assign({},e),{prefixCls:t,componentName:"DatePicker"}));return[o.useMemo(()=>r===!1?!1:Object.assign({clearIcon:a},r===!0?{}:r),[r,a]),i]}const[_l,Hl]=["week","WeekPicker"],[Bl,zl]=["month","MonthPicker"],[Yl,Wl]=["year","YearPicker"],[Kl,ql]=["quarter","QuarterPicker"],[fa,Pa]=["time","TimePicker"];var Vl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"},Zl=function(t,r){return o.createElement(aa,it({},t,{ref:r,icon:Vl}))},Gl=o.forwardRef(Zl),Xl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},Ql=function(t,r){return o.createElement(aa,it({},t,{ref:r,icon:Xl}))},Jl=o.forwardRef(Ql);const rs=({picker:e,hasFeedback:t,feedbackIcon:r,suffixIcon:a})=>a===null||a===!1?null:a===!0||a===void 0?bn.createElement(bn.Fragment,null,e===fa?bn.createElement(Jl,null):bn.createElement(Gl,null),t&&r):a,eu=e=>o.createElement(Ie,Object.assign({size:"small",type:"primary"},e));function as(e){return o.useMemo(()=>Object.assign({button:eu},e),[e])}var tu=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};const nu=e=>o.forwardRef((r,a)=>{var i;const{prefixCls:u,getPopupContainer:c,components:d,className:p,style:v,placement:h,size:y,disabled:M,bordered:N=!0,placeholder:P,popupStyle:$,popupClassName:S,dropdownClassName:w,status:F,rootClassName:E,variant:j,picker:K,styles:U,classNames:_,suffixIcon:X}=r,ne=tu(r,["prefixCls","getPopupContainer","components","className","style","placement","size","disabled","bordered","placeholder","popupStyle","popupClassName","dropdownClassName","status","rootClassName","variant","picker","styles","classNames","suffixIcon"]),q=K===fa?"timePicker":"datePicker",A=o.useRef(null),{getPrefixCls:G,direction:T,getPopupContainer:D,rangePicker:g}=o.useContext(Wa),k=G("picker",u),{compactSize:L,compactItemClassnames:R}=Ka(k,T),H=G(),[B,z]=qa("rangePicker",j,N),b=Va(k),[W,O,ae]=es(k,b),[J,Y]=ts(q,_,U,S||w,$),[oe]=ns(r,k),me=as(d),se=Za(je=>{var Fe;return(Fe=y??L)!==null&&Fe!==void 0?Fe:je}),Q=o.useContext(Ga),xe=M??Q,pe=o.useContext(Xa),{hasFeedback:Ce,status:we,feedbackIcon:fe}=pe,ye=o.createElement(rs,{picker:K,hasFeedback:Ce,feedbackIcon:fe,suffixIcon:X});o.useImperativeHandle(a,()=>A.current);const[re]=Qa("Calendar",Ja),$e=Object.assign(Object.assign({},re),r.locale),[He]=ei("DatePicker",(i=Y.popup.root)===null||i===void 0?void 0:i.zIndex);return W(o.createElement(ti,{space:!0},o.createElement(yl,Object.assign({separator:o.createElement("span",{"aria-label":"to",className:`${k}-separator`},o.createElement(Al,null)),disabled:xe,ref:A,placement:h,placeholder:Ul($e,K,P),suffixIcon:ye,prevIcon:o.createElement("span",{className:`${k}-prev-icon`}),nextIcon:o.createElement("span",{className:`${k}-next-icon`}),superPrevIcon:o.createElement("span",{className:`${k}-super-prev-icon`}),superNextIcon:o.createElement("span",{className:`${k}-super-next-icon`}),transitionName:`${H}-slide-up`,picker:K},ne,{className:ft({[`${k}-${se}`]:se,[`${k}-${B}`]:z},ni(k,ri(we,F),Ce),O,R,p,g==null?void 0:g.className,ae,b,E,J.root),style:Object.assign(Object.assign(Object.assign({},g==null?void 0:g.style),v),Y.root),locale:$e.lang,prefixCls:k,getPopupContainer:c||D,generateConfig:e,components:me,direction:T,classNames:{popup:ft(O,ae,b,E,J.popup.root)},styles:{popup:Object.assign(Object.assign({},Y.popup.root),{zIndex:He})},allowClear:oe}))))});var ru=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(r[a[i]]=e[a[i]]);return r};const au=e=>{const t=(p,v)=>{const h=v===Pa?"timePicker":"datePicker";return o.forwardRef((M,N)=>{var P;const{prefixCls:$,getPopupContainer:S,components:w,style:F,className:E,rootClassName:j,size:K,bordered:U,placement:_,placeholder:X,popupStyle:ne,popupClassName:q,dropdownClassName:A,disabled:G,status:T,variant:D,onCalendarChange:g,styles:k,classNames:L,suffixIcon:R}=M,H=ru(M,["prefixCls","getPopupContainer","components","style","className","rootClassName","size","bordered","placement","placeholder","popupStyle","popupClassName","dropdownClassName","disabled","status","variant","onCalendarChange","styles","classNames","suffixIcon"]),{getPrefixCls:B,direction:z,getPopupContainer:b,[h]:W}=o.useContext(Wa),O=B("picker",$),{compactSize:ae,compactItemClassnames:J}=Ka(O,z),Y=o.useRef(null),[oe,me]=qa("datePicker",D,U),se=Va(O),[Q,xe,pe]=es(O,se);o.useImperativeHandle(N,()=>Y.current);const Ce={showToday:!0},we=p||M.picker,fe=B(),{onSelect:ye,multiple:re}=H,$e=ye&&p==="time"&&!re,He=(ue,ge,Re)=>{g==null||g(ue,ge,Re),$e&&ye(ue)},[je,Fe]=ts(h,L,k,q||A,ne),[Ue,ot]=ns(M,O),et=as(w),Ae=Za(ue=>{var ge;return(ge=K??ae)!==null&&ge!==void 0?ge:ue}),V=o.useContext(Ga),Ve=G??V,tt=o.useContext(Xa),{hasFeedback:Le,status:nt,feedbackIcon:ee}=tt,Be=o.createElement(rs,{picker:we,hasFeedback:Le,feedbackIcon:ee,suffixIcon:R}),[de]=Qa("DatePicker",Ja),m=Object.assign(Object.assign({},de),M.locale),[Ne]=ei("DatePicker",(P=Fe.popup.root)===null||P===void 0?void 0:P.zIndex);return Q(o.createElement(ti,{space:!0},o.createElement(Ml,Object.assign({ref:Y,placeholder:Ll(m,we,X),suffixIcon:Be,placement:_,prevIcon:o.createElement("span",{className:`${O}-prev-icon`}),nextIcon:o.createElement("span",{className:`${O}-next-icon`}),superPrevIcon:o.createElement("span",{className:`${O}-super-prev-icon`}),superNextIcon:o.createElement("span",{className:`${O}-super-next-icon`}),transitionName:`${fe}-slide-up`,picker:p,onCalendarChange:He},Ce,H,{locale:m.lang,className:ft({[`${O}-${Ae}`]:Ae,[`${O}-${oe}`]:me},ni(O,ri(nt,T),Le),xe,J,W==null?void 0:W.className,E,pe,se,j,je.root),style:Object.assign(Object.assign(Object.assign({},W==null?void 0:W.style),F),Fe.root),prefixCls:O,getPopupContainer:S||b,generateConfig:e,components:et,direction:z,disabled:Ve,classNames:{popup:ft(xe,pe,se,j,je.popup.root)},styles:{popup:Object.assign(Object.assign({},Fe.popup.root),{zIndex:Ne})},allowClear:Ue,removeIcon:ot}))))})},r=t(),a=t(_l,Hl),i=t(Bl,zl),u=t(Yl,Wl),c=t(Kl,ql),d=t(fa,Pa);return{DatePicker:r,WeekPicker:a,MonthPicker:i,YearPicker:u,TimePicker:d,QuarterPicker:c}},is=e=>{const{DatePicker:t,WeekPicker:r,MonthPicker:a,YearPicker:i,TimePicker:u,QuarterPicker:c}=au(e),d=nu(e),p=t;return p.WeekPicker=r,p.MonthPicker=a,p.YearPicker=i,p.RangePicker=d,p.TimePicker=u,p.QuarterPicker=c,p},Gn=is(Po),iu=ai(Gn,"popupAlign",void 0,"picker");Gn._InternalPanelDoNotUseOrYouWillBeFired=iu;const su=ai(Gn.RangePicker,"popupAlign",void 0,"picker");Gn._InternalRangePanelDoNotUseOrYouWillBeFired=su;Gn.generatePicker=is;const Bn=24*60*60*1e3;function ss(e){if(!e)return null;const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return null;const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?null:i}function os(e){const t=e.state.settings||{},r=di(t.startMonth),a=e.dates.filter(y=>!!(y&&/^\d{4}-\d{2}-\d{2}$/.test(y))).sort()[0],i=r||(a==null?void 0:a.slice(0,7))||new Date().toISOString().slice(0,7),u=Number.isFinite(Number(e.fallbackHorizon))?Number(e.fallbackHorizon):12,c=Number(t.horizonMonths||0),d=Number.isFinite(c)&&c>0?Math.round(c):Math.max(1,Math.round(u)),p=mi(i,d),v=ss(`${i}-01`)||new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),1)),h=new Date(v.getTime());return h.setUTCMonth(h.getUTCMonth()+d),{startMonth:i,horizonMonths:d,months:p,visibleStartMs:v.getTime(),visibleEndMs:h.getTime()}}function Sn(e){const t=Number.isFinite(Number(e.fallbackMs))?Number(e.fallbackMs):Bn,r=Number.isFinite(e.startMs)?e.startMs:Date.now(),a=Number.isFinite(e.endMs)?e.endMs:r+t,i=a>r?a:r+t;return{startMs:r,endMs:i}}function cn(e){const t=ss(e);return t?t.getTime():null}const{Text:ou}=Nn;function lu(e){const t=e==null?void 0:e[0];return!t||typeof t.toDate!="function"?"":t.toDate().toLocaleDateString("de-DE",{month:"short",year:"numeric"})}function ls({className:e,groups:t,items:r,visibleStartMs:a,visibleEndMs:i,sidebarWidth:u=290,lineHeight:c=56,itemHeightRatio:d=.7,stackItems:p=!0,sidebarHeaderLabel:v="SKU / Orders",emptyMessage:h="Keine Einträge für den aktuellen Filter.",showTodayMarker:y=!0,itemRenderer:M,onItemSelect:N}){const[P,$]=o.useState(null),[S,w]=o.useState(null);o.useEffect(()=>{if(typeof window>"u")return;let A=!0;return Us(()=>import("./react-calendar-timeline.es-Ct5WWIrY.js"),__vite__mapDeps([0,1,2])).then(G=>{A&&$(G)}).catch(G=>{A&&w(G instanceof Error?G.message:"Timeline library konnte nicht geladen werden.")}),()=>{A=!1}},[]);const F=o.useMemo(()=>t.map(A=>({id:A.id,title:A.title,rightTitle:A.rightTitle,height:A.height,stackItems:A.stackItems})),[t]),E=o.useMemo(()=>{const A=Math.max(6e4,Math.floor(Bn/2));return r.map(G=>{const T=Math.max(6e4,Number.isFinite(Number(G.minDurationMs))?Number(G.minDurationMs):A),D=Sn({startMs:Number(G.startMs||0),endMs:Number(G.endMs||0),fallbackMs:T}),g={...G.itemProps||{}};return G.tooltip&&!g.title&&(g.title=G.tooltip),{id:G.id,group:G.group,title:G.title,start_time:D.startMs,end_time:D.endMs,className:G.className,style:G.style,meta:G.meta,itemProps:g,canSelect:G.canSelect!==!1,canMove:!1,canResize:!1,canChangeGroup:!1}})},[r]);if(!F.length||!E.length)return n.jsx(kt,{type:"info",showIcon:!0,message:h});if(S)return n.jsx(kt,{type:"warning",showIcon:!0,message:`Timeline konnte nicht geladen werden: ${S}`});if(!P)return n.jsx("div",{className:"v2-orders-gantt-loading",children:n.jsx(ou,{type:"secondary",children:"Timeline wird geladen..."})});const j=P.default,K=P.TimelineHeaders,U=P.SidebarHeader,_=P.DateHeader,X=P.TimelineMarkers,ne=P.TodayMarker,q=Sn({startMs:a,endMs:i,fallbackMs:30*Bn});return n.jsx("div",{className:["v2-orders-gantt-wrap",e||""].filter(Boolean).join(" "),children:n.jsxs(j,{className:"v2-orders-gantt",groups:F,items:E,defaultTimeStart:q.startMs,defaultTimeEnd:q.endMs,visibleTimeStart:q.startMs,visibleTimeEnd:q.endMs,onTimeChange:(A,G,T)=>{T(q.startMs,q.endMs)},canMove:!1,canResize:!1,canChangeGroup:!1,canSelect:!0,stackItems:p,lineHeight:c,itemHeightRatio:d,sidebarWidth:u,rightSidebarWidth:0,minZoom:7*Bn,maxZoom:Math.max(q.endMs-q.startMs,7*Bn),dragSnap:Bn,buffer:1,itemRenderer:M,onItemSelect:A=>{N&&N(String(A||""))},children:[n.jsxs(K,{className:"v2-orders-gantt-headers",children:[n.jsx(U,{children:({getRootProps:A})=>{const G=A();return n.jsx("div",{...G,children:n.jsx("div",{className:"v2-orders-gantt-sidebar-header",children:v})})}}),n.jsx(_,{unit:"primaryHeader"}),n.jsx(_,{unit:"month",labelFormat:lu})]}),n.jsx(X,{children:y?n.jsx(ne,{children:({styles:A})=>n.jsx("div",{style:{...A,width:2,background:"rgba(220, 38, 38, 0.82)",zIndex:35}})}):void 0})]})})}const{Paragraph:uu,Text:Ge,Title:cu}=Nn;function Ct(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?"—":i.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function Mt(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function vr(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function du(e){return Array.isArray(e)?e.map(t=>t).map(t=>({month:String(t.month||""),daysCovered:Math.max(0,Number(t.daysCovered||0)),forecastMonthUnits:Number.isFinite(Number(t.forecastMonthUnits))?Number(t.forecastMonthUnits):null,demandUnitsInWindow:Number.isFinite(Number(t.demandUnitsInWindow))?Number(t.demandUnitsInWindow):0,usedFallback:!!t.usedFallback})).filter(t=>/^\d{4}-\d{2}$/.test(t.month)):[]}function _r(e){const t=wn(e);return t==="ACTIVE"?n.jsx(mt,{color:"green",children:"Active"}):t==="CONVERTED"?n.jsx(mt,{color:"blue",children:"Converted"}):t==="ARCHIVED"?n.jsx(mt,{color:"default",children:"Archived"}):n.jsx(mt,{color:"gold",children:"Draft"})}function mu(e){const t=String(e||"").trim().toLowerCase();return t?t==="review_needed"?"Review nötig":t==="reviewed_updated"?"Aktualisiert":t==="superseded"?"Superseded":t==="ignored"?"Ignoriert":String(e||"—"):"—"}function fu(e){return e==="ACTIVE"?"DRAFT":"ACTIVE"}function hu(e){return e==="supplier"?"Supplier":e==="freight"?"Shipping China -> 3PL":e==="duty"?"Custom Duties":e==="eust"?"Einfuhrumsatzsteuer":"EUSt Erstattung"}function pu(e){if(typeof e.active=="boolean")return e.active;const t=String(e.status||"").trim().toLowerCase();return t?t==="active"||t==="aktiv":!0}function wa(e){let t=0;const r=/(\d+)(?!.*\d)/;return(e||[]).forEach(a=>{const i=a,u=r.exec(String(i.poNo||""));if(!u)return;const c=Number(u[1]);Number.isFinite(c)&&c>t&&(t=c)}),t>0?String(t+1):String((e||[]).length+1)}function ja(e){const t=String(e||"").trim();if(!t)return"";const r=t.toUpperCase().replace(/[\s_-]+/g,"");return r.startsWith("FO")?r.slice(2):r}function Na(e){const t=ja(e.foNo);if(t)return t;const r=ja(e.foNumber);return r||String(e.id||"").slice(-6).toUpperCase()}function Kn(e){const t=String(e||"").trim();if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return null;const r=new Date(`${t}T00:00:00Z`);return Number.isNaN(r.getTime())?null:t}function Ia(e,t){return!e&&!t?0:e?t?e.localeCompare(t):-1:1}function gu(e){return new URLSearchParams(e).get("view")==="timeline"?"timeline":"table"}function vu(e){return Kn(e==null?void 0:e.etaDate)||"9999-12-31"}function Hr(e){return Kn(e.targetDeliveryDate)||Kn(e.deliveryDate)||Kn(e.etaDate)}function rr(e){return Math.round(e*100)/100}function yu(e){const t=Number(e);return Number.isFinite(t)?t:null}function Kt(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function jn(e){const t=String(e||"").trim().toUpperCase();return t==="AIR"||t==="SEA"||t==="RAIL"?t:"RAIL"}function zn(e){return Number(Kt(e.fxRate)??0)}function sr(e,t){const r=e.transportLeadTimesDays||{},i=[jn(t),"RAIL","SEA","AIR"],u=new Set;for(let c=0;c<i.length;c+=1){const d=i[c];if(u.has(d))continue;u.add(d);const p=Number(r[d.toLowerCase()]);if(!(!Number.isFinite(p)||p<0))return{days:Math.max(0,Math.round(p)),sourceMode:d}}return{days:0,sourceMode:null}}function ha(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function Sr(e){const t=ha(e);return Number(Kt(t.unitPriceUsd)??Kt(e==null?void 0:e.unitPriceUsd)??Kt(e==null?void 0:e.unitPrice)??0)}function bu(e){const t=ha(e);return Number(Kt(e==null?void 0:e.logisticsPerUnitEur)??Kt(e==null?void 0:e.freightPerUnitEur)??Kt(t.logisticsPerUnitEur)??Kt(t.freightEur)??0)}function Br(e){const t=e.product||{},r=e.supplier||{},a=e.settings||{},i=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"fo"}),u=Sr(t),c=zn(a),d=bu(t),p=Math.max(0,rr(d)),v=jn(e.transportMode||"RAIL"),h=sr(a,v).days,y=Number(i.fields.productionLeadTimeDays.value||45),M=i.fields.ddp.value===!0,N=String(r.incotermDefault||i.fields.incoterm.value||(M?"DDP":"EXW")).toUpperCase();return{transportMode:v,incoterm:N,unitPrice:u,currency:"USD",freight:p,freightCurrency:"EUR",dutyRatePct:Number(i.fields.dutyRatePct.value||0),eustRatePct:Number(i.fields.eustRatePct.value||0),fxRate:c,productionLeadTimeDays:Math.max(0,Math.round(y)),logisticsLeadTimeDays:Math.max(0,Math.round(h)),bufferDays:Math.max(0,Math.round(yu(a.defaultBufferDays)??0))}}function Su(e){const t=e.product||{},r=e.settings||{},a=ha(t),i=jn(e.transportMode||"RAIL"),u=sr(r,i);let c="Fallback";Kt(t.productionLeadTimeDaysDefault)!=null?c="Produkt-Override":Kt(a.productionDays)!=null?c="Beschaffungs-Template":Kt(r.defaultProductionLeadTimeDays)!=null&&(c="Settings-Default");let d="Fallback";return u.sourceMode&&(d=`Settings-Default (${u.sourceMode})`),{production:c,logistics:d}}function Du({embedded:e=!1}={}){var l;const t=ia(),r=Cr(),{state:a,loading:i,saving:u,error:c,lastSavedAt:d,saveWith:p}=Mr(),v=ii(),[h,y]=o.useState(""),[M,N]=o.useState("ALL"),[P,$]=o.useState(!1),[S,w]=o.useState(null),[F,E]=o.useState(!1),[j,K]=o.useState(null),[U,_]=o.useState(""),[X,ne]=o.useState(""),[q,A]=o.useState([]),[G,T]=o.useState(!1),[D,g]=o.useState(""),[k,L]=o.useState(""),[R,H]=o.useState("earliest"),[B,z]=o.useState(""),[b,W]=o.useState(!1),[O]=Se.useForm(),ae=o.useMemo(()=>gu(t.search),[t.search]),J=a,Y=a.settings||{},oe=o.useMemo(()=>si(Y),[Y]),me=o.useMemo(()=>oi({userId:v.userId,userEmail:v.email},oe),[oe,v.email,v.userId]),se=o.useMemo(()=>`fo:edit:${String(S||"new")}`,[S]),Q=hi({workspaceId:v.workspaceId,modalScope:se,isOpen:P,userId:v.userId,userEmail:v.email,userDisplayName:me,displayNames:oe});function xe(s){const f=new URLSearchParams(t.search);s==="timeline"?f.set("view","timeline"):f.delete("view");const C=f.toString();r({pathname:t.pathname,search:C?`?${C}`:""},{replace:!0})}const pe=o.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(s=>s).map(s=>({id:String(s.id||""),name:String(s.name||"—"),productionLeadTimeDaysDefault:Number(s.productionLeadTimeDaysDefault)||0,incotermDefault:String(s.incotermDefault||"EXW").toUpperCase(),currencyDefault:String(s.currencyDefault||"EUR").toUpperCase(),raw:s})).filter(s=>s.id),[a.suppliers]),Ce=o.useMemo(()=>new Map(pe.map(s=>[s.id,s.raw])),[pe]),we=o.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(s=>s).map(s=>({sku:String(s.sku||""),alias:String(s.alias||s.sku||""),status:String(s.status||"active"),supplierId:String(s.supplierId||""),productionLeadTimeDaysDefault:Number(s.productionLeadTimeDaysDefault)||0,raw:s})).filter(s=>s.sku),[a.products]),fe=o.useMemo(()=>new Map(we.map(s=>[s.sku,s])),[we]),ye=o.useMemo(()=>Hs(a.forecast||{}),[a.forecast]),re=o.useMemo(()=>zs(J),[a.forecast,a.inventory,a.pos,a.fos]),$e=o.useMemo(()=>{const s=(Array.isArray(a.fos)?a.fos:[]).map(C=>{const x=C,Z=String(x.sku||""),te=fe.get(Z),ve=pe.find(Me=>Me.id===String(x.supplierId||"")),I=br({targetDeliveryDate:x.targetDeliveryDate,productionLeadTimeDays:x.productionLeadTimeDays,logisticsLeadTimeDays:x.logisticsLeadTimeDays,bufferDays:x.bufferDays}),ie={orderDate:String(x.orderDate||I.orderDate||""),etdDate:String(x.etdDate||I.etdDate||""),etaDate:String(x.etaDate||I.etaDate||"")},le=va({units:x.units,unitPrice:x.unitPrice,currency:x.currency,freight:x.freight,freightCurrency:x.freightCurrency,dutyRatePct:x.dutyRatePct,eustRatePct:x.eustRatePct,fxRate:x.fxRate}),he=Number(x.productionLeadTimeDays||0)+Number(x.logisticsLeadTimeDays||0)+Number(x.bufferDays||0),Ee=ya({context:re,sku:Z,leadTimeDays:he,product:Ir(we.map(Me=>Me.raw),Z),settings:Y,horizonMonths:12});let ke="—",De=null;return Ee&&(Ee.status==="no_fo_needed"?ke="Keine FO erforderlich":Ee.status==="ok"?(De=Number(Ee.recommendedUnits||0),ke=`${Mt(De,0)} Units`):ke="Nicht berechenbar"),{id:String(x.id||""),foNo:String(x.foNo||"").trim()||null,foNumber:String(x.foNumber||"").trim()||null,displayNumber:Na({foNo:x.foNo,foNumber:x.foNumber,id:x.id}),sku:Z,alias:(te==null?void 0:te.alias)||Z||"—",supplierId:String(x.supplierId||""),supplierName:(ve==null?void 0:ve.name)||"—",units:Number(x.units||0),targetDeliveryDate:x.targetDeliveryDate?String(x.targetDeliveryDate):null,orderDate:ie.orderDate||null,etdDate:ie.etdDate||null,etaDate:ie.etaDate||null,landedCostEur:rr(le.landedCostEur),status:wn(x.status),convertedPoNo:x.convertedPoNo?String(x.convertedPoNo):null,forecastBasisLabel:String(x.forecastBasisVersionName||x.forecastBasisVersionId||"—"),forecastConflictState:String(x.forecastConflictState||"").trim()||null,recommendationText:ke,recommendationUnits:De,raw:x}}),f=h.trim().toLowerCase();return s.filter(C=>M!=="ALL"&&C.status!==M?!1:f?[C.displayNumber,C.foNo||"",C.foNumber||"",C.alias,C.sku,C.supplierName,C.status].join(" ").toLowerCase().includes(f):!0).sort((C,x)=>(C.targetDeliveryDate||"").localeCompare(x.targetDeliveryDate||""))},[fe,we,re,h,Y,a.fos,M,pe]),He=o.useMemo(()=>{const s=new Map;return(Array.isArray(a.fos)?a.fos:[]).forEach(f=>{const C=f,x=String(C.id||"").trim();x&&s.set(x,C)}),s},[a.fos]),je=o.useMemo(()=>q.map(s=>He.get(s)||null).filter(s=>!!s).filter(s=>qt(s.status)),[He,q]),Fe=o.useMemo(()=>je.map(s=>Hr(s)).filter(s=>!!s).sort((s,f)=>Ia(s,f))[0]||"",[je]),Ue=o.useMemo(()=>R==="manual"?Kn(B)||null:Kn(Fe)||null,[Fe,B,R]),et=o.useMemo(()=>Array.from(new Set(je.map(s=>String(s.supplierId||"").trim()).filter(Boolean))),[je]).length>1,Ae=o.useMemo(()=>Array.from(new Set(je.map(s=>String(s.transportMode||"").trim().toUpperCase()).filter(Boolean))),[je]),V=o.useMemo(()=>Array.from(new Set(je.map(s=>String(s.incoterm||"").trim().toUpperCase()).filter(Boolean))),[je]),Ve=Ae.length>1||V.length>1,tt=o.useMemo(()=>Ue?je.map(s=>{const f=Hr(s),C=Ia(f,Ue),x=C<0?"Zu spät bei gemeinsamer PO":C>0?"Früher als Ziel":"Passt";return{id:String(s.id||""),sku:String(s.sku||""),targetDate:f,deviation:x,status:C}}):[],[Ue,je]);function Le(s,f){A(C=>f?Array.from(new Set([...C,s])):C.filter(x=>x!==s))}function nt(s){K(s.id),_(wa(Array.isArray(a.pos)?a.pos:[])),ne(s.orderDate||""),E(!0)}const ee=o.useMemo(()=>os({state:J,dates:$e.flatMap(s=>[s.orderDate,s.etdDate,s.etaDate,s.targetDeliveryDate]),fallbackHorizon:12}),[$e,J]),Be=o.useMemo(()=>{const s=[],f=[],C=new Map;return $e.forEach(x=>{const Z=qt(x.status);s.push({id:x.id,title:n.jsxs("div",{className:"v2-orders-gantt-meta",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(Qt,{checked:q.includes(x.id),disabled:!Z,onChange:he=>Le(x.id,he.target.checked)}),n.jsxs(Ge,{strong:!0,children:["FO ",x.displayNumber]}),_r(x.status)]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[x.alias," (",x.sku,") · ",x.supplierName]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:["Target ",Ct(x.targetDeliveryDate)," · ETA ",Ct(x.etaDate)]}),n.jsxs("div",{className:"v2-orders-gantt-actionline",children:[n.jsx(Ie,{size:"small",onClick:()=>tn(x.raw),children:Z?"Bearbeiten":"Details"}),n.jsx(Ie,{size:"small",disabled:!Z,onClick:()=>nt(x),children:"Convert"}),x.convertedPoNo?n.jsx(Ie,{size:"small",onClick:()=>{const he=new URLSearchParams;he.set("source","fo_convert"),he.set("poNo",String(x.convertedPoNo||"")),r(`/v2/orders/po?${he.toString()}`)},children:"PO öffnen"}):null]})]})});const te=cn(x.orderDate),ve=cn(x.etdDate),I=cn(x.etaDate||x.targetDeliveryDate),ie=te??ve,le=ve;if(ie!=null&&le!=null){const he=Sn({startMs:ie,endMs:le}),Ee=`${x.id}:production`;f.push({id:Ee,group:x.id,title:`FO ${x.displayNumber} · Produktion`,startMs:he.startMs,endMs:he.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-production",tooltip:[`FO: ${x.displayNumber}`,`Produkt: ${x.alias} (${x.sku})`,`Produktion: ${Ct(x.orderDate)} bis ${Ct(x.etdDate)}`].join(`
`)}),C.set(Ee,x)}if(I!=null){const Ee=Sn({startMs:ve??te??I,endMs:I}),ke=`${x.id}:transit`;f.push({id:ke,group:x.id,title:`FO ${x.displayNumber} · Transit`,startMs:Ee.startMs,endMs:Ee.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-transit",tooltip:[`FO: ${x.displayNumber}`,`Produkt: ${x.alias} (${x.sku})`,`Transit: ${Ct(x.etdDate||x.orderDate)} bis ${Ct(x.etaDate||x.targetDeliveryDate)}`].join(`
`)}),C.set(ke,x)}}),{groups:s,items:f,itemRowMap:C}},[q,r,$e,a.pos]);o.useEffect(()=>{A(s=>s.filter(f=>{const C=He.get(f);return!!C&&qt(C==null?void 0:C.status)}))},[He]);const de=o.useMemo(()=>[{header:"Merge",meta:{width:84,minWidth:84},cell:({row:s})=>{const f=qt(s.original.status);return n.jsx(Qt,{checked:q.includes(s.original.id),disabled:!f,onChange:C=>{Le(s.original.id,C.target.checked)}})}},{header:"FO",cell:({row:s})=>s.original.displayNumber},{header:"Produkt",meta:{width:220,minWidth:220},cell:({row:s})=>n.jsx(ci,{alias:s.original.alias,sku:s.original.sku})},{header:"Supplier",accessorKey:"supplierName"},{header:"Units",cell:({row:s})=>Mt(s.original.units,0)},{header:"Target",cell:({row:s})=>Ct(s.original.targetDeliveryDate)},{header:"Order",cell:({row:s})=>Ct(s.original.orderDate)},{header:"ETD / ETA",meta:{sortAccessor:vu},cell:({row:s})=>n.jsxs(qe,{direction:"vertical",size:0,children:[n.jsxs(Ge,{children:["ETD ",Ct(s.original.etdDate)]}),n.jsxs(Ge,{type:"secondary",children:["ETA ",Ct(s.original.etaDate)]})]})},{header:"Landed EUR",cell:({row:s})=>vr(s.original.landedCostEur)},{header:"Empfehlung",cell:({row:s})=>s.original.recommendationText},{header:"Forecast-Basis",meta:{width:210,minWidth:210},cell:({row:s})=>n.jsxs(qe,{direction:"vertical",size:0,children:[n.jsx(Ge,{children:s.original.forecastBasisLabel||"—"}),n.jsx(Ge,{type:"secondary",children:mu(s.original.forecastConflictState)})]})},{header:"Status",cell:({row:s})=>_r(s.original.status)},{header:"Aktionen",meta:{width:250,minWidth:250},cell:({row:s})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(Ie,{size:"small",onClick:()=>{tn(s.original.raw)},children:qt(s.original.status)?"Bearbeiten":"Details"}),n.jsx(Ie,{size:"small",disabled:!qt(s.original.status),onClick:()=>{nt(s.original)},children:"Convert"}),s.original.convertedPoNo?n.jsx(Ie,{size:"small",onClick:()=>{const f=new URLSearchParams;f.set("source","fo_convert"),f.set("poNo",String(s.original.convertedPoNo||"")),r(`/v2/orders/po?${f.toString()}`)},children:"PO öffnen"}):null,n.jsx(Ie,{size:"small",danger:!0,disabled:!qt(s.original.status),onClick:()=>{Rt.confirm({title:"FO loeschen?",onOk:async()=>{await p(f=>{const C=dn(f);return C.fos=(Array.isArray(C.fos)?C.fos:[]).filter(x=>String(x.id||"")!==s.original.id),C},"v2:fo:delete")}})},children:"Loeschen"})]})}],[q,r,p,a.pos]),m=Se.useWatch([],O),Ne=o.useMemo(()=>S&&$e.find(s=>s.id===S)||null,[S,$e]),ue=o.useMemo(()=>wn((m==null?void 0:m.status)||(Ne==null?void 0:Ne.status)||"DRAFT"),[m==null?void 0:m.status,Ne==null?void 0:Ne.status]),ge=!qt(ue),Re=Q.readOnly||ge,st=String((Ne==null?void 0:Ne.convertedPoNo)||((l=Ne==null?void 0:Ne.raw)==null?void 0:l.convertedPoNo)||"").trim(),Ke=o.useMemo(()=>{var f;const s=String((m==null?void 0:m.sku)||"").trim();return s&&((f=fe.get(s))==null?void 0:f.raw)||null},[m==null?void 0:m.sku,fe]),dt=o.useMemo(()=>In({state:J,product:Ke||void 0,sku:String((m==null?void 0:m.sku)||""),supplierId:String((m==null?void 0:m.supplierId)||(Ke==null?void 0:Ke.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:m==null?void 0:m.unitPrice,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,incoterm:m==null?void 0:m.incoterm,currency:m==null?void 0:m.currency,fxRate:m==null?void 0:m.fxRate}}),[m==null?void 0:m.currency,m==null?void 0:m.dutyRatePct,m==null?void 0:m.eustRatePct,m==null?void 0:m.fxRate,m==null?void 0:m.incoterm,m==null?void 0:m.logisticsLeadTimeDays,m==null?void 0:m.productionLeadTimeDays,m==null?void 0:m.sku,m==null?void 0:m.supplierId,m==null?void 0:m.unitPrice,Ke,J]),lt=o.useMemo(()=>In({state:J,product:Ke||void 0,sku:String((m==null?void 0:m.sku)||""),supplierId:String((m==null?void 0:m.supplierId)||(Ke==null?void 0:Ke.supplierId)||""),orderContext:"fo"}),[m==null?void 0:m.sku,m==null?void 0:m.supplierId,Ke,J]),Ot=o.useMemo(()=>ar({product:Ke,state:J,supplierId:String((m==null?void 0:m.supplierId)||(Ke==null?void 0:Ke.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:m==null?void 0:m.unitPrice,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,incoterm:m==null?void 0:m.incoterm}}),[m==null?void 0:m.dutyRatePct,m==null?void 0:m.eustRatePct,m==null?void 0:m.incoterm,m==null?void 0:m.logisticsLeadTimeDays,m==null?void 0:m.productionLeadTimeDays,m==null?void 0:m.supplierId,m==null?void 0:m.unitPrice,Ke,J]);function bt(s){if(s==="unitPrice"){O.setFieldValue("unitPrice",Sr(Ke));return}if(s==="productionLeadTimeDays"){O.setFieldValue("productionLeadTimeDays",Number(lt.fields.productionLeadTimeDays.value||0));return}if(s==="logisticsLeadTimeDays"){const f=jn(O.getFieldValue("transportMode"));O.setFieldValue("logisticsLeadTimeDays",sr(Y,f).days);return}if(s==="dutyRatePct"){O.setFieldValue("dutyRatePct",Number(lt.fields.dutyRatePct.value||0));return}if(s==="eustRatePct"){O.setFieldValue("eustRatePct",Number(lt.fields.eustRatePct.value||0));return}if(s==="incoterm"){const f=Ce.get(String(O.getFieldValue("supplierId")||""));O.setFieldValue("incoterm",String((f==null?void 0:f.incotermDefault)||lt.fields.incoterm.value||"EXW").toUpperCase());return}if(s==="currency"){O.setFieldValue("currency","USD");return}O.setFieldValue("fxRate",zn(Y))}function ht(s,f){const C=String((Ke==null?void 0:Ke.sku)||(m==null?void 0:m.sku)||"").trim();C&&Rt.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${C}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{Rt.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await p(x=>{const Z=dn(x),te=Array.isArray(Z.products)?[...Z.products]:[],ve=te.findIndex(ie=>String(ie.sku||"").trim().toLowerCase()===C.toLowerCase());if(ve<0)return Z;const I=te[ve];return te[ve]={...fi({product:I,field:s,value:f}),updatedAt:vn()},Z.products=te,Z},"v2:fo:adopt-masterdata"),Jt.success("Produkt-Stammdaten aktualisiert.")}})}})}const Lt=o.useMemo(()=>{var C;const s=String((m==null?void 0:m.sku)||"").trim(),f=s&&((C=fe.get(s))==null?void 0:C.raw)||null;return Su({product:f,settings:Y,transportMode:(m==null?void 0:m.transportMode)||null})},[m==null?void 0:m.sku,m==null?void 0:m.transportMode,fe,Y]),ct=o.useMemo(()=>br({targetDeliveryDate:m==null?void 0:m.targetDeliveryDate,productionLeadTimeDays:m==null?void 0:m.productionLeadTimeDays,logisticsLeadTimeDays:m==null?void 0:m.logisticsLeadTimeDays,bufferDays:m==null?void 0:m.bufferDays}),[m]),Ut=o.useMemo(()=>{const s=Math.max(0,Number((m==null?void 0:m.units)||0)),f=Math.max(0,Number((m==null?void 0:m.freight)||0));return rr(s*f)},[m==null?void 0:m.freight,m==null?void 0:m.units]),Yt=o.useMemo(()=>va({units:m==null?void 0:m.units,unitPrice:m==null?void 0:m.unitPrice,currency:m==null?void 0:m.currency,freight:Ut,freightCurrency:m==null?void 0:m.freightCurrency,dutyRatePct:m==null?void 0:m.dutyRatePct,eustRatePct:m==null?void 0:m.eustRatePct,fxRate:m==null?void 0:m.fxRate}),[m,Ut]),Qe=o.useMemo(()=>{const s=(m==null?void 0:m.sku)||"";if(!s)return null;const f=Number((m==null?void 0:m.productionLeadTimeDays)||0)+Number((m==null?void 0:m.logisticsLeadTimeDays)||0)+Number((m==null?void 0:m.bufferDays)||0),C=Ir(we.map(x=>x.raw),s);return ya({context:re,sku:s,leadTimeDays:f,product:C,settings:Y,horizonMonths:12,requiredArrivalMonth:m!=null&&m.targetDeliveryDate?String(m.targetDeliveryDate).slice(0,7):null})},[m,we,re,Y]),Et=o.useMemo(()=>du(Qe==null?void 0:Qe.coverageDemandBreakdown),[Qe==null?void 0:Qe.coverageDemandBreakdown]),Gt=o.useMemo(()=>Et.reduce((s,f)=>s+Number(f.demandUnitsInWindow||0),0),[Et]),on=o.useMemo(()=>m?Er({supplierTerms:Array.isArray(m.paymentTerms)?m.paymentTerms:[],schedule:ct,unitPrice:m.unitPrice,units:m.units,currency:m.currency,freight:Ut,freightCurrency:m.freightCurrency,dutyRatePct:m.dutyRatePct,eustRatePct:m.eustRatePct,fxRate:m.fxRate,incoterm:m.incoterm,vatRefundLagMonths:Y.vatRefundLagMonths,paymentDueDefaults:Y.paymentDueDefaults}).map(f=>{const C=f.currency==="EUR"?Number(f.amount||0):Ys(f.amount,f.currency,m.fxRate);return{id:String(f.id||""),label:String(f.label||""),category:f.category,currency:String(f.currency||"EUR"),amount:Number(f.amount||0),plannedEur:Number.isFinite(C)?C:0,dueDate:f.dueDate?String(f.dueDate):null,triggerEvent:String(f.triggerEvent||"ORDER_DATE"),offsetDays:Number(f.offsetDays||0),offsetMonths:Number(f.offsetMonths||0)}}):[],[m,ct,Ut,Y.paymentDueDefaults,Y.vatRefundLagMonths]),ln=o.useMemo(()=>ba((m==null?void 0:m.paymentTerms)||[]),[m==null?void 0:m.paymentTerms]);o.useEffect(()=>{!P||!Q.readOnly||!Q.remoteDraftPatch||O.setFieldsValue(Q.remoteDraftPatch)},[O,Q.readOnly,Q.remoteDraftPatch,Q.remoteDraftVersion,P]);function hn(s,f){var De;const C=we.find(Me=>pu(Me.raw))||we[0]||null,x=String((f==null?void 0:f.sku)||(s==null?void 0:s.sku)||(C==null?void 0:C.sku)||""),Z=fe.get(x)||C,te=String((f==null?void 0:f.supplierId)||(s==null?void 0:s.supplierId)||(Z==null?void 0:Z.supplierId)||((De=pe[0])==null?void 0:De.id)||""),ve=Ce.get(te)||null,I=Number((f==null?void 0:f.units)??(s==null?void 0:s.units)??0),ie=Br({state:J,product:(Z==null?void 0:Z.raw)||null,supplier:ve||null,settings:Y,supplierId:te}),le=kn(s==null?void 0:s.payments,ve||void 0),he=Kt(s==null?void 0:s.units),Ee=Kt(s==null?void 0:s.freight),ke=he!=null&&Ee!=null?rr(Ee/he):null;return{id:s!=null&&s.id?String(s.id):void 0,sku:x,supplierId:te,status:wn((s==null?void 0:s.status)||(f==null?void 0:f.status)||"DRAFT"),targetDeliveryDate:String((f==null?void 0:f.targetDeliveryDate)||(s==null?void 0:s.targetDeliveryDate)||new Date().toISOString().slice(0,10)),units:I,transportMode:jn((s==null?void 0:s.transportMode)||ie.transportMode||"RAIL"),incoterm:String((s==null?void 0:s.incoterm)||ie.incoterm||"EXW").toUpperCase(),unitPrice:Number((s==null?void 0:s.unitPrice)??ie.unitPrice??0),currency:String((s==null?void 0:s.currency)||ie.currency||"USD").toUpperCase(),freight:Number(ke??(f==null?void 0:f.freight)??ie.freight??0),freightCurrency:"EUR",dutyRatePct:Number((s==null?void 0:s.dutyRatePct)??ie.dutyRatePct??0),eustRatePct:Number((s==null?void 0:s.eustRatePct)??ie.eustRatePct??0),fxRate:Number((s==null?void 0:s.fxRate)??ie.fxRate??zn(Y)),productionLeadTimeDays:Number((s==null?void 0:s.productionLeadTimeDays)??ie.productionLeadTimeDays??45),logisticsLeadTimeDays:Number((s==null?void 0:s.logisticsLeadTimeDays)??ie.logisticsLeadTimeDays??45),bufferDays:Number((s==null?void 0:s.bufferDays)??ie.bufferDays??Y.defaultBufferDays??0),paymentTerms:le}}function Mn(s,f){const C=String(s||"").trim();if(!C)return;const x=fe.get(C)||null;if(!x)return;const Z=O.getFieldsValue(),te=String(x.supplierId||Z.supplierId||""),ve=Ce.get(te)||null,I=Br({state:J,product:x.raw,supplier:ve||null,settings:Y,supplierId:te,transportMode:"RAIL",units:Number(Z.units??0)});O.setFieldsValue({supplierId:te||Z.supplierId,transportMode:I.transportMode,incoterm:I.incoterm,unitPrice:Sr(x.raw),currency:I.currency,freight:I.freight,freightCurrency:"EUR",dutyRatePct:I.dutyRatePct,eustRatePct:I.eustRatePct,fxRate:zn(Y),productionLeadTimeDays:I.productionLeadTimeDays,logisticsLeadTimeDays:I.logisticsLeadTimeDays,bufferDays:I.bufferDays,paymentTerms:kn([],ve||void 0)})}function un(s){var le;const f=String(s||"").trim(),C=O.getFieldsValue(),x=String(C.sku||"").trim(),Z=x&&((le=fe.get(x))==null?void 0:le.raw)||null,te=Ce.get(f)||null,ve=jn(C.transportMode||"RAIL"),I=Br({state:J,product:Z,supplier:te||null,settings:Y,supplierId:f,transportMode:ve,units:Number(C.units||0)}),ie=Kt(te==null?void 0:te.productionLeadTimeDaysDefault);O.setFieldsValue({supplierId:f,incoterm:String((te==null?void 0:te.incotermDefault)||I.incoterm||C.incoterm||"EXW").toUpperCase(),productionLeadTimeDays:Number(ie??I.productionLeadTimeDays??C.productionLeadTimeDays??0),logisticsLeadTimeDays:sr(Y,ve).days,paymentTerms:kn([],te||void 0),unitPrice:Sr(Z),currency:"USD",fxRate:zn(Y),freight:I.freight,freightCurrency:"EUR"})}function Wt(s){w(null);const f=hn(null,s);O.setFieldsValue({...f,...s||{}}),$(!0)}function tn(s){w(String(s.id||"")),O.setFieldsValue(hn(s)),$(!0)}function pn(){if(je.length<2){Jt.warning("Bitte mindestens 2 aktive FOs fuer den Merge auswaehlen.");return}const f=Fe||"";g(wa(Array.isArray(a.pos)?a.pos:[])),L(""),H("earliest"),z(f),W(!1),T(!0)}async function _t(s){var be;if(Q.readOnly)throw new Error("Dieser FO wird gerade von einem anderen Nutzer bearbeitet.");const f=String(s.sku||"").trim(),C=f?Ir(we.map(ze=>ze.raw),f):null,x=String((C==null?void 0:C.supplierId)||"").trim(),Z=String(s.supplierId||x||"").trim();if(!Z)throw new Error("Supplier ist erforderlich.");if(!C&&!s.supplierId)throw new Error("SKU nicht gefunden. Bitte Produkt prüfen.");const te=S&&((be=$e.find(ze=>ze.id===S))==null?void 0:be.raw)||null,ve=wn((te==null?void 0:te.status)||"DRAFT"),I=wn(s.status||ve||"DRAFT");let ie=I;te&&!qt(ve)?ie=ve:qt(I)||(ie=te?ve:"DRAFT");const le={...s,supplierId:Z,status:ie},he=ar({product:C,state:J,supplierId:Z,orderContext:"fo",orderOverrides:{unitPrice:le.unitPrice,productionLeadTimeDays:le.productionLeadTimeDays,logisticsLeadTimeDays:le.logisticsLeadTimeDays,dutyRatePct:le.dutyRatePct,eustRatePct:le.eustRatePct,incoterm:le.incoterm}});if(he.blocked)throw new Error(`Blockierende Stammdaten fehlen: ${he.issues.map(ze=>ze.label).join(", ")}`);const Ee=(s.paymentTerms||[]).map(ze=>({id:ze.id,label:String(ze.label||"Milestone"),percent:Number(ze.percent||0),triggerEvent:String(ze.triggerEvent||"ORDER_DATE").toUpperCase(),offsetDays:Number(ze.offsetDays||0),offsetMonths:Number(ze.offsetMonths||0)})),ke=ba(Ee);if(Math.abs(ke-100)>.01)throw new Error("Supplier Payment Terms muessen in Summe 100% ergeben.");const De=br({targetDeliveryDate:le.targetDeliveryDate,productionLeadTimeDays:le.productionLeadTimeDays,logisticsLeadTimeDays:le.logisticsLeadTimeDays,bufferDays:le.bufferDays}),Me=Math.max(0,Number(le.freight||0)),Oe=rr(Me*Math.max(0,Number(le.units||0))),Ye=Gs({existing:te,supplierTerms:Ee,values:{...le,freight:Oe,freightCurrency:"EUR",forecastBasisVersionId:(ye==null?void 0:ye.id)||null,forecastBasisVersionName:(ye==null?void 0:ye.name)||null,forecastBasisSetAt:vn()},schedule:De,vatRefundLagMonths:Y.vatRefundLagMonths,paymentDueDefaults:Y.paymentDueDefaults});await p(ze=>{const ut=dn(ze),pt=Array.isArray(ut.fos)?[...ut.fos]:[],St={...Ye},rn=pt.findIndex(Xt=>String(Xt.id||"")===String(St.id||""));if(rn>=0)pt[rn]=St;else{if(!String(St.foNo||"").trim()||!String(St.foNumber||"").trim()){const Xt=Xs(pt,St.createdAt||St.updatedAt||vn());String(St.foNo||"").trim()||(St.foNo=Xt.foNo),String(St.foNumber||"").trim()||(St.foNumber=Xt.foNumber)}pt.push(St)}return ut.fos=pt,ut},S?"v2:fo:update":"v2:fo:create"),Q.clearDraft(),$(!1),w(null),O.resetFields()}async function nn(){const s=j;if(!s)return;const f=String(U||"").trim();if(!f)throw new Error("PO Nummer ist erforderlich.");await p(C=>{var Me,Oe;const x=dn(C),Z=Array.isArray(x.pos)?[...x.pos]:[],te=Array.isArray(x.fos)?[...x.fos]:[];if(Z.some(Ye=>String(Ye.poNo||"")===f))throw new Error(`PO Nummer ${f} existiert bereits.`);const ve=te.findIndex(Ye=>String(Ye.id||"")===s);if(ve<0)throw new Error("FO nicht gefunden.");const I={...te[ve]};if(!qt(I.status))throw new Error("Nur aktive FOs (Draft/Active) koennen konvertiert werden.");const ie=Qs({fo:I,poNumber:f,orderDateOverride:X||String(I.orderDate||"")});Z.push(ie);const he=new Map((Array.isArray(x.suppliers)?x.suppliers:[]).map(Ye=>Ye).map(Ye=>[String(Ye.id||""),Ye])).get(String(I.supplierId||""))||null,Ee=kn(I.payments,he||void 0),ke=Wn({orderDate:X||I.orderDate,productionLeadTimeDays:I.productionLeadTimeDays,logisticsLeadTimeDays:I.logisticsLeadTimeDays,bufferDays:I.bufferDays,deliveryDate:I.targetDeliveryDate}),De=Er({supplierTerms:Ee,schedule:ke,unitPrice:I.unitPrice,units:I.units,currency:I.currency,freight:I.freight,freightCurrency:I.freightCurrency,dutyRatePct:I.dutyRatePct,eustRatePct:I.eustRatePct,fxRate:I.fxRate,incoterm:I.incoterm,vatRefundLagMonths:(Me=x.settings)==null?void 0:Me.vatRefundLagMonths,paymentDueDefaults:(Oe=x.settings)==null?void 0:Oe.paymentDueDefaults});return te[ve]={...I,...ke,payments:De,status:"CONVERTED",convertedPoId:ie.id,convertedPoNo:ie.poNo,updatedAt:vn()},x.pos=Z,x.fos=te,x},"v2:fo:convert"),E(!1),K(null),A(C=>C.filter(x=>x!==s)),Jt.success(`FO wurde in PO ${f} konvertiert.`)}async function Ht(){const s=je;if(s.length<2)throw new Error("Bitte mindestens 2 FOs auswaehlen.");if(et)throw new Error("Merge ist nur mit gleichem Lieferanten erlaubt.");if(Ve&&!b)throw new Error("Bitte gemischte Transport/Incoterm explizit bestaetigen.");const f=String(D||"").trim();if(!f)throw new Error("PO Nummer ist erforderlich.");const C=Ue;if(R==="manual"&&!C)throw new Error("Bitte ein manuelles Ziel-Lieferdatum setzen.");await p(x=>{var De;const Z=dn(x),te=Array.isArray(Z.pos)?[...Z.pos]:[],ve=Array.isArray(Z.fos)?[...Z.fos]:[];if(te.some(Me=>String(Me.poNo||"")===f))throw new Error(`PO Nummer ${f} existiert bereits.`);const I=s.map(Me=>String(Me.id||"")),ie=ve.filter(Me=>I.includes(String(Me.id||""))).map(Me=>({...Me}));if(ie.length!==s.length)throw new Error("Nicht alle ausgewaehlten FOs konnten geladen werden.");if(ie.some(Me=>!qt(Me.status)))throw new Error("Enthaelt bereits konvertierte oder archivierte FOs.");const le=Js({fos:ie,poNumber:f,orderDateOverride:k||null,targetDeliveryDate:C});te.push(le);const he=new Map((Array.isArray(Z.suppliers)?Z.suppliers:[]).map(Me=>Me).map(Me=>[String(Me.id||""),Me])),Ee=(De=Z.settings)==null?void 0:De.vatRefundLagMonths,ke=ve.map(Me=>{var St;const Oe=Me,Ye=String(Oe.id||"");if(!I.includes(Ye))return Oe;const be=he.get(String(Oe.supplierId||""))||null,ze=kn(Oe.payments,be||void 0),ut=Wn({orderDate:k||le.orderDate||Oe.orderDate,productionLeadTimeDays:Oe.productionLeadTimeDays,logisticsLeadTimeDays:Oe.logisticsLeadTimeDays,bufferDays:Oe.bufferDays,deliveryDate:C||Oe.targetDeliveryDate}),pt=Er({supplierTerms:ze,schedule:ut,unitPrice:Oe.unitPrice,units:Oe.units,currency:Oe.currency,freight:Oe.freight,freightCurrency:Oe.freightCurrency,dutyRatePct:Oe.dutyRatePct,eustRatePct:Oe.eustRatePct,fxRate:Oe.fxRate,incoterm:Oe.incoterm,vatRefundLagMonths:Ee,paymentDueDefaults:(St=Z.settings)==null?void 0:St.paymentDueDefaults});return{...Oe,...ut,payments:pt,status:"CONVERTED",convertedPoId:le.id,convertedPoNo:le.poNo,updatedAt:vn()}});return Z.pos=te,Z.fos=ke,Z},"v2:fo:merge-convert"),T(!1),A([]),W(!1),L(""),z(""),g(""),H("earliest"),Jt.success(`FO-Merge erstellt PO ${f}.`)}return o.useEffect(()=>{const s=new URLSearchParams(t.search),f=s.get("source"),C=ie=>{const le=new URLSearchParams(t.search);ie.forEach(Ee=>le.delete(Ee));const he=le.toString();r({pathname:t.pathname,search:he?`?${he}`:""},{replace:!0})};if(f==="orders_sku"){const ie=String(s.get("foId")||"").trim();if(ie){const le=(Array.isArray(a.fos)?a.fos:[]).map(he=>he).find(he=>String(he.id||"")===ie);le&&tn(le)}C(["source","foId"]);return}if(f==="phantom_fo"){const ie=String(s.get("sku")||"").trim();if(!ie){C(["source","phantomId","sku","month","suggestedUnits","requiredArrivalDate","recommendedOrderDate","firstRiskMonth","orderMonth","leadTimeDays","returnTo"]);return}const le=fe.get(ie)||null,he=Math.max(0,Math.round(Number(s.get("suggestedUnits")||0))),Ee=String(s.get("requiredArrivalDate")||""),ke={sku:ie,units:he,status:"ACTIVE"};le!=null&&le.supplierId&&(ke.supplierId=String(le.supplierId)),Ee&&(ke.targetDeliveryDate=Ee),Wt(ke),Jt.info("Phantom-FO geladen. Bitte Daten prüfen, bei Bedarf anpassen und speichern."),C(["source","phantomId","sku","month","suggestedUnits","requiredArrivalDate","recommendedOrderDate","firstRiskMonth","orderMonth","leadTimeDays","returnTo"]);return}if(f!=="inventory_projection")return;const x=String(s.get("sku")||"").trim();if(!x){C(["source"]);return}const Z=fe.get(x)||null,te=Math.max(0,Math.round(Number(s.get("suggestedUnits")||0))),ve=String(s.get("requiredArrivalDate")||""),I={sku:x,units:te,status:"ACTIVE"};Z!=null&&Z.supplierId&&(I.supplierId=String(Z.supplierId)),ve&&(I.targetDeliveryDate=ve),Wt(I),C(["source","sku","month","suggestedUnits","projectedEnd","mode","requiredArrivalDate","recommendedOrderDate","returnTo","nextSku","nextMonth","nextSuggestedUnits","nextRequiredArrivalDate","nextRecommendedOrderDate"])},[t.pathname,t.search,r,fe,a.fos]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(It,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(cu,{level:3,children:"Forecast Orders"}),n.jsx(uu,{children:"FO ist ein Planobjekt je SKU (inkl. Plan-Meilensteinen). Zahlungen werden erst nach PO-Conversion im PO-Flow bestätigt."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(Ie,{type:"primary",onClick:()=>Wt(),children:"Create FO"}),n.jsx(sa,{value:ae,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:s=>xe(String(s)==="timeline"?"timeline":"table")}),u?n.jsx(mt,{color:"processing",children:"Speichern..."}):null,d?n.jsxs(mt,{color:"green",children:["Gespeichert: ",new Date(d).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(kt,{type:"error",showIcon:!0,message:c}):null,i?n.jsx(kt,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(It,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(gt,{placeholder:"Alias, SKU, Supplier",value:h,onChange:s=>y(s.target.value),style:{width:280}}),n.jsx(Dt,{value:M,onChange:s=>N(s),options:[{value:"ALL",label:"Alle Status"},...Ws.map(s=>({value:s,label:s}))],style:{width:190}}),n.jsx(Ie,{onClick:pn,disabled:je.length<2,children:"Create PO from FOs"}),n.jsxs(mt,{children:[je.length," ausgewählt"]})]}),ae==="table"?n.jsx(ui,{data:$e,columns:de,minTableWidth:1400,tableLayout:"auto"}):n.jsx(ls,{className:"v2-orders-gantt--fo",groups:Be.groups,items:Be.items,visibleStartMs:ee.visibleStartMs,visibleEndMs:ee.visibleEndMs,sidebarWidth:340,lineHeight:72,sidebarHeaderLabel:"FO / Produkt",emptyMessage:"Keine Forecast Orders für die aktuelle Suche/Filter.",onItemSelect:s=>{const f=Be.itemRowMap.get(s);f&&tn(f.raw)}})]}),n.jsxs(Rt,{title:S?"FO bearbeiten":"FO anlegen",open:P,width:1120,onCancel:()=>{Q.clearDraft(),$(!1)},onOk:()=>{if(Re){if(ge&&!Q.readOnly){Rt.info({title:"Read-only FO",content:"Konvertierte oder archivierte FOs sind schreibgeschuetzt. Bitte ueber PO weiterarbeiten."});return}Rt.warning({title:"Nur Lesemodus",content:`${Q.remoteUserLabel||"Kollege"} bearbeitet diesen FO. Bitte Bearbeitung übernehmen oder warten.`});return}O.validateFields().then(s=>_t(s)).catch(()=>{})},children:[Q.banner?n.jsx(kt,{style:{marginBottom:10},type:Q.banner.tone,showIcon:!0,message:Q.banner.text,action:Q.readOnly?n.jsx(Ie,{size:"small",onClick:Q.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,Q.readOnly&&Q.remoteDraftVersion>0?n.jsxs(mt,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",Q.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,n.jsxs(qe,{style:{width:"100%",marginBottom:10},wrap:!0,children:[n.jsx(Ge,{type:"secondary",children:"Status:"}),_r(ue),qt(ue)?n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>O.setFieldValue("status",fu(ue)),children:ue==="ACTIVE"?"Als Draft markieren":"Als Active markieren"}):n.jsx(mt,{color:"default",children:"Read-only"}),st?n.jsx(Ie,{size:"small",onClick:()=>{const s=new URLSearchParams;s.set("source","fo_convert"),s.set("poNo",st),r(`/v2/orders/po?${s.toString()}`)},children:"Zugehoerige PO oeffnen"}):null]}),n.jsxs(Se,{name:"v2-fo-modal",form:O,layout:"vertical",disabled:Re,onValuesChange:s=>{Re||Q.publishDraftPatch(s)},children:[n.jsx(Se.Item,{name:"id",hidden:!0,children:n.jsx(gt,{})}),n.jsx(Se.Item,{name:"status",hidden:!0,children:n.jsx(gt,{})}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"sku",label:"Produkt (SKU)",style:{minWidth:230,flex:1},rules:[{required:!0,message:"SKU ist erforderlich."}],children:n.jsx(Dt,{showSearch:!0,optionFilterProp:"label",options:we.map(s=>({value:s.sku,label:`${s.alias} (${s.sku})`})),onChange:s=>{Mn(String(s||""))}})}),n.jsx(Se.Item,{name:"supplierId",label:"Supplier",style:{minWidth:230,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Dt,{showSearch:!0,optionFilterProp:"label",options:pe.map(s=>({value:s.id,label:s.name})),onChange:s=>{un(String(s||""))}})})]}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"units",label:"Units",style:{width:130},rules:[{required:!0,message:"Units sind erforderlich."}],children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Se.Item,{name:"targetDeliveryDate",label:"Target Delivery",style:{width:190},rules:[{required:!0,message:"Zieltermin ist erforderlich."}],children:n.jsx(gt,{type:"date"})}),n.jsx(Se.Item,{name:"transportMode",label:"Transport",style:{width:140},children:n.jsx(Dt,{options:Ks.map(s=>({value:s,label:s})),onChange:s=>{const f=jn(s);O.setFieldsValue({transportMode:f,logisticsLeadTimeDays:sr(Y,f).days})}})}),n.jsx(Se.Item,{name:"incoterm",label:"Incoterm",style:{width:130},children:n.jsx(Dt,{options:qs.map(s=>({value:s,label:s}))})}),n.jsx(Se.Item,{name:"currency",label:"Currency",style:{width:130},children:n.jsx(Dt,{options:Vs.map(s=>({value:s,label:s}))})}),n.jsx(Se.Item,{name:"fxRate",label:"FX Rate",style:{width:140},children:n.jsx(vt,{mode:"fx",min:0})})]}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"unitPrice",label:"Unit Price (USD/Stück)",style:{width:190},children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{name:"freight",label:"Shipping costs (EUR/Stück)",style:{width:210},children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{name:"freightCurrency",label:"Shipping Currency",style:{width:160},children:n.jsx(Dt,{disabled:!0,options:[{value:"EUR",label:"EUR"}]})}),n.jsx(Se.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(vt,{mode:"percent",min:0,max:100})}),n.jsx(Se.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(vt,{mode:"percent",min:0,max:100})})]}),n.jsx("div",{style:{marginTop:-6,marginBottom:10},children:n.jsxs(Ge,{type:"secondary",children:["Shipping total: ",vr(Ut)," (",Mt((m==null?void 0:m.units)||0,0)," x ",Mt((m==null?void 0:m.freight)||0,2)," EUR/Stück)"]})}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"productionLeadTimeDays",label:"Production Lead Days",style:{width:220},children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Se.Item,{name:"logisticsLeadTimeDays",label:"Logistics Lead Days",style:{width:220},children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Se.Item,{name:"bufferDays",label:"Buffer Days",style:{width:180},children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Ie,{disabled:Re,onClick:()=>{const s=O.getFieldsValue(),f=Ce.get(String(s.supplierId||"")),C=kn([],f||void 0);O.setFieldsValue({incoterm:String((f==null?void 0:f.incotermDefault)||s.incoterm||"EXW").toUpperCase(),currency:"USD",fxRate:zn(Y),paymentTerms:C})},children:"Supplier Terms"})]}),n.jsx("div",{style:{marginTop:-2,marginBottom:10},children:n.jsxs(Ge,{type:"secondary",children:["Quelle Leadtime: Produktion = ",Lt.production," · Logistik = ",Lt.logistics]})}),Ot.blocked?n.jsx(kt,{type:"error",showIcon:!0,style:{marginBottom:12},message:"Blockierende Stammdaten fehlen",description:Ot.issues.map(s=>s.label).join(", ")}):null,n.jsx(It,{size:"small",style:{marginBottom:12},children:n.jsxs(qe,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(Ge,{strong:!0,children:"Stammdaten-Herkunft (FO)"}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Price"}),n.jsx("span",{className:Zt(dt.fields.unitPriceUsd.source,!0),children:dt.fields.unitPriceUsd.label}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("unitPrice"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("unitPriceUsd",m==null?void 0:m.unitPrice),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Production Lead"}),n.jsx("span",{className:Zt(dt.fields.productionLeadTimeDays.source,!0),children:dt.fields.productionLeadTimeDays.label}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("productionLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("productionLeadTimeDays",m==null?void 0:m.productionLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Logistics Lead"}),n.jsx("span",{className:Zt(dt.fields.transitDays.source,!1),children:dt.fields.transitDays.label}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("logisticsLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("transitDays",m==null?void 0:m.logisticsLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Zt(dt.fields.dutyRatePct.source,!1),children:dt.fields.dutyRatePct.label}),n.jsx("span",{className:Zt(dt.fields.eustRatePct.source,!1),children:dt.fields.eustRatePct.label}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("dutyRatePct"),children:"Duty reset"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("eustRatePct"),children:"EUSt reset"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("dutyRatePct",m==null?void 0:m.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("eustRatePct",m==null?void 0:m.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Incoterm"}),n.jsx("span",{className:Zt(dt.fields.incoterm.source,!0),children:dt.fields.incoterm.label}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>bt("incoterm"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",disabled:Re,onClick:()=>ht("ddp",String((m==null?void 0:m.incoterm)||"").toUpperCase()==="DDP"),children:"Als Produktwert uebernehmen"})]})]})}),n.jsx(It,{size:"small",style:{marginBottom:12},children:n.jsxs(qe,{direction:"vertical",size:4,children:[n.jsx(Ge,{strong:!0,children:"Schedule Preview"}),n.jsxs(Ge,{children:["Order Date: ",Ct(ct.orderDate)]}),n.jsxs(Ge,{children:["Production End: ",Ct(ct.productionEndDate)]}),n.jsxs(Ge,{children:["ETD: ",Ct(ct.etdDate)]}),n.jsxs(Ge,{children:["ETA: ",Ct(ct.etaDate)]}),n.jsxs(Ge,{children:["Landed Cost: ",vr(Yt.landedCostEur)]})]})}),n.jsx(It,{size:"small",style:{marginBottom:12},children:n.jsxs(qe,{direction:"vertical",size:4,children:[n.jsx(Ge,{strong:!0,children:"FO Empfehlung"}),re.baselineMonth?null:n.jsx(Ge,{type:"secondary",children:"Kein Inventory Snapshot vorhanden."}),Qe?n.jsxs(n.Fragment,{children:[n.jsxs(Ge,{children:["Baseline: ",String(Qe.baselineMonth||"—")]}),n.jsxs(Ge,{children:["Status: ",String(Qe.status||"—")]}),n.jsx(Ge,{type:"secondary",children:"Empfehlung basiert auf Forecast + Coverage DOH + MOQ."}),n.jsxs(Ge,{children:["Reichweite-Bedarf (",Mt(Qe.coverageDaysForOrder,0)," Tage): ",Mt(Qe.coverageDemandUnits,0)]}),Et.length?n.jsx("div",{className:"v2-fo-breakdown-wrap",children:n.jsxs("table",{className:"v2-fo-breakdown-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Monat"}),n.jsx("th",{children:"Tage im Fenster"}),n.jsx("th",{children:"Forecast Monat"}),n.jsx("th",{children:"Beitrags-Units"})]})}),n.jsxs("tbody",{children:[Et.map(s=>n.jsxs("tr",{children:[n.jsx("td",{children:s.month}),n.jsx("td",{children:Mt(s.daysCovered,0)}),n.jsxs("td",{children:[s.forecastMonthUnits==null?"—":Mt(s.forecastMonthUnits,0),s.usedFallback?n.jsx("span",{className:"v2-fo-breakdown-flag",children:" (Fallback)"}):null]}),n.jsx("td",{children:Mt(s.demandUnitsInWindow,0)})]},`${s.month}-${s.daysCovered}`)),n.jsxs("tr",{className:"is-total",children:[n.jsx("td",{children:"Summe"}),n.jsx("td",{children:Mt(Qe.coverageDaysForOrder,0)}),n.jsx("td",{children:"—"}),n.jsx("td",{children:Mt(Gt,0)})]})]})]})}):null,n.jsxs(Ge,{children:["Rohwert (aufgerundet): ",Mt(Qe.recommendedUnitsRaw,0)]}),n.jsxs(Ge,{children:["Empfohlene Units: ",Mt(Qe.recommendedUnits,0)]}),Qe.moqApplied?n.jsxs(Ge,{type:"warning",children:["MOQ-Aufrundung: ",Mt(Qe.recommendedUnitsRaw,0)," → ",Mt(Qe.recommendedUnits,0)]}):null,n.jsxs(Ge,{children:["Arrival: ",Ct(Qe.requiredArrivalDate)]}),n.jsxs(Ge,{children:["Order: ",Ct(Qe.orderDateAdjusted||Qe.orderDate)]})]}):n.jsx(Ge,{type:"secondary",children:"Bitte SKU waehlen."})]})}),n.jsxs(It,{size:"small",children:[n.jsxs(qe,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(Ge,{strong:!0,children:"Supplier Payment Terms"}),n.jsxs(Ge,{type:Math.abs(ln-100)<=.01?"secondary":"danger",children:["Summe: ",Mt(ln,2),"%"]})]}),n.jsx(Se.List,{name:"paymentTerms",children:(s,{add:f,remove:C})=>n.jsxs(qe,{direction:"vertical",size:8,style:{width:"100%"},children:[s.map(x=>n.jsxs(qe,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(Se.Item,{...x,name:[x.name,"label"],style:{flex:2,minWidth:220},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(gt,{placeholder:"Label"})}),n.jsx(Se.Item,{...x,name:[x.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(vt,{mode:"percent",min:0,max:100})}),n.jsx(Se.Item,{...x,name:[x.name,"triggerEvent"],style:{width:170},rules:[{required:!0,message:"Trigger fehlt."}],children:n.jsx(Dt,{options:Zs.map(Z=>({value:Z,label:Z}))})}),n.jsx(Se.Item,{...x,name:[x.name,"offsetDays"],style:{width:110},children:n.jsx(vt,{mode:"int"})}),n.jsx(Ie,{danger:!0,disabled:Re,onClick:()=>C(x.name),children:"X"})]},x.key)),n.jsxs(qe,{children:[n.jsx(Ie,{disabled:Re,onClick:()=>f({label:"Milestone",percent:0,triggerEvent:"ORDER_DATE",offsetDays:0,offsetMonths:0}),children:"Milestone"}),n.jsx(Ie,{disabled:Re,onClick:()=>{const x=String(O.getFieldValue("supplierId")||""),Z=Ce.get(x)||null;O.setFieldsValue({paymentTerms:kn([],Z||void 0)})},children:"Terms laden"})]})]})}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx(Ge,{strong:!0,children:"Zahlungsfaelligkeiten (Plan)"}),n.jsx(kt,{type:"info",showIcon:!0,style:{marginTop:8},message:"FOs erzeugen nur Plan-Meilensteine. Zahlungen werden ausschließlich in POs bestätigt."}),n.jsx("div",{className:"v2-stats-table-wrap",style:{marginTop:8},children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Label"}),n.jsx("th",{children:"Soll"}),n.jsx("th",{children:"Waehrung"}),n.jsx("th",{children:"Fällig"}),n.jsx("th",{children:"Regel"})]})}),n.jsx("tbody",{children:on.length?on.map(s=>n.jsxs("tr",{children:[n.jsx("td",{children:hu(s.category)}),n.jsx("td",{children:s.label}),n.jsx("td",{children:vr(s.plannedEur)}),n.jsx("td",{children:s.currency}),n.jsx("td",{children:Ct(s.dueDate)}),n.jsx("td",{children:`${s.triggerEvent} + ${Mt(s.offsetDays,0)}d + ${Mt(s.offsetMonths,0)}m`})]},s.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Keine Zahlungszeilen."})})})]})})]})]})]})]}),n.jsx(Rt,{title:"Einzel-FO in PO konvertieren",open:F,onCancel:()=>E(!1),onOk:()=>{nn().catch(s=>{Rt.error({title:"Konvertierung fehlgeschlagen",content:s instanceof Error?s.message:String(s)})})},children:n.jsxs(qe,{direction:"vertical",style:{width:"100%"},children:[n.jsx(Ge,{children:"PO Nummer"}),n.jsx(gt,{value:U,onChange:s=>_(s.target.value)}),n.jsx(Ge,{children:"Order Date (optional)"}),n.jsx(gt,{type:"date",value:X,onChange:s=>ne(s.target.value)})]})}),n.jsx(Rt,{title:"Mehrere FOs zu einer PO bündeln",open:G,width:960,onCancel:()=>T(!1),onOk:()=>{Ht().catch(s=>{Rt.error({title:"Merge fehlgeschlagen",content:s instanceof Error?s.message:String(s)})})},children:n.jsxs(qe,{direction:"vertical",style:{width:"100%"},size:12,children:[n.jsxs(Ge,{type:"secondary",children:[je.length," FO(s) ausgewählt. Ergebnis ist eine Multi-SKU-PO mit PO-basierten Zahlungsmeilensteinen."]}),n.jsxs(qe,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Ge,{children:"PO Nummer"}),n.jsx(gt,{value:D,onChange:s=>g(s.target.value)})]}),n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Ge,{children:"Order Date (optional)"}),n.jsx(gt,{type:"date",value:k,onChange:s=>L(s.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(Ge,{strong:!0,children:"Ziel-Liefertermin der PO"}),n.jsxs(qe,{direction:"vertical",style:{marginTop:6,width:"100%"},children:[n.jsxs(Qt,{checked:R==="earliest",onChange:s=>H(s.target.checked?"earliest":"manual"),children:["Frühester FO-Zieltermin verwenden (",Ct(Fe||null),")"]}),n.jsx(Qt,{checked:R==="manual",onChange:s=>H(s.target.checked?"manual":"earliest"),children:"Manuelles Ziel setzen"}),R==="manual"?n.jsx(gt,{type:"date",value:B,onChange:s=>z(s.target.value),style:{maxWidth:240}}):null]})]}),et?n.jsx(kt,{type:"error",showIcon:!0,message:"FO-Merge nur bei gleichem Lieferanten erlaubt."}):null,Ve?n.jsx(kt,{type:"warning",showIcon:!0,message:"Gemischte Incoterms/Transportmodi erkannt.",description:n.jsxs("div",{children:[n.jsxs("div",{children:["Incoterms: ",V.join(", ")||"—"]}),n.jsxs("div",{children:["Transport: ",Ae.join(", ")||"—"]}),n.jsx(Qt,{checked:b,onChange:s=>W(s.target.checked),style:{marginTop:8},children:"Ich habe den Mix geprüft und möchte trotzdem bündeln."})]})}):null,n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"FO"}),n.jsx("th",{children:"SKU"}),n.jsx("th",{children:"Units"}),n.jsx("th",{children:"FO Ziel"}),n.jsx("th",{children:"Abweichung zur PO"})]})}),n.jsx("tbody",{children:je.length?je.map(s=>{const f=Hr(s),C=tt.find(x=>x.id===String(s.id||""));return n.jsxs("tr",{children:[n.jsx("td",{children:Na({foNo:s.foNo,foNumber:s.foNumber,id:s.id})}),n.jsx("td",{children:String(s.sku||"—")}),n.jsx("td",{children:Mt(s.units,0)}),n.jsx("td",{children:Ct(f)}),n.jsx("td",{children:C?C.status<0?n.jsx(mt,{color:"red",children:C.deviation}):C.status>0?n.jsx(mt,{color:"gold",children:C.deviation}):n.jsx(mt,{color:"green",children:C.deviation}):"—"})]},String(s.id||""))}):n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:"Keine FOs gewählt."})})})]})})]})})]})}const{Paragraph:xu,Text:at,Title:Cu}=Nn,zr={slug:"po",entityLabel:"PO",numberField:"poNo"},us=24*60*60*1e3;function Ln(e){if(!e)return null;const t=String(e||"").trim(),[r,a,i]=t.split("-").map(Number);if(!r||!a||!i)return null;const u=new Date(Date.UTC(r,a-1,i));return Number.isNaN(u.getTime())?null:u}function Mu(e){const t=String(e||"").trim();return!t||!/^\d{4}-\d{2}-\d{2}$/.test(t)?null:t}function ku(e){return Mu(e==null?void 0:e.etaDate)||"9999-12-31"}function Un(e,t){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return 0;const a=(Math.min(Math.max(e.getTime(),t.startMs),t.endMs)-t.startMs)/us;return Math.max(0,Math.min(100,a/t.totalDays*100))}function Pu(e){const t=e.state.settings||{},r=di(t.startMonth);if(r)return r;const a=e.rows.map(i=>i.orderDate).filter(i=>!!(i&&/^\d{4}-\d{2}-\d{2}$/.test(i))).sort()[0];return a?a.slice(0,7):new Date().toISOString().slice(0,7)}function wu(e){const t=e.settings||{},r=Number(t.horizonMonths||0);return!Number.isFinite(r)||r<=0?12:Math.round(r)}function jt(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const i=new Date(Date.UTC(t,r-1,a));return Number.isNaN(i.getTime())?"—":i.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function Jn(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function sn(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function Ea(e){return String(e||"").slice(-6).toUpperCase()}function ju(e){return e==="paid_only"?n.jsx(mt,{color:"green",children:"Bezahlt"}):e==="mixed"?n.jsx(mt,{color:"gold",children:"Teilweise bezahlt"}):n.jsx(mt,{color:"blue",children:"Offen"})}function Yr(e){const r=(Array.isArray(e.eventIds)?e.eventIds:[]).map(i=>String(i||"").trim()).filter(Boolean);if(r.length)return Array.from(new Set(r));const a=String(e.id||"").trim();return a?[a]:[]}function na(e){const t=String(e.eventType||"").toLowerCase(),r=`${String(e.typeLabel||"")} ${String(e.label||"")}`.toLowerCase();return r.includes("deposit")?1:r.includes("balance")?2:t==="freight"||r.includes("shipping")||r.includes("fracht")?3:t==="tax_duty_combined"||t==="duty"||t==="eust"||r.includes("zoll")||r.includes("umsatzsteuer")?4:5}function Ta(e){return[...e].sort((t,r)=>{const a=String(t.dueDate||"").localeCompare(String(r.dueDate||""));if(a!==0)return a;const i=na(t)-na(r);return i!==0?i:String(t.label||"").localeCompare(String(r.label||""))})}function Wr(e){return{id:String(e.id||""),eventIds:[String(e.id||"")],typeLabel:String(e.typeLabel||""),label:String(e.label||""),dueDate:e.dueDate?String(e.dueDate):null,plannedEur:Number(e.plannedEur||0),status:e.status==="paid"?"paid":"open",paidDate:e.paidDate?String(e.paidDate):null,paidEurActual:Number.isFinite(Number(e.paidEurActual))?Number(e.paidEurActual):null,paymentId:e.paymentId?String(e.paymentId):null,method:e.method?String(e.method):null,paidBy:e.paidBy?String(e.paidBy):null,note:String(e.note||""),invoiceDriveUrl:String(e.invoiceDriveUrl||""),invoiceFolderDriveUrl:String(e.invoiceFolderDriveUrl||""),eventType:e.eventType?String(e.eventType):null,direction:e.direction==="in"?"in":e.direction==="neutral"?"neutral":"out"}}function Yn(e){return e.eventType==="tax_duty_combined"?"Umsatzsteuer + Zoll":e.eventType==="duty"?"Zoll":e.eventType==="eust"?"EUSt":e.eventType==="vat_refund"?"EUSt-Erstattung":e.eventType==="freight"?"Shipping":e.eventType==="fx_fee"?"FX Gebuehr":String(e.typeLabel||e.label||"").trim()||"Payment"}function Ra(e){return na({eventType:e.eventType,label:e.label,typeLabel:e.typeLabel})}function Nu(){return[{value:"Alibaba Trade Assurance",label:"Alibaba Trade Assurance"},{value:"Wise Transfer",label:"Wise Transfer"},{value:"PayPal",label:"PayPal"},{value:"SEPA Bank Transfer",label:"SEPA Bank Transfer"},{value:"Kreditkarte",label:"Kreditkarte"}]}function Iu(e){const t=new Set;return Object.entries(e.displayNameMap||{}).forEach(([r,a])=>{const i=String(a||r||"").trim();i&&t.add(i)}),e.syncEmail&&t.add(String(e.syncEmail).trim()),t.size?Array.from(t).sort((r,a)=>r.localeCompare(a,"de-DE",{sensitivity:"base"})).map(r=>({value:r,label:r})):[]}function yr(e){const t=String(e||"").trim();return t.length>0&&Xr(t)}function Eu(e){const t=String(e.paidDate||"").trim()||"YYYY-MM-DD",r=String(e.poNo||"").trim()||"PO",a=String(e.alias||"").trim().replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")||"Alias",i=Number.isFinite(Number(e.units))?Math.max(0,Math.round(Number(e.units))):0,u=Array.from(new Set((e.selectedRows||[]).map(d=>Yn(d)))).map(d=>d.replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")),c=u.length?u.join("+"):"Payment";return`${t}_PO-${r}_${a}_${i}u_${c}.pdf`.replace(/-+/g,"-")}function Kr(e){const t=Number(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function Tu(e){const t=e.settings||{};return{fxRate:Number(t.fxRate||0),fxFeePct:Number(t.fxFeePct||0),dutyRatePct:Number(t.dutyRatePct||0),dutyIncludeFreight:t.dutyIncludeFreight!==!1,eustRatePct:Number(t.eustRatePct||0),vatRefundEnabled:t.vatRefundEnabled!==!1,vatRefundLagMonths:Number(t.vatRefundLagMonths||0),freightLagDays:Number(t.freightLagDays||0),paymentDueDefaults:t.paymentDueDefaults||{},cny:t.cny||{start:"",end:""},cnyBlackoutByYear:t.cnyBlackoutByYear||{}}}function qr(){return[{label:"Deposit",percent:30,anchor:"ORDER_DATE",lagDays:0},{label:"Balance",percent:70,anchor:"PROD_DONE",lagDays:0}]}function er(e){return Math.round((e||[]).reduce((t,r)=>t+Number(r.percent||0),0)*100)/100}function Nt(e){const t=Number(e);return Number.isFinite(t)?t:null}function cs(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function _n(e){const t=e.product||{},r=e.settings||{},a=cs(t),i=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),u=String(a.transportMode||"SEA").toLowerCase(),c=r.transportLeadTimesDays||{},d=Nt(i.fields.transitDays.value)??Nt(a.transitDays)??Nt(c[u])??45,p=Nt(i.fields.productionLeadTimeDays.value)??Nt(t.productionLeadTimeDaysDefault??a.productionDays)??Nt(e.supplierDefaultProdDays)??Nt(r.defaultProductionLeadTimeDays)??60,v=Nt(i.fields.unitPriceUsd.value)??Nt(a.unitPriceUsd)??0,h=Nt(a.fxRate??r.fxRate)??0,y=Math.max(0,Nt(i.fields.logisticsPerUnitEur.value)??Nt(t.logisticsPerUnitEur??t.freightPerUnitEur??a.freightEur)??0),M=Math.max(0,Math.round(y*Math.max(0,Number(e.units||0))*100)/100);return{transport:u,prodDays:Math.max(0,Math.round(p)),transitDays:Math.max(0,Math.round(d)),unitCostUsd:v,unitExtraUsd:0,extraFlatUsd:0,freightEur:M,dutyRatePct:Nt(i.fields.dutyRatePct.value)??Nt(t.dutyRatePct??a.dutyPct??r.dutyRatePct)??0,eustRatePct:Nt(i.fields.eustRatePct.value)??Nt(t.eustRatePct??a.vatImportPct??r.eustRatePct)??0,fxOverride:h,ddp:i.fields.ddp.value===!0||a.ddp===!0}}function Ru(e){const t=e.product||{},r=cs(t),a=In({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),i=Math.max(0,Nt(a.fields.logisticsPerUnitEur.value)??Nt(t.logisticsPerUnitEur??t.freightPerUnitEur??r.freightEur)??0);return Math.max(0,Math.round(i*Math.max(0,Number(e.units||0))*100)/100)}function Bt(e,t=""){return{id:String(e.id||zt("poi")),sku:String(e.sku||t||"").trim(),units:Math.max(0,Math.round(Number(e.units||0))),unitCostUsd:Number(e.unitCostUsd||0),unitExtraUsd:Number(e.unitExtraUsd||0),extraFlatUsd:Number(e.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(e.prodDays||0))),transitDays:Math.max(0,Math.round(Number(e.transitDays||0))),freightEur:Math.max(0,Number(e.freightEur||0))}}function $u(e){const t=e!=null&&e.paymentLog&&typeof e.paymentLog=="object"?e.paymentLog:{};return Object.values(t).filter(r=>String((r==null?void 0:r.status)||"")==="paid").length}function $a(e,t){const r=or({items:e==null?void 0:e.items,orderDate:e==null?void 0:e.orderDate,fxRate:(e==null?void 0:e.fxOverride)??t.fxRate,fallback:e});return{goodsUsd:Kr(r.goodsUsd),goodsEur:Kr(r.goodsEur),freightEur:Kr(r.freightEur),units:Math.round(r.units),prodDays:Math.round(r.prodDays),transitDays:Math.round(r.transitDays)}}function Oa(e,t){const r=vn(),a=Vt(e.items,t).map(d=>({id:String(d.id||zt("poi")),sku:String(d.sku||"").trim(),units:Math.max(0,Math.round(Number(d.units||0))),unitCostUsd:Number(d.unitCostUsd||0),unitExtraUsd:Number(d.unitExtraUsd||0),extraFlatUsd:Number(d.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(d.prodDays||0))),transitDays:Math.max(0,Math.round(Number(d.transitDays||0))),freightEur:Math.max(0,Number(d.freightEur||0))})),i=or({items:a,orderDate:e.orderDate,fxRate:e.fxOverride,fallback:t}),u=a[0]||null,c=(e.milestones||[]).map(d=>({id:String(d.id||zt("ms")),label:String(d.label||"Milestone"),percent:Number(d.percent||0),anchor:String(d.anchor||"ORDER_DATE"),lagDays:Number(d.lagDays||0)}));return{...t||{},id:String(e.id||(t==null?void 0:t.id)||zt("po")),poNo:String(e.poNo||"").trim(),sku:String((u==null?void 0:u.sku)||(t==null?void 0:t.sku)||"").trim(),supplierId:String(e.supplierId||"").trim(),orderDate:e.orderDate||null,etdManual:e.etdManual||null,etaManual:e.etaManual||null,arrivalDate:e.arrivalDate||null,units:Math.max(0,Math.round(i.units||0)),unitCostUsd:Number((u==null?void 0:u.unitCostUsd)||0),unitExtraUsd:Number((u==null?void 0:u.unitExtraUsd)||0),extraFlatUsd:Number((u==null?void 0:u.extraFlatUsd)||0),prodDays:Number(i.prodDays||0),transitDays:Number(i.transitDays||0),transport:String(e.transport||"sea").toLowerCase(),freightEur:Number(i.freightEur||0),freightMode:"total",freightPerUnitEur:0,dutyRatePct:Number(e.dutyRatePct||0),dutyIncludeFreight:e.dutyIncludeFreight!==!1,eustRatePct:Number(e.eustRatePct||0),fxOverride:Number(e.fxOverride||0),ddp:e.ddp===!0,items:a,milestones:c,archived:e.archived===!0,createdAt:(t==null?void 0:t.createdAt)||r,updatedAt:r,paymentLog:(t==null?void 0:t.paymentLog)||{},autoEvents:(t==null?void 0:t.autoEvents)||void 0}}function Ou({embedded:e=!1}={}){const t=ia(),r=Cr(),{state:a,loading:i,saving:u,error:c,lastSavedAt:d,saveWith:p}=Mr(),v=ii(),[h,y]=o.useState(""),[M,N]=o.useState("active"),[P,$]=o.useState("all"),[S,w]=o.useState(!1),[F,E]=o.useState(!1),[j,K]=o.useState(null),[U,_]=o.useState([]),[X]=Se.useForm(),[ne]=Se.useForm(),[q,A]=o.useState(!1),[G,T]=o.useState(null),[D,g]=o.useState(null),[k,L]=o.useState([]),[R,H]=o.useState(null),[B,z]=o.useState(null),b=o.useRef(null),W=o.useRef(new Set),O=o.useRef(!1),ae=o.useMemo(()=>new URLSearchParams(t.search).get("view")==="timeline"?"timeline":"table",[t.search]),J=a,Y=a.settings||{},oe=o.useMemo(()=>si(Y),[Y]),me=o.useMemo(()=>oi({userId:v.userId,userEmail:v.email},oe),[oe,v.email,v.userId]),se=o.useMemo(()=>`po:edit:${String(j||"new")}`,[j]),Q=hi({workspaceId:v.workspaceId,modalScope:se,isOpen:F,userId:v.userId,userEmail:v.email,userDisplayName:me,displayNames:oe}),xe=o.useMemo(()=>Tu(J),[a.settings]),pe=o.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(l=>l).map(l=>({id:String(l.id||""),name:String(l.name||"—"),productionLeadTimeDaysDefault:Number(l.productionLeadTimeDaysDefault||0),paymentTermsDefault:Array.isArray(l.paymentTermsDefault)?l.paymentTermsDefault:[],raw:l})).filter(l=>l.id),[a.suppliers]),Ce=o.useMemo(()=>new Map(pe.map(l=>[l.id,l.name])),[pe]),we=o.useMemo(()=>new Map(pe.map(l=>[l.id,l])),[pe]),fe=o.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(l=>l).map(l=>({sku:String(l.sku||""),alias:String(l.alias||l.sku||""),supplierId:String(l.supplierId||""),raw:l})).filter(l=>l.sku),[a.products]),ye=o.useMemo(()=>new Map(fe.map(l=>[l.sku,l])),[fe]),re=o.useMemo(()=>{const l=Array.isArray(a.payments)?a.payments:[];return(Array.isArray(a.pos)?a.pos:[]).map(s=>{var Oe;const f=s,C=or({items:f.items,orderDate:f.orderDate,fxRate:f.fxOverride??xe.fxRate,fallback:f}),x=String(C.firstSku||f.sku||""),Z=Wn({orderDate:f.orderDate,productionLeadTimeDays:C.prodDays||f.prodDays,logisticsLeadTimeDays:C.transitDays||f.transitDays,bufferDays:0}),te=String(f.etdManual||Z.etdDate||""),ve=String(f.etaManual||Z.etaDate||""),I=Number(C.goodsEur||0),ie=C.items.length,le=Array.isArray(f.items)?f.items.map(Ye=>String((Ye==null?void 0:Ye.sku)||"")).join(" "):"",he=(()=>{try{const Ye=structuredClone(f);return Tr(Ye,zr,xe,l)}catch{return[]}})(),Ee=(()=>{try{return Ta(he.map(be=>Wr(be)).filter(be=>be.eventType!=="vat_refund").filter(be=>be.id&&be.plannedEur>0)).map(be=>({id:be.id,eventIds:Yr(be),typeLabel:be.typeLabel,label:be.label,dueDate:be.dueDate,plannedEur:be.plannedEur,status:be.status,paidDate:be.paidDate,eventType:be.eventType,direction:be.direction||"out"})).sort((be,ze)=>{const ut=String(be.dueDate||"").localeCompare(String(ze.dueDate||""));if(ut!==0)return ut;const pt=Ra(be)-Ra(ze);return pt!==0?pt:String(be.label||"").localeCompare(String(ze.label||""))})}catch{return[]}})(),ke=he.filter(Ye=>Ye.status==="paid").reduce((Ye,be)=>Ye+Number(be.plannedEur||0),0),De=he.filter(Ye=>Ye.status!=="paid").reduce((Ye,be)=>Ye+Number(be.plannedEur||0),0),Me=De<=0&&ke>0?"paid_only":De>0&&ke>0?"mixed":"open";return{id:String(f.id||""),poNo:String(f.poNo||""),sku:x,alias:((Oe=ye.get(x))==null?void 0:Oe.alias)||x||"—",skuCount:ie,supplierName:Ce.get(String(f.supplierId||""))||"—",orderDate:f.orderDate?String(f.orderDate):null,productionEndDate:Z.productionEndDate?String(Z.productionEndDate):null,etdDate:te||null,etaDate:ve||null,arrivalDate:f.arrivalDate?String(f.arrivalDate):null,goodsEur:I,openEur:De,paidEur:ke,statusText:Me,itemSkusText:le,timelineMarkers:Ee,raw:f}}).sort((s,f)=>String(s.poNo||"").localeCompare(String(f.poNo||"")))},[xe,ye,a.payments,a.pos,Ce]),$e=o.useMemo(()=>{const l=h.trim().toLowerCase();return re.filter(s=>{const f=s.raw.archived===!0;return M==="active"&&f||M==="archived"&&!f||P!=="all"&&s.statusText!==P||S&&s.openEur<=0?!1:l?[s.poNo,s.sku,s.alias,s.supplierName,s.itemSkusText].join(" ").toLowerCase().includes(l):!0})},[M,re,S,P,h]),He=o.useMemo(()=>Pu({state:J,rows:$e}),[$e,J]),je=o.useMemo(()=>wu(J),[J]),Fe=o.useMemo(()=>mi(He,je),[je,He]),Ue=o.useMemo(()=>{if(!Fe.length)return null;const l=Ln(`${Fe[0]}-01`);if(!l)return null;const s=new Date(l.getTime());return s.setUTCMonth(s.getUTCMonth()+je),{startMs:l.getTime(),endMs:s.getTime(),totalDays:Math.max(1,(s.getTime()-l.getTime())/us)}},[je,Fe]),ot=o.useMemo(()=>Ue?Un(new Date,Ue):0,[Ue]);function et(l){const s=new URLSearchParams(t.search);l==="timeline"?s.set("view","timeline"):s.delete("view");const f=s.toString();r({pathname:t.pathname,search:f?`?${f}`:""},{replace:!0})}const Ae=o.useMemo(()=>[{header:"PO",accessorKey:"poNo",meta:{width:98}},{header:"Produkt",meta:{width:260},cell:({row:l})=>l.original.skuCount>1?n.jsxs("div",{className:"v2-proj-alias",children:[n.jsxs("div",{className:"v2-proj-alias-main",title:`${l.original.skuCount} SKUs`,children:[n.jsxs("span",{children:[l.original.skuCount," SKUs"]}),n.jsx(mt,{className:"v2-po-sku-count-tag",style:{marginInlineStart:6},children:"Multi-SKU"})]}),n.jsxs(at,{className:"v2-proj-sku-secondary",type:"secondary",title:l.original.sku,children:["Start-SKU: ",l.original.sku]})]}):n.jsx(ci,{alias:l.original.alias,sku:l.original.sku})},{header:"Supplier",accessorKey:"supplierName",meta:{width:150}},{header:"Order",meta:{width:112},cell:({row:l})=>jt(l.original.orderDate)},{header:"ETD / ETA",meta:{width:162,sortAccessor:ku},cell:({row:l})=>n.jsxs(qe,{direction:"vertical",size:0,children:[n.jsxs(at,{children:["ETD ",jt(l.original.etdDate)]}),n.jsxs(at,{type:"secondary",children:["ETA ",jt(l.original.etaDate)]})]})},{header:"Warenwert",meta:{width:130,align:"right"},cell:({row:l})=>sn(l.original.goodsEur)},{header:"Open / Paid",meta:{width:160,align:"right"},cell:({row:l})=>n.jsxs(qe,{direction:"vertical",size:0,children:[n.jsxs(at,{children:["Open: ",sn(l.original.openEur)]}),n.jsxs(at,{type:"secondary",children:["Paid: ",sn(l.original.paidEur)]})]})},{header:"Status",meta:{width:110},cell:({row:l})=>ju(l.original.statusText)},{header:"Aktionen",meta:{width:190,minWidth:190},cell:({row:l})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(Ie,{size:"small",onClick:()=>Wt(l.original.raw),children:"Bearbeiten"}),n.jsx(Ie,{size:"small",danger:!0,onClick:()=>{Rt.confirm({title:"PO loeschen?",onOk:async()=>{await p(s=>{const f=dn(s);return f.pos=(Array.isArray(f.pos)?f.pos:[]).filter(C=>String(C.id||"")!==l.original.id),f},"v2:po:delete")}})},children:"Loeschen"})]})}],[p]),V=Se.useWatch([],X),Ve=Se.useWatch("supplierId",X),tt=o.useMemo(()=>Vt(V==null?void 0:V.items,null).map(l=>Bt(l)),[V==null?void 0:V.items]),Le=o.useMemo(()=>{var s;if(!V)return null;const l=j&&((s=re.find(f=>f.id===j))==null?void 0:s.raw)||null;return Oa({...V,items:tt},l)},[re,tt,V,j]),nt=o.useMemo(()=>or({items:tt,orderDate:V==null?void 0:V.orderDate,fxRate:(V==null?void 0:V.fxOverride)??xe.fxRate,fallback:tt.length?Le:null}),[tt,Le,V==null?void 0:V.fxOverride,V==null?void 0:V.orderDate,xe.fxRate]),ee=tt[0]||null,Be=o.useMemo(()=>{var l;return ee!=null&&ee.sku&&((l=ye.get(ee.sku))==null?void 0:l.raw)||null},[ee==null?void 0:ee.sku,ye]),de=o.useMemo(()=>In({state:J,product:Be||void 0,sku:String((ee==null?void 0:ee.sku)||""),supplierId:String((V==null?void 0:V.supplierId)||(Be==null?void 0:Be.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:ee==null?void 0:ee.unitCostUsd,prodDays:ee==null?void 0:ee.prodDays,transitDays:ee==null?void 0:ee.transitDays,dutyRatePct:V==null?void 0:V.dutyRatePct,eustRatePct:V==null?void 0:V.eustRatePct,ddp:V==null?void 0:V.ddp,incoterm:V!=null&&V.ddp?"DDP":"EXW"}}),[V==null?void 0:V.ddp,V==null?void 0:V.dutyRatePct,V==null?void 0:V.eustRatePct,V==null?void 0:V.supplierId,ee==null?void 0:ee.prodDays,ee==null?void 0:ee.sku,ee==null?void 0:ee.transitDays,ee==null?void 0:ee.unitCostUsd,Be,J]),m=o.useMemo(()=>In({state:J,product:Be||void 0,sku:String((ee==null?void 0:ee.sku)||""),supplierId:String((V==null?void 0:V.supplierId)||(Be==null?void 0:Be.supplierId)||""),orderContext:"po"}),[V==null?void 0:V.supplierId,ee==null?void 0:ee.sku,Be,J]),Ne=o.useMemo(()=>ar({product:Be,state:J,supplierId:String((V==null?void 0:V.supplierId)||(Be==null?void 0:Be.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:ee==null?void 0:ee.unitCostUsd,prodDays:ee==null?void 0:ee.prodDays,transitDays:ee==null?void 0:ee.transitDays,dutyRatePct:V==null?void 0:V.dutyRatePct,eustRatePct:V==null?void 0:V.eustRatePct,ddp:V==null?void 0:V.ddp,incoterm:V!=null&&V.ddp?"DDP":"EXW"}}),[V==null?void 0:V.ddp,V==null?void 0:V.dutyRatePct,V==null?void 0:V.eustRatePct,V==null?void 0:V.supplierId,ee==null?void 0:ee.prodDays,ee==null?void 0:ee.transitDays,ee==null?void 0:ee.unitCostUsd,Be,J]);function ue(l){if(!ee)return;const s=Vt(X.getFieldValue("items"),null).map(C=>Bt(C)),f=s.findIndex(C=>C.id===ee.id);if(l==="unitCostUsd"&&f>=0){s[f]={...s[f],unitCostUsd:Number(m.fields.unitPriceUsd.value||0)},X.setFieldValue("items",s);return}if(l==="prodDays"&&f>=0){s[f]={...s[f],prodDays:Math.round(Number(m.fields.productionLeadTimeDays.value||0))},X.setFieldValue("items",s);return}if(l==="transitDays"&&f>=0){s[f]={...s[f],transitDays:Math.round(Number(m.fields.transitDays.value||0))},X.setFieldValue("items",s);return}if(l==="dutyRatePct"){X.setFieldValue("dutyRatePct",Number(m.fields.dutyRatePct.value||0));return}if(l==="eustRatePct"){X.setFieldValue("eustRatePct",Number(m.fields.eustRatePct.value||0));return}X.setFieldValue("ddp",m.fields.ddp.value===!0)}function ge(l,s){const f=String((ee==null?void 0:ee.sku)||"").trim();f&&Rt.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${f}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{Rt.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await p(C=>{const x=dn(C),Z=Array.isArray(x.products)?[...x.products]:[],te=Z.findIndex(I=>String(I.sku||"").trim().toLowerCase()===f.toLowerCase());if(te<0)return x;const ve=Z[te];return Z[te]={...fi({product:ve,field:l,value:s}),updatedAt:vn()},x.products=Z,x},"v2:po:adopt-masterdata"),Jt.success("Produkt-Stammdaten aktualisiert.")}})}})}const Re=o.useMemo(()=>{const l=String(Ve||"");if(!l)return[];const s=new Set(tt.map(f=>f.sku));return fe.filter(f=>f.supplierId===l).map(f=>({value:f.sku,label:`${f.alias} (${f.sku})`,disabled:s.has(f.sku)}))},[tt,fe,Ve]),st=o.useMemo(()=>{const l=[];return tt.forEach(s=>{const f=[];s.units<=0&&f.push("Units <= 0"),s.unitCostUsd<=0&&f.push("Unit Cost fehlt"),s.prodDays<=0&&f.push("Prod Days fehlen"),s.transitDays<=0&&f.push("Transit Days fehlen"),f.length&&l.push(`${s.sku||"SKU?"}: ${f.join(", ")}`)}),l},[tt]),Ke=o.useMemo(()=>{if(!Le)return[];try{const l=structuredClone(Le);return Tr(l,zr,xe,Array.isArray(a.payments)?a.payments:[]).map(f=>Wr(f)).filter(f=>f.direction!=="in").filter(f=>f.id&&f.plannedEur>0)}catch{return[]}},[Le,xe,a.payments]),dt=o.useMemo(()=>{if(!Le)return[];try{const l=structuredClone(Le);return Tr(l,zr,xe,Array.isArray(a.payments)?a.payments:[],{includeIncoming:!0}).map(f=>Wr(f)).filter(f=>f.eventType==="vat_refund"||f.direction==="in").filter(f=>f.id&&f.plannedEur>0).sort((f,C)=>String(f.dueDate||"").localeCompare(String(C.dueDate||"")))}catch{return[]}},[Le,xe,a.payments]),lt=o.useMemo(()=>Ta(Ke),[Ke]);o.useEffect(()=>{if(!R||!F||j!==R.poId||!Le)return;const l=lt.find(s=>s.id===R.eventId)||null;if(l){_t(l),H(null);return}z("payments"),H(null)},[lt,Le,j,R,F]),o.useEffect(()=>{if(!F||!B)return;const l=f=>{f&&(f.scrollIntoView({block:"center",behavior:"smooth"}),f.focus())},s=window.requestAnimationFrame(()=>{if(B==="payments"){const f=b.current;f&&f.scrollIntoView({block:"center",behavior:"smooth"}),z(null);return}if(B==="shipping"){l(document.getElementById("v2-po-etd-manual")),z(null);return}B==="arrival"&&(l(document.getElementById("v2-po-arrival-date")),z(null))});return()=>{window.cancelAnimationFrame(s)}},[B,F]);const Ot=o.useMemo(()=>{const l=new Map;return(Array.isArray(a.payments)?a.payments:[]).forEach(s=>{const f=s,C=String(f.id||"").trim();C&&l.set(C,f)}),l},[a.payments]),bt=o.useMemo(()=>Iu({displayNameMap:oe,syncEmail:v.email}),[oe,v.email]),ht=o.useMemo(()=>Nu(),[]),Lt=Se.useWatch("selectedEventIds",ne),ct=Se.useWatch([],ne),Ut=o.useMemo(()=>{const l=new Set((Lt||[]).map(s=>String(s||"")));return lt.filter(s=>l.has(s.id))},[lt,Lt]),Yt=o.useMemo(()=>{var x,Z;if(!Le||!ct)return"";const l=Vt(Le.items,Le),s=String(((x=l[0])==null?void 0:x.sku)||Le.sku||""),f=l.length,C=f>1?`Multi-SKU-${f}`:((Z=ye.get(s))==null?void 0:Z.alias)||s||"Alias";return Eu({paidDate:ct.paidDate,poNo:String(Le.poNo||""),alias:C,units:Number(Le.units||0),selectedRows:Ut})},[Le,ct,Ut,ye]);o.useEffect(()=>{!F||!Q.readOnly||!Q.remoteDraftPatch||X.setFieldsValue(Q.remoteDraftPatch)},[X,Q.readOnly,Q.remoteDraftPatch,Q.remoteDraftVersion,F]);function Qe(l){O.current=!0,l(),Promise.resolve().then(()=>{O.current=!1})}function Et(l){const s=new Set(l.map(f=>String(f.id||"").trim()).filter(Boolean));Array.from(W.current).forEach(f=>{s.has(f)||W.current.delete(f)})}function Gt(l){if(O.current)return;const s=Array.isArray(l.items)?l.items:null;if(!(s!=null&&s.length))return;const f=Vt(X.getFieldValue("items"),null).map(C=>Bt(C));Et(f),s.forEach((C,x)=>{var te;if(!C)return;const Z=String(((te=f[x])==null?void 0:te.id)||"").trim();Z&&(Object.prototype.hasOwnProperty.call(C,"sku")&&W.current.delete(Z),Object.prototype.hasOwnProperty.call(C,"freightEur")&&W.current.add(Z))})}function on(l,s){var De,Me,Oe,Ye;const f=String((s==null?void 0:s.sku)||"").trim(),C=Math.max(0,Math.round(Number((s==null?void 0:s.units)||0))),x=f?String(((De=ye.get(f))==null?void 0:De.supplierId)||""):"",Z=String((s==null?void 0:s.supplierId)||(l==null?void 0:l.supplierId)||x||((Me=pe[0])==null?void 0:Me.id)||""),te=we.get(Z)||null,ve=Vt(l==null?void 0:l.items,l).map(be=>Bt(be)),I=Vt(s==null?void 0:s.items,null).map(be=>Bt(be));let ie=I.length?I:ve;if(!ie.length&&f){const be=ye.get(f)||null,ze=_n({state:J,product:(be==null?void 0:be.raw)||null,settings:Y,supplierId:Z,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:C});ie=[Bt({id:zt("poi"),sku:f,units:C,unitCostUsd:ze.unitCostUsd,unitExtraUsd:ze.unitExtraUsd,extraFlatUsd:ze.extraFlatUsd,prodDays:ze.prodDays,transitDays:ze.transitDays,freightEur:ze.freightEur})]}if(!ie.length&&(l!=null&&l.sku)){const be=String(l.sku||"").trim(),ze=Math.max(0,Math.round(Number(l.units||0))),ut=ye.get(be)||null,pt=_n({state:J,product:(ut==null?void 0:ut.raw)||null,settings:Y,supplierId:Z,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:ze});ie=[Bt({id:zt("poi"),sku:be,units:ze,unitCostUsd:Number(l.unitCostUsd??pt.unitCostUsd??0),unitExtraUsd:Number(l.unitExtraUsd??pt.unitExtraUsd??0),extraFlatUsd:Number(l.extraFlatUsd??pt.extraFlatUsd??0),prodDays:Number(l.prodDays??pt.prodDays??0),transitDays:Number(l.transitDays??pt.transitDays??0),freightEur:Number(l.freightEur??pt.freightEur??0)})]}const le=ie.filter(be=>{var ut;if(!Z)return!0;const ze=String(((ut=ye.get(be.sku))==null?void 0:ut.supplierId)||"");return ze?ze===Z:!0}),he=ye.get(String(((Oe=le[0])==null?void 0:Oe.sku)||f||(l==null?void 0:l.sku)||""))||null,Ee=_n({state:J,product:(he==null?void 0:he.raw)||null,settings:Y,supplierId:Z,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:((Ye=le[0])==null?void 0:Ye.units)||C}),ke=Sa((te==null?void 0:te.raw)||null).map(be=>({id:be.id,label:be.label,percent:be.percent,anchor:be.anchor,lagDays:be.lagDays}));return{id:l!=null&&l.id?String(l.id):void 0,poNo:String((l==null?void 0:l.poNo)||""),supplierId:Z,orderDate:String((s==null?void 0:s.orderDate)||(l==null?void 0:l.orderDate)||new Date().toISOString().slice(0,10)),etdManual:String((s==null?void 0:s.etdManual)||(l==null?void 0:l.etdManual)||""),etaManual:String((s==null?void 0:s.etaManual)||(l==null?void 0:l.etaManual)||""),arrivalDate:String((s==null?void 0:s.arrivalDate)||(l==null?void 0:l.arrivalDate)||""),transport:String((l==null?void 0:l.transport)||Ee.transport||"sea").toLowerCase(),dutyRatePct:Number((l==null?void 0:l.dutyRatePct)??Ee.dutyRatePct??Y.dutyRatePct??0),dutyIncludeFreight:(l==null?void 0:l.dutyIncludeFreight)!==!1,eustRatePct:Number((l==null?void 0:l.eustRatePct)??Ee.eustRatePct??Y.eustRatePct??0),fxOverride:Number((l==null?void 0:l.fxOverride)??Ee.fxOverride??Y.fxRate??0),ddp:(l==null?void 0:l.ddp)===!0?!0:!!Ee.ddp,archived:(l==null?void 0:l.archived)===!0,milestones:Array.isArray(l==null?void 0:l.milestones)?(l==null?void 0:l.milestones).map(be=>({id:String(be.id||zt("ms")),label:String(be.label||"Milestone"),percent:Number(be.percent||0),anchor:String(be.anchor||"ORDER_DATE"),lagDays:Number(be.lagDays||0)})):ke.length?ke:qr(),items:le}}function ln(l,s){var he,Ee,ke;const f=String(s||"").trim();if(!f)return;const C=ye.get(f)||null;if(!C)return;const x=X.getFieldsValue(),Z=Vt(x.items,null).map(De=>Bt(De));if(l<0||l>=Z.length)return;const te=String(x.supplierId||C.supplierId||""),ve=we.get(te)||null,I=String(((he=Z[l])==null?void 0:he.id)||"").trim(),ie=_n({state:J,product:C.raw,settings:Y,supplierId:te,supplierDefaultProdDays:ve==null?void 0:ve.productionLeadTimeDaysDefault,units:Number(((Ee=Z[l])==null?void 0:Ee.units)||0)});Z[l]=Bt({...Z[l],sku:f,unitCostUsd:ie.unitCostUsd,unitExtraUsd:ie.unitExtraUsd,extraFlatUsd:ie.extraFlatUsd,prodDays:ie.prodDays,transitDays:ie.transitDays,freightEur:ie.freightEur});const le=String(((ke=Z[l])==null?void 0:ke.id)||"").trim();I&&W.current.delete(I),le&&W.current.delete(le),Et(Z),Qe(()=>{X.setFieldsValue({items:Z,supplierId:te||x.supplierId,transport:x.transport||ie.transport,dutyRatePct:Number(x.dutyRatePct||ie.dutyRatePct||0),eustRatePct:Number(x.eustRatePct||ie.eustRatePct||0),fxOverride:Number(x.fxOverride||ie.fxOverride||0),ddp:x.ddp===!0?!0:ie.ddp})})}function hn(l){const s=X.getFieldsValue(),f=Vt(s.items,null).map(I=>Bt(I)),C=new Set(f.map(I=>I.sku)),x=String(s.supplierId||""),Z=we.get(x)||null,te=[];if(l.forEach(I=>{const ie=String(I||"").trim();if(!ie||C.has(ie))return;const le=ye.get(ie);if(!le||String(le.supplierId||"")!==x)return;const he=_n({state:J,product:le.raw,settings:Y,supplierId:x,supplierDefaultProdDays:Z==null?void 0:Z.productionLeadTimeDaysDefault,units:0});te.push(Bt({id:zt("poi"),sku:ie,units:0,unitCostUsd:he.unitCostUsd,unitExtraUsd:he.unitExtraUsd,extraFlatUsd:he.extraFlatUsd,prodDays:he.prodDays,transitDays:he.transitDays,freightEur:he.freightEur}))}),!te.length)return;const ve=[...f,...te];Et(ve),Qe(()=>{var I;X.setFieldsValue({items:ve,transport:s.transport||_n({state:J,product:((I=ye.get(te[0].sku))==null?void 0:I.raw)||null,settings:Y,supplierId:x,supplierDefaultProdDays:Z==null?void 0:Z.productionLeadTimeDaysDefault,units:te[0].units}).transport})}),_([])}function Mn(l){const s=String(l||""),f=X.getFieldsValue(),C=Vt(f.items,null).map(I=>Bt(I)),x=C.filter(I=>{var le;const ie=String(((le=ye.get(I.sku))==null?void 0:le.supplierId)||"");return ie?ie===s:!0});C.length!==x.length&&Jt.info(`${C.length-x.length} SKU(s) wurden entfernt, da sie nicht zum Lieferanten passen.`);const Z=we.get(s)||null,te=Sa((Z==null?void 0:Z.raw)||null).map(I=>({id:I.id,label:I.label,percent:I.percent,anchor:I.anchor,lagDays:I.lagDays})),ve=!j&&(!Array.isArray(f.milestones)||er(f.milestones)===er(qr()));W.current.clear(),Qe(()=>{X.setFieldsValue({supplierId:s,items:x,milestones:ve?te.length?te:qr():f.milestones})}),_([])}function un(l){K(null),z(null);const s=on(null,l);W.current.clear(),Qe(()=>{X.resetFields(),X.setFieldsValue({...s,...l||{}})}),_([]),E(!0)}function Wt(l,s=null){K(String(l.id||"")),z(s),W.current.clear(),Qe(()=>{X.resetFields(),X.setFieldsValue(on(l))}),_([]),E(!0)}function tn(l){const s=Array.isArray(l.items)?l.items:null;if(!(s!=null&&s.length)||!s.some(I=>I&&(Object.prototype.hasOwnProperty.call(I,"units")||Object.prototype.hasOwnProperty.call(I,"sku"))))return;const C=X.getFieldsValue(),x=String(C.supplierId||""),Z=Vt(C.items,null).map(I=>Bt(I));Et(Z);let te=!1;const ve=Z.map((I,ie)=>{const le=s[ie],he=!!(le&&Object.prototype.hasOwnProperty.call(le,"units")),Ee=!!(le&&Object.prototype.hasOwnProperty.call(le,"sku"));if(!he&&!Ee)return I;const ke=String(I.id||"").trim();if(Ee&&ke&&W.current.delete(ke),!I.sku||ke&&W.current.has(ke))return I;const De=ye.get(I.sku)||null;if(!De)return I;const Me=Ru({state:J,product:De.raw,supplierId:x||De.supplierId,units:I.units});return Math.abs(Number(I.freightEur||0)-Me)<=1e-4?I:(te=!0,{...I,freightEur:Me})});te&&Qe(()=>{X.setFieldValue("items",ve)})}function pn(l,s){H({poId:l.id,eventId:s.id}),Wt(l.raw,"payments")}function _t(l){if(!j){Jt.info("Bitte PO zuerst speichern, danach koennen Zahlungen verbucht werden.");return}const s=new Date().toISOString().slice(0,10),f=l||null,C=(f==null?void 0:f.paymentId)||null,x=C?lt.filter(le=>le.paymentId===C):f?[f]:lt.filter(le=>le.status!=="paid"),Z=x.map(le=>le.id),te=Array.from(new Set(x.flatMap(le=>Yr(le)))),ve=x.reduce((le,he)=>le+Number(he.plannedEur||0),0),I=C&&Ot.get(C)||null,ie=String((I==null?void 0:I.id)||C||Rr(zt("pay"))||zt("pay"));ne.setFieldsValue({selectedEventIds:Z,paidDate:String((I==null?void 0:I.paidDate)||(f==null?void 0:f.paidDate)||s),method:String((I==null?void 0:I.method)||(f==null?void 0:f.method)||"Alibaba Trade Assurance"),paidBy:String((I==null?void 0:I.payer)||(f==null?void 0:f.paidBy)||me||v.email||""),amountActualEur:Number.isFinite(Number(I==null?void 0:I.amountActualEurTotal))?Number(I==null?void 0:I.amountActualEurTotal):Math.round(ve*100)/100,amountActualUsd:Number.isFinite(Number(I==null?void 0:I.amountActualUsdTotal))?Number(I==null?void 0:I.amountActualUsdTotal):null,paymentId:ie,invoiceDriveUrl:String((I==null?void 0:I.invoiceDriveUrl)||(f==null?void 0:f.invoiceDriveUrl)||""),invoiceFolderDriveUrl:String((I==null?void 0:I.invoiceFolderDriveUrl)||(f==null?void 0:f.invoiceFolderDriveUrl)||""),note:String((I==null?void 0:I.note)||(f==null?void 0:f.note)||"")}),L(te),T(I!=null&&I.id?String(I.id):null),g(null),A(!0)}async function nn(l){if(Q.readOnly)throw new Error("Nur Lesemodus: keine Zahlungen speichern.");if(!j)throw new Error("PO muss zuerst gespeichert werden.");const s=Array.from(new Set((l.selectedEventIds||[]).map(ke=>String(ke||"").trim()).filter(Boolean)));if(!s.length)throw new Error("Bitte mindestens einen Zahlungsbaustein auswaehlen.");if(!l.paidDate)throw new Error("Bitte ein Zahlungsdatum setzen.");if(!l.method.trim())throw new Error("Bitte eine Zahlungsmethode waehlen.");if(!l.paidBy.trim())throw new Error("Bitte angeben, wer gezahlt hat.");const f=Number(l.amountActualEur);if(!Number.isFinite(f)||f<0)throw new Error("Bitte einen gueltigen Ist-Betrag in EUR eingeben.");if(l.invoiceDriveUrl&&!Xr(l.invoiceDriveUrl))throw new Error("Invoice-Link muss mit http:// oder https:// beginnen.");if(l.invoiceFolderDriveUrl&&!Xr(l.invoiceFolderDriveUrl))throw new Error("Folder-Link muss mit http:// oder https:// beginnen.");const C=String(Rr(l.paymentId)||Rr(zt("pay"))||zt("pay")),x=lt.filter(ke=>s.includes(ke.id)),Z=Array.from(new Set(x.flatMap(ke=>Yr(ke))));if(!Z.length)throw new Error("Bitte mindestens einen gueltigen Zahlungsbaustein auswaehlen.");const te=Ke.filter(ke=>Z.includes(ke.id)),ve=ao(f,te.map(ke=>({id:ke.id,plannedEur:ke.plannedEur})));if(!ve||!ve.length)throw new Error("Konnte die Zahlung nicht auf die gewaehlten Bausteine verteilen.");const I=Number(l.amountActualUsd),ie=Number.isFinite(I)?I:null,le=te.reduce((ke,De)=>ke+Number(De.plannedEur||0),0),he=ie!=null&&le>0?te.map(ke=>{const De=Number(ke.plannedEur||0)/le;return{eventId:ke.id,actual:Math.round(ie*De*100)/100}}):[],Ee=new Map(he.map(ke=>[ke.eventId,ke.actual]));await p(ke=>{var Xt,Fn,An;const De=dn(ke),Me=Array.isArray(De.pos)?[...De.pos]:[],Oe=Me.findIndex(Pe=>String(Pe.id||"")===j);if(Oe<0)throw new Error("PO nicht gefunden.");const Ye={...Me[Oe]},be=Ye.paymentLog&&typeof Ye.paymentLog=="object"?{...Ye.paymentLog}:{},ze=G?String(G):null;k.forEach(Pe=>{if(Z.includes(Pe))return;const Te=be[Pe]&&typeof be[Pe]=="object"?{...be[Pe]}:{};be[Pe]={...Te,status:"open",paidDate:null,paymentId:null,amountActualEur:null,amountActualUsd:null,method:null,payer:null,note:null}}),ve.forEach(Pe=>{var xt;const Te=be[Pe.eventId]&&typeof be[Pe.eventId]=="object"?{...be[Pe.eventId]}:{};be[Pe.eventId]={...Te,paymentInternalId:String(Te.paymentInternalId||zt("payrow")),status:"paid",paidDate:l.paidDate,paymentId:C,amountActualEur:Number(Pe.actual||0),amountActualUsd:Ee.get(Pe.eventId)??null,method:l.method.trim(),payer:l.paidBy.trim(),note:((xt=l.note)==null?void 0:xt.trim())||null}}),Ye.paymentLog=be,Ye.updatedAt=vn(),Me[Oe]=Ye,De.pos=Me;const ut=Array.isArray(De.payments)?[...De.payments]:[],pt=ut.findIndex(Pe=>String(Pe.id||"")===C);if(pt>=0&&(!ze||String(ut[pt].id||"")!==ze)){const Pe=new Set(ut[pt].coveredEventIds||[]);if(!Z.some(xt=>Pe.has(xt))&&C!==ze)throw new Error(`Payment-ID ${C} ist bereits vergeben.`)}const St={id:C,paidDate:l.paidDate,method:l.method.trim(),payer:l.paidBy.trim(),currency:"EUR",amountActualEurTotal:f,amountActualUsdTotal:ie,coveredEventIds:Z,note:((Xt=l.note)==null?void 0:Xt.trim())||null,invoiceDriveUrl:((Fn=l.invoiceDriveUrl)==null?void 0:Fn.trim())||"",invoiceFolderDriveUrl:((An=l.invoiceFolderDriveUrl)==null?void 0:An.trim())||""},rn=ut.findIndex(Pe=>String(Pe.id||"")===C);return rn>=0?ut[rn]={...ut[rn],...St}:ut.push(St),De.payments=ut,De},"v2:po:payment-booking"),A(!1),T(null),L([]),g(null),ne.resetFields(),Jt.success("Zahlung wurde gespeichert.")}async function Ht(l,s=!1){var Ee,ke;if(Q.readOnly)throw new Error("Diese PO wird gerade von einem anderen Nutzer bearbeitet.");if(!l.poNo.trim())throw new Error("PO Nummer ist erforderlich.");const f=Vt(l.items,null).map(De=>Bt(De));if(!f.length)throw new Error("Bitte mindestens eine SKU in der PO erfassen.");const C=String(l.supplierId||"").trim();if(!C)throw new Error("Bitte einen Lieferanten auswaehlen.");const x=f.find(De=>{var Me;return String(((Me=ye.get(De.sku))==null?void 0:Me.supplierId)||"")!==C});if(x)throw new Error(`SKU ${x.sku} gehoert nicht zum gewaehlten Lieferanten.`);const Z=f.find(De=>De.units<=0||De.unitCostUsd<=0||De.prodDays<=0||De.transitDays<=0);if(Z)throw new Error(`SKU ${Z.sku} ist unvollstaendig. Bitte Units, Unit Cost, Prod Days und Transit Days pflegen.`);const te=f.find(De=>{var Ye;const Me=((Ye=ye.get(De.sku))==null?void 0:Ye.raw)||null;return Me?ar({product:Me,state:J,supplierId:C,orderContext:"po",orderOverrides:{unitCostUsd:De.unitCostUsd,prodDays:De.prodDays,transitDays:De.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}}).blocked:!1});if(te){const De=((Ee=ye.get(te.sku))==null?void 0:Ee.raw)||null,Me=ar({product:De,state:J,supplierId:C,orderContext:"po",orderOverrides:{unitCostUsd:te.unitCostUsd,prodDays:te.prodDays,transitDays:te.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}});throw new Error(`SKU ${te.sku}: blockierende Stammdaten fehlen (${Me.issues.map(Oe=>Oe.label).join(", ")}).`)}const ve=er(l.milestones||[]);if(Math.abs(ve-100)>.01)throw new Error("Milestone Prozentwerte muessen 100% ergeben.");const I=j&&((ke=re.find(De=>De.id===j))==null?void 0:ke.raw)||null,ie={...l,supplierId:C,items:f},le=Oa(ie,I);if($u(I)>0&&!s){const De=$a(I,xe),Me=$a(le,xe);if(De.goodsUsd!==Me.goodsUsd||De.goodsEur!==Me.goodsEur||De.freightEur!==Me.freightEur||De.units!==Me.units||De.prodDays!==Me.prodDays||De.transitDays!==Me.transitDays){Rt.confirm({title:"Bereits bezahlte Events vorhanden",content:"Du hast Positionen oder Summen geaendert, obwohl bereits Zahlungen verbucht sind. Bitte bewusst bestaetigen.",okText:"Trotzdem speichern",cancelText:"Abbrechen",onOk:()=>void Ht(ie,!0)});return}}await p(De=>{const Me=dn(De),Oe=Array.isArray(Me.pos)?[...Me.pos]:[];if(Oe.find(ze=>String(ze.poNo||"")===le.poNo&&String(ze.id||"")!==String(le.id||"")))throw new Error(`PO Nummer ${le.poNo} existiert bereits.`);const be=Oe.findIndex(ze=>String(ze.id||"")===String(le.id||""));return be>=0?Oe[be]=le:Oe.push(le),Me.pos=Oe,Me},j?"v2:po:update":"v2:po:create"),Q.clearDraft(),E(!1),z(null),H(null),K(null),_([]),X.resetFields()}return o.useEffect(()=>{const l=new URLSearchParams(t.search),s=l.get("source"),f=ie=>{let le=!1;if(ie.forEach(Ee=>{l.has(Ee)&&(l.delete(Ee),le=!0)}),!le)return;const he=l.toString();r({pathname:t.pathname,search:he?`?${he}`:""},{replace:!0})};if(s==="fo_convert"){const ie=String(l.get("poNo")||"").trim();ie&&y(ie),f(["source","poNo"]);return}if(s!=="inventory_projection")return;const C=String(l.get("sku")||"").trim();if(!C)return;const x=fe.find(ie=>ie.sku===C)||null,Z=Math.max(0,Math.round(Number(l.get("suggestedUnits")||0))),te=String(l.get("requiredArrivalDate")||""),ve=String(l.get("recommendedOrderDate")||""),I={sku:C,units:Z};x!=null&&x.supplierId&&(I.supplierId=String(x.supplierId)),te&&(I.etaManual=te),ve&&(I.orderDate=ve),un(I),f(["source","sku","suggestedUnits","requiredArrivalDate","recommendedOrderDate"])},[t.pathname,t.search,r,fe]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(It,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Cu,{level:3,children:"Purchase Orders"}),n.jsx(xu,{children:"PO-Stammdaten, Milestones, Auto-Events und Payment-Status in einem konsistenten Arbeitsbereich."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(Ie,{type:"primary",onClick:()=>un(),children:"Neue PO"}),n.jsx(sa,{value:ae,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:l=>et(String(l)==="timeline"?"timeline":"table")}),u?n.jsx(mt,{color:"processing",children:"Speichern..."}):null,d?n.jsxs(mt,{color:"green",children:["Gespeichert: ",new Date(d).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(kt,{type:"error",showIcon:!0,message:c}):null,i?n.jsx(kt,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(It,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(gt,{placeholder:"PO Nummer, SKU, Alias, Supplier",value:h,onChange:l=>y(l.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Dt,{value:M,onChange:l=>N(String(l)),options:[{value:"active",label:"Aktiv"},{value:"archived",label:"Archiv"},{value:"all",label:"Aktiv + Archiv"}],style:{width:170}}),n.jsx(Dt,{value:P,onChange:l=>$(String(l)),options:[{value:"all",label:"Status: Alle"},{value:"open",label:"Status: Offen"},{value:"mixed",label:"Status: Teilweise bezahlt"},{value:"paid_only",label:"Status: Bezahlt"}],style:{width:220}}),n.jsx(Qt,{checked:S,onChange:l=>w(l.target.checked),children:"Nur POs mit offenen Zahlungen"})]}),ae==="table"?n.jsx(ui,{data:$e,columns:Ae,minTableWidth:1360,tableLayout:"auto"}):n.jsxs("div",{className:"v2-po-timeline",children:[n.jsxs("div",{className:"v2-po-timeline-head",style:{"--po-timeline-cols":Fe.length},children:[n.jsx("div",{className:"v2-po-timeline-head-cell v2-po-timeline-head-cell--meta",children:"PO / Supplier"}),Fe.map(l=>n.jsx("div",{className:"v2-po-timeline-head-cell",children:_s(l)},l))]}),$e.length?null:n.jsx(kt,{type:"info",showIcon:!0,message:"Keine POs für die aktuelle Suche/Filter."}),$e.map(l=>{const s=Ln(l.orderDate),f=Ln(l.productionEndDate),C=Ln(l.etdDate),x=Ln(l.etaDate),Z=Ue?Un(s,Ue):0,te=Ue?Un(f,Ue):0,ve=Ue?Un(C,Ue):0,I=Ue?Un(x,Ue):0,ie=Math.max(.75,te-Z),le=Math.max(.75,I-ve);return n.jsxs("div",{className:"v2-po-timeline-row",children:[n.jsxs("button",{type:"button",className:"v2-po-timeline-meta",onClick:()=>Wt(l.raw),children:[n.jsx("div",{className:"v2-po-timeline-title",children:l.poNo||"PO"}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:[l.supplierName," · ",l.skuCount>1?`Multi-SKU (${l.skuCount}), Start ${l.sku}`:l.alias]}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:["Order ",jt(l.orderDate)," · ETA ",jt(l.etaDate)]}),n.jsxs("div",{className:"v2-po-timeline-action-row",children:[n.jsx(Ie,{size:"small",onClick:he=>{he.stopPropagation(),Wt(l.raw,"shipping")},children:"Versendet am..."}),n.jsx(Ie,{size:"small",onClick:he=>{he.stopPropagation(),Wt(l.raw,"arrival")},children:"Empfangen am..."})]})]}),n.jsxs("div",{className:"v2-po-timeline-track",children:[n.jsx("div",{className:"v2-po-timeline-track-bg"}),Ue?n.jsx("div",{className:"v2-po-timeline-today",style:{left:`${ot}%`},title:"Heute"}):null,Ue&&ie>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--production",style:{left:`${Z}%`,width:`${ie}%`},title:"Produktion"}):null,Ue&&le>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--transit",style:{left:`${ve}%`,width:`${le}%`},title:"Transit"}):null,Ue?l.timelineMarkers.map(he=>{const Ee=Ln(he.dueDate),ke=Un(Ee,Ue),De=he.status==="paid"?"v2-po-timeline-marker v2-po-timeline-marker--paid":"v2-po-timeline-marker v2-po-timeline-marker--open",Me=he.direction==="in"?"v2-po-timeline-marker--incoming":"",Oe=[`${Yn(he)} (${he.status==="paid"?"bezahlt":"offen"})`,`Soll: ${sn(he.plannedEur)}`,`Faellig: ${jt(he.dueDate)}`,he.paidDate?`Bezahlt am: ${jt(he.paidDate)}`:"Bezahlt am: —"].join(`
`);return n.jsx(li,{title:n.jsx("span",{style:{whiteSpace:"pre-line"},children:Oe}),children:n.jsx("button",{type:"button",className:`${De} ${Me}`.trim(),style:{left:`${ke}%`},onClick:()=>pn(l,he),"aria-label":`${Yn(he)} fuer ${l.poNo}`})},he.id)}):null]})]},l.id)}),n.jsxs("div",{className:"v2-po-timeline-legend",children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--production"})," Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--transit"})," Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--open"})," Zahlung offen"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--paid"})," Zahlung bezahlt"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-line"})," Heute"]})]})]})]}),n.jsxs(Rt,{title:j?"PO bearbeiten":"PO anlegen",open:F,width:1120,onCancel:()=>{Q.clearDraft(),E(!1),z(null),H(null),_([])},onOk:()=>{if(Q.readOnly){Rt.warning({title:"Nur Lesemodus",content:`${Q.remoteUserLabel||"Kollege"} bearbeitet diese PO. Bitte Bearbeitung übernehmen oder warten.`});return}X.validateFields().then(l=>Ht(l)).catch(l=>{if(l&&typeof l=="object"&&"errorFields"in l)return;const s=l instanceof Error?l.message:l&&typeof l=="object"&&"message"in l?String(l.message||""):"";s&&Jt.error(s)})},children:[Q.banner?n.jsx(kt,{style:{marginBottom:10},type:Q.banner.tone,showIcon:!0,message:Q.banner.text,action:Q.readOnly?n.jsx(Ie,{size:"small",onClick:Q.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,Q.readOnly&&Q.remoteDraftVersion>0?n.jsxs(mt,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",Q.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,n.jsxs(Se,{name:"v2-po-modal",form:X,layout:"vertical",disabled:Q.readOnly,onValuesChange:l=>{Q.readOnly||(Gt(l),tn(l),Q.publishDraftPatch(l))},children:[n.jsx(Se.Item,{name:"id",hidden:!0,children:n.jsx(gt,{})}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"poNo",label:"PO Nummer",style:{width:190},rules:[{required:!0,message:"PO Nummer ist erforderlich."}],children:n.jsx(gt,{})}),n.jsx(Se.Item,{name:"supplierId",label:"Supplier",style:{minWidth:260,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Dt,{showSearch:!0,optionFilterProp:"label",options:pe.map(l=>({value:l.id,label:l.name})),onChange:l=>Mn(String(l||""))})}),n.jsx(Se.Item,{name:"transport",label:"Transport",style:{width:150},children:n.jsx(Dt,{options:[{value:"sea",label:"SEA"},{value:"rail",label:"RAIL"},{value:"air",label:"AIR"}]})})]}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"orderDate",label:"Order Date",style:{width:190},rules:[{required:!0}],children:n.jsx(gt,{type:"date"})}),n.jsx(Se.Item,{name:"etdManual",label:"ETD Manual",style:{width:190},children:n.jsx(gt,{id:"v2-po-etd-manual",type:"date"})}),n.jsx(Se.Item,{name:"etaManual",label:"ETA Manual",style:{width:190},children:n.jsx(gt,{type:"date"})}),n.jsx(Se.Item,{name:"arrivalDate",label:"Empfangen am",style:{width:190},children:n.jsx(gt,{id:"v2-po-arrival-date",type:"date"})}),n.jsx(Se.Item,{name:"fxOverride",label:"FX Override",style:{width:150},children:n.jsx(vt,{mode:"fx",min:0})}),n.jsx(Se.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(vt,{mode:"percent",min:0,max:100})}),n.jsx(Se.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(vt,{mode:"percent",min:0,max:100})})]}),n.jsxs(qe,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Se.Item,{name:"dutyIncludeFreight",valuePropName:"checked",style:{marginTop:31},children:n.jsx(Qt,{children:"Duty inkl. Freight"})}),n.jsx(Se.Item,{name:"ddp",valuePropName:"checked",style:{marginTop:31},children:n.jsx(Qt,{children:"DDP"})}),n.jsx(Se.Item,{name:"archived",valuePropName:"checked",style:{marginTop:31},children:n.jsx(Qt,{children:"Archiviert"})})]}),n.jsxs(It,{size:"small",className:"v2-po-items-card",style:{marginBottom:12},children:[n.jsxs(qe,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(at,{strong:!0,children:"PO Positionen (Supplier-first)"}),n.jsxs(at,{type:"secondary",children:[tt.length," SKU(s)"]})]}),n.jsxs(qe,{style:{width:"100%",marginTop:8},align:"start",wrap:!0,children:[n.jsx(Dt,{mode:"multiple",allowClear:!0,placeholder:Ve?"SKUs auswaehlen":"Zuerst Supplier waehlen",value:U,onChange:l=>_((l||[]).map(s=>String(s||""))),options:Re,style:{minWidth:420,flex:1},optionFilterProp:"label",disabled:!Ve||!Re.length}),n.jsx(Ie,{onClick:()=>hn(U),disabled:!Ve||!U.length,children:"SKUs hinzufuegen"})]}),n.jsx(Se.List,{name:"items",children:(l,{add:s,remove:f})=>n.jsxs(qe,{direction:"vertical",size:8,style:{width:"100%",marginTop:10},children:[l.map(C=>n.jsxs("div",{className:"v2-po-item-row",children:[n.jsxs("div",{className:"v2-po-item-row-main",children:[n.jsx(Se.Item,{...C,name:[C.name,"sku"],label:"SKU",className:"v2-po-item-col v2-po-item-col--sku",rules:[{required:!0,message:"SKU fehlt."}],children:n.jsx(Dt,{showSearch:!0,optionFilterProp:"label",options:fe.filter(x=>String(x.supplierId||"")===String(Ve||"")).map(x=>({value:x.sku,label:`${x.alias} (${x.sku})`})),onChange:x=>ln(Number(C.name),String(x||"")),disabled:!Ve})}),n.jsx(Se.Item,{...C,name:[C.name,"units"],label:"Units",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Units fehlen."}],children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"unitCostUsd"],label:"Unit Cost USD",className:"v2-po-item-col",rules:[{required:!0,message:"Preis fehlt."}],children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"unitExtraUsd"],label:"Unit Extra USD",className:"v2-po-item-col",children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"extraFlatUsd"],label:"Extra Flat USD",className:"v2-po-item-col",children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"freightEur"],label:"Shipping EUR",className:"v2-po-item-col",children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"prodDays"],label:"Prod Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Prod fehlt."}],children:n.jsx(vt,{mode:"int",min:0})}),n.jsx(Se.Item,{...C,name:[C.name,"transitDays"],label:"Transit Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Transit fehlt."}],children:n.jsx(vt,{mode:"int",min:0})})]}),n.jsx(Ie,{danger:!0,size:"small",style:{marginTop:31},onClick:()=>f(C.name),children:"Entfernen"})]},C.key)),n.jsx(Ie,{onClick:()=>s(Bt({id:zt("poi"),sku:"",units:0,unitCostUsd:0,unitExtraUsd:0,extraFlatUsd:0,prodDays:0,transitDays:0,freightEur:0})),disabled:!Ve,children:"Leere Position"})]})})]}),n.jsxs(It,{size:"small",className:"v2-po-aggregate-card",style:{marginBottom:12},children:[n.jsxs(qe,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(at,{strong:!0,children:"Aggregierte Sicht (kritischer Pfad)"}),n.jsx(mt,{className:"v2-po-critical-path-tag",children:"ETA folgt langsamster SKU"})]}),n.jsxs("div",{className:"v2-po-aggregate-grid",children:[n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Goods USD"}),n.jsx("div",{children:Jn(nt.goodsUsd,2)})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Goods EUR"}),n.jsx("div",{children:sn(nt.goodsEur)})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Freight EUR"}),n.jsx("div",{children:sn(nt.freightEur)})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Units gesamt"}),n.jsx("div",{children:Jn(nt.units,0)})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Prod/Transit (kritisch)"}),n.jsxs("div",{children:[Jn(nt.prodDays,0)," / ",Jn(nt.transitDays,0)," Tage"]})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"ETD / ETA"}),n.jsxs("div",{children:[jt(nt.schedule.etdDate)," / ",jt(nt.schedule.etaDate)]})]}),n.jsxs("div",{children:[n.jsx(at,{type:"secondary",children:"Ankunftsfenster"}),n.jsx("div",{children:nt.minEtaDate||nt.maxEtaDate?`${jt(nt.minEtaDate)} - ${jt(nt.maxEtaDate)}`:"—"})]})]})]}),n.jsx(It,{size:"small",style:{marginBottom:12},children:n.jsxs(qe,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(at,{strong:!0,children:"Stammdaten-Herkunft (PO)"}),ee?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Primary SKU"}),n.jsx(at,{children:ee.sku})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Cost USD"}),n.jsx("span",{className:Zt(de.fields.unitPriceUsd.source,!0),children:de.fields.unitPriceUsd.label}),n.jsx(Ie,{size:"small",onClick:()=>ue("unitCostUsd"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",onClick:()=>ge("unitPriceUsd",ee.unitCostUsd),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Prod / Transit"}),n.jsx("span",{className:Zt(de.fields.productionLeadTimeDays.source,!0),children:de.fields.productionLeadTimeDays.label}),n.jsx("span",{className:Zt(de.fields.transitDays.source,!1),children:de.fields.transitDays.label}),n.jsx(Ie,{size:"small",onClick:()=>ue("prodDays"),children:"Prod reset"}),n.jsx(Ie,{size:"small",onClick:()=>ue("transitDays"),children:"Transit reset"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Zt(de.fields.dutyRatePct.source,!1),children:de.fields.dutyRatePct.label}),n.jsx("span",{className:Zt(de.fields.eustRatePct.source,!1),children:de.fields.eustRatePct.label}),n.jsx(Ie,{size:"small",onClick:()=>ue("dutyRatePct"),children:"Duty reset"}),n.jsx(Ie,{size:"small",onClick:()=>ue("eustRatePct"),children:"EUSt reset"}),n.jsx(Ie,{size:"small",onClick:()=>ge("dutyRatePct",V==null?void 0:V.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(Ie,{size:"small",onClick:()=>ge("eustRatePct",V==null?void 0:V.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"DDP"}),n.jsx("span",{className:Zt(de.fields.ddp.source,!0),children:de.fields.ddp.label}),n.jsx(Ie,{size:"small",onClick:()=>ue("ddp"),children:"Zuruecksetzen"}),n.jsx(Ie,{size:"small",onClick:()=>ge("ddp",(V==null?void 0:V.ddp)===!0),children:"Als Produktwert uebernehmen"})]})]}):n.jsx(at,{type:"secondary",children:"Bitte mindestens eine SKU erfassen."})]})}),ee!=null&&ee.sku&&Ne.blocked?n.jsx(kt,{className:"v2-po-warning",type:"error",showIcon:!0,message:"Blockierende Stammdaten fehlen",description:Ne.issues.map(l=>l.label).join(", ")}):null,Ve&&!Re.length?n.jsx(kt,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Dieser Lieferant hat aktuell keine zugeordneten SKUs. Bitte zuerst Stammdaten pflegen."}):null,st.length?n.jsx(kt,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Einige Positionen sind unvollstaendig.",description:st.slice(0,6).join(" | ")}):null,n.jsxs(It,{size:"small",style:{marginBottom:12},children:[n.jsxs(qe,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(at,{strong:!0,children:"Milestones"}),n.jsxs(at,{type:Math.abs(er((V==null?void 0:V.milestones)||[])-100)<=.01?"secondary":"danger",children:["Summe: ",Jn(er((V==null?void 0:V.milestones)||[]),2),"%"]})]}),n.jsx(Se.List,{name:"milestones",children:(l,{add:s,remove:f})=>n.jsxs(qe,{direction:"vertical",size:8,style:{width:"100%"},children:[l.map(C=>n.jsxs(qe,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(Se.Item,{...C,name:[C.name,"label"],style:{minWidth:240,flex:2},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(gt,{placeholder:"Label"})}),n.jsx(Se.Item,{...C,name:[C.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(vt,{mode:"percent",min:0,max:100})}),n.jsx(Se.Item,{...C,name:[C.name,"anchor"],style:{width:160},rules:[{required:!0,message:"Anchor fehlt."}],children:n.jsx(Dt,{options:eo.map(x=>({value:x,label:x}))})}),n.jsx(Se.Item,{...C,name:[C.name,"lagDays"],style:{width:120},children:n.jsx(vt,{mode:"int"})}),n.jsx(Ie,{danger:!0,onClick:()=>f(C.name),children:"X"})]},C.key)),n.jsx(Ie,{onClick:()=>s({id:zt("ms"),label:"Milestone",percent:0,anchor:"ORDER_DATE",lagDays:0}),children:"Milestone"})]})})]}),n.jsx("div",{ref:b,children:n.jsxs(It,{size:"small",children:[n.jsxs(qe,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(at,{strong:!0,children:"Event / Payment Preview"}),n.jsx(Ie,{size:"small",onClick:()=>_t(null),disabled:!j||!lt.length||Q.readOnly,children:"Sammelzahlung buchen"})]}),Le?n.jsxs(qe,{direction:"vertical",size:4,style:{width:"100%",marginTop:8},children:[n.jsxs(at,{children:["Timeline: Order ",jt(Le.orderDate)," · ETD ",jt(Le.etdManual||Wn({orderDate:Le.orderDate,productionLeadTimeDays:Le.prodDays,logisticsLeadTimeDays:Le.transitDays,bufferDays:0}).etdDate)," · ETA ",jt(Le.etaManual||Wn({orderDate:Le.orderDate,productionLeadTimeDays:Le.prodDays,logisticsLeadTimeDays:Le.transitDays,bufferDays:0}).etaDate)]}),j?null:n.jsx(kt,{type:"info",showIcon:!0,message:"PO zuerst speichern, danach koennen Zahlungen (inkl. Sammelzahlung) verbucht werden."}),n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Due"}),n.jsx("th",{children:"Planned EUR"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode / Von"}),n.jsx("th",{children:"Invoice / Folder"}),n.jsx("th",{children:"Aktionen"})]})}),n.jsx("tbody",{children:lt.map(l=>n.jsxs("tr",{children:[n.jsx("td",{children:Ea(String(l.id||""))}),n.jsx("td",{children:Yn(l)}),n.jsx("td",{children:jt(l.dueDate)}),n.jsx("td",{children:sn(l.plannedEur)}),n.jsx("td",{children:l.paidEurActual!=null?sn(l.paidEurActual):"—"}),n.jsx("td",{children:l.status==="paid"?"Bezahlt":"Offen"}),n.jsx("td",{children:jt(l.paidDate)}),n.jsx("td",{children:l.method||l.paidBy?n.jsxs(qe,{direction:"vertical",size:0,children:[n.jsx(at,{children:l.method||"—"}),n.jsx(at,{type:"secondary",children:l.paidBy||"—"})]}):"—"}),n.jsx("td",{children:n.jsxs(qe,{direction:"vertical",size:0,children:[yr(l.invoiceDriveUrl)?n.jsx("a",{href:String(l.invoiceDriveUrl),target:"_blank",rel:"noreferrer",children:"Invoice"}):n.jsx(at,{type:"secondary",children:"Invoice —"}),yr(l.invoiceFolderDriveUrl)?n.jsx("a",{href:String(l.invoiceFolderDriveUrl),target:"_blank",rel:"noreferrer",children:"Folder"}):n.jsx(at,{type:"secondary",children:"Folder —"})]})}),n.jsx("td",{children:n.jsx(Ie,{size:"small",onClick:()=>_t(l),disabled:!j||Q.readOnly,children:l.status==="paid"?"Bearbeiten":"Zahlung buchen"})})]},l.id))})]})}),dt.length?n.jsxs(qe,{direction:"vertical",size:6,style:{width:"100%",marginTop:8},children:[n.jsx(at,{strong:!0,children:"Automatische Eingaenge (Info)"}),n.jsx(kt,{type:"info",showIcon:!0,message:"EUSt-Erstattung wird automatisch verbucht und muss nicht manuell als Zahlung validiert werden."}),n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Due"}),n.jsx("th",{children:"Planned EUR"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Hinweis"})]})}),n.jsx("tbody",{children:dt.map(l=>n.jsxs("tr",{children:[n.jsx("td",{children:Ea(String(l.id||""))}),n.jsx("td",{children:Yn(l)}),n.jsx("td",{children:jt(l.dueDate)}),n.jsx("td",{children:sn(l.plannedEur)}),n.jsx("td",{children:l.status==="paid"?"Bereits eingegangen":"Geplant"}),n.jsx("td",{children:"Automatisch (kein Zahlung buchen)"})]},`incoming-${l.id}`))})]})})]}):null]}):n.jsx(at,{type:"secondary",children:"Preview erscheint nach Eingabe."})]})})]})]}),n.jsxs(Rt,{title:"PO Zahlung verbuchen",open:q,width:920,onCancel:()=>{A(!1),T(null),L([]),g(null),ne.resetFields()},onOk:()=>{g(null),ne.validateFields().then(l=>nn(l)).catch(l=>{l!=null&&l.errorFields||g(String(l instanceof Error?l.message:l))})},children:[D?n.jsx(kt,{type:"error",showIcon:!0,message:D,style:{marginBottom:10}}):null,n.jsxs(Se,{form:ne,layout:"vertical",onFinish:l=>{g(null),nn(l).catch(s=>{g(String(s instanceof Error?s.message:s))})},children:[n.jsx(Se.Item,{name:"selectedEventIds",label:"Welche Zahlungsbausteine sind in dieser Zahlung enthalten?",rules:[{required:!0,message:"Bitte mindestens einen Baustein waehlen."}],children:n.jsx(Qt.Group,{style:{width:"100%"},children:n.jsx(qe,{direction:"vertical",style:{width:"100%"},children:lt.map(l=>{const s=l.status==="paid"&&l.paymentId&&l.paymentId!==G&&!k.includes(l.id);return n.jsx(It,{size:"small",style:{width:"100%"},children:n.jsx(Qt,{value:l.id,disabled:s,children:n.jsxs(qe,{size:10,wrap:!0,children:[n.jsx(at,{strong:!0,children:Yn(l)}),n.jsxs(at,{type:"secondary",children:["Due ",jt(l.dueDate)]}),n.jsx(at,{children:sn(l.plannedEur)}),l.status==="paid"?n.jsx(mt,{color:"green",children:"Bereits bezahlt"}):n.jsx(mt,{children:"Offen"}),l.paymentId?n.jsxs(at,{type:"secondary",children:["Payment-ID ",l.paymentId]}):null]})})},l.id)})})})}),n.jsxs(qe,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Se.Item,{name:"paidDate",label:"Zahlungsdatum",style:{width:170},rules:[{required:!0}],children:n.jsx(gt,{type:"date"})}),n.jsx(Se.Item,{name:"method",label:"Zahlungsmethode",style:{minWidth:240,flex:1},rules:[{required:!0}],children:n.jsx(Dt,{showSearch:!0,optionFilterProp:"label",options:ht,placeholder:"z. B. Alibaba Trade Assurance"})}),n.jsx(Se.Item,{name:"paidBy",label:"Bezahlt durch",style:{minWidth:220,flex:1},rules:[{required:!0}],children:n.jsx(gt,{placeholder:bt.map(l=>l.label).join(" / ")||"Name oder E-Mail"})})]}),n.jsxs(qe,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Se.Item,{name:"amountActualEur",label:"Ist-Betrag EUR",style:{width:190},rules:[{required:!0}],children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{name:"amountActualUsd",label:"Ist-Betrag USD (optional)",style:{width:210},children:n.jsx(vt,{mode:"decimal",min:0})}),n.jsx(Se.Item,{name:"paymentId",label:"Payment-ID (intern)",style:{minWidth:300,flex:1},children:n.jsx(gt,{placeholder:"pay-..."})})]}),n.jsxs(qe,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Se.Item,{name:"invoiceDriveUrl",label:"Invoice Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(gt,{placeholder:"https://..."})}),n.jsx(Ie,{style:{marginTop:31},disabled:!yr(String((ct==null?void 0:ct.invoiceDriveUrl)||"")),onClick:()=>window.open(String((ct==null?void 0:ct.invoiceDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Link oeffnen"})]}),n.jsxs(qe,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Se.Item,{name:"invoiceFolderDriveUrl",label:"Ordner-Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(gt,{placeholder:"https://..."})}),n.jsx(Ie,{style:{marginTop:31},disabled:!yr(String((ct==null?void 0:ct.invoiceFolderDriveUrl)||"")),onClick:()=>window.open(String((ct==null?void 0:ct.invoiceFolderDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Ordner oeffnen"})]}),n.jsx(Se.Item,{name:"note",label:"Notiz",children:n.jsx(gt.TextArea,{rows:2,placeholder:"Optionaler Hinweis"})}),n.jsx(It,{size:"small",children:n.jsxs(qe,{direction:"vertical",style:{width:"100%"},size:6,children:[n.jsx(at,{strong:!0,children:"Dateiname-Vorschlag fuer Rechnung"}),n.jsx(at,{code:!0,children:Yt||"—"}),n.jsx("div",{children:n.jsx(Ie,{size:"small",onClick:()=>{Yt&&(navigator.clipboard.writeText(Yt),Jt.success("Dateiname kopiert."))},children:"Dateiname kopieren"})})]})})]})]})]})}const{Text:Vr}=Nn,{RangePicker:Fu}=Gn,Au={"3m":3,"6m":6,"12m":12,"18m":18},yn="-";function Zr(e){return String(e||"").trim()}function Lu(e){const t=e.archived===!0,r=String(e.status||"").trim().toUpperCase()==="CANCELLED";return t||r?"closed":"planning"}function Uu(e){const t=wn(e.status);return t==="DRAFT"||t==="ACTIVE"?"planning":"closed"}function _u(e,t,r){const a=pi(e.categoryLabel,t.categoryLabel,r);if(a!==0)return a;const i=String(e.alias||"").localeCompare(String(t.alias||""),"de-DE",{sensitivity:"base"});return i!==0?i:e.sku.localeCompare(t.sku,"de-DE",{sensitivity:"base"})}function Fa(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):null}function Hu(e){return Number.isFinite(e)?`${Number(e).toLocaleString("de-DE",{maximumFractionDigits:0})} Stk`:yn}function Aa(e){if(!e)return yn;const t=Pt(e);return t.isValid()?t.format("DD.MM.YYYY"):e}function La(e){const t=[e.destination,e.destinationName,e.targetWarehouse,e.warehouse,e.warehouseName,e.fulfillmentCenter,e.portTo];for(const r of t){const a=String(r||"").trim();if(a)return a}return null}function Ua(e,t){const r=String(t||"").trim().replace(/\s+/g,"");if(!r)return e;const a=r.toUpperCase();return a.startsWith(e)?a:`${e}${r}`}function Bu(e){const t=String(e||"");return t?Math.max(38,Math.round(t.length*6.4+12)):38}function zu(e){var u;const t=((u=e==null?void 0:e.itemContext)==null?void 0:u.dimensions)||{},r=Number(t.width||0),a=Number(t.height||0),i=Math.min(Math.max(0,a/2),Math.max(0,r/2-1),10);return Number.isFinite(i)?Math.max(0,i):0}function Yu(e,t){var h,y;const r=((h=e==null?void 0:e.itemContext)==null?void 0:h.dimensions)||{},a=Number(r.width||0),i=Number(r.left||0),u=Bu(t),c=typeof((y=e==null?void 0:e.timelineContext)==null?void 0:y.getTimelineState)=="function"?e.timelineContext.getTimelineState():null,d=Number((c==null?void 0:c.timelineWidth)||0);if(d<=0)return"right";const p=Math.max(0,d-(i+a)),v=Math.max(0,i);return p>=u+6?"right":v>=u+6?"left":"right"}function _a(e){if(!e.length)return e;let t=0;for(let r=1;r<e.length;r+=1)e[r].endMs>=e[t].endMs&&(t=r);return e.map((r,a)=>({...r,tooltipData:{...r.tooltipData,showReferenceLabel:a===t}}))}function Hn(e){return String(e||"").trim()||yn}function Wu(e){const t=[{key:"Typ",value:Hn(e.type)},{key:"Nummer",value:Hn(e.identifier)},{key:"Phase",value:Hn(e.phase)},{key:"Menge",value:Hu(e.units??null)},{key:"Zeitraum",value:`${Aa(String(e.startDate||""))} - ${Aa(String(e.endDate||""))}`},{key:"Supplier",value:Hn(e.supplier)}];return e.destination&&t.push({key:"Ziel",value:Hn(e.destination)}),e.isPhantom&&t.push({key:"Hinweis",value:Hn(e.phantomReason||"Phantom FO (vorbehaltlich)")}),n.jsx("div",{className:"v2-orders-gantt-tooltip",children:t.map(r=>n.jsxs("div",{className:"v2-orders-gantt-tooltip-row",children:[n.jsx("span",{className:"v2-orders-gantt-tooltip-key",children:r.key}),n.jsx("span",{className:"v2-orders-gantt-tooltip-value",children:r.value})]},r.key))})}function Ku(){const e=Cr(),{state:t}=Mr(),[r,a]=o.useState(""),[i,u]=o.useState("all"),[c,d]=o.useState("all"),[p,v]=o.useState("all"),[h,y]=o.useState("planning"),[M,N]=o.useState("12m"),[P,$]=o.useState(null),S=t,w=o.useMemo(()=>io(S),[t.productCategories]),F=o.useMemo(()=>{const T=new Map;return(Array.isArray(t.productCategories)?t.productCategories:[]).forEach(D=>{const g=D,k=String(g.id||"");k&&T.set(k,String(g.name||"Ohne Kategorie"))}),T},[t.productCategories]),E=o.useMemo(()=>{const T=new Map;return(Array.isArray(t.suppliers)?t.suppliers:[]).forEach(D=>{const g=D,k=String(g.id||"");k&&T.set(k,String(g.name||yn))}),T},[t.suppliers]),j=o.useMemo(()=>{const T=new Map;return(Array.isArray(t.products)?t.products:[]).forEach(D=>{const g=D,k=Zr(g.sku);k&&T.set(k,g)}),T},[t.products]),K=o.useMemo(()=>so(S,18),[t.settings]),U=o.useMemo(()=>oo({state:S,months:K}),[K,S]),_=o.useMemo(()=>new Map(U.map(T=>[T.id,T])),[U]),X=o.useMemo(()=>{const T=(Array.isArray(t.productCategories)?t.productCategories:[]).map(D=>D).map(D=>({value:String(D.id||""),label:String(D.name||"Ohne Kategorie")})).filter(D=>D.value).sort((D,g)=>pi(D.label,g.label,w));return[{value:"all",label:"Kategorie: Alle"},...T,{value:"__uncat__",label:"Ohne Kategorie"}]},[w,t.productCategories]),ne=o.useMemo(()=>{const T=Array.from(E.entries()).map(([D,g])=>({value:D,label:g})).sort((D,g)=>D.label.localeCompare(g.label,"de-DE",{sensitivity:"base"}));return[{value:"all",label:"Supplier: Alle"},...T]},[E]),q=o.useCallback(T=>{const D=(T==null?void 0:T.item)||{},g=D.meta&&typeof D.meta=="object"?D.meta:{},k=String(g.referenceLabel||""),L=g.showReferenceLabel===!0&&!!k,R=L?Yu(T,k):"right",H=zu(T),B=T.getItemProps({className:`${String(D.className||"")} v2-orders-gantt-pill v2-orders-gantt-pill--minimal`.trim(),style:{borderRadius:`${H}px`}});return n.jsx(li,{title:Wu(g),placement:"top",mouseEnterDelay:.12,overlayClassName:"v2-orders-gantt-tooltip-overlay",children:n.jsx("div",{...B,children:L?n.jsx("span",{className:`v2-orders-gantt-ref v2-orders-gantt-ref--${R}`,children:k}):null})})},[]),A=o.useMemo(()=>{const T=new Map,D=[],g=(b,W="")=>{if(T.has(b))return T.get(b);const O=j.get(b)||{},ae=String(O.supplierId||W||""),J=E.get(ae)||yn,oe=String(O.categoryId||"")||null,me=oe&&F.get(oe)||"Ohne Kategorie",se=String(O.alias||b),Q={sku:b,alias:se,supplierId:ae,supplierName:J,categoryId:oe,categoryLabel:me,items:[],references:[]};return T.set(b,Q),Q};(Array.isArray(t.pos)?t.pos:[]).map(b=>b).forEach(b=>{var ye;const W=Lu(b);if(h==="planning"&&W!=="planning"||h==="closed"&&W!=="closed")return;const O=or({items:b.items,orderDate:b.orderDate,fxRate:Number(((ye=t.settings)==null?void 0:ye.fxRate)||0),fallback:b}),ae=Wn({orderDate:b.orderDate,productionLeadTimeDays:O.prodDays||b.prodDays,logisticsLeadTimeDays:O.transitDays||b.transitDays,bufferDays:0}),J=String(b.orderDate||""),Y=String(b.etdManual||ae.etdDate||""),oe=String(b.etaManual||ae.etaDate||""),me=cn(J),se=cn(Y),Q=cn(oe),xe=La(b);J&&D.push(J),Y&&D.push(Y),oe&&D.push(oe);const pe=String(b.poNo||String(b.id||"").slice(-6).toUpperCase()||"PO"),Ce=Ua("PO",pe),we=String(b.supplierId||"");(Array.isArray(b.items)&&b.items.length?b.items:[{sku:b.sku,units:b.units}]).forEach((re,$e)=>{const He=Zr((re==null?void 0:re.sku)||b.sku);if(!He)return;const je=g(He,we),Fe=Fa((re==null?void 0:re.units)??(re==null?void 0:re.qty)??(re==null?void 0:re.quantity)??b.units),Ue=je.supplierName!==yn?je.supplierName:null,ot=[],et=me??se,Ae=se;if(et!=null&&Ae!=null){const V=Sn({startMs:et,endMs:Ae});ot.push({id:`po:${String(b.id||pe)}:${He}:${$e}:production`,startMs:V.startMs,endMs:V.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-production",tooltipData:{type:"PO",identifier:Ce,phase:"Production",units:Fe,startDate:J||Y,endDate:Y||J,supplier:Ue,destination:xe,referenceLabel:Ce,showReferenceLabel:!1},openTarget:{entity:"po",poNo:pe}})}if(Q!=null){const Ve=Sn({startMs:se??me??Q,endMs:Q});ot.push({id:`po:${String(b.id||pe)}:${He}:${$e}:transit`,startMs:Ve.startMs,endMs:Ve.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-transit",tooltipData:{type:"PO",identifier:Ce,phase:"Transit",units:Fe,startDate:Y||J||oe,endDate:oe||Y||J,supplier:Ue,destination:xe,referenceLabel:Ce,showReferenceLabel:!1},openTarget:{entity:"po",poNo:pe}})}_a(ot).forEach(V=>{je.items.push(V)}),je.references.push(Ce)})}),[...(Array.isArray(t.fos)?t.fos:[]).map(b=>b),...U.map(b=>b.foRecord)].forEach(b=>{var et,Ae;const W=Uu(b);if(h==="planning"&&W!=="planning"||h==="closed"&&W!=="closed")return;const O=br({targetDeliveryDate:b.targetDeliveryDate||b.deliveryDate||b.etaDate,productionLeadTimeDays:b.productionLeadTimeDays,logisticsLeadTimeDays:b.logisticsLeadTimeDays,bufferDays:b.bufferDays}),ae=String(b.orderDate||O.orderDate||""),J=String(b.etdDate||O.etdDate||""),Y=String(b.etaDate||O.etaDate||b.targetDeliveryDate||""),oe=cn(ae),me=cn(J),se=cn(Y),Q=La(b),xe=Fa(b.units??b.qty??b.quantity);ae&&D.push(ae),J&&D.push(J),Y&&D.push(Y);const pe=Zr(b.sku);if(!pe)return;const Ce=g(pe,String(b.supplierId||"")),we=String(b.id||""),fe=String(b.foNo||b.foNumber||we.slice(-6).toUpperCase()||yn),ye=Ua("FO",fe),re=we&&_.get(we)||null,$e=!!(b.phantom===!0||re),He=$e?{id:String((re==null?void 0:re.id)||we),sku:pe,month:String((re==null?void 0:re.firstRiskMonth)||""),suggestedUnits:Math.max(0,Math.round(Number((re==null?void 0:re.suggestedUnits)||b.units||0))),requiredArrivalDate:String((re==null?void 0:re.requiredArrivalDate)||b.targetDeliveryDate||b.etaDate||"")||null,recommendedOrderDate:String((re==null?void 0:re.recommendedOrderDate)||(re==null?void 0:re.latestOrderDate)||b.orderDate||"")||null,firstRiskMonth:String((re==null?void 0:re.firstRiskMonth)||"")||null,orderMonth:String((re==null?void 0:re.orderMonth)||"")||null,leadTimeDays:Number.isFinite(Number(re==null?void 0:re.leadTimeDays))?Math.max(0,Math.round(Number(re==null?void 0:re.leadTimeDays))):null}:null,je=Ce.supplierName!==yn?Ce.supplierName:null,Fe=[],Ue=oe??me,ot=me;if(Ue!=null&&ot!=null){const V=Sn({startMs:Ue,endMs:ot});Fe.push({id:`fo:${we}:${pe}:production`,startMs:V.startMs,endMs:V.endMs,className:["v2-orders-gantt-item","v2-orders-gantt-item--fo-production",$e?"v2-orders-gantt-item--fo-phantom":""].join(" ").trim(),tooltipData:{type:"FO",identifier:ye,phase:"Production",units:xe,startDate:ae||J,endDate:J||ae,supplier:je,destination:Q,referenceLabel:ye,showReferenceLabel:!1,isPhantom:$e,phantomReason:String((et=re==null?void 0:re.foRecord)!=null&&et.phantomMeta&&typeof re.foRecord.phantomMeta=="object"?re.foRecord.phantomMeta.reason:b.phantomMeta&&typeof b.phantomMeta=="object"?b.phantomMeta.reason:"")||null},openTarget:{entity:"fo",foId:we,phantomMeta:He}})}if(se!=null){const Ve=Sn({startMs:me??oe??se,endMs:se});Fe.push({id:`fo:${we}:${pe}:transit`,startMs:Ve.startMs,endMs:Ve.endMs,className:["v2-orders-gantt-item","v2-orders-gantt-item--fo-transit",$e?"v2-orders-gantt-item--fo-phantom":""].join(" ").trim(),tooltipData:{type:"FO",identifier:ye,phase:"Transit",units:xe,startDate:J||ae||Y,endDate:Y||J||ae,supplier:je,destination:Q,referenceLabel:ye,showReferenceLabel:!1,isPhantom:$e,phantomReason:String((Ae=re==null?void 0:re.foRecord)!=null&&Ae.phantomMeta&&typeof re.foRecord.phantomMeta=="object"?re.foRecord.phantomMeta.reason:b.phantomMeta&&typeof b.phantomMeta=="object"?b.phantomMeta.reason:"")||null},openTarget:{entity:"fo",foId:we,phantomMeta:He}})}_a(Fe).forEach(V=>{Ce.items.push(V)}),Ce.references.push(ye)});const L=Array.from(T.values()).sort((b,W)=>_u(b,W,w)),R=[],H=[],B=new Map,z=r.trim().toLowerCase();return L.forEach(b=>{if(i==="__uncat__"&&b.categoryId||i!=="all"&&i!=="__uncat__"&&b.categoryId!==i||c!=="all"&&b.supplierId!==c)return;const W=b.items.filter(ae=>p==="all"||ae.openTarget.entity===p);if(!W.length)return;const O=[b.sku,b.alias,b.supplierName,b.categoryLabel,...b.references].join(" ").toLowerCase();z&&!O.includes(z)||(R.push({id:b.sku,title:n.jsxs("div",{className:"v2-orders-gantt-meta v2-orders-gantt-meta--sku",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(Vr,{strong:!0,className:"v2-orders-gantt-sku-title",children:b.alias}),n.jsx(mt,{className:"v2-orders-gantt-lane-tag",children:b.sku})]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[b.supplierName," · ",b.categoryLabel]})]})}),W.forEach(ae=>{H.push({id:ae.id,group:b.sku,startMs:ae.startMs,endMs:ae.endMs,className:ae.className,meta:ae.tooltipData}),B.set(ae.id,ae.openTarget)}))}),{groups:R,items:H,targetByItemId:B,timelineWindow:os({state:S,dates:D,fallbackHorizon:12})}},[F,i,w,_,U,j,r,t.fos,t.pos,t.settings,S,h,E,c,p]),G=o.useMemo(()=>{var L,R;const T=A.timelineWindow;if(M==="custom"){const H=(L=P==null?void 0:P[0])==null?void 0:L.startOf("day").valueOf(),B=(R=P==null?void 0:P[1])==null?void 0:R.endOf("day").valueOf();return Number.isFinite(H)&&Number.isFinite(B)&&Number(B)>Number(H)?{visibleStartMs:Number(H),visibleEndMs:Number(B)}:T}const D=Pt(T.visibleStartMs).startOf("month").valueOf(),g=Au[M],k=Pt(D).add(g,"month").endOf("day").valueOf();return{visibleStartMs:D,visibleEndMs:k}},[P,M,A.timelineWindow]);return n.jsxs(It,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(gt,{placeholder:"Suche SKU, Alias, PO/FO, Supplier",value:r,onChange:T=>a(T.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Dt,{value:i,options:X,onChange:T=>u(String(T||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Dt,{value:c,options:ne,onChange:T=>d(String(T||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Dt,{value:p,onChange:T=>v(String(T||"all")),options:[{value:"all",label:"Typ: PO + FO"},{value:"po",label:"Typ: nur PO"},{value:"fo",label:"Typ: nur FO"}],style:{width:170}}),n.jsx(Dt,{value:h,onChange:T=>y(String(T||"planning")),options:[{value:"planning",label:"Status: Planungsrelevant"},{value:"all",label:"Status: Alle"},{value:"closed",label:"Status: Abgeschlossen"}],style:{width:220}})]}),n.jsxs("div",{className:"v2-toolbar-row v2-orders-gantt-range-row",style:{marginBottom:10},children:[n.jsx(Vr,{type:"secondary",children:"Zeitraum:"}),n.jsx(sa,{value:M,options:[{value:"3m",label:"3M"},{value:"6m",label:"6M"},{value:"12m",label:"12M"},{value:"18m",label:"18M"},{value:"custom",label:"Custom"}],onChange:T=>{const D=String(T||"12m");N(D),D==="custom"&&!P&&$([Pt(A.timelineWindow.visibleStartMs),Pt(A.timelineWindow.visibleEndMs)])}}),M==="custom"?n.jsx(Fu,{className:"v2-orders-gantt-range-picker",value:P||void 0,format:"DD.MM.YYYY",allowClear:!0,onChange:T=>{if(!T){$(null);return}$(T)}}):null]}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsxs(mt,{children:[A.groups.length," SKUs"]}),n.jsxs(mt,{children:[A.items.length," Segmente"]}),U.length?n.jsxs(mt,{color:"gold",children:["Phantom FO: ",U.length]}):null,n.jsx(mt,{color:"green",children:"SKU Timeline"})]}),n.jsxs("div",{className:"v2-orders-gantt-legend",style:{marginBottom:10},children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-production"})," PO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-transit"})," PO Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-production"})," FO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-transit"})," FO Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-phantom"})," Phantom FO (vorbehaltlich)"]})]}),n.jsx(ls,{className:"v2-orders-gantt--sku",groups:A.groups,items:A.items,visibleStartMs:G.visibleStartMs,visibleEndMs:G.visibleEndMs,sidebarHeaderLabel:"SKU",sidebarWidth:500,lineHeight:66,itemHeightRatio:.58,stackItems:!0,showTodayMarker:!1,emptyMessage:"Keine SKU-Eintraege fuer die aktuelle Suche/Filter.",itemRenderer:q,onItemSelect:T=>{const D=A.targetByItemId.get(T);if(D){if(D.entity==="po"&&D.poNo){const g=new URLSearchParams;g.set("source","fo_convert"),g.set("poNo",D.poNo),e(`/v2/orders/po?${g.toString()}`);return}if(D.entity==="fo"&&D.phantomMeta){const g=new URLSearchParams;g.set("source","phantom_fo"),g.set("phantomId",D.phantomMeta.id),g.set("sku",D.phantomMeta.sku),g.set("month",D.phantomMeta.month),g.set("suggestedUnits",String(Math.max(0,Math.round(Number(D.phantomMeta.suggestedUnits||0))))),D.phantomMeta.requiredArrivalDate&&g.set("requiredArrivalDate",D.phantomMeta.requiredArrivalDate),D.phantomMeta.recommendedOrderDate&&g.set("recommendedOrderDate",D.phantomMeta.recommendedOrderDate),D.phantomMeta.firstRiskMonth&&g.set("firstRiskMonth",D.phantomMeta.firstRiskMonth),D.phantomMeta.orderMonth&&g.set("orderMonth",D.phantomMeta.orderMonth),Number.isFinite(Number(D.phantomMeta.leadTimeDays))&&g.set("leadTimeDays",String(Math.max(0,Math.round(Number(D.phantomMeta.leadTimeDays||0))))),g.set("returnTo","/v2/orders/sku"),e(`/v2/orders/fo?${g.toString()}`);return}if(D.entity==="fo"&&D.foId){const g=new URLSearchParams;g.set("source","orders_sku"),g.set("foId",D.foId),e(`/v2/orders/fo?${g.toString()}`)}}}}),n.jsxs(qe,{style:{marginTop:10},wrap:!0,children:[n.jsx(Vr,{type:"secondary",children:"Klick auf ein Segment oeffnet den Datensatz; Phantom-FOs öffnen den vorausgefüllten FO-Entwurf."}),n.jsx(Ie,{size:"small",onClick:()=>e("/v2/orders/po?view=timeline"),children:"PO Timeline oeffnen"}),n.jsx(Ie,{size:"small",onClick:()=>e("/v2/orders/fo?view=timeline"),children:"FO Timeline oeffnen"})]})]})}const{Paragraph:Ha,Title:Ba}=Nn;function qu(e){return e.includes("/orders/sku")?"sku":e.includes("/orders/fo")?"fo":"po"}function kc(){const e=ia(),t=Cr(),{state:r}=Mr(),a=o.useMemo(()=>qu(e.pathname),[e.pathname]),i=o.useMemo(()=>(Array.isArray(r.payments)?r.payments:[]).map(c=>c).map(c=>({id:String(c.id||""),paidDate:String(c.paidDate||""),method:String(c.method||"—"),payer:String(c.payer||"—"),amountActualEurTotal:Number(c.amountActualEurTotal||0),coveredCount:Array.isArray(c.coveredEventIds)?c.coveredEventIds.length:0})).filter(c=>c.id).sort((c,d)=>String(d.paidDate||"").localeCompare(String(c.paidDate||""))).slice(0,12),[r.payments]),u=o.useMemo(()=>i.reduce((c,d)=>c+Number(d.amountActualEurTotal||0),0),[i]);return n.jsxs("div",{className:"v2-page",children:[n.jsx(It,{className:"v2-intro-card",children:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Ba,{level:3,children:"Bestellungen"}),n.jsx(Ha,{children:"Gemeinsamer Arbeitsbereich für Forecast Orders und Purchase Orders mit schneller FO-zu-PO Übergabe."})]})})}),n.jsxs(It,{style:{marginBottom:12},children:[n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Ba,{level:5,children:"Zahlungsprotokoll (PO-Ist)"}),n.jsx(Ha,{children:"Tatsächlich bestätigte Zahlungen werden nur auf POs gebucht. FOs bleiben Planobjekte."})]})}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:8},children:[n.jsxs(Nn.Text,{type:"secondary",children:["Eintraege: ",i.length]}),n.jsxs(Nn.Text,{type:"secondary",children:["Summe Ist: ",u.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]})]}),n.jsx("div",{className:"v2-stats-table-wrap",children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Payment-ID"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode"}),n.jsx("th",{children:"Durch"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Abgedeckte Events"})]})}),n.jsx("tbody",{children:i.length?i.map(c=>n.jsxs("tr",{children:[n.jsx("td",{children:c.id}),n.jsx("td",{children:c.paidDate||"—"}),n.jsx("td",{children:c.method}),n.jsx("td",{children:c.payer}),n.jsxs("td",{children:[Number(c.amountActualEurTotal||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]}),n.jsx("td",{children:c.coveredCount})]},c.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Noch keine Zahlungen verbucht."})})})]})})]}),n.jsx(Bs,{activeKey:a,onChange:c=>t(`/v2/orders/${c}`),items:[{key:"po",label:"Bestellungen (PO)",children:n.jsx(Ou,{embedded:!0})},{key:"fo",label:"Forecast Orders (FO)",children:n.jsx(Du,{embedded:!0})},{key:"sku",label:"SKU Sicht",children:n.jsx(Ku,{})}]})]})}export{kc as default};
