import{p as F,ae as p,Q as R,K as T,bx as C,ab as L,R as z,P as v}from"./index-Bu80Uwbp.js";const E=["standalone","variant_of_existing","category_adjacent"],j=["Jan","Feb","Maerz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],I=24*60*60*1e3;function b(e){if(e==null||e==="")return null;const n=Number(e);return Number.isFinite(n)?n:null}function S(e){const n=Number(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<1||t>12?null:t}function N(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}$/.test(n))return n;const t=n.match(/^(\d{2})-(\d{4})$/);return t?`${t[2]}-${t[1]}`:null}function $(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return t*12+(r-1)}function O(e,n){const t=$(e);if(t==null)return e;const r=t+Number(n||0),a=Math.floor(r/12),s=r%12+1;return`${a}-${String(s).padStart(2,"0")}`}function x(e,n){const t=N(e),r=Number.isFinite(n)?Math.max(0,Math.round(n)):0;return!t||!r?[]:Array.from({length:r},(a,s)=>O(t,s))}function W(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}function M(e,n,t){return Number.isFinite(e)?Math.min(t,Math.max(n,e)):n}function D(e){const n=b(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<=0?null:t}function _(e){const n=String(e||"").trim().toLowerCase();return E.includes(n)?n:"standalone"}function Y(e){const n=String(e||"").trim().toLowerCase();return n==="archived"?"archived":n==="draft"?"draft":"active"}function k(e){return String(e||"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function y(e){return String(e||"").trim()}function U(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}-\d{2}$/.test(n)){const[r,a,s]=n.split("-").map(Number),c=new Date(Date.UTC(r,a-1,s));if(c.getUTCFullYear()===r&&c.getUTCMonth()===a-1&&c.getUTCDate()===s)return n}const t=new Date(n);return Number.isNaN(t.getTime())?null:`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}function B(e){const n=U(e);if(!n)return null;const[t,r,a]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,a))}function K(e){return!(e instanceof Date)||Number.isNaN(e.getTime())?null:`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}`}function G(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r,0)).getUTCDate()}function J(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,1))}function A(e){const n={};return!e||typeof e!="object"||Object.entries(e).forEach(([t,r])=>{const a=N(t),s=b(r);!a||!Number.isFinite(s)||(n[a]=Number(s))}),n}function V(e,n=0){const t=k(e==null?void 0:e.id);if(t)return`plan:${t}`;const r=k(e==null?void 0:e.alias);return r?`plan:${r}`:`plan:row-${n+1}`}function q(e,n=0){const t=e&&typeof e=="object"?e:{},r=String(t.alias||"").trim(),a=String(t.id||""),s=_(t.relationType),c=S(t.baselineReferenceMonth),l=b(t.baselineUnitsInReferenceMonth),f=b(t.avgSellingPriceGrossEUR),d=b(t.sellerboardMarginPct),o=U(t.launchDate),i=D(t.rampUpWeeks),m=b(t.softLaunchStartSharePct),h=Number.isFinite(m)?M(Number(m),0,100):0,u=Y(t.status),g=T(t.includeInForecast,u==="active");return{id:a||`plan-${n+1}`,key:V({id:a,alias:r},n),alias:r,plannedSku:y(t.plannedSku),relationType:s,categoryId:t.categoryId?String(t.categoryId):null,status:u,portfolioBucket:z(t.portfolioBucket,v.PLAN),includeInForecast:g,launchCosts:L(t.launchCosts,`plan-lc-${n+1}`),seasonalityReferenceSku:y(t.seasonalityReferenceSku),baselineReferenceMonth:c,baselineUnitsInReferenceMonth:l,baselineReferenceSku:y(t.baselineReferenceSku),avgSellingPriceGrossEUR:f,sellerboardMarginPct:d,launchDate:o,rampUpWeeks:i,softLaunchStartSharePct:h,mappedSku:y(t.mappedSku||t.liveSku),mappedAt:t.mappedAt?String(t.mappedAt):null,archivedAt:t.archivedAt?String(t.archivedAt):null,createdAt:t.createdAt?String(t.createdAt):null,updatedAt:t.updatedAt?String(t.updatedAt):null,raw:t}}function H(e,n=0){const t=e&&typeof e=="object"?e:{},r=A(t.planUnitsByMonth),a=Array.isArray(t.months)?t.months.map(s=>N(s)).filter(Boolean):Object.keys(r);return{id:String(t.id||`plan-map-${n+1}`),planProductId:String(t.planProductId||""),planProductAlias:String(t.planProductAlias||""),sku:y(t.sku),plannedSku:y(t.plannedSku),mappedAt:t.mappedAt?String(t.mappedAt):null,launchDate:U(t.launchDate),rampUpWeeks:D(t.rampUpWeeks),softLaunchStartSharePct:M(Number(b(t.softLaunchStartSharePct)||0),0,100),baselineReferenceMonth:S(t.baselineReferenceMonth),baselineUnitsInReferenceMonth:b(t.baselineUnitsInReferenceMonth),seasonalityReferenceSku:y(t.seasonalityReferenceSku),months:a.filter(s=>!!s).sort(),planUnitsByMonth:r,planRevenueByMonth:A(t.planRevenueByMonth),raw:t}}function w(e,n){if(!n||!e||typeof e!="object")return null;const t=e[n];if(t&&typeof t=="object")return t;const r=String(n).toLowerCase(),a=Object.keys(e).find(c=>c.toLowerCase()===r);if(!a)return null;const s=e[a];return s&&typeof s=="object"?s:null}function Q(e,n){const t=w(e,n);if(!t)return null;const r=Object.entries(t).map(([o,i])=>{const m=N(o);if(!m)return null;const h=S(m.slice(5,7));if(h==null)return null;const u=i&&typeof i=="object"?F(i.units):F(i);return Number.isFinite(u)?{month:m,monthNumber:h,units:Number(u)}:null}).filter(Boolean).sort((o,i)=>o.month.localeCompare(i.month));if(!r.length)return null;const a=Array.from({length:12},()=>[]);r.forEach(o=>{a[o.monthNumber-1].push(o.units)});const s=a.map(o=>o.length?o.reduce((i,m)=>i+m,0)/o.length:null),c=s.filter(o=>Number.isFinite(o)),l=c.length?c.reduce((o,i)=>o+i,0)/c.length:null,f={},d={};for(let o=1;o<=12;o+=1){const i=s[o-1];d[o]=Number.isFinite(i)?Number(i):null,f[o]=Number.isFinite(i)&&Number.isFinite(l)&&l>0?Number(i)/Number(l):null}return{sku:String(n||"").trim(),startMonth:r[0].month,endMonth:r[r.length-1].month,sampleMonthCount:r.length,coveredMonthTypes:Object.values(d).filter(o=>Number.isFinite(o)).length,overallAverage:Number.isFinite(l)?Number(l):null,factorsByMonthNumber:f,averagesByMonthNumber:d}}function X(e){const n=b(e.baselineUnitsInReferenceMonth),t=S(e.baselineReferenceMonth),r=S(e.targetMonthNumber),a=e.factorsByMonthNumber||{};if(n==null||n<0||t==null||r==null)return null;const s=b(a[t]),c=b(a[r]);if(!Number.isFinite(s)||!Number.isFinite(c)||s<=0)return null;const l=Number(n)*(Number(c)/Number(s));return Number.isFinite(l)?Math.max(0,Number(l)):null}function Z(e){const n=B(e==null?void 0:e.launchDate),t=D(e==null?void 0:e.rampUpWeeks);if(!n||!t)return{launchDate:n,rampEndDate:null,rampDurationDays:null};const r=Math.max(1,Math.round(t*7)),a=new Date(n.getTime()+r*I);return{launchDate:n,rampEndDate:a,rampDurationDays:r}}function ee(e){const n=e==null?void 0:e.date,t=e==null?void 0:e.launchDate,r=e==null?void 0:e.rampEndDate,a=M(Number((e==null?void 0:e.softStartShare)||0),0,1);if(!(n instanceof Date)||Number.isNaN(n.getTime())||!(t instanceof Date)||Number.isNaN(t.getTime()))return 1;if(n<t)return 0;if(!(r instanceof Date)||Number.isNaN(r.getTime())||n>r)return 1;const s=r.getTime()-t.getTime();if(s<=0)return 1;const c=n.getTime()-t.getTime(),l=M(c/s,0,1);return M(a+(1-a)*l,a,1)}function te(e){const n=N(e==null?void 0:e.month),t=b(e==null?void 0:e.baseUnits),r=J(n),a=G(n);if(!r||!Number.isFinite(t)||!Number.isFinite(a)||a<=0)return{units:null,unitsRaw:null,rampFactor:null,weightedDays:0,activeDays:0,daysInMonth:Number.isFinite(a)?a:null};const s=M(Number(b(e==null?void 0:e.softLaunchStartSharePct)||0)/100,0,1),c=Z({launchDate:e==null?void 0:e.launchDate,rampUpWeeks:e==null?void 0:e.rampUpWeeks}),l=Number(t)/Number(a);let f=0,d=0;for(let h=0;h<a;h+=1){const u=new Date(r.getTime()+h*I),g=ee({date:u,launchDate:c.launchDate,rampEndDate:c.rampEndDate,softStartShare:s});f+=g,g>0&&(d+=1)}const o=l*f,i=Number.isFinite(o)?Math.max(0,Math.round(o)):null,m=Number(t)>0&&Number.isFinite(o)?Number(o)/Number(t):f>0?1:0;return{units:i,unitsRaw:Number.isFinite(o)?Number(o):null,rampFactor:Number.isFinite(m)?Number(m):null,weightedDays:f,activeDays:d,daysInMonth:Number(a)}}function ne(e){const n=e!=null&&e.settings&&typeof e.settings=="object"?e.settings:{},t=N(n.startMonth)||W(),r=b(n.horizonMonths),a=Number.isFinite(r)&&r>0?Math.round(r):18;return x(t,a)}function re(e){const n=q(e==null?void 0:e.planProduct,(e==null?void 0:e.fallbackIndex)||0),t=e!=null&&e.forecastImport&&typeof e.forecastImport=="object"?e.forecastImport:{},r=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months.filter(i=>N(i)):[],a=Q(t,n.seasonalityReferenceSku),s={},c={},l={},f={},d={},o=M(Number(n.softLaunchStartSharePct||0),0,100);return r.forEach(i=>{const m=S(String(i).slice(5,7)),h=X({baselineUnitsInReferenceMonth:n.baselineUnitsInReferenceMonth,baselineReferenceMonth:n.baselineReferenceMonth,targetMonthNumber:m,factorsByMonthNumber:(a==null?void 0:a.factorsByMonthNumber)||{}}),u=te({month:i,baseUnits:h,launchDate:n.launchDate,rampUpWeeks:n.rampUpWeeks,softLaunchStartSharePct:o}),g=Number.isFinite(u.units)?Number(u.units):null;c[i]=Number.isFinite(h)?Number(h):null,s[i]=g,l[i]=Number.isFinite(u.rampFactor)?Number(u.rampFactor):null,f[i]={weightedDays:Number.isFinite(u.weightedDays)?Number(u.weightedDays):0,activeDays:Number.isFinite(u.activeDays)?Number(u.activeDays):0,daysInMonth:Number.isFinite(u.daysInMonth)?Number(u.daysInMonth):0,unitsRaw:Number.isFinite(u.unitsRaw)?Number(u.unitsRaw):null};const P=b(n.avgSellingPriceGrossEUR);d[i]=Number.isFinite(P)&&Number.isFinite(g)?Math.round(Number(P)*Number(g)*100)/100:null}),{...n,seasonality:a,months:r,baseUnitsByMonth:c,rampFactorByMonth:l,rampMetaByMonth:f,unitsByMonth:s,revenueByMonth:d}}function ae(e){const n=e!=null&&e.state&&typeof e.state=="object"?e.state:{},t=Array.isArray(n.planProducts)?n.planProducts:[],r=n.forecast&&typeof n.forecast=="object"?n.forecast:{},a=r.forecastImport&&typeof r.forecastImport=="object"?r.forecastImport:{},s=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:ne(n);return t.map((c,l)=>re({planProduct:c,forecastImport:a,months:s,fallbackIndex:l})).filter(c=>c.alias)}function se(e){const n=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:[],t=p((e==null?void 0:e.state)||{}),r=ae({state:(e==null?void 0:e.state)||{},months:n}),a={},s=R.reduce((c,l)=>(c[l]={},c),{});return n.forEach(c=>{a[c]=0,R.forEach(l=>{s[l][c]=0})}),r.forEach(c=>{if(c.status!=="active"||!T(c.includeInForecast,!0))return;const l=C({product:c,sku:c.plannedSku||c.mappedSku||c.seasonalityReferenceSku||c.alias,poSkuSet:t,fallbackBucket:v.PLAN});n.forEach(f=>{var o;const d=b((o=c.revenueByMonth)==null?void 0:o[f]);Number.isFinite(d)&&(a[f]=(a[f]||0)+Number(d),s[l][f]=(s[l][f]||0)+Number(d))})}),{totalsByMonth:a,byBucket:s}}function ce(e){const n=H((e==null?void 0:e.mapping)||{},0),t=y(n.sku);if(!t)return[];const r=w(e==null?void 0:e.forecastImport,t)||{},a={};Object.entries(r).forEach(([o,i])=>{const m=N(o);if(!m)return;const h=i&&typeof i=="object"?F(i.units):F(i);Number.isFinite(h)&&(a[m]=Number(h))});const s=Array.isArray(e==null?void 0:e.months)?e.months.map(o=>N(o)).filter(Boolean):[],c=s.length?s:Array.from(new Set([...Object.keys(n.planUnitsByMonth||{}),...Object.keys(a),...n.months||[]])).sort(),l=N((e==null?void 0:e.launchMonth)||K(B(n.launchDate))),f=D(e==null?void 0:e.maxMonths);return c.filter(o=>o?l?o>=l:!0:!1).sort().slice(0,f||c.length).map(o=>{var g;const i=b((g=n.planUnitsByMonth)==null?void 0:g[o]),m=b(a==null?void 0:a[o]),h=Number.isFinite(i)&&Number.isFinite(m)?Number(m)-Number(i):null,u=Number.isFinite(h)&&Number.isFinite(i)&&Number(i)>0?Number(h)/Number(i)*100:null;return{month:o,planUnits:Number.isFinite(i)?Number(i):null,liveUnits:Number.isFinite(m)?Number(m):null,deltaUnits:Number.isFinite(h)?Number(h):null,deltaPct:Number.isFinite(u)?Number(u):null}}).filter(o=>Number.isFinite(o.planUnits)||Number.isFinite(o.liveUnits))}function ie(e){const n=S(e);return n==null?"â€”":j[n-1]}export{E as P,re as a,ae as b,Q as c,q as d,H as e,ce as f,se as g,ie as m,U as n};
