import{p as l,af as f,Q as m,P as h}from"./index-D7jH1FVY.js";import{e as y}from"./productCompletenessV2-CiPHRUgy.js";import{n as d,c as S,b as k}from"./months-BTPgK-LH.js";import{b as P}from"./planProducts-B3Cdri-V.js";function c(e){if(e==null||e==="")return null;const r=Number(e);return Number.isFinite(r)?r:null}function M(e){const r=e.template&&typeof e.template=="object"?e.template:{};return(r.fields&&typeof r.fields=="object"?r.fields:r)||{}}function v(e){const r=String(e||"active").trim().toLowerCase();return r==="inactive"?"inactive":r==="prelaunch"||r==="not_launched"||r==="planned"?"prelaunch":"active"}function j(e){const r=new Map;return(Array.isArray(e.productCategories)?e.productCategories:[]).forEach(s=>{const a=s,n=String(a.id||"");n&&r.set(n,String(a.name||"Ohne Kategorie"))}),r}function A(e){const s=(Array.isArray(e.state.products)?e.state.products:[]).map((n,t)=>{var g;const i=n,o=M(i),u=String(i.sku||""),p=((g=y({product:i,state:e.state}))==null?void 0:g.status)||"blocked";return{id:String(i.id||(u?`prod-${u}`:`prod-${t}`)),sku:u,alias:String(i.alias||""),supplierId:String(i.supplierId||""),categoryId:i.categoryId?String(i.categoryId):null,status:v(i.status),portfolioBucket:m(i.portfolioBucket,h.CORE),includeInForecast:f(i.includeInForecast,!0),avgSellingPriceGrossEUR:c(i.avgSellingPriceGrossEUR),templateUnitPriceUsd:c(o.unitPriceUsd),landedUnitCostEur:c(i.landedUnitCostEur),shippingPerUnitEur:c(i.logisticsPerUnitEur??i.freightPerUnitEur??o.freightEur),sellerboardMarginPct:c(i.sellerboardMarginPct),moqUnits:c(i.moqUnits),hsCode:String(i.hsCode||"").trim(),goodsDescription:String(i.goodsDescription||"").trim(),completeness:p,raw:i}}),a=e.search.trim().toLowerCase();return s.filter(n=>e.statusFilter!=="all"&&n.status!==e.statusFilter?!1:a?[n.sku,n.alias,n.supplierId,n.categoryId||"",n.portfolioBucket,n.includeInForecast?"forecast":"no-forecast",n.hsCode,n.goodsDescription,e.supplierLabelById.get(n.supplierId)||"",e.categoryLabelById.get(n.categoryId||"")||""].join(" ").toLowerCase().includes(a):!0).sort((n,t)=>n.sku.localeCompare(t.sku))}function F(e){if(!f(e.includeInForecast,!0))return!1;if(typeof e.active=="boolean")return e.active;const r=String(e.status||"").trim().toLowerCase();return r?r==="active"||r==="aktiv"||r==="prelaunch"||r==="not_launched"||r==="planned":!0}function O(e){const r={};return!e||typeof e!="object"||Object.entries(e).forEach(([s,a])=>{if(!a||typeof a!="object")return;const n={};Object.entries(a).forEach(([t,i])=>{const o=d(t),u=l(i);!o||!Number.isFinite(u)||(n[o]=u)}),Object.keys(n).length&&(r[s]=n)}),r}function B(e){const r={};return Object.entries(e||{}).forEach(([s,a])=>{const n={};Object.entries(a||{}).forEach(([t,i])=>{d(t)&&Number.isFinite(i)&&(n[t]=i)}),Object.keys(n).length&&(r[s]=n)}),r}function E(e,r,s){const a=e==null?void 0:e[r];if(!a||typeof a!="object")return null;const n=a[s];return!n||typeof n!="object"?null:{sku:r,month:s,units:l(n.units),revenueEur:l(n.revenueEur),profitEur:l(n.profitEur)}}function b(e,r,s,a,n){var o,u;const t=n==null?void 0:n[a];if(Number.isFinite(t))return Number(t);const i=(o=e==null?void 0:e[s])==null?void 0:o[a];return Number.isFinite(i)?i:((u=E(r,s,a))==null?void 0:u.units)??null}function N(e,r,s){if(!Number.isFinite(r))return null;if(e==="units")return Number(r);const a=s.avgSellingPriceGrossEUR;if(!Number.isFinite(a))return null;const n=Number(r)*Number(a);if(e==="revenue")return n;const t=s.sellerboardMarginPct;return Number.isFinite(t)?n*(Number(t)/100):null}function I(e){const r=d(e.startMonth)||S(),s=Number(e.horizonMonths),a=Number.isFinite(s)&&s>0?Math.round(s):18;return k(r,a)}function z(e,r){const s=(Array.isArray(e.products)?e.products:[]).map(t=>{const i=t,o=String(i.sku||"").trim();return o?{sku:o,alias:String(i.alias||o),categoryLabel:r.get(String(i.categoryId||""))||"Ohne Kategorie",isActive:F(i),avgSellingPriceGrossEUR:l(i.avgSellingPriceGrossEUR),sellerboardMarginPct:l(i.sellerboardMarginPct),sourceLabel:"csv"}:null}).filter(Boolean),a=I(e.settings||{}),n=P({state:e,months:a}).map(t=>({sku:String(t.key||""),alias:String(t.alias||""),categoryLabel:t.categoryId&&r.get(String(t.categoryId||""))||"Neue Produkte (Plan)",isActive:String(t.status||"active")==="active"&&f(t.includeInForecast,!0),avgSellingPriceGrossEUR:l(t.avgSellingPriceGrossEUR),sellerboardMarginPct:l(t.sellerboardMarginPct),isPlan:!0,plannedSku:t.plannedSku?String(t.plannedSku):null,sourceLabel:"plan",relationType:t.relationType?String(t.relationType):null,seasonalityReferenceSku:t.seasonalityReferenceSku?String(t.seasonalityReferenceSku):null,baselineReferenceMonth:l(t.baselineReferenceMonth),baselineUnitsInReferenceMonth:l(t.baselineUnitsInReferenceMonth),launchDate:t.launchDate?String(t.launchDate):null,rampUpWeeks:l(t.rampUpWeeks),softLaunchStartSharePct:l(t.softLaunchStartSharePct),planProductId:t.id?String(t.id):null,plannedUnitsByMonth:t.unitsByMonth&&typeof t.unitsByMonth=="object"?t.unitsByMonth:{}})).filter(t=>t.sku&&t.alias);return[...s,...n].sort((t,i)=>{const o=String(t.categoryLabel||"").localeCompare(String(i.categoryLabel||""));return o!==0?o:String(t.alias||t.sku).localeCompare(String(i.alias||i.sku))})}function D(e){const r=e.search.trim().toLowerCase();return e.products.filter(s=>!(e.onlyActive&&!s.isActive||r&&![s.sku,s.alias,s.categoryLabel].join(" ").toLowerCase().includes(r)||e.onlyWithForecast&&!e.visibleMonths.some(n=>{const t=b(e.manualDraft,e.forecastImport,s.sku,n,s.plannedUnitsByMonth);return Number.isFinite(t)&&Number(t)>0}))).sort((s,a)=>s.sku.localeCompare(a.sku))}function G(e){const r=new Map;return e.allMonths.forEach(s=>r.set(s,0)),e.products.forEach(s=>{s.isActive&&e.allMonths.forEach(a=>{const n=b(e.manualDraft,e.forecastImport,s.sku,a,s.plannedUnitsByMonth),t=N("revenue",n,s);Number.isFinite(t)&&r.set(a,(r.get(a)||0)+Number(t))})}),r}export{A as a,I as b,j as c,z as d,G as e,D as f,E as g,b as h,N as i,F as j,O as n,B as s};
