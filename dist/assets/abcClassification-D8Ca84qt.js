import{p as M}from"./index-CAzQztwo.js";const _=[{value:"NEXT_6",label:"Nächste 6 Monate",count:6},{value:"NEXT_12",label:"Nächste 12 Monate",count:12},{value:"NEXT_24",label:"Nächste 24 Monate",count:24},{value:"ALL",label:"Alles",count:null}];function F(){const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`}function C(n){if(!/^\d{4}-\d{2}$/.test(n||""))return null;const[r,c]=n.split("-").map(Number);return r*12+(c-1)}function j(n,r){if(!n||!r)return[];const c=C(n),u=C(r);if(c==null||u==null)return[];if(u<c)return[];const s=[];for(let o=c;o<=u;o+=1){const a=Math.floor(o/12),t=o%12+1;s.push(`${a}-${String(t).padStart(2,"0")}`)}return s}function B(n,r,c,u=_){if(!Array.isArray(n)||!n.length)return[];const s=n.slice().sort();if(r==="ALL")return s;const o=u.find(l=>l.value===r),a=o&&Number.isFinite(o.count)?o.count:0;if(!a)return s;const t=s.findIndex(l=>l>=c);return t===-1?[]:r==="NEXT_6"&&t>0?s.slice(t-1,t+a):s.slice(t,t+a)}const I={A:.8,B:.95};function R(n){return String(n||"").trim().toLowerCase()}function y(n){if(!n)return!1;if(typeof n.active=="boolean")return n.active;const r=String(n.status||"").trim().toLowerCase();return r?r==="active"||r==="aktiv":!0}function x(n,r,c){var t,l,g,d,N,e,i;if(!r||!c)return null;const u=(g=(l=(t=n==null?void 0:n.forecast)==null?void 0:t.forecastManual)==null?void 0:l[r])==null?void 0:g[c],s=M(u);if(Number.isFinite(s))return s;const o=(i=(e=(N=(d=n==null?void 0:n.forecast)==null?void 0:d.forecastImport)==null?void 0:N[r])==null?void 0:e[c])==null?void 0:i.units,a=M(o);return Number.isFinite(a)?a:null}function O(n){var o,a;const r=new Set,c=t=>{/^\d{4}-\d{2}$/.test(t||"")&&r.add(t)},u=((o=n==null?void 0:n.forecast)==null?void 0:o.forecastImport)||{};Object.values(u).forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(c)});const s=((a=n==null?void 0:n.forecast)==null?void 0:a.forecastManual)||{};return Object.values(s).forEach(t=>{!t||typeof t!="object"||Object.keys(t).forEach(c)}),Array.from(r).sort()}function w(n){const r=Array.isArray(n==null?void 0:n.products)?n.products:[],c=O(n),u=B(c,"NEXT_6",F(),_),s=new Map,o=[],a=[];let t=0,l=0;r.forEach(e=>{const i=String((e==null?void 0:e.sku)||"").trim();if(!i)return;const v=R(i),f=y(e),m=M(e==null?void 0:e.avgSellingPriceGrossEUR);let h=0;f&&Number.isFinite(m)&&m>0&&u.forEach(p=>{const S=x(n,i,p);Number.isFinite(S)&&(h+=S)});const A=Number.isFinite(m)&&m>0,E=f&&Number.isFinite(h)&&h>0,k=A&&E?h*m:null,b={sku:i,active:f,vkPriceGross:Number.isFinite(m)?m:null,units6m:f?h:null,revenue6m:f?k:null,abcClass:null,abcBasis:"no_data",rankingMetric:null,includedInRanking:!1};A&&E&&k!=null?(b.abcBasis="revenue_6m",b.rankingMetric=k,b.includedInRanking=!0,o.push(b),t+=k,l+=h):E&&(b.abcBasis="units_6m_fallback",a.push(b)),s.set(v,b),s.set(i,b)});const g=t>0&&l>0?t/l:1;a.forEach(e=>{const i=Number(e.units6m||0);e.rankingMetric=i*g,e.includedInRanking=i>0});const d=[...o,...a].filter(e=>e.includedInRanking),N=d.reduce((e,i)=>e+Number(i.rankingMetric||0),0);return N>0?d.slice().sort((e,i)=>Number(i.rankingMetric||0)-Number(e.rankingMetric||0)).reduce((e,i)=>{const v=e+Number(i.rankingMetric||0),f=v/N;return f<=I.A?i.abcClass="A":f<=I.B?i.abcClass="B":i.abcClass="C",v},0):d.forEach(e=>{e.abcClass="C"}),s.forEach(e=>{e.abcClass||(e.abcClass="C")}),{months:u,bySku:s}}export{_ as D,B as a,w as b,F as c,j as g};
