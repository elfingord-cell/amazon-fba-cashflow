import{p as U,ak as z,K as p,an as I,bA as $,ag as O,ah as x,P as B}from"./index-CafJOI4c.js";const W=["standalone","variant_of_existing","category_adjacent"],_=["Jan","Feb","Maerz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],E=24*60*60*1e3;function b(e){if(e==null||e==="")return null;const n=Number(e);return Number.isFinite(n)?n:null}function S(e){const n=Number(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<1||t>12?null:t}function N(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}$/.test(n))return n;const t=n.match(/^(\d{2})-(\d{4})$/);return t?`${t[2]}-${t[1]}`:null}function Y(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return t*12+(r-1)}function K(e,n){const t=Y(e);if(t==null)return e;const r=t+Number(n||0),a=Math.floor(r/12),s=r%12+1;return`${a}-${String(s).padStart(2,"0")}`}function G(e,n){const t=N(e),r=Number.isFinite(n)?Math.max(0,Math.round(n)):0;return!t||!r?[]:Array.from({length:r},(a,s)=>K(t,s))}function J(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}function M(e,n,t){return Number.isFinite(e)?Math.min(t,Math.max(n,e)):n}function F(e){const n=b(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<=0?null:t}function V(e){const n=String(e||"").trim().toUpperCase();return n==="AIR"||n==="SEA"||n==="RAIL"?n:"SEA"}function q(e){const n=e!=null&&e.template&&typeof e.template=="object"?e.template:{},t=n.fields&&typeof n.fields=="object"?n.fields:n;return t&&typeof t=="object"?t:{}}function H(e){const n=String(e||"").trim().toLowerCase();return W.includes(n)?n:"standalone"}function Q(e){const n=String(e||"").trim().toLowerCase();return n==="archived"?"archived":n==="draft"?"draft":"active"}function T(e){return String(e||"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function y(e){return String(e||"").trim()}function P(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}-\d{2}$/.test(n)){const[r,a,s]=n.split("-").map(Number),c=new Date(Date.UTC(r,a-1,s));if(c.getUTCFullYear()===r&&c.getUTCMonth()===a-1&&c.getUTCDate()===s)return n}const t=new Date(n);return Number.isNaN(t.getTime())?null:`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}function L(e){const n=P(e);if(!n)return null;const[t,r,a]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,a))}function X(e){return!(e instanceof Date)||Number.isNaN(e.getTime())?null:`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}`}function Z(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r,0)).getUTCDate()}function ee(e){const n=N(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,1))}function v(e){const n={};return!e||typeof e!="object"||Object.entries(e).forEach(([t,r])=>{const a=N(t),s=b(r);!a||!Number.isFinite(s)||(n[a]=Number(s))}),n}function te(e,n=0){const t=T(e==null?void 0:e.id);if(t)return`plan:${t}`;const r=T(e==null?void 0:e.alias);return r?`plan:${r}`:`plan:row-${n+1}`}function ne(e,n=0){const t=e&&typeof e=="object"?e:{},r=q(t),a=String(t.alias||"").trim(),s=String(t.id||""),c=H(t.relationType),l=S(t.baselineReferenceMonth),m=b(t.baselineUnitsInReferenceMonth),d=b(t.avgSellingPriceGrossEUR),o=b(t.sellerboardMarginPct),i=P(t.launchDate),f=F(t.rampUpWeeks),h=F(t.productionLeadTimeDaysDefault??t.productionLeadTimeDays??r.productionDays),u=F(t.transitDays??r.transitDays),g=V(t.transportMode??r.transportMode??r.transport),D=b(t.unitPriceUsd??r.unitPriceUsd),A=b(t.logisticsPerUnitEur??t.freightPerUnitEur??r.freightEur),R=b(t.softLaunchStartSharePct),w=Number.isFinite(R)?M(Number(R),0,100):0,k=Q(t.status),j=I(t.includeInForecast,k==="active");return{id:s||`plan-${n+1}`,key:te({id:s,alias:a},n),alias:a,plannedSku:y(t.plannedSku),relationType:c,categoryId:t.categoryId?String(t.categoryId):null,status:k,portfolioBucket:x(t.portfolioBucket,B.PLAN),includeInForecast:j,launchCosts:O(t.launchCosts,`plan-lc-${n+1}`),seasonalityReferenceSku:y(t.seasonalityReferenceSku),baselineReferenceMonth:l,baselineUnitsInReferenceMonth:m,baselineReferenceSku:y(t.baselineReferenceSku),avgSellingPriceGrossEUR:d,sellerboardMarginPct:o,launchDate:i,rampUpWeeks:f,productionLeadTimeDaysDefault:h,transitDays:u,transportMode:g,unitPriceUsd:D,logisticsPerUnitEur:A,freightPerUnitEur:A,softLaunchStartSharePct:w,mappedSku:y(t.mappedSku||t.liveSku),mappedAt:t.mappedAt?String(t.mappedAt):null,archivedAt:t.archivedAt?String(t.archivedAt):null,createdAt:t.createdAt?String(t.createdAt):null,updatedAt:t.updatedAt?String(t.updatedAt):null,raw:t}}function re(e,n=0){const t=e&&typeof e=="object"?e:{},r=v(t.planUnitsByMonth),a=Array.isArray(t.months)?t.months.map(s=>N(s)).filter(Boolean):Object.keys(r);return{id:String(t.id||`plan-map-${n+1}`),planProductId:String(t.planProductId||""),planProductAlias:String(t.planProductAlias||""),sku:y(t.sku),plannedSku:y(t.plannedSku),mappedAt:t.mappedAt?String(t.mappedAt):null,launchDate:P(t.launchDate),rampUpWeeks:F(t.rampUpWeeks),softLaunchStartSharePct:M(Number(b(t.softLaunchStartSharePct)||0),0,100),baselineReferenceMonth:S(t.baselineReferenceMonth),baselineUnitsInReferenceMonth:b(t.baselineUnitsInReferenceMonth),seasonalityReferenceSku:y(t.seasonalityReferenceSku),months:a.filter(s=>!!s).sort(),planUnitsByMonth:r,planRevenueByMonth:v(t.planRevenueByMonth),raw:t}}function C(e,n){if(!n||!e||typeof e!="object")return null;const t=e[n];if(t&&typeof t=="object")return t;const r=String(n).toLowerCase(),a=Object.keys(e).find(c=>c.toLowerCase()===r);if(!a)return null;const s=e[a];return s&&typeof s=="object"?s:null}function ae(e,n){const t=C(e,n);if(!t)return null;const r=Object.entries(t).map(([o,i])=>{const f=N(o);if(!f)return null;const h=S(f.slice(5,7));if(h==null)return null;const u=i&&typeof i=="object"?U(i.units):U(i);return Number.isFinite(u)?{month:f,monthNumber:h,units:Number(u)}:null}).filter(Boolean).sort((o,i)=>o.month.localeCompare(i.month));if(!r.length)return null;const a=Array.from({length:12},()=>[]);r.forEach(o=>{a[o.monthNumber-1].push(o.units)});const s=a.map(o=>o.length?o.reduce((i,f)=>i+f,0)/o.length:null),c=s.filter(o=>Number.isFinite(o)),l=c.length?c.reduce((o,i)=>o+i,0)/c.length:null,m={},d={};for(let o=1;o<=12;o+=1){const i=s[o-1];d[o]=Number.isFinite(i)?Number(i):null,m[o]=Number.isFinite(i)&&Number.isFinite(l)&&l>0?Number(i)/Number(l):null}return{sku:String(n||"").trim(),startMonth:r[0].month,endMonth:r[r.length-1].month,sampleMonthCount:r.length,coveredMonthTypes:Object.values(d).filter(o=>Number.isFinite(o)).length,overallAverage:Number.isFinite(l)?Number(l):null,factorsByMonthNumber:m,averagesByMonthNumber:d}}function oe(e){const n=b(e.baselineUnitsInReferenceMonth),t=S(e.baselineReferenceMonth),r=S(e.targetMonthNumber),a=e.factorsByMonthNumber||{};if(n==null||n<0||t==null||r==null)return null;const s=b(a[t]),c=b(a[r]);if(!Number.isFinite(s)||!Number.isFinite(c)||s<=0)return null;const l=Number(n)*(Number(c)/Number(s));return Number.isFinite(l)?Math.max(0,Number(l)):null}function se(e){const n=L(e==null?void 0:e.launchDate),t=F(e==null?void 0:e.rampUpWeeks);if(!n||!t)return{launchDate:n,rampEndDate:null,rampDurationDays:null};const r=Math.max(1,Math.round(t*7)),a=new Date(n.getTime()+r*E);return{launchDate:n,rampEndDate:a,rampDurationDays:r}}function ce(e){const n=e==null?void 0:e.date,t=e==null?void 0:e.launchDate,r=e==null?void 0:e.rampEndDate,a=M(Number((e==null?void 0:e.softStartShare)||0),0,1);if(!(n instanceof Date)||Number.isNaN(n.getTime())||!(t instanceof Date)||Number.isNaN(t.getTime()))return 1;if(n<t)return 0;if(!(r instanceof Date)||Number.isNaN(r.getTime())||n>r)return 1;const s=r.getTime()-t.getTime();if(s<=0)return 1;const c=n.getTime()-t.getTime(),l=M(c/s,0,1);return M(a+(1-a)*l,a,1)}function ie(e){const n=N(e==null?void 0:e.month),t=b(e==null?void 0:e.baseUnits),r=ee(n),a=Z(n);if(!r||!Number.isFinite(t)||!Number.isFinite(a)||a<=0)return{units:null,unitsRaw:null,rampFactor:null,weightedDays:0,activeDays:0,daysInMonth:Number.isFinite(a)?a:null};const s=M(Number(b(e==null?void 0:e.softLaunchStartSharePct)||0)/100,0,1),c=se({launchDate:e==null?void 0:e.launchDate,rampUpWeeks:e==null?void 0:e.rampUpWeeks}),l=Number(t)/Number(a);let m=0,d=0;for(let h=0;h<a;h+=1){const u=new Date(r.getTime()+h*E),g=ce({date:u,launchDate:c.launchDate,rampEndDate:c.rampEndDate,softStartShare:s});m+=g,g>0&&(d+=1)}const o=l*m,i=Number.isFinite(o)?Math.max(0,Math.round(o)):null,f=Number(t)>0&&Number.isFinite(o)?Number(o)/Number(t):m>0?1:0;return{units:i,unitsRaw:Number.isFinite(o)?Number(o):null,rampFactor:Number.isFinite(f)?Number(f):null,weightedDays:m,activeDays:d,daysInMonth:Number(a)}}function le(e){const n=e!=null&&e.settings&&typeof e.settings=="object"?e.settings:{},t=N(n.startMonth)||J(),r=b(n.horizonMonths),a=Number.isFinite(r)&&r>0?Math.round(r):18;return G(t,a)}function ue(e){const n=ne(e==null?void 0:e.planProduct,(e==null?void 0:e.fallbackIndex)||0),t=e!=null&&e.forecastImport&&typeof e.forecastImport=="object"?e.forecastImport:{},r=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months.filter(i=>N(i)):[],a=ae(t,n.seasonalityReferenceSku),s={},c={},l={},m={},d={},o=M(Number(n.softLaunchStartSharePct||0),0,100);return r.forEach(i=>{const f=S(String(i).slice(5,7)),h=oe({baselineUnitsInReferenceMonth:n.baselineUnitsInReferenceMonth,baselineReferenceMonth:n.baselineReferenceMonth,targetMonthNumber:f,factorsByMonthNumber:(a==null?void 0:a.factorsByMonthNumber)||{}}),u=ie({month:i,baseUnits:h,launchDate:n.launchDate,rampUpWeeks:n.rampUpWeeks,softLaunchStartSharePct:o}),g=Number.isFinite(u.units)?Number(u.units):null;c[i]=Number.isFinite(h)?Number(h):null,s[i]=g,l[i]=Number.isFinite(u.rampFactor)?Number(u.rampFactor):null,m[i]={weightedDays:Number.isFinite(u.weightedDays)?Number(u.weightedDays):0,activeDays:Number.isFinite(u.activeDays)?Number(u.activeDays):0,daysInMonth:Number.isFinite(u.daysInMonth)?Number(u.daysInMonth):0,unitsRaw:Number.isFinite(u.unitsRaw)?Number(u.unitsRaw):null};const D=b(n.avgSellingPriceGrossEUR);d[i]=Number.isFinite(D)&&Number.isFinite(g)?Math.round(Number(D)*Number(g)*100)/100:null}),{...n,seasonality:a,months:r,baseUnitsByMonth:c,rampFactorByMonth:l,rampMetaByMonth:m,unitsByMonth:s,revenueByMonth:d}}function me(e){const n=e!=null&&e.state&&typeof e.state=="object"?e.state:{},t=Array.isArray(n.planProducts)?n.planProducts:[],r=n.forecast&&typeof n.forecast=="object"?n.forecast:{},a=r.forecastImport&&typeof r.forecastImport=="object"?r.forecastImport:{},s=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:le(n);return t.map((c,l)=>ue({planProduct:c,forecastImport:a,months:s,fallbackIndex:l})).filter(c=>c.alias)}function he(e){const n=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:[],t=z((e==null?void 0:e.state)||{}),r=me({state:(e==null?void 0:e.state)||{},months:n}),a={},s=p.reduce((c,l)=>(c[l]={},c),{});return n.forEach(c=>{a[c]=0,p.forEach(l=>{s[l][c]=0})}),r.forEach(c=>{if(c.status!=="active"||!I(c.includeInForecast,!0))return;const l=$({product:c,sku:c.plannedSku||c.mappedSku||c.seasonalityReferenceSku||c.alias,poSkuSet:t,fallbackBucket:B.PLAN});n.forEach(m=>{var o;const d=b((o=c.revenueByMonth)==null?void 0:o[m]);Number.isFinite(d)&&(a[m]=(a[m]||0)+Number(d),s[l][m]=(s[l][m]||0)+Number(d))})}),{totalsByMonth:a,byBucket:s}}function be(e){const n=re((e==null?void 0:e.mapping)||{},0),t=y(n.sku);if(!t)return[];const r=C(e==null?void 0:e.forecastImport,t)||{},a={};Object.entries(r).forEach(([o,i])=>{const f=N(o);if(!f)return;const h=i&&typeof i=="object"?U(i.units):U(i);Number.isFinite(h)&&(a[f]=Number(h))});const s=Array.isArray(e==null?void 0:e.months)?e.months.map(o=>N(o)).filter(Boolean):[],c=s.length?s:Array.from(new Set([...Object.keys(n.planUnitsByMonth||{}),...Object.keys(a),...n.months||[]])).sort(),l=N((e==null?void 0:e.launchMonth)||X(L(n.launchDate))),m=F(e==null?void 0:e.maxMonths);return c.filter(o=>o?l?o>=l:!0:!1).sort().slice(0,m||c.length).map(o=>{var g;const i=b((g=n.planUnitsByMonth)==null?void 0:g[o]),f=b(a==null?void 0:a[o]),h=Number.isFinite(i)&&Number.isFinite(f)?Number(f)-Number(i):null,u=Number.isFinite(h)&&Number.isFinite(i)&&Number(i)>0?Number(h)/Number(i)*100:null;return{month:o,planUnits:Number.isFinite(i)?Number(i):null,liveUnits:Number.isFinite(f)?Number(f):null,deltaUnits:Number.isFinite(h)?Number(h):null,deltaPct:Number.isFinite(u)?Number(u):null}}).filter(o=>Number.isFinite(o.planUnits)||Number.isFinite(o.liveUnits))}function de(e){const n=S(e);return n==null?"â€”":_[n-1]}export{W as P,ue as a,me as b,ae as c,ne as d,re as e,be as f,he as g,de as m,P as n};
