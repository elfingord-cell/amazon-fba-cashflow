import{t as i,_ as Is,k as e,I as re,J as os,K as Es,L as zs,P as $,S as k,M as c,N as F,T as L,O as Fs,Q as ze,R as Ps}from"./index-Bu80Uwbp.js";import{E as Os}from"./index-BstOMiNp.js";import{c as Rs}from"./cashflow-GoLygTlA.js";import{b as Bs}from"./dashboardMaturity-C11ENgBs.js";import{b as Ts}from"./orderEditorFactory-0SBPeSDm.js";import{c as Ls,a as Ks,b as $s,d as _s}from"./orderUtils-BspxdtGU.js";import{b as as,r as Us,a as Vs,c as qs}from"./phantomFo-CWLV5hqY.js";import{e as Gs,g as Hs}from"./forecastVersioning-5ZBkPs0u.js";import{c as Ws}from"./inventoryProjection-C5DWSJzn.js";import{m as Qs,c as st,a as Zs,n as Ys,b as We,f as V}from"./months-DiLwPhVv.js";import{u as Js,C as K}from"./workspace-CCwvBxSI.js";import{h as Xs,g as en,s as tn}from"./uiPrefs-CxTlE9qM.js";import{C as we}from"./Collapse-GdZk7VXL.js";import{R as Y}from"./InfoCircleOutlined-DfaHqfly.js";import{S as Zt}from"./index-CchoASSq.js";import{S as Qe}from"./index-iu0DVWxa.js";import{P as sn}from"./index-DRBHlcso.js";import{S as bt}from"./index-i7vZqF7s.js";import{C as nn}from"./index-i0sE1Ifp.js";import"./planProducts-D4fZPYls.js";import"./cashInRules-r9rlv23d.js";import"./store-DQBaR53c.js";import"./prefill-Ch70lW9N.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-m_CaHg-5.js";import"./foSuggestion-Ck1952gl.js";import"./productCompletenessV2-CGpzck-p.js";import"./abcClassification-C8wZea93.js";import"./Dropdown-Dn3rrflu.js";import"./DownOutlined-DBjqZVAX.js";import"./useBubbleLock-DTzDssvh.js";const{Text:rn}=os;function on({className:t,groups:n=[],items:r,visibleStartMs:o,visibleEndMs:a,height:l=180,emptyMessage:h="Keine Timeline-Daten vorhanden."}){const g=i.useRef(null),[y,x]=i.useState(null),[M,I]=i.useState(null);i.useEffect(()=>{if(typeof window>"u")return;let b=!0;return Is(()=>import("./vis-timeline-graph2d-DVPA6HI_.js"),[]).then(E=>{b&&x(E)}).catch(E=>{b&&I(E instanceof Error?E.message:"Timeline konnte nicht geladen werden.")}),()=>{b=!1}},[]);const v=i.useMemo(()=>r.map(b=>({id:b.id,type:b.type||(b.endMs!=null?"range":"box"),content:b.content||"",start:b.startMs,end:b.endMs,className:b.className,title:b.title,selectable:!1,editable:!1})),[r]),j=i.useMemo(()=>n.map(b=>({id:b.id,content:b.content,className:b.className})),[n]),U=i.useMemo(()=>{const b=Number.isFinite(o)?o:Date.now(),E=Number.isFinite(a)?a:b+30*24*60*60*1e3,H=E>b?E:b+30*24*60*60*1e3;return{stack:!0,zoomable:!1,moveable:!1,selectable:!1,showCurrentTime:!0,orientation:{axis:"top",item:"top"},margin:{axis:10,item:8},start:b,end:H,tooltip:{followMouse:!0,overflowMethod:"cap"}}},[a,o]);return i.useEffect(()=>{if(!y||!g.current||!v.length)return;const b=g.current;b.innerHTML="";const E=j.length?new y.Timeline(b,v,j,U):new y.Timeline(b,v,U);return()=>{E.destroy()}},[j,v,U,y]),r.length?M?e.jsx(re,{type:"warning",showIcon:!0,message:`Timeline konnte nicht geladen werden: ${M}`}):y?e.jsx("div",{className:["v2-vis-timeline",t||""].filter(Boolean).join(" "),children:e.jsx("div",{ref:g,style:{height:l}})}):e.jsx("div",{className:"v2-vis-timeline-loading",children:e.jsx(rn,{type:"secondary",children:"Timeline wird geladen..."})}):e.jsx(re,{type:"info",showIcon:!0,message:h})}const pt=24*60*60*1e3,an={slug:"po",entityLabel:"PO",numberField:"poNo"};function oe(t){return String(t||"").trim().toLowerCase()}function ce(t){const n=String(t||"").trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(n))return null;const[r,o,a]=n.split("-").map(Number);if(!r||!o||!a)return null;const l=new Date(Date.UTC(r,o-1,a));return Number.isNaN(l.getTime())?null:n}function Ee(t){if(!t)return null;const[n,r,o]=t.split("-").map(Number);if(!n||!r||!o)return null;const a=new Date(Date.UTC(n,r-1,o));return Number.isNaN(a.getTime())?null:a.getTime()}function Ae(t){if(!t)return"—";const n=Ee(t);return n==null?t:new Date(n).toLocaleDateString("de-DE")}function ln(t){return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}):"—"}function cn(t){const n=t.settings&&typeof t.settings=="object"?t.settings:{},r=n.cny&&typeof n.cny=="object"?n.cny:{start:"",end:""},o=n.cnyBlackoutByYear&&typeof n.cnyBlackoutByYear=="object"?n.cnyBlackoutByYear:{};return{fxRate:Number(n.fxRate||0),fxFeePct:Number(n.fxFeePct||0),dutyRatePct:Number(n.dutyRatePct||0),dutyIncludeFreight:n.dutyIncludeFreight!==!1,eustRatePct:Number(n.eustRatePct||0),vatRefundEnabled:n.vatRefundEnabled!==!1,vatRefundLagMonths:Number(n.vatRefundLagMonths||0),freightLagDays:Number(n.freightLagDays||0),cny:r,cnyBlackoutByYear:o}}function dn(t){const n=oe(t.sourceId),r=oe(t.sourceNumber);return(Array.isArray(t.state.pos)?t.state.pos:[]).find(a=>{const l=oe(a.id),h=oe(a.poNo);return!!(n&&n===l||r&&r===h||r&&r===l)})||null}function un(t){const n=oe(t.sourceId),r=oe(t.sourceNumber);return(Array.isArray(t.state.fos)?t.state.fos:[]).find(a=>{const l=oe(a.id),h=oe(a.foNo),g=oe(a.foNumber);return!!(n&&n===l||r&&(r===h||r===g||r===l))})||null}function is(t,n,r){return String(t||"").trim().toLowerCase()==="paid"||String(n||"").trim()||String(r||"").trim()?"paid":"open"}function ls(t){const n=String(t.explicitDirection||"").trim().toLowerCase();if(n==="in")return"in";if(n==="out")return"out";const r=`${String(t.eventType||"")} ${String(t.category||"")} ${String(t.label||"")}`.toLowerCase();return r.includes("refund")||r.includes("erstatt")||t.amount<0?"in":"out"}function hn(t,n){const r=Array.isArray(t.payments)?t.payments:[];let o=[];try{const a=typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n));o=Ts(a,an,cn(t),r,{includeIncoming:!0})}catch{o=[]}return o.map(a=>{const l=ce(a.dueDate);if(!l)return null;const h=Math.abs(Number(a.plannedEur||0));if(!(h>0))return null;const g=ls({amount:Number(a.plannedEur||0),eventType:a.eventType,label:a.label||a.typeLabel,explicitDirection:a.direction});return{id:String(a.id||`po-pay-${l}`),label:String(a.typeLabel||a.label||"Zahlung"),dueDate:l,amountEur:h,status:is(a.status,a.paidDate,a.paymentId),direction:g}}).filter(a=>!!a)}function mn(t){const n=Number(t.fxRate||0);return(Array.isArray(t.payments)?t.payments:[]).map((o,a)=>{const l=ce(o.dueDate);if(!l)return null;const h=Number(o.amount||0);if(!Number.isFinite(h)||h===0)return null;const g=ls({amount:h,category:o.category,label:o.label}),y=Math.abs(_s(h,o.currency||"EUR",n));return y>0?{id:String(o.id||`fo-pay-${a+1}`),label:String(o.label||o.category||"Zahlung"),dueDate:l,amountEur:y,status:is(o.status,o.paidDate,o.paymentId),direction:g}:null}).filter(o=>!!o)}function Yt(t){const n=[],r=Ee(t.orderDate),o=Ee(t.etdDate),a=Ee(t.etaDate);r!=null&&o!=null&&o>=r&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:production`,type:"range",content:"Produktion",startMs:r,endMs:o,className:"v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--production",title:`Produktion: ${Ae(t.orderDate)} bis ${Ae(t.etdDate)}`}),o!=null&&a!=null&&a>=o&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:transit`,type:"range",content:"Transit",startMs:o,endMs:a,className:"v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--transit",title:`Transit: ${Ae(t.etdDate)} bis ${Ae(t.etaDate)}`}),[{key:"order",label:"Order",date:t.orderDate},{key:"etd",label:"ETD",date:t.etdDate},{key:"eta",label:"ETA",date:t.etaDate}].forEach(v=>{const j=Ee(v.date);j!=null&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:milestone:${v.key}`,type:"box",content:v.label,startMs:j,className:`v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--milestone v2-dashboard-order-timeline-item--milestone-${v.key}`,title:`${v.label}: ${Ae(v.date)}`})}),t.payments.forEach(v=>{const j=Ee(v.dueDate);j!=null&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:payment:${v.id}`,type:"box",content:v.direction==="in"?"+":" ",startMs:j,className:["v2-dashboard-order-timeline-item","v2-dashboard-order-timeline-item--payment",v.status==="paid"?"v2-dashboard-order-timeline-item--payment-paid":"v2-dashboard-order-timeline-item--payment-open",v.direction==="in"?"v2-dashboard-order-timeline-item--payment-incoming":"v2-dashboard-order-timeline-item--payment-outgoing"].join(" "),title:[v.label,`Fällig: ${Ae(v.dueDate)}`,`Betrag: ${ln(v.amountEur)}`,`Status: ${v.status==="paid"?"Bezahlt":"Offen"}`].join(`
`)})});const h=n.flatMap(v=>[v.startMs,v.endMs].filter(j=>Number.isFinite(j)));if(!h.length)return null;const g=Math.min(...h),y=Math.max(...h),x=g-14*pt,M=y+14*pt,I=M>x?M:x+30*pt;return{source:t.source,sourceId:t.sourceId,sourceNumber:t.sourceNumber,orderDate:t.orderDate,etdDate:t.etdDate,etaDate:t.etaDate,visibleStartMs:x,visibleEndMs:I,items:n}}function fn(t){const n=t.source==="fo"?"fo":"po",r=t.sourceId?String(t.sourceId):null,o=t.sourceNumber?String(t.sourceNumber):null;if(n==="po"){const h=dn({state:t.state,sourceId:r,sourceNumber:o});if(!h)return null;const g=t.state.settings&&typeof t.state.settings=="object"?t.state.settings:{},y=Ls({items:h.items,orderDate:h.orderDate,fxRate:h.fxOverride??g.fxRate,fallback:h}),x=Ks({orderDate:h.orderDate,productionLeadTimeDays:y.prodDays||h.prodDays,logisticsLeadTimeDays:y.transitDays||h.transitDays,bufferDays:0});return Yt({source:"po",sourceId:String(h.id||r||""),sourceNumber:String(h.poNo||o||""),orderDate:ce(h.orderDate||x.orderDate),etdDate:ce(h.etdManual||x.etdDate),etaDate:ce(h.etaManual||x.etaDate),payments:hn(t.state,h)})}const a=un({state:t.state,sourceId:r,sourceNumber:o});if(!a)return null;const l=$s({targetDeliveryDate:a.targetDeliveryDate||a.deliveryDate,productionLeadTimeDays:a.productionLeadTimeDays,logisticsLeadTimeDays:a.logisticsLeadTimeDays,bufferDays:a.bufferDays});return Yt({source:"fo",sourceId:String(a.id||r||""),sourceNumber:String(a.foNo||a.foNumber||o||""),orderDate:ce(a.orderDate||l.orderDate),etdDate:ce(a.etdDate||l.etdDate),etaDate:ce(a.etaDate||l.etaDate||a.targetDeliveryDate||a.deliveryDate),payments:mn(a)})}function et(t){if(!t)return null;const n=new Date(String(t));return Number.isNaN(n.getTime())?null:n}function gn(t){if(!Es(t.includeInForecast,!0))return!1;if(typeof t.active=="boolean")return t.active;const n=String(t.status||"").trim().toLowerCase();return n?n==="active"||n==="aktiv"||n==="prelaunch"||n==="not_launched"||n==="planned":!0}function jt(t){return String(t||"").trim()}function bn(t){return(Array.isArray(t.products)?t.products:[]).filter(r=>jt(r.sku)?gn(r):!1).map(r=>({sku:jt(r.sku),alias:String(r.alias||r.sku||""),status:String(r.status||"active"),safetyStockDohOverride:r.safetyStockDohOverride,foCoverageDohOverride:r.foCoverageDohOverride}))}function pn(t){const n=t.lastDriftSummary&&typeof t.lastDriftSummary=="object"?t.lastDriftSummary:{},r=typeof n.comparedAt=="string"?n.comparedAt:null;return r&&et(r)?r:null}function vn(t){return{id:`gate:${t.key}`,key:t.key,severity:"error",label:t.label,message:t.detail,route:t.route}}function yn(t){const n=t.state||{},r=Number.isFinite(t.horizonMonths)?Math.max(1,Math.round(Number(t.horizonMonths))):12,o=Qs(st(),r),a=as({state:n,months:o}),l=a.robustMonthsCount>=o.length&&o.length>0,h=bn(n),g=Ws({state:n,months:o,products:h,snapshot:null,snapshotMonth:Zs(st(),-1),projectionMode:"units"}),y=Array.isArray(g.anchorSkuMissingHistory)?g.anchorSkuMissingHistory.map(q=>jt(q)).filter(Boolean).sort((q,nt)=>q.localeCompare(nt,"de-DE")):[],x=y.length===0,M=n.forecast&&typeof n.forecast=="object"?n.forecast:{},I=typeof M.lastImportAt=="string"?M.lastImportAt:null,v=et(I),j=new Date,U=24*60*60*1e3,b=v?Math.floor((j.getTime()-v.getTime())/U):null,E=b!=null&&b<=35,H=pn(M),ye=typeof M.lastDriftReviewedComparedAt=="string"?M.lastDriftReviewedComparedAt:null,Fe=typeof M.lastDriftReviewedAt=="string"?M.lastDriftReviewedAt:null,xe=!!(H&&ye&&Ys(String(H).slice(0,7))&&ye===H&&et(Fe)),ue=t.runtimeErrorAt&&et(t.runtimeErrorAt)?String(t.runtimeErrorAt):null,ae=!ue,J=[{key:"runtime_stable",label:"Runtime stabil",passed:ae,status:ae?"ok":"error",detail:ae?"Keine offenen Tab-Ladefehler.":`Offener Tab-Ladefehler seit ${new Date(ue).toLocaleString("de-DE")}${t.runtimeErrorRoute?` (${t.runtimeErrorRoute})`:""}.`,route:"/v2/dashboard",blockerCount:ae?0:1},{key:"robust_12m",label:"Robustheit 12M",passed:l,status:l?"ok":"error",detail:l?`${a.robustMonthsCount}/${o.length} Monate robust.`:`${a.robustMonthsCount}/${o.length} Monate robust (erforderlich: ${o.length}).`,route:"/v2/dashboard",blockerCount:l?0:Math.max(0,o.length-a.robustMonthsCount)},{key:"anchor_history_complete",label:"Anchor-Historie vollständig",passed:x,status:x?"ok":"error",detail:x?"Alle aktiven/prelaunch SKUs haben Snapshot-Historie.":`${y.length} SKU(s) ohne Snapshot-Historie (Anker=0).`,route:"/v2/inventory/projektion?source=dashboard&risk=under_safety&abc=ab&expand=all",blockerCount:y.length},{key:"forecast_fresh",label:"Forecast aktuell",passed:E,status:E?"ok":"error",detail:E?`${b} Tage seit Import.`:b==null?"Kein Forecast-Import vorhanden.":`${b} Tage seit Import (erlaubt <= 35).`,route:"/v2/forecast",blockerCount:E?0:1},{key:"forecast_drift_reviewed",label:"Drift geprüft",passed:xe,status:xe?"ok":"error",detail:xe?`Drift-Stand vom ${new Date(H).toLocaleDateString("de-DE")} geprüft.`:H?"Aktueller Drift-Stand ist noch nicht als geprüft markiert.":"Noch kein Driftvergleich verfügbar.",route:"/v2/forecast",blockerCount:xe?0:1}],je=J.filter(q=>!q.passed).map(q=>vn(q)),Be=je.length===0;return{ready:Be,status:Be?"ready":"not_ready",horizonMonths:r,checks:J,blockers:je,robustMonthsCount:a.robustMonthsCount,robustRequiredCount:o.length,anchorMissingHistoryCount:y.length,anchorMissingHistorySkus:y,forecastDaysSinceImport:b,driftComparedAt:H,driftReviewedAt:Fe,driftReviewedForComparedAt:ye}}const{Paragraph:vt,Text:f,Title:Ze}=os,{CheckableTag:xn}=c,jn="v2:last-route-error",yt=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],kn=[{key:"inflow",label:"Einzahlungen"},{key:"po_fo",label:"PO/FO Zahlungen"},{key:"fixcost",label:"Fixkosten"},{key:"tax",label:"Steuern & Importkosten"},{key:"outflow",label:"Sonstige Auszahlungen"},{key:"other",label:"Sonstige"}],Sn=new Set(["signals","cashflow","robustness","pnl"]),Mn=["cashflow"],cs=[{value:$.CORE,label:"Kernportfolio"},{value:$.PLAN,label:"Planprodukte"},{value:$.IDEAS,label:"Ideenprodukte"}],Jt=[$.CORE,$.PLAN],Xt={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function es(t){const n=new Set;return t.forEach(r=>{const o=String(r||"").trim();Sn.has(o)&&n.add(o)}),Array.from(n)}function Nn(t){return Array.isArray(t)?t:t?[t]:[]}function B(t){const n=Number(t);return Number.isFinite(n)?n.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function ve(t){return Number.isFinite(t)?t<0?`−${B(Math.abs(t))}`:B(t):"-"}function ts(t,n=0){const r=Number(t);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:n,maximumFractionDigits:n}):"-"}function Ye(t){const n=Number(t);return Number.isFinite(n)?`${n.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function Je(t){if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("de-DE")}function tt(t){return Xt[t]||Xt.insufficient}function Dn(t){const n=tt(t);return e.jsx(c,{color:n.color,children:n.label})}function Cn(t){return t==="ok"?"✅":t==="warn"?"⚠️":"❌"}function Ie(t){return t.reduce((n,r)=>n+Number(r.amount||0),0)}function wn(t,n){const r=new Date(t.getTime());return r.setDate(r.getDate()+n),r}function An(t){const n=cs.find(r=>r.value===t);return(n==null?void 0:n.label)||t}function ss(t){const n=Array.from(new Set((Array.isArray(t)?t:[]).map(o=>String(o||"")).filter(o=>ze.includes(o)))),r=n.slice().sort().join("|");return r===[$.CORE].join("|")?"Nur Kern":r===[$.CORE,$.PLAN].sort().join("|")?"Kern+Plan":n.length===ze.length?"Alles":n.map(o=>An(o)).join(", ")}function In(t,n){const r=structuredClone(t||{});(!r.settings||typeof r.settings!="object")&&(r.settings={});const o=r.settings;return o.cashInMode=n.safetyMode==="basis"?"basis":"conservative",o.cashInCalibrationEnabled=n.revenueBasisMode==="calibrated",o.cashInRecommendationIgnoreQ4=!n.q4SeasonalityEnabled,n.quoteMode==="recommendation"&&Array.isArray(r.incomings)&&(r.incomings=r.incomings.map(a=>!a||typeof a!="object"?a:{...a,payoutPct:null})),r}function Xe(t,n){return e.jsxs("span",{className:"v2-dashboard-signal-title",children:[t,e.jsx(L,{title:n,children:e.jsx(Y,{})})]})}function de(t,n){const[r,o=""]=String(t||"").split("?"),a=new URLSearchParams(o);Object.entries(n).forEach(([h,g])=>{if(g==null||g===""){a.delete(h);return}a.set(h,g)});const l=a.toString();return l?`${r}?${l}`:r}function kt(t){return de("/v2/inventory/projektion",{source:"dashboard",risk:t.risk||"under_safety",abc:t.abc||"ab",month:t.month||null,sku:t.sku||null,mode:t.mode||null,expand:"all"})}function En(t){return de("/v2/products",{source:"dashboard",issues:t.issues,sku:t.sku||null,expand:"all"})}function ds(t){return de("/v2/forecast",{source:"dashboard",sku:t.sku||null,month:t.month||null})}function ns(t){return de("/v2/orders/fo",{source:t.source||"inventory_projection",sku:t.sku||null,month:t.month||null,suggestedUnits:Number.isFinite(Number(t.suggestedUnits))?String(Math.max(0,Math.round(Number(t.suggestedUnits)))):"0",requiredArrivalDate:t.requiredArrivalDate||null,recommendedOrderDate:t.recommendedOrderDate||null,phantomId:t.phantomId||null,firstRiskMonth:t.firstRiskMonth||null,orderMonth:t.orderMonth||null,leadTimeDays:Number.isFinite(Number(t.leadTimeDays))?String(Math.max(0,Math.round(Number(t.leadTimeDays)))):null,returnTo:t.returnTo||"/v2/dashboard"})}function xt(t){const n=String(t.route||"");if(n.startsWith("/v2/forecast"))return ds({sku:t.sku||null,month:t.month||null});if(n.startsWith("/v2/inventory/projektion")){const r=t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"under_safety":"all",o=t.sku?"all":t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"ab":"all";return kt({risk:r,abc:o,month:t.month||null,sku:t.sku||null,mode:t.mode||null})}if(n.startsWith("/v2/products")){const r=t.actionId==="revenue_inputs"||t.checkKey==="revenue_inputs"?"revenue":"needs_fix";return En({issues:r,sku:t.sku||null})}return n}function zn(t){const n=typeof t.portfolioBucket=="string"?t.portfolioBucket:null;if(n)return n;const r=t.meta&&typeof t.meta=="object"?t.meta:{};return typeof r.portfolioBucket=="string"?String(r.portfolioBucket):null}function St(t,n){const r=zn(t);return!r||!ze.includes(r)?!0:n.has(r)}function Fn(t,n){var a;if(!t.length)return[];const r=Number(((a=t[0])==null?void 0:a.opening)||0);let o=r;return t.map((l,h)=>{const g=h===0?r:o,y=(Array.isArray(l.entries)?l.entries:[]).filter(j=>St(j,n)),x=y.filter(j=>String(j.direction||"").toLowerCase()==="in").reduce((j,U)=>j+Math.abs(Number(U.amount||0)),0),M=y.filter(j=>String(j.direction||"").toLowerCase()==="out").reduce((j,U)=>j+Math.abs(Number(U.amount||0)),0),I=x-M,v=g+I;return o=v,{...l,opening:g,inflow:x,outflow:M,net:I,closing:v,entries:y}})}function Pn(t){const n=t.map(r=>(Array.isArray(r.entries)?r.entries:[]).filter(l=>String(l.direction||"").toLowerCase()==="out"&&String(l.group||"")==="Fixkosten").reduce((l,h)=>l+Math.abs(Number(h.amount||0)),0)).filter(r=>r>0);return n.length?n.reduce((r,o)=>r+o,0)/n.length:0}function On(t,n,r){const o={fixcost:0,po:0,fo:0,phantomFo:0};return t.forEach(a=>{if(!a||typeof a!="object")return;const l=a;if(r&&!St(l,r)||String(l.direction||"").toLowerCase()!=="out")return;const h=Math.abs(Number(l.amount||0));if(!Number.isFinite(h)||h<=0)return;const g=String(l.source||"").toLowerCase();if(g==="po"){o.po+=h;return}if(g==="fo"){const x=String(l.sourceId||"").trim(),M=l.meta&&typeof l.meta=="object"?l.meta:{};l.provisional===!0||M.phantom===!0||(x?(n==null?void 0:n.has(x))===!0:!1)?o.phantomFo+=h:o.fo+=h;return}const y=String(l.group||"").toLowerCase();(g==="fixcosts"||y==="fixkosten")&&(o.fixcost+=h)}),o}function Rn(t,n){const r={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};return t.forEach(o=>{if(!o||typeof o!="object")return;const a=o;if(n&&!St(a,n)||String(a.direction||"").toLowerCase()!=="in")return;const l=Math.abs(Number(a.amount||0));if(!Number.isFinite(l)||l<=0)return;const h=String(a.source||"").toLowerCase(),g=String(a.kind||"").toLowerCase();if(h==="sales"||h==="sales-plan"||g==="sales-payout"){r.amazon+=l;const x=a.meta&&typeof a.meta=="object"?a.meta:{},M=x.cashIn&&typeof x.cashIn=="object"?x.cashIn:{},I=String(M.component||"").trim().toLowerCase(),v=String(a.portfolioBucket||x.portfolioBucket||"").trim(),j=Ps(v,$.CORE);h==="sales-plan"||I==="plan"?r.amazonNew+=l:j===$.CORE?r.amazonCore+=l:r.amazonPlanned+=l}else r.other+=l;r.total+=l}),r}function Bn(t){if(t.source!=="sales")return[];const n=t.cashInMeta;if(!n)return[];const r=[];if(n.component==="plan"&&r.push(e.jsx(c,{color:"geekblue",children:"Plan-Produkt"},"component")),n.quoteSource==="manual"?r.push(e.jsx(c,{color:"gold",children:"Quote manuell"},"quote-source")):n.quoteSource==="recommendation"&&r.push(e.jsx(c,{color:"blue",children:"Quote Empfehlung"},"quote-source")),n.revenueSource==="manual_override")r.push(e.jsx(c,{color:"gold",children:"Umsatz manuell"},"revenue-source"));else if(n.revenueSource==="forecast_calibrated"){const o=Number(n.calibrationFactorApplied);Number.isFinite(o)&&Math.abs(o-1)>1e-6?r.push(e.jsxs(c,{color:"orange",children:["Kalibriert ",o.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})]},"revenue-source")):r.push(e.jsx(c,{children:"Forecast"},"revenue-source"))}else n.revenueSource==="manual_no_forecast"&&r.push(e.jsx(c,{children:"Manuell (kein Forecast)"},"revenue-source"));return r}function Tn(t,n){var r;for(let o=0;o<t.length;o+=1){const a=t[o].month;if((r=n.get(a))!=null&&r.robust&&Number(t[o].closing||0)<0)return a}return null}function Ln(t){if(!t||typeof t!="object")return{toVersionId:null,foConflictsOpen:0};const n=t;return{toVersionId:n.toVersionId==null?null:String(n.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(n.foConflictsOpen||0)))}}function rs(){if(typeof window>"u"||!window.sessionStorage)return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null};try{const t=window.sessionStorage.getItem(jn);if(!t)return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null};const n=JSON.parse(t);return{errorAt:typeof n.errorAt=="string"?n.errorAt:null,routeKey:typeof n.routeKey=="string"?n.routeKey:null,routePath:typeof n.routePath=="string"?n.routePath:null,routeLabel:typeof n.routeLabel=="string"?n.routeLabel:null,message:typeof n.message=="string"?n.message:null}}catch{return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null}}}function Mr(){var Ht,Wt;const{state:t,loading:n,error:r}=Js(),o=zs(),a=Xs("dashboard"),[l,h]=i.useState("next6"),[g,y]=i.useState(()=>Jt.slice()),[x,M]=i.useState("forecast"),[I,v]=i.useState("manual"),[j,U]=i.useState("basis"),[b,E]=i.useState(!0),[H,ye]=i.useState(!1),[Fe,xe]=i.useState(!1),[ue,ae]=i.useState(""),[J,je]=i.useState(""),[Be,q]=i.useState([]),[nt,Mt]=i.useState(!1),[Te,us]=i.useState(()=>rs()),[ke,hs]=i.useState(()=>{const s=en("dashboard");return a?es(s):Mn.slice()}),X=t,rt=t.settings&&typeof t.settings=="object"?t.settings:{},Le=t.forecast&&typeof t.forecast=="object"?t.forecast:{},ot=rt.cashInCalibrationEnabled!==!1,ms=Math.max(1,Math.round(Number(rt.cashInCalibrationHorizonMonths||6))),Nt=rt.cashInRecommendationIgnoreQ4===!0;i.useEffect(()=>{Fe||(M(ot?"calibrated":"forecast"),E(!Nt),xe(!0))},[Fe,ot,Nt]);const _=i.useMemo(()=>Us(X,18),[t.settings]),he=i.useMemo(()=>ue&&_.includes(ue)?ue:_[_.length-1]||"",[ue,_]),ie=i.useMemo(()=>Vs({state:X,months:_,targetMonth:he||null}),[_,he,X]),Dt=i.useMemo(()=>new Map(ie.map(s=>[s.id,s])),[ie]),me=i.useMemo(()=>new Set(ie.map(s=>s.id)),[ie]),Ct=i.useMemo(()=>qs({state:X,suggestions:ie}),[ie,X]),Se=i.useMemo(()=>In(Ct,{quoteMode:I,safetyMode:j,revenueBasisMode:x,q4SeasonalityEnabled:b}),[Ct,b,I,x,j]),wt=i.useMemo(()=>Rs(Se),[Se]),at=wt.months||[],At=wt.breakdown||[],fe=i.useMemo(()=>{const s=yt.find(u=>u.value===l);return!s||s.count==null?at:at.slice(0,s.count)},[at,l]),fs=i.useMemo(()=>{const s=yt.find(u=>u.value===l);return(s==null?void 0:s.label)||"Alle Monate"},[l]),It=i.useMemo(()=>new Set(fe),[fe]),Me=i.useMemo(()=>new Set(g),[g]),W=i.useMemo(()=>{const s=At.filter(u=>It.has(u.month));return Fn(s,Me)},[At,Me,It]),w=i.useMemo(()=>as({state:X,months:fe}),[X,fe]),ee=i.useMemo(()=>yn({state:X,horizonMonths:12,runtimeErrorAt:Te.errorAt,runtimeErrorRoute:Te.routePath}),[Te.errorAt,Te.routePath,X]);i.useEffect(()=>{if(!_.length){ae("");return}ae(s=>s&&_.includes(s)?s:_[_.length-1])},[_]),i.useEffect(()=>{var s;if(!w.months.length){je("");return}if(!J||!w.monthMap.has(J)){const u=((s=w.months.find(S=>!S.robust))==null?void 0:s.month)||w.months[0].month;je(u)}},[w,J]),i.useEffect(()=>{if(!W.length){q([]);return}q(s=>{const u=new Set(W.map(S=>S.month));return s.filter(S=>u.has(S))})},[W]),i.useEffect(()=>{tn("dashboard",ke)},[ke]);const Ke=s=>{hs(es(Nn(s)))},it=i.useCallback(s=>{s&&(je(s),Mt(!0))},[]),C=i.useMemo(()=>W.map(s=>({...s})),[W]),$e=i.useMemo(()=>{const s=new Map;return C.forEach(u=>{s.set(u.month,Rn(Array.isArray(u.entries)?u.entries:[],Me))}),s},[Me,C]),Q=i.useMemo(()=>C.map(s=>$e.get(s.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[$e,C]),Et=i.useMemo(()=>Q.map(s=>s.amazonCore),[Q]),zt=i.useMemo(()=>Q.map(s=>s.amazonPlanned),[Q]),Ft=i.useMemo(()=>Q.map(s=>s.amazonNew),[Q]),gs=i.useMemo(()=>Q.map(s=>s.amazon),[Q]),lt=i.useMemo(()=>Q.map(s=>s.other),[Q]),bs=gs.reduce((s,u)=>s+Number(u||0),0)+lt.reduce((s,u)=>s+Number(u||0),0),ps=C.reduce((s,u)=>s+Number(u.outflow||0),0),ct=C.reduce((s,u)=>s+Number(u.net||0),0),vs=i.useMemo(()=>C.length?Math.min(...C.map(s=>Number(s.closing||0))):null,[C]),Pt=i.useMemo(()=>ss(g),[g]),Ot=x==="calibrated"?"Kalibrierter Umsatz":"Forecast-Umsatz",Rt=I==="manual"?"Manuell je Monat":"Empfehlung",Bt=j==="basis"?"Basis":"Konservativ",Tt=b?"berücksichtigt":"ignoriert",dt=I==="recommendation",_e=i.useMemo(()=>Pn(W),[W])*2,ut=i.useMemo(()=>C.filter(s=>{var u;return(u=w.monthMap.get(s.month))==null?void 0:u.robust}).map(s=>Number(s.closing||0)),[w.monthMap,C]),Lt=i.useMemo(()=>!ut.length||_e<=0?null:Math.min(...ut)-_e,[_e,ut]),Kt=i.useMemo(()=>Tn(C,w.monthMap),[w.monthMap,C]),Ue=i.useMemo(()=>{const s=structuredClone(Le||{});return Gs(s),s},[Le]),ys=i.useMemo(()=>Hs(Ue),[Ue]),ht=Ln(Ue.lastImpactSummary),$t=String(Ue.activeVersionId||"").trim()||null,Ve=ht.toVersionId&&$t&&ht.toVersionId===$t?ht.foConflictsOpen:0,mt=typeof Le.lastImportAt=="string"?Le.lastImportAt:null,Ne=mt?new Date(mt):null,xs=new Date,js=24*60*60*1e3,Pe=Ne?Math.floor((xs.getTime()-Ne.getTime())/js):null,De=Ne?Pe!=null&&Pe<=35?"fresh":Pe!=null&&Pe<=45?"aging":"stale":"none",ks=Ne?`${Pe} Tage seit Import`:"Kein Forecast-Import",_t=Ne?wn(Ne,30):null,d=J&&w.monthMap.get(J)||null,ft=d?tt(d.coverage.statusKey):null,qe=i.useMemo(()=>{if(!d)return!1;const s=We(st()),u=We(d.month);return u==null||s==null?!1:u<s},[d]),Ge=d?d.checks.filter(s=>s.key!=="sku_coverage"):[],Ut=i.useMemo(()=>{if(!d||d.coverage.statusKey==="full")return[];const s=d.month;return[{id:`coverage-warning:${s}`,message:`Coverage ist ${d.coverage.statusLabel}: ${Ye(d.coverage.ratio*100)} (${d.coverage.coveredSkus}/${d.coverage.activeSkus}).`,route:kt({risk:"under_safety",abc:"ab",month:s,mode:d.coverage.projectionMode})}]},[d]),Vt=d?d.blockers.filter(s=>s.checkKey!=="sku_coverage"):[],Ss=i.useMemo(()=>{if(!d)return[];const s=d.coverage.projectionMode==="doh"?"DOH":"Units",u=d.coverage.stockIssueCount,S=d.coverage.orderDutyIssueCount,P=[{key:"stock",label:"Bestands-Check ok?",passed:u===0,description:u===0?`Alle aktiven SKUs im Monat ${V(d.month)} über Safety (${s}).`:`${u} SKU(s) mit OOS/unter Safety oder fehlendem Forecast.`},{key:"order_duty",label:"Bestellpflicht/Look-Ahead ok?",passed:S===0,description:S===0?"Keine SKU benötigt spätestens in diesem Monat eine neue FO/PO.":`${S} SKU(s) mit fälliger Bestellpflicht (inkl. Look-Ahead).`}],te=Ge.map(T=>({key:T.key,label:`${T.label} ok?`,passed:T.passed,description:T.detail}));return[...P,...te]},[d,Ge]),Ms=i.useMemo(()=>{if(!d)return[];const s=[],u=d.coverage.stockIssueCount,S=d.coverage.orderDutyIssueCount;return s.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:u===0?"ok":"fail",description:u===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${u} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),s.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:S===0?"ok":d.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:S===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${S} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),Ge.forEach(P=>{s.push({key:P.key,label:P.label,state:P.passed?"ok":"fail",description:P.detail,route:P.route||null})}),qe&&s.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),s},[d,qe,Ge]),Ns=st(),qt=We(Ns);i.useEffect(()=>{const s=()=>us(rs());return s(),window.addEventListener("v2:route-load-state",s),window.addEventListener("storage",s),()=>{window.removeEventListener("v2:route-load-state",s),window.removeEventListener("storage",s)}},[]);const Gt=i.useMemo(()=>Bs({breakdown:C,state:Se,provisionalFoIds:me}),[Se,me,C]),Ds=i.useMemo(()=>{const s="Amazon: Kernprodukte",u="Amazon: Geplante Produkte",S="Amazon: Neue Produkte",P=new Set([s,u,S]),te=fe.map(m=>V(m)),T=W.map(m=>Number(m.closing||0)),G=W.map(m=>{var z;return!!((z=w.monthMap.get(m.month))!=null&&z.robust)}),He=T.map((m,z)=>G[z]&&m>=0?m:null),N=T.map((m,z)=>G[z]&&m<0?m:null),A=T.map((m,z)=>!G[z]&&m>=0?m:null),Oe=T.map((m,z)=>!G[z]&&m<0?m:null),O=C.map(m=>On(Array.isArray(m.entries)?m.entries:[],me,Me)),D=O.map(m=>-m.fixcost),se=O.map(m=>-m.po),le=O.map(m=>-m.fo),ge=O.map(m=>-m.phantomFo);return{tooltip:{trigger:"axis",formatter:m=>{const z=Array.isArray(m)?m:[m],Z=z[0],be=[`<div><strong>${(Z==null?void 0:Z.axisValueLabel)||""}</strong></div>`];let pe=0,Re=!1;return z.forEach(p=>{const R=p,Ce=Number(R==null?void 0:R.value);Number.isFinite(Ce)&&(P.has(String((R==null?void 0:R.seriesName)||""))&&(pe+=Ce,Re=!0),be.push(`<div>${(R==null?void 0:R.marker)||""}${(R==null?void 0:R.seriesName)||""}: ${B(Ce)}</div>`))}),Re&&be.push(`<div><strong>Amazon gesamt: ${B(pe)}</strong></div>`),be.join("")}},legend:[{top:0,left:0,itemGap:12,data:[s,u,S,"Sonstige Einzahlungen","Fixkosten","PO","FO","Phantom FO","Netto"]},{top:26,left:0,itemGap:12,data:["Kontostand belastbar","Kontostand belastbar (<0)","Kontostand orientierend","Kontostand orientierend (<0)"]}],grid:{left:56,right:70,top:78,bottom:32},xAxis:{type:"category",data:te},yAxis:[{type:"value",name:"Cashflow",axisLabel:{formatter:m=>ve(m)}},{type:"value",name:"Kontostand",position:"right",axisLabel:{formatter:m=>B(m)}}],series:[{name:s,type:"bar",stack:"cash",data:Et,itemStyle:{color:"#166534"}},{name:u,type:"bar",stack:"cash",data:zt,itemStyle:{color:"#22c55e"}},{name:S,type:"bar",stack:"cash",data:Ft,itemStyle:{color:"#86efac"}},{name:"Sonstige Einzahlungen",type:"bar",stack:"cash",data:lt,itemStyle:{color:"#6ee7b7"}},{name:"Fixkosten",type:"bar",stack:"cash",data:D,itemStyle:{color:"#7f1d1d"}},{name:"PO",type:"bar",stack:"cash",data:se,itemStyle:{color:"#e74c3c"}},{name:"FO",type:"bar",stack:"cash",data:le,itemStyle:{color:"#f97316"}},{name:"Phantom FO",type:"bar",stack:"cash",data:ge,itemStyle:{color:"#fbbf24"}},{name:"Netto",type:"line",smooth:!0,data:C.map(m=>Number(m.net||0)),itemStyle:{color:"#0f1b2d"},lineStyle:{width:2}},{name:"Kontostand belastbar",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:He,lineStyle:{width:2,color:"#3bc2a7"},itemStyle:{color:"#3bc2a7"}},{name:"Kontostand belastbar (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:N,lineStyle:{width:2,color:"#b42318"},itemStyle:{color:"#b42318"}},{name:"Kontostand orientierend",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:A,lineStyle:{width:2,type:"dashed",color:"#94a3b8"},itemStyle:{color:"#94a3b8"}},{name:"Kontostand orientierend (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:Oe,lineStyle:{width:2,type:"dashed",color:"#c2410c"},itemStyle:{color:"#c2410c"}}]}},[Et,Ft,zt,Me,lt,me,w.monthMap,C,W,fe]),Cs=i.useMemo(()=>C.map(s=>{var He;const u=Gt.get(s.month)||[],S=u.filter(N=>N.provisional),P=kn.map(N=>({...N,rows:u.filter(A=>A.group===N.key)})).filter(N=>N.rows.length>0),te=u.filter(N=>N.amount<0),T=$e.get(s.month)||{amazon:0,other:0,total:0},G=((He=w.monthMap.get(s.month))==null?void 0:He.robust)||!1;return{key:s.month,label:e.jsxs("div",{className:"v2-dashboard-pnl-header",children:[e.jsxs(k,{size:6,align:"center",children:[e.jsx(f,{strong:!0,children:V(s.month)}),e.jsx(F,{type:"text",size:"small",icon:e.jsx(Y,{}),onClick:N=>{N.stopPropagation(),it(s.month)},children:"Details"})]}),e.jsxs(k,{wrap:!0,children:[e.jsxs(c,{color:"green",children:["Einzahlungen: ",B(T.total)]}),e.jsxs(c,{color:"green",children:["Amazon: ",B(T.amazon)]}),e.jsxs(c,{color:"lime",children:["Sonstige: ",B(T.other)]}),e.jsxs(c,{color:"red",children:["Auszahlungen: ",B(Math.abs(Ie(te)))]}),S.length?e.jsxs(c,{color:"gold",children:["Vorbehaltlich (enthalten): ",ve(Ie(S))]}):null,e.jsxs(c,{color:s.net>=0?"green":"red",children:["Netto: ",B(s.net)]}),e.jsxs(c,{color:G?"green":"red",children:["Robust: ",G?"ja":"nein"]})]})]}),children:e.jsx("div",{className:"v2-dashboard-pnl-month",children:P.map(N=>{if(N.key==="po_fo"){const A=new Map;N.rows.forEach(O=>{const D=O.source==="fo"?"fo":"po",se=O.sourceId?String(O.sourceId):null,le=O.sourceNumber?String(O.sourceNumber):null,ge=`${D}:${se||le||O.label}`,ne=A.get(ge);if(ne){ne.rows.push(O),!ne.sourceId&&se&&(ne.sourceId=se),!ne.sourceNumber&&le&&(ne.sourceNumber=le);return}A.set(ge,{source:D,sourceId:se,sourceNumber:le,rows:[O]})});const Oe=Array.from(A.entries()).map(([O,D])=>{var Re;const se=Ie(D.rows),le=Array.from(new Set(D.rows.map(p=>p.portfolioBucket).filter(p=>!!p))),ge=D.rows.filter(p=>p.provisional),ne=ge.map(p=>String(p.sourceId||"").trim()).find(p=>p&&me.has(p))||null,gt=D.source==="fo"?D.sourceId&&me.has(D.sourceId)?D.sourceId:ne:null,m=gt&&Dt.get(gt)||null,z=(Re=D.rows.find(p=>p.tooltipMeta))==null?void 0:Re.tooltipMeta,Z=Array.from(new Set(D.rows.flatMap(p=>{var R;return((R=p.tooltipMeta)==null?void 0:R.aliases)||[]}).filter(Boolean))),be=Z.length>3?`${Z.slice(0,3).join(", ")} +${Z.length-3}`:Z.join(", "),pe=fn({state:Se,source:D.source,sourceId:D.sourceId,sourceNumber:D.sourceNumber});return{key:O,label:e.jsxs("div",{className:"v2-dashboard-pnl-order-row",children:[e.jsxs("div",{className:"v2-dashboard-pnl-order-row-main",children:[e.jsxs(f,{strong:!0,children:[String(D.source).toUpperCase()," ",D.sourceNumber||D.sourceId||"—"]}),be?Z.length>3?e.jsx(L,{title:Z.join(", "),children:e.jsxs(f,{type:"secondary",children:["· ",be]})}):e.jsxs(f,{type:"secondary",children:["· ",be]}):null]}),e.jsxs(k,{size:6,children:[e.jsx(c,{color:se<0?"red":"green",children:ve(se)}),le.map(p=>e.jsx(c,{children:p},`${O}-${p}`)),ge.length?e.jsx(c,{color:"gold",children:"Vorbehaltlich"}):null,m?e.jsx(c,{color:"orange",children:"Phantom FO"}):null,(z==null?void 0:z.units)!=null?e.jsxs(c,{children:["Stück: ",ts(z.units,0)]}):null]})]}),children:e.jsxs("div",{className:"v2-dashboard-pnl-order-detail",children:[m?e.jsx("div",{className:"v2-dashboard-pnl-phantom-hint",children:e.jsxs(k,{wrap:!0,children:[e.jsx(c,{color:"gold",children:"Automatisch vorgeschlagen"}),e.jsxs(f,{type:"secondary",children:["Risikomonat ",V(m.firstRiskMonth)," · bestellen bis ",Je(m.latestOrderDate)]}),e.jsx(F,{size:"small",type:"primary",onClick:()=>o(ns({sku:m.sku,month:s.month,suggestedUnits:m.suggestedUnits,requiredArrivalDate:m.requiredArrivalDate,recommendedOrderDate:m.recommendedOrderDate,source:"phantom_fo",phantomId:m.id,firstRiskMonth:m.firstRiskMonth,orderMonth:m.orderMonth,leadTimeDays:m.leadTimeDays,returnTo:"/v2/dashboard"})),children:"Prüfen & bestätigen"})]})}):null,pe?e.jsx("div",{className:"v2-dashboard-order-timeline-shell",children:e.jsx(on,{className:"v2-dashboard-order-timeline",items:pe.items,visibleStartMs:pe.visibleStartMs,visibleEndMs:pe.visibleEndMs,height:188})}):e.jsx(re,{type:"info",showIcon:!0,message:`Keine Timeline-Daten für ${String(D.source).toUpperCase()} ${D.sourceNumber||D.sourceId||"—"} verfügbar.`}),e.jsx("div",{className:"v2-table-shell v2-scroll-host",children:e.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Fällig"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:D.rows.map((p,R)=>{var Qt;const Ce=p.tooltipMeta?e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("strong",{children:[String(p.source).toUpperCase()," ",p.sourceNumber||p.sourceId||"—"]})}),e.jsxs("div",{children:["Alias: ",p.tooltipMeta.aliases.join(", ")||"-"]}),e.jsxs("div",{children:["Stückzahl: ",p.tooltipMeta.units!=null?ts(p.tooltipMeta.units,0):"-"]}),e.jsxs("div",{children:["Fälligkeit: ",Je(p.tooltipMeta.dueDate)]})]}):null;return e.jsxs("tr",{children:[e.jsx("td",{children:Ce?e.jsx(L,{title:Ce,children:p.label}):p.label}),e.jsx("td",{className:p.amount<0?"v2-negative":void 0,children:ve(p.amount)}),e.jsx("td",{children:Je((Qt=p.tooltipMeta)==null?void 0:Qt.dueDate)}),e.jsx("td",{children:p.provisional?e.jsx(c,{color:"gold",children:"Vorbehaltlich"}):p.paid==null?e.jsx(c,{children:"—"}):p.paid?e.jsx(c,{color:"green",children:"Bezahlt"}):e.jsx(c,{color:"gold",children:"Offen"})})]},`${O}-${R}`)})})]})})]})}});return e.jsxs("div",{className:"v2-dashboard-pnl-group",children:[e.jsxs("div",{className:"v2-dashboard-pnl-group-head",children:[e.jsx(f,{strong:!0,children:N.label}),e.jsx(c,{color:"blue",children:ve(Ie(N.rows))})]}),e.jsx(we,{size:"small",items:Oe,destroyInactivePanel:!0})]},`${s.month}-${N.key}`)}return e.jsxs("div",{className:"v2-dashboard-pnl-group",children:[e.jsxs("div",{className:"v2-dashboard-pnl-group-head",children:[e.jsx(f,{strong:!0,children:N.label}),e.jsx(c,{color:Ie(N.rows)<0?"red":"green",children:ve(Ie(N.rows))})]}),e.jsx("div",{className:"v2-table-shell v2-scroll-host",children:e.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Bucket"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:N.rows.map((A,Oe)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.tooltip?e.jsx(L,{title:A.tooltip,children:A.label}):A.label}),e.jsx("td",{children:A.portfolioBucket?e.jsx(c,{children:A.portfolioBucket}):"—"}),e.jsx("td",{className:A.amount<0?"v2-negative":void 0,children:ve(A.amount)}),e.jsx("td",{children:e.jsxs(k,{size:6,wrap:!0,children:[Bn(A),A.paid==null?e.jsx(c,{children:"—"}):A.paid?e.jsx(c,{color:"green",children:"Bezahlt"}):e.jsx(c,{color:"gold",children:"Offen"})]})})]},`${s.month}-${N.key}-${Oe}`))})]})})]},`${s.month}-${N.key}`)})})}}),[Se,$e,o,it,Dt,me,Gt,w.monthMap,C]);function ws(){h("next6"),y(Jt.slice()),M(ot?"calibrated":"forecast"),v("manual"),U("basis"),E(!0),ye(!1)}function As(s){if(!d)return;const u=s.month||d.month;if(s.checkKey==="cash_in"){o(de("/v2/abschluss/eingaben",{source:"dashboard",month:u}));return}if(s.checkKey==="fixcost"){o(de("/v2/abschluss/fixkosten",{source:"dashboard",month:u}));return}if(s.checkKey==="vat"){o(de("/v2/abschluss/ust",{source:"dashboard",month:u}));return}if(s.checkKey==="revenue_inputs"&&s.sku){o(de("/v2/products",{source:"dashboard",issues:"revenue",sku:s.sku}));return}if(s.issueType==="order_duty"&&s.sku){o(ns({sku:s.sku,month:u,suggestedUnits:s.suggestedUnits??null,requiredArrivalDate:s.requiredArrivalDate||null,recommendedOrderDate:s.recommendedOrderDate||null,source:"inventory_projection",phantomId:null,firstRiskMonth:s.firstRiskMonth||null,orderMonth:s.orderMonth||null,leadTimeDays:s.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(s.issueType==="forecast_missing"&&s.sku){o(ds({sku:s.sku,month:u}));return}if((s.issueType==="stock_oos"||s.issueType==="stock_under_safety")&&s.sku){o(kt({risk:s.issueType==="stock_oos"?"oos":"under_safety",abc:s.abcClass&&(s.abcClass==="A"||s.abcClass==="B")?"ab":"all",month:s.firstRiskMonth||u,sku:s.sku,mode:d.coverage.projectionMode||null}));return}o(xt({route:s.route,checkKey:s.checkKey,month:u,sku:s.sku||null,mode:d.coverage.projectionMode||null}))}return((Wt=(Ht=t.settings)==null?void 0:Ht.featureFlags)==null?void 0:Wt.executiveDashboardV2)!==!1?e.jsxs("div",{className:"v2-page",children:[e.jsxs(K,{className:"v2-intro-card",children:[e.jsxs("div",{className:"v2-page-head",children:[e.jsxs("div",{children:[e.jsx(Ze,{level:3,children:"Dashboard"}),e.jsx(vt,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]}),e.jsxs("div",{className:"v2-toolbar-field",children:[e.jsx(f,{children:"Zeitraum"}),e.jsx(Zt,{value:l,onChange:s=>h(s),options:yt.map(s=>({value:s.value,label:s.label})),style:{width:220,maxWidth:"100%"}})]}),e.jsxs("div",{className:"v2-toolbar-field",children:[e.jsx(f,{children:"PFO bis"}),e.jsx(Zt,{value:he||void 0,onChange:s=>ae(String(s||"")),options:_.map(s=>({value:s,label:V(s)})),style:{width:220,maxWidth:"100%"},disabled:!_.length})]})]}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs(f,{type:"secondary",children:["Zeitraum: ",fs," (",fe.length," Monate) · PFO bis: ",he?V(he):"—"]})})]}),r?e.jsx(re,{type:"error",showIcon:!0,message:r}):null,n?e.jsx(re,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,Ve>0?e.jsx(re,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${Ve} FOs prüfen`,description:e.jsx(F,{size:"small",onClick:()=>o("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,e.jsx(Fs,{title:d?`Monats-Check: ${V(d.month)}`:"Monats-Check",placement:"right",width:520,open:nt&&!!d,onClose:()=>Mt(!1),destroyOnClose:!1,children:d?e.jsxs(k,{direction:"vertical",size:12,style:{width:"100%"},children:[e.jsxs(k,{wrap:!0,children:[e.jsx(c,{color:(ft==null?void 0:ft.color)||"default",children:d.coverage.statusLabel}),e.jsxs(f,{children:["Coverage ",Ye(d.coverage.ratio*100)," (",d.coverage.coveredSkus,"/",d.coverage.activeSkus,"),"," ","Bestand ",d.coverage.stockIssueCount,","," ","Bestellpflicht ",d.coverage.orderDutyIssueCount,","," ","Blocker ",d.coverage.blockerCount]}),qe?e.jsx(c,{children:"Vergangen (Info)"}):null]}),e.jsx(K,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:e.jsxs(k,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs(k,{wrap:!0,children:[e.jsx(L,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:e.jsx(c,{icon:e.jsx(Y,{}),children:"Coverage"})}),e.jsx(L,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:e.jsx(c,{icon:e.jsx(Y,{}),children:"Blocker"})})]}),Ms.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsxs(f,{strong:!0,children:[Cn(s.state)," ",s.label]}),s.route?e.jsx(F,{size:"small",onClick:()=>o(xt({route:s.route,month:d.month,mode:d.coverage.projectionMode})),children:"Öffnen"}):null]}),e.jsx(f,{type:"secondary",children:s.description})]},s.key))]})}),e.jsx(K,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:d.coverage.statusKey==="full"?e.jsx(re,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):qe?e.jsx(re,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):e.jsxs(k,{direction:"vertical",size:10,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"1) Blocker"}),d.blockers.length?e.jsx(k,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:d.blockers.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsx(c,{color:"red",children:"Blocker"}),e.jsx(F,{size:"small",onClick:()=>As(s),children:"Öffnen"})]}),e.jsx(f,{children:s.message})]},s.id))}):e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"2) Warnungen"}),Ut.length?e.jsx(k,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:Ut.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(k,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsx(c,{color:"gold",children:"Warnung"}),e.jsx(F,{size:"small",onClick:()=>o(s.route),children:"Öffnen"})]}),e.jsx(f,{children:s.message})]},s.id))}):e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):e.jsx(f,{type:"secondary",children:"Kein Monat gewählt."})}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:Ke,items:[{key:"signals",label:"Executive Signals",children:e.jsxs("div",{className:"v2-dashboard-signal-grid",children:[e.jsxs(K,{className:"v2-dashboard-signal-card v2-dashboard-readiness-card",children:[e.jsx(Qe,{title:Xe("Readiness Gate","Go/No-Go vor großer Datenpflege. Alle Checks müssen grün sein."),value:ee.ready?"Bereit":"Nicht bereit"}),e.jsxs(k,{wrap:!0,children:[e.jsx(c,{color:ee.ready?"green":"red",children:ee.ready?"Go":"No-Go"}),e.jsxs(c,{color:ee.ready?"green":"gold",children:[ee.robustMonthsCount,"/",ee.robustRequiredCount," robuste Monate"]})]}),!ee.ready&&ee.blockers.length?e.jsx("div",{className:"v2-dashboard-readiness-blockers",children:ee.blockers.slice(0,2).map(s=>e.jsxs("div",{className:"v2-dashboard-readiness-blocker-item",children:[e.jsxs(f,{type:"secondary",children:[s.label,": ",s.message]}),e.jsx(F,{size:"small",onClick:()=>o(s.route),children:"Öffnen"})]},s.id))}):e.jsx(f,{type:"secondary",children:"Alle Gate-Checks erfüllt."})]}),e.jsxs(K,{className:"v2-dashboard-signal-card",children:[e.jsx(Qe,{title:Xe("Robust bis","Letzter Monat, in dem alle Hard-Checks erfüllt sind. Danach ist der Kontostand nur Orientierung."),value:w.robustUntilMonth?V(w.robustUntilMonth):"—"}),e.jsxs(f,{type:"secondary",children:[w.robustMonthsCount,"/",w.totalMonths," Monate robust"]})]}),e.jsxs(K,{className:"v2-dashboard-signal-card",children:[e.jsx(Qe,{title:Xe("Erster negativer Monat (robust)","Erster belastbarer Monat mit negativem Kontostand. Nicht robuste Monate werden dafür ignoriert."),value:Kt?V(Kt):"Keiner"}),e.jsx(f,{type:"secondary",children:"Nur robuste Monate werden berücksichtigt"})]}),e.jsxs(K,{className:"v2-dashboard-signal-card",children:[e.jsx(Qe,{title:Xe("Freier Cash nach Buffer","Minimaler belastbarer Kontostand minus Sicherheitsreserve aus 2 Monaten Fixkosten."),value:Lt!=null?B(Lt):"—"}),e.jsxs(f,{type:"secondary",children:["Buffer (2M Fixkosten): ",B(_e)]})]}),e.jsxs(K,{className:"v2-dashboard-signal-card",children:[e.jsxs("div",{className:"v2-dashboard-forecast-status-head",children:[e.jsxs(f,{strong:!0,children:["Forecast Freshness",e.jsx(L,{title:"Ampel nach Importalter: Grün <=35 Tage, Gelb 36-45 Tage, Rot >45 Tage.",children:e.jsx(Y,{className:"v2-dashboard-inline-info"})})]}),e.jsx(c,{color:De==="fresh"?"green":De==="aging"?"gold":De==="stale"?"red":"default",children:De==="fresh"?"Grün":De==="aging"?"Gelb":De==="stale"?"Rot":"Keine Daten"})]}),e.jsxs("div",{className:"v2-dashboard-forecast-status-meta",children:[e.jsxs("div",{children:["Baseline Forecast: ",ys]}),e.jsx("div",{children:ks}),e.jsxs("div",{children:["Letzter Import: ",Je(mt)]}),e.jsxs("div",{children:["Nächster Import empfohlen: ",_t?_t.toLocaleDateString("de-DE"):"—"]}),Ve>0?e.jsx("div",{children:e.jsxs(F,{size:"small",onClick:()=>o("/v2/forecast?panel=conflicts"),children:["Forecast-Änderung: ",Ve," FOs prüfen"]})}):null]})]})]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:Ke,items:[{key:"cashflow",label:"Kontostand & Cashflow",children:e.jsxs(K,{className:"v2-dashboard-chart-card",children:[e.jsxs("div",{className:"v2-calc-cockpit-shell",children:[e.jsxs("div",{className:"v2-calc-cockpit-status",children:[e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"Aktive Berechnung"}),e.jsxs(k,{wrap:!0,style:{marginTop:6},children:[e.jsxs(c,{children:["Scope: ",Pt]}),e.jsxs(c,{children:["Umsatzbasis: ",Ot]}),e.jsxs(c,{children:["Auszahlungsquote: ",Rt]}),e.jsxs(c,{children:["Sicherheitsmodus: ",Bt]}),dt?e.jsxs(c,{children:["Q4: ",Tt]}):null]})]}),e.jsxs("div",{className:"v2-calc-cockpit-status-right",children:[e.jsxs(k,{wrap:!0,children:[e.jsxs(f,{type:"secondary",children:["Min. Kontostand: ",e.jsx("strong",{children:B(vs)})]}),e.jsxs(f,{type:"secondary",children:["Summe Netto: ",e.jsx("strong",{children:B(ct)})]})]}),e.jsxs(k,{wrap:!0,children:[e.jsx(sn,{trigger:"click",open:H,onOpenChange:ye,placement:"bottomRight",content:e.jsxs("div",{className:"v2-calc-cockpit-popover",children:[e.jsx(f,{strong:!0,children:"Aktive Einstellungen"}),e.jsxs("div",{children:["Scope: ",Pt]}),e.jsxs("div",{children:["Umsatzbasis: ",Ot]}),e.jsxs("div",{children:["Auszahlungsquote: ",Rt]}),e.jsxs("div",{children:["Sicherheitsmodus: ",Bt]}),dt?e.jsxs("div",{children:["Q4: ",Tt]}):null,e.jsx(f,{type:"secondary",children:"Diese Auswahl wirkt direkt auf Umsatz, Cash-In, Netto und Kontostand im Chart."}),e.jsxs(k,{wrap:!0,children:[e.jsx(F,{size:"small",type:"link",onClick:()=>o("/v2/abschluss/eingaben"),children:"Eingaben"}),e.jsx(F,{size:"small",type:"link",onClick:()=>o("/v2/forecast"),children:"Forecast"}),e.jsx(F,{size:"small",type:"link",onClick:()=>o("/v2/products"),children:"Produkte"})]})]}),children:e.jsx(F,{size:"small",children:"Details"})}),e.jsx(F,{size:"small",onClick:ws,children:"Zurücksetzen"})]})]})]}),e.jsxs("div",{className:"v2-calc-cockpit-modules",children:[e.jsxs(K,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(k,{size:6,children:[e.jsx(f,{strong:!0,children:"Portfolio-Scope"}),e.jsx(L,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:e.jsx(Y,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx("div",{className:"v2-calc-cockpit-chip-row",children:cs.map(s=>{const u=g.includes(s.value);return e.jsx(xn,{checked:u,onChange:S=>{y(P=>{const te=Array.from(new Set((P||[]).filter(G=>ze.includes(G))));if(S)return Array.from(new Set([...te,s.value]));const T=te.filter(G=>G!==s.value);return T.length?T:te})},children:s.label},s.value)})}),e.jsxs(k,{wrap:!0,children:[e.jsx(F,{size:"small",type:g.length===1&&g[0]===$.CORE?"primary":"default",onClick:()=>y([$.CORE]),children:"Nur Kern"}),e.jsx(F,{size:"small",type:ss(g)==="Kern+Plan"?"primary":"default",onClick:()=>y([$.CORE,$.PLAN]),children:"Kern+Plan"}),e.jsx(F,{size:"small",type:g.length===ze.length?"primary":"default",onClick:()=>y(ze.slice()),children:"Alles"})]}),e.jsx(f,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard."})]}),e.jsxs(K,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(k,{size:6,children:[e.jsx(f,{strong:!0,children:"Umsatzbasis"}),e.jsx(L,{title:"Forecast-Umsatz = Absatzprognose × Verkaufspreis. Kalibrierter Umsatz = Forecast-Umsatz mit Kalibrierfaktor aus Eingaben.",children:e.jsx(Y,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx(bt,{block:!0,value:x,onChange:s=>M(String(s)==="calibrated"?"calibrated":"forecast"),options:[{label:"Forecast-Umsatz",value:"forecast"},{label:"Kalibrierter Umsatz",value:"calibrated"}]}),e.jsxs(f,{type:"secondary",children:[x==="calibrated"?`Kalibrierung aktiv (wirkt über ${ms} Monate).`:"Kalibrierung aus."," ",e.jsx(F,{size:"small",type:"link",onClick:()=>o("/v2/abschluss/eingaben"),children:x==="calibrated"?"Eingaben öffnen":"In Eingaben aktivieren"})]})]}),e.jsxs(K,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(k,{size:6,children:[e.jsx(f,{strong:!0,children:"Amazon Auszahlung (Cash-In)"}),e.jsx(L,{title:"Manuell nutzt die Monatsquote aus Eingaben. Empfehlung berechnet die Quote automatisch als Vorschlag je Monat.",children:e.jsx(Y,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx(bt,{block:!0,value:I,onChange:s=>v(String(s)==="recommendation"?"recommendation":"manual"),options:[{label:"Manuell je Monat",value:"manual"},{label:"Empfehlung",value:"recommendation"}]}),e.jsxs(k,{direction:"vertical",size:6,style:{width:"100%"},children:[e.jsxs(k,{size:6,children:[e.jsx(f,{strong:!0,children:"Sicherheitsmodus"}),e.jsx(L,{title:"Basis: keine Sicherheitsmarge. Konservativ: reduziert die Quote in zukünftigen Monaten um 1pp pro Monat (max. 5pp).",children:e.jsx(Y,{})})]}),e.jsx(bt,{block:!0,value:j,onChange:s=>U(String(s)==="conservative"?"conservative":"basis"),options:[{label:"Basis",value:"basis"},{label:"Konservativ",value:"conservative"}]})]}),dt?e.jsxs("div",{className:"v2-calc-cockpit-q4-row",children:[e.jsx(nn,{checked:b,onChange:s=>E(s.target.checked),children:"Saisonalität (Q4) berücksichtigen"}),e.jsx(L,{title:"Q4 berücksichtigt saisonale Besonderheiten für Oktober bis Dezember. Gilt nur für die Empfehlung.",children:e.jsx(Y,{})})]}):null,e.jsx(f,{type:"secondary",children:I==="manual"?"Verwendet die manuell gepflegte Auszahlungsquote je Monat.":"Empfehlung wird je Monat automatisch berechnet und direkt im Chart angewendet."})]})]})]}),e.jsx(Ze,{level:4,style:{marginTop:16},children:"Kontostand & Cashflow"}),e.jsxs(k,{wrap:!0,children:[e.jsxs(c,{color:"green",children:["Einzahlungen: ",B(bs)]}),e.jsxs(c,{color:"red",children:["Auszahlungen: ",B(ps)]}),e.jsxs(c,{color:ct>=0?"green":"red",children:["Netto: ",B(ct)]}),ie.length?e.jsxs(c,{color:"gold",children:["Phantom-FOs: ",ie.length]}):null,he?e.jsxs(c,{color:"gold",children:["PFO bis: ",V(he)]}):null]}),e.jsxs("div",{className:"v2-dashboard-legend-help",children:[e.jsx(f,{type:"secondary",className:"v2-dashboard-legend-note",children:"Die Legende steuert nur die Sichtbarkeit von Serien. Die Berechnung bleibt unverändert."}),e.jsx(L,{title:"Durchgezogene Linie: belastbarer Kontostand (alle Hard-Checks bestanden).",children:e.jsx(c,{className:"v2-dashboard-legend-tag",children:"Linie solid = belastbar"})}),e.jsx(L,{title:"Gestrichelte Linie: orientierend, weil mindestens ein Hard-Check fehlt.",children:e.jsx(c,{className:"v2-dashboard-legend-tag",children:"Linie gestrichelt = orientierend"})}),e.jsx(L,{title:"Rot markiert: Kontostand liegt unter 0 im jeweiligen Zustand.",children:e.jsx(c,{className:"v2-dashboard-legend-tag",children:"Rot = unter 0"})})]}),e.jsx(Os,{style:{height:380},option:Ds})]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:Ke,items:[{key:"robustness",label:"Robustheits-Matrix",children:e.jsxs(K,{children:[e.jsx(Ze,{level:4,children:"Robustheits-Matrix"}),e.jsx(vt,{type:"secondary",children:"Ein Monat wird nur dann grün, wenn Bestands-Check und Look-Ahead-Bestellpflicht passen. Die Stufen folgen den Schwellen: Vollständig 100 %, Weitgehend ≥95 % ohne A/B-Blocker, Teilweise ≥80 %, sonst Unzureichend."}),e.jsx("div",{className:"v2-dashboard-robust-legend",children:["full","wide","partial","insufficient"].map(s=>{const u=tt(s);return e.jsxs("div",{className:"v2-dashboard-robust-legend-item",children:[e.jsx("span",{className:`v2-dashboard-robust-dot ${u.className}`}),e.jsx(f,{children:u.label})]},s)})}),e.jsx("div",{className:"v2-dashboard-robust-grid",children:w.months.map(s=>{const u=We(s.month),S=u!=null&&qt!=null&&u<qt,P=tt(s.coverage.statusKey);return e.jsxs("button",{type:"button",className:["v2-dashboard-robust-item",J===s.month?"is-selected":"",P.className,S?"is-past":""].filter(Boolean).join(" "),onClick:()=>it(s.month),children:[e.jsxs("div",{className:"v2-dashboard-robust-item-head",children:[e.jsx("span",{children:V(s.month)}),e.jsxs(k,{size:6,children:[e.jsx(c,{color:P.color,children:P.label}),S?e.jsx(c,{children:"Vergangen"}):null]})]}),e.jsxs("div",{className:"v2-dashboard-robust-item-meta",children:["Coverage: ",Ye(s.coverage.ratio*100)," (",s.coverage.coveredSkus,"/",s.coverage.activeSkus,")"]}),e.jsxs("div",{className:"v2-dashboard-robust-item-meta",children:["Blocker SKUs: ",s.coverage.blockerCount," (A/B ",s.coverage.blockerAbCount," · C ",s.coverage.blockerCCount,")"]})]},s.month)})}),d?e.jsxs("div",{className:"v2-dashboard-robust-detail",children:[e.jsxs("div",{className:"v2-dashboard-robust-detail-head",children:[e.jsx(f,{strong:!0,children:V(d.month)}),e.jsxs(k,{wrap:!0,children:[Dn(d.coverage.statusKey),e.jsxs(c,{children:["Coverage: ",Ye(d.coverage.ratio*100)]}),e.jsxs(c,{children:["Blocker: ",d.coverage.blockerCount]}),e.jsxs(c,{children:["A/B: ",d.coverage.blockerAbCount," · C: ",d.coverage.blockerCCount]}),d.coverage.overdueOrderDutySkuCount>0?e.jsxs(c,{color:"red",children:["Überfällig: ",d.coverage.overdueOrderDutySkuCount]}):null]})]}),e.jsx("div",{className:"v2-dashboard-robust-checklist",children:Ss.map(s=>e.jsxs("div",{className:`v2-dashboard-robust-checklist-item ${s.passed?"is-pass":"is-fail"}`,children:[e.jsx("span",{className:"v2-dashboard-robust-check-icon",children:s.passed?"✅":"❌"}),e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:s.label}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:s.description})})]})]},s.key))}),e.jsxs("div",{className:"v2-dashboard-blockers",children:[e.jsx(f,{strong:!0,children:"Weitere Hard-Checks"}),Vt.length?e.jsx("div",{className:"v2-dashboard-blocker-list",children:Vt.map(s=>e.jsxs("div",{className:"v2-dashboard-blocker-item",children:[e.jsxs("div",{children:[e.jsx(f,{children:s.message}),s.sku?e.jsxs(f,{type:"secondary",children:[" · ",s.sku]}):null]}),e.jsx(F,{size:"small",onClick:()=>o(xt({route:s.route,checkKey:s.checkKey,month:s.month,sku:s.sku||null,mode:d.coverage.projectionMode})),children:"Öffnen"})]},s.id))}):e.jsx(f,{type:"secondary",children:"Keine weiteren Hard-Check-Blocker."})]})]}):null]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:Ke,items:[{key:"pnl",label:"Monatliche PnL (Drilldown)",children:e.jsxs(K,{children:[e.jsx(Ze,{level:4,children:"Monatliche PnL (Drilldown)"}),e.jsx(vt,{type:"secondary",children:"Einzahlungen, PO/FO-Zahlungen, Fixkosten und Steuern je Monat. PO/FO-Positionen sind bis auf Milestone-Ebene aufklappbar."}),e.jsx(we,{className:"v2-dashboard-pnl-collapse",activeKey:Be,onChange:s=>q(Array.isArray(s)?s.map(String):[String(s)]),items:Cs})]})}]})]}):e.jsx("div",{className:"v2-page",children:e.jsx(re,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{Mr as default};
