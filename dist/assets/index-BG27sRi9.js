import{t as i,I as tn,_ as nn,J as sn,P as oe,K as We,k as t,S as A,L as on,M as F,T as se,N as ce,R as an,O as $e,Q as H,U as rn,V as ln}from"./index-Coy5uI_5.js";import{v as O,a as V,E as cn}from"./chartPalette-D7CYBNhR.js";import{c as un,b as dn}from"./cashflow-Bj3jwo8Q.js";import{r as mn,b as hn,a as fn,c as pn}from"./phantomFo-DsSuou9W.js";import{e as gn}from"./forecastVersioning-CDttPd6y.js";import{f as W,m as Et,c as bn}from"./months-BTPgK-LH.js";import{u as yn,C as ye}from"./workspace-CyixVU0N.js";import{S as It}from"./index-CZt3uyLD.js";import{R as ue}from"./InfoCircleOutlined-oitC9Mrj.js";import{S as _e}from"./index-CgtOzsz2.js";import{S as xn}from"./index-CbMmXB48.js";import{F as vn}from"./Table-BMyA5XPb.js";import"./planProducts-BWNeELvC.js";import"./productCompletenessV2-ZpPGQBGl.js";import"./orderUtils-DUO2uREU.js";import"./foSuggestion-DyBAXRuI.js";import"./abcClassification-CFB9U_qJ.js";import"./inventoryProjection-yBWhh-s-.js";import"./Dropdown-DTtU6pdS.js";import"./DownOutlined-Cs7KENgq.js";import"./index-D9K5WANl.js";import"./useBubbleLock-BGoAIsgk.js";import"./index-60UjD8Oq.js";import"./Pagination-BdEHa_bF.js";var kn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},Mn=function(r,l){return i.createElement(tn,nn({},r,{ref:l,icon:kn}))},Sn=i.forwardRef(Mn);function jn(n){if(n==null||typeof n=="string"&&n.trim()==="")return null;const r=Number(n);return Number.isFinite(r)?r:null}function wn(n){const r=Array.isArray(n.rows)?n.rows:[];if(!r.length)return[];const l=Number(n.initialOpening);let u=Number.isFinite(l)?l:0;return r.map((m,p)=>{const c=u,b=Number(m==null?void 0:m.net),x=Number.isFinite(b)?b:0,N=jn(m==null?void 0:m.actualClosing),E=c+x,v=N??E;return u=v,{month:String((m==null?void 0:m.month)||""),opening:c,net:x,plannedClosing:E,closing:v,actualClosing:N,lockedActual:N!=null}})}const{Paragraph:Dt,Text:y,Title:Re}=on,Ue=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],Nn=[{value:oe.CORE,label:"Kernportfolio"},{value:oe.PLAN,label:"Planprodukte"},{value:oe.IDEAS,label:"Ideenprodukte"}],Tt=[oe.CORE,oe.PLAN],Ot={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function Cn(n){return String(n||"").trim().toLowerCase()==="recommendation"?"recommendation":"manual"}function I(n){const r=Number(n);return Number.isFinite(r)?r.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function Pt(n){return Number.isFinite(n)?n<0?`−${I(Math.abs(n))}`:I(n):"-"}function zn(n,r=0){const l=Number(n);return Number.isFinite(l)?l.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r}):"-"}function Bt(n){const r=Number(n);return Number.isFinite(r)?`${r.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function An(n){if(!n)return"-";const r=new Date(n);return Number.isNaN(r.getTime())?n:r.toLocaleDateString("de-DE")}function Fn(n){return Ot[n]||Ot.insufficient}function En(n){return n==="ok"?"✅":n==="warn"?"⚠️":"❌"}function In(n,r){const l=structuredClone(n||{});(!l.settings||typeof l.settings!="object")&&(l.settings={}),(!l.forecast||typeof l.forecast!="object")&&(l.forecast={});const u=l.settings,m=l.forecast;(!m.settings||typeof m.settings!="object")&&(m.settings={});const p=m.settings;return p.useForecast=!0,u.cashInMode="basis",u.cashInQuoteMode=r.quoteMode,u.cashInCalibrationEnabled=r.calibrationEnabled,u.cashInRevenueBasisMode=r.revenueBasisMode,u.cashInRecommendationSeasonalityEnabled=!0,u.cashInRecommendationIgnoreQ4=!1,l}function Z(n,r){const[l,u=""]=String(n||"").split("?"),m=new URLSearchParams(u);Object.entries(r).forEach(([c,b])=>{if(b==null||b===""){m.delete(c);return}m.set(c,b)});const p=m.toString();return p?`${l}?${p}`:l}function qe(n){return Z("/v2/inventory/projektion",{source:"dashboard",risk:n.risk||"under_safety",abc:n.abc||"ab",month:n.month||null,sku:n.sku||null,mode:n.mode||null,expand:"all"})}function Dn(n){return Z("/v2/products",{source:"dashboard",issues:n.issues,sku:n.sku||null,expand:"all"})}function Lt(n){return Z("/v2/forecast",{source:"dashboard",sku:n.sku||null,month:n.month||null})}function Tn(n){return Z("/v2/orders/fo",{source:n.source,sku:n.sku||null,month:n.month||null,suggestedUnits:Number.isFinite(Number(n.suggestedUnits))?String(Math.max(0,Math.round(Number(n.suggestedUnits)))):"0",requiredArrivalDate:n.requiredArrivalDate||null,recommendedOrderDate:n.recommendedOrderDate||null,phantomId:null,firstRiskMonth:n.firstRiskMonth||null,orderMonth:n.orderMonth||null,leadTimeDays:Number.isFinite(Number(n.leadTimeDays))?String(Math.max(0,Math.round(Number(n.leadTimeDays)))):null,returnTo:n.returnTo})}function Kt(n){const r=String(n.route||"");if(r.startsWith("/v2/forecast"))return Lt({sku:n.sku||null,month:n.month||null});if(r.startsWith("/v2/inventory/projektion")){const l=n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"under_safety":"all",u=n.sku?"all":n.actionId==="inventory_safety"||n.checkKey==="sku_coverage"?"ab":"all";return qe({risk:l,abc:u,month:n.month||null,sku:n.sku||null,mode:n.mode||null})}if(r.startsWith("/v2/products")){const l=n.actionId==="revenue_inputs"||n.checkKey==="revenue_inputs"?"revenue":"needs_fix";return Dn({issues:l,sku:n.sku||null})}return r}function On(n){const r=typeof n.portfolioBucket=="string"?n.portfolioBucket:null;if(r)return r;const l=n.meta&&typeof n.meta=="object"?n.meta:{};return typeof l.portfolioBucket=="string"?String(l.portfolioBucket):null}function Ae(n,r){const l=On(n);return!l||!We.includes(l)?!0:r.has(l)}function Pn(n,r){var p;if(!n.length)return[];const l=n.map(c=>{const b=(Array.isArray(c.entries)?c.entries:[]).filter(v=>Ae(v,r)),x=b.filter(v=>String(v.direction||"").toLowerCase()==="in").reduce((v,C)=>v+Math.abs(Number(C.amount||0)),0),N=b.filter(v=>String(v.direction||"").toLowerCase()==="out").reduce((v,C)=>v+Math.abs(Number(C.amount||0)),0),E=x-N;return{...c,inflow:x,outflow:N,net:E,entries:b}}),u=Number(((p=n[0])==null?void 0:p.opening)||0),m=wn({rows:l.map(c=>({month:c.month,net:c.net,actualClosing:c.actualClosing})),initialOpening:u});return l.map((c,b)=>{const x=m[b];return{...c,opening:Number((x==null?void 0:x.opening)??c.opening??0),closing:Number((x==null?void 0:x.closing)??c.closing??0),hasActualClosing:(x==null?void 0:x.lockedActual)===!0}})}function Bn(n,r,l){const u={fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0};return n.forEach(m=>{if(!m||typeof m!="object")return;const p=m;if(l&&!Ae(p,l)||String(p.direction||"").toLowerCase()!=="out")return;const c=Math.abs(Number(p.amount||0));if(!Number.isFinite(c)||c<=0)return;u.total+=c;const b=String(p.source||"").toLowerCase();if(b==="po"){u.po+=c;return}if(b==="fo"){const N=String(p.sourceId||"").trim(),E=p.meta&&typeof p.meta=="object"?p.meta:{};p.provisional===!0||E.phantom===!0||(N?(r==null?void 0:r.has(N))===!0:!1)?u.phantomFo+=c:u.fo+=c;return}const x=String(p.group||"").toLowerCase();if(b==="fixcosts"||x==="fixkosten"){u.fixcost+=c;return}u.other+=c}),u}function Kn(n,r,l){const u={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};n.forEach(p=>{if(!p||typeof p!="object")return;const c=p;if(r&&!Ae(c,r)||String(c.direction||"").toLowerCase()!=="in")return;const b=Math.abs(Number(c.amount||0));if(!Number.isFinite(b)||b<=0)return;const x=String(c.source||"").toLowerCase(),N=String(c.kind||"").toLowerCase();if(x==="sales"||x==="sales-plan"||N==="sales-payout"){u.amazon+=b;const v=c.meta&&typeof c.meta=="object"?c.meta:{},C=v.cashIn&&typeof v.cashIn=="object"?v.cashIn:{},G=String(C.component||"").trim().toLowerCase(),J=String(c.portfolioBucket||v.portfolioBucket||"").trim(),de=ln(J,oe.CORE);x==="sales-plan"||G==="plan"?u.amazonNew+=b:de===oe.CORE?u.amazonCore+=b:u.amazonPlanned+=b}else u.other+=b;u.total+=b});const m=Number(l==null?void 0:l.payoutEUR);return Number.isFinite(m)&&Math.abs(m)>1e-6&&(u.amazon=Math.max(0,m),u.amazonCore=u.amazon,u.amazonPlanned=0,u.amazonNew=0,u.total=u.amazon+u.other),u}function Ve(n){const r={};return n.forEach(l=>{r[l]=0}),r}function ze(n){return Object.values(n).reduce((r,l)=>r+Math.abs(Number(l||0)),0)}function Ln(n){const r=Number(n.paid||0),l=Number(n.open||0),u=Number(n.unknown||0);return r>0&&l<=0&&u<=0?"paid":l>0&&r<=0&&u<=0?"open":u>0&&r<=0&&l<=0?"unknown":"mixed"}function $n(n){const r=[],l=u=>{u.forEach(m=>{!Array.isArray(m.children)||m.children.length===0||(r.push(m.key),l(m.children))})};return l(n),r}function _n(n){const r=new Map;(Array.isArray(n.products)?n.products:[]).forEach(p=>{const c=String(p.sku||"").trim();if(!c)return;const b=String(p.alias||"").trim()||c;r.set(c,b)});const u=new Map,m=(p,c)=>{const b=(p==="po"?[c.poNo,c.id]:[c.foNo,c.foNumber,c.id]).map(C=>String(C||"").trim()).filter(Boolean);if(!b.length)return;const x=Array.isArray(c.items)&&c.items.length?c.items:[{sku:c.sku,units:c.units}],N=new Set;let E=0;x.forEach(C=>{const G=String(C.sku||"").trim();if(!G)return;N.add(r.get(G)||G);const J=Number(C.units??C.qty??C.quantity??0);Number.isFinite(J)&&(E+=J)});const v={aliases:Array.from(N),units:Number.isFinite(E)?E:null};Array.from(new Set(b)).forEach(C=>{u.set(`${p}:${C}`,v)})};return(Array.isArray(n.pos)?n.pos:[]).forEach(p=>m("po",p)),(Array.isArray(n.fos)?n.fos:[]).forEach(p=>m("fo",p)),u}function Rn(n){if(!n||typeof n!="object")return{toVersionId:null,foConflictsOpen:0};const r=n;return{toVersionId:r.toVersionId==null?null:String(r.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(r.foConflictsOpen||0)))}}function ps(){var pt,gt,bt,yt,xt,vt,kt,Mt,St,jt,wt,Nt,Ct,zt;const{state:n,loading:r,error:l,saveWith:u}=yn(),m=sn(),[p,c]=i.useState("next6"),[b,x]=i.useState(()=>Tt.slice()),[N,E]=i.useState(""),[v,C]=i.useState(""),[G,J]=i.useState(!1),[de,Fe]=i.useState(["inflows","outflows"]),B=n,Ee=n.settings&&typeof n.settings=="object"?n.settings:{},Qe=n.forecast&&typeof n.forecast=="object"?n.forecast:{},me=Ee.cashInCalibrationEnabled!==!1,xe=String(Ee.cashInRevenueBasisMode||"").trim().toLowerCase()==="forecast_direct"?"forecast_direct":"hybrid",ve=Cn(Ee.cashInQuoteMode),Ie=i.useCallback(async e=>{await u(s=>{const d=structuredClone(s);(!d.settings||typeof d.settings!="object")&&(d.settings={});const o=d.settings;return d.settings={...o,...e,lastUpdatedAt:new Date().toISOString()},d},"v2:dashboard:cashin-cockpit")},[u]),D=i.useMemo(()=>mn(B,18),[n.settings]),X=i.useMemo(()=>N&&D.includes(N)?N:D[D.length-1]||"",[N,D]),ae=i.useMemo(()=>hn({state:B,months:D,targetMonth:X||null}),[D,X,B]),ke=i.useMemo(()=>new Set(ae.map(e=>e.id)),[ae]),He=i.useMemo(()=>fn({state:B,suggestions:ae}),[ae,B]),Y=i.useMemo(()=>In(He,{quoteMode:ve,revenueBasisMode:xe,calibrationEnabled:me}),[me,He,ve,xe]),T=i.useMemo(()=>un(Y),[Y]),De=T.months||[],Ze=T.breakdown||[],j=i.useMemo(()=>{const e=Ue.find(s=>s.value===p);return!e||e.count==null?De:De.slice(0,e.count)},[De,p]),$t=i.useMemo(()=>{const e=Ue.find(s=>s.value===p);return(e==null?void 0:e.label)||"Alle Monate"},[p]),Ge=i.useMemo(()=>new Set(j),[j]),q=i.useMemo(()=>new Set(b),[b]),Me=i.useMemo(()=>{const e=Ze.filter(s=>Ge.has(s.month));return Pn(e,q)},[Ze,q,Ge]),re=i.useMemo(()=>pn({state:B,months:j}),[B,j]);i.useEffect(()=>{if(!D.length){E("");return}E(e=>e&&D.includes(e)?e:D[D.length-1])},[D]),i.useEffect(()=>{var e;if(!re.months.length){C("");return}if(!v||!re.monthMap.has(v)){const s=((e=re.months.find(d=>!d.robust))==null?void 0:e.month)||re.months[0].month;C(s)}},[re,v]);const _t=i.useCallback((e,s)=>{We.includes(e)&&x(d=>{const o=Array.from(new Set((d||[]).filter(h=>We.includes(h)))),a=o.includes(e);if(s&&!a)return[...o,e];if(!s&&a){const h=o.filter(g=>g!==e);return h.length?h:o}return o})},[]),Je=i.useCallback(e=>{e&&(C(e),J(!0))},[]),w=i.useMemo(()=>Me.map(e=>({...e})),[Me]),Xe=i.useMemo(()=>dn(j,Y,null,{report:T}),[Y,T,j]),Ye=i.useMemo(()=>new Map(w.map(e=>[e.month,e.hasActualClosing===!0])),[w]),Q=i.useMemo(()=>{const e=new Map;return w.forEach(s=>{e.set(s.month,Kn(Array.isArray(s.entries)?s.entries:[],q,Xe[s.month]||null))}),e},[q,Xe,w]),P=i.useMemo(()=>w.map(e=>Q.get(e.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[Q,w]),K=i.useMemo(()=>{const e=new Map;return w.forEach(s=>{e.set(s.month,Bn(Array.isArray(s.entries)?s.entries:[],ke,q))}),e},[q,ke,w]),he=i.useMemo(()=>w.map(e=>K.get(e.month)||{fixcost:0,po:0,fo:0,phantomFo:0,other:0,total:0}),[K,w]),et=i.useMemo(()=>P.map(e=>e.amazonCore),[P]),tt=i.useMemo(()=>P.map(e=>e.amazonPlanned),[P]),nt=i.useMemo(()=>P.map(e=>e.amazonNew),[P]),Rt=i.useMemo(()=>P.map(e=>e.amazon),[P]),Te=i.useMemo(()=>P.map(e=>e.other),[P]),Ut=Rt.reduce((e,s)=>e+Number(s||0),0)+Te.reduce((e,s)=>e+Number(s||0),0),Vt=w.reduce((e,s)=>e+Number(s.outflow||0),0),Oe=w.reduce((e,s)=>e+Number(s.net||0),0),Wt=i.useMemo(()=>w.length?Math.min(...w.map(e=>Number(e.closing||0))):null,[w]),st=((gt=(pt=T.kpis)==null?void 0:pt.cashIn)==null?void 0:gt.calibrationApplied)===!0,ot=Math.max(0,Math.round(Number(((yt=(bt=T.kpis)==null?void 0:bt.cashIn)==null?void 0:yt.calibrationCandidateCount)||0))),at=Math.max(0,Math.round(Number(((vt=(xt=T.kpis)==null?void 0:xt.cashIn)==null?void 0:vt.calibrationNonDefaultFactorMonthCount)||0))),fe=String(((Mt=(kt=T.kpis)==null?void 0:kt.cashIn)==null?void 0:Mt.calibrationLatestCandidateMonth)||"").trim()||null,Se=Number((jt=(St=T.kpis)==null?void 0:St.cashIn)==null?void 0:jt.calibrationLatestRawFactor),ie=(Nt=(wt=T.kpis)==null?void 0:wt.cashIn)!=null&&Nt.calibrationReasonCounts&&typeof T.kpis.cashIn.calibrationReasonCounts=="object"?T.kpis.cashIn.calibrationReasonCounts:{},rt=i.useMemo(()=>(Array.isArray(Y.incomings)?Y.incomings:[]).reduce((s,d)=>{const o=d&&typeof d=="object"?d:{},a=Number(o.calibrationSellerboardMonthEndEur)>0,h=Number(o.calibrationRevenueToDateEur)>0&&String(o.calibrationCutoffDate||"").trim().length>0;return a||h?s+1:s},0),[Y]),it=i.useMemo(()=>{if(!me||st)return null;if(rt<=0)return"Keine verwertbaren Kalibrierdaten gefunden. Das Diagramm entspricht aktuell dem Forecast-Umsatz.";if(ot<=0){const e=Math.max(0,Math.round(Number(ie.missing_forecast_revenue||0))),s=Math.max(0,Math.round(Number(ie.missing_inputs||0))),d=Math.max(0,Math.round(Number(ie.invalid_cutoff_date||0))),o=Math.max(0,Math.round(Number(ie.invalid_factor||0))),a=Math.max(0,Math.round(Number(ie.invalid_expected_revenue||0))),h=[];return e>0&&h.push(`Forecast-Umsatz fehlt/ist 0 in ${e} Kalibrier-Monat(en)`),s>0&&h.push(`Kalibrierdaten unvollständig in ${s} Monat(en)`),d>0&&h.push(`Cutoff-Datum ungültig in ${d} Monat(en)`),(o>0||a>0)&&h.push(`Faktor rechnerisch ungültig in ${o+a} Monat(en)`),h.length?`Kalibrierdaten sind vorhanden, aber aktuell nicht wirksam: ${h.join(" · ")}.`:"Kalibrierdaten sind vorhanden, aber aktuell im Planungsfenster nicht verwertbar. Das Diagramm bleibt beim Forecast-Umsatz."}if(at<=0){if(Number.isFinite(Se)){const e=Number(Se).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2});if(Math.abs(Se-1)<=1e-6){const d=fe?` (Quelle ${W(fe)})`:"";return`Kalibrierung aktiv, aber ohne Effekt: Startfaktor ${e}${d}. Das entspricht faktisch 1,00.`}const s=fe?` (${W(fe)})`:"";return`Kalibrierdaten gefunden (Startfaktor ${e}${s}), aber im aktuellen Planungsfenster wirkt der Fade-Out bereits auf ~1,00.`}return"Kalibrierdaten sind vorhanden, aktuell aber ohne Effekt (Faktor ~1,00 im Planungsfenster)."}return"Kalibrierung aktiv, aber der Effekt ist im aktuellen Ausschnitt minimal."},[st,ot,rt,fe,Se,at,ie,me]),lt=i.useMemo(()=>{const e=structuredClone(Qe||{});return gn(e),e},[Qe]),Pe=Rn(lt.lastImpactSummary),ct=String(lt.activeVersionId||"").trim()||null,ut=Pe.toVersionId&&ct&&Pe.toVersionId===ct?Pe.foConflictsOpen:0,f=v&&re.monthMap.get(v)||null,Be=f?Fn(f.coverage.statusKey):null,je=i.useMemo(()=>{if(!f)return!1;const e=Et(bn()),s=Et(f.month);return s==null||e==null?!1:s<e},[f]),dt=f?f.checks.filter(e=>e.key!=="sku_coverage"):[],mt=i.useMemo(()=>{if(!f||f.coverage.statusKey==="full")return[];const e=f.month;return[{id:`coverage-warning:${e}`,message:`Coverage ist ${f.coverage.statusLabel}: ${Bt(f.coverage.ratio*100)} (${f.coverage.coveredSkus}/${f.coverage.activeSkus}).`,route:qe({risk:"under_safety",abc:"ab",month:e,mode:f.coverage.projectionMode})}]},[f]),qt=i.useMemo(()=>{if(!f)return[];const e=[],s=f.coverage.stockIssueCount,d=f.coverage.orderDutyIssueCount;return e.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:s===0?"ok":"fail",description:s===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${s} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),e.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:d===0?"ok":f.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:d===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${d} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),dt.forEach(o=>{e.push({key:o.key,label:o.label,state:o.passed?"ok":"fail",description:o.detail,route:o.route||null})}),je&&e.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),e},[f,je,dt]),ht=i.useMemo(()=>{const e=new Map;return j.forEach(s=>{e.set(W(s),s)}),e},[j]),ft=i.useCallback(e=>{if(!e||typeof e!="object")return;const s=e;let d=null;const o=Number(s.dataIndex);if(Number.isInteger(o)&&o>=0&&o<j.length&&(d=j[o]),!d){const a=[s.name,s.axisValue,s.value].map(h=>typeof h=="string"?h.trim():"").filter(Boolean);for(let h=0;h<a.length;h+=1){const g=ht.get(a[h]);if(g){d=g;break}}}d&&Je(d)},[ht,Je,j]),Qt=i.useMemo(()=>({click:ft}),[ft]),Ht=i.useMemo(()=>{const e="Amazon Kern",s="Amazon Plan",d="Amazon Neu",o=new Set([e,s,d]),a=j.map(S=>W(S)),h=Me.map(S=>Number(S.closing||0)),g=he.map(S=>-S.fixcost),k=he.map(S=>-S.po),z=he.map(S=>-S.fo),$=he.map(S=>-S.phantomFo),_=[e,s,d,"Sonstige In","Fixkosten","PO","FO","Phantom FO","Netto","Kontostand"];return{tooltip:{trigger:"axis",formatter:S=>{const te=Array.isArray(S)?S:[S],R=te[0],pe=[`<div><strong>${(R==null?void 0:R.axisValueLabel)||""}</strong></div>`];let ge=0,be=!1;return te.forEach(Ne=>{const M=Ne,le=Number(M==null?void 0:M.value);Number.isFinite(le)&&(o.has(String((M==null?void 0:M.seriesName)||""))&&(ge+=le,be=!0),pe.push(`<div>${(M==null?void 0:M.marker)||""}${(M==null?void 0:M.seriesName)||""}: ${I(le)}</div>`))}),be&&pe.push(`<div><strong>Amazon gesamt: ${I(ge)}</strong></div>`),pe.join("")}},legend:{type:"scroll",top:0,left:0,right:0,itemGap:10,itemWidth:14,itemHeight:8,textStyle:{fontSize:12,color:V.textStrong},pageTextStyle:{fontSize:11,color:V.textMuted},data:_},grid:{left:54,right:68,top:54,bottom:42},xAxis:{type:"category",data:a,triggerEvent:!0,axisLabel:{hideOverlap:!0,fontSize:12,color:V.textMuted,margin:12},axisLine:{lineStyle:{color:V.axisLine}}},yAxis:[{type:"value",name:"Cashflow",nameTextStyle:{fontSize:12,color:V.textMuted},axisLabel:{formatter:S=>Pt(S),fontSize:12,color:V.textMuted},splitLine:{lineStyle:{color:V.gridLine}}},{type:"value",name:"Kontostand",position:"right",nameTextStyle:{fontSize:12,color:V.textMuted},axisLabel:{formatter:S=>I(S),fontSize:12,color:V.textMuted},splitLine:{show:!1}}],series:[{name:e,type:"bar",stack:"cash",data:et,itemStyle:{color:O.amazonCore}},{name:s,type:"bar",stack:"cash",data:tt,itemStyle:{color:O.amazonPlanned}},{name:d,type:"bar",stack:"cash",data:nt,itemStyle:{color:O.amazonNew}},{name:"Sonstige In",type:"bar",stack:"cash",data:Te,itemStyle:{color:O.otherInflow}},{name:"Fixkosten",type:"bar",stack:"cash",data:g,itemStyle:{color:O.fixcost}},{name:"PO",type:"bar",stack:"cash",data:k,itemStyle:{color:O.po}},{name:"FO",type:"bar",stack:"cash",data:z,itemStyle:{color:O.fo}},{name:"Phantom FO",type:"bar",stack:"cash",data:$,itemStyle:{color:O.phantomFo}},{name:"Netto",type:"line",smooth:!0,showSymbol:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:7,data:w.map(S=>Number(S.net||0)),itemStyle:{color:O.net},lineStyle:{width:2,color:O.net}},{name:"Kontostand",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!0,showSymbol:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:7,data:h,lineStyle:{width:2,color:O.robustPositive},itemStyle:{color:O.robustPositive}}]}},[et,nt,tt,Te,he,w,Me,j]),we=i.useMemo(()=>_n(B),[n.fos,n.pos,n.products,B]),ee=i.useMemo(()=>{const e={"outflows-po":new Map,"outflows-fo":new Map,"outflows-phantom-fo":new Map};w.forEach(d=>{const o=d.month;(Array.isArray(d.entries)?d.entries:[]).forEach(h=>{if(!h||typeof h!="object")return;const g=h;if(!Ae(g,q)||String(g.direction||"").toLowerCase()!=="out")return;const k=Math.abs(Number(g.amount||0));if(!Number.isFinite(k)||k<=0)return;const z=String(g.source||"").toLowerCase();if(z!=="po"&&z!=="fo")return;const $=String(g.sourceNumber||"").trim(),_=String(g.sourceId||"").trim(),S=String(g.id||g.label||"").trim(),te=$||_||S||"ohne-nummer",R=g.meta&&typeof g.meta=="object"?g.meta:{},pe=z==="fo"&&(g.provisional===!0||R.phantom===!0||(_?ke.has(_):!1)),ge=z==="po"?"outflows-po":pe?"outflows-phantom-fo":"outflows-fo",be=e[ge],Ne=`${z}:${te}`;let M=be.get(Ne);if(!M){const U=we.get(`${z}:${te}`)||($?we.get(`${z}:${$}`):void 0)||(_?we.get(`${z}:${_}`):void 0);M={key:`order:${ge}:${z}:${te}`,label:`${String(z).toUpperCase()} ${te}`,values:Ve(j),aliases:new Set((U==null?void 0:U.aliases)||[]),units:(U==null?void 0:U.units)??null,paymentMix:{paid:0,open:0,unknown:0},payments:new Map},be.set(Ne,M)}M.values[o]+=-k,g.paid===!0?M.paymentMix.paid+=k:g.paid===!1?M.paymentMix.open+=k:M.paymentMix.unknown+=k;const le=String(R.alias||"").trim();le&&M.aliases.add(le);const Ce=Number(R.units??R.qty??R.quantity);if(Number.isFinite(Ce)&&Ce>0){const U=Number(M.units||0);M.units=Number.isFinite(U)?U+Ce:Ce}const At=String(g.label||"").trim()||"Zahlung",Ft=String(g.date||"").trim()||null,en=g.paid===!0?"paid":g.paid===!1?"open":"unknown",Le=`${At}|${Ft||""}|${en}`;let ne=M.payments.get(Le);ne||(ne={key:`payment:${M.key}:${Le}`,label:At,values:Ve(j),paymentDueDate:Ft,paymentMix:{paid:0,open:0,unknown:0}},M.payments.set(Le,ne)),ne.values[o]+=-k,g.paid===!0?ne.paymentMix.paid+=k:g.paid===!1?ne.paymentMix.open+=k:ne.paymentMix.unknown+=k})});const s=(d,o)=>Array.from(d.values()).sort((a,h)=>ze(h.values)-ze(a.values)).map(a=>{const h=Array.from(a.payments.values()).sort((k,z)=>ze(z.values)-ze(k.values)).map(k=>({key:k.key,label:k.label,values:k.values,rowType:"payment",paymentStatus:Ln(k.paymentMix),paymentDueDate:k.paymentDueDate})),g=Number(a.units);return{key:a.key,label:a.label,values:a.values,rowType:"order",orderType:o,aliases:Array.from(a.aliases),units:Number.isFinite(g)&&g>0?g:null,paymentMix:a.paymentMix,children:h.length?h:void 0}});return{po:s(e["outflows-po"],"po"),fo:s(e["outflows-fo"],"fo"),phantom:s(e["outflows-phantom-fo"],"phantom")}},[q,we,ke,w,j]),Ke=i.useMemo(()=>{const e=new Map(w.map(o=>[o.month,o])),s=o=>{const a=Ve(j);return j.forEach(h=>{a[h]=Number(o(h)||0)}),a};return[{key:"inflows",label:"Einnahmen",rowType:"group",values:s(o=>{var a;return((a=Q.get(o))==null?void 0:a.total)||0}),children:[{key:"inflows-amazon-core",label:"Amazon Kernprodukte",rowType:"category",values:s(o=>{var a;return((a=Q.get(o))==null?void 0:a.amazonCore)||0})},{key:"inflows-amazon-plan",label:"Amazon geplante Produkte",rowType:"category",values:s(o=>{var a;return((a=Q.get(o))==null?void 0:a.amazonPlanned)||0})},{key:"inflows-amazon-new",label:"Amazon neue Produkte",rowType:"category",values:s(o=>{var a;return((a=Q.get(o))==null?void 0:a.amazonNew)||0})},{key:"inflows-other",label:"Sonstige Einzahlungen",rowType:"category",values:s(o=>{var a;return((a=Q.get(o))==null?void 0:a.other)||0})}]},{key:"outflows",label:"Ausgaben",rowType:"group",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.total)||0)}),children:[{key:"outflows-po",label:"PO",rowType:"category",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.po)||0)}),children:ee.po.length?ee.po:void 0},{key:"outflows-fo",label:"FO",rowType:"category",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.fo)||0)}),children:ee.fo.length?ee.fo:void 0},{key:"outflows-phantom-fo",label:"Phantom FO",rowType:"category",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.phantomFo)||0)}),children:ee.phantom.length?ee.phantom:void 0},{key:"outflows-fixcost",label:"Fixkosten",rowType:"category",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.fixcost)||0)})},{key:"outflows-other",label:"Sonstige Auszahlungen",rowType:"category",values:s(o=>{var a;return-(((a=K.get(o))==null?void 0:a.other)||0)})}]},{key:"net",label:"Netto Cashflow",rowType:"total",values:s(o=>{var a;return Number(((a=e.get(o))==null?void 0:a.net)||0)})},{key:"closing",label:"Kontostand",rowType:"total",values:s(o=>{var a;return Number(((a=e.get(o))==null?void 0:a.closing)||0)})}]},[Q,ee,K,w,j]),L=i.useMemo(()=>$n(Ke),[Ke]);i.useEffect(()=>{const e=new Set(L);Fe(s=>s.filter(d=>e.has(d)))},[L]);const Zt=i.useMemo(()=>{if(!L.length)return!1;const e=new Set(de);return L.every(s=>e.has(s))},[L,de]),Gt=i.useCallback(()=>{Fe(e=>{const s=new Set(e);return L.length>0&&L.every(o=>s.has(o))?[]:L.slice()})},[L]),Jt=i.useMemo(()=>[{title:"Position",key:"label",dataIndex:"label",fixed:"left",width:380,render:(e,s)=>{if(s.rowType==="order"){const o=Array.isArray(s.aliases)?s.aliases.filter(Boolean):[],a=o.length>2?`${o.slice(0,2).join(", ")} +${o.length-2}`:o.join(", "),h=s.paymentMix||{paid:0,open:0,unknown:0},g=h.paid+h.open+h.unknown,k=g>0?g:1,z=`${Math.max(0,Math.min(100,h.paid/k*100))}%`,$=`${Math.max(0,Math.min(100,h.open/k*100))}%`,_=`${Math.max(0,Math.min(100,h.unknown/k*100))}%`;return t.jsxs("div",{className:"v2-dashboard-pnl-label-cell",children:[t.jsxs(A,{size:6,wrap:!0,children:[t.jsx(y,{strong:!0,children:s.label}),s.orderType==="phantom"?t.jsx(F,{color:"gold",children:"Phantom"}):null,a?t.jsxs(y,{type:"secondary",children:["Alias: ",a]}):null,Number.isFinite(Number(s.units))&&Number(s.units)>0?t.jsxs(F,{children:["Stk: ",zn(s.units,0)]}):null]}),g>0?t.jsxs("div",{className:"v2-dashboard-pnl-paybar",title:`Bezahlt ${I(h.paid)} · Offen ${I(h.open)} · Unklar ${I(h.unknown)}`,children:[t.jsx("span",{className:"is-paid",style:{width:z}}),t.jsx("span",{className:"is-open",style:{width:$}}),t.jsx("span",{className:"is-unknown",style:{width:_}})]}):null]})}if(s.rowType==="payment"){const o=s.paymentStatus==="paid"?t.jsx(F,{color:"green",children:"Bezahlt"}):s.paymentStatus==="open"?t.jsx(F,{color:"orange",children:"Offen"}):s.paymentStatus==="mixed"?t.jsx(F,{color:"blue",children:"Gemischt"}):t.jsx(F,{children:"Unklar"});return t.jsxs(A,{size:6,wrap:!0,children:[t.jsx(y,{children:s.label}),s.paymentDueDate?t.jsxs(y,{type:"secondary",children:["Fällig: ",An(s.paymentDueDate)]}):null,o]})}const d=s.key==="inflows"||s.key==="outflows"||s.key==="net"||s.key==="closing";return t.jsx(y,{strong:d,children:s.label})}},...j.map(e=>({title:W(e),key:e,width:132,align:"right",render:(s,d)=>{const o=Number(d.values[e]),a=Number.isFinite(o),h=d.key==="closing",g=!h&&a&&o<0,k=h?a?I(o):"-":a?Pt(o):"-",z=h&&Ye.get(e)===!0,$=h&&z;return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-end",width:"100%",gap:4},children:[t.jsx(y,{strong:d.key==="net"||d.key==="closing",type:g?"danger":void 0,children:k}),$?t.jsx(se,{title:"IST-Kontostand Monatsende eingetragen. Dieser Wert ist fixiert und dient als Basis für Folgemonate.",children:t.jsx(Sn,{style:{fontSize:12,color:"rgba(15, 23, 42, 0.62)"}})}):null]})}}))],[Ye,j]);function Xt(){c("next6"),x(Tt.slice()),setRevenueBasisMode(methodikRevenueBasisMode),setCalibrationEnabled(methodikCalibrationEnabled),setQuoteMode("manual")}function Yt(e){if(!f)return;const s=e.month||f.month;if(e.checkKey==="cash_in"){m(Z("/v2/abschluss/eingaben",{source:"dashboard",month:s}));return}if(e.checkKey==="fixcost"){m(Z("/v2/abschluss/fixkosten",{source:"dashboard",month:s}));return}if(e.checkKey==="vat"){m(Z("/v2/abschluss/ust",{source:"dashboard",month:s}));return}if(e.checkKey==="revenue_inputs"&&e.sku){m(Z("/v2/products",{source:"dashboard",issues:"revenue",sku:e.sku}));return}if(e.issueType==="order_duty"&&e.sku){m(Tn({sku:e.sku,month:s,suggestedUnits:e.suggestedUnits??null,requiredArrivalDate:e.requiredArrivalDate||null,recommendedOrderDate:e.recommendedOrderDate||null,source:"inventory_projection",firstRiskMonth:e.firstRiskMonth||null,orderMonth:e.orderMonth||null,leadTimeDays:e.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(e.issueType==="forecast_missing"&&e.sku){m(Lt({sku:e.sku,month:s}));return}if((e.issueType==="stock_oos"||e.issueType==="stock_under_safety")&&e.sku){m(qe({risk:e.issueType==="stock_oos"?"oos":"under_safety",abc:e.abcClass&&(e.abcClass==="A"||e.abcClass==="B")?"ab":"all",month:e.firstRiskMonth||s,sku:e.sku,mode:f.coverage.projectionMode||null}));return}m(Kt({route:e.route,checkKey:e.checkKey,month:s,sku:e.sku||null,mode:f.coverage.projectionMode||null}))}return((zt=(Ct=n.settings)==null?void 0:Ct.featureFlags)==null?void 0:zt.executiveDashboardV2)!==!1?t.jsxs("div",{className:"v2-page",children:[t.jsxs(ye,{className:"v2-intro-card",children:[t.jsxs(an,{gutter:[10,10],className:"v2-page-head",children:[t.jsx($e,{xs:24,xl:12,children:t.jsxs("div",{children:[t.jsx(Re,{level:3,children:"Dashboard"}),t.jsx(Dt,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]})}),t.jsx($e,{xs:24,md:12,xl:6,children:t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(y,{children:"Zeitraum"}),t.jsx(It,{value:p,onChange:e=>c(e),options:Ue.map(e=>({value:e.value,label:e.label})),style:{width:220,maxWidth:"100%"}})]})}),t.jsx($e,{xs:24,md:12,xl:6,children:t.jsxs("div",{className:"v2-toolbar-field",children:[t.jsx(y,{children:"PFO bis"}),t.jsx(It,{value:X||void 0,onChange:e=>E(String(e||"")),options:D.map(e=>({value:e,label:W(e)})),style:{width:220,maxWidth:"100%"},disabled:!D.length})]})})]}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs(y,{type:"secondary",children:["Zeitraum: ",$t," (",j.length," Monate) · PFO bis: ",X?W(X):"—"]})})]}),l?t.jsx(ce,{type:"error",showIcon:!0,message:l}):null,r?t.jsx(ce,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,ut>0?t.jsx(ce,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${ut} FOs prüfen`,description:t.jsx(H,{size:"small",onClick:()=>m("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,t.jsx(rn,{title:f?`Monats-Check: ${W(f.month)}`:"Monats-Check",placement:"right",width:520,open:G&&!!f,onClose:()=>J(!1),destroyOnClose:!1,children:f?t.jsxs(A,{direction:"vertical",size:12,style:{width:"100%"},children:[t.jsxs(A,{wrap:!0,children:[t.jsx(F,{color:(Be==null?void 0:Be.color)||"default",children:f.coverage.statusLabel}),t.jsxs(y,{children:["Coverage ",Bt(f.coverage.ratio*100)," (",f.coverage.coveredSkus,"/",f.coverage.activeSkus,"),"," ","Bestand ",f.coverage.stockIssueCount,","," ","Bestellpflicht ",f.coverage.orderDutyIssueCount,","," ","Blocker ",f.coverage.blockerCount]}),je?t.jsx(F,{children:"Vergangen (Info)"}):null]}),t.jsx(ye,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:t.jsxs(A,{direction:"vertical",size:8,style:{width:"100%"},children:[t.jsxs(A,{wrap:!0,children:[t.jsx(se,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:t.jsx(F,{icon:t.jsx(ue,{}),children:"Coverage"})}),t.jsx(se,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:t.jsx(F,{icon:t.jsx(ue,{}),children:"Blocker"})})]}),qt.map(e=>t.jsxs("div",{className:"v2-dashboard-detail-card",children:[t.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs(y,{strong:!0,children:[En(e.state)," ",e.label]}),e.route?t.jsx(H,{size:"small",onClick:()=>m(Kt({route:e.route,month:f.month,mode:f.coverage.projectionMode})),children:"Öffnen"}):null]}),t.jsx(y,{type:"secondary",children:e.description})]},e.key))]})}),t.jsx(ye,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:f.coverage.statusKey==="full"?t.jsx(ce,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):je?t.jsx(ce,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):t.jsxs(A,{direction:"vertical",size:10,style:{width:"100%"},children:[t.jsxs("div",{children:[t.jsx(y,{strong:!0,children:"1) Blocker"}),f.blockers.length?t.jsx(A,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:f.blockers.map(e=>t.jsxs("div",{className:"v2-dashboard-detail-card",children:[t.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(F,{color:"red",children:"Blocker"}),t.jsx(H,{size:"small",onClick:()=>Yt(e),children:"Öffnen"})]}),t.jsx(y,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(y,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),t.jsxs("div",{children:[t.jsx(y,{strong:!0,children:"2) Warnungen"}),mt.length?t.jsx(A,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:mt.map(e=>t.jsxs("div",{className:"v2-dashboard-detail-card",children:[t.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsx(F,{color:"gold",children:"Warnung"}),t.jsx(H,{size:"small",onClick:()=>m(e.route),children:"Öffnen"})]}),t.jsx(y,{children:e.message})]},e.id))}):t.jsx("div",{children:t.jsx(y,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):t.jsx(y,{type:"secondary",children:"Kein Monat gewählt."})}),t.jsxs("div",{className:"v2-calc-cockpit-shell",children:[t.jsxs("div",{className:"v2-calc-cockpit-status",children:[t.jsxs(A,{wrap:!0,children:[t.jsxs(y,{type:"secondary",children:["Min. Kontostand: ",t.jsx("strong",{children:I(Wt)})]}),t.jsxs(y,{type:"secondary",children:["Summe Netto: ",t.jsx("strong",{children:I(Oe)})]})]}),t.jsx(H,{size:"small",onClick:Xt,children:"Zurücksetzen"})]}),t.jsxs("div",{className:"v2-calc-cockpit-modules",role:"group","aria-label":"Cockpit-Steuerung",children:[t.jsxs("div",{className:"v2-calc-cockpit-module",children:[t.jsxs(A,{size:6,children:[t.jsx(y,{strong:!0,children:"Portfolio-Scope"}),t.jsx(se,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:t.jsx(ue,{})})]}),t.jsx("div",{children:t.jsx(y,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx("div",{className:"v2-calc-cockpit-toggle-list",children:Nn.map(e=>{const s=b.includes(e.value),d=s&&b.length<=1;return t.jsxs("div",{className:"v2-calc-cockpit-toggle-row",children:[t.jsx(y,{children:e.label}),t.jsx(_e,{size:"small",value:s?"on":"off",onChange:o=>_t(e.value,String(o)==="on"),options:[{label:"An",value:"on"},{label:"Aus",value:"off",disabled:d}]})]},e.value)})}),t.jsx(y,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard. Mindestens eine Produktgruppe bleibt aktiv."})]}),t.jsxs("div",{className:"v2-calc-cockpit-module",children:[t.jsxs(A,{size:6,children:[t.jsx(y,{strong:!0,children:"Umsatzbasis"}),t.jsx(se,{title:"Plan-Umsatz (Hybrid): MANUELL-Monate nutzen deine Overrides, AUTO-Monate kommen aus der Absatzprognose.",children:t.jsx(ue,{})})]}),t.jsx("div",{children:t.jsx(y,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(_e,{block:!0,value:xe,onChange:e=>{const s=String(e)==="forecast_direct"?"forecast_direct":"hybrid";Ie({cashInRevenueBasisMode:s}).catch(()=>{})},options:[{label:"Plan-Umsatz (Hybrid)",value:"hybrid"},{label:"Forecast-Umsatz (direkt)",value:"forecast_direct"}]}),t.jsxs(A,{size:8,align:"center",wrap:!0,children:[t.jsx(y,{strong:!0,children:"Kalibrierung"}),t.jsx(xn,{size:"small",checked:me,onChange:e=>{Ie({cashInCalibrationEnabled:e}).catch(()=>{})}}),t.jsx(se,{title:"Kalibrierung wirkt nur auf automatische Monate. Manuelle Monatswerte bleiben unverändert.",children:t.jsx(ue,{})}),t.jsx(H,{size:"small",type:"link",onClick:()=>m("/v2/abschluss/eingaben"),children:"Cash-in Setup öffnen"})]}),xe==="forecast_direct"?t.jsx(y,{type:"secondary",children:"Referenzmodus: manuelle Umsatz-Overrides werden ignoriert."}):null,it?t.jsx(y,{type:"warning",children:it}):null]}),t.jsxs("div",{className:"v2-calc-cockpit-module",children:[t.jsxs(A,{size:6,children:[t.jsx(y,{strong:!0,children:"Amazon Auszahlungsquote"}),t.jsx(se,{title:"Manuell nutzt deine Monatswerte. Empfohlen (Plan) berechnet die Quote aus Niveau, Saisonmuster und Sicherheitsmarge.",children:t.jsx(ue,{})})]}),t.jsx("div",{children:t.jsx(y,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),t.jsx(_e,{block:!0,value:ve,onChange:e=>{const s=String(e)==="recommendation"?"recommendation":"manual";Ie({cashInQuoteMode:s}).catch(()=>{})},options:[{label:"Manuell",value:"manual"},{label:"Empfohlen (Plan)",value:"recommendation"}]}),ve==="manual"?t.jsx(y,{type:"secondary",children:"Nutzt deine Monatswerte aus dem Tab Cash-in Setup."}):t.jsx(y,{type:"secondary",children:"Basiert auf aktuellem Niveau + Saisonmuster - Sicherheitsmarge."}),t.jsx(H,{size:"small",type:"link",onClick:()=>m("/v2/sandbox"),children:"Sandbox öffnen"})]})]})]}),t.jsxs(ye,{className:"v2-dashboard-chart-card",children:[t.jsx(Re,{level:4,children:"Kontostand & Cashflow"}),t.jsxs("div",{className:"v2-dashboard-chart-summary",children:[t.jsxs(F,{color:"green",children:["Einzahlungen: ",I(Ut)]}),t.jsxs(F,{color:"red",children:["Auszahlungen: ",I(Vt)]}),t.jsxs(F,{color:Oe>=0?"green":"red",children:["Netto: ",I(Oe)]}),ae.length?t.jsxs(F,{color:"gold",children:["PFO: ",ae.length]}):null,X?t.jsxs(F,{color:"gold",children:["bis ",W(X)]}):null]}),t.jsx(y,{type:"secondary",className:"v2-dashboard-chart-hint",children:"Klick auf Monat oder Balken für Details. Legende ist scrollbar."}),t.jsx(cn,{style:{height:430},option:Ht,onEvents:Qt})]}),t.jsxs(ye,{children:[t.jsxs(A,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[t.jsxs("div",{children:[t.jsx(Re,{level:4,children:"Monatliche PnL (Matrix)"}),t.jsx(Dt,{type:"secondary",children:"Zeilen = Einnahmen/Ausgaben-Struktur, Spalten = gewählter Zeitraum. Bei PO/FO/Phantom siehst du auf Wunsch die einzelnen Zahlungen."})]}),t.jsx(H,{size:"small",onClick:Gt,children:Zt?"Alles zuklappen":"Alles aufklappen"})]}),t.jsx(vn,{className:"v2-ant-table v2-dashboard-pnl-table",columns:Jt,dataSource:Ke,pagination:!1,size:"small",rowKey:"key",rowClassName:e=>e.rowType==="order"?"v2-dashboard-pnl-table-row-order":e.rowType==="payment"?"v2-dashboard-pnl-table-row-payment":e.key==="net"||e.key==="closing"?"v2-dashboard-pnl-table-row-total":Array.isArray(e.children)&&e.children.length?"v2-dashboard-pnl-table-row-group":"v2-dashboard-pnl-table-row-detail",expandable:{expandedRowKeys:de,onExpandedRowsChange:e=>Fe(e.map(s=>String(s)))},scroll:{x:"max-content"}})]})]}):t.jsx("div",{className:"v2-page",children:t.jsx(ce,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{ps as default};
