import{aa as tn,I as nn,t as l,af as sn,k as t,T as me,K as rn,L as b,a7 as Ht,N as I,M as Fe,S as Ge,V as on}from"./index-o-D_rC2a.js";import{b as an}from"./abcClassification-Czyc8_9u.js";import{r as ln,a as cn,c as un,g as re}from"./inventoryProjection-B9saLoLy.js";import{D as Ft}from"./DataTable-Bmr5ONUk.js";import{S as dn}from"./StatsTableShell-BXhs60qu.js";import{S as hn}from"./SkuAliasCell-C0LCWFyE.js";import{c as oe,n as D,a as mn,b as fn,f as J,d as ae}from"./months-BTPgK-LH.js";import{b as pn,c as gn,s as yn}from"./categoryOrder-C77cYWrY.js";import{e as jn,a as bn}from"./forecastVersioning-Bk55l2iS.js";import{b as vn,r as kn,c as Sn}from"./orderUtils-DW9cnzFm.js";import{h as Ot,g as Pt,s as It}from"./uiPrefs-CxTlE9qM.js";import{u as xn,C as Qe}from"./workspace-CYYiY6ES.js";import{a as Lt}from"./index-D__V-sQj.js";import{S as zt}from"./index-CPjrUd6P.js";import{C as Cn}from"./index-DS8YiSJw.js";import{R as Oe}from"./index-D3_9UGQr.js";import{R as Mn}from"./InfoCircleOutlined-DtAgElT9.js";import{C as Et}from"./Collapse-B9_KsoXW.js";const{Paragraph:An,Text:m,Title:Ze}=rn,_t=[6,12,18];function Nn(o){if(!o||typeof o!="object")return{toVersionId:null,foConflictsOpen:0};const i=o;return{toVersionId:i.toVersionId==null?null:String(i.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(i.foConflictsOpen||0)))}}function Un(o){(!o.inventory||typeof o.inventory!="object")&&(o.inventory={snapshots:[],settings:{projectionMonths:12,safetyDays:60}});const i=o.inventory;Array.isArray(i.snapshots)||(i.snapshots=[]),(!i.settings||typeof i.settings!="object")&&(i.settings={projectionMonths:12,safetyDays:60})}function W(o){const i=Number(o);return Number.isFinite(i)?Math.max(0,Math.round(i)):0}function Bt(o){return String(W(o))}function Dn(o){return String(o||"").replace(/[^\d]/g,"")}function Kt({sku:o,field:i,value:d,onCommit:c}){const[v,M]=l.useState(()=>Bt(d)),[S,N]=l.useState(!1);l.useEffect(()=>{S||M(Bt(d))},[S,d]);const B=l.useCallback(()=>{const E=W(d),R=W(v);if(R===E){M(String(E));return}c({sku:o,field:i,value:R}),M(String(R))},[v,i,c,o,d]);return t.jsx(Ht,{className:"v2-grid-input",value:v,inputMode:"numeric",autoComplete:"off",style:{width:"100%"},"data-snapshot-editor":"units","data-snapshot-sku":o,"data-snapshot-field":i,onFocus:()=>N(!0),onBlur:()=>{N(!1),B()},onChange:E=>{M(Dn(E.target.value))},onKeyDown:E=>{if(E.key!=="Enter")return;E.preventDefault(),B();const R=E.currentTarget,le=Array.from(document.querySelectorAll("input[data-snapshot-editor='units']")),A=le.indexOf(R),G=A>=0?le[A+1]:null;G?(G.focus(),G.select()):R.blur()}})}function j(o){return Number.isFinite(o)?Math.round(Number(o)).toLocaleString("de-DE"):"—"}function ie(o){if(!o)return"—";const[i,d,c]=String(o).split("-").map(Number);if(!i||!d||!c)return"—";const v=new Date(Date.UTC(i,d-1,c));return Number.isNaN(v.getTime())?"—":v.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function Je(o){const i={};return Array.isArray(o)&&o.forEach(d=>{const c=d||{},v=String(c.sku||"").trim();v&&(i[v]={amazonUnits:W(c.amazonUnits),threePLUnits:W(c.threePLUnits),note:String(c.note||"")})}),i}function wn(){return new Date().toISOString()}function Fn(o,i){var M;const d=((M=o.inventory)==null?void 0:M.snapshots)||[],c=D(i);return c&&d.find(S=>D(S.month)===c)||null}function Rt(o,i){var M;const d=D(i);if(!d)return null;const c=(((M=o.inventory)==null?void 0:M.snapshots)||[]).map(S=>S).filter(S=>D(S.month)).sort((S,N)=>String(D(S.month)).localeCompare(String(D(N.month))));let v=null;return c.forEach(S=>{const N=D(S.month);N&&N<d&&(v=S)}),v}function On(o){var d;const i=(((d=o.inventory)==null?void 0:d.snapshots)||[]).map(c=>D(c.month)).filter(Boolean);return i.length?(i.sort((c,v)=>c.localeCompare(v)),i[i.length-1]||null):null}function $t(o,i){const d=new Map;o.forEach(v=>{var S;const M=v.categoryLabel||"Ohne Kategorie";d.has(M)||d.set(M,[]),(S=d.get(M))==null||S.push(v)});const c=Array.from(d.entries()).map(([v,M])=>({key:v,label:v,rows:M.sort((S,N)=>{const B=S.alias.localeCompare(N.alias,"de-DE",{sensitivity:"base"});return B!==0?B:S.sku.localeCompare(N.sku,"de-DE",{sensitivity:"base"})})}));return yn(c,i)}function Pn(o){return/^\d{4}-\d{2}$/.test(o)?`${o}-01`:null}function Pe(o){const i=Number(o);return!Number.isFinite(i)||i<=0?null:i}function In(o,i){var B;const d=Pe(o==null?void 0:o.productionLeadTimeDaysDefault)??Pe(i.defaultProductionLeadTimeDays)??45,c=(B=o==null?void 0:o.template)==null?void 0:B.fields,v=String((c==null?void 0:c.transportMode)??(o==null?void 0:o.transportMode)??"sea").toLowerCase(),M=i.transportLeadTimesDays||{},S=Pe(M[v])??Pe(M.sea)??45,N=Number(i.defaultBufferDays??0);return Math.max(0,Math.round(d+S+(Number.isFinite(N)?N:0)))}function Ln(o){return o==="doh"?"DOH zeigt die Reichweite des projizierten Monatsendbestands in Tagen.":o==="plan"?"Plan zeigt den geplanten Monatsabsatz (Forecast) je SKU.":"Units zeigt den projizierten Monatsendbestand je SKU inklusive Inbound-Wirkung."}function Tt(o){return o==="revenue_6m"?"ABC-Basis: Umsatz (6 Monate)":o==="units_6m_fallback"?"ABC-Basis: Units-Fallback (6 Monate)":"ABC-Basis: keine Forecast-Daten"}function zn(o,i){const d=String(o||"C").toUpperCase();return i==="safety-negative"?d==="A"?6:d==="B"?4:2:i==="safety-low"?d==="A"?3:d==="B"?2:1:0}function En(o){const i=String(o||"").trim().toLowerCase();return i==="oos"?"oos":i==="under_safety"?"under_safety":"all"}function Bn(o){const i=String(o||"").trim().toLowerCase();return i==="a"?"a":i==="b"?"b":i==="ab"?"ab":i==="abc"?"abc":"all"}function Xe(o){const i=Number(o);if(!Number.isFinite(i))return 12;const d=Math.round(i);return _t.includes(d)?d:d<9?6:d<15?12:18}function Kn(o){const i=String(o||"").trim().toLowerCase();return i==="doh"?"doh":i==="plan"?"plan":"units"}function Ye(o){const i=String(o||"").trim().toUpperCase();return i==="A"||i==="B"||i==="C"?i:null}function Rn(o){const i=Ye(o);return i==="A"?0:i==="B"?1:i==="C"?2:3}function $n(o,i){if(i==="all")return!0;const d=Ye(o);return i==="a"?d==="A":i==="b"?d==="B":i==="ab"?d==="A"||d==="B":d!=null}function Tn(o){if(!o)return t.jsx(m,{type:"secondary",children:"Kein Inbound in diesem Monat."});const i=Array.isArray(o.poItems)?o.poItems:[],d=Array.isArray(o.foItems)?o.foItems:[];return t.jsxs("div",{style:{minWidth:260,maxWidth:340},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx(m,{strong:!0,children:"PO Inbound"}),i.length?t.jsx("div",{children:i.map(c=>t.jsx("div",{children:t.jsxs(m,{children:[c.ref," · +",j(c.units)," · ",ie(c.arrivalDate)]})},`po-${c.id}-${c.ref}-${c.units}-${c.arrivalDate}`))}):t.jsx(m,{type:"secondary",children:" Keine PO-Ankunft"})]}),t.jsxs("div",{children:[t.jsx(m,{strong:!0,children:"FO Inbound"}),d.length?t.jsx("div",{children:d.map(c=>t.jsx("div",{children:t.jsxs(m,{children:[c.ref," · +",j(c.units)," · ",ie(c.arrivalDate)]})},`fo-${c.id}-${c.ref}-${c.units}-${c.arrivalDate}`))}):t.jsx(m,{type:"secondary",children:" Keine FO-Ankunft"})]})]})}function is({view:o="both"}={}){const i=tn(),d=nn(),{state:c,loading:v,saving:M,error:S,lastSavedAt:N,saveWith:B}=xn(),E=Ot("inventory_snapshot"),R=Ot("inventory_projection"),le=l.useRef(!1),[A,G]=l.useState(()=>oe()),[et,tt]=l.useState(!1),[Ie,Le]=l.useState({}),[nt,fe]=l.useState(!1),[k,st]=l.useState("units"),[ze,rt]=l.useState(""),[Ee,qt]=l.useState(!0),[X,pe]=l.useState("all"),[Q,Y]=l.useState("all"),[Z,ot]=l.useState(12),[ge,ye]=l.useState(()=>Pt("inventory_snapshot")),[je,ce]=l.useState(()=>Pt("inventory_projection")),[L,be]=l.useState(null),[ve,at]=l.useState(null),[it,lt]=l.useState(!1),[ee,ct]=l.useState(null),[ut,Be]=l.useState(!1),[Ke,Re]=l.useState(null),[te,$e]=l.useState(null),$=o!=="projection",z=o!=="snapshot",w=c,ke=c.inventory||{},dt=ke.settings||{},Te=c.settings||{},ht=c.forecast&&typeof c.forecast=="object"?c.forecast:{},Se=l.useMemo(()=>{const e=structuredClone(ht||{});return jn(e),e},[ht]),Vt=l.useMemo(()=>bn(Se),[Se]),He=Nn(Se.lastImpactSummary),mt=String(Se.activeVersionId||"").trim()||null,xe=He.toVersionId&&mt&&He.toVersionId===mt?He.foConflictsOpen:0;l.useEffect(()=>{if(le.current)return;const e=new URLSearchParams(i.search);if(e.get("source")!=="dashboard")return;le.current=!0;const s=String(e.get("sku")||"").trim();s?(rt(s),ct(s),Be(!1)):(ct(null),Be(!0),Re(null));const n=D(e.get("month"));n&&at(n),pe(En(e.get("risk"))),Y(Bn(e.get("abc"))),e.has("mode")&&st(Kn(e.get("mode"))),e.get("expand")==="all"&&lt(!0)},[i.search]);const _=l.useMemo(()=>{const e=new Set;return e.add(oe()),(Array.isArray(ke.snapshots)?ke.snapshots:[]).forEach(s=>{const r=D(s.month);r&&e.add(r)}),Array.from(e).sort()},[ke.snapshots]),Ce=l.useMemo(()=>On(w),[c.inventory]);l.useEffect(()=>{_.includes(A)||(G(Ce||_[_.length-1]||oe()),tt(!1))},[Ce,_,A]),l.useEffect(()=>{if(et)return;const e=Ce||_[_.length-1]||oe();e&&e!==A&&G(e)},[Ce,_,A,et]),l.useEffect(()=>{const e=Fn(w,A),s=Je((e==null?void 0:e.items)||[]);Le(s),fe(!1)},[A,w]),l.useEffect(()=>{const e=Number(dt.projectionMonths);Number.isFinite(e)&&e>0&&ot(Xe(e))},[dt.projectionMonths]);const ft=l.useMemo(()=>{const e=new Map;return(Array.isArray(c.productCategories)?c.productCategories:[]).forEach(s=>{const n=s,r=String(n.id||"");r&&e.set(r,String(n.name||"Ohne Kategorie"))}),e},[c.productCategories]),ne=l.useMemo(()=>pn(w),[c.productCategories]),_e=l.useMemo(()=>an(w).bySku,[c]),pt=l.useMemo(()=>(Array.isArray(c.products)?c.products:[]).map(e=>e).map(e=>({sku:String(e.sku||"").trim(),raw:e})).filter(e=>e.sku),[c.products]);l.useMemo(()=>new Map(pt.map(e=>[e.sku,e.raw])),[pt]);const se=l.useMemo(()=>Rt(w,A),[A,w]),gt=l.useMemo(()=>Je((se==null?void 0:se.items)||[]),[se==null?void 0:se.items]),yt=l.useMemo(()=>(Array.isArray(c.products)?c.products:[]).map(s=>{const n=s,r=String(n.sku||"").trim();if(!r)return null;const a=String(n.alias||r),u=String(n.status||"").trim().toLowerCase(),h=sn(n.includeInForecast,!0)&&(!u||u==="active"||u==="aktiv"),f=ft.get(String(n.categoryId||""))||"Ohne Kategorie",g=Ie[r]||{amazonUnits:0,threePLUnits:0},y=gt[r]||{amazonUnits:0,threePLUnits:0},x=g.amazonUnits+g.threePLUnits,O=y.amazonUnits+y.threePLUnits,K=ln(n,w),P=cn(n,w),H=_e.get(r.toLowerCase())||_e.get(r)||null,De=(H==null?void 0:H.abcClass)??null,we=(H==null?void 0:H.abcBasis)||"no_data";return{sku:r,alias:a,categoryLabel:f,abcClass:De,abcBasis:we,isActive:h,amazonUnits:g.amazonUnits,threePLUnits:g.threePLUnits,totalUnits:x,delta:x-O,safetyDays:Number.isFinite(K)?Number(K):null,coverageDays:Number.isFinite(P)?Number(P):null}}).filter(Boolean),[_e,ft,gt,Ie,c.products,w]),U=l.useMemo(()=>{const e=ze.trim().toLowerCase();return yt.filter(s=>Ee&&!s.isActive||!$n(s.abcClass,Q)?!1:e?[s.sku,s.alias,s.categoryLabel,s.abcClass||""].join(" ").toLowerCase().includes(e):!0).sort((s,n)=>{const r=gn(s.categoryLabel,n.categoryLabel,ne);if(r!==0)return r;const a=s.alias.localeCompare(n.alias,"de-DE",{sensitivity:"base"});return a!==0?a:s.sku.localeCompare(n.sku,"de-DE",{sensitivity:"base"})})},[Q,yt,ne,Ee,ze]),T=l.useMemo(()=>$t(U,ne),[ne,U]);l.useEffect(()=>{$&&ye(e=>{if(!T.length)return[];const s=new Set(T.map(r=>r.key)),n=e.filter(r=>s.has(r));return n.length||E?n:T.map(r=>r.key)})},[T,E,$]),l.useEffect(()=>{It("inventory_snapshot",ge)},[ge]),l.useEffect(()=>{It("inventory_projection",je)},[je]);const ue=oe(),jt=l.useMemo(()=>mn(ue,-1),[ue]),C=l.useMemo(()=>fn(ue,Z),[ue,Z]),p=l.useMemo(()=>un({state:w,months:C,products:U.map(e=>({sku:e.sku,alias:e.alias,status:e.isActive?"active":"inactive",safetyStockDohOverride:e.safetyDays,foCoverageDohOverride:e.coverageDays})),snapshot:null,snapshotMonth:jt,projectionMode:k}),[U,jt,k,C,w]),bt=l.useMemo(()=>vn(w),[c.forecast,c.inventory,c.pos,c.fos]),q=l.useMemo(()=>{const e=new Set,s=new Set;let n=null,r=null;return U.forEach(a=>{C.forEach(u=>{var g;const h=(g=p.perSkuMonth.get(a.sku))==null?void 0:g.get(u);if(!h)return;const f=re({projectionMode:k,endAvailable:h.endAvailable,safetyUnits:h.safetyUnits,doh:h.doh,safetyDays:h.safetyDays});f&&(e.add(a.sku),(!n||u<n)&&(n=u),f==="safety-negative"&&(s.add(a.sku),(!r||u<r)&&(r=u)))})}),{underSafetySkus:e.size,oosSkus:s.size,criticalMonth:r||n,missingEta:Number(p.inboundMissingDateCount||0)}},[U,p,k,C]),de=l.useMemo(()=>{const e=new Map;return C.forEach(s=>{e.set(s,{month:s,score:0,oosCount:0,underSafetyCount:0,criticalSkus:new Set})}),U.forEach(s=>{C.forEach(n=>{var h;const r=(h=p.perSkuMonth.get(s.sku))==null?void 0:h.get(n);if(!r)return;const a=re({projectionMode:k,endAvailable:r.endAvailable,safetyUnits:r.safetyUnits,doh:r.doh,safetyDays:r.safetyDays});if(!a)return;const u=e.get(n);u&&(u.score+=zn(s.abcClass,a),u.underSafetyCount+=1,a==="safety-negative"&&(u.oosCount+=1),u.criticalSkus.add(s.sku))})}),e},[U,p,k,C]),vt=l.useMemo(()=>{const e=Array.from(de.values()).map(s=>Number(s.score||0));return e.length?Math.max(...e,0):0},[de]),kt=l.useMemo(()=>{const e=new Map;return U.forEach(s=>{let n=!1,r=!1;C.forEach(a=>{var f;const u=(f=p.perSkuMonth.get(s.sku))==null?void 0:f.get(a);if(!u)return;const h=re({projectionMode:k,endAvailable:u.endAvailable,safetyUnits:u.safetyUnits,doh:u.doh,safetyDays:u.safetyDays});h&&(r=!0,h==="safety-negative"&&(n=!0))}),e.set(s.sku,{hasOos:n,hasUnderSafety:r})}),e},[U,p,k,C]),he=l.useMemo(()=>X==="all"?U:U.filter(e=>{const s=kt.get(e.sku);return s?X==="oos"?s.hasOos:s.hasUnderSafety:!1}),[U,kt,X]),Me=l.useMemo(()=>$t(he,ne),[ne,he]),Ae=l.useMemo(()=>{var e;return L?((e=de.get(L))==null?void 0:e.criticalSkus)||new Set:null},[L,de]),F=l.useMemo(()=>!L||!Ae||!Ae.size?Me:Me.map(e=>({...e,rows:e.rows.filter(s=>Ae.has(s.sku))})).filter(e=>e.rows.length>0),[Me,Ae,L]);function St(e,s,n,r){const a=kn(Array.isArray(c.products)?c.products:[],e.sku),u=In(a,Te),h=Sn({context:bt,sku:e.sku,leadTimeDays:u,product:a,settings:Te,horizonMonths:Math.max(6,Z),requiredArrivalMonth:s}),f=String((h==null?void 0:h.status)||""),g=Number((h==null?void 0:h.recommendedUnits)||0),y=Math.max(0,Math.ceil(Number(n.safetyUnits||0)-Number(n.endAvailable||0))),x=Math.max(0,Math.round(Number.isFinite(g)&&g>0?g:y)),O=String((h==null?void 0:h.requiredArrivalDate)||Pn(s)||"")||null,K=String((h==null?void 0:h.orderDateAdjusted)||(h==null?void 0:h.orderDate)||"")||null;return{cellKey:r,row:e,month:s,data:n,recommendedUnits:x,requiredArrivalDate:O,recommendedOrderDate:K,recommendation:h,recommendationStatus:f}}const Ne=l.useMemo(()=>{if(k==="plan")return new Map;const e=new Map;return he.forEach(s=>{var h,f;let n=null;for(const g of C){const y=(h=p.perSkuMonth.get(s.sku))==null?void 0:h.get(g);if(!y)continue;const x=re({projectionMode:k,endAvailable:y.endAvailable,safetyUnits:y.safetyUnits,doh:y.doh,safetyDays:y.safetyDays});if(x==="safety-negative"||x==="safety-low"){n=g;break}}if(!n)return;const r=(f=p.perSkuMonth.get(s.sku))==null?void 0:f.get(n);if(!r)return;const a=`${s.sku}|${n}`,u=St(s,n,r,a);u.recommendationStatus!=="ok"||u.recommendedUnits<=0||e.set(a,u)}),e},[p,k,C,he,Z,bt,Te,c.products]),V=l.useMemo(()=>{const e=Array.from(Ne.values()).map(s=>{const n=re({projectionMode:k,endAvailable:s.data.endAvailable,safetyUnits:s.data.safetyUnits,doh:s.data.doh,safetyDays:s.data.safetyDays});if(n!=="safety-negative"&&n!=="safety-low")return null;const r=Ye(s.row.abcClass),a=s.month,u=Number(String(a||"").replace("-","")),h=n==="safety-negative"?-.5:0,f=Rn(r)*1e3+(Number.isFinite(u)?u:999999)+h;return{key:`${s.row.sku}|${s.month}`,sku:s.row.sku,alias:s.row.alias,abcClass:r,month:a,riskClass:n,recommendedUnits:s.recommendedUnits,requiredArrivalDate:s.requiredArrivalDate,recommendedOrderDate:s.recommendedOrderDate,priority:f,intent:s}}).filter(Boolean);return e.sort((s,n)=>{if(s.priority!==n.priority)return s.priority-n.priority;if(s.month!==n.month)return s.month.localeCompare(n.month);const r=Number(n.recommendedUnits||0)-Number(s.recommendedUnits||0);return r!==0?r:s.sku.localeCompare(n.sku,"de-DE",{sensitivity:"base"})}),e},[Ne,k]);l.useEffect(()=>{L&&!C.includes(L)&&be(null)},[C,L]),l.useEffect(()=>{ve&&C.length&&(C.includes(ve)&&be(ve),at(null))},[ve,C]),l.useEffect(()=>{z&&ce(e=>{if(!F.length)return[];const s=new Set(F.map(r=>r.key)),n=e.filter(r=>s.has(r));return n.length||R?n:F.map(r=>r.key)})},[R,F,z]),l.useEffect(()=>{!z||!it||F.length&&(ce(F.map(e=>e.key)),lt(!1))},[it,F,z]),l.useEffect(()=>{if(!z||!ee||ut)return;const e=`v2-proj-sku-${encodeURIComponent(ee)}`,s=ee.toLowerCase(),n=Array.from(document.querySelectorAll("[data-proj-sku-key]")).find(a=>String(a.dataset.projSkuKey||"")===s)||document.getElementById(e);if(!(n instanceof HTMLElement))return;n.scrollIntoView({behavior:"smooth",block:"center"}),Re(ee),Be(!0);const r=window.setTimeout(()=>{Re(a=>a&&(a.toLowerCase()===ee.toLowerCase()?null:a))},2200);return()=>window.clearTimeout(r)},[ut,ee,F,z]);function xt(e,s,n,r){$e(St(e,s,n,r))}function Ue(e,s){if(!e)return;const n=new URLSearchParams;n.set("source","inventory_projection"),n.set("sku",e.row.sku),n.set("month",e.month),n.set("suggestedUnits",String(e.recommendedUnits||0)),n.set("projectedEnd",String(Math.round(Number(e.data.endAvailable||0)))),n.set("mode",k),e.requiredArrivalDate&&n.set("requiredArrivalDate",e.requiredArrivalDate),e.recommendedOrderDate&&n.set("recommendedOrderDate",e.recommendedOrderDate),n.set("returnTo","/v2/inventory/projektion");const r=(s==null?void 0:s.nextIntent)||null;r&&(n.set("nextSku",r.row.sku),n.set("nextMonth",r.month),n.set("nextSuggestedUnits",String(r.recommendedUnits||0)),r.requiredArrivalDate&&n.set("nextRequiredArrivalDate",r.requiredArrivalDate),r.recommendedOrderDate&&n.set("nextRecommendedOrderDate",r.recommendedOrderDate)),d(`/v2/orders/fo?${n.toString()}`),$e(null)}function Wt(e){var s,n,r,a,u,h,f,g,y,x,O,K,P,H,De,we,Dt,wt;return t.jsxs("div",{className:"v2-proj-action-menu",children:[t.jsx(m,{strong:!0,children:e.row.alias}),t.jsx(m,{type:"secondary",children:e.row.sku}),t.jsx(m,{type:"secondary",children:J(e.month)}),t.jsxs(m,{children:["Bestand EOM: ",t.jsx("strong",{children:j(e.data.endAvailable)})]}),t.jsxs(m,{children:["Safety: ",t.jsx("strong",{children:j(e.data.safetyUnits)})]}),t.jsxs(m,{children:["Ankunft: ",t.jsx("strong",{children:ie(e.requiredArrivalDate)})]}),t.jsxs(m,{children:["Bestellen bis: ",t.jsx("strong",{children:ie(e.recommendedOrderDate)})]}),t.jsxs(m,{children:["Vorschlag: ",t.jsx("strong",{children:j(e.recommendedUnits)})]}),e.recommendationStatus!=="ok"?t.jsx(m,{type:"warning",children:"Hinweis: Empfehlung ist nicht vollständig belastbar."}):null,Number(((s=e.recommendation)==null?void 0:s.coverageDaysForOrder)||0)>0?t.jsxs(m,{type:"secondary",children:["Bedarf (",j(Number(((n=e.recommendation)==null?void 0:n.coverageDaysForOrder)||0))," Tage): ",j(Number(((r=e.recommendation)==null?void 0:r.coverageDemandUnits)||0))]}):null,(a=e.recommendation)!=null&&a.moqApplied?t.jsxs(m,{type:"warning",children:["MOQ angewendet: kalkulatorisch ",j(Number(((u=e.recommendation)==null?void 0:u.recommendedUnitsRaw)||0))," → MOQ ",j(Number(((h=e.recommendation)==null?void 0:h.unitsAfterMoq)||0))]}):null,Number(((f=e.recommendation)==null?void 0:f.unitsPerCarton)||0)>1?t.jsxs(m,{type:"secondary",children:["Kartonbasis: ",j(Number(((g=e.recommendation)==null?void 0:g.unitsPerCarton)||0))," Units/Karton",Number(((y=e.recommendation)==null?void 0:y.recommendedCartons)||0)>0?` · ${j(Number(((x=e.recommendation)==null?void 0:x.recommendedCartons)||0))} Kartons`:""]}):null,(O=e.recommendation)!=null&&O.cartonRoundingApplied?t.jsxs(m,{type:"secondary",children:["Karton-Aufrundung: ",j(Number(((K=e.recommendation)==null?void 0:K.unitsAfterMoq)||0))," → ",j(Number(((P=e.recommendation)==null?void 0:P.unitsAfterCartonRounding)||0))]}):null,(H=e.recommendation)!=null&&H.blockRoundupApplied?t.jsxs(m,{type:"warning",children:["Block-Roundup (",j(Number(((De=e.recommendation)==null?void 0:De.roundupCartonBlock)||0))," ","Kartons, max"," ",Number(((we=e.recommendation)==null?void 0:we.roundupMaxPct)||0).toLocaleString("de-DE",{maximumFractionDigits:2}),"%):"," ",j(Number(((Dt=e.recommendation)==null?void 0:Dt.unitsAfterCartonRounding)||0))," → ",j(Number(((wt=e.recommendation)==null?void 0:wt.recommendedUnits)||0))]}):null,t.jsx("div",{className:"v2-actions-inline",children:t.jsx(I,{size:"small",type:"primary",onClick:()=>Ue(e),children:"FO erstellen"})})]})}const qe=l.useCallback(e=>{const s=W(e.value);Le(n=>{const r=n[e.sku]||{amazonUnits:0,threePLUnits:0,note:""};return r[e.field]===s?n:{...n,[e.sku]:{...r,[e.field]:s}}}),fe(!0)},[]),Gt=l.useMemo(()=>[{header:"Alias",accessorKey:"alias",meta:{width:270,minWidth:250},cell:({row:e})=>t.jsx(hn,{alias:e.original.alias,sku:e.original.sku})},{header:"ABC",accessorKey:"abcClass",meta:{width:72,align:"center"},cell:({row:e})=>t.jsx(me,{title:Tt(e.original.abcBasis),children:t.jsx("span",{children:e.original.abcClass||"—"})})},{header:"Amazon",accessorKey:"amazonUnits",meta:{width:116,align:"right"},cell:({row:e})=>t.jsx(Kt,{sku:e.original.sku,field:"amazonUnits",value:e.original.amazonUnits,onCommit:qe})},{header:"3PL",accessorKey:"threePLUnits",meta:{width:116,align:"right"},cell:({row:e})=>t.jsx(Kt,{sku:e.original.sku,field:"threePLUnits",value:e.original.threePLUnits,onCommit:qe})},{header:"Total",accessorKey:"totalUnits",meta:{width:92,align:"right"},cell:({row:e})=>j(e.original.totalUnits)},{header:"Delta",accessorKey:"delta",meta:{width:92,align:"right"},cell:({row:e})=>t.jsx("span",{className:e.original.delta<0?"v2-negative":"",children:j(e.original.delta)})},{header:"Safety DOH",accessorKey:"safetyDays",meta:{width:96,align:"right"},cell:({row:e})=>j(e.original.safetyDays)},{header:"Coverage DOH",accessorKey:"coverageDays",meta:{width:108,align:"right"},cell:({row:e})=>j(e.original.coverageDays)}],[qe]),Ct=Array.isArray(p.anchorForecastGapSkus)?p.anchorForecastGapSkus:[],Mt=Array.isArray(p.anchorSkuFallbackSkus)?p.anchorSkuFallbackSkus:[],At=Array.isArray(p.anchorSkuMissingHistory)?p.anchorSkuMissingHistory:[],Nt=l.useMemo(()=>new Set(Mt.map(e=>String(e||"").trim())),[Mt]),Ut=l.useMemo(()=>new Set(At.map(e=>String(e||"").trim())),[At]),Qt=l.useMemo(()=>{const e=[{header:"Alias",accessorKey:"alias",meta:{width:270,minWidth:250},cell:({row:n})=>t.jsxs("div",{id:`v2-proj-sku-${encodeURIComponent(n.original.sku)}`,"data-proj-sku-key":n.original.sku.toLowerCase(),className:["v2-proj-alias",Ke&&n.original.sku.toLowerCase()===Ke.toLowerCase()?"v2-proj-alias--highlight":""].filter(Boolean).join(" "),children:[t.jsx("div",{className:"v2-proj-alias-main",title:n.original.alias,children:n.original.alias}),t.jsx(m,{className:"v2-proj-sku-secondary",type:"secondary",title:n.original.sku,children:n.original.sku})]})},{header:"ABC",accessorKey:"abcClass",meta:{width:68,align:"center"},cell:({row:n})=>t.jsx(me,{title:Tt(n.original.abcBasis),children:t.jsx("span",{children:n.original.abcClass||"—"})})},{header:"Safety DOH",accessorKey:"safetyDays",meta:{width:96,align:"right"},cell:({row:n})=>j(n.original.safetyDays)},{header:"Coverage DOH",accessorKey:"coverageDays",meta:{width:110,align:"right"},cell:({row:n})=>j(n.original.coverageDays)},{header:"Ankerbestand",meta:{width:118,align:"right",sortAccessor:n=>{const r=String(n.sku||"").trim(),a=p.startAvailableBySku.get(r);return Number.isFinite(a)?Number(a):0}},cell:({row:n})=>{var x,O;const r=String(n.original.sku||"").trim(),a=p.startAvailableBySku.get(r),u=Nt.has(r),h=Ut.has(r),f=((O=(x=p.anchorSourceBySku)==null?void 0:x.get)==null?void 0:O.call(x,r))||null,g=f!=null&&f.month?ae(String(f.month),"long"):"—",y=h?"Keine Snapshot-Historie für diese SKU. Startwert = 0.":u?`SKU-Fallback: letzter verfügbarer Snapshot (${g}).`:`Anchor-Snapshot (${g}).`;return t.jsx(me,{title:y,children:t.jsx("span",{children:j(Number.isFinite(a)?Number(a):0)})})}}],s=C.map(n=>({id:n,header:J(n),meta:{minWidth:106,width:106,align:"right",sortAccessor:r=>{var u;const a=(u=p.perSkuMonth.get(r.sku))==null?void 0:u.get(n);return a?k==="plan"?Number.isFinite(a.forecastUnits)?Number(a.forecastUnits):null:k==="doh"?Number.isFinite(a.doh)?Number(a.doh):null:Number.isFinite(a.endAvailable)?Number(a.endAvailable):null:null}},cell:({row:r})=>{var K;const a=(K=p.perSkuMonth.get(r.original.sku))==null?void 0:K.get(n);if(!a)return"—";let u=null;k==="plan"?u=Number.isFinite(a.forecastUnits)?Number(a.forecastUnits):null:k==="doh"?u=Number.isFinite(a.doh)?Number(a.doh):null:u=Number.isFinite(a.endAvailable)?Number(a.endAvailable):null;const h=re({projectionMode:k,endAvailable:a.endAvailable,safetyUnits:a.safetyUnits,doh:a.doh,safetyDays:a.safetyDays}),f=k!=="plan",g=a.inboundDetails,y=`${r.original.sku}|${n}`,x=Ne.get(y)||null,O=(te==null?void 0:te.cellKey)===y;return t.jsx(Lt,{trigger:f?"click":"hover",placement:"rightTop",open:f?O:void 0,onOpenChange:P=>{f&&!P&&O&&$e(null)},content:O&&te?Wt(te):null,children:t.jsxs("div",{className:["v2-proj-cell",h?`v2-proj-cell--${h}`:"",f?"v2-proj-cell--actionable":""].filter(Boolean).join(" "),role:f?"button":void 0,tabIndex:f?0:void 0,onClick:f?()=>xt(r.original,n,a,y):void 0,onKeyDown:f?P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),xt(r.original,n,a,y))}:void 0,children:[t.jsx("div",{className:"v2-proj-cell-main",children:j(u)}),k!=="plan"&&Number.isFinite(a.safetyUnits)?t.jsxs(m,{type:"secondary",style:{fontSize:11},children:["SB: ",j(a.safetyUnits)]}):null,x?t.jsx("button",{type:"button",className:"v2-proj-fo-badge",onClick:P=>{P.stopPropagation(),Ue(x)},children:"FO empfohlen"}):null,g&&g.totalUnits>0?t.jsx(Lt,{content:Tn(g),trigger:"hover",placement:"topLeft",children:t.jsxs("div",{className:"v2-proj-inbound-row",children:[g.poUnits>0?t.jsxs(b,{className:"v2-proj-inbound v2-proj-inbound--po",children:["PO +",j(g.poUnits)]}):null,g.foUnits>0?t.jsxs(b,{className:"v2-proj-inbound v2-proj-inbound--fo",children:["FO +",j(g.foUnits)]}):null]})}):null]})})}}));return[...e,...s]},[te,Ut,Nt,Ne,Ke,p,k,C]);async function Zt(){await B(e=>{const s=on(e),n=s;Un(n);const r=n.inventory,a=Array.isArray(r.snapshots)?[...r.snapshots]:[],u=Object.entries(Ie).map(([y,x])=>({sku:y,amazonUnits:W(x.amazonUnits),threePLUnits:W(x.threePLUnits),note:String(x.note||"")})).filter(y=>y.amazonUnits>0||y.threePLUnits>0||y.note),h=D(A)||oe(),f=a.findIndex(y=>D(y.month)===h),g={month:h,items:u,updatedAt:wn()};return f>=0?a[f]={...a[f]||{},...g}:a.push(g),a.sort((y,x)=>String(D(y.month)).localeCompare(String(D(x.month)))),r.snapshots=a,r.settings={...r.settings||{},projectionMonths:Xe(Z)},s},"v2:inventory:save-snapshot"),fe(!1)}async function Jt(){const e=Rt(w,A);e&&(Le(Je(e.items||[])),fe(!0))}function Xt(){const s=[["SKU","Alias","Kategorie","AmazonUnits","ThreePLUnits","TotalUnits"],...U.map(u=>[u.sku,u.alias,u.categoryLabel,String(u.amazonUnits),String(u.threePLUnits),String(u.totalUnits)])].map(u=>u.map(h=>`"${String(h).replace(/"/g,'""')}"`).join(";")).join(`
`),n=new Blob([s],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=`inventory-snapshot-${A}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}const Ve=String(p.anchorMode||"no_snapshot"),We=D(p.anchorTargetMonth||p.anchorMonth),Yt=ue,en=Ve==="rollforward"?`Anker: ${p.anchorSourceMonth||"—"} Snapshot → Rollforward bis ${We||"—"}`:Ve==="snapshot"?`Anker: Snapshot ${We||p.anchorSourceMonth||"—"}`:"Anker: kein Snapshot (Start bei 0)";return t.jsxs("div",{className:"v2-page",children:[t.jsxs(Qe,{className:"v2-intro-card",children:[t.jsx("div",{className:"v2-page-head",children:t.jsxs("div",{children:[t.jsx(Ze,{level:3,children:$&&!z?"Bestandsaufnahme":z&&!$?"Bestandsprojektion":"Inventory"}),t.jsx(An,{children:$&&!z?"Monatliche Snapshot-Erfassung mit Kategoriegruppen, Copy-Forward, Speicherung und CSV-Export.":z&&!$?"Bestandsprojektion mit Risikoampel, PO/FO-Inbound-Sicht und direkter Bestellbrücke.":"Snapshot-Erfassung und Projektion (Units / DOH / Plan) in einem Arbeitsbereich."})]})}),t.jsxs("div",{className:"v2-toolbar",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[$?t.jsx(zt,{value:A,onChange:e=>{G(e),tt(!0)},options:_.map(e=>({value:e,label:`${e} · ${ae(e,"long")}`})),style:{width:260,maxWidth:"100%"}}):null,t.jsx(Ht,{value:ze,onChange:e=>rt(e.target.value),placeholder:"Suche SKU, Alias, Kategorie",style:{width:320,maxWidth:"100%"}}),t.jsx(Cn,{checked:Ee,onChange:e=>qt(e.target.checked),children:"Nur aktive Produkte"}),z?t.jsxs(t.Fragment,{children:[t.jsxs(Oe.Group,{value:k,onChange:e=>st(e.target.value),children:[t.jsx(Oe.Button,{value:"units",children:"Units"}),t.jsx(Oe.Button,{value:"doh",children:"DOH"}),t.jsx(Oe.Button,{value:"plan",children:"Plan"})]}),t.jsx(me,{title:Ln(k),children:t.jsx(Mn,{style:{color:"#64748b",fontSize:16}})}),t.jsx(zt,{value:Z,onChange:e=>ot(Xe(e)),style:{width:160,maxWidth:"100%"},options:_t.map(e=>({value:e,label:`Horizont ${e} Monate`}))})]}):null,t.jsxs(b,{color:"blue",children:["Baseline Forecast: ",Vt]}),xe>0?t.jsxs(I,{size:"small",onClick:()=>d("/v2/forecast?panel=conflicts"),children:["Forecast-Änderung: ",xe," FOs prüfen"]}):null]}),$?t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsx(I,{onClick:()=>{Jt()},children:"Vorherigen Monat kopieren"}),t.jsx(I,{type:"primary",onClick:()=>{Zt()},disabled:!nt,loading:M,children:"Snapshot speichern"}),t.jsx(I,{onClick:Xt,children:"Snapshot CSV"}),nt?t.jsx(b,{color:"orange",children:"Ungespeicherte Änderungen"}):t.jsx(b,{color:"green",children:"Gespeichert"}),t.jsx(b,{color:"blue",children:ae(A,"long")}),N?t.jsxs(b,{color:"green",children:["Gespeichert: ",new Date(N).toLocaleTimeString("de-DE")]}):null]}):null]})]}),S?t.jsx(Fe,{type:"error",showIcon:!0,message:S}):null,v?t.jsx(Fe,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,xe>0?t.jsx(Fe,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${xe} FOs prüfen`,description:t.jsx(I,{size:"small",onClick:()=>d("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,$?t.jsxs(Qe,{children:[t.jsxs(Ze,{level:4,children:["Snapshot zum Stichtag ",ae(A,"long")]}),t.jsxs(m,{type:"secondary",children:["Monatsschlüssel: ",A]}),t.jsxs("div",{className:"v2-category-tools",children:[t.jsxs(m,{type:"secondary",children:[U.length," Produkte in ",T.length," Kategorien"]}),t.jsxs("div",{className:"v2-actions-inline",children:[t.jsx(I,{size:"small",onClick:()=>ye(T.map(e=>e.key)),disabled:!T.length,children:"Alles auf"}),t.jsx(I,{size:"small",onClick:()=>ye([]),disabled:!ge.length,children:"Alles zu"})]})]}),T.length?t.jsx(Et,{className:"v2-category-collapse",activeKey:ge,onChange:e=>ye((Array.isArray(e)?e:[e]).map(String)),items:T.map(e=>({key:e.key,label:t.jsxs(Ge,{children:[t.jsx(m,{strong:!0,children:e.label}),t.jsxs("span",{className:"v2-category-count",children:[e.rows.length," Produkte"]})]}),children:t.jsx(Ft,{data:e.rows,columns:Gt,minTableWidth:1e3,tableLayout:"fixed"})}))}):t.jsx(m,{type:"secondary",children:"Keine Snapshot-Zeilen für den aktuellen Filter."})]}):null,z?t.jsxs(Qe,{children:[t.jsxs(Ze,{level:4,children:["Projektion (",k.toUpperCase(),")"]}),t.jsxs("div",{className:"v2-proj-cluster-grid",children:[t.jsxs("div",{className:"v2-proj-context-cluster",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(b,{color:"blue",children:["Heute: ",ae(Yt,"long")]}),t.jsx(b,{color:Ve==="no_snapshot"?"red":"blue",children:en}),t.jsxs(b,{color:"default",children:["Zeitraum: ",C[0]||"—"," bis ",C[C.length-1]||"—"]}),t.jsxs(b,{color:"default",children:["Horizont: ",Z," Monate"]})]}),t.jsxs("div",{className:"v2-toolbar-row",children:[p.snapshotFallbackUsed?t.jsx(b,{color:"gold",children:"Fallback auf letzten Snapshot ≤ Ankermonat"}):null,p.resolvedSnapshotMonth?t.jsxs(b,{color:"blue",children:["Stichtag Anchor: ",ae(String(p.resolvedSnapshotMonth||We||""),"long")]}):null,Number(p.anchorSkuFallbackCount||0)>0?t.jsxs(b,{color:"gold",children:["SKU-Fallback aktiv: ",Number(p.anchorSkuFallbackCount||0)]}):null,q.missingEta>0?t.jsxs(b,{color:"orange",children:["Fehlende ETA: ",q.missingEta]}):t.jsx(b,{color:"green",children:"Fehlende ETA: 0"}),t.jsx(me,{title:"Units = projizierter Monatsendbestand · DOH = Reichweite in Tagen · Plan = Forecast-Absatz · Safety = Vergleich gegen Safety-Schwelle je SKU/Monat",children:t.jsx(b,{color:"default",children:"Modus-Hilfe"})})]}),Ct.length>0?t.jsx(Fe,{className:"v2-proj-anchor-warning",type:"warning",showIcon:!0,message:`Anker-Rollforward mit Forecast-Lücken bei ${Ct.length} SKU(s) – diese Monate wurden mit 0 Units gerechnet.`}):null]}),t.jsxs("div",{className:"v2-proj-filter-cluster",children:[t.jsx(m,{type:"secondary",children:"Risiko-Filter"}),t.jsxs("div",{className:"v2-toolbar-row v2-proj-filter-row",children:[t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${X==="all"?"is-active":""}`,onClick:()=>pe("all"),children:"Alle Risiken"}),t.jsxs("button",{type:"button",className:`v2-proj-filter-btn v2-proj-filter-btn--negative ${X==="oos"?"is-active":""}`,onClick:()=>pe("oos"),children:["OOS / ","<="," 0"]}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn v2-proj-filter-btn--low ${X==="under_safety"?"is-active":""}`,onClick:()=>pe("under_safety"),children:"Unter Safety"})]})]}),t.jsxs("div",{className:"v2-proj-filter-cluster",children:[t.jsx(m,{type:"secondary",children:"ABC-Filter"}),t.jsxs("div",{className:"v2-toolbar-row v2-proj-filter-row",children:[t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${Q==="all"?"is-active":""}`,onClick:()=>Y("all"),children:"Alle"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${Q==="a"?"is-active":""}`,onClick:()=>Y("a"),children:"A"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${Q==="b"?"is-active":""}`,onClick:()=>Y("b"),children:"B"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${Q==="ab"?"is-active":""}`,onClick:()=>Y("ab"),children:"A+B"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${Q==="abc"?"is-active":""}`,onClick:()=>Y("abc"),children:"ABC"})]})]})]}),t.jsxs("div",{className:"v2-proj-score-strip",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(b,{color:q.underSafetySkus>0?"gold":"green",children:["SKUs unter Safety: ",q.underSafetySkus]}),t.jsxs(b,{color:q.oosSkus>0?"red":"green",children:["OOS: ",q.oosSkus]}),t.jsxs(b,{color:"blue",children:["Kritischster Monat: ",q.criticalMonth?J(q.criticalMonth):"—"]})]}),t.jsxs("div",{className:"v2-proj-heatmap",children:[C.map(e=>{const s=de.get(e),n=Number((s==null?void 0:s.score)||0),r=vt>0?Math.min(1,n/vt):0,a=L===e;return t.jsxs("button",{type:"button",className:`v2-proj-heatmap-item${a?" is-active":""}`,style:{background:`rgba(220, 38, 38, ${.08+r*.3})`,borderColor:a?"rgba(220, 38, 38, 0.8)":"rgba(15, 27, 45, 0.12)"},onClick:()=>be(u=>u===e?null:e),title:`${J(e)} · ABC-gewichteter Risikoscore ${n} · OOS ${Number((s==null?void 0:s.oosCount)||0)} · Unter Safety ${Number((s==null?void 0:s.underSafetyCount)||0)}`,children:[t.jsx("span",{children:J(e)}),t.jsxs("strong",{children:["Score ",n]})]},e)}),L?t.jsx(I,{size:"small",onClick:()=>be(null),children:"Filter löschen"}):null]}),t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(b,{className:"v2-proj-legend v2-proj-legend--negative",children:["Rot = OOS / ","<="," 0"]}),t.jsx(b,{className:"v2-proj-legend v2-proj-legend--low",children:"Orange = Unter Safety"}),t.jsx(b,{className:"v2-proj-legend",children:"Inbound Marker: PO / FO"}),t.jsx(m,{type:"secondary",children:"`FO empfohlen` im ersten Risikomonat anklicken oder Zelle öffnen für FO-Anlage."})]})]}),t.jsxs("div",{className:"v2-proj-worklist",children:[t.jsxs("div",{className:"v2-proj-worklist-head",children:[t.jsxs(Ge,{wrap:!0,children:[t.jsx(m,{strong:!0,children:"FO-Arbeitsliste"}),t.jsxs(b,{color:V.length?"gold":"green",children:[V.length," SKU(s)"]}),t.jsx(b,{color:"blue",children:"Sortierung: A/B zuerst, frühester Risikomonat"})]}),V.length?t.jsx(I,{size:"small",type:"primary",onClick:()=>{var e,s;return Ue(((e=V[0])==null?void 0:e.intent)||null,{nextIntent:((s=V[1])==null?void 0:s.intent)||null})},children:"Erste SKU öffnen"}):null]}),V.length?t.jsx(dn,{children:t.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"SKU"}),t.jsx("th",{children:"ABC"}),t.jsx("th",{children:"Risikomonat"}),t.jsx("th",{children:"Risiko"}),t.jsx("th",{children:"Empfohlen"}),t.jsx("th",{children:"ETA-Ziel"}),t.jsx("th",{children:"Bestellen bis"}),t.jsx("th",{children:"Aktion"})]})}),t.jsx("tbody",{children:V.map((e,s)=>{var r;const n=((r=V[s+1])==null?void 0:r.intent)||null;return t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("div",{className:"v2-proj-alias",children:[t.jsx(m,{className:"v2-proj-alias-main",children:e.alias||e.sku}),t.jsx(m,{className:"v2-proj-sku-secondary",type:"secondary",children:e.sku})]})}),t.jsx("td",{children:e.abcClass||"—"}),t.jsx("td",{children:J(e.month)}),t.jsx("td",{children:e.riskClass==="safety-negative"?t.jsx(b,{color:"red",children:"OOS / ≤ 0"}):t.jsx(b,{color:"gold",children:"Unter Safety"})}),t.jsx("td",{children:j(e.recommendedUnits)}),t.jsx("td",{children:ie(e.requiredArrivalDate)}),t.jsx("td",{children:ie(e.recommendedOrderDate)}),t.jsx("td",{children:t.jsx(I,{size:"small",type:"primary",onClick:()=>Ue(e.intent,{nextIntent:n}),children:"FO öffnen"})})]},e.key)})})]})}):t.jsx(m,{type:"secondary",children:"Keine FO-Empfehlungen im aktuellen Filterumfang."})]}),t.jsxs("div",{className:"v2-category-tools",style:{marginTop:10},children:[t.jsx(m,{type:"secondary",children:L?`${F.reduce((e,s)=>e+s.rows.length,0)} kritische Produkte in ${F.length} Kategorien (${J(L)})`:`${he.length} Produkte in ${Me.length} Kategorien`}),t.jsxs("div",{className:"v2-actions-inline",children:[t.jsx(I,{size:"small",onClick:()=>ce(F.map(e=>e.key)),disabled:!F.length,children:"Alles auf"}),t.jsx(I,{size:"small",onClick:()=>ce([]),disabled:!je.length,children:"Alles zu"})]})]}),F.length?t.jsx(Et,{className:"v2-category-collapse",activeKey:je,onChange:e=>ce((Array.isArray(e)?e:[e]).map(String)),items:F.map(e=>({key:e.key,label:t.jsxs(Ge,{children:[t.jsx(m,{strong:!0,children:e.label}),t.jsxs("span",{className:"v2-category-count",children:[e.rows.length," Produkte"]})]}),children:t.jsx(Ft,{data:e.rows,columns:Qt,minTableWidth:Math.max(1080,760+C.length*118),tableLayout:"fixed",crosshair:"matrix"})}))}):t.jsx(m,{type:"secondary",children:"Keine Projektion für den aktuellen Filter."})]}):null]})}export{is as I};
