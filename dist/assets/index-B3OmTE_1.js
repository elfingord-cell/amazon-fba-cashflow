import{t as r,a6 as Fe,a7 as Gt,a8 as _t,a9 as at,a0 as Ge,aa as Nt,ab as Xt,a2 as Zt,a3 as Qt,ac as gt,ad as Be,ae as Ct,V as Jt,af as Yt,ag as es,ah as ts,ai as De,aj as ss,ak as as,al as ns,a1 as is,am as rs,p as ft,an as ls,ao as os,a4 as u,ap as cs,aq as ds,k as t,L as j,J as us,S as Ke,O as Me,K as ne,M as oe,a5 as Je,T as ms,P as Ye}from"./index-CAzQztwo.js";import{T as ps}from"./TanStackGrid-DGGNjv9D.js";import{D as I}from"./DeNumberInput-S8NAtNBo.js";import{h as hs,g as gs,b as fs,s as vs,a as bs}from"./uiPrefs-DA4RgD3f.js";import{d as xs}from"./shipping-9Dzo5wwm.js";import{r as ys,e as vt,s as be}from"./productCompletenessV2-CJLSMhtL.js";import{n as Ss,f as ot}from"./months-DiLwPhVv.js";import{a as js}from"./tableModels-DR-xwumi.js";import{e as Ps,f as ks}from"./planProducts-CfB8BW_g.js";import{u as Us,C as bt}from"./workspace-xr5uOuIo.js";import{u as Ds}from"./modalCollaboration-5eCYV3lX.js";import{S as xe}from"./index-C15xyCf_.js";import{C as xt}from"./Collapse-mRNqWjAX.js";import{C as Ne}from"./index-5SR9pC2K.js";import{F as Ns}from"./Table-v8LS_Cg4.js";import{s as et}from"./index-Cs7EqDZh.js";import"./index-Dab_0RQN.js";import"./costing-CmZrILJ2.js";import"./Dropdown-CZlZd-6U.js";import"./useBubbleLock-Cjjrx1CM.js";import"./index-BZ5evjDG.js";import"./Pagination-B0SkKhC9.js";var yt=function(a,o){if(!a)return null;var c={left:a.offsetLeft,right:a.parentElement.clientWidth-a.clientWidth-a.offsetLeft,width:a.clientWidth,top:a.offsetTop,bottom:a.parentElement.clientHeight-a.clientHeight-a.offsetTop,height:a.clientHeight};return o?{left:0,right:0,width:0,top:c.top,bottom:c.bottom,height:c.height}:{left:c.left,right:c.right,width:c.width,top:0,bottom:0,height:0}},ce=function(a){return a!==void 0?"".concat(a,"px"):void 0};function Cs(s){var a=s.prefixCls,o=s.containerRef,c=s.value,d=s.getValueIndex,p=s.motionName,U=s.onMotionStart,x=s.onMotionEnd,R=s.direction,g=s.vertical,f=g===void 0?!1:g,F=r.useRef(null),L=r.useState(c),T=Fe(L,2),w=T[0],H=T[1],N=function(ae){var k,$=d(ae),b=(k=o.current)===null||k===void 0?void 0:k.querySelectorAll(".".concat(a,"-item"))[$];return(b==null?void 0:b.offsetParent)&&b},K=r.useState(null),D=Fe(K,2),y=D[0],ye=D[1],B=r.useState(null),h=Fe(B,2),P=h[0],A=h[1];Gt(function(){if(w!==c){var E=N(w),ae=N(c),k=yt(E,f),$=yt(ae,f);H(c),ye(k),A($),E&&ae?U():x()}},[c]);var z=r.useMemo(function(){if(f){var E;return ce((E=y==null?void 0:y.top)!==null&&E!==void 0?E:0)}return ce(R==="rtl"?-(y==null?void 0:y.right):y==null?void 0:y.left)},[f,R,y]),te=r.useMemo(function(){if(f){var E;return ce((E=P==null?void 0:P.top)!==null&&E!==void 0?E:0)}return ce(R==="rtl"?-(P==null?void 0:P.right):P==null?void 0:P.left)},[f,R,P]),W=function(){return f?{transform:"translateY(var(--thumb-start-top))",height:"var(--thumb-start-height)"}:{transform:"translateX(var(--thumb-start-left))",width:"var(--thumb-start-width)"}},se=function(){return f?{transform:"translateY(var(--thumb-active-top))",height:"var(--thumb-active-height)"}:{transform:"translateX(var(--thumb-active-left))",width:"var(--thumb-active-width)"}},Q=function(){ye(null),A(null),x()};return!y||!P?null:r.createElement(_t,{visible:!0,motionName:p,motionAppear:!0,onAppearStart:W,onAppearActive:se,onVisibleChanged:Q},function(E,ae){var k=E.className,$=E.style,b=at(at({},$),{},{"--thumb-start-left":z,"--thumb-start-width":ce(y==null?void 0:y.width),"--thumb-active-left":te,"--thumb-active-width":ce(P==null?void 0:P.width),"--thumb-start-top":z,"--thumb-start-height":ce(y==null?void 0:y.height),"--thumb-active-top":te,"--thumb-active-height":ce(P==null?void 0:P.height)}),Te={ref:Nt(F,ae),style:b,className:Ge("".concat(a,"-thumb"),k)};return r.createElement("div",Te)})}var Es=["prefixCls","direction","vertical","options","disabled","defaultValue","value","name","onChange","className","motionName"];function Ms(s){if(typeof s.title<"u")return s.title;if(Ct(s.label)!=="object"){var a;return(a=s.label)===null||a===void 0?void 0:a.toString()}}function Is(s){return s.map(function(a){if(Ct(a)==="object"&&a!==null){var o=Ms(a);return at(at({},a),{},{title:o})}return{label:a==null?void 0:a.toString(),title:a==null?void 0:a.toString(),value:a}})}var Rs=function(a){var o=a.prefixCls,c=a.className,d=a.disabled,p=a.checked,U=a.label,x=a.title,R=a.value,g=a.name,f=a.onChange,F=a.onFocus,L=a.onBlur,T=a.onKeyDown,w=a.onKeyUp,H=a.onMouseDown,N=function(D){d||f(D,R)};return r.createElement("label",{className:Ge(c,Be({},"".concat(o,"-item-disabled"),d)),onMouseDown:H},r.createElement("input",{name:g,className:"".concat(o,"-item-input"),type:"radio",disabled:d,checked:p,onChange:N,onFocus:F,onBlur:L,onKeyDown:T,onKeyUp:w}),r.createElement("div",{className:"".concat(o,"-item-label"),title:x},U))},Fs=r.forwardRef(function(s,a){var o,c=s.prefixCls,d=c===void 0?"rc-segmented":c,p=s.direction,U=s.vertical,x=s.options,R=x===void 0?[]:x,g=s.disabled,f=s.defaultValue,F=s.value,L=s.name,T=s.onChange,w=s.className,H=w===void 0?"":w,N=s.motionName,K=N===void 0?"thumb-motion":N,D=Xt(s,Es),y=r.useRef(null),ye=r.useMemo(function(){return Nt(y,a)},[y,a]),B=r.useMemo(function(){return Is(R)},[R]),h=Zt((o=B[0])===null||o===void 0?void 0:o.value,{value:F,defaultValue:f}),P=Fe(h,2),A=P[0],z=P[1],te=r.useState(!1),W=Fe(te,2),se=W[0],Q=W[1],E=function(_,ue){z(ue),T==null||T(ue)},ae=Qt(D,["children"]),k=r.useState(!1),$=Fe(k,2),b=$[0],Te=$[1],ie=r.useState(!1),G=Fe(ie,2),ze=G[0],Ce=G[1],qe=function(){Ce(!0)},nt=function(){Ce(!1)},it=function(){Te(!1)},C=function(_){_.key==="Tab"&&Te(!0)},Oe=function(_){var ue=B.findIndex(function(q){return q.value===A}),Se=B.length,je=(ue+_+Se)%Se,me=B[je];me&&(z(me.value),T==null||T(me.value))},Ve=function(_){switch(_.key){case"ArrowLeft":case"ArrowUp":Oe(-1);break;case"ArrowRight":case"ArrowDown":Oe(1);break}};return r.createElement("div",gt({role:"radiogroup","aria-label":"segmented control",tabIndex:g?void 0:0,"aria-orientation":U?"vertical":"horizontal"},ae,{className:Ge(d,Be(Be(Be({},"".concat(d,"-rtl"),p==="rtl"),"".concat(d,"-disabled"),g),"".concat(d,"-vertical"),U),H),ref:ye}),r.createElement("div",{className:"".concat(d,"-group")},r.createElement(Cs,{vertical:U,prefixCls:d,value:A,containerRef:y,motionName:"".concat(d,"-").concat(K),direction:p,getValueIndex:function(_){return B.findIndex(function(ue){return ue.value===_})},onMotionStart:function(){Q(!0)},onMotionEnd:function(){Q(!1)}}),B.map(function(M){return r.createElement(Rs,gt({},M,{name:L,key:M.value,prefixCls:d,className:Ge(M.className,"".concat(d,"-item"),Be(Be({},"".concat(d,"-item-selected"),M.value===A&&!se),"".concat(d,"-item-focused"),ze&&b&&M.value===A)),checked:M.value===A,onChange:E,onFocus:qe,onBlur:nt,onKeyDown:Ve,onKeyUp:C,onMouseDown:it,disabled:!!g||!!M.disabled}))})))}),Ts=Fs;function St(s,a){return{[`${s}, ${s}:hover, ${s}:focus`]:{color:a.colorTextDisabled,cursor:"not-allowed"}}}function jt(s){return{background:s.itemSelectedBg,boxShadow:s.boxShadowTertiary}}const Os=Object.assign({overflow:"hidden"},as),Ls=s=>{const{componentCls:a}=s,o=s.calc(s.controlHeight).sub(s.calc(s.trackPadding).mul(2)).equal(),c=s.calc(s.controlHeightLG).sub(s.calc(s.trackPadding).mul(2)).equal(),d=s.calc(s.controlHeightSM).sub(s.calc(s.trackPadding).mul(2)).equal();return{[a]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},es(s)),{display:"inline-block",padding:s.trackPadding,color:s.itemColor,background:s.trackBg,borderRadius:s.borderRadius,transition:`all ${s.motionDurationMid}`}),ts(s)),{[`${a}-group`]:{position:"relative",display:"flex",alignItems:"stretch",justifyItems:"flex-start",flexDirection:"row",width:"100%"},[`&${a}-rtl`]:{direction:"rtl"},[`&${a}-vertical`]:{[`${a}-group`]:{flexDirection:"column"},[`${a}-thumb`]:{width:"100%",height:0,padding:`0 ${De(s.paddingXXS)}`}},[`&${a}-block`]:{display:"flex"},[`&${a}-block ${a}-item`]:{flex:1,minWidth:0},[`${a}-item`]:{position:"relative",textAlign:"center",cursor:"pointer",transition:`color ${s.motionDurationMid}`,borderRadius:s.borderRadiusSM,transform:"translateZ(0)","&-selected":Object.assign(Object.assign({},jt(s)),{color:s.itemSelectedColor}),"&-focused":ss(s),"&::after":{content:'""',position:"absolute",zIndex:-1,width:"100%",height:"100%",top:0,insetInlineStart:0,borderRadius:"inherit",opacity:0,transition:`opacity ${s.motionDurationMid}, background-color ${s.motionDurationMid}`,pointerEvents:"none"},[`&:not(${a}-item-selected):not(${a}-item-disabled)`]:{"&:hover, &:active":{color:s.itemHoverColor},"&:hover::after":{opacity:1,backgroundColor:s.itemHoverBg},"&:active::after":{opacity:1,backgroundColor:s.itemActiveBg}},"&-label":Object.assign({minHeight:o,lineHeight:De(o),padding:`0 ${De(s.segmentedPaddingHorizontal)}`},Os),"&-icon + *":{marginInlineStart:s.calc(s.marginSM).div(2).equal()},"&-input":{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:0,opacity:0,pointerEvents:"none"}},[`${a}-thumb`]:Object.assign(Object.assign({},jt(s)),{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:0,height:"100%",padding:`${De(s.paddingXXS)} 0`,borderRadius:s.borderRadiusSM,[`& ~ ${a}-item:not(${a}-item-selected):not(${a}-item-disabled)::after`]:{backgroundColor:"transparent"}}),[`&${a}-lg`]:{borderRadius:s.borderRadiusLG,[`${a}-item-label`]:{minHeight:c,lineHeight:De(c),padding:`0 ${De(s.segmentedPaddingHorizontal)}`,fontSize:s.fontSizeLG},[`${a}-item, ${a}-thumb`]:{borderRadius:s.borderRadius}},[`&${a}-sm`]:{borderRadius:s.borderRadiusSM,[`${a}-item-label`]:{minHeight:d,lineHeight:De(d),padding:`0 ${De(s.segmentedPaddingHorizontalSM)}`},[`${a}-item, ${a}-thumb`]:{borderRadius:s.borderRadiusXS}}}),St(`&-disabled ${a}-item`,s)),St(`${a}-item-disabled`,s)),{[`${a}-thumb-motion-appear-active`]:{transition:`transform ${s.motionDurationSlow} ${s.motionEaseInOut}, width ${s.motionDurationSlow} ${s.motionEaseInOut}`,willChange:"transform, width"},[`&${a}-shape-round`]:{borderRadius:9999,[`${a}-item, ${a}-thumb`]:{borderRadius:9999}}})}},ws=s=>{const{colorTextLabel:a,colorText:o,colorFillSecondary:c,colorBgElevated:d,colorFill:p,lineWidthBold:U,colorBgLayout:x}=s;return{trackPadding:U,trackBg:x,itemColor:a,itemHoverColor:o,itemHoverBg:c,itemSelectedBg:d,itemActiveBg:p,itemSelectedColor:o}},As=Jt("Segmented",s=>{const{lineWidth:a,calc:o}=s,c=Yt(s,{segmentedPaddingHorizontal:o(s.controlPaddingHorizontal).sub(a).equal(),segmentedPaddingHorizontalSM:o(s.controlPaddingHorizontalSM).sub(a).equal()});return Ls(c)},ws);var Pt=function(s,a){var o={};for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&a.indexOf(c)<0&&(o[c]=s[c]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,c=Object.getOwnPropertySymbols(s);d<c.length;d++)a.indexOf(c[d])<0&&Object.prototype.propertyIsEnumerable.call(s,c[d])&&(o[c[d]]=s[c[d]]);return o};function $s(s){return typeof s=="object"&&!!(s!=null&&s.icon)}const Ks=r.forwardRef((s,a)=>{const o=ns(),{prefixCls:c,className:d,rootClassName:p,block:U,options:x=[],size:R="middle",style:g,vertical:f,shape:F="default",name:L=o}=s,T=Pt(s,["prefixCls","className","rootClassName","block","options","size","style","vertical","shape","name"]),{getPrefixCls:w,direction:H,className:N,style:K}=is("segmented"),D=w("segmented",c),[y,ye,B]=As(D),h=rs(R),P=r.useMemo(()=>x.map(te=>{if($s(te)){const{icon:W,label:se}=te,Q=Pt(te,["icon","label"]);return Object.assign(Object.assign({},Q),{label:r.createElement(r.Fragment,null,r.createElement("span",{className:`${D}-item-icon`},W),se&&r.createElement("span",null,se))})}return te}),[x,D]),A=Ge(d,p,N,{[`${D}-block`]:U,[`${D}-sm`]:h==="small",[`${D}-lg`]:h==="large",[`${D}-vertical`]:f,[`${D}-shape-${F}`]:F==="round"},ye,B),z=Object.assign(Object.assign({},K),g);return y(r.createElement(Ts,Object.assign({},T,{name:L,className:A,style:z,options:P,ref:a,prefixCls:D,direction:H,vertical:f})))}),Bs=Ks;function Et(s){return s==="order_override"?"Diese PO/FO":s==="product"?"Produkt":s==="supplier"?"Lieferant":s==="settings"?"Settings":s==="computed"?"Berechnet":"Fehlt"}function tt(s){if(s==null||s==="")return null;const a=Number(s);return Number.isFinite(a)?a:null}function zs(s){const a=s.template&&typeof s.template=="object"?s.template:{};return(a.fields&&typeof a.fields=="object"?a.fields:a)||{}}function de(s,a){return{value:s.value,source:s.source,sourceLabel:Et(s.source),hint:a,required:s.required}}function Ie(s,a,o,c=!1){return{value:s,source:a,sourceLabel:Et(a),hint:o,required:c}}function st(s){const a=Number(s);return Number.isFinite(a)&&a>0?a:null}function qs(s){const a=s.product||{},o=s.state||{},c=o.settings||{},d=zs(a),p=ys({state:o,product:a,sku:String(a.sku||""),supplierId:s.supplierId||String(a.supplierId||""),orderContext:"product"}),U=de(p.fields.moqUnits,"MOQ für Einkaufsplanung."),x=st(a.safetyStockDohOverride),R=st(c.safetyStockDohDefault),g=x!=null?Ie(x,"product","Produktspezifischer Safety-Wert."):Ie(R,R!=null?"settings":"missing","Default aus Settings (Safety Stock DOH)."),f=st(a.foCoverageDohOverride),F=st(c.foCoverageDohDefault),L=f!=null?Ie(f,"product","Produktspezifischer Coverage-Wert."):Ie(F,F!=null?"settings":"missing","Default aus Settings (FO Coverage DOH)."),T=String(d.transportMode||d.transport||"SEA").toUpperCase()||"SEA",w=d.transportMode||d.transport?"product":"settings",H=p.fields.logisticsPerUnitEur.value!=null?de(p.fields.logisticsPerUnitEur,"Logistik-/Importanteil je Einheit in EUR."):Ie(null,"missing","Logistik-/Importanteil je Einheit in EUR."),N=xs({unitCostUsd:p.fields.unitPriceUsd.value,landedUnitCostEur:tt(a.landedUnitCostEur),fxEurUsd:p.fields.fxRate.value}),K=H.value!=null?H:Ie(tt(N.value),Number.isFinite(Number(N.value))?"computed":"missing","Logistik-/Importanteil je Einheit in EUR.");return{moqEffective:U,safetyDohEffective:g,coverageDohEffective:L,productionLeadDays:de(p.fields.productionLeadTimeDays,"Produktionszeit für Planung/Bestellung."),unitPriceUsd:de(p.fields.unitPriceUsd,"Stückpreis in USD für Kostenkalkulation."),fxRate:de(p.fields.fxRate,"FX in USD je EUR für Umrechnung."),logisticsPerUnitEur:K,transportMode:Ie(T,w,"Transportmodus für ETA/Lead-Time."),transitDays:de(p.fields.transitDays,"Transitzeit in Tagen für Planung."),currency:de(p.fields.currency,"Währung für Kostenwerte."),dutyPct:de(p.fields.dutyRatePct,"Zollsatz in Prozent."),eustPct:de(p.fields.eustRatePct,"EUSt-Satz in Prozent."),ddp:de(p.fields.ddp,"DDP = Importkosten in Lieferpreis enthalten."),shippingSuggestion:{value:tt(N.value),goodsCostEur:tt(N.goodsCostEur),warning:N.warning===!0}}}const Vs=["Jan","Feb","Maerz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Hs(s,a){if(!a)return null;const o=s==null?void 0:s[a];if(o&&typeof o=="object")return o;const c=a.toLowerCase(),d=Object.keys(s||{}).find(U=>U.toLowerCase()===c);if(!d)return null;const p=s==null?void 0:s[d];return p&&typeof p=="object"?p:null}function Ws(s){return Object.entries(s||{}).map(([a,o])=>{const c=Ss(a);if(!c)return null;const d=Number(c.slice(5,7));if(!Number.isFinite(d)||d<1||d>12)return null;const p=o&&typeof o=="object"?ft(o.units):ft(o);return Number.isFinite(p)?{month:c,monthNumber:d,units:Number(p)}:null}).filter(a=>!!a).sort((a,o)=>a.month.localeCompare(o.month))}function Gs(s){return Number.isFinite(s)?Number(s)<.9?"unterdurchschnittlich":Number(s)>1.1?"ueberdurchschnittlich":"durchschnittlich":"keine_daten"}function _s(s){const a=String(s.sku||"").trim();if(!a)return null;const o=Hs(s.forecastImport||{},a);if(!o)return null;const c=Ws(o);if(!c.length)return null;const d=Array.from({length:12},()=>[]);c.forEach(g=>{d[g.monthNumber-1].push(g.units)});const p=d.map(g=>g.length?g.reduce((F,L)=>F+L,0)/g.length:null),U=p.filter(g=>Number.isFinite(g)),x=U.length?U.reduce((g,f)=>g+f,0)/U.length:null,R=p.map((g,f)=>{const F=Number.isFinite(g)&&Number.isFinite(x)&&Number(x)>0?Number(g)/Number(x):null;return{monthNumber:f+1,monthLabel:Vs[f],averageUnits:Number.isFinite(g)?Number(g):null,factor:Number.isFinite(F)?Number(F):null,sampleCount:d[f].length,classification:Gs(F)}});return{sku:a,startMonth:c[0].month,endMonth:c[c.length-1].month,sampleMonthCount:c.length,coveredMonthTypes:R.filter(g=>g.sampleCount>0).length,overallAverage:x,months:R}}const{Paragraph:ct,Text:We,Title:Re}=us,Xs=[{value:"active",label:"Aktiv"},{value:"prelaunch",label:"Noch nicht gelauncht"},{value:"inactive",label:"Inaktiv"}],Zs=["AIR","RAIL","SEA"],Qs=["EUR","USD","CNY"],kt={unitPriceUsd:["templateUnitPriceUsd"],avgSellingPriceGrossEUR:["avgSellingPriceGrossEUR"],sellerboardMarginPct:["sellerboardMarginPct"],moqUnits:["moqUnits"],productionLeadTimeDaysDefault:["productionLeadTimeDaysDefault"],incoterm_ddp:["templateDdp"],hsCode:["hsCode"],goodsDescription:["goodsDescription"],landedUnitCostEur:["landedUnitCostEur"]},Ut=new Set(["moqUnits","sellerboardMarginPct","templateDdp"]),Js={sku:"SKU",alias:"Alias",hsCode:"HS-Code",goodsDescription:"Warenbeschreibung",supplierId:"Supplier",categoryId:"Kategorie",status:"Status",avgSellingPriceGrossEUR:"Verkaufspreis (EUR)",sellerboardMarginPct:"Marge %",moqUnits:"MOQ Units",landedUnitCostEur:"Einstand (EUR)",logisticsPerUnitEur:"Shipping (EUR/Stk)",productionLeadTimeDaysDefault:"Production Lead Time",templateUnitPriceUsd:"EK (USD)",templateTransitDays:"Transit-Tage",templateDdp:"Incoterm / DDP"},dt={scope:"filtered",selectedSkus:[],applyTemplateUnitPriceUsd:!1,templateUnitPriceUsd:null,applyAvgSellingPriceGrossEUR:!1,avgSellingPriceGrossEUR:null,applySellerboardMarginPct:!1,sellerboardMarginPct:null,applyMoqUnits:!1,moqUnits:null,applyProductionLeadTimeDaysDefault:!1,productionLeadTimeDaysDefault:null,applyTemplateTransitDays:!1,templateTransitDays:null,applyTemplateDdp:!1,templateDdp:!0};function ut(){return new Date().toISOString()}function Ys(s){return`${s}-${Math.random().toString(36).slice(2,9)}`}function v(s){if(s==null||s==="")return null;const a=Number(s);return Number.isFinite(a)?a:null}function ea(s){const a=[v(s.formFx),v(s.settingsFx),v(s.resolvedFx)];for(let c=0;c<a.length;c+=1){const d=a[c];if(d!=null&&d>0&&d<10)return d}const o=v(s.settingsEurUsd);if(o!=null&&o>0&&o<10){const c=1/o;if(Number.isFinite(c)&&c>0)return c}for(let c=0;c<a.length;c+=1){const d=a[c];if(d!=null&&d>0)return d}return null}function V(s,a=2){return Number.isFinite(s)?Number(s).toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a}):"—"}function ta(s,a){const o=(a==null?void 0:a.kind)||"number";return o==="boolean"?s.value===!0?"Ja":"Nein":o==="text"?String(s.value||"—"):V(typeof s.value=="number"?s.value:null,(a==null?void 0:a.digits)??2)}function sa(s){return s==="ok"?t.jsx(j,{color:"green",children:"OK"}):s==="warn"?t.jsx(j,{color:"orange",children:"WARN"}):t.jsx(j,{color:"red",children:"BLOCKED"})}function aa(s){const a=String(s||"").trim().toLowerCase();return a==="all"||a==="active"||a==="prelaunch"||a==="inactive"?a:null}function na(s){const a=String(s||"").trim().toLowerCase();return a==="needs_fix"?"needs_fix":a==="revenue"?"revenue":a==="blocked"?"blocked":"all"}function Dt(s){const a=Number(s.avgSellingPriceGrossEUR);return!Number.isFinite(a)||a<=0||s.completeness==="blocked"}function mt(s){const a=(s==null?void 0:s.raw.template)||{},o=a.fields&&typeof a.fields=="object"?a.fields:a;return{id:s==null?void 0:s.id,sku:(s==null?void 0:s.sku)||"",alias:(s==null?void 0:s.alias)||"",hsCode:String((s==null?void 0:s.raw.hsCode)||""),goodsDescription:String((s==null?void 0:s.raw.goodsDescription)||""),supplierId:(s==null?void 0:s.supplierId)||"",categoryId:(s==null?void 0:s.categoryId)||null,status:(s==null?void 0:s.status)||"active",avgSellingPriceGrossEUR:(s==null?void 0:s.avgSellingPriceGrossEUR)??null,sellerboardMarginPct:(s==null?void 0:s.sellerboardMarginPct)??null,moqUnits:(s==null?void 0:s.moqUnits)??null,safetyStockDohOverride:v(s==null?void 0:s.raw.safetyStockDohOverride),foCoverageDohOverride:v(s==null?void 0:s.raw.foCoverageDohOverride),moqOverrideUnits:v(s==null?void 0:s.raw.moqOverrideUnits),landedUnitCostEur:v(s==null?void 0:s.raw.landedUnitCostEur),logisticsPerUnitEur:v((s==null?void 0:s.raw.logisticsPerUnitEur)??(s==null?void 0:s.raw.freightPerUnitEur)),productionLeadTimeDaysDefault:v(s==null?void 0:s.raw.productionLeadTimeDaysDefault),templateUnitPriceUsd:v(o.unitPriceUsd),templateTransportMode:String(o.transportMode||"SEA"),templateProductionDays:v(o.productionDays),templateTransitDays:v(o.transitDays),templateFreightEur:v(o.freightEur),templateDutyPct:v(o.dutyPct),templateVatImportPct:v(o.vatImportPct),templateFxRate:v(o.fxRate),templateCurrency:String(o.currency||"USD"),templateDdp:o.ddp===!0}}function Na(){const s=ls(),{state:a,loading:o,saving:c,error:d,lastSavedAt:p,saveWith:U}=Us(),x=os(),R=hs("products"),g=r.useRef(!1),[f,F]=r.useState("management"),[L,T]=r.useState(""),[w,H]=r.useState("all"),[N,K]=r.useState("all"),[D,y]=r.useState(!1),[ye,B]=r.useState(!1),[h,P]=r.useState(null),[A,z]=r.useState(!1),[te,W]=r.useState([]),[se,Q]=r.useState(()=>gs("products")),[E,ae]=r.useState(!1),[k]=u.useForm(),[$]=u.useForm(),b=u.useWatch([],k),Te=u.useWatch([],$),ie=a,G=a.settings||{},ze=a.forecast&&typeof a.forecast=="object"?a.forecast:{},Ce=ze.forecastImport&&typeof ze.forecastImport=="object"?ze.forecastImport:{},qe=r.useMemo(()=>cs(G),[G]),nt=r.useMemo(()=>ds({userId:x.userId,userEmail:x.email},qe),[qe,x.email,x.userId]),it=r.useMemo(()=>`products:edit:${String((h==null?void 0:h.id)||"new")}`,[h==null?void 0:h.id]),C=Ds({workspaceId:x.workspaceId,modalScope:it,isOpen:D,userId:x.userId,userEmail:x.email,userDisplayName:nt,displayNames:qe});r.useEffect(()=>{if(g.current)return;const e=new URLSearchParams(s.search),i=String(e.get("source")||"");if(i!=="dashboard"&&i!=="plan-products")return;g.current=!0;const n=String(e.get("sku")||"").trim();if(n&&T(n),i==="dashboard"){K(na(e.get("issues")));const l=aa(e.get("status"));l&&H(l),e.get("expand")==="all"&&ae(!0)}},[s.search]);const Oe=r.useMemo(()=>(Array.isArray(a.productCategories)?a.productCategories:[]).map(e=>({id:String(e.id||""),name:String(e.name||"Ohne Kategorie")})).filter(e=>e.id),[a.productCategories]),Ve=r.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(e=>({id:String(e.id||""),name:String(e.name||"")})).filter(e=>e.id),[a.suppliers]),M=r.useMemo(()=>new Map(Oe.map(e=>[e.id,e.name])),[Oe]),_=r.useMemo(()=>new Map(Ve.map(e=>[e.id,e.name])),[Ve]),ue=r.useMemo(()=>fs(ie),[a.productCategories]),Se=r.useMemo(()=>js({state:ie,search:L,statusFilter:w,categoryLabelById:M,supplierLabelById:_}),[M,L,ie,w,_]),je=r.useMemo(()=>Se.reduce((e,i)=>{const n=Dt(i),l=i.completeness!=="ok"||n;return n&&(e.revenue+=1),l&&(e.needsFix+=1),i.completeness==="blocked"&&(e.blocked+=1),e},{revenue:0,needsFix:0,blocked:0}),[Se]),me=r.useMemo(()=>N==="all"?Se:Se.filter(e=>{const i=Dt(e);return N==="revenue"?i:N==="blocked"?e.completeness==="blocked":e.completeness!=="ok"||i}),[Se,N]),q=r.useMemo(()=>{const e=new Map;me.forEach(n=>{var m;const l=n.categoryId&&M.get(n.categoryId)||"Ohne Kategorie";e.has(l)||e.set(l,[]),(m=e.get(l))==null||m.push(n)});const i=Array.from(e.entries()).map(([n,l])=>({key:n,label:n,rows:l.sort((m,S)=>m.sku.localeCompare(S.sku))}));return vs(i,ue)},[M,ue,me]),pe=r.useMemo(()=>me.filter(e=>e.status==="active"||e.status==="prelaunch"),[me]),Mt=r.useMemo(()=>pe.map(e=>({value:e.sku,label:`${e.alias||e.sku} · ${e.sku}`})),[pe]),X=Te||dt,It=r.useMemo(()=>{if(X.scope==="selected"){const e=new Set(pe.map(i=>i.sku));return(Array.isArray(X.selectedSkus)?X.selectedSkus:[]).map(i=>String(i||"").trim()).filter(i=>i&&e.has(i))}return pe.map(e=>e.sku)},[pe,X.scope,X.selectedSkus]);r.useEffect(()=>{Q(e=>{if(!q.length)return[];const i=new Set(q.map(l=>l.key)),n=e.filter(l=>i.has(l));return n.length||R?n:q.map(l=>l.key)})},[q,R]),r.useEffect(()=>{E&&q.length&&(Q(q.map(e=>e.key)),ae(!1))},[E,q]),r.useEffect(()=>{bs("products",se)},[se]);function _e(e){return e==null||!Number.isFinite(e)?"—":e.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})}function Rt(e){const i=mt(e);P(e),k.setFieldsValue(i),z(i.logisticsPerUnitEur!=null),y(!0)}function Ft(e){const i=e.status==="active"?"inactive":e.status==="inactive"?"prelaunch":"active";U(n=>{const l=Ye(n);return l.products=(Array.isArray(l.products)?l.products:[]).map(m=>{const S=m;return String(S.sku||"").toLowerCase()!==e.sku.toLowerCase()?S:{...S,status:i,updatedAt:ut()}}),l},"v2:products:toggle-status")}function Tt(e){Je.confirm({title:`Produkt "${e.sku}" loeschen?`,onOk:async()=>{await U(i=>{const n=Ye(i);return n.products=(Array.isArray(n.products)?n.products:[]).filter(l=>String(l.sku||"").toLowerCase()!==e.sku.toLowerCase()),n},"v2:products:delete")}})}async function Ot(e){const i=`${e.hsCode||""}	${e.goodsDescription||""}`;try{await navigator.clipboard.writeText(i),et.success("Kopiert")}catch{et.error("Kopieren fehlgeschlagen")}}const Lt=r.useMemo(()=>{const e=[{header:"Alias",accessorKey:"alias",meta:{width:260,minWidth:260},cell:({row:n})=>t.jsxs("div",{className:"v2-proj-alias",children:[t.jsx(We,{className:"v2-proj-alias-main",children:n.original.alias||n.original.sku}),t.jsx(We,{className:"v2-proj-sku-secondary",type:"secondary",children:n.original.sku})]})},{header:"Supplier",meta:{width:190},cell:({row:n})=>n.original.supplierId?_.get(n.original.supplierId)||n.original.supplierId:"—"}],i={header:"Aktionen",meta:{width:f==="logistics"?274:230,minWidth:f==="logistics"?274:230},cell:({row:n})=>t.jsxs("div",{className:"v2-actions-nowrap",children:[f==="logistics"?t.jsx(ne,{size:"small",onClick:()=>{Ot(n.original)},children:"Copy"}):null,t.jsx(ne,{size:"small",onClick:()=>Rt(n.original),children:"Bearbeiten"}),t.jsx(ne,{size:"small",onClick:()=>Ft(n.original),children:"Status"}),t.jsx(ne,{size:"small",danger:!0,onClick:()=>Tt(n.original),children:"Loeschen"})]})};return f==="logistics"?[...e,{header:"HS-Code",accessorKey:"hsCode",meta:{width:160},cell:({row:n})=>n.original.hsCode||"—"},{header:"Warenbeschreibung",accessorKey:"goodsDescription",meta:{minWidth:320,width:420},cell:({row:n})=>n.original.goodsDescription||"—"},i]:[...e,{header:"Status",meta:{width:96},cell:({row:n})=>n.original.status==="inactive"?t.jsx(j,{children:"Inaktiv"}):n.original.status==="prelaunch"?t.jsx(j,{color:"gold",children:"Noch nicht gelauncht"}):t.jsx(j,{color:"green",children:"Aktiv"})},{header:"Completeness",meta:{width:122},cell:({row:n})=>sa(n.original.completeness)},{header:"Ø VK (EUR)",meta:{width:120,align:"right"},cell:({row:n})=>_e(n.original.avgSellingPriceGrossEUR)},{header:"Ø EK (USD)",meta:{width:120,align:"right"},cell:({row:n})=>_e(n.original.templateUnitPriceUsd)},{header:"Ø Einstand (EUR)",meta:{width:140,align:"right"},cell:({row:n})=>_e(n.original.landedUnitCostEur)},{header:"Ø Shipping China->Lager/3PL (EUR/Stk)",meta:{width:220,align:"right"},cell:({row:n})=>_e(n.original.shippingPerUnitEur)},i]},[k,f,U,_]),He=r.useMemo(()=>{var m;const e=(h==null?void 0:h.raw)||{},i=((m=e.template)==null?void 0:m.fields)||e.template||{},n=b||mt(h||void 0);return{...e,sku:n.sku||e.sku||"",alias:n.alias||e.alias||"",hsCode:n.hsCode||e.hsCode||"",goodsDescription:n.goodsDescription||e.goodsDescription||"",supplierId:n.supplierId||e.supplierId||"",categoryId:n.categoryId??e.categoryId??null,moqUnits:n.moqUnits??e.moqUnits??null,moqOverrideUnits:n.moqOverrideUnits??e.moqOverrideUnits??null,safetyStockDohOverride:n.safetyStockDohOverride??e.safetyStockDohOverride??null,foCoverageDohOverride:n.foCoverageDohOverride??e.foCoverageDohOverride??null,landedUnitCostEur:n.landedUnitCostEur??e.landedUnitCostEur??null,logisticsPerUnitEur:n.logisticsPerUnitEur??e.logisticsPerUnitEur??null,freightPerUnitEur:n.logisticsPerUnitEur??e.freightPerUnitEur??null,productionLeadTimeDaysDefault:n.productionLeadTimeDaysDefault??e.productionLeadTimeDaysDefault??null,template:{scope:"SKU",name:"Standard (SKU)",fields:{...i,unitPriceUsd:n.templateUnitPriceUsd??i.unitPriceUsd??null,transportMode:n.templateTransportMode||String(i.transportMode||"SEA"),productionDays:n.templateProductionDays??i.productionDays??null,transitDays:n.templateTransitDays??i.transitDays??null,freightEur:n.templateFreightEur??i.freightEur??null,dutyPct:n.templateDutyPct??i.dutyPct??null,vatImportPct:n.templateVatImportPct??i.vatImportPct??null,fxRate:n.templateFxRate??i.fxRate??G.fxRate??null,currency:n.templateCurrency||String(i.currency||G.defaultCurrency||"EUR"),ddp:n.templateDdp??i.ddp??!1}}}},[b,h,G.defaultCurrency,G.fxRate,ie]),O=r.useMemo(()=>qs({product:He,state:ie,supplierId:String(He.supplierId||"")}),[He,ie]),Z=r.useMemo(()=>vt({product:He,state:ie}),[He,ie]),Le=r.useMemo(()=>String((b==null?void 0:b.sku)||(h==null?void 0:h.sku)||"").trim(),[b==null?void 0:b.sku,h==null?void 0:h.sku]),J=r.useMemo(()=>Le?_s({forecastImport:Ce,sku:Le}):null,[Ce,Le]),wt=r.useMemo(()=>{if(!J)return[];const e=J.months.map(l=>Number(l.factor)).filter(l=>Number.isFinite(l)),i=e.length?Math.max(...e):1,n=Math.max(1,i);return J.months.map(l=>({key:String(l.monthNumber),monthLabel:l.monthLabel,factor:l.factor,averageUnits:l.averageUnits,sampleCount:l.sampleCount,classification:l.classification,widthPercent:l.factor?Math.min(100,Number(l.factor)/n*100):0,scaleMax:Number(n)}))},[J]),re=r.useMemo(()=>{const e=String((b==null?void 0:b.sku)||(h==null?void 0:h.sku)||"").trim();return e&&(Array.isArray(a.planProductMappings)?a.planProductMappings:[]).map((n,l)=>Ps(n,l)).filter(n=>n.sku.toLowerCase()===e.toLowerCase()).sort((n,l)=>String(l.mappedAt||"").localeCompare(String(n.mappedAt||"")))[0]||null},[b==null?void 0:b.sku,h==null?void 0:h.sku,a.planProductMappings]),Xe=r.useMemo(()=>re?ks({mapping:re,forecastImport:Ce,maxMonths:18}):[],[Ce,re]),we=r.useMemo(()=>{const e=new Map,i=(l,m,S)=>{const ve=e.get(l);if(!ve){e.set(l,{level:m,messages:[S]});return}m==="error"&&(ve.level="error"),ve.messages.includes(S)||ve.messages.push(S)},n=Z.blockScope?"error":"warning";return Z.blockingMissing.forEach(l=>{(kt[l.fieldKey]||[]).forEach(S=>i(S,n,l.reason||l.label))}),Z.importantMissing.forEach(l=>{(kt[l.fieldKey]||[]).forEach(S=>i(S,"warning",l.reason||l.label))}),e},[Z]),pt=r.useMemo(()=>Array.from(we.keys()).some(e=>Ut.has(e)),[we]);function he(e){var i;return(i=we.get(e))==null?void 0:i.level}function ge(e){const i=we.get(e);if(!(!i||!i.messages.length))return`Prüfen: ${i.messages.join(" · ")}`}const rt=r.useMemo(()=>Array.from(we.entries()).map(([e,i])=>({field:e,level:i.level,messages:i.messages,label:Js[e]||String(e)})),[we]);function ht(e){Ut.has(e)&&W(["advanced"]),window.setTimeout(()=>{try{k.scrollToField(e,{block:"center"})}catch{}const i=k.getFieldInstance(e);i&&typeof i.focus=="function"&&i.focus()},80)}function At(){var i;const e=(i=rt[0])==null?void 0:i.field;e&&ht(e)}const Ae=r.useMemo(()=>{const e=b||{},i=ea({formFx:e.templateFxRate,settingsFx:G.fxRate,settingsEurUsd:G.eurUsdRate,resolvedFx:O.fxRate.value}),n=v(e.templateUnitPriceUsd),l=v(e.landedUnitCostEur),m=n!=null&&i!=null&&i>0?n/i:null,S=l!=null&&m!=null?l-m:null;return{value:Number.isFinite(S)?Math.max(0,Number(S)):null,warning:Number.isFinite(S)?Number(S)<0:!1,goodsCostEur:m,fxUsed:i,landedUnitCostEur:l,unitCostUsd:n}},[b,O.fxRate.value,G.eurUsdRate,G.fxRate]);r.useEffect(()=>{if(!D||A)return;const e=Number(Ae.value);if(!Number.isFinite(e))return;const i=Math.round(e*100)/100,n=v(k.getFieldValue("logisticsPerUnitEur"));(n==null||Math.abs(n-i)>1e-5)&&k.setFieldValue("logisticsPerUnitEur",i)},[k,A,D,Ae.value]),r.useEffect(()=>{!D||!C.readOnly||!C.remoteDraftPatch||k.setFieldsValue(C.remoteDraftPatch)},[k,C.readOnly,C.remoteDraftPatch,C.remoteDraftVersion,D]),r.useEffect(()=>{if(!D){W([]);return}pt&&W(["advanced"])},[pt,D]);function $t(e){if(k.setFieldsValue({[e]:null}),e==="logisticsPerUnitEur"){z(!1);const i=Number(Ae.value);Number.isFinite(i)&&k.setFieldValue("logisticsPerUnitEur",Math.round(i*100)/100)}}function Y(e,i){const n=String(e.source||"missing"),l=e.source==="missing"&&e.required===!0;return t.jsxs("span",{className:"v2-field-meta",children:[t.jsxs("span",{children:["Effektiv: ",ta(e,i)]}),t.jsxs("span",{className:"v2-field-meta-source",children:[t.jsx("span",{children:"Quelle:"}),t.jsx("span",{className:be(n==="computed"?"settings":n,l),children:e.sourceLabel})]}),t.jsx("span",{children:(i==null?void 0:i.extraHint)||e.hint})]})}function fe(e,i){const n=b==null?void 0:b[i],l=n!=null&&n!=="";return t.jsxs("span",{className:"v2-field-meta-row",children:[t.jsx("span",{children:e}),l?t.jsx(ne,{type:"link",size:"small",className:"v2-field-reset",onClick:m=>{m.preventDefault(),m.stopPropagation(),$t(i)},children:"Zuruecksetzen"}):null]})}function Kt(){const e=mt(void 0);P(null),k.setFieldsValue(e),z(e.logisticsPerUnitEur!=null),W([]),y(!0)}function Bt(){$.setFieldsValue({...dt,scope:"filtered",selectedSkus:pe.map(e=>e.sku)}),B(!0)}function zt(e){const i=e.template&&typeof e.template=="object"?e.template:{},n=i.fields&&typeof i.fields=="object"?i.fields:i;return{template:i,fields:n}}function qt(e,i){if(!i.length)throw new Error("Keine aktiven/prelaunch SKUs im aktuellen Zielumfang.");if(!(e.applyTemplateUnitPriceUsd||e.applyAvgSellingPriceGrossEUR||e.applySellerboardMarginPct||e.applyMoqUnits||e.applyProductionLeadTimeDaysDefault||e.applyTemplateTransitDays||e.applyTemplateDdp))throw new Error("Bitte mindestens ein Feld für den Bulk-Update aktivieren.");const l=(m,S,ve)=>{if(!m)return;const Pe=Number(S);if(!Number.isFinite(Pe))throw new Error(`Bitte gültigen Wert setzen: ${ve}.`)};l(e.applyTemplateUnitPriceUsd,e.templateUnitPriceUsd,"Ø EK (USD)"),l(e.applyAvgSellingPriceGrossEUR,e.avgSellingPriceGrossEUR,"Ø VK (EUR)"),l(e.applySellerboardMarginPct,e.sellerboardMarginPct,"Marge (%)"),l(e.applyMoqUnits,e.moqUnits,"MOQ"),l(e.applyProductionLeadTimeDaysDefault,e.productionLeadTimeDaysDefault,"Production Lead Time"),l(e.applyTemplateTransitDays,e.templateTransitDays,"Transit-Tage")}async function Vt(e){const i=new Set(pe.map(m=>m.sku)),n=e.scope==="selected"?(Array.isArray(e.selectedSkus)?e.selectedSkus:[]).map(m=>String(m||"").trim()).filter(m=>m&&i.has(m)):pe.map(m=>m.sku).filter(m=>i.has(m)),l=new Set(n);qt(e,n),await U(m=>{const S=Ye(m),ve=Array.isArray(S.products)?[...S.products]:[],Pe=ut();let Ee=0;if(S.products=ve.map(Ze=>{const ke=Ze,Ue=String(ke.sku||"").trim();if(!Ue||!l.has(Ue))return ke;const le=String(ke.status||"active").trim().toLowerCase();if(!(le==="active"||le==="prelaunch"||le==="aktiv"||le==="not_launched"||le==="planned"))return ke;const ee={...ke},{template:lt,fields:Wt}=zt(ke),Qe={...Wt};return e.applyAvgSellingPriceGrossEUR&&(ee.avgSellingPriceGrossEUR=Number(e.avgSellingPriceGrossEUR)),e.applySellerboardMarginPct&&(ee.sellerboardMarginPct=Number(e.sellerboardMarginPct)),e.applyMoqUnits&&(ee.moqUnits=Math.max(0,Math.round(Number(e.moqUnits)))),e.applyProductionLeadTimeDaysDefault&&(ee.productionLeadTimeDaysDefault=Math.max(0,Math.round(Number(e.productionLeadTimeDaysDefault)))),e.applyTemplateUnitPriceUsd&&(Qe.unitPriceUsd=Number(e.templateUnitPriceUsd)),e.applyTemplateTransitDays&&(Qe.transitDays=Math.max(0,Math.round(Number(e.templateTransitDays)))),e.applyTemplateDdp&&(Qe.ddp=!!e.templateDdp),ee.template={...lt,scope:lt.scope||"SKU",name:lt.name||"Standard (SKU)",fields:Qe},ee.updatedAt=Pe,Ee+=1,ee}),!Ee)throw new Error("Keine passenden aktiven/prelaunch SKUs im Zielumfang gefunden.");return S},"v2:products:bulk-update"),et.success(`Bulk-Update gespeichert (${n.length} SKU${n.length===1?"":"s"}).`),B(!1),$.resetFields()}async function Ht(e){if(C.readOnly)throw new Error("Dieses Produkt wird gerade von einem anderen Nutzer bearbeitet.");const i=e.sku.trim();if(!i)throw new Error("SKU ist erforderlich.");await U(n=>{const l=Ye(n),m=Array.isArray(l.products)?[...l.products]:[],S=i.toLowerCase();if(m.find($e=>{const ee=$e;return String(ee.sku||"").toLowerCase()===S&&String(ee.id||"")!==String(e.id||"")}))throw new Error("SKU existiert bereits.");const Pe=m.findIndex($e=>String($e.id||"")===String(e.id||"")),Ee=Pe>=0?m[Pe]:null,Ze=ut(),ke={unitPriceUsd:e.templateUnitPriceUsd,transportMode:e.templateTransportMode,productionDays:e.templateProductionDays,transitDays:e.templateTransitDays,freightEur:e.templateFreightEur,dutyPct:e.templateDutyPct,vatImportPct:e.templateVatImportPct,fxRate:e.templateFxRate,currency:e.templateCurrency,ddp:e.templateDdp},Ue={...Ee||{},id:e.id||(Ee==null?void 0:Ee.id)||Ys("prod"),sku:i,alias:e.alias.trim()||i,hsCode:String(e.hsCode||"").trim(),goodsDescription:String(e.goodsDescription||"").trim(),supplierId:e.supplierId||"",categoryId:e.categoryId||null,status:e.status||"active",avgSellingPriceGrossEUR:e.avgSellingPriceGrossEUR,sellerboardMarginPct:e.sellerboardMarginPct,moqUnits:e.moqUnits,safetyStockDohOverride:e.safetyStockDohOverride,foCoverageDohOverride:e.foCoverageDohOverride,moqOverrideUnits:e.moqOverrideUnits,landedUnitCostEur:e.landedUnitCostEur,logisticsPerUnitEur:e.logisticsPerUnitEur,freightPerUnitEur:e.logisticsPerUnitEur,productionLeadTimeDaysDefault:e.productionLeadTimeDaysDefault,template:{scope:"SKU",name:"Standard (SKU)",fields:ke},updatedAt:Ze};Ue.createdAt||(Ue.createdAt=Ze);const le=vt({product:Ue,state:l});if(le.status==="blocked"&&le.blockScope){const $e=le.blockingMissing.map(ee=>ee.label).slice(0,5).join(", ");throw new Error(`Blockierende Stammdaten fehlen: ${$e}${le.blockingMissing.length>5?" ...":""}`)}return Pe>=0?m[Pe]=Ue:m.push(Ue),l.products=m,l},h?"v2:products:update":"v2:products:create"),C.clearDraft(),P(null),y(!1),z(!1),k.resetFields()}return t.jsxs("div",{className:"v2-page",children:[t.jsxs(bt,{className:"v2-intro-card",children:[t.jsx("div",{className:"v2-page-head",children:t.jsxs("div",{children:[t.jsx(Re,{level:3,children:"Produkte"}),t.jsx(ct,{children:"Produktstammdaten fuer Tagesbetrieb und Logistik-Workflow mit klarer Default-/Override-Anzeige."})]})}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(Ke,{wrap:!0,children:[t.jsx(Me,{value:L,onChange:e=>T(e.target.value),placeholder:"Suche SKU, Alias, Supplier, Kategorie, HS-Code, Warenbeschreibung",style:{width:340,maxWidth:"100%"}}),t.jsx(xe,{value:w,onChange:e=>H(e),options:[{value:"all",label:"Alle"},{value:"active",label:"Aktiv"},{value:"prelaunch",label:"Noch nicht gelauncht"},{value:"inactive",label:"Inaktiv"}],style:{width:140,maxWidth:"100%"}}),t.jsxs("div",{className:"v2-products-issue-filters",children:[t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${N==="all"?"is-active":""}`,onClick:()=>K("all"),children:"Alle"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${N==="needs_fix"?"is-active":""}`,onClick:()=>K("needs_fix"),children:"Nur korrigieren"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${N==="revenue"?"is-active":""}`,onClick:()=>K("revenue"),children:"Umsatzrelevant"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${N==="blocked"?"is-active":""}`,onClick:()=>K("blocked"),children:"Nur Blocker"})]}),t.jsx(Bs,{value:f,onChange:e=>F(e),options:[{value:"management",label:"Management"},{value:"logistics",label:"Logistik"}]}),t.jsx(ne,{type:"primary",onClick:Kt,children:"Produkt hinzufuegen"}),t.jsx(ne,{onClick:Bt,children:"Bulk bearbeiten"})]}),t.jsxs(Ke,{wrap:!0,children:[t.jsxs(j,{color:je.needsFix>0?"gold":"green",children:["Korrekturbedarf: ",je.needsFix]}),t.jsxs(j,{color:je.revenue>0?"volcano":"green",children:["Umsatzrelevant: ",je.revenue]}),t.jsxs(j,{color:je.blocked>0?"red":"green",children:["Blocker: ",je.blocked]})]}),c?t.jsx(j,{color:"processing",children:"Speichern..."}):null,p?t.jsxs(j,{color:"green",children:["Gespeichert: ",new Date(p).toLocaleTimeString("de-DE")]}):null]})})]}),d?t.jsx(oe,{type:"error",showIcon:!0,message:d}):null,o?t.jsx(oe,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,t.jsxs(bt,{children:[t.jsxs("div",{className:"v2-category-tools",children:[t.jsxs(We,{type:"secondary",children:[me.length," Produkte in ",q.length," Kategorien"]}),t.jsxs("div",{className:"v2-actions-inline",children:[t.jsx(ne,{size:"small",onClick:()=>Q(q.map(e=>e.key)),disabled:!q.length,children:"Alles auf"}),t.jsx(ne,{size:"small",onClick:()=>Q([]),disabled:!se.length,children:"Alles zu"})]})]}),q.length?t.jsx(xt,{className:"v2-category-collapse",activeKey:se,onChange:e=>Q((Array.isArray(e)?e:[e]).map(String)),items:q.map(e=>({key:e.key,label:t.jsxs(Ke,{children:[t.jsx(We,{strong:!0,children:e.label}),t.jsxs("span",{className:"v2-category-count",children:[e.rows.length," Produkte"]})]}),children:t.jsx("div",{className:"v2-products-grid-host",children:t.jsx(ps,{className:"v2-products-grid-wrap",data:e.rows,columns:Lt,minTableWidth:f==="management"?1120:940,tableLayout:"fixed"})})}))}):t.jsx(We,{type:"secondary",children:"Keine Produkte für den aktuellen Filter."})]}),t.jsxs(Je,{title:"Bulk-Stammdaten bearbeiten",rootClassName:"v2-form-modal",open:ye,onCancel:()=>{B(!1),$.resetFields()},onOk:()=>{$.validateFields().then(e=>Vt(e)).catch(()=>{})},width:900,children:[t.jsx(oe,{type:"info",showIcon:!0,style:{marginBottom:10},message:`Bulk-Editor für aktive/prelaunch SKUs (${pe.length} verfügbar)`,description:"Bulk-Änderungen schreiben explizit auf Produkt-Ebene. Herkunft in Modal/Liste bleibt danach konsistent als „Produkt“."}),t.jsxs(u,{form:$,layout:"vertical",initialValues:dt,children:[t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"scope",label:"Zielumfang",style:{flex:1},children:t.jsx(xe,{options:[{value:"filtered",label:"Alle aktiven/prelaunch aus aktuellem Filter"},{value:"selected",label:"Manuelle SKU-Auswahl"}]})}),t.jsx(u.Item,{label:"Ziel-SKUs (Preview)",style:{width:220},children:t.jsx(Me,{value:String(It.length),disabled:!0})})]}),X.scope==="selected"?t.jsx(u.Item,{name:"selectedSkus",label:"SKUs auswählen",children:t.jsx(xe,{mode:"multiple",allowClear:!0,showSearch:!0,optionFilterProp:"label",placeholder:"SKU(s) wählen",options:Mt})}):null,t.jsxs("div",{className:"v2-bulk-grid",children:[t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyTemplateUnitPriceUsd",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"Ø EK (USD)"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"templateUnitPriceUsd",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"decimal",min:0,disabled:!X.applyTemplateUnitPriceUsd})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyAvgSellingPriceGrossEUR",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"Ø VK (EUR)"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"avgSellingPriceGrossEUR",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"decimal",min:0,disabled:!X.applyAvgSellingPriceGrossEUR})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applySellerboardMarginPct",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"Marge (%)"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"sellerboardMarginPct",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"percent",min:0,max:100,disabled:!X.applySellerboardMarginPct})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyMoqUnits",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"MOQ (Units)"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"moqUnits",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"int",min:0,disabled:!X.applyMoqUnits})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyProductionLeadTimeDaysDefault",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"Production Lead Time (Tage)"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"productionLeadTimeDaysDefault",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"int",min:0,disabled:!X.applyProductionLeadTimeDaysDefault})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyTemplateTransitDays",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"Transit-Tage"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"templateTransitDays",style:{marginBottom:0,minWidth:180},children:t.jsx(I,{mode:"int",min:0,disabled:!X.applyTemplateTransitDays})})]}),t.jsxs("div",{className:"v2-bulk-field-row",children:[t.jsx(u.Item,{name:"applyTemplateDdp",valuePropName:"checked",style:{marginBottom:0},children:t.jsx(Ne,{children:"DDP / Incoterm-Flag"})}),t.jsx(j,{className:be("product",!1),children:"Produkt"}),t.jsx(u.Item,{name:"templateDdp",style:{marginBottom:0,minWidth:180},children:t.jsx(xe,{disabled:!X.applyTemplateDdp,options:[{value:!0,label:"DDP = Ja"},{value:!1,label:"DDP = Nein"}]})})]})]})]})]}),t.jsxs(Je,{title:h?`Produkt bearbeiten: ${h.sku}`:"Produkt hinzufuegen",rootClassName:"v2-form-modal",open:D,onCancel:()=>{C.clearDraft(),y(!1),z(!1),W([])},onOk:()=>{if(C.readOnly){Je.warning({title:"Nur Lesemodus",content:`${C.remoteUserLabel||"Kollege"} bearbeitet dieses Produkt. Bitte Bearbeitung übernehmen oder warten.`});return}k.validateFields().then(e=>Ht(e)).catch(e=>{At();const i=e instanceof Error?e.message:"Stammdaten prüfen";et.warning(i)})},width:1060,children:[C.banner?t.jsx(oe,{style:{marginBottom:10},type:C.banner.tone,showIcon:!0,message:C.banner.text,action:C.readOnly?t.jsx(ne,{size:"small",onClick:C.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,C.readOnly&&C.remoteDraftVersion>0?t.jsxs(j,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",C.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,t.jsxs(u,{name:"v2-products-modal",form:k,layout:"vertical",disabled:C.readOnly,onValuesChange:e=>{C.readOnly||C.publishDraftPatch(e)},children:[t.jsx(u.Item,{name:"id",hidden:!0,children:t.jsx(Me,{})}),Z.status!=="ok"?t.jsx(oe,{style:{marginBottom:10},type:Z.status==="blocked"&&Z.blockScope?"error":"warning",showIcon:!0,message:Z.status==="blocked"&&Z.blockScope?"Blockierende Stammdaten fehlen":"Stammdaten prüfen",description:t.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%"},children:[t.jsx("span",{children:[Z.blockingMissing.length?`Blocker: ${Z.blockingMissing.map(e=>e.label).join(", ")}`:null,Z.importantMissing.length?`Wichtig: ${Z.importantMissing.map(e=>e.label).join(", ")}`:null].filter(Boolean).join(" · ")}),rt.length?t.jsx("div",{className:"v2-issue-chip-row",children:rt.map(e=>t.jsx(ne,{size:"small",className:`v2-issue-chip ${e.level==="error"?"is-error":"is-warning"}`,onClick:()=>ht(e.field),children:e.label},String(e.field)))}):null]})}):null,t.jsxs("div",{className:"v2-form-section",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Basis"}),t.jsx("span",{className:"v2-form-section-desc",children:"Identitaet, Zuordnung und Logistik-Referenzdaten."})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"sku",label:"SKU",style:{flex:1},rules:[{required:!0,message:"SKU fehlt."}],children:t.jsx(Me,{})}),t.jsx(u.Item,{name:"alias",label:"Alias",style:{flex:1},rules:[{required:!0,message:"Alias fehlt."}],children:t.jsx(Me,{})}),t.jsx(u.Item,{name:"status",label:"Status",style:{width:140},children:t.jsx(xe,{options:Xs})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"categoryId",label:"Kategorie",style:{flex:1},children:t.jsx(xe,{allowClear:!0,options:Oe.map(e=>({value:e.id,label:e.name}))})}),t.jsx(u.Item,{name:"supplierId",label:"Supplier",style:{flex:1},children:t.jsx(xe,{allowClear:!0,options:Ve.map(e=>({value:e.id,label:e.name}))})}),t.jsx(u.Item,{name:"hsCode",label:"HS-Code",style:{flex:1},validateStatus:he("hsCode"),help:ge("hsCode"),children:t.jsx(Me,{placeholder:"z. B. 3926.90.97"})})]}),t.jsx("div",{className:"v2-form-row",children:t.jsx(u.Item,{name:"goodsDescription",label:"Warenbeschreibung",style:{gridColumn:"1 / -1"},validateStatus:he("goodsDescription"),help:ge("goodsDescription"),children:t.jsx(Me.TextArea,{rows:2,placeholder:"Kurzbeschreibung fuer Zoll / Logistiker"})})})]}),t.jsxs("div",{className:"v2-form-section",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Preise & Kosten (operativ)"}),t.jsx("span",{className:"v2-form-section-desc",children:"Kerndaten fuer Planung sowie FO/PO-Prefill."})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"avgSellingPriceGrossEUR",label:"Durchschnittlicher Verkaufspreis (EUR)",style:{flex:1},validateStatus:he("avgSellingPriceGrossEUR"),help:ge("avgSellingPriceGrossEUR"),children:t.jsx(I,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:"templateUnitPriceUsd",label:fe("Durchschnittlicher EK (USD)","templateUnitPriceUsd"),style:{flex:1},validateStatus:he("templateUnitPriceUsd"),help:ge("templateUnitPriceUsd"),extra:Y(O.unitPriceUsd,{digits:2}),children:t.jsx(I,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:"landedUnitCostEur",label:"Durchschnittlicher Einstand (EUR)",style:{flex:1},validateStatus:he("landedUnitCostEur"),help:ge("landedUnitCostEur"),extra:t.jsx("span",{className:"v2-field-meta",children:"Landed Cost je Einheit laut Ist-/Logistikdaten."}),children:t.jsx(I,{mode:"decimal",min:0})})]}),t.jsx("div",{className:"v2-form-row",children:t.jsx(u.Item,{name:"logisticsPerUnitEur",label:fe("Ø Shipping China->Lager/3PL (EUR/Stk)","logisticsPerUnitEur"),style:{gridColumn:"1 / -1"},extra:t.jsxs("span",{className:"v2-field-meta",children:[t.jsxs("span",{children:["Effektiv: ",V(v(b==null?void 0:b.logisticsPerUnitEur),2)]}),t.jsxs("span",{className:"v2-field-meta-source",children:[t.jsx("span",{children:"Quelle:"}),t.jsx("span",{className:be(A?"product":O.logisticsPerUnitEur.source==="computed"?"settings":O.logisticsPerUnitEur.source,!1),children:A?"Produkt":O.logisticsPerUnitEur.sourceLabel})]}),t.jsxs("span",{children:["Vorschlag: ",V(v(Ae.value),2)," EUR/Stk (Formel: Einstand (EUR) - EK in EUR)"]}),t.jsxs("span",{children:["EK in EUR (aus USD/FX): ",V(v(Ae.goodsCostEur),2)," EUR/Stk"]}),t.jsxs("span",{children:["FX-Referenz: ",V(v(Ae.fxUsed),4)," USD je EUR"]}),t.jsx("span",{children:"Kann je nach Datenbasis auch Zoll/EUSt/Importnebenkosten enthalten."})]}),children:t.jsx(I,{mode:"decimal",min:0,onChange:()=>z(!0)})})})]}),t.jsxs("div",{className:"v2-form-section",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Lieferzeit"}),t.jsx("span",{className:"v2-form-section-desc",children:"Operative Hauptwerte fuer Produktions- und Transitdauer."})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"productionLeadTimeDaysDefault",label:fe("Production Lead Time (Tage)","productionLeadTimeDaysDefault"),style:{flex:1},validateStatus:he("productionLeadTimeDaysDefault"),help:ge("productionLeadTimeDaysDefault"),extra:Y(O.productionLeadDays,{digits:0}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"templateTransitDays",label:fe("Transit-Tage","templateTransitDays"),style:{flex:1},extra:Y(O.transitDays,{digits:0}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"templateTransportMode",label:"Transportmodus",style:{flex:1},extra:Y(O.transportMode,{kind:"text"}),children:t.jsx(xe,{options:Zs.map(e=>({value:e,label:e}))})})]})]}),t.jsx(xt,{className:"v2-inline-collapse",activeKey:te,onChange:e=>{const i=Array.isArray(e)?e:[e];W(i.map(String).filter(Boolean))},items:[{key:"advanced",label:"Erweitert",children:t.jsxs("div",{className:"v2-form-section v2-form-section-nested",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Policies & Beschaffungs-Template"}),t.jsx("span",{className:"v2-form-section-desc",children:"Optional: produktspezifische Overrides und tiefe Template-Defaults."})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"moqUnits",label:fe("MOQ Units","moqUnits"),style:{flex:1},validateStatus:he("moqUnits"),help:ge("moqUnits"),extra:Y(O.moqEffective,{digits:0}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"moqOverrideUnits",label:fe("MOQ Override Units","moqOverrideUnits"),style:{flex:1},extra:t.jsx("span",{className:"v2-field-meta",children:"Nur fuer dieses Produkt. Leer = Defaultkette."}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"sellerboardMarginPct",label:"Sellerboard Marge %",style:{flex:1},validateStatus:he("sellerboardMarginPct"),help:ge("sellerboardMarginPct"),extra:t.jsx("span",{className:"v2-field-meta",children:"Optional fuer Legacy-Kompatibilitaet / Reporting."}),children:t.jsx(I,{mode:"percent",min:0,max:100})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"safetyStockDohOverride",label:fe("Safety Stock DOH Override","safetyStockDohOverride"),style:{flex:1},extra:Y(O.safetyDohEffective,{digits:0}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"foCoverageDohOverride",label:fe("FO Coverage DOH Override","foCoverageDohOverride"),style:{flex:1},extra:Y(O.coverageDohEffective,{digits:0}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"templateCurrency",label:"Waehrung",style:{flex:1},extra:Y(O.currency,{kind:"text"}),children:t.jsx(xe,{options:Qs.map(e=>({value:e,label:e}))})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"templateProductionDays",label:"Template Produktionstage",style:{flex:1},extra:t.jsx("span",{className:"v2-field-meta",children:"Nur fuer Template-Fallbacks, falls keine operative Lead-Time gepflegt ist."}),children:t.jsx(I,{mode:"int",min:0})}),t.jsx(u.Item,{name:"templateFreightEur",label:"Template Logistik/Stk (EUR)",style:{flex:1},extra:t.jsx("span",{className:"v2-field-meta",children:"Fallback, wenn kein produktspezifischer Shipping-Wert gesetzt ist."}),children:t.jsx(I,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:"templateFxRate",label:fe("FX Rate (USD je EUR)","templateFxRate"),style:{flex:1},extra:Y(O.fxRate,{digits:4}),children:t.jsx(I,{mode:"fx",min:0})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"templateDutyPct",label:"Zoll %",style:{flex:1},extra:Y(O.dutyPct,{digits:2}),children:t.jsx(I,{mode:"percent",min:0,max:100})}),t.jsx(u.Item,{name:"templateVatImportPct",label:"EUSt %",style:{flex:1},extra:Y(O.eustPct,{digits:2}),children:t.jsx(I,{mode:"percent",min:0,max:100})}),t.jsx(u.Item,{name:"templateDdp",label:"Incoterm / DDP",valuePropName:"checked",validateStatus:he("templateDdp"),help:ge("templateDdp"),extra:Y(O.ddp,{kind:"boolean"}),children:t.jsx(Ne,{children:"DDP aktiv (Door-to-Door, Importkosten im Lieferpreis)"})})]})]})},{key:"seasonality",label:"Saisonalitaet (berechnet)",children:t.jsxs("div",{className:"v2-form-section v2-form-section-nested",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Saisonalitaet aus Forecast-CSV"}),t.jsx("span",{className:"v2-form-section-desc",children:"Jan-Dez Faktoren aus den importierten Monats-Units je SKU."})]}),t.jsx(ct,{type:"secondary",style:{marginBottom:8},children:"Wir nehmen die Monatsabsatze (Units) aus der importierten CSV, bilden fuer jeden Kalendermonat (z. B. alle Januare) den Durchschnitt und teilen ihn durch den durchschnittlichen Monatswert ueber alle Monate. So entstehen Multiplikatoren, die zeigen, wie stark oder schwach ein Monat typischerweise im Vergleich zum Durchschnitt ist."}),Le?J?t.jsxs(t.Fragment,{children:[t.jsxs(Ke,{wrap:!0,style:{marginBottom:8},children:[t.jsxs(j,{color:"blue",children:["Zeitraum: ",ot(J.startMonth)," bis ",ot(J.endMonth)," ","(",J.sampleMonthCount," Monate)"]}),t.jsxs(j,{color:J.coveredMonthTypes===12?"green":"gold",children:["Kalendermonate mit Daten: ",J.coveredMonthTypes,"/12"]}),t.jsxs(j,{children:["Ø Monats-Units (Basis): ",V(J.overallAverage,1)," (aus ",J.sampleMonthCount," Monatsdaten)"]})]}),t.jsx("div",{className:"v2-seasonality-chart",role:"group","aria-label":"Saisonalitaetsfaktoren",children:wt.map(e=>t.jsx(ms,{title:`Faktor: ${V(v(e.factor),2)} | Ø Units: ${V(v(e.averageUnits),1)} | Datenpunkte: ${e.sampleCount}`,children:t.jsxs("div",{className:"v2-seasonality-chart-row",children:[t.jsx("span",{className:"v2-seasonality-month",children:e.monthLabel}),t.jsxs("div",{className:"v2-seasonality-bar-track",children:[t.jsx("div",{className:"v2-seasonality-average-line",style:{left:`${1/(e.scaleMax||1)*100}%`}}),t.jsx("div",{className:`v2-seasonality-bar v2-seasonality-bar--${e.classification}`,style:{width:`${e.widthPercent}%`}})]}),t.jsxs("span",{className:"v2-seasonality-value",children:[V(v(e.factor),2),t.jsxs("span",{className:"v2-seasonality-subvalue",children:[V(v(e.averageUnits),1)," / n=",e.sampleCount]})]})]})},e.key))}),t.jsx(ct,{type:"secondary",style:{margin:"8px 0 0"},children:"Faktor 1,00 = durchschnittlicher Monat, 1,40 = 40 % ueberdurchschnittlich, 0,70 = 30 % unterdurchschnittlich."})]}):t.jsx(oe,{type:"warning",showIcon:!0,message:`Keine Forecast-Daten fuer SKU ${Le}`,description:"Bitte Forecast-CSV importieren. Das Profil wird aus den importierten Monats-Units abgeleitet."}):t.jsx(oe,{type:"info",showIcon:!0,message:"Keine SKU gesetzt",description:"Saisonalitaet wird angezeigt, sobald eine SKU im Produkt gesetzt ist."})]})},{key:"plan-vs-live",label:"Plan-vs-Ist (Plan -> Live)",children:t.jsxs("div",{className:"v2-form-section v2-form-section-nested",children:[t.jsxs("div",{className:"v2-form-section-head",children:[t.jsx(Re,{level:5,className:"v2-form-section-title",children:"Lessons Learned: Plan vs Live/CSV"}),t.jsx("span",{className:"v2-form-section-desc",children:"Monatlicher Vergleich nach Übernahme eines Plan-Produkts in eine Live-SKU."})]}),Le?re?Xe.length?t.jsxs(t.Fragment,{children:[t.jsxs(Ke,{wrap:!0,style:{marginBottom:8},children:[t.jsxs(j,{color:"blue",children:["Plan: ",re.planProductAlias||re.planProductId]}),t.jsxs(j,{color:"green",children:["Live-SKU: ",re.sku]}),t.jsxs(j,{children:["Übernommen: ",re.mappedAt?new Date(re.mappedAt).toLocaleDateString("de-DE"):"—"]}),t.jsxs(j,{children:["Launch: ",re.launchDate||"—"]}),t.jsxs(j,{color:Xe.length>=12?"green":"gold",children:["Monate im Vergleich: ",Xe.length]})]}),t.jsx(Ns,{size:"small",pagination:!1,rowKey:"month",dataSource:Xe,columns:[{title:"Monat",dataIndex:"month",key:"month",render:e=>ot(e)},{title:"Plan Units",dataIndex:"planUnits",key:"planUnits",align:"right",render:e=>V(v(e),0)},{title:"Live Units (CSV)",dataIndex:"liveUnits",key:"liveUnits",align:"right",render:e=>V(v(e),0)},{title:"Delta Units",dataIndex:"deltaUnits",key:"deltaUnits",align:"right",render:e=>V(v(e),0)},{title:"Delta %",dataIndex:"deltaPct",key:"deltaPct",align:"right",render:e=>{const i=v(e);return Number.isFinite(i)?`${V(i,1)}%`:"—"}}]})]}):t.jsx(oe,{type:"warning",showIcon:!0,message:"Noch keine überlappenden Monatsdaten",description:"Für Plan oder Live/CSV sind aktuell keine gemeinsamen Monatswerte vorhanden."}):t.jsx(oe,{type:"info",showIcon:!0,message:"Kein Plan->Live Mapping für diese SKU",description:"Die Ansicht wird automatisch verfügbar, sobald ein Plan-Produkt als gelauncht markiert und dieser SKU zugeordnet wurde."}):t.jsx(oe,{type:"info",showIcon:!0,message:"Keine SKU gesetzt",description:"Plan-vs-Ist wird angezeigt, sobald eine SKU im Produkt gesetzt ist."})]})}]})]})]})]})}export{Na as default};
