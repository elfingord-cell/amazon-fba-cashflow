import{W as _e,t as i,X as Ue,Y as Fe,Z as $e,$ as We,M as q,a0 as Ke,a1 as Ve,a2 as xe,a3 as Ge,a4 as qe,a5 as He,a6 as u,k as n,J as Ye,S as V,N as b,I as se,O as H,a7 as je,U as te,P as Xe,a8 as Je,V as ge,a9 as Ze,aa as Oe}from"./index-BX0hCHd9.js";import{D as Z}from"./DeNumberInput-BKhnEnVS.js";import{b as Qe}from"./tableModels-g2ItoRHR.js";import{f as oe}from"./months-DiLwPhVv.js";import{u as en,C as Se}from"./workspace-C5RCXX1l.js";import{b as nn,a as Ie,c as tn,m as ie,P as Ae,n as rn,d as an}from"./planProducts-Cw71DzXi.js";import{F as Ne}from"./Table-DxoWZYnf.js";import{g as Re,P as sn,a as on}from"./index-BZ9rJQ5G.js";import{S as L}from"./index-DzJjwXuy.js";import{C as ln}from"./index-D7NwOxsn.js";import{s as le}from"./index-BwH3Pskl.js";import"./index-DVmxEQnU.js";import"./productCompletenessV2-B77TS4Tc.js";import"./Dropdown-Dqfaj-V1.js";import"./index-J71TIXUx.js";import"./useBubbleLock-J8y-aVQh.js";import"./Pagination-6S75qB_v.js";const cn=r=>{const{componentCls:a,iconCls:d,antCls:o,zIndexPopup:c,colorText:g,colorWarning:j,marginXXS:y,marginXS:f,fontSize:w,fontWeightStrong:_,colorTextHeading:M}=r;return{[a]:{zIndex:c,[`&${o}-popover`]:{fontSize:w},[`${a}-message`]:{marginBottom:f,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${a}-message-icon ${d}`]:{color:j,fontSize:w,lineHeight:1,marginInlineEnd:f},[`${a}-title`]:{fontWeight:_,color:M,"&:only-child":{fontWeight:"normal"}},[`${a}-description`]:{marginTop:y,color:g}},[`${a}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:f}}}}},un=r=>{const{zIndexPopupBase:a}=r;return{zIndexPopup:a+60}},Be=_e("Popconfirm",r=>cn(r),un,{resetStyle:!1});var dn=function(r,a){var d={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.indexOf(o)<0&&(d[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(r);c<o.length;c++)a.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(r,o[c])&&(d[o[c]]=r[o[c]]);return d};const Le=r=>{const{prefixCls:a,okButtonProps:d,cancelButtonProps:o,title:c,description:g,cancelText:j,okText:y,okType:f="primary",icon:w=i.createElement(Ue,null),showCancel:_=!0,close:M,onConfirm:U,onCancel:$,onPopupClick:E}=r,{getPrefixCls:I}=i.useContext(Fe),[x]=$e("Popconfirm",We.Popconfirm),m=Re(c),W=Re(g);return i.createElement("div",{className:`${a}-inner-content`,onClick:E},i.createElement("div",{className:`${a}-message`},w&&i.createElement("span",{className:`${a}-message-icon`},w),i.createElement("div",{className:`${a}-message-text`},m&&i.createElement("div",{className:`${a}-title`},m),W&&i.createElement("div",{className:`${a}-description`},W))),i.createElement("div",{className:`${a}-buttons`},_&&i.createElement(q,Object.assign({onClick:$,size:"small"},o),j||(x==null?void 0:x.cancelText)),i.createElement(Ke,{buttonProps:Object.assign(Object.assign({size:"small"},Ve(f)),d),actionFn:U,close:M,prefixCls:I("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},y||(x==null?void 0:x.okText))))},mn=r=>{const{prefixCls:a,placement:d,className:o,style:c}=r,g=dn(r,["prefixCls","placement","className","style"]),{getPrefixCls:j}=i.useContext(Fe),y=j("popconfirm",a),[f]=Be(y);return f(i.createElement(sn,{placement:d,className:xe(y,o),style:c,content:i.createElement(Le,Object.assign({prefixCls:y},g))}))};var pn=function(r,a){var d={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.indexOf(o)<0&&(d[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(r);c<o.length;c++)a.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(r,o[c])&&(d[o[c]]=r[o[c]]);return d};const hn=i.forwardRef((r,a)=>{var d,o;const{prefixCls:c,placement:g="top",trigger:j="click",okType:y="primary",icon:f=i.createElement(Ue,null),children:w,overlayClassName:_,onOpenChange:M,onVisibleChange:U,overlayStyle:$,styles:E,classNames:I}=r,x=pn(r,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:m,className:W,style:Q,classNames:C,styles:re}=Ge("popconfirm"),[Y,F]=qe(!1,{value:(d=r.open)!==null&&d!==void 0?d:r.visible,defaultValue:(o=r.defaultOpen)!==null&&o!==void 0?o:r.defaultVisible}),z=(P,N)=>{F(P,!0),U==null||U(P),M==null||M(P,N)},T=P=>{z(!1,P)},S=P=>{var N;return(N=r.onConfirm)===null||N===void 0?void 0:N.call(void 0,P)},X=P=>{var N;z(!1,P),(N=r.onCancel)===null||N===void 0||N.call(void 0,P)},ue=(P,N)=>{const{disabled:e=!1}=r;e||z(P,N)},ee=m("popconfirm",c),de=xe(ee,W,_,C.root,I==null?void 0:I.root),me=xe(C.body,I==null?void 0:I.body),[pe]=Be(ee);return pe(i.createElement(on,Object.assign({},He(x,["title"]),{trigger:j,placement:g,onOpenChange:ue,open:Y,ref:a,classNames:{root:de,body:me},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},re.root),Q),$),E==null?void 0:E.root),body:Object.assign(Object.assign({},re.body),E==null?void 0:E.body)},content:i.createElement(Le,Object.assign({okType:y,icon:f},r,{prefixCls:ee,close:T,onConfirm:S,onCancel:X})),"data-popover-inject":!0}),w))}),ze=hn;ze._InternalPanelDoNotUseOrYouWillBeFired=mn;const{Paragraph:we,Text:G,Title:Ce}=Ye,Me={standalone:"Standalone",variant_of_existing:"Variant of Existing",category_adjacent:"Category Adjacent"};function ce(){return new Date().toISOString()}function Ee(r){return`${r}-${Math.random().toString(36).slice(2,9)}`}function l(r){if(r==null||r==="")return null;const a=Number(r);return Number.isFinite(a)?a:null}function Te(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}function k(r,a=0){const d=Number(r);return Number.isFinite(d)?d.toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a}):"—"}function be(r){const a=an(r||{},0),d=Array.isArray(a.launchCosts)?a.launchCosts:[];return{id:a.id||"",alias:a.alias||"",plannedSku:a.plannedSku||"",relationType:a.relationType||Ae[0],categoryId:a.categoryId||null,status:a.status||"active",portfolioBucket:Oe(a.portfolioBucket,H.PLAN),includeInForecast:a.includeInForecast!==!1,launchCosts:d.map((o,c)=>{const g=o;return{id:String(g.id||`lc-${c+1}`),type:String(g.type||g.category||"Sonstiges"),amountEur:l(g.amountEur??g.amount),currency:String(g.currency||"EUR"),date:String(g.date||""),note:String(g.note||"")}}),baselineReferenceMonth:l(a.baselineReferenceMonth),baselineUnitsInReferenceMonth:l(a.baselineUnitsInReferenceMonth),seasonalityReferenceSku:a.seasonalityReferenceSku||"",baselineReferenceSku:a.baselineReferenceSku||"",avgSellingPriceGrossEUR:l(a.avgSellingPriceGrossEUR),sellerboardMarginPct:l(a.sellerboardMarginPct),launchDate:a.launchDate||Te(),rampUpWeeks:l(a.rampUpWeeks),softLaunchStartSharePct:l(a.softLaunchStartSharePct)}}function Fn(){const{state:r,loading:a,saving:d,error:o,lastSavedAt:c,saveWith:g}=en(),[j,y]=i.useState(!1),[f,w]=i.useState(null),[_,M]=i.useState(!1),[U,$]=i.useState(null),[E,I]=i.useState(""),[x]=u.useForm(),m=u.useWatch([],x),W=r,Q=r.settings&&typeof r.settings=="object"?r.settings:{},C=i.useMemo(()=>Qe(Q),[Q.horizonMonths,Q.startMonth]),re=i.useMemo(()=>(Array.isArray(r.productCategories)?r.productCategories:[]).map(e=>({id:String(e.id||""),name:String(e.name||"Ohne Kategorie")})).filter(e=>e.id),[r.productCategories]),Y=i.useMemo(()=>(Array.isArray(r.products)?r.products:[]).map(e=>{const t=e,s=String(t.sku||"").trim();if(!s)return null;const p=String(t.alias||s);return{value:s,label:`${p} · ${s}`}}).filter(Boolean),[r.products]),F=i.useMemo(()=>nn({state:W,months:C}),[C,W]),z=i.useMemo(()=>f&&F.find(e=>String(e.id||"")===f)||null,[f,F]),T=i.useMemo(()=>U&&F.find(e=>String(e.id||"")===U)||null,[F,U]),S=i.useMemo(()=>{var t;if(!j)return null;const e=m||be(z||void 0);return Ie({planProduct:e,forecastImport:((t=r.forecast)==null?void 0:t.forecastImport)||{},months:C,fallbackIndex:0})},[m,z,j,C,r.forecast]),X=i.useMemo(()=>{var R;if(!j)return null;const e=m||be(z||void 0),t=String(e.baselineReferenceSku||"").trim(),s=Number(e.baselineReferenceMonth||0);if(!t||s<1||s>12)return null;const p=((R=r.forecast)==null?void 0:R.forecastImport)||{},h=tn(p,t);if(!h)return null;const O=l((h.averagesByMonthNumber||{})[s]);return Number.isFinite(O)?{sku:t,baselineMonth:s,monthAverageUnits:O}:null},[m,z,j,r.forecast]);function ue(){w(null),x.setFieldsValue({alias:"",plannedSku:"",relationType:"standalone",categoryId:null,status:"active",portfolioBucket:H.PLAN,includeInForecast:!0,launchCosts:[],baselineReferenceMonth:new Date().getMonth()+1,baselineUnitsInReferenceMonth:null,seasonalityReferenceSku:"",baselineReferenceSku:"",avgSellingPriceGrossEUR:null,sellerboardMarginPct:null,launchDate:Te(),rampUpWeeks:8,softLaunchStartSharePct:0}),y(!0)}function ee(e){w(String(e.id||"")),x.setFieldsValue(be(e)),y(!0)}async function de(e){await g(t=>{const s=ge(t),p=Array.isArray(s.planProducts)?s.planProducts:[];return s.planProducts=p.filter(h=>String(h.id||"")!==e),s},"v2:plan-products:delete"),le.success("Plan-Produkt entfernt.")}async function me(e){const t=String(e.alias||"").trim();if(!t)throw new Error("Alias ist erforderlich.");const s=e.includeInForecast!==!1;if(s&&!e.seasonalityReferenceSku)throw new Error("Bitte Referenz-SKU für Saisonalität wählen.");const p=Number(e.baselineReferenceMonth||0);if(s&&(!Number.isFinite(p)||p<1||p>12))throw new Error("Referenzmonat muss zwischen 1 und 12 liegen.");const h=Number(e.baselineUnitsInReferenceMonth||0);if(s&&(!Number.isFinite(h)||h<=0))throw new Error("Baseline Units im Referenzmonat müssen > 0 sein.");const O=Number(e.avgSellingPriceGrossEUR||0);if(s&&(!Number.isFinite(O)||O<=0))throw new Error("Bitte einen gültigen Preis (EUR) für Revenue-Berechnung pflegen.");const R=Number(e.sellerboardMarginPct||0);if(s&&(!Number.isFinite(R)||R<=0||R>100))throw new Error("Bitte eine gültige Brutto-Marge (%) > 0 und <= 100 pflegen.");const D=rn(e.launchDate);if(!D)throw new Error("Launch-Datum ist erforderlich.");const K=Math.round(Number(e.rampUpWeeks||0));if(!Number.isFinite(K)||K<=0)throw new Error("Ramp-up Wochen müssen größer als 0 sein.");const J=Number(e.softLaunchStartSharePct||0);if(!Number.isFinite(J)||J<0||J>100)throw new Error("Soft-Launch Start in % muss zwischen 0 und 100 liegen.");await g(v=>{var ve;const A=ge(v),B=Array.isArray(A.planProducts)?[...A.planProducts]:[],he=t.toLowerCase();if(B.find(ne=>{const ke=ne;return String(ke.alias||"").trim().toLowerCase()===he?f?String(ke.id||"")!==f:!0:!1}))throw new Error(`Alias "${t}" existiert bereits bei einem Plan-Produkt.`);const fe=f||Ee("plan"),De=Ze(e.launchCosts,`plan-${fe}-lc`),ye={id:fe,alias:t,plannedSku:String(e.plannedSku||"").trim(),relationType:String(e.relationType||"standalone"),categoryId:e.categoryId||null,status:e.status||"active",portfolioBucket:Oe(e.portfolioBucket,H.PLAN),includeInForecast:s,launchCosts:De,baselineReferenceMonth:p,baselineUnitsInReferenceMonth:h,seasonalityReferenceSku:String(e.seasonalityReferenceSku||"").trim(),baselineReferenceSku:String(e.baselineReferenceSku||"").trim(),avgSellingPriceGrossEUR:O,sellerboardMarginPct:R,launchDate:D,rampUpWeeks:K,softLaunchStartSharePct:J,updatedAt:ce(),createdAt:f?String(((ve=B.find(ne=>String(ne.id||"")===f))==null?void 0:ve.createdAt)||ce()):ce()},Pe=B.findIndex(ne=>String(ne.id||"")===fe);return Pe>=0?B[Pe]=ye:B.push(ye),A.planProducts=B,A},f?"v2:plan-products:update":"v2:plan-products:create"),le.success(f?"Plan-Produkt aktualisiert.":"Plan-Produkt angelegt."),y(!1),w(null),x.resetFields()}function pe(e){const t=String(e.id||"").trim();if(!t)return;$(t);const s=String(e.plannedSku||"").trim();I(s),M(!0)}async function P(){const e=String(U||"").trim(),t=String(E||"").trim();if(!e)throw new Error("Plan-Produkt nicht gefunden.");if(!t)throw new Error("Bitte SKU für die Übernahme wählen.");if(!Y.some(p=>p.value===t))throw new Error("Die gewählte SKU ist nicht in der Live-Produktdatenbank vorhanden.");await g(p=>{const h=ge(p),O=h,R=Array.isArray(h.planProducts)?[...h.planProducts]:[],D=R.findIndex(ae=>String(ae.id||"")===e);if(D<0)throw new Error("Plan-Produkt wurde nicht gefunden.");const K=O.forecast&&typeof O.forecast=="object"?O.forecast:{},J=K.forecastImport&&typeof K.forecastImport=="object"?K.forecastImport:{},v=Ie({planProduct:R[D],forecastImport:J,months:C,fallbackIndex:D}),A=ce(),B={id:Ee("plan-map"),planProductId:String(v.id||e),planProductAlias:String(v.alias||""),sku:t,plannedSku:String(v.plannedSku||""),mappedAt:A,launchDate:String(v.launchDate||""),rampUpWeeks:Number(v.rampUpWeeks||0)||null,softLaunchStartSharePct:Number(v.softLaunchStartSharePct||0),baselineReferenceMonth:Number(v.baselineReferenceMonth||0)||null,baselineUnitsInReferenceMonth:Number(v.baselineUnitsInReferenceMonth||0)||null,seasonalityReferenceSku:String(v.seasonalityReferenceSku||""),months:[...v.months],planUnitsByMonth:{...v.unitsByMonth||{}},planRevenueByMonth:{...v.revenueByMonth||{}},source:"plan_product"},he=Array.isArray(h.planProductMappings)?[...h.planProductMappings]:[];return h.planProductMappings=[...he.filter(ae=>String(ae.planProductId||"")!==B.planProductId),B],R[D]={...R[D],status:"archived",plannedSku:t,mappedSku:t,mappedAt:A,archivedAt:A,updatedAt:A},h.planProducts=R,h},"v2:plan-products:takeover"),le.success(`Plan-Produkt wurde als Live-SKU ${t} übernommen und archiviert.`),M(!1),$(null),I(""),window.location.hash=`#/v2/products?source=plan-products&sku=${encodeURIComponent(t)}`}const N=i.useMemo(()=>F.map(e=>({...e,monthPreview:C.slice(0,3).map(t=>{var s;return`${oe(t)}: ${k((s=e.unitsByMonth)==null?void 0:s[t],0)}`}).join(" · ")})),[C,F]);return n.jsxs("div",{className:"v2-page",children:[n.jsxs(Se,{className:"v2-intro-card",children:[n.jsxs("div",{className:"v2-page-head",children:[n.jsxs("div",{children:[n.jsx(Ce,{level:3,children:"Neue Produkte (Plan-Produkte)"}),n.jsx(we,{children:"Pre-SKU Produkte mit Referenzmonat-Baseline und übernommener Saisonalität aus bestehender SKU. Monats-Units werden automatisch über den Forecast-Horizont berechnet."})]}),n.jsx(V,{children:n.jsx(q,{type:"primary",onClick:ue,children:"Plan-Produkt hinzufügen"})})]}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsxs(b,{color:"blue",children:["Plan-Produkte: ",F.length]}),n.jsxs(b,{color:"green",children:["Aktiv: ",F.filter(e=>String(e.status||"")==="active").length]}),n.jsxs(b,{children:["Horizont: ",C.length," Monate"]}),d?n.jsx(b,{color:"processing",children:"Speichern..."}):null,c?n.jsxs(b,{color:"green",children:["Gespeichert: ",new Date(c).toLocaleTimeString("de-DE")]}):null]})})]}),o?n.jsx(se,{type:"error",showIcon:!0,message:o}):null,a?n.jsx(se,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsx(Se,{children:n.jsx(Ne,{rowKey:e=>String(e.id||e.key||""),size:"small",pagination:!1,dataSource:N,columns:[{title:"Alias",dataIndex:"alias",key:"alias",sorter:(e,t)=>String(e.alias||"").localeCompare(String(t.alias||""),"de-DE"),render:e=>n.jsxs(V,{size:6,children:[n.jsx(b,{color:"blue",children:"Plan"}),n.jsx(G,{strong:!0,children:e||"—"})]})},{title:"Pre-SKU",dataIndex:"plannedSku",key:"plannedSku",sorter:(e,t)=>String(e.plannedSku||"").localeCompare(String(t.plannedSku||""),"de-DE"),render:e=>e||n.jsx(G,{type:"secondary",children:"ohne SKU"})},{title:"Relation",dataIndex:"relationType",key:"relationType",sorter:(e,t)=>String(e.relationType||"").localeCompare(String(t.relationType||""),"de-DE"),render:e=>Me[e]||e||"—"},{title:"Bucket",dataIndex:"portfolioBucket",key:"portfolioBucket",sorter:(e,t)=>String(e.portfolioBucket||"").localeCompare(String(t.portfolioBucket||""),"de-DE"),render:e=>n.jsx(b,{color:e===H.CORE?"green":e===H.PLAN?"gold":"blue",children:e||H.PLAN})},{title:"Forecast",dataIndex:"includeInForecast",key:"includeInForecast",sorter:(e,t)=>+!!e.includeInForecast-+!!t.includeInForecast,render:e=>e===!1?n.jsx(b,{children:"Nein"}):n.jsx(b,{color:"green",children:"Ja"})},{title:"Baseline",key:"baseline",sorter:(e,t)=>Number(l(e.baselineUnitsInReferenceMonth)||0)-Number(l(t.baselineUnitsInReferenceMonth)||0),render:(e,t)=>n.jsxs("span",{children:[ie(t.baselineReferenceMonth)," · ",k(t.baselineUnitsInReferenceMonth,0)," Units"]})},{title:"Saisonalität von",dataIndex:"seasonalityReferenceSku",key:"seasonalityReferenceSku",sorter:(e,t)=>String(e.seasonalityReferenceSku||"").localeCompare(String(t.seasonalityReferenceSku||""),"de-DE"),render:e=>e||"—"},{title:"Preis (EUR)",dataIndex:"avgSellingPriceGrossEUR",key:"avgSellingPriceGrossEUR",align:"right",sorter:(e,t)=>Number(l(e.avgSellingPriceGrossEUR)||0)-Number(l(t.avgSellingPriceGrossEUR)||0),render:e=>k(e,2)},{title:"Brutto-Marge %",dataIndex:"sellerboardMarginPct",key:"sellerboardMarginPct",align:"right",sorter:(e,t)=>Number(l(e.sellerboardMarginPct)||0)-Number(l(t.sellerboardMarginPct)||0),render:e=>k(e,2)},{title:"Launch & Ramp",key:"launchRamp",sorter:(e,t)=>String(e.launchDate||"").localeCompare(String(t.launchDate||"")),render:(e,t)=>n.jsxs("span",{children:[String(t.launchDate||"—")," · ",k(l(t.rampUpWeeks),0),"W · Start ",k(l(t.softLaunchStartSharePct),0),"%"]})},{title:"Vorschau (Next 3)",dataIndex:"monthPreview",key:"monthPreview",sorter:(e,t)=>String(e.monthPreview||"").localeCompare(String(t.monthPreview||""),"de-DE")},{title:"Status",dataIndex:"status",key:"status",sorter:(e,t)=>String(e.status||"").localeCompare(String(t.status||""),"de-DE"),render:(e,t)=>{if(e==="archived"){const s=String(t.mappedSku||t.plannedSku||"");return n.jsxs(V,{direction:"vertical",size:2,children:[n.jsx(b,{children:"Archiviert"}),s?n.jsxs(G,{type:"secondary",children:["Live-SKU: ",s]}):null]})}return e==="draft"?n.jsx(b,{color:"gold",children:"Draft"}):n.jsx(b,{color:"green",children:"Aktiv"})}},{title:"Aktionen",key:"actions",render:(e,t)=>n.jsxs(V,{size:6,children:[n.jsx(q,{size:"small",onClick:()=>ee(t),children:"Bearbeiten"}),n.jsx(q,{size:"small",type:"primary",ghost:!0,onClick:()=>pe(t),disabled:String(t.status||"")==="archived",children:"Als gelauncht markieren"}),n.jsx(ze,{title:"Plan-Produkt löschen?",onConfirm:()=>{de(String(t.id||""))},children:n.jsx(q,{size:"small",danger:!0,children:"Löschen"})})]})}],locale:{emptyText:"Noch keine Plan-Produkte angelegt."}})}),n.jsxs(je,{title:f?"Plan-Produkt bearbeiten":"Plan-Produkt anlegen",rootClassName:"v2-form-modal",open:j,onCancel:()=>{y(!1),w(null),x.resetFields()},onOk:()=>{x.validateFields().then(e=>me(e)).catch(()=>{})},width:980,children:[n.jsxs(u,{form:x,layout:"vertical",children:[n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:"alias",label:"Alias",rules:[{required:!0,message:"Alias ist erforderlich."}],children:n.jsx(te,{placeholder:"z. B. Messerblock Premium"})}),n.jsx(u.Item,{name:"plannedSku",label:"Planned SKU (optional)",children:n.jsx(te,{placeholder:"optional, falls intern bereits vergeben"})}),n.jsx(u.Item,{name:"portfolioBucket",label:"Portfolio Bucket",initialValue:H.PLAN,children:n.jsx(L,{options:Xe.map(e=>({value:e,label:e}))})}),n.jsx(u.Item,{name:"status",label:"Status",initialValue:"active",children:n.jsx(L,{options:[{value:"active",label:"Aktiv"},{value:"draft",label:"Draft"},{value:"archived",label:"Archiviert"}]})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(u.Item,{name:"includeInForecast",valuePropName:"checked",initialValue:!0,children:n.jsx(ln,{children:"Im Forecast berücksichtigen"})})}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:"relationType",label:"Relation",rules:[{required:!0}],children:n.jsx(L,{options:Ae.map(e=>({value:e,label:Me[e]||e}))})}),n.jsx(u.Item,{name:"categoryId",label:"Kategorie",children:n.jsx(L,{allowClear:!0,options:re.map(e=>({value:e.id,label:e.name}))})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:"avgSellingPriceGrossEUR",label:"Preis (EUR) für Revenue",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0?Promise.resolve():Promise.reject(new Error("Preis ist erforderlich."))}}],children:n.jsx(Z,{mode:"decimal",min:0})}),n.jsx(u.Item,{name:"sellerboardMarginPct",label:"Brutto-Marge (%)",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0&&s<=100?Promise.resolve():Promise.reject(new Error("Marge muss > 0 und <= 100 sein."))}}],children:n.jsx(Z,{mode:"percent",min:0,max:100})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:"baselineReferenceMonth",label:"Referenzmonat",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>=1&&s<=12?Promise.resolve():Promise.reject(new Error("Referenzmonat ist erforderlich."))}}],children:n.jsx(L,{options:Array.from({length:12},(e,t)=>({value:t+1,label:`${ie(t+1)} (${t+1})`}))})}),n.jsx(u.Item,{name:"baselineUnitsInReferenceMonth",label:"Baseline Units im Referenzmonat",rules:[{validator:(e,t)=>{if((m==null?void 0:m.includeInForecast)===!1)return Promise.resolve();const s=Number(t);return Number.isFinite(s)&&s>0?Promise.resolve():Promise.reject(new Error("Baseline Units sind erforderlich."))}}],children:n.jsx(Z,{mode:"int",min:0})}),n.jsx(u.Item,{name:"seasonalityReferenceSku",label:"Saisonalität übernehmen von SKU",rules:[{validator:(e,t)=>(m==null?void 0:m.includeInForecast)===!1||String(t||"").trim()?Promise.resolve():Promise.reject(new Error("Referenz-SKU ist erforderlich."))}],children:n.jsx(L,{showSearch:!0,optionFilterProp:"label",options:Y})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(u.Item,{name:"baselineReferenceSku",label:"Baseline-Referenz-SKU (optional)",children:n.jsx(L,{allowClear:!0,showSearch:!0,optionFilterProp:"label",options:Y})})}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:"launchDate",label:"Launch-Datum",rules:[{required:!0,message:"Launch-Datum ist erforderlich."}],children:n.jsx(te,{type:"date"})}),n.jsx(u.Item,{name:"rampUpWeeks",label:"Ramp-up (Wochen)",rules:[{required:!0,message:"Ramp-up Wochen sind erforderlich."}],children:n.jsx(Z,{mode:"int",min:1})}),n.jsx(u.Item,{name:"softLaunchStartSharePct",label:"Soft-Launch Start (%)",extra:"Startniveau am Launch-Tag. 0 = Start bei 0 %, 20 = Start bei 20 %.",children:n.jsx(Z,{mode:"percent",min:0,max:100})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(u.List,{name:"launchCosts",children:(e,{add:t,remove:s})=>n.jsxs(V,{direction:"vertical",style:{width:"100%"},children:[e.map(p=>n.jsxs("div",{className:"v2-form-row",children:[n.jsx(u.Item,{name:[p.name,"type"],label:"Launch-Kosten Typ",style:{minWidth:180,flex:1},rules:[{required:!0,message:"Typ fehlt."}],children:n.jsx(L,{options:Je.map(h=>({value:h,label:h}))})}),n.jsx(u.Item,{name:[p.name,"amountEur"],label:"Betrag (EUR)",style:{minWidth:160,flex:1},rules:[{required:!0,message:"Betrag fehlt."}],children:n.jsx(Z,{mode:"decimal",min:0})}),n.jsx(u.Item,{name:[p.name,"date"],label:"Datum",style:{minWidth:170},rules:[{required:!0,message:"Datum fehlt."}],children:n.jsx(te,{type:"date"})}),n.jsx(u.Item,{name:[p.name,"note"],label:"Notiz",style:{flex:2},children:n.jsx(te,{placeholder:"Optional"})}),n.jsx(u.Item,{style:{marginTop:30},children:n.jsx(q,{danger:!0,onClick:()=>s(p.name),children:"Entfernen"})})]},p.key)),n.jsx(q,{onClick:()=>t({type:"Sonstiges",amountEur:null,currency:"EUR",date:"",note:""}),children:"Launch-Kosten hinzufügen"})]})})})]}),n.jsxs(Se,{size:"small",children:[n.jsx(Ce,{level:5,children:"Forecast-Vorschau (berechnet)"}),n.jsx(we,{type:"secondary",children:"Monatswerte werden aus Baseline im Referenzmonat, dem Saisonalitätsprofil der gewählten Referenz-SKU und einer taggenauen Launch-/Ramp-Aggregation berechnet."}),S!=null&&S.seasonality?n.jsxs(n.Fragment,{children:[n.jsxs(V,{wrap:!0,style:{marginBottom:8},children:[n.jsxs(b,{color:"blue",children:["Baseline: ",ie(S.baselineReferenceMonth)," · ",k(S.baselineUnitsInReferenceMonth,0)," Units"]}),n.jsxs(b,{color:"green",children:["Referenz-SKU: ",S.seasonalityReferenceSku]}),n.jsxs(b,{color:"purple",children:["Launch: ",String(S.launchDate||"—")," · Ramp: ",k(l(S.rampUpWeeks),0),"W · Start: ",k(l(S.softLaunchStartSharePct),0),"%"]}),n.jsxs(b,{children:["Zeitraum: ",oe(S.seasonality.startMonth)," bis ",oe(S.seasonality.endMonth)]}),X?n.jsxs(b,{color:"purple",children:["Orientierung: ",X.sku," hat in ",ie(X.baselineMonth)," im Schnitt ",k(X.monthAverageUnits,0)," Units"]}):null]}),n.jsx(Ne,{size:"small",pagination:!1,rowKey:e=>String(e.month||""),dataSource:C.map(e=>{var t,s,p,h;return{month:e,baseUnits:(t=S.baseUnitsByMonth)==null?void 0:t[e],rampFactor:(s=S.rampFactorByMonth)==null?void 0:s[e],units:(p=S.unitsByMonth)==null?void 0:p[e],revenue:(h=S.revenueByMonth)==null?void 0:h[e]}}),columns:[{title:"Monat",dataIndex:"month",key:"month",sorter:(e,t)=>String(e.month||"").localeCompare(String(t.month||"")),render:e=>oe(e)},{title:"Base Units",dataIndex:"baseUnits",key:"baseUnits",align:"right",sorter:(e,t)=>Number(l(e.baseUnits)||0)-Number(l(t.baseUnits)||0),render:e=>k(l(e),2)},{title:"Ramp-Faktor",dataIndex:"rampFactor",key:"rampFactor",align:"right",sorter:(e,t)=>Number(l(e.rampFactor)||0)-Number(l(t.rampFactor)||0),render:e=>k(l(e),2)},{title:"Units (Plan)",dataIndex:"units",key:"units",align:"right",sorter:(e,t)=>Number(l(e.units)||0)-Number(l(t.units)||0),render:e=>k(e,0)},{title:"Revenue (Plan)",dataIndex:"revenue",key:"revenue",align:"right",sorter:(e,t)=>Number(l(e.revenue)||0)-Number(l(t.revenue)||0),render:e=>k(e,2)}]})]}):n.jsx(se,{type:"warning",showIcon:!0,message:"Saisonalitätsprofil noch nicht ableitbar",description:"Für die gewählte Referenz-SKU liegen noch keine verwertbaren Forecast-Monatswerte vor."})]})]}),n.jsx(je,{title:"Plan-Produkt in Live-SKU übernehmen",open:_,onCancel:()=>{M(!1),$(null),I("")},onOk:()=>{P().catch(e=>{le.error(e instanceof Error?e.message:String(e))})},children:n.jsxs(V,{direction:"vertical",style:{width:"100%"},children:[n.jsx(se,{type:"info",showIcon:!0,message:"Plan wird archiviert, Mapping bleibt für Plan-vs-Ist erhalten.",description:"Nach der Übernahme zählt im operativen Forecast/Cashflow nur noch die Live-SKU (CSV)."}),n.jsxs("div",{children:[n.jsx(G,{strong:!0,children:"Plan-Produkt: "}),n.jsx(G,{children:(T==null?void 0:T.alias)||"—"})]}),n.jsxs("div",{children:[n.jsx(G,{strong:!0,children:"Aktueller Status: "}),n.jsx(G,{children:(T==null?void 0:T.status)||"—"})]}),n.jsx(L,{value:E||void 0,showSearch:!0,optionFilterProp:"label",placeholder:"Live-SKU auswählen",options:Y,onChange:e=>I(String(e||""))})]})})]})}export{Fn as default};
