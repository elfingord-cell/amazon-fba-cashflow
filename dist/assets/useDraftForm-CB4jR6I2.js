import{f as o,r as l,w as N}from"./store-CxfWtYpc.js";function u(r,a){if(r===a)return!0;if(r==null||a==null)return r===a;if(typeof r!=typeof a||typeof r!="object"||Array.isArray(r)!==Array.isArray(a))return!1;if(Array.isArray(r)){if(r.length!==a.length)return!1;for(let t=0;t<r.length;t+=1)if(!u(r[t],a[t]))return!1;return!0}const f=Object.keys(r),e=Object.keys(a);if(f.length!==e.length)return!1;for(const t of f)if(!Object.prototype.hasOwnProperty.call(a,t)||!u(r[t],a[t]))return!1;return!0}function w(r){if(typeof structuredClone=="function")try{return structuredClone(r)}catch{}if(r!==void 0)return JSON.parse(JSON.stringify(r))}function i(r){return w(r??{})}function c(r,a){Object.keys(r).forEach(e=>{delete r[e]}),a&&typeof a=="object"&&Object.entries(a).forEach(([e,t])=>{r[e]=t})}function S(r,a={}){const f={key:a.key||"draft",enableDraftCache:a.enableDraftCache!==!1,draftCacheNamespace:a.draftCacheNamespace||"drafts/v1"},e=i(r);let t=i(r);const d=typeof window<"u"&&window.__DEBUG_FORMS__===!0;function y(n){if(!d)return;const s=[];u(e,t)||s.push("draft/saved are not deep-equal after save."),e===t&&s.push("draft and saved share the same reference."),Array.isArray(e==null?void 0:e.payments)&&e.payments===(t==null?void 0:t.payments)&&s.push("payments array reference is shared."),Array.isArray(e==null?void 0:e.items)&&e.items===(t==null?void 0:t.items)&&s.push("items array reference is shared."),s.length&&console.warn(`[useDraftForm] Shared references detected after ${n}`,{warnings:s,draft:e,saved:t})}function h(){f.enableDraftCache&&N(f.key,e,f.draftCacheNamespace)}function m(n){if(typeof n=="function"){const s=n(i(e));s&&typeof s=="object"&&c(e,i(s))}else if(n&&typeof n=="object"){const s=n===e?n:{...e,...n};c(e,i(s))}h()}function p(){c(e,i(t)),o(f.key,f.draftCacheNamespace)}function C(){if(!f.enableDraftCache)return{exists:!1,draft:null};const n=l(f.key,f.draftCacheNamespace);return n!=null&&n.data?{exists:!0,draft:i(n.data),updatedAt:n.updatedAt}:{exists:!1,draft:null}}function k(){if(!f.enableDraftCache)return;const n=l(f.key,f.draftCacheNamespace);n!=null&&n.data&&c(e,i(n.data))}function D(){o(f.key,f.draftCacheNamespace),c(e,i(t))}function A(){t=i(e),y("markClean")}async function g(n){if(typeof n!="function")return;const s=n(e);s&&typeof s.then=="function"&&await s,t=i(e),y("commit"),o(f.key,f.draftCacheNamespace)}return{get draft(){return e},get saved(){return t},get isDirty(){return!u(e,t)},setDraft:m,resetDraft:p,loadDraftIfAvailable:C,restoreDraft:k,discardDraft:D,markClean:A,commit:g}}export{u as d,w as s,S as u};
