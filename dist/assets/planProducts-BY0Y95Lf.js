import{p as F}from"./index-elUAAuqx.js";const T=["standalone","variant_of_existing","category_adjacent"],I=["Jan","Feb","Maerz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],w=24*60*60*1e3;function h(e){if(e==null||e==="")return null;const n=Number(e);return Number.isFinite(n)?n:null}function S(e){const n=Number(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<1||t>12?null:t}function d(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}$/.test(n))return n;const t=n.match(/^(\d{2})-(\d{4})$/);return t?`${t[2]}-${t[1]}`:null}function p(e){const n=d(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return t*12+(r-1)}function j(e,n){const t=p(e);if(t==null)return e;const r=t+Number(n||0),a=Math.floor(r/12),s=r%12+1;return`${a}-${String(s).padStart(2,"0")}`}function B(e,n){const t=d(e),r=Number.isFinite(n)?Math.max(0,Math.round(n)):0;return!t||!r?[]:Array.from({length:r},(a,s)=>j(t,s))}function C(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}function M(e,n,t){return Number.isFinite(e)?Math.min(t,Math.max(n,e)):n}function D(e){const n=h(e);if(!Number.isFinite(n))return null;const t=Math.round(n);return t<=0?null:t}function z(e){const n=String(e||"").trim().toLowerCase();return T.includes(n)?n:"standalone"}function $(e){const n=String(e||"").trim().toLowerCase();return n==="archived"?"archived":n==="draft"?"draft":"active"}function P(e){return String(e||"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function y(e){return String(e||"").trim()}function U(e){if(!e)return null;const n=String(e).trim();if(/^\d{4}-\d{2}-\d{2}$/.test(n)){const[r,a,s]=n.split("-").map(Number),i=new Date(Date.UTC(r,a-1,s));if(i.getUTCFullYear()===r&&i.getUTCMonth()===a-1&&i.getUTCDate()===s)return n}const t=new Date(n);return Number.isNaN(t.getTime())?null:`${t.getUTCFullYear()}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}function k(e){const n=U(e);if(!n)return null;const[t,r,a]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,a))}function E(e){return!(e instanceof Date)||Number.isNaN(e.getTime())?null:`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}`}function L(e){const n=d(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r,0)).getUTCDate()}function x(e){const n=d(e);if(!n)return null;const[t,r]=n.split("-").map(Number);return new Date(Date.UTC(t,r-1,1))}function A(e){const n={};return!e||typeof e!="object"||Object.entries(e).forEach(([t,r])=>{const a=d(t),s=h(r);!a||!Number.isFinite(s)||(n[a]=Number(s))}),n}function W(e,n=0){const t=P(e==null?void 0:e.id);if(t)return`plan:${t}`;const r=P(e==null?void 0:e.alias);return r?`plan:${r}`:`plan:row-${n+1}`}function O(e,n=0){const t=e&&typeof e=="object"?e:{},r=String(t.alias||"").trim(),a=String(t.id||""),s=z(t.relationType),i=S(t.baselineReferenceMonth),l=h(t.baselineUnitsInReferenceMonth),b=h(t.avgSellingPriceGrossEUR),N=h(t.sellerboardMarginPct),o=U(t.launchDate),c=D(t.rampUpWeeks),u=h(t.softLaunchStartSharePct),m=Number.isFinite(u)?M(Number(u),0,100):0;return{id:a||`plan-${n+1}`,key:W({id:a,alias:r},n),alias:r,plannedSku:y(t.plannedSku),relationType:s,categoryId:t.categoryId?String(t.categoryId):null,status:$(t.status),seasonalityReferenceSku:y(t.seasonalityReferenceSku),baselineReferenceMonth:i,baselineUnitsInReferenceMonth:l,baselineReferenceSku:y(t.baselineReferenceSku),avgSellingPriceGrossEUR:b,sellerboardMarginPct:N,launchDate:o,rampUpWeeks:c,softLaunchStartSharePct:m,mappedSku:y(t.mappedSku||t.liveSku),mappedAt:t.mappedAt?String(t.mappedAt):null,archivedAt:t.archivedAt?String(t.archivedAt):null,createdAt:t.createdAt?String(t.createdAt):null,updatedAt:t.updatedAt?String(t.updatedAt):null,raw:t}}function Y(e,n=0){const t=e&&typeof e=="object"?e:{},r=A(t.planUnitsByMonth),a=Array.isArray(t.months)?t.months.map(s=>d(s)).filter(Boolean):Object.keys(r);return{id:String(t.id||`plan-map-${n+1}`),planProductId:String(t.planProductId||""),planProductAlias:String(t.planProductAlias||""),sku:y(t.sku),plannedSku:y(t.plannedSku),mappedAt:t.mappedAt?String(t.mappedAt):null,launchDate:U(t.launchDate),rampUpWeeks:D(t.rampUpWeeks),softLaunchStartSharePct:M(Number(h(t.softLaunchStartSharePct)||0),0,100),baselineReferenceMonth:S(t.baselineReferenceMonth),baselineUnitsInReferenceMonth:h(t.baselineUnitsInReferenceMonth),seasonalityReferenceSku:y(t.seasonalityReferenceSku),months:a.filter(s=>!!s).sort(),planUnitsByMonth:r,planRevenueByMonth:A(t.planRevenueByMonth),raw:t}}function v(e,n){if(!n||!e||typeof e!="object")return null;const t=e[n];if(t&&typeof t=="object")return t;const r=String(n).toLowerCase(),a=Object.keys(e).find(i=>i.toLowerCase()===r);if(!a)return null;const s=e[a];return s&&typeof s=="object"?s:null}function _(e,n){const t=v(e,n);if(!t)return null;const r=Object.entries(t).map(([o,c])=>{const u=d(o);if(!u)return null;const m=S(u.slice(5,7));if(m==null)return null;const f=c&&typeof c=="object"?F(c.units):F(c);return Number.isFinite(f)?{month:u,monthNumber:m,units:Number(f)}:null}).filter(Boolean).sort((o,c)=>o.month.localeCompare(c.month));if(!r.length)return null;const a=Array.from({length:12},()=>[]);r.forEach(o=>{a[o.monthNumber-1].push(o.units)});const s=a.map(o=>o.length?o.reduce((c,u)=>c+u,0)/o.length:null),i=s.filter(o=>Number.isFinite(o)),l=i.length?i.reduce((o,c)=>o+c,0)/i.length:null,b={},N={};for(let o=1;o<=12;o+=1){const c=s[o-1];N[o]=Number.isFinite(c)?Number(c):null,b[o]=Number.isFinite(c)&&Number.isFinite(l)&&l>0?Number(c)/Number(l):null}return{sku:String(n||"").trim(),startMonth:r[0].month,endMonth:r[r.length-1].month,sampleMonthCount:r.length,coveredMonthTypes:Object.values(N).filter(o=>Number.isFinite(o)).length,overallAverage:Number.isFinite(l)?Number(l):null,factorsByMonthNumber:b,averagesByMonthNumber:N}}function K(e){const n=h(e.baselineUnitsInReferenceMonth),t=S(e.baselineReferenceMonth),r=S(e.targetMonthNumber),a=e.factorsByMonthNumber||{};if(n==null||n<0||t==null||r==null)return null;const s=h(a[t]),i=h(a[r]);if(!Number.isFinite(s)||!Number.isFinite(i)||s<=0)return null;const l=Number(n)*(Number(i)/Number(s));return Number.isFinite(l)?Math.max(0,Number(l)):null}function G(e){const n=k(e==null?void 0:e.launchDate),t=D(e==null?void 0:e.rampUpWeeks);if(!n||!t)return{launchDate:n,rampEndDate:null,rampDurationDays:null};const r=Math.max(1,Math.round(t*7)),a=new Date(n.getTime()+r*w);return{launchDate:n,rampEndDate:a,rampDurationDays:r}}function J(e){const n=e==null?void 0:e.date,t=e==null?void 0:e.launchDate,r=e==null?void 0:e.rampEndDate,a=M(Number((e==null?void 0:e.softStartShare)||0),0,1);if(!(n instanceof Date)||Number.isNaN(n.getTime())||!(t instanceof Date)||Number.isNaN(t.getTime()))return 1;if(n<t)return 0;if(!(r instanceof Date)||Number.isNaN(r.getTime())||n>r)return 1;const s=r.getTime()-t.getTime();if(s<=0)return 1;const i=n.getTime()-t.getTime(),l=M(i/s,0,1);return M(a+(1-a)*l,a,1)}function V(e){const n=d(e==null?void 0:e.month),t=h(e==null?void 0:e.baseUnits),r=x(n),a=L(n);if(!r||!Number.isFinite(t)||!Number.isFinite(a)||a<=0)return{units:null,unitsRaw:null,rampFactor:null,weightedDays:0,activeDays:0,daysInMonth:Number.isFinite(a)?a:null};const s=M(Number(h(e==null?void 0:e.softLaunchStartSharePct)||0)/100,0,1),i=G({launchDate:e==null?void 0:e.launchDate,rampUpWeeks:e==null?void 0:e.rampUpWeeks}),l=Number(t)/Number(a);let b=0,N=0;for(let m=0;m<a;m+=1){const f=new Date(r.getTime()+m*w),g=J({date:f,launchDate:i.launchDate,rampEndDate:i.rampEndDate,softStartShare:s});b+=g,g>0&&(N+=1)}const o=l*b,c=Number.isFinite(o)?Math.max(0,Math.round(o)):null,u=Number(t)>0&&Number.isFinite(o)?Number(o)/Number(t):b>0?1:0;return{units:c,unitsRaw:Number.isFinite(o)?Number(o):null,rampFactor:Number.isFinite(u)?Number(u):null,weightedDays:b,activeDays:N,daysInMonth:Number(a)}}function q(e){const n=e!=null&&e.settings&&typeof e.settings=="object"?e.settings:{},t=d(n.startMonth)||C(),r=h(n.horizonMonths),a=Number.isFinite(r)&&r>0?Math.round(r):18;return B(t,a)}function H(e){const n=O(e==null?void 0:e.planProduct,(e==null?void 0:e.fallbackIndex)||0),t=e!=null&&e.forecastImport&&typeof e.forecastImport=="object"?e.forecastImport:{},r=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months.filter(c=>d(c)):[],a=_(t,n.seasonalityReferenceSku),s={},i={},l={},b={},N={},o=M(Number(n.softLaunchStartSharePct||0),0,100);return r.forEach(c=>{const u=S(String(c).slice(5,7)),m=K({baselineUnitsInReferenceMonth:n.baselineUnitsInReferenceMonth,baselineReferenceMonth:n.baselineReferenceMonth,targetMonthNumber:u,factorsByMonthNumber:(a==null?void 0:a.factorsByMonthNumber)||{}}),f=V({month:c,baseUnits:m,launchDate:n.launchDate,rampUpWeeks:n.rampUpWeeks,softLaunchStartSharePct:o}),g=Number.isFinite(f.units)?Number(f.units):null;i[c]=Number.isFinite(m)?Number(m):null,s[c]=g,l[c]=Number.isFinite(f.rampFactor)?Number(f.rampFactor):null,b[c]={weightedDays:Number.isFinite(f.weightedDays)?Number(f.weightedDays):0,activeDays:Number.isFinite(f.activeDays)?Number(f.activeDays):0,daysInMonth:Number.isFinite(f.daysInMonth)?Number(f.daysInMonth):0,unitsRaw:Number.isFinite(f.unitsRaw)?Number(f.unitsRaw):null};const R=h(n.avgSellingPriceGrossEUR);N[c]=Number.isFinite(R)&&Number.isFinite(g)?Math.round(Number(R)*Number(g)*100)/100:null}),{...n,seasonality:a,months:r,baseUnitsByMonth:i,rampFactorByMonth:l,rampMetaByMonth:b,unitsByMonth:s,revenueByMonth:N}}function Q(e){const n=e!=null&&e.state&&typeof e.state=="object"?e.state:{},t=Array.isArray(n.planProducts)?n.planProducts:[],r=n.forecast&&typeof n.forecast=="object"?n.forecast:{},a=r.forecastImport&&typeof r.forecastImport=="object"?r.forecastImport:{},s=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:q(n);return t.map((i,l)=>H({planProduct:i,forecastImport:a,months:s,fallbackIndex:l})).filter(i=>i.alias)}function Z(e){const n=Array.isArray(e==null?void 0:e.months)&&e.months.length?e.months:[],t=Q({state:(e==null?void 0:e.state)||{},months:n}),r={};return n.forEach(a=>{r[a]=0}),t.forEach(a=>{a.status==="active"&&n.forEach(s=>{var l;const i=h((l=a.revenueByMonth)==null?void 0:l[s]);Number.isFinite(i)&&(r[s]=(r[s]||0)+Number(i))})}),r}function ee(e){const n=Y((e==null?void 0:e.mapping)||{},0),t=y(n.sku);if(!t)return[];const r=v(e==null?void 0:e.forecastImport,t)||{},a={};Object.entries(r).forEach(([o,c])=>{const u=d(o);if(!u)return;const m=c&&typeof c=="object"?F(c.units):F(c);Number.isFinite(m)&&(a[u]=Number(m))});const s=Array.isArray(e==null?void 0:e.months)?e.months.map(o=>d(o)).filter(Boolean):[],i=s.length?s:Array.from(new Set([...Object.keys(n.planUnitsByMonth||{}),...Object.keys(a),...n.months||[]])).sort(),l=d((e==null?void 0:e.launchMonth)||E(k(n.launchDate))),b=D(e==null?void 0:e.maxMonths);return i.filter(o=>o?l?o>=l:!0:!1).sort().slice(0,b||i.length).map(o=>{var g;const c=h((g=n.planUnitsByMonth)==null?void 0:g[o]),u=h(a==null?void 0:a[o]),m=Number.isFinite(c)&&Number.isFinite(u)?Number(u)-Number(c):null,f=Number.isFinite(m)&&Number.isFinite(c)&&Number(c)>0?Number(m)/Number(c)*100:null;return{month:o,planUnits:Number.isFinite(c)?Number(c):null,liveUnits:Number.isFinite(u)?Number(u):null,deltaUnits:Number.isFinite(m)?Number(m):null,deltaPct:Number.isFinite(f)?Number(f):null}}).filter(o=>Number.isFinite(o.planUnits)||Number.isFinite(o.liveUnits))}function te(e){const n=S(e);return n==null?"â€”":I[n-1]}export{T as P,H as a,Q as b,_ as c,O as d,Y as e,ee as f,Z as g,te as m,U as n};
