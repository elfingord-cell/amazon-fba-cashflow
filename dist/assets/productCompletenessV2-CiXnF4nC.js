import{p as q}from"./index-CafJOI4c.js";const z=new Set(["EUR","USD","CNY"]),H=new Set(["EXW","FOB","DDP","FCA","DAP","CIF"]);function d(r){return String(r||"").trim()}function h(r){const e=q(r);return Number.isFinite(e)?Number(e):null}function c(r){const e=h(r);if(!Number.isFinite(e))return null;const n=Number(e);return n>0?n:null}function P(r){const e=h(r);if(!Number.isFinite(e))return null;const n=Number(e);return n<0?null:n}function y(r){return r===!0||r===!1?r:r===1||r==="1"||r==="true"?!0:r===0||r==="0"||r==="false"?!1:null}function U(r){const e=d(r).toUpperCase();return!e||!z.has(e)?null:e}function R(r){const e=d(r).toUpperCase();return!e||!H.has(e)?null:e}function p(r,e){return r==="order_override"?e==="fo"?"Diese FO":e==="po"?"Diese PO":"Produkt":r==="product"?"Produkt":r==="supplier"?"Lieferant":r==="settings"?"Settings":"Fehlt"}function W(r,e){if(typeof r=="number"||typeof e=="number"){const n=h(r),s=h(e);return n==null||s==null?!1:Math.abs(n-s)<1e-5}if(typeof r=="boolean"||typeof e=="boolean"){const n=y(r),s=y(e);return n!=null&&s!=null&&n===s}return d(r)===d(e)}function X(r,e){for(let n=0;n<r.length;n+=1){const s=r[n];if(e(s.value))return s}return null}function f(r){const e=X(r.candidates,r.isValid),n=r.parse(r.orderOverrideRaw);return r.isValid(n)&&(!e||!W(n,e.value))?{value:n,source:"order_override",label:p("order_override",r.orderContext),required:r.required,blocking:!1,reason:r.reason,canReset:!0,canAdopt:r.orderContext==="fo"||r.orderContext==="po"}:e?{value:e.value,source:e.source,label:p(e.source,r.orderContext),required:r.required,blocking:!1,reason:r.reason,canReset:!1,canAdopt:!1}:{value:null,source:"missing",label:p("missing",r.orderContext),required:r.required,blocking:r.required,reason:r.reason,canReset:!1,canAdopt:!1}}function Z(r){const e=r!=null&&r.template&&typeof r.template=="object"?r.template:{};return(e.fields&&typeof e.fields=="object"?e.fields:e)||{}}function Y(r,e){const n=d(e).toLowerCase();return n&&(Array.isArray(r.products)?r.products:[]).find(i=>d(i==null?void 0:i.sku).toLowerCase()===n)||null}function $(r,e){const n=d(e);return n&&(Array.isArray(r.suppliers)?r.suppliers:[]).find(i=>d(i==null?void 0:i.id)===n)||null}function J(r,e,n){const s=d(e).toLowerCase();if(!s)return null;const l=(Array.isArray(r.productSuppliers)?r.productSuppliers:[]).filter(t=>d(t==null?void 0:t.sku).toLowerCase()===s);if(!l.length)return null;if(n){const t=l.find(D=>d(D==null?void 0:D.supplierId)===n);if(t)return t}return l.find(t=>(t==null?void 0:t.isPreferred)===!0)||l[0]||null}function ee(r,e){const n=d(e.transportMode||e.transport||"").toUpperCase();if(n)return n;const s=d(r.transportMode||r.transport||"").toUpperCase();return s||"SEA"}function O(r){var E;const e=r.state||{},n=r.orderContext||"product",s=r.orderOverrides&&typeof r.orderOverrides=="object"?r.orderOverrides:{},i=d(r.sku||((E=r.product)==null?void 0:E.sku)),l=r.product&&typeof r.product=="object"?r.product:Y(e,i),m=d(i||(l==null?void 0:l.sku)),t=l||null,D=d(r.supplierId||s.supplierId||(t==null?void 0:t.supplierId)),o=J(e,m,D),N=d(D||(o==null?void 0:o.supplierId)),u=$(e,N),v=e.settings&&typeof e.settings=="object"?e.settings:{},g=Z(t),T=ee(g,s),C=v.transportLeadTimesDays&&typeof v.transportLeadTimesDays=="object"?v.transportLeadTimesDays:{},F=f({orderContext:n,required:!0,reason:"EK Preis USD fehlt.",orderOverrideRaw:s.unitPrice??s.unitCostUsd,parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c(g.unitPriceUsd??(t==null?void 0:t.unitPriceUsd)??(t==null?void 0:t.unitPrice))},{source:"supplier",value:c((o==null?void 0:o.unitPrice)??(u==null?void 0:u.unitPriceDefault))}]}),w=f({orderContext:n,required:!0,reason:"VK Preis Brutto fehlt.",parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c(t==null?void 0:t.avgSellingPriceGrossEUR)}]}),S=f({orderContext:n,required:!0,reason:"Marge muss > 0 sein.",parse:P,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:P(t==null?void 0:t.sellerboardMarginPct)}]}),x=f({orderContext:n,required:!0,reason:"MOQ fehlt.",parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c((t==null?void 0:t.moqOverrideUnits)??(t==null?void 0:t.moqUnits))},{source:"supplier",value:c((o==null?void 0:o.minOrderQty)??(u==null?void 0:u.moqDefaultUnits)??(u==null?void 0:u.minOrderQty))},{source:"settings",value:c(v.moqDefaultUnits)}]}),K=f({orderContext:n,required:!0,reason:"Production Lead Time fehlt.",orderOverrideRaw:s.productionLeadTimeDays??s.prodDays,parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c((t==null?void 0:t.productionLeadTimeDaysDefault)??g.productionDays)},{source:"supplier",value:c((o==null?void 0:o.productionLeadTimeDays)??(u==null?void 0:u.productionLeadTimeDaysDefault))},{source:"settings",value:c(v.defaultProductionLeadTimeDays)}]}),M=f({orderContext:n,required:!1,reason:"Transit Lead Time fehlt.",orderOverrideRaw:s.logisticsLeadTimeDays??s.transitDays,parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c(g.transitDays??(t==null?void 0:t.transitDays))},{source:"supplier",value:c((o==null?void 0:o.transitDays)??(u==null?void 0:u.transitDaysDefault))},{source:"settings",value:c(C[T.toLowerCase()])},{source:"settings",value:c(C.sea)}]}),V=f({orderContext:n,required:!1,reason:"Logistik pro Einheit fehlt.",orderOverrideRaw:s.logisticsPerUnitEur??s.freightPerUnitEur,parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c((t==null?void 0:t.logisticsPerUnitEur)??(t==null?void 0:t.freightPerUnitEur)??g.freightEur)},{source:"supplier",value:c(o==null?void 0:o.logisticsPerUnitEur)}]}),A=f({orderContext:n,required:!1,reason:"Zollsatz fehlt.",orderOverrideRaw:s.dutyRatePct,parse:P,isValid:a=>Number.isFinite(a)&&Number(a)>=0,candidates:[{source:"product",value:P((t==null?void 0:t.dutyRatePct)??g.dutyPct)},{source:"supplier",value:P((o==null?void 0:o.dutyRatePct)??(u==null?void 0:u.dutyRatePct))},{source:"settings",value:P(v.dutyRatePct)}]}),B=f({orderContext:n,required:!1,reason:"EUSt Satz fehlt.",orderOverrideRaw:s.eustRatePct,parse:P,isValid:a=>Number.isFinite(a)&&Number(a)>=0,candidates:[{source:"product",value:P((t==null?void 0:t.eustRatePct)??g.vatImportPct)},{source:"supplier",value:P((o==null?void 0:o.eustRatePct)??(u==null?void 0:u.eustRatePct))},{source:"settings",value:P(v.eustRatePct)}]}),j=f({orderContext:n,required:!1,reason:"DDP Flag fehlt.",orderOverrideRaw:s.ddp,parse:y,isValid:a=>a===!0||a===!1,candidates:[{source:"product",value:y(g.ddp??(t==null?void 0:t.ddp))},{source:"supplier",value:y((o==null?void 0:o.ddp)??(u==null?void 0:u.defaultDdp))},{source:"settings",value:y(v.defaultDdp)}]}),G=f({orderContext:n,required:!1,reason:"Incoterm fehlt.",orderOverrideRaw:s.incoterm,parse:R,isValid:a=>!!a,candidates:[{source:"product",value:R((t==null?void 0:t.defaultIncoterm)??g.incoterm)},{source:"supplier",value:R((o==null?void 0:o.incoterm)??(u==null?void 0:u.incotermDefault))},{source:"settings",value:R(v.defaultIncoterm)}]}),Q=f({orderContext:n,required:!1,reason:"WÃ¤hrung fehlt.",orderOverrideRaw:s.currency,parse:U,isValid:a=>!!a,candidates:[{source:"product",value:U(g.currency??(t==null?void 0:t.currency))},{source:"supplier",value:U((o==null?void 0:o.currency)??(u==null?void 0:u.currencyDefault))},{source:"settings",value:U(v.defaultCurrency)}]}),_=f({orderContext:n,required:!1,reason:"FX Rate fehlt.",orderOverrideRaw:s.fxRate??s.fxOverride,parse:c,isValid:a=>Number.isFinite(a)&&Number(a)>0,candidates:[{source:"product",value:c(g.fxRate??(t==null?void 0:t.fxRate)??(t==null?void 0:t.fxUsdPerEur))},{source:"supplier",value:c((o==null?void 0:o.fxRate)??(u==null?void 0:u.fxRateDefault))},{source:"settings",value:c(v.fxRate)}]});return{sku:m,supplierId:N,product:t,supplier:u,productSupplier:o,fields:{unitPriceUsd:F,avgSellingPriceGrossEur:w,marginPct:S,moqUnits:x,productionLeadTimeDays:K,transitDays:M,logisticsPerUnitEur:V,dutyRatePct:A,eustRatePct:B,ddp:j,incoterm:G,currency:Q,fxRate:_}}}function ie(r){const e={...r.product||{}},n=e.template&&typeof e.template=="object"?e.template:{},s=n.fields&&typeof n.fields=="object"?{...n.fields}:{...n},i=h(r.value),l=y(r.value);if(r.field==="unitPriceUsd"){if(i==null||i<=0)return e;s.unitPriceUsd=i}if(r.field==="productionLeadTimeDays"){if(i==null||i<=0)return e;e.productionLeadTimeDaysDefault=Math.round(i)}if(r.field==="transitDays"){if(i==null||i<=0)return e;s.transitDays=Math.round(i)}if(r.field==="dutyRatePct"){if(i==null||i<0)return e;s.dutyPct=i,e.dutyRatePct=i}if(r.field==="eustRatePct"){if(i==null||i<0)return e;s.vatImportPct=i,e.eustRatePct=i}if(r.field==="ddp"){if(l==null)return e;s.ddp=l,e.ddp=l}return e.template={...n,scope:"SKU",name:String(n.name||"Standard (SKU)"),fields:s},e}function oe(r,e=!1){return r==="supplier"?"v2-source-chip v2-source-chip--supplier":r==="settings"?"v2-source-chip v2-source-chip--settings":r==="missing"&&e?"v2-source-chip v2-source-chip--missing":r==="order_override"?"v2-source-chip v2-source-chip--override":"v2-source-chip"}function k(r){const e=d(r).toLowerCase();return!e||e==="active"||e==="aktiv"||e==="prelaunch"||e==="not_launched"||e==="planned"}function re(r){const e=q(r);return Number.isFinite(e)?Number(e):null}function L(r){return String(r||"").trim().length>0}function b(r,e,n){n.has(e.fieldKey)||(n.add(e.fieldKey),r.push(e))}function se(r){const e=r.fields,n=[],s=(i,l,m,t)=>{m!=="supplier"&&m!=="settings"||t==null||t===""||n.push({fieldKey:i,label:l,source:m,value:t})};return s("unitPriceUsd","EK Preis USD",e.unitPriceUsd.source,e.unitPriceUsd.value),s("moqUnits","MOQ",e.moqUnits.source,e.moqUnits.value),s("productionLeadTimeDays","Production Lead Time",e.productionLeadTimeDays.source,e.productionLeadTimeDays.value),s("incoterm","Incoterm",e.incoterm.source,e.incoterm.value),s("ddp","DDP",e.ddp.source,e.ddp.value),s("dutyRatePct","Zoll %",e.dutyRatePct.source,e.dutyRatePct.value),s("eustRatePct","EUSt %",e.eustRatePct.source,e.eustRatePct.value),n}function I(r){const e=[],n=new Set,s=r.fields;return(s.unitPriceUsd.value==null||Number(s.unitPriceUsd.value)<=0)&&b(e,{fieldKey:"unitPriceUsd",label:"EK Preis USD",source:s.unitPriceUsd.source,reason:"EK Preis USD fehlt."},n),(s.avgSellingPriceGrossEur.value==null||Number(s.avgSellingPriceGrossEur.value)<=0)&&b(e,{fieldKey:"avgSellingPriceGrossEUR",label:"VK Preis Brutto",source:s.avgSellingPriceGrossEur.source,reason:"VK Preis Brutto fehlt."},n),(s.marginPct.value==null||Number(s.marginPct.value)<=0)&&b(e,{fieldKey:"sellerboardMarginPct",label:"Marge %",source:s.marginPct.source,reason:"Marge muss > 0 sein."},n),s.incoterm.value&&String(s.incoterm.value).trim().length>0||s.ddp.value===!0||s.ddp.value===!1||b(e,{fieldKey:"incoterm_ddp",label:"Incoterm / DDP",source:s.incoterm.source==="missing"?s.ddp.source:s.incoterm.source,reason:"Incoterm oder DDP Flag fehlt."},n),(s.moqUnits.value==null||Number(s.moqUnits.value)<=0)&&b(e,{fieldKey:"moqUnits",label:"MOQ",source:s.moqUnits.source,reason:"MOQ fehlt."},n),(s.productionLeadTimeDays.value==null||Number(s.productionLeadTimeDays.value)<=0)&&b(e,{fieldKey:"productionLeadTimeDaysDefault",label:"Production Lead Time",source:s.productionLeadTimeDays.source,reason:"Production Lead Time fehlt."},n),e}function te(r){const e=[],n=new Set;L(r.hsCode)||b(e,{fieldKey:"hsCode",label:"HS-Code",source:"missing",reason:"HS-Code fehlt (wichtig)."},n),L(r.goodsDescription)||b(e,{fieldKey:"goodsDescription",label:"Warenbeschreibung",source:"missing",reason:"Warenbeschreibung fehlt (wichtig)."},n);const s=re(r.landedUnitCostEur);return(!Number.isFinite(s)||Number(s)<=0)&&b(e,{fieldKey:"landedUnitCostEur",label:"Einstandspreis EUR",source:"missing",reason:"Einstandspreis EUR fehlt (wichtig)."},n),e}function ae(r){const e=r.product||{},n=r.state||{},s=O({state:n,product:e,sku:String(e.sku||""),supplierId:String(e.supplierId||""),orderContext:"product"}),i=I(s),l=te(e),m=se(s),t=k(e.status);return t&&i.length>0?{status:"blocked",blockingMissing:i,importantMissing:l,defaulted:m,blockScope:t}:i.length>0||l.length>0?{status:"warn",blockingMissing:i,importantMissing:l,defaulted:m,blockScope:t}:{status:"ok",blockingMissing:i,importantMissing:l,defaulted:m,blockScope:t}}function ue(r){const e=r.product||{},n=O({state:r.state||{},product:e,sku:String((e==null?void 0:e.sku)||""),supplierId:r.supplierId||String((e==null?void 0:e.supplierId)||""),orderOverrides:r.orderOverrides||{},orderContext:r.orderContext}),s=I(n),i=k(e==null?void 0:e.status);return{blocked:i&&s.length>0,blockScope:i,issues:s,resolved:n}}export{ue as a,ie as b,ae as e,O as r,oe as s};
