import{p as f}from"./index-BX0hCHd9.js";import{n as g}from"./months-DiLwPhVv.js";const b=/^\d{4}-\d{2}$/;function p(t="fv"){return`${t}-${Math.random().toString(36).slice(2,10)}-${Date.now().toString(36)}`}function S(){return new Date().toISOString()}function h(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}-${n}-${r} ${o}:${s}`}function y(t){if(!t)return null;const e=new Date(String(t));return Number.isNaN(e.getTime())?null:e.toISOString()}function C(t){if(!t)return null;const e=String(t).trim().toLowerCase();return e==="merge"||e==="overwrite"?e:null}function N(t){return String(t||"").trim()}function A(t){if(t==null)return null;const e=t&&typeof t=="object"?t:{units:t},n=f(e.units??e.qty??e.quantity),r=f(e.revenueEur),o=f(e.profitEur);return{units:Number.isFinite(n)?Number(n):null,revenueEur:Number.isFinite(r)?Number(r):null,profitEur:Number.isFinite(o)?Number(o):null}}function V(t){if(!t||typeof t!="object")return{};const e={};return Object.entries(t).forEach(([n,r])=>{const o=N(n);if(!o||!r||typeof r!="object")return;const s={};Object.entries(r).forEach(([i,c])=>{const a=g(i);if(!a||!b.test(a))return;const d=A(c);d&&(s[a]=d)}),Object.keys(s).length&&(e[o]=s)}),e}function D(t){const e=Object.keys(t||{}),n=new Set;let r=0;return e.forEach(o=>{const s=t==null?void 0:t[o];!s||typeof s!="object"||Object.keys(s).forEach(i=>{const c=g(i);c&&(n.add(c),r+=1)})}),{rowCount:r,skuCount:e.length,monthCount:n.size}}function F(t=new Date){return h(t)}function m(t=new Date){return`VentoryOne Forecast â€“ ${F(t)}`}function I(t){const e=y(t.createdAt)||S(),n=V(t.forecastImport||{}),r=t.stats&&typeof t.stats=="object"?{rowCount:Math.max(0,Math.round(Number(t.stats.rowCount||0))),skuCount:Math.max(0,Math.round(Number(t.stats.skuCount||0))),monthCount:Math.max(0,Math.round(Number(t.stats.monthCount||0)))}:D(n);return{id:String(t.id||p("fv")),name:String(t.name||m(new Date(e))).trim()||m(new Date(e)),note:t.note==null?null:String(t.note),createdAt:e,sourceLabel:t.sourceLabel==null?null:String(t.sourceLabel),importMode:C(t.importMode),onlyActiveSkus:t.onlyActiveSkus===!0,forecastImport:n,stats:r}}function u(t){if(!Array.isArray(t))return[];const e=t.map(n=>n&&typeof n=="object"?I(n):null).filter(Boolean);return e.sort((n,r)=>String(n.createdAt||"").localeCompare(String(r.createdAt||""))),e}function v(t){return I(t)}function k(t){const e=u(t==null?void 0:t.versions);if(!e.length)return null;const n=String((t==null?void 0:t.activeVersionId)||"").trim();if(n){const r=e.find(o=>o.id===n)||null;if(r)return r}return e[e.length-1]||null}function O(t){const e=k(t);return(e==null?void 0:e.name)||"Keine Baseline"}function l(t){if(!t||typeof t!="object")return t;const e=t;(!e.forecastImport||typeof e.forecastImport!="object")&&(e.forecastImport={}),(!e.foConflictDecisionsByVersion||typeof e.foConflictDecisionsByVersion!="object")&&(e.foConflictDecisionsByVersion={}),e.lastImpactSummary===void 0&&(e.lastImpactSummary=null);const n=u(e.versions);if(n.length){e.versions=n;const r=String(e.activeVersionId||"").trim();let o=n.find(s=>s.id===r)||null;o||(o=n[n.length-1]||null),o&&(e.activeVersionId=o.id,e.forecastImport=structuredClone(o.forecastImport))}else{const r=V(e.forecastImport||{});if(Object.keys(r).length){const o=y(e.lastImportAt)||S(),s=v({id:e.activeVersionId?String(e.activeVersionId):null,name:m(new Date(o)),note:null,createdAt:o,sourceLabel:e.importSource?String(e.importSource):"legacy",importMode:"overwrite",onlyActiveSkus:!1,forecastImport:r});return e.versions=[s],e.activeVersionId=s.id,e.forecastImport=structuredClone(s.forecastImport),e}}return e.activeVersionId||(e.activeVersionId=null),e}function w(t,e){l(t);const n=t,r=u(n.versions),o=v(e);return r.push(o),r.sort((s,i)=>String(s.createdAt||"").localeCompare(String(i.createdAt||""))),n.versions=r,o}function E(t,e,n){l(t);const r=t,o=u(r.versions),s=o.findIndex(a=>a.id===e);if(s<0)return!1;const i=o[s],c=n.name==null?i.name:String(n.name).trim();return o[s]={...i,name:c||i.name,note:n.note==null?i.note:String(n.note)},r.versions=o,!0}function z(t,e){l(t);const n=t,r=String(n.activeVersionId||"");if(r&&r===e)return{ok:!1,reason:"ACTIVE_VERSION"};const o=u(n.versions),s=o.filter(i=>i.id!==e);if(s.length===o.length)return{ok:!1,reason:"NOT_FOUND"};if(n.versions=s,n.foConflictDecisionsByVersion&&typeof n.foConflictDecisionsByVersion=="object"){const i={...n.foConflictDecisionsByVersion};delete i[e],n.foConflictDecisionsByVersion=i}if(n.lastImpactSummary&&typeof n.lastImpactSummary=="object"){const i=n.lastImpactSummary,c=String(i.fromVersionId||""),a=String(i.toVersionId||"");(c===e||a===e)&&(n.lastImpactSummary=null)}return{ok:!0}}function x(t,e,n={}){l(t);const r=t,s=u(r.versions).find(i=>i.id===e);return s?(r.activeVersionId=s.id,r.forecastImport=structuredClone(s.forecastImport||{}),n.touchImportMeta!==!1&&(r.lastImportAt=s.createdAt,r.importSource=s.sourceLabel||r.importSource||"CSV"),{ok:!0,version:s}):{ok:!1,reason:"NOT_FOUND"}}export{k as a,m as b,v as c,w as d,l as e,z as f,O as g,V as n,E as r,x as s};
