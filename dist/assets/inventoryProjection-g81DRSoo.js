import{p as M}from"./index-C5hLbMu6.js";function v(n){if(!n)return null;const r=String(n);if(/^\d{4}-\d{2}$/.test(r))return r;const s=r.match(/^(\d{2})-(\d{4})$/);return s?`${s[2]}-${s[1]}`:r}function w(n){return String(n||"").trim()}function x(n){if(!n)return!1;if(typeof n.active=="boolean")return n.active;const r=String(n.status||"").trim().toLowerCase();return r?r==="active"||r==="aktiv":!0}function q(n){if(!/^\d{4}-\d{2}$/.test(n||""))return 30;const[r,s]=n.split("-").map(Number);return new Date(r,s,0).getDate()}function k(n){if(!n)return null;const r=new Date(n);return Number.isNaN(r.getTime())?null:r}function O(n){return!(n instanceof Date)||Number.isNaN(n.getTime())?null:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`}function K(n){const r=k((n==null?void 0:n.etaManual)||(n==null?void 0:n.etaDate)||(n==null?void 0:n.eta));if(r)return r;const s=k(n==null?void 0:n.etaComputed);if(s)return s;const u=k(n==null?void 0:n.orderDate);if(!u)return null;const c=Number((n==null?void 0:n.prodDays)||0),t=Number((n==null?void 0:n.transitDays)||0),a=new Date(u.getTime());return a.setDate(a.getDate()+Math.max(0,c+t)),a}function B(n){return k((n==null?void 0:n.targetDeliveryDate)||(n==null?void 0:n.deliveryDate)||(n==null?void 0:n.etaDate))}function R(n){const r=String((n==null?void 0:n.status)||"").toUpperCase();return!(r==="CONVERTED"||r==="CANCELLED")}function Y(n,r,s){var f,e,h,d,y,i,l;const u=v(s);if(!u)return null;const c=(h=(e=(f=n==null?void 0:n.forecast)==null?void 0:f.forecastManual)==null?void 0:e[r])==null?void 0:h[u],t=M(c);if(Number.isFinite(t))return t;const a=(l=(i=(y=(d=n==null?void 0:n.forecast)==null?void 0:d.forecastImport)==null?void 0:y[r])==null?void 0:i[u])==null?void 0:l.units,o=M(a);return Number.isFinite(o)?o:null}function G(n,r){const s=new Set(r),u=new Map,c=(t,a,o)=>{if(!t||!s.has(a))return;u.has(t)||u.set(t,new Map);const f=u.get(t);f.set(a,(f.get(a)||0)+o)};return((n==null?void 0:n.pos)||[]).forEach(t=>{if(!t||t.archived||String(t.status||"").toUpperCase()==="CANCELLED")return;const a=K(t),o=a?O(a):null;if(!o)return;(Array.isArray(t.items)&&t.items.length?t.items:[{sku:t.sku,units:t.units}]).forEach(e=>{const h=w((e==null?void 0:e.sku)||(t==null?void 0:t.sku));if(!h)return;const d=(e==null?void 0:e.units)??(e==null?void 0:e.qty)??(e==null?void 0:e.quantity)??(t==null?void 0:t.units),y=M(d),i=Number.isFinite(y)?Math.round(y):0;i&&c(h,o,i)})}),((n==null?void 0:n.fos)||[]).forEach(t=>{if(!t||!R(t))return;const a=B(t),o=a?O(a):null;if(!o)return;(Array.isArray(t.items)&&t.items.length?t.items:[{sku:t.sku,units:t.units}]).forEach(e=>{const h=w((e==null?void 0:e.sku)||(t==null?void 0:t.sku));if(!h)return;const d=(e==null?void 0:e.units)??(e==null?void 0:e.qty)??(e==null?void 0:e.quantity)??(t==null?void 0:t.units),y=M(d),i=Number.isFinite(y)?Math.round(y):0;i&&c(h,o,i)})}),u}function H(n){var s;const r=(((s=n==null?void 0:n.inventory)==null?void 0:s.snapshots)||[]).filter(u=>(u==null?void 0:u.month)&&v(u.month)).slice().sort((u,c)=>v(u.month).localeCompare(v(c.month)));return r.length?r[r.length-1]:null}function C(n){const r=M(n);return!Number.isFinite(r)||r<=0?null:Math.round(r)}function J(n,r){var c,t,a;const s=C(n==null?void 0:n.safetyStockDohOverride);return s??C(((c=r==null?void 0:r.settings)==null?void 0:c.safetyStockDohDefault)??((a=(t=r==null?void 0:r.inventory)==null?void 0:t.settings)==null?void 0:a.safetyDays))}function W(n,r){var c;const s=C(n==null?void 0:n.foCoverageDohOverride);return s??C((c=r==null?void 0:r.settings)==null?void 0:c.foCoverageDohDefault)}function X({endAvailable:n,safetyUnits:r,doh:s,safetyDays:u,projectionMode:c="units"}){return(c==="doh"?"doh":"units")==="doh"?Number.isFinite(s)?s<=0?"safety-negative":Number.isFinite(u)&&s<u?"safety-low":"":"":Number.isFinite(n)?n<=0?"safety-negative":Number.isFinite(r)&&n<r?"safety-low":"":""}function Z({state:n,months:r,products:s,snapshot:u,projectionMode:c="units"}){const t=(Array.isArray(r)?r:[]).map(i=>v(i)).filter(Boolean),a=Array.isArray(s)?s:(n==null?void 0:n.products)||[],o=u||H(n),f=new Map;o&&Array.isArray(o.items)&&o.items.forEach(i=>{const l=w(i==null?void 0:i.sku);if(!l)return;const F=Number((i==null?void 0:i.amazonUnits)||0),S=Number((i==null?void 0:i.threePLUnits)||0);f.set(l,F+S)});const e=G(n,t),h=new Map,d=new Set,y=c==="doh"?"doh":"units";return a.forEach(i=>{const l=w(i==null?void 0:i.sku);if(!l)return;x(i)&&d.add(l);const F=f.has(l)?f.get(l):0;let S=Number.isFinite(F)?F:0,A=!1;const P=new Map,b=J(i,n);t.forEach(N=>{var V;const g=Y(n,l,N),m=Number.isFinite(g),$=((V=e.get(l))==null?void 0:V.get(N))||0;let D=null;!A&&m?(D=S+$-g,S=D):A=!0;const T=!m||A,E=m&&g>0?g/q(N):null,U=Number.isFinite(D)&&Number.isFinite(E)&&E>0?Math.max(0,Math.round(D/E)):null,L=Number.isFinite(g)&&Number.isFinite(b)?Math.round(g/q(N)*b):null,z=Number.isFinite(U)&&Number.isFinite(b)&&U>=b,I=Number.isFinite(D)&&Number.isFinite(L)&&D>=L,j=y==="doh"?z:I;P.set(N,{forecastUnits:g,hasForecast:m,inboundUnits:$,endAvailable:D,safetyDays:b,safetyUnits:L,doh:U,passesDoh:z,passesUnits:I,isCovered:j,forecastMissing:T})}),h.set(l,P)}),{months:t,perSkuMonth:h,inboundUnitsMap:e,snapshot:o,projectionMode:y,activeSkus:d}}export{W as a,Z as c,X as g,J as r};
