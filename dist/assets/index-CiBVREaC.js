import{aa as Yt,I as es,t as l,af as ts,k as t,T as me,K as ss,L as j,a7 as Kt,N as O,M as we,S as qe,V as ns}from"./index-D7jH1FVY.js";import{b as rs}from"./abcClassification-BPpZkpC9.js";import{r as os,a as as,c as is,g as re}from"./inventoryProjection-nTVtgHjF.js";import{T as Ut}from"./TanStackGrid-Dj2Kv21o.js";import{S as ls}from"./SkuAliasCell-DLkDfSgV.js";import{c as oe,n as w,a as cs,b as us,f as Z,d as ae}from"./months-BTPgK-LH.js";import{b as ds,c as hs,s as ms}from"./categoryOrder-C77cYWrY.js";import{e as fs,a as ps}from"./forecastVersioning-C8CmpCaX.js";import{b as gs,r as ys,c as js}from"./orderUtils-BIuENAT3.js";import{h as Nt,g as wt,s as Dt}from"./uiPrefs-CxTlE9qM.js";import{u as vs,C as We}from"./workspace-BOh-scKZ.js";import{a as Ft}from"./index-1JiJCeBY.js";import{S as Ot}from"./index-DHM-xNG6.js";import{C as bs}from"./index-ygadgiJ9.js";import{R as De}from"./index-BdbRizcT.js";import{R as ks}from"./InfoCircleOutlined-W98zD6L1.js";import{C as It}from"./Collapse-DuQU2sQG.js";const{Paragraph:Ss,Text:m,Title:Ge}=ss,$t=[6,12,18];function xs(o){if(!o||typeof o!="object")return{toVersionId:null,foConflictsOpen:0};const i=o;return{toVersionId:i.toVersionId==null?null:String(i.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(i.foConflictsOpen||0)))}}function Cs(o){(!o.inventory||typeof o.inventory!="object")&&(o.inventory={snapshots:[],settings:{projectionMonths:12,safetyDays:60}});const i=o.inventory;Array.isArray(i.snapshots)||(i.snapshots=[]),(!i.settings||typeof i.settings!="object")&&(i.settings={projectionMonths:12,safetyDays:60})}function V(o){const i=Number(o);return Number.isFinite(i)?Math.max(0,Math.round(i)):0}function Pt(o){return String(V(o))}function Ms(o){return String(o||"").replace(/[^\d]/g,"")}function zt({sku:o,field:i,value:d,onCommit:c}){const[v,x]=l.useState(()=>Pt(d)),[k,U]=l.useState(!1);l.useEffect(()=>{k||x(Pt(d))},[k,d]);const L=l.useCallback(()=>{const z=V(d),K=V(v);if(K===z){x(String(z));return}c({sku:o,field:i,value:K}),x(String(K))},[v,i,c,o,d]);return t.jsx(Kt,{className:"v2-grid-input",value:v,inputMode:"numeric",autoComplete:"off",style:{width:"100%"},"data-snapshot-editor":"units","data-snapshot-sku":o,"data-snapshot-field":i,onFocus:()=>U(!0),onBlur:()=>{U(!1),L()},onChange:z=>{x(Ms(z.target.value))},onKeyDown:z=>{if(z.key!=="Enter")return;z.preventDefault(),L();const K=z.currentTarget,le=Array.from(document.querySelectorAll("input[data-snapshot-editor='units']")),A=le.indexOf(K),q=A>=0?le[A+1]:null;q?(q.focus(),q.select()):K.blur()}})}function M(o){return Number.isFinite(o)?Math.round(Number(o)).toLocaleString("de-DE"):"—"}function ie(o){if(!o)return"—";const[i,d,c]=String(o).split("-").map(Number);if(!i||!d||!c)return"—";const v=new Date(Date.UTC(i,d-1,c));return Number.isNaN(v.getTime())?"—":v.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function Qe(o){const i={};return Array.isArray(o)&&o.forEach(d=>{const c=d||{},v=String(c.sku||"").trim();v&&(i[v]={amazonUnits:V(c.amazonUnits),threePLUnits:V(c.threePLUnits),note:String(c.note||"")})}),i}function As(){return new Date().toISOString()}function Us(o,i){var x;const d=((x=o.inventory)==null?void 0:x.snapshots)||[],c=w(i);return c&&d.find(k=>w(k.month)===c)||null}function Lt(o,i){var x;const d=w(i);if(!d)return null;const c=(((x=o.inventory)==null?void 0:x.snapshots)||[]).map(k=>k).filter(k=>w(k.month)).sort((k,U)=>String(w(k.month)).localeCompare(String(w(U.month))));let v=null;return c.forEach(k=>{const U=w(k.month);U&&U<d&&(v=k)}),v}function Ns(o){var d;const i=(((d=o.inventory)==null?void 0:d.snapshots)||[]).map(c=>w(c.month)).filter(Boolean);return i.length?(i.sort((c,v)=>c.localeCompare(v)),i[i.length-1]||null):null}function Et(o,i){const d=new Map;o.forEach(v=>{var k;const x=v.categoryLabel||"Ohne Kategorie";d.has(x)||d.set(x,[]),(k=d.get(x))==null||k.push(v)});const c=Array.from(d.entries()).map(([v,x])=>({key:v,label:v,rows:x.sort((k,U)=>{const L=k.alias.localeCompare(U.alias,"de-DE",{sensitivity:"base"});return L!==0?L:k.sku.localeCompare(U.sku,"de-DE",{sensitivity:"base"})})}));return ms(c,i)}function ws(o){return/^\d{4}-\d{2}$/.test(o)?`${o}-01`:null}function Fe(o){const i=Number(o);return!Number.isFinite(i)||i<=0?null:i}function Ds(o,i){var L;const d=Fe(o==null?void 0:o.productionLeadTimeDaysDefault)??Fe(i.defaultProductionLeadTimeDays)??45,c=(L=o==null?void 0:o.template)==null?void 0:L.fields,v=String((c==null?void 0:c.transportMode)??(o==null?void 0:o.transportMode)??"sea").toLowerCase(),x=i.transportLeadTimesDays||{},k=Fe(x[v])??Fe(x.sea)??45,U=Number(i.defaultBufferDays??0);return Math.max(0,Math.round(d+k+(Number.isFinite(U)?U:0)))}function Fs(o){return o==="doh"?"DOH zeigt die Reichweite des projizierten Monatsendbestands in Tagen.":o==="plan"?"Plan zeigt den geplanten Monatsabsatz (Forecast) je SKU.":"Units zeigt den projizierten Monatsendbestand je SKU inklusive Inbound-Wirkung."}function Bt(o){return o==="revenue_6m"?"ABC-Basis: Umsatz (6 Monate)":o==="units_6m_fallback"?"ABC-Basis: Units-Fallback (6 Monate)":"ABC-Basis: keine Forecast-Daten"}function Os(o,i){const d=String(o||"C").toUpperCase();return i==="safety-negative"?d==="A"?6:d==="B"?4:2:i==="safety-low"?d==="A"?3:d==="B"?2:1:0}function Is(o){const i=String(o||"").trim().toLowerCase();return i==="oos"?"oos":i==="under_safety"?"under_safety":"all"}function Ps(o){const i=String(o||"").trim().toLowerCase();return i==="a"?"a":i==="b"?"b":i==="ab"?"ab":i==="abc"?"abc":"all"}function Ze(o){const i=Number(o);if(!Number.isFinite(i))return 12;const d=Math.round(i);return $t.includes(d)?d:d<9?6:d<15?12:18}function zs(o){const i=String(o||"").trim().toLowerCase();return i==="doh"?"doh":i==="plan"?"plan":"units"}function Je(o){const i=String(o||"").trim().toUpperCase();return i==="A"||i==="B"||i==="C"?i:null}function Ls(o){const i=Je(o);return i==="A"?0:i==="B"?1:i==="C"?2:3}function Es(o,i){if(i==="all")return!0;const d=Je(o);return i==="a"?d==="A":i==="b"?d==="B":i==="ab"?d==="A"||d==="B":d!=null}function Bs(o){if(!o)return t.jsx(m,{type:"secondary",children:"Kein Inbound in diesem Monat."});const i=Array.isArray(o.poItems)?o.poItems:[],d=Array.isArray(o.foItems)?o.foItems:[];return t.jsxs("div",{style:{minWidth:260,maxWidth:340},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx(m,{strong:!0,children:"PO Inbound"}),i.length?t.jsx("div",{children:i.map(c=>t.jsx("div",{children:t.jsxs(m,{children:[c.ref," · +",M(c.units)," · ",ie(c.arrivalDate)]})},`po-${c.id}-${c.ref}-${c.units}-${c.arrivalDate}`))}):t.jsx(m,{type:"secondary",children:" Keine PO-Ankunft"})]}),t.jsxs("div",{children:[t.jsx(m,{strong:!0,children:"FO Inbound"}),d.length?t.jsx("div",{children:d.map(c=>t.jsx("div",{children:t.jsxs(m,{children:[c.ref," · +",M(c.units)," · ",ie(c.arrivalDate)]})},`fo-${c.id}-${c.ref}-${c.units}-${c.arrivalDate}`))}):t.jsx(m,{type:"secondary",children:" Keine FO-Ankunft"})]})]})}function sn({view:o="both"}={}){const i=Yt(),d=es(),{state:c,loading:v,saving:x,error:k,lastSavedAt:U,saveWith:L}=vs(),z=Nt("inventory_snapshot"),K=Nt("inventory_projection"),le=l.useRef(!1),[A,q]=l.useState(()=>oe()),[Xe,Ye]=l.useState(!1),[Oe,Ie]=l.useState({}),[et,fe]=l.useState(!1),[b,tt]=l.useState("units"),[Pe,st]=l.useState(""),[ze,Rt]=l.useState(!0),[J,pe]=l.useState("all"),[W,X]=l.useState("all"),[G,nt]=l.useState(12),[ge,ye]=l.useState(()=>wt("inventory_snapshot")),[je,ce]=l.useState(()=>wt("inventory_projection")),[I,ve]=l.useState(null),[be,rt]=l.useState(null),[ot,at]=l.useState(!1),[Y,it]=l.useState(null),[lt,Le]=l.useState(!1),[Ee,Be]=l.useState(null),[ee,Ke]=l.useState(null),$=o!=="projection",P=o!=="snapshot",D=c,ke=c.inventory||{},ct=ke.settings||{},$e=c.settings||{},ut=c.forecast&&typeof c.forecast=="object"?c.forecast:{},Se=l.useMemo(()=>{const e=structuredClone(ut||{});return fs(e),e},[ut]),Tt=l.useMemo(()=>ps(Se),[Se]),Re=xs(Se.lastImpactSummary),dt=String(Se.activeVersionId||"").trim()||null,xe=Re.toVersionId&&dt&&Re.toVersionId===dt?Re.foConflictsOpen:0;l.useEffect(()=>{if(le.current)return;const e=new URLSearchParams(i.search);if(e.get("source")!=="dashboard")return;le.current=!0;const n=String(e.get("sku")||"").trim();n?(st(n),it(n),Le(!1)):(it(null),Le(!0),Be(null));const s=w(e.get("month"));s&&rt(s),pe(Is(e.get("risk"))),X(Ps(e.get("abc"))),e.has("mode")&&tt(zs(e.get("mode"))),e.get("expand")==="all"&&at(!0)},[i.search]);const T=l.useMemo(()=>{const e=new Set;return e.add(oe()),(Array.isArray(ke.snapshots)?ke.snapshots:[]).forEach(n=>{const r=w(n.month);r&&e.add(r)}),Array.from(e).sort()},[ke.snapshots]),Ce=l.useMemo(()=>Ns(D),[c.inventory]);l.useEffect(()=>{T.includes(A)||(q(Ce||T[T.length-1]||oe()),Ye(!1))},[Ce,T,A]),l.useEffect(()=>{if(Xe)return;const e=Ce||T[T.length-1]||oe();e&&e!==A&&q(e)},[Ce,T,A,Xe]),l.useEffect(()=>{const e=Us(D,A),n=Qe((e==null?void 0:e.items)||[]);Ie(n),fe(!1)},[A,D]),l.useEffect(()=>{const e=Number(ct.projectionMonths);Number.isFinite(e)&&e>0&&nt(Ze(e))},[ct.projectionMonths]);const ht=l.useMemo(()=>{const e=new Map;return(Array.isArray(c.productCategories)?c.productCategories:[]).forEach(n=>{const s=n,r=String(s.id||"");r&&e.set(r,String(s.name||"Ohne Kategorie"))}),e},[c.productCategories]),te=l.useMemo(()=>ds(D),[c.productCategories]),Te=l.useMemo(()=>rs(D).bySku,[c]),mt=l.useMemo(()=>(Array.isArray(c.products)?c.products:[]).map(e=>e).map(e=>({sku:String(e.sku||"").trim(),raw:e})).filter(e=>e.sku),[c.products]);l.useMemo(()=>new Map(mt.map(e=>[e.sku,e.raw])),[mt]);const se=l.useMemo(()=>Lt(D,A),[A,D]),ft=l.useMemo(()=>Qe((se==null?void 0:se.items)||[]),[se==null?void 0:se.items]),pt=l.useMemo(()=>(Array.isArray(c.products)?c.products:[]).map(n=>{const s=n,r=String(s.sku||"").trim();if(!r)return null;const a=String(s.alias||r),u=String(s.status||"").trim().toLowerCase(),h=ts(s.includeInForecast,!0)&&(!u||u==="active"||u==="aktiv"),p=ht.get(String(s.categoryId||""))||"Ohne Kategorie",g=Oe[r]||{amazonUnits:0,threePLUnits:0},y=ft[r]||{amazonUnits:0,threePLUnits:0},C=g.amazonUnits+g.threePLUnits,E=y.amazonUnits+y.threePLUnits,Q=os(s,D),B=as(s,D),ne=Te.get(r.toLowerCase())||Te.get(r)||null,Jt=(ne==null?void 0:ne.abcClass)??null,Xt=(ne==null?void 0:ne.abcBasis)||"no_data";return{sku:r,alias:a,categoryLabel:p,abcClass:Jt,abcBasis:Xt,isActive:h,amazonUnits:g.amazonUnits,threePLUnits:g.threePLUnits,totalUnits:C,delta:C-E,safetyDays:Number.isFinite(Q)?Number(Q):null,coverageDays:Number.isFinite(B)?Number(B):null}}).filter(Boolean),[Te,ht,ft,Oe,c.products,D]),N=l.useMemo(()=>{const e=Pe.trim().toLowerCase();return pt.filter(n=>ze&&!n.isActive||!Es(n.abcClass,W)?!1:e?[n.sku,n.alias,n.categoryLabel,n.abcClass||""].join(" ").toLowerCase().includes(e):!0).sort((n,s)=>{const r=hs(n.categoryLabel,s.categoryLabel,te);if(r!==0)return r;const a=n.alias.localeCompare(s.alias,"de-DE",{sensitivity:"base"});return a!==0?a:n.sku.localeCompare(s.sku,"de-DE",{sensitivity:"base"})})},[W,pt,te,ze,Pe]),R=l.useMemo(()=>Et(N,te),[te,N]);l.useEffect(()=>{$&&ye(e=>{if(!R.length)return[];const n=new Set(R.map(r=>r.key)),s=e.filter(r=>n.has(r));return s.length||z?s:R.map(r=>r.key)})},[R,z,$]),l.useEffect(()=>{Dt("inventory_snapshot",ge)},[ge]),l.useEffect(()=>{Dt("inventory_projection",je)},[je]);const ue=oe(),gt=l.useMemo(()=>cs(ue,-1),[ue]),S=l.useMemo(()=>us(ue,G),[ue,G]),f=l.useMemo(()=>is({state:D,months:S,products:N.map(e=>({sku:e.sku,alias:e.alias,status:e.isActive?"active":"inactive",safetyStockDohOverride:e.safetyDays,foCoverageDohOverride:e.coverageDays})),snapshot:null,snapshotMonth:gt,projectionMode:b}),[N,gt,b,S,D]),yt=l.useMemo(()=>gs(D),[c.forecast,c.inventory,c.pos,c.fos]),H=l.useMemo(()=>{const e=new Set,n=new Set;let s=null,r=null;return N.forEach(a=>{S.forEach(u=>{var g;const h=(g=f.perSkuMonth.get(a.sku))==null?void 0:g.get(u);if(!h)return;const p=re({projectionMode:b,endAvailable:h.endAvailable,safetyUnits:h.safetyUnits,doh:h.doh,safetyDays:h.safetyDays});p&&(e.add(a.sku),(!s||u<s)&&(s=u),p==="safety-negative"&&(n.add(a.sku),(!r||u<r)&&(r=u)))})}),{underSafetySkus:e.size,oosSkus:n.size,criticalMonth:r||s,missingEta:Number(f.inboundMissingDateCount||0)}},[N,f,b,S]),de=l.useMemo(()=>{const e=new Map;return S.forEach(n=>{e.set(n,{month:n,score:0,oosCount:0,underSafetyCount:0,criticalSkus:new Set})}),N.forEach(n=>{S.forEach(s=>{var h;const r=(h=f.perSkuMonth.get(n.sku))==null?void 0:h.get(s);if(!r)return;const a=re({projectionMode:b,endAvailable:r.endAvailable,safetyUnits:r.safetyUnits,doh:r.doh,safetyDays:r.safetyDays});if(!a)return;const u=e.get(s);u&&(u.score+=Os(n.abcClass,a),u.underSafetyCount+=1,a==="safety-negative"&&(u.oosCount+=1),u.criticalSkus.add(n.sku))})}),e},[N,f,b,S]),jt=l.useMemo(()=>{const e=Array.from(de.values()).map(n=>Number(n.score||0));return e.length?Math.max(...e,0):0},[de]),vt=l.useMemo(()=>{const e=new Map;return N.forEach(n=>{let s=!1,r=!1;S.forEach(a=>{var p;const u=(p=f.perSkuMonth.get(n.sku))==null?void 0:p.get(a);if(!u)return;const h=re({projectionMode:b,endAvailable:u.endAvailable,safetyUnits:u.safetyUnits,doh:u.doh,safetyDays:u.safetyDays});h&&(r=!0,h==="safety-negative"&&(s=!0))}),e.set(n.sku,{hasOos:s,hasUnderSafety:r})}),e},[N,f,b,S]),he=l.useMemo(()=>J==="all"?N:N.filter(e=>{const n=vt.get(e.sku);return n?J==="oos"?n.hasOos:n.hasUnderSafety:!1}),[N,vt,J]),Me=l.useMemo(()=>Et(he,te),[te,he]),Ae=l.useMemo(()=>{var e;return I?((e=de.get(I))==null?void 0:e.criticalSkus)||new Set:null},[I,de]),F=l.useMemo(()=>!I||!Ae||!Ae.size?Me:Me.map(e=>({...e,rows:e.rows.filter(n=>Ae.has(n.sku))})).filter(e=>e.rows.length>0),[Me,Ae,I]);function bt(e,n,s,r){const a=ys(Array.isArray(c.products)?c.products:[],e.sku),u=Ds(a,$e),h=js({context:yt,sku:e.sku,leadTimeDays:u,product:a,settings:$e,horizonMonths:Math.max(6,G),requiredArrivalMonth:n}),p=String((h==null?void 0:h.status)||""),g=Number((h==null?void 0:h.recommendedUnits)||0),y=Math.max(0,Math.ceil(Number(s.safetyUnits||0)-Number(s.endAvailable||0))),C=Math.max(0,Math.round(Number.isFinite(g)&&g>0?g:y)),E=String((h==null?void 0:h.requiredArrivalDate)||ws(n)||"")||null,Q=String((h==null?void 0:h.orderDateAdjusted)||(h==null?void 0:h.orderDate)||"")||null;return{cellKey:r,row:e,month:n,data:s,recommendedUnits:C,requiredArrivalDate:E,recommendedOrderDate:Q,recommendation:h,recommendationStatus:p}}const Ue=l.useMemo(()=>{if(b==="plan")return new Map;const e=new Map;return he.forEach(n=>{var h,p;let s=null;for(const g of S){const y=(h=f.perSkuMonth.get(n.sku))==null?void 0:h.get(g);if(!y)continue;const C=re({projectionMode:b,endAvailable:y.endAvailable,safetyUnits:y.safetyUnits,doh:y.doh,safetyDays:y.safetyDays});if(C==="safety-negative"||C==="safety-low"){s=g;break}}if(!s)return;const r=(p=f.perSkuMonth.get(n.sku))==null?void 0:p.get(s);if(!r)return;const a=`${n.sku}|${s}`,u=bt(n,s,r,a);u.recommendationStatus!=="ok"||u.recommendedUnits<=0||e.set(a,u)}),e},[f,b,S,he,G,yt,$e,c.products]),_=l.useMemo(()=>{const e=Array.from(Ue.values()).map(n=>{const s=re({projectionMode:b,endAvailable:n.data.endAvailable,safetyUnits:n.data.safetyUnits,doh:n.data.doh,safetyDays:n.data.safetyDays});if(s!=="safety-negative"&&s!=="safety-low")return null;const r=Je(n.row.abcClass),a=n.month,u=Number(String(a||"").replace("-","")),h=s==="safety-negative"?-.5:0,p=Ls(r)*1e3+(Number.isFinite(u)?u:999999)+h;return{key:`${n.row.sku}|${n.month}`,sku:n.row.sku,alias:n.row.alias,abcClass:r,month:a,riskClass:s,recommendedUnits:n.recommendedUnits,requiredArrivalDate:n.requiredArrivalDate,recommendedOrderDate:n.recommendedOrderDate,priority:p,intent:n}}).filter(Boolean);return e.sort((n,s)=>{if(n.priority!==s.priority)return n.priority-s.priority;if(n.month!==s.month)return n.month.localeCompare(s.month);const r=Number(s.recommendedUnits||0)-Number(n.recommendedUnits||0);return r!==0?r:n.sku.localeCompare(s.sku,"de-DE",{sensitivity:"base"})}),e},[Ue,b]);l.useEffect(()=>{I&&!S.includes(I)&&ve(null)},[S,I]),l.useEffect(()=>{be&&S.length&&(S.includes(be)&&ve(be),rt(null))},[be,S]),l.useEffect(()=>{P&&ce(e=>{if(!F.length)return[];const n=new Set(F.map(r=>r.key)),s=e.filter(r=>n.has(r));return s.length||K?s:F.map(r=>r.key)})},[K,F,P]),l.useEffect(()=>{!P||!ot||F.length&&(ce(F.map(e=>e.key)),at(!1))},[ot,F,P]),l.useEffect(()=>{if(!P||!Y||lt)return;const e=`v2-proj-sku-${encodeURIComponent(Y)}`,n=Y.toLowerCase(),s=Array.from(document.querySelectorAll("[data-proj-sku-key]")).find(a=>String(a.dataset.projSkuKey||"")===n)||document.getElementById(e);if(!(s instanceof HTMLElement))return;s.scrollIntoView({behavior:"smooth",block:"center"}),Be(Y),Le(!0);const r=window.setTimeout(()=>{Be(a=>a&&(a.toLowerCase()===Y.toLowerCase()?null:a))},2200);return()=>window.clearTimeout(r)},[lt,Y,F,P]);function kt(e,n,s,r){Ke(bt(e,n,s,r))}function Ne(e,n){if(!e)return;const s=new URLSearchParams;s.set("source","inventory_projection"),s.set("sku",e.row.sku),s.set("month",e.month),s.set("suggestedUnits",String(e.recommendedUnits||0)),s.set("projectedEnd",String(Math.round(Number(e.data.endAvailable||0)))),s.set("mode",b),e.requiredArrivalDate&&s.set("requiredArrivalDate",e.requiredArrivalDate),e.recommendedOrderDate&&s.set("recommendedOrderDate",e.recommendedOrderDate),s.set("returnTo","/v2/inventory/projektion");const r=(n==null?void 0:n.nextIntent)||null;r&&(s.set("nextSku",r.row.sku),s.set("nextMonth",r.month),s.set("nextSuggestedUnits",String(r.recommendedUnits||0)),r.requiredArrivalDate&&s.set("nextRequiredArrivalDate",r.requiredArrivalDate),r.recommendedOrderDate&&s.set("nextRecommendedOrderDate",r.recommendedOrderDate)),d(`/v2/orders/fo?${s.toString()}`),Ke(null)}function Ht(e){var n,s,r,a,u,h;return t.jsxs("div",{className:"v2-proj-action-menu",children:[t.jsx(m,{strong:!0,children:e.row.alias}),t.jsx(m,{type:"secondary",children:e.row.sku}),t.jsx(m,{type:"secondary",children:Z(e.month)}),t.jsxs(m,{children:["Bestand EOM: ",t.jsx("strong",{children:M(e.data.endAvailable)})]}),t.jsxs(m,{children:["Safety: ",t.jsx("strong",{children:M(e.data.safetyUnits)})]}),t.jsxs(m,{children:["Ankunft: ",t.jsx("strong",{children:ie(e.requiredArrivalDate)})]}),t.jsxs(m,{children:["Bestellen bis: ",t.jsx("strong",{children:ie(e.recommendedOrderDate)})]}),t.jsxs(m,{children:["Vorschlag: ",t.jsx("strong",{children:M(e.recommendedUnits)})]}),e.recommendationStatus!=="ok"?t.jsx(m,{type:"warning",children:"Hinweis: Empfehlung ist nicht vollständig belastbar."}):null,Number(((n=e.recommendation)==null?void 0:n.coverageDaysForOrder)||0)>0?t.jsxs(m,{type:"secondary",children:["Bedarf (",M(Number(((s=e.recommendation)==null?void 0:s.coverageDaysForOrder)||0))," Tage): ",M(Number(((r=e.recommendation)==null?void 0:r.coverageDemandUnits)||0))]}):null,(a=e.recommendation)!=null&&a.moqApplied?t.jsxs(m,{type:"warning",children:["MOQ angewendet: kalkulatorisch ",M(Number(((u=e.recommendation)==null?void 0:u.recommendedUnitsRaw)||0))," → MOQ ",M(Number(((h=e.recommendation)==null?void 0:h.recommendedUnits)||0))]}):null,t.jsx("div",{className:"v2-actions-inline",children:t.jsx(O,{size:"small",type:"primary",onClick:()=>Ne(e),children:"FO erstellen"})})]})}const He=l.useCallback(e=>{const n=V(e.value);Ie(s=>{const r=s[e.sku]||{amazonUnits:0,threePLUnits:0,note:""};return r[e.field]===n?s:{...s,[e.sku]:{...r,[e.field]:n}}}),fe(!0)},[]),_t=l.useMemo(()=>[{header:"Alias",accessorKey:"alias",meta:{width:270,minWidth:250},cell:({row:e})=>t.jsx(ls,{alias:e.original.alias,sku:e.original.sku})},{header:"ABC",accessorKey:"abcClass",meta:{width:72,align:"center"},cell:({row:e})=>t.jsx(me,{title:Bt(e.original.abcBasis),children:t.jsx("span",{children:e.original.abcClass||"—"})})},{header:"Amazon",accessorKey:"amazonUnits",meta:{width:116,align:"right"},cell:({row:e})=>t.jsx(zt,{sku:e.original.sku,field:"amazonUnits",value:e.original.amazonUnits,onCommit:He})},{header:"3PL",accessorKey:"threePLUnits",meta:{width:116,align:"right"},cell:({row:e})=>t.jsx(zt,{sku:e.original.sku,field:"threePLUnits",value:e.original.threePLUnits,onCommit:He})},{header:"Total",accessorKey:"totalUnits",meta:{width:92,align:"right"},cell:({row:e})=>M(e.original.totalUnits)},{header:"Delta",accessorKey:"delta",meta:{width:92,align:"right"},cell:({row:e})=>t.jsx("span",{className:e.original.delta<0?"v2-negative":"",children:M(e.original.delta)})},{header:"Safety DOH",accessorKey:"safetyDays",meta:{width:96,align:"right"},cell:({row:e})=>M(e.original.safetyDays)},{header:"Coverage DOH",accessorKey:"coverageDays",meta:{width:108,align:"right"},cell:({row:e})=>M(e.original.coverageDays)}],[He]),St=Array.isArray(f.anchorForecastGapSkus)?f.anchorForecastGapSkus:[],xt=Array.isArray(f.anchorSkuFallbackSkus)?f.anchorSkuFallbackSkus:[],Ct=Array.isArray(f.anchorSkuMissingHistory)?f.anchorSkuMissingHistory:[],Mt=l.useMemo(()=>new Set(xt.map(e=>String(e||"").trim())),[xt]),At=l.useMemo(()=>new Set(Ct.map(e=>String(e||"").trim())),[Ct]),Vt=l.useMemo(()=>{const e=[{header:"Alias",accessorKey:"alias",meta:{width:270,minWidth:250},cell:({row:s})=>t.jsxs("div",{id:`v2-proj-sku-${encodeURIComponent(s.original.sku)}`,"data-proj-sku-key":s.original.sku.toLowerCase(),className:["v2-proj-alias",Ee&&s.original.sku.toLowerCase()===Ee.toLowerCase()?"v2-proj-alias--highlight":""].filter(Boolean).join(" "),children:[t.jsx("div",{className:"v2-proj-alias-main",title:s.original.alias,children:s.original.alias}),t.jsx(m,{className:"v2-proj-sku-secondary",type:"secondary",title:s.original.sku,children:s.original.sku})]})},{header:"ABC",accessorKey:"abcClass",meta:{width:68,align:"center"},cell:({row:s})=>t.jsx(me,{title:Bt(s.original.abcBasis),children:t.jsx("span",{children:s.original.abcClass||"—"})})},{header:"Safety DOH",accessorKey:"safetyDays",meta:{width:96,align:"right"},cell:({row:s})=>M(s.original.safetyDays)},{header:"Coverage DOH",accessorKey:"coverageDays",meta:{width:110,align:"right"},cell:({row:s})=>M(s.original.coverageDays)},{header:"Ankerbestand",meta:{width:118,align:"right",sortAccessor:s=>{const r=String(s.sku||"").trim(),a=f.startAvailableBySku.get(r);return Number.isFinite(a)?Number(a):0}},cell:({row:s})=>{var C,E;const r=String(s.original.sku||"").trim(),a=f.startAvailableBySku.get(r),u=Mt.has(r),h=At.has(r),p=((E=(C=f.anchorSourceBySku)==null?void 0:C.get)==null?void 0:E.call(C,r))||null,g=p!=null&&p.month?ae(String(p.month),"long"):"—",y=h?"Keine Snapshot-Historie für diese SKU. Startwert = 0.":u?`SKU-Fallback: letzter verfügbarer Snapshot (${g}).`:`Anchor-Snapshot (${g}).`;return t.jsx(me,{title:y,children:t.jsx("span",{children:M(Number.isFinite(a)?Number(a):0)})})}}],n=S.map(s=>({id:s,header:Z(s),meta:{minWidth:106,width:106,align:"right",sortAccessor:r=>{var u;const a=(u=f.perSkuMonth.get(r.sku))==null?void 0:u.get(s);return a?b==="plan"?Number.isFinite(a.forecastUnits)?Number(a.forecastUnits):null:b==="doh"?Number.isFinite(a.doh)?Number(a.doh):null:Number.isFinite(a.endAvailable)?Number(a.endAvailable):null:null}},cell:({row:r})=>{var Q;const a=(Q=f.perSkuMonth.get(r.original.sku))==null?void 0:Q.get(s);if(!a)return"—";let u=null;b==="plan"?u=Number.isFinite(a.forecastUnits)?Number(a.forecastUnits):null:b==="doh"?u=Number.isFinite(a.doh)?Number(a.doh):null:u=Number.isFinite(a.endAvailable)?Number(a.endAvailable):null;const h=re({projectionMode:b,endAvailable:a.endAvailable,safetyUnits:a.safetyUnits,doh:a.doh,safetyDays:a.safetyDays}),p=b!=="plan",g=a.inboundDetails,y=`${r.original.sku}|${s}`,C=Ue.get(y)||null,E=(ee==null?void 0:ee.cellKey)===y;return t.jsx(Ft,{trigger:p?"click":"hover",placement:"rightTop",open:p?E:void 0,onOpenChange:B=>{p&&!B&&E&&Ke(null)},content:E&&ee?Ht(ee):null,children:t.jsxs("div",{className:["v2-proj-cell",h?`v2-proj-cell--${h}`:"",p?"v2-proj-cell--actionable":""].filter(Boolean).join(" "),role:p?"button":void 0,tabIndex:p?0:void 0,onClick:p?()=>kt(r.original,s,a,y):void 0,onKeyDown:p?B=>{(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),kt(r.original,s,a,y))}:void 0,children:[t.jsx("div",{className:"v2-proj-cell-main",children:M(u)}),b!=="plan"&&Number.isFinite(a.safetyUnits)?t.jsxs(m,{type:"secondary",style:{fontSize:11},children:["SB: ",M(a.safetyUnits)]}):null,C?t.jsx("button",{type:"button",className:"v2-proj-fo-badge",onClick:B=>{B.stopPropagation(),Ne(C)},children:"FO empfohlen"}):null,g&&g.totalUnits>0?t.jsx(Ft,{content:Bs(g),trigger:"hover",placement:"topLeft",children:t.jsxs("div",{className:"v2-proj-inbound-row",children:[g.poUnits>0?t.jsxs(j,{className:"v2-proj-inbound v2-proj-inbound--po",children:["PO +",M(g.poUnits)]}):null,g.foUnits>0?t.jsxs(j,{className:"v2-proj-inbound v2-proj-inbound--fo",children:["FO +",M(g.foUnits)]}):null]})}):null]})})}}));return[...e,...n]},[ee,At,Mt,Ue,Ee,f,b,S]);async function qt(){await L(e=>{const n=ns(e),s=n;Cs(s);const r=s.inventory,a=Array.isArray(r.snapshots)?[...r.snapshots]:[],u=Object.entries(Oe).map(([y,C])=>({sku:y,amazonUnits:V(C.amazonUnits),threePLUnits:V(C.threePLUnits),note:String(C.note||"")})).filter(y=>y.amazonUnits>0||y.threePLUnits>0||y.note),h=w(A)||oe(),p=a.findIndex(y=>w(y.month)===h),g={month:h,items:u,updatedAt:As()};return p>=0?a[p]={...a[p]||{},...g}:a.push(g),a.sort((y,C)=>String(w(y.month)).localeCompare(String(w(C.month)))),r.snapshots=a,r.settings={...r.settings||{},projectionMonths:Ze(G)},n},"v2:inventory:save-snapshot"),fe(!1)}async function Wt(){const e=Lt(D,A);e&&(Ie(Qe(e.items||[])),fe(!0))}function Gt(){const n=[["SKU","Alias","Kategorie","AmazonUnits","ThreePLUnits","TotalUnits"],...N.map(u=>[u.sku,u.alias,u.categoryLabel,String(u.amazonUnits),String(u.threePLUnits),String(u.totalUnits)])].map(u=>u.map(h=>`"${String(h).replace(/"/g,'""')}"`).join(";")).join(`
`),s=new Blob([n],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`inventory-snapshot-${A}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}const _e=String(f.anchorMode||"no_snapshot"),Ve=w(f.anchorTargetMonth||f.anchorMonth),Qt=ue,Zt=_e==="rollforward"?`Anker: ${f.anchorSourceMonth||"—"} Snapshot → Rollforward bis ${Ve||"—"}`:_e==="snapshot"?`Anker: Snapshot ${Ve||f.anchorSourceMonth||"—"}`:"Anker: kein Snapshot (Start bei 0)";return t.jsxs("div",{className:"v2-page",children:[t.jsxs(We,{className:"v2-intro-card",children:[t.jsx("div",{className:"v2-page-head",children:t.jsxs("div",{children:[t.jsx(Ge,{level:3,children:$&&!P?"Bestandsaufnahme":P&&!$?"Bestandsprojektion":"Inventory"}),t.jsx(Ss,{children:$&&!P?"Monatliche Snapshot-Erfassung mit Kategoriegruppen, Copy-Forward, Speicherung und CSV-Export.":P&&!$?"Bestandsprojektion mit Risikoampel, PO/FO-Inbound-Sicht und direkter Bestellbrücke.":"Snapshot-Erfassung und Projektion (Units / DOH / Plan) in einem Arbeitsbereich."})]})}),t.jsxs("div",{className:"v2-toolbar",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[$?t.jsx(Ot,{value:A,onChange:e=>{q(e),Ye(!0)},options:T.map(e=>({value:e,label:`${e} · ${ae(e,"long")}`})),style:{width:260,maxWidth:"100%"}}):null,t.jsx(Kt,{value:Pe,onChange:e=>st(e.target.value),placeholder:"Suche SKU, Alias, Kategorie",style:{width:320,maxWidth:"100%"}}),t.jsx(bs,{checked:ze,onChange:e=>Rt(e.target.checked),children:"Nur aktive Produkte"}),P?t.jsxs(t.Fragment,{children:[t.jsxs(De.Group,{value:b,onChange:e=>tt(e.target.value),children:[t.jsx(De.Button,{value:"units",children:"Units"}),t.jsx(De.Button,{value:"doh",children:"DOH"}),t.jsx(De.Button,{value:"plan",children:"Plan"})]}),t.jsx(me,{title:Fs(b),children:t.jsx(ks,{style:{color:"#64748b",fontSize:16}})}),t.jsx(Ot,{value:G,onChange:e=>nt(Ze(e)),style:{width:160,maxWidth:"100%"},options:$t.map(e=>({value:e,label:`Horizont ${e} Monate`}))})]}):null,t.jsxs(j,{color:"blue",children:["Baseline Forecast: ",Tt]}),xe>0?t.jsxs(O,{size:"small",onClick:()=>d("/v2/forecast?panel=conflicts"),children:["Forecast-Änderung: ",xe," FOs prüfen"]}):null]}),$?t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsx(O,{onClick:()=>{Wt()},children:"Vorherigen Monat kopieren"}),t.jsx(O,{type:"primary",onClick:()=>{qt()},disabled:!et,loading:x,children:"Snapshot speichern"}),t.jsx(O,{onClick:Gt,children:"Snapshot CSV"}),et?t.jsx(j,{color:"orange",children:"Ungespeicherte Änderungen"}):t.jsx(j,{color:"green",children:"Gespeichert"}),t.jsx(j,{color:"blue",children:ae(A,"long")}),U?t.jsxs(j,{color:"green",children:["Gespeichert: ",new Date(U).toLocaleTimeString("de-DE")]}):null]}):null]})]}),k?t.jsx(we,{type:"error",showIcon:!0,message:k}):null,v?t.jsx(we,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,xe>0?t.jsx(we,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${xe} FOs prüfen`,description:t.jsx(O,{size:"small",onClick:()=>d("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,$?t.jsxs(We,{children:[t.jsxs(Ge,{level:4,children:["Snapshot zum Stichtag ",ae(A,"long")]}),t.jsxs(m,{type:"secondary",children:["Monatsschlüssel: ",A]}),t.jsxs("div",{className:"v2-category-tools",children:[t.jsxs(m,{type:"secondary",children:[N.length," Produkte in ",R.length," Kategorien"]}),t.jsxs("div",{className:"v2-actions-inline",children:[t.jsx(O,{size:"small",onClick:()=>ye(R.map(e=>e.key)),disabled:!R.length,children:"Alles auf"}),t.jsx(O,{size:"small",onClick:()=>ye([]),disabled:!ge.length,children:"Alles zu"})]})]}),R.length?t.jsx(It,{className:"v2-category-collapse",activeKey:ge,onChange:e=>ye((Array.isArray(e)?e:[e]).map(String)),items:R.map(e=>({key:e.key,label:t.jsxs(qe,{children:[t.jsx(m,{strong:!0,children:e.label}),t.jsxs("span",{className:"v2-category-count",children:[e.rows.length," Produkte"]})]}),children:t.jsx(Ut,{data:e.rows,columns:_t,minTableWidth:1e3,tableLayout:"fixed"})}))}):t.jsx(m,{type:"secondary",children:"Keine Snapshot-Zeilen für den aktuellen Filter."})]}):null,P?t.jsxs(We,{children:[t.jsxs(Ge,{level:4,children:["Projektion (",b.toUpperCase(),")"]}),t.jsxs("div",{className:"v2-proj-cluster-grid",children:[t.jsxs("div",{className:"v2-proj-context-cluster",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(j,{color:"blue",children:["Heute: ",ae(Qt,"long")]}),t.jsx(j,{color:_e==="no_snapshot"?"red":"blue",children:Zt}),t.jsxs(j,{color:"default",children:["Zeitraum: ",S[0]||"—"," bis ",S[S.length-1]||"—"]}),t.jsxs(j,{color:"default",children:["Horizont: ",G," Monate"]})]}),t.jsxs("div",{className:"v2-toolbar-row",children:[f.snapshotFallbackUsed?t.jsx(j,{color:"gold",children:"Fallback auf letzten Snapshot ≤ Ankermonat"}):null,f.resolvedSnapshotMonth?t.jsxs(j,{color:"blue",children:["Stichtag Anchor: ",ae(String(f.resolvedSnapshotMonth||Ve||""),"long")]}):null,Number(f.anchorSkuFallbackCount||0)>0?t.jsxs(j,{color:"gold",children:["SKU-Fallback aktiv: ",Number(f.anchorSkuFallbackCount||0)]}):null,H.missingEta>0?t.jsxs(j,{color:"orange",children:["Fehlende ETA: ",H.missingEta]}):t.jsx(j,{color:"green",children:"Fehlende ETA: 0"}),t.jsx(me,{title:"Units = projizierter Monatsendbestand · DOH = Reichweite in Tagen · Plan = Forecast-Absatz · Safety = Vergleich gegen Safety-Schwelle je SKU/Monat",children:t.jsx(j,{color:"default",children:"Modus-Hilfe"})})]}),St.length>0?t.jsx(we,{className:"v2-proj-anchor-warning",type:"warning",showIcon:!0,message:`Anker-Rollforward mit Forecast-Lücken bei ${St.length} SKU(s) – diese Monate wurden mit 0 Units gerechnet.`}):null]}),t.jsxs("div",{className:"v2-proj-filter-cluster",children:[t.jsx(m,{type:"secondary",children:"Risiko-Filter"}),t.jsxs("div",{className:"v2-toolbar-row v2-proj-filter-row",children:[t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${J==="all"?"is-active":""}`,onClick:()=>pe("all"),children:"Alle Risiken"}),t.jsxs("button",{type:"button",className:`v2-proj-filter-btn v2-proj-filter-btn--negative ${J==="oos"?"is-active":""}`,onClick:()=>pe("oos"),children:["OOS / ","<="," 0"]}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn v2-proj-filter-btn--low ${J==="under_safety"?"is-active":""}`,onClick:()=>pe("under_safety"),children:"Unter Safety"})]})]}),t.jsxs("div",{className:"v2-proj-filter-cluster",children:[t.jsx(m,{type:"secondary",children:"ABC-Filter"}),t.jsxs("div",{className:"v2-toolbar-row v2-proj-filter-row",children:[t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${W==="all"?"is-active":""}`,onClick:()=>X("all"),children:"Alle"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${W==="a"?"is-active":""}`,onClick:()=>X("a"),children:"A"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${W==="b"?"is-active":""}`,onClick:()=>X("b"),children:"B"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${W==="ab"?"is-active":""}`,onClick:()=>X("ab"),children:"A+B"}),t.jsx("button",{type:"button",className:`v2-proj-filter-btn ${W==="abc"?"is-active":""}`,onClick:()=>X("abc"),children:"ABC"})]})]})]}),t.jsxs("div",{className:"v2-proj-score-strip",children:[t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(j,{color:H.underSafetySkus>0?"gold":"green",children:["SKUs unter Safety: ",H.underSafetySkus]}),t.jsxs(j,{color:H.oosSkus>0?"red":"green",children:["OOS: ",H.oosSkus]}),t.jsxs(j,{color:"blue",children:["Kritischster Monat: ",H.criticalMonth?Z(H.criticalMonth):"—"]})]}),t.jsxs("div",{className:"v2-proj-heatmap",children:[S.map(e=>{const n=de.get(e),s=Number((n==null?void 0:n.score)||0),r=jt>0?Math.min(1,s/jt):0,a=I===e;return t.jsxs("button",{type:"button",className:`v2-proj-heatmap-item${a?" is-active":""}`,style:{background:`rgba(220, 38, 38, ${.08+r*.3})`,borderColor:a?"rgba(220, 38, 38, 0.8)":"rgba(15, 27, 45, 0.12)"},onClick:()=>ve(u=>u===e?null:e),title:`${Z(e)} · ABC-gewichteter Risikoscore ${s} · OOS ${Number((n==null?void 0:n.oosCount)||0)} · Unter Safety ${Number((n==null?void 0:n.underSafetyCount)||0)}`,children:[t.jsx("span",{children:Z(e)}),t.jsxs("strong",{children:["Score ",s]})]},e)}),I?t.jsx(O,{size:"small",onClick:()=>ve(null),children:"Filter löschen"}):null]}),t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(j,{className:"v2-proj-legend v2-proj-legend--negative",children:["Rot = OOS / ","<="," 0"]}),t.jsx(j,{className:"v2-proj-legend v2-proj-legend--low",children:"Orange = Unter Safety"}),t.jsx(j,{className:"v2-proj-legend",children:"Inbound Marker: PO / FO"}),t.jsx(m,{type:"secondary",children:"`FO empfohlen` im ersten Risikomonat anklicken oder Zelle öffnen für FO-Anlage."})]})]}),t.jsxs("div",{className:"v2-proj-worklist",children:[t.jsxs("div",{className:"v2-proj-worklist-head",children:[t.jsxs(qe,{wrap:!0,children:[t.jsx(m,{strong:!0,children:"FO-Arbeitsliste"}),t.jsxs(j,{color:_.length?"gold":"green",children:[_.length," SKU(s)"]}),t.jsx(j,{color:"blue",children:"Sortierung: A/B zuerst, frühester Risikomonat"})]}),_.length?t.jsx(O,{size:"small",type:"primary",onClick:()=>{var e,n;return Ne(((e=_[0])==null?void 0:e.intent)||null,{nextIntent:((n=_[1])==null?void 0:n.intent)||null})},children:"Erste SKU öffnen"}):null]}),_.length?t.jsx("div",{className:"v2-table-shell v2-scroll-host",children:t.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"SKU"}),t.jsx("th",{children:"ABC"}),t.jsx("th",{children:"Risikomonat"}),t.jsx("th",{children:"Risiko"}),t.jsx("th",{children:"Empfohlen"}),t.jsx("th",{children:"ETA-Ziel"}),t.jsx("th",{children:"Bestellen bis"}),t.jsx("th",{children:"Aktion"})]})}),t.jsx("tbody",{children:_.map((e,n)=>{var r;const s=((r=_[n+1])==null?void 0:r.intent)||null;return t.jsxs("tr",{children:[t.jsx("td",{children:t.jsxs("div",{className:"v2-proj-alias",children:[t.jsx(m,{className:"v2-proj-alias-main",children:e.alias||e.sku}),t.jsx(m,{className:"v2-proj-sku-secondary",type:"secondary",children:e.sku})]})}),t.jsx("td",{children:e.abcClass||"—"}),t.jsx("td",{children:Z(e.month)}),t.jsx("td",{children:e.riskClass==="safety-negative"?t.jsx(j,{color:"red",children:"OOS / ≤ 0"}):t.jsx(j,{color:"gold",children:"Unter Safety"})}),t.jsx("td",{children:M(e.recommendedUnits)}),t.jsx("td",{children:ie(e.requiredArrivalDate)}),t.jsx("td",{children:ie(e.recommendedOrderDate)}),t.jsx("td",{children:t.jsx(O,{size:"small",type:"primary",onClick:()=>Ne(e.intent,{nextIntent:s}),children:"FO öffnen"})})]},e.key)})})]})}):t.jsx(m,{type:"secondary",children:"Keine FO-Empfehlungen im aktuellen Filterumfang."})]}),t.jsxs("div",{className:"v2-category-tools",style:{marginTop:10},children:[t.jsx(m,{type:"secondary",children:I?`${F.reduce((e,n)=>e+n.rows.length,0)} kritische Produkte in ${F.length} Kategorien (${Z(I)})`:`${he.length} Produkte in ${Me.length} Kategorien`}),t.jsxs("div",{className:"v2-actions-inline",children:[t.jsx(O,{size:"small",onClick:()=>ce(F.map(e=>e.key)),disabled:!F.length,children:"Alles auf"}),t.jsx(O,{size:"small",onClick:()=>ce([]),disabled:!je.length,children:"Alles zu"})]})]}),F.length?t.jsx(It,{className:"v2-category-collapse",activeKey:je,onChange:e=>ce((Array.isArray(e)?e:[e]).map(String)),items:F.map(e=>({key:e.key,label:t.jsxs(qe,{children:[t.jsx(m,{strong:!0,children:e.label}),t.jsxs("span",{className:"v2-category-count",children:[e.rows.length," Produkte"]})]}),children:t.jsx(Ut,{data:e.rows,columns:Vt,minTableWidth:Math.max(1080,760+S.length*118),tableLayout:"fixed",crosshair:"matrix"})}))}):t.jsx(m,{type:"secondary",children:"Keine Projektion für den aktuellen Filter."})]}):null]})}export{sn as I};
