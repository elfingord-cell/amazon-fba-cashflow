import{X as A,Y as O,t as H,k as e,L as U,M as n,N as M,S as r,R as N,O as l,T as K,Z as R,$ as B,a0 as z,W as Q,a1 as G}from"./index-D6pMtF0j.js";import{D as W}from"./DeNumberInput-CX2Y0IgS.js";import{u as X,C as u}from"./workspace-CPdCVGI9.js";import{s as Z}from"./index-7KSmUmnD.js";import{C as I}from"./index-B8Utj4Z_.js";import{R as q}from"./InfoCircleOutlined-1b7uZfvq.js";import{S as V}from"./index-aM_fcGg-.js";import"./index-IqeLlo-_.js";import"./DownOutlined-BAIni2KE.js";import"./Dropdown-CGxjL3l8.js";import"./useBubbleLock-CgXBP_Sr.js";const{Paragraph:Y,Text:c,Title:x}=U;function L(o){const b=Q(o);return Number.isFinite(b)?G(Number(b),B,R):null}function g(o){return o?"An":"Aus"}function he(){const{state:o,loading:b,saving:D,error:k,lastSavedAt:C,saveWith:E}=X(),[w,P]=Z.useMessage(),d=o.settings||{},S=o.forecast&&typeof o.forecast=="object"?o.forecast:{},j=(S.settings&&typeof S.settings=="object"?S.settings:{}).useForecast===!0,h=d.cashInCalibrationEnabled!==!1,f=A(d.cashInCalibrationHorizonMonths,6),v=d.cashInRecommendationSeasonalityEnabled==null?d.cashInRecommendationIgnoreQ4!==!0:d.cashInRecommendationSeasonalityEnabled!==!1,T=L(d.cashInRecommendationBaselineNormalPct)??O,_=H.useMemo(()=>[`Forecast: ${g(j)}`,"Cash-In Quote: Empfohlen (Plan)",`Kalibrierung: ${g(h)}${h?` (${f} Monate)`:""}`,`Saisonalität: ${g(v)}`].join(" · "),[h,f,v,j]);async function y(s,t){try{await E(a=>{const p=z(a),i=p,m=i.settings&&typeof i.settings=="object"?i.settings:{};return i.settings={...m,...s},p},t)}catch(a){w.error(a instanceof Error?a.message:"Methodik konnte nicht gespeichert werden.")}}async function F(s,t){try{await E(a=>{const p=z(a),i=p;(!i.forecast||typeof i.forecast!="object")&&(i.forecast={});const m=i.forecast,$=m.settings&&typeof m.settings=="object"?m.settings:{};return m.settings={...$,...s},p},t)}catch(a){w.error(a instanceof Error?a.message:"Forecast-Methodik konnte nicht gespeichert werden.")}}return e.jsxs("div",{className:"v2-page",children:[P,e.jsxs(u,{className:"v2-intro-card",children:[e.jsx("div",{className:"v2-page-head",children:e.jsxs("div",{children:[e.jsx(x,{level:3,children:"Methodik & Regeln"}),e.jsx(Y,{children:"Zentraler Ort für globale Rechenlogik. Änderungen wirken global auf Dashboard, Soll/Ist, USt und weitere Auswertungen."})]})}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs("div",{className:"v2-toolbar-row",children:[D?e.jsx(n,{color:"processing",children:"Speichern..."}):e.jsx(n,{color:"green",children:"Synchron"}),C?e.jsxs(n,{color:"green",children:["Gespeichert: ",new Date(C).toLocaleTimeString("de-DE")]}):null]})})]}),k?e.jsx(M,{type:"error",showIcon:!0,message:k}):null,b?e.jsx(M,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,e.jsx(u,{children:e.jsxs(r,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs(r,{wrap:!0,children:[e.jsx(x,{level:5,style:{margin:0},children:"Aktive Rechenbasis (global)"}),e.jsx(n,{color:"blue",children:"GLOBAL"})]}),e.jsx(c,{children:_}),e.jsxs(N,{gutter:[12,12],children:[e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(n,{color:j?"green":"default",children:["Forecast: ",g(j)]})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsx(n,{children:"Cash-In Quote: Empfohlen (Plan)"})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(n,{children:["Kalibrierung: ",g(h),h?` (${f} M)`:""]})}),e.jsx(l,{xs:24,md:12,xl:6,children:e.jsxs(n,{children:["Saisonalität: ",g(v)]})})]})]})}),e.jsxs(N,{gutter:[12,12],children:[e.jsx(l,{xs:24,xl:12,children:e.jsxs(u,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(x,{level:5,style:{margin:0},children:"A) Forecast-Nutzung"}),e.jsx(n,{color:"blue",children:"GLOBAL"})]}),e.jsx(I,{checked:j,onChange:s=>{F({useForecast:s.target.checked},`v2:methodik:forecast-use:${s.target.checked?"on":"off"}`)},children:"Absatzprognose im Cashflow nutzen"}),e.jsx("div",{children:e.jsx(c,{type:"secondary",children:"Wirkt global auf Dashboard, Soll/Ist, USt, …"})})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(u,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(x,{level:5,style:{margin:0},children:"B) Auszahlungsquote (Plan)"}),e.jsx(n,{color:"blue",children:"GLOBAL"}),e.jsx(K,{title:"Empfohlen (Plan) nutzt Niveau + Saisonmuster - kleine Sicherheitsmarge. Manuell/Eingaben steuerst du im Dashboard oder in der Sandbox.",children:e.jsx(n,{icon:e.jsx(q,{}),children:"Hilfe"})})]}),e.jsx(c,{children:"Kein separater Basis/Konservativ-Modus mehr. Die Empfehlung bleibt leicht vorsichtig über die integrierte Sicherheitsmarge."})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(u,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(x,{level:5,style:{margin:0},children:"C) Umsatz-Kalibrierung"}),e.jsx(n,{color:"blue",children:"GLOBAL"})]}),e.jsxs(r,{wrap:!0,children:[e.jsx(I,{checked:h,onChange:s=>{y({cashInCalibrationEnabled:s.target.checked},`v2:methodik:calibration-enabled:${s.target.checked?"on":"off"}`)},children:"Umsatz-Kalibrierung aktiv"}),e.jsxs(r,{align:"center",children:[e.jsx(c,{children:"Wirkt über:"}),e.jsx(V,{value:f,options:[{value:3,label:"3 Monate"},{value:6,label:"6 Monate"},{value:12,label:"12 Monate"}],onChange:s=>{const t=A(s,6);y({cashInCalibrationHorizonMonths:t},`v2:methodik:calibration-horizon:${t}`)},style:{width:160}})]})]}),e.jsx("div",{children:e.jsx(c,{type:"secondary",children:"Kalibriert nur Umsatz (Cash-In), keine Units/Absatz."})})]})}),e.jsx(l,{xs:24,xl:12,children:e.jsxs(u,{children:[e.jsxs(r,{wrap:!0,style:{marginBottom:8},children:[e.jsx(x,{level:5,style:{margin:0},children:"D) Empfehlung-Regeln (Lernend)"}),e.jsx(n,{color:"blue",children:"GLOBAL"})]}),e.jsxs(r,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsx(I,{checked:v,onChange:s=>{const t=s.target.checked;y({cashInRecommendationSeasonalityEnabled:t,cashInRecommendationIgnoreQ4:!t},`v2:methodik:recommendation-seasonality:${t?"on":"off"}`)},children:"Saisonalität in Empfehlung aktivieren"}),e.jsx(r,{wrap:!0,children:e.jsxs(r,{align:"center",children:[e.jsx(c,{children:"Startniveau L (%)"}),e.jsx(W,{value:T,mode:"percent",min:B,max:R,step:.1,style:{width:128},onChange:s=>{const t=L(s);Number.isFinite(t)&&y({cashInRecommendationBaselineNormalPct:t},"v2:methodik:recommendation-baseline-normal")}})]})}),e.jsx(c,{type:"secondary",children:"Für ein robustes Startprofil (historische Quoten) bitte im Cash-in Setup den Import im Cash-In-Block nutzen."})]})]})})]})]})}export{he as default};
