import{c as x}from"./costing-CmZrILJ2.js";function f(e){if(e==null||e==="")return null;if(typeof e=="number")return Number.isFinite(e)?e:null;const l=String(e).trim();if(!l)return null;const a=l.includes(",")?l.replace(/\./g,"").replace(",","."):l,n=Number(a);return Number.isFinite(n)?n:null}function P(e){return String(e||"").trim().toLowerCase()}function F(e,l){const a=P(l);return a&&(e||[]).find(n=>P(n==null?void 0:n.sku)===a)||null}function K(e,l){if(!l)return null;const a=String(l||"").trim();return(e||[]).find(n=>String((n==null?void 0:n.id)||"").trim()===a)||null}function N(e,l){const a=P(l);if(!a)return null;const i=(e||[]).filter(Boolean).filter(s=>{const t=P(s==null?void 0:s.sku)===a,r=Array.isArray(s==null?void 0:s.items)?s.items.some(u=>P(u==null?void 0:u.sku)===a):!1;return t||r}).sort((s,t)=>String(t.orderDate||t.createdAt||"").localeCompare(String(s.orderDate||s.createdAt||""))).find(s=>(s==null?void 0:s.supplierId)||(s==null?void 0:s.supplier));return i&&String(i.supplierId||i.supplier||"").trim()||null}function q(e,l,a){const n=P(l);if(!n)return null;const i=((e==null?void 0:e.productSuppliers)||[]).filter(t=>P(t==null?void 0:t.sku)===n);if(!i.length)return null;if(a){const t=i.find(r=>String((r==null?void 0:r.supplierId)||"").trim()===String(a).trim());if(t)return t}return i.find(t=>t==null?void 0:t.isPreferred)||i[0]||null}function z(e,l,a){const n=F((e==null?void 0:e.products)||[],l),i=a||(n==null?void 0:n.supplierId),s=q(e,l,i),t=i||(s==null?void 0:s.supplierId)||N([...(e==null?void 0:e.pos)||[],...(e==null?void 0:e.fos)||[]],l)||"",r=K((e==null?void 0:e.suppliers)||[],t);return{product:n,supplier:r,supplierId:t,productSupplier:s}}function _(e,l){var i;const a=((i=e==null?void 0:e.template)==null?void 0:i.fields)||(e==null?void 0:e.template)||{},n=f((e==null?void 0:e.fxOverride)??(e==null?void 0:e.fxUsdPerEur)??a.fxRate??(l==null?void 0:l.fxRate));return n!=null&&n>0?{value:n,source:(e==null?void 0:e.fxOverride)!=null||(e==null?void 0:e.fxUsdPerEur)!=null||a.fxRate!=null?"product":"settings"}:{value:null,source:null}}function B({product:e,productSupplier:l,supplier:a,settings:n}){const i=f((e==null?void 0:e.productionLeadTimeDays)??(e==null?void 0:e.productionLeadTimeDaysDefault));if(i!=null&&i>0)return{value:i,source:"product"};const s=f(l==null?void 0:l.productionLeadTimeDays);if(s!=null&&s>0)return{value:s,source:"productSupplier"};const t=f(a==null?void 0:a.productionLeadTimeDaysDefault);if(t!=null&&t>0)return{value:t,source:"supplier"};const r=f(n==null?void 0:n.defaultProductionLeadTimeDays);return r!=null&&r>0?{value:r,source:"settings"}:{value:null,source:null}}function O({product:e,transportMode:l}){var i;const a=((i=e==null?void 0:e.template)==null?void 0:i.fields)||(e==null?void 0:e.template)||{},n=l||a.transportMode||(e==null?void 0:e.defaultTransportMode)||a.transport||"SEA";return String(n).toUpperCase()}function W({settings:e,product:l,transportMode:a}){var r;const n=((r=l==null?void 0:l.template)==null?void 0:r.fields)||(l==null?void 0:l.template)||{},i=f((l==null?void 0:l.transitDays)??n.transitDays);if(i!=null&&i>0)return{value:i,source:"product"};const s=(e==null?void 0:e.transportLeadTimesDays)||{},t=f(s[String(a||"SEA").toLowerCase()]);return t!=null&&t>0?{value:t,source:"settings"}:{value:null,source:null}}function w({product:e,productSupplier:l}){var s;const a=((s=e==null?void 0:e.template)==null?void 0:s.fields)||(e==null?void 0:e.template)||{},n=f(l==null?void 0:l.unitPrice);if(n!=null&&n>0)return{value:n,source:"productSupplier"};const i=f(a.unitPriceUsd??(e==null?void 0:e.unitPriceUsd)??(e==null?void 0:e.defaultUnitPrice)??(e==null?void 0:e.unitPrice));return i!=null&&i>0?{value:i,source:"product"}:{value:null,source:null}}function $({product:e,productSupplier:l,supplier:a,settings:n}){var r;const i=((r=e==null?void 0:e.template)==null?void 0:r.fields)||(e==null?void 0:e.template)||{},s=(l==null?void 0:l.currency)||(a==null?void 0:a.currencyDefault)||i.currency||(n==null?void 0:n.defaultCurrency),t=String(s||"EUR").trim().toUpperCase();return["EUR","USD","CNY"].includes(t)?t:"EUR"}function c({product:e,productSupplier:l,fxRate:a,unitPriceUsd:n}){var m;const i=((m=e==null?void 0:e.template)==null?void 0:m.fields)||(e==null?void 0:e.template)||{},s=f((e==null?void 0:e.logisticsPerUnitEur)??(e==null?void 0:e.freightPerUnitEur)??i.freightEur??(l==null?void 0:l.logisticsPerUnitEur));if(s!=null&&s>0)return{value:s,source:"product"};const t=f(i.extraPerUnitUsd)||0,r=f(e==null?void 0:e.landedUnitCostEur),u=x({unitPriceUsd:n!=null?n+t:null,landedCostEur:r,fxUsdPerEur:a});return u.value!=null?{value:u.value,source:"computed"}:{value:null,source:null,missingFields:u.missingFields||[]}}function d({product:e,settings:l}){var i;const a=((i=e==null?void 0:e.template)==null?void 0:i.fields)||(e==null?void 0:e.template)||{},n=f((e==null?void 0:e.dutyRatePct)??a.dutyPct??(l==null?void 0:l.dutyRatePct));return Number.isFinite(n)?n:null}function p({product:e,settings:l}){var i;const a=((i=e==null?void 0:e.template)==null?void 0:i.fields)||(e==null?void 0:e.template)||{},n=f((e==null?void 0:e.eustRatePct)??a.vatImportPct??(l==null?void 0:l.eustRatePct));return Number.isFinite(n)?n:null}function ee({product:e,settings:l}){var n;const a=((n=e==null?void 0:e.template)==null?void 0:n.fields)||(e==null?void 0:e.template)||{};return typeof a.ddp=="boolean"?a.ddp:typeof(e==null?void 0:e.ddp)=="boolean"?e.ddp:typeof(l==null?void 0:l.defaultDdp)=="boolean"?l.defaultDdp:!1}function le({productSupplier:e,supplier:l}){return Array.isArray(e==null?void 0:e.paymentTermsTemplate)&&e.paymentTermsTemplate.length?{value:e.paymentTermsTemplate,source:"productSupplier"}:Array.isArray(l==null?void 0:l.paymentTermsDefault)&&l.paymentTermsDefault.length?{value:l.paymentTermsDefault,source:"supplier"}:{value:null,source:null}}function g(e){return String(e||"").trim()}function G({product:e,productSupplier:l,supplier:a,settings:n}){var m;const i=((m=e==null?void 0:e.template)==null?void 0:m.fields)||(e==null?void 0:e.template)||{};let s=null,t=null;l!=null&&l.currency?(s="productSupplier",t=l.currency):a!=null&&a.currencyDefault?(s="supplier",t=a.currencyDefault):i.currency?(s="template",t=i.currency):n!=null&&n.defaultCurrency&&(s="settings",t=n.defaultCurrency);const r=String(t||"EUR").trim().toUpperCase(),u=["EUR","USD","CNY"].includes(r)?r:"EUR";return!s&&u==="EUR"?{value:u,source:"fallback"}:{value:u,source:s}}function Q({product:e,settings:l}){var t;const a=((t=e==null?void 0:e.template)==null?void 0:t.fields)||(e==null?void 0:e.template)||{},n=f(e==null?void 0:e.dutyRatePct);if(n!=null)return{value:n,source:"product"};const i=f(a.dutyPct);if(i!=null)return{value:i,source:"template"};const s=f(l==null?void 0:l.dutyRatePct);return s!=null?{value:s,source:"settings"}:{value:null,source:null}}function Y({product:e,settings:l}){var t;const a=((t=e==null?void 0:e.template)==null?void 0:t.fields)||(e==null?void 0:e.template)||{},n=f(e==null?void 0:e.eustRatePct);if(n!=null)return{value:n,source:"product"};const i=f(a.vatImportPct);if(i!=null)return{value:i,source:"template"};const s=f(l==null?void 0:l.eustRatePct);return s!=null?{value:s,source:"settings"}:{value:null,source:null}}function v(e,l){return{fieldKey:e,label:l}}function ne(e,l={}){const a=l.state||{},n=l.settings||a.settings||{},i=l.suppliers||a.suppliers||[],s=l.productSuppliers||a.productSuppliers||[],t=l.pos||a.pos||[],r=l.fos||a.fos||[],u=[],m=[],U=[],S=g(e==null?void 0:e.sku);S||u.push(v("sku","SKU")),g(e==null?void 0:e.alias)||u.push(v("alias","Alias")),g(e==null?void 0:e.categoryId)||u.push(v("categoryId","Kategorie"));const{product:y,supplier:k,productSupplier:h}=z({products:[e].filter(Boolean),suppliers:i,productSuppliers:s,pos:t,fos:r},S,e==null?void 0:e.supplierId),o=w({product:y,productSupplier:h}),D=G({product:y,productSupplier:h,supplier:k,settings:n}),L=o.value!=null&&o.value>0,I=!!D.value;!L||!I?u.push(v("unitPriceUsd","Stückpreis (Währung)")):(o.source!=="product"||!["product","template"].includes(D.source))&&m.push({fieldKey:"unitPriceUsd",label:"Stückpreis (Währung)",value:{amount:o.value,currency:D.value}});const T=B({product:y,productSupplier:h,supplier:k,settings:n});T.value?T.source!=="product"&&m.push({fieldKey:"productionLeadTimeDaysDefault",label:"Produktionszeit (Tage)",value:T.value}):u.push(v("productionLeadTimeDaysDefault","Produktionszeit (Tage)"));const A=O({product:y,transportMode:y==null?void 0:y.defaultTransportMode}),E=W({settings:n,product:y,transportMode:A});E.value?E.source!=="product"&&m.push({fieldKey:"transitDays",label:"Transit-Tage",value:E.value}):u.push(v("transitDays","Transit-Tage"));const M=f((e==null?void 0:e.moqOverrideUnits)??(e==null?void 0:e.moqUnits)),R=f(n==null?void 0:n.moqDefaultUnits);(M==null||M<=0)&&(R!=null&&R>0?m.push({fieldKey:"moqUnits",label:"MOQ",value:R}):u.push(v("moqUnits","MOQ")));const b=Q({product:y,settings:n});b.value==null?u.push(v("dutyPct","Zoll %")):b.source==="settings"&&m.push({fieldKey:"dutyPct",label:"Zoll %",value:b.value});const C=Y({product:y,settings:n});C.value==null?u.push(v("vatImportPct","EUSt %")):C.source==="settings"&&m.push({fieldKey:"vatImportPct",label:"EUSt %",value:C.value});const V=f(e==null?void 0:e.avgSellingPriceGrossEUR);return(V==null||V<=0)&&u.push(v("avgSellingPriceGrossEUR","Ø VK-Preis (Brutto)")),f(e==null?void 0:e.sellerboardMarginPct)==null&&U.push(v("sellerboardMarginPct","Sellerboard Marge")),f(e==null?void 0:e.landedUnitCostEur)==null&&U.push(v("landedUnitCostEur","Einstandspreis (EUR)")),{status:u.length?"blocked":"ok",blockingMissing:u,defaulted:m,suggestedMissing:U}}export{O as a,$ as b,_ as c,B as d,ne as e,W as f,w as g,c as h,d as i,p as j,ee as k,le as l,z as r};
