function p(t){return String(t||"").trim()}function g(t){const r=Number(t);return Number.isFinite(r)?r:0}function S(t){const r=Math.abs(g(t.amount));return String(t.direction||"").toLowerCase()==="out"?-r:r}function b(t){const r=String(t.source||"").toLowerCase();return r==="po"?"po":r==="fo"?"fo":r==="sales"?"sales":r==="fixcosts"?"fixcosts":r==="extras"?"extras":r==="dividends"?"dividends":r==="vat"?"vat":"unknown"}function w(t){const r=String(t.source||"").toLowerCase(),e=String(t.kind||"").toLowerCase(),i=String(t.group||"").toLowerCase();return r==="po"||r==="fo"?"po_fo":r==="sales"?"inflow":r==="fixcosts"||i==="fixkosten"?"fixcost":e.includes("duty")||e.includes("eust")||e.includes("vat")||i.includes("import")?"tax":String(t.direction||"").toLowerCase()==="in"?"inflow":String(t.direction||"").toLowerCase()==="out"?"outflow":"other"}function k(t){const r=Array.isArray(t.products)?t.products:[],e=new Map;r.forEach(s=>{const n=p(s.sku);if(!n)return;const o=String(s.alias||"").trim()||n;e.set(n,o)});const i=new Map,a=(s,n)=>{const o=String(n[s==="po"?"poNo":"foNo"]||n.id||"").trim();if(!o)return;const c=Array.isArray(n.items)&&n.items.length?n.items:[{sku:n.sku,units:n.units}],l=new Set;let f=0;c.forEach(u=>{const d=p(u.sku);if(!d)return;l.add(e.get(d)||d);const m=g(u.units??u.qty??u.quantity);f+=m}),i.set(`${s}:${o}`,{aliases:Array.from(l),units:Number.isFinite(f)?f:null})};return(Array.isArray(t.pos)?t.pos:[]).forEach(s=>a("po",s)),(Array.isArray(t.fos)?t.fos:[]).forEach(s=>a("fo",s)),i}function A(t){const r=new Map,e=k(t.state);return(Array.isArray(t.breakdown)?t.breakdown:[]).forEach(i=>{const a=String(i.month||"").trim();if(!a)return;const n=(Array.isArray(i.entries)?i.entries:[]).map(o=>{const c=b(o),l=o.sourceNumber?String(o.sourceNumber):void 0,f=l&&(c==="po"||c==="fo")?`${c}:${l}`:null,u=f?e.get(f):null;return{month:a,group:w(o),label:String(o.label||"Eintrag"),amount:S(o),paid:typeof o.paid=="boolean"?o.paid:null,source:c,sourceNumber:l,tooltipMeta:u?{aliases:u.aliases,units:u.units,milestone:String(o.label||""),dueDate:o.date?String(o.date):null}:void 0}});r.set(a,n)}),r}export{A as b};
