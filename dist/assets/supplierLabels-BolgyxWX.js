function u(s){return String(s||"").trim().toLowerCase()}function A(s){if(s==null||s==="")return 0;const l=String(s).trim().replace(/\s+/g,"").replace(",","."),c=Number(l);return Number.isFinite(c)?c:0}function M(s,l=null){const c=Array.isArray(s.suppliers)?s.suppliers:[],b=Array.isArray(l)?l:Array.isArray(s.products)?s.products:[],g=new Map(b.map(n=>[u(n.sku),n.alias||n.sku])),y=new Map;c.forEach(n=>{const a=u(n.id),e=u(n.name);a&&y.set(a,n.id),e&&y.set(e,n.id)});const p=new Map;(s.pos||[]).forEach(n=>{const a=u(n.supplierId||n.supplier),e=a?y.get(a):null;if(!e)return;const o=(t,f)=>{const r=u(t);if(!r)return;const i=p.get(e)||new Map;i.set(r,(i.get(r)||0)+A(f)),p.set(e,i)};Array.isArray(n.items)&&n.items.length?n.items.forEach(t=>o(t==null?void 0:t.sku,t==null?void 0:t.units)):o(n.sku,n.units)});const d=new Map;return c.forEach(n=>{const a=n.company_name?String(n.company_name).trim():"",e=p.get(n.id);let o="noch keine PO";if(e&&e.size){let r="",i=-1;e.forEach((m,k)=>{m>i&&(i=m,r=k)}),r&&(o=g.get(r)||r)}const t=n.name||"—",f=a||"—";d.set(n.id,`${t} – ${f} (${o})`)}),d}export{M as b};
