import{t as i,_ as Fs,k as e,I as oe,J as is,K as Ps,L as Os,P as _,S,M as d,N as O,T as L,O as Bs,Q as ze,R as Rs}from"./index-BAXFY6Sx.js";import{E as Ts}from"./index-C8Y02GVI.js";import{c as Ls}from"./cashflow-IGITWurX.js";import{b as Ks}from"./dashboardMaturity-C11ENgBs.js";import{b as $s}from"./orderEditorFactory-BraB64YB.js";import{c as _s,a as Us,b as Vs,d as qs}from"./orderUtils-ClVESXIm.js";import{b as ls,r as Gs,a as Hs,c as Ws}from"./phantomFo-DmLPl2XR.js";import{e as Qs,g as Zs}from"./forecastVersioning-C7ChuVBo.js";import{c as Ys}from"./inventoryProjection-Bk1BjfRg.js";import{m as Js,c as nt,a as Xs,n as en,b as Qe,f as V}from"./months-DiLwPhVv.js";import{u as tn,C as $}from"./workspace-U3XTpCZs.js";import{h as sn,g as nn,s as rn}from"./uiPrefs-CxTlE9qM.js";import{C as we}from"./Collapse-DRoAg3kU.js";import{R as X}from"./InfoCircleOutlined-3kfZ-K2R.js";import{S as Jt}from"./index-JSAUgCOY.js";import{S as Ze}from"./index-BFbRrIN8.js";import{P as on}from"./index-DjXNHvUj.js";import{S as bt}from"./index-B4_Z5XXk.js";import{C as an}from"./index-CMZUhGsA.js";import"./planProducts-CGSHsSOQ.js";import"./cashInRules-r9rlv23d.js";import"./store-TU6N4non.js";import"./prefill-ZPOz_KU9.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-DcgThEYz.js";import"./foSuggestion-Ck1952gl.js";import"./productCompletenessV2-Bz422Iqg.js";import"./abcClassification-C5M4RBpy.js";import"./Dropdown-BBd0NFNE.js";import"./DownOutlined-BlEEEBb_.js";import"./useBubbleLock-BgZAw-8N.js";const{Text:ln}=is;function cn({className:t,groups:n=[],items:r,visibleStartMs:o,visibleEndMs:a,height:c=180,emptyMessage:h="Keine Timeline-Daten vorhanden."}){const g=i.useRef(null),[y,x]=i.useState(null),[M,z]=i.useState(null);i.useEffect(()=>{if(typeof window>"u")return;let b=!0;return Fs(()=>import("./vis-timeline-graph2d-DVPA6HI_.js"),[]).then(F=>{b&&x(F)}).catch(F=>{b&&z(F instanceof Error?F.message:"Timeline konnte nicht geladen werden.")}),()=>{b=!1}},[]);const v=i.useMemo(()=>r.map(b=>({id:b.id,type:b.type||(b.endMs!=null?"range":"box"),content:b.content||"",start:b.startMs,end:b.endMs,className:b.className,title:b.title,selectable:!1,editable:!1})),[r]),k=i.useMemo(()=>n.map(b=>({id:b.id,content:b.content,className:b.className})),[n]),q=i.useMemo(()=>{const b=Number.isFinite(o)?o:Date.now(),F=Number.isFinite(a)?a:b+30*24*60*60*1e3,Q=F>b?F:b+30*24*60*60*1e3;return{stack:!0,zoomable:!1,moveable:!1,selectable:!1,showCurrentTime:!0,orientation:{axis:"top",item:"top"},margin:{axis:10,item:8},start:b,end:Q,tooltip:{followMouse:!0,overflowMethod:"cap"}}},[a,o]);return i.useEffect(()=>{if(!y||!g.current||!v.length)return;const b=g.current;b.innerHTML="";const F=k.length?new y.Timeline(b,v,k,q):new y.Timeline(b,v,q);return()=>{F.destroy()}},[k,v,q,y]),r.length?M?e.jsx(oe,{type:"warning",showIcon:!0,message:`Timeline konnte nicht geladen werden: ${M}`}):y?e.jsx("div",{className:["v2-vis-timeline",t||""].filter(Boolean).join(" "),children:e.jsx("div",{ref:g,style:{height:c}})}):e.jsx("div",{className:"v2-vis-timeline-loading",children:e.jsx(ln,{type:"secondary",children:"Timeline wird geladen..."})}):e.jsx(oe,{type:"info",showIcon:!0,message:h})}const pt=24*60*60*1e3,dn={slug:"po",entityLabel:"PO",numberField:"poNo"};function ae(t){return String(t||"").trim().toLowerCase()}function de(t){const n=String(t||"").trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(n))return null;const[r,o,a]=n.split("-").map(Number);if(!r||!o||!a)return null;const c=new Date(Date.UTC(r,o-1,a));return Number.isNaN(c.getTime())?null:n}function Ee(t){if(!t)return null;const[n,r,o]=t.split("-").map(Number);if(!n||!r||!o)return null;const a=new Date(Date.UTC(n,r-1,o));return Number.isNaN(a.getTime())?null:a.getTime()}function Ie(t){if(!t)return"—";const n=Ee(t);return n==null?t:new Date(n).toLocaleDateString("de-DE")}function un(t){return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}):"—"}function hn(t){const n=t.settings&&typeof t.settings=="object"?t.settings:{},r=n.cny&&typeof n.cny=="object"?n.cny:{start:"",end:""},o=n.cnyBlackoutByYear&&typeof n.cnyBlackoutByYear=="object"?n.cnyBlackoutByYear:{};return{fxRate:Number(n.fxRate||0),fxFeePct:Number(n.fxFeePct||0),dutyRatePct:Number(n.dutyRatePct||0),dutyIncludeFreight:n.dutyIncludeFreight!==!1,eustRatePct:Number(n.eustRatePct||0),vatRefundEnabled:n.vatRefundEnabled!==!1,vatRefundLagMonths:Number(n.vatRefundLagMonths||0),freightLagDays:Number(n.freightLagDays||0),cny:r,cnyBlackoutByYear:o}}function mn(t){const n=ae(t.sourceId),r=ae(t.sourceNumber);return(Array.isArray(t.state.pos)?t.state.pos:[]).find(a=>{const c=ae(a.id),h=ae(a.poNo);return!!(n&&n===c||r&&r===h||r&&r===c)})||null}function fn(t){const n=ae(t.sourceId),r=ae(t.sourceNumber);return(Array.isArray(t.state.fos)?t.state.fos:[]).find(a=>{const c=ae(a.id),h=ae(a.foNo),g=ae(a.foNumber);return!!(n&&n===c||r&&(r===h||r===g||r===c))})||null}function cs(t,n,r){return String(t||"").trim().toLowerCase()==="paid"||String(n||"").trim()||String(r||"").trim()?"paid":"open"}function ds(t){const n=String(t.explicitDirection||"").trim().toLowerCase();if(n==="in")return"in";if(n==="out")return"out";const r=`${String(t.eventType||"")} ${String(t.category||"")} ${String(t.label||"")}`.toLowerCase();return r.includes("refund")||r.includes("erstatt")||t.amount<0?"in":"out"}function gn(t,n){const r=Array.isArray(t.payments)?t.payments:[];let o=[];try{const a=typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n));o=$s(a,dn,hn(t),r,{includeIncoming:!0})}catch{o=[]}return o.map(a=>{const c=de(a.dueDate);if(!c)return null;const h=Math.abs(Number(a.plannedEur||0));if(!(h>0))return null;const g=ds({amount:Number(a.plannedEur||0),eventType:a.eventType,label:a.label||a.typeLabel,explicitDirection:a.direction});return{id:String(a.id||`po-pay-${c}`),label:String(a.typeLabel||a.label||"Zahlung"),dueDate:c,amountEur:h,status:cs(a.status,a.paidDate,a.paymentId),direction:g}}).filter(a=>!!a)}function bn(t){const n=Number(t.fxRate||0);return(Array.isArray(t.payments)?t.payments:[]).map((o,a)=>{const c=de(o.dueDate);if(!c)return null;const h=Number(o.amount||0);if(!Number.isFinite(h)||h===0)return null;const g=ds({amount:h,category:o.category,label:o.label}),y=Math.abs(qs(h,o.currency||"EUR",n));return y>0?{id:String(o.id||`fo-pay-${a+1}`),label:String(o.label||o.category||"Zahlung"),dueDate:c,amountEur:y,status:cs(o.status,o.paidDate,o.paymentId),direction:g}:null}).filter(o=>!!o)}function Xt(t){const n=[],r=Ee(t.orderDate),o=Ee(t.etdDate),a=Ee(t.etaDate);r!=null&&o!=null&&o>=r&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:production`,type:"range",content:"Produktion",startMs:r,endMs:o,className:"v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--production",title:`Produktion: ${Ie(t.orderDate)} bis ${Ie(t.etdDate)}`}),o!=null&&a!=null&&a>=o&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:transit`,type:"range",content:"Transit",startMs:o,endMs:a,className:"v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--transit",title:`Transit: ${Ie(t.etdDate)} bis ${Ie(t.etaDate)}`}),[{key:"order",label:"Order",date:t.orderDate},{key:"etd",label:"ETD",date:t.etdDate},{key:"eta",label:"ETA",date:t.etaDate}].forEach(v=>{const k=Ee(v.date);k!=null&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:milestone:${v.key}`,type:"box",content:v.label,startMs:k,className:`v2-dashboard-order-timeline-item v2-dashboard-order-timeline-item--milestone v2-dashboard-order-timeline-item--milestone-${v.key}`,title:`${v.label}: ${Ie(v.date)}`})}),t.payments.forEach(v=>{const k=Ee(v.dueDate);k!=null&&n.push({id:`${t.source}:${t.sourceId||t.sourceNumber||"order"}:payment:${v.id}`,type:"box",content:v.direction==="in"?"+":" ",startMs:k,className:["v2-dashboard-order-timeline-item","v2-dashboard-order-timeline-item--payment",v.status==="paid"?"v2-dashboard-order-timeline-item--payment-paid":"v2-dashboard-order-timeline-item--payment-open",v.direction==="in"?"v2-dashboard-order-timeline-item--payment-incoming":"v2-dashboard-order-timeline-item--payment-outgoing"].join(" "),title:[v.label,`Fällig: ${Ie(v.dueDate)}`,`Betrag: ${un(v.amountEur)}`,`Status: ${v.status==="paid"?"Bezahlt":"Offen"}`].join(`
`)})});const h=n.flatMap(v=>[v.startMs,v.endMs].filter(k=>Number.isFinite(k)));if(!h.length)return null;const g=Math.min(...h),y=Math.max(...h),x=g-14*pt,M=y+14*pt,z=M>x?M:x+30*pt;return{source:t.source,sourceId:t.sourceId,sourceNumber:t.sourceNumber,orderDate:t.orderDate,etdDate:t.etdDate,etaDate:t.etaDate,visibleStartMs:x,visibleEndMs:z,items:n}}function pn(t){const n=t.source==="fo"?"fo":"po",r=t.sourceId?String(t.sourceId):null,o=t.sourceNumber?String(t.sourceNumber):null;if(n==="po"){const h=mn({state:t.state,sourceId:r,sourceNumber:o});if(!h)return null;const g=t.state.settings&&typeof t.state.settings=="object"?t.state.settings:{},y=_s({items:h.items,orderDate:h.orderDate,fxRate:h.fxOverride??g.fxRate,fallback:h}),x=Us({orderDate:h.orderDate,productionLeadTimeDays:y.prodDays||h.prodDays,logisticsLeadTimeDays:y.transitDays||h.transitDays,bufferDays:0});return Xt({source:"po",sourceId:String(h.id||r||""),sourceNumber:String(h.poNo||o||""),orderDate:de(h.orderDate||x.orderDate),etdDate:de(h.etdManual||x.etdDate),etaDate:de(h.etaManual||x.etaDate),payments:gn(t.state,h)})}const a=fn({state:t.state,sourceId:r,sourceNumber:o});if(!a)return null;const c=Vs({targetDeliveryDate:a.targetDeliveryDate||a.deliveryDate,productionLeadTimeDays:a.productionLeadTimeDays,logisticsLeadTimeDays:a.logisticsLeadTimeDays,bufferDays:a.bufferDays});return Xt({source:"fo",sourceId:String(a.id||r||""),sourceNumber:String(a.foNo||a.foNumber||o||""),orderDate:de(a.orderDate||c.orderDate),etdDate:de(a.etdDate||c.etdDate),etaDate:de(a.etaDate||c.etaDate||a.targetDeliveryDate||a.deliveryDate),payments:bn(a)})}function tt(t){if(!t)return null;const n=new Date(String(t));return Number.isNaN(n.getTime())?null:n}function vn(t){if(!Ps(t.includeInForecast,!0))return!1;if(typeof t.active=="boolean")return t.active;const n=String(t.status||"").trim().toLowerCase();return n?n==="active"||n==="aktiv"||n==="prelaunch"||n==="not_launched"||n==="planned":!0}function jt(t){return String(t||"").trim()}function yn(t){return(Array.isArray(t.products)?t.products:[]).filter(r=>jt(r.sku)?vn(r):!1).map(r=>({sku:jt(r.sku),alias:String(r.alias||r.sku||""),status:String(r.status||"active"),safetyStockDohOverride:r.safetyStockDohOverride,foCoverageDohOverride:r.foCoverageDohOverride}))}function xn(t){const n=t.lastDriftSummary&&typeof t.lastDriftSummary=="object"?t.lastDriftSummary:{},r=typeof n.comparedAt=="string"?n.comparedAt:null;return r&&tt(r)?r:null}function jn(t){return{id:`gate:${t.key}`,key:t.key,severity:"error",label:t.label,message:t.detail,route:t.route}}function kn(t){const n=t.state||{},r=Number.isFinite(t.horizonMonths)?Math.max(1,Math.round(Number(t.horizonMonths))):12,o=Js(nt(),r),a=ls({state:n,months:o}),c=a.robustMonthsCount>=o.length&&o.length>0,h=yn(n),g=Ys({state:n,months:o,products:h,snapshot:null,snapshotMonth:Xs(nt(),-1),projectionMode:"units"}),y=Array.isArray(g.anchorSkuMissingHistory)?g.anchorSkuMissingHistory.map(W=>jt(W)).filter(Boolean).sort((W,rt)=>W.localeCompare(rt,"de-DE")):[],x=y.length===0,M=n.forecast&&typeof n.forecast=="object"?n.forecast:{},z=typeof M.lastImportAt=="string"?M.lastImportAt:null,v=tt(z),k=new Date,q=24*60*60*1e3,b=v?Math.floor((k.getTime()-v.getTime())/q):null,F=b!=null&&b<=35,Q=xn(M),ye=typeof M.lastDriftReviewedComparedAt=="string"?M.lastDriftReviewedComparedAt:null,Fe=typeof M.lastDriftReviewedAt=="string"?M.lastDriftReviewedAt:null,xe=!!(Q&&ye&&en(String(Q).slice(0,7))&&ye===Q&&tt(Fe)),he=t.runtimeErrorAt&&tt(t.runtimeErrorAt)?String(t.runtimeErrorAt):null,ie=!he,ee=[{key:"runtime_stable",label:"Runtime stabil",passed:ie,status:ie?"ok":"error",detail:ie?"Keine offenen Tab-Ladefehler.":`Offener Tab-Ladefehler seit ${new Date(he).toLocaleString("de-DE")}${t.runtimeErrorRoute?` (${t.runtimeErrorRoute})`:""}.`,route:"/v2/dashboard",blockerCount:ie?0:1},{key:"robust_12m",label:"Robustheit 12M",passed:c,status:c?"ok":"error",detail:c?`${a.robustMonthsCount}/${o.length} Monate robust.`:`${a.robustMonthsCount}/${o.length} Monate robust (erforderlich: ${o.length}).`,route:"/v2/dashboard",blockerCount:c?0:Math.max(0,o.length-a.robustMonthsCount)},{key:"anchor_history_complete",label:"Anchor-Historie vollständig",passed:x,status:x?"ok":"error",detail:x?"Alle aktiven/prelaunch SKUs haben Snapshot-Historie.":`${y.length} SKU(s) ohne Snapshot-Historie (Anker=0).`,route:"/v2/inventory/projektion?source=dashboard&risk=under_safety&abc=ab&expand=all",blockerCount:y.length},{key:"forecast_fresh",label:"Forecast aktuell",passed:F,status:F?"ok":"error",detail:F?`${b} Tage seit Import.`:b==null?"Kein Forecast-Import vorhanden.":`${b} Tage seit Import (erlaubt <= 35).`,route:"/v2/forecast",blockerCount:F?0:1},{key:"forecast_drift_reviewed",label:"Drift geprüft",passed:xe,status:xe?"ok":"error",detail:xe?`Drift-Stand vom ${new Date(Q).toLocaleDateString("de-DE")} geprüft.`:Q?"Aktueller Drift-Stand ist noch nicht als geprüft markiert.":"Noch kein Driftvergleich verfügbar.",route:"/v2/forecast",blockerCount:xe?0:1}],je=ee.filter(W=>!W.passed).map(W=>jn(W)),Te=je.length===0;return{ready:Te,status:Te?"ready":"not_ready",horizonMonths:r,checks:ee,blockers:je,robustMonthsCount:a.robustMonthsCount,robustRequiredCount:o.length,anchorMissingHistoryCount:y.length,anchorMissingHistorySkus:y,forecastDaysSinceImport:b,driftComparedAt:Q,driftReviewedAt:Fe,driftReviewedForComparedAt:ye}}const{Paragraph:vt,Text:f,Title:Ye}=is,{CheckableTag:Sn}=d,Mn="v2:last-route-error",yt=[{value:"next6",label:"Nächste 6 Monate",count:6},{value:"next12",label:"Nächste 12 Monate",count:12},{value:"next18",label:"Nächste 18 Monate",count:18},{value:"all",label:"Alle Monate",count:null}],Nn=[{key:"inflow",label:"Einzahlungen"},{key:"po_fo",label:"PO/FO Zahlungen"},{key:"fixcost",label:"Fixkosten"},{key:"tax",label:"Steuern & Importkosten"},{key:"outflow",label:"Sonstige Auszahlungen"},{key:"other",label:"Sonstige"}],Dn=new Set(["signals","cashflow","robustness","pnl"]),Cn=["cashflow"],us=[{value:_.CORE,label:"Kernportfolio"},{value:_.PLAN,label:"Planprodukte"},{value:_.IDEAS,label:"Ideenprodukte"}],es=[_.CORE,_.PLAN],ts={full:{label:"Vollständig",color:"green",className:"is-full"},wide:{label:"Weitgehend",color:"lime",className:"is-wide"},partial:{label:"Teilweise",color:"orange",className:"is-partial"},insufficient:{label:"Unzureichend",color:"red",className:"is-insufficient"}};function ss(t){const n=new Set;return t.forEach(r=>{const o=String(r||"").trim();Dn.has(o)&&n.add(o)}),Array.from(n)}function wn(t){return Array.isArray(t)?t:t?[t]:[]}function T(t){const n=Number(t);return Number.isFinite(n)?n.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"-"}function ve(t){return Number.isFinite(t)?t<0?`−${T(Math.abs(t))}`:T(t):"-"}function ns(t,n=0){const r=Number(t);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:n,maximumFractionDigits:n}):"-"}function Je(t){const n=Number(t);return Number.isFinite(n)?`${n.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})} %`:"-"}function Xe(t){if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("de-DE")}function st(t){return ts[t]||ts.insufficient}function In(t){const n=st(t);return e.jsx(d,{color:n.color,children:n.label})}function An(t){return t==="ok"?"✅":t==="warn"?"⚠️":"❌"}function Ae(t){return t.reduce((n,r)=>n+Number(r.amount||0),0)}function En(t,n){const r=new Date(t.getTime());return r.setDate(r.getDate()+n),r}function zn(t){const n=us.find(r=>r.value===t);return(n==null?void 0:n.label)||t}function rs(t){const n=Array.from(new Set((Array.isArray(t)?t:[]).map(o=>String(o||"")).filter(o=>ze.includes(o)))),r=n.slice().sort().join("|");return r===[_.CORE].join("|")?"Nur Kern":r===[_.CORE,_.PLAN].sort().join("|")?"Kern+Plan":n.length===ze.length?"Alles":n.map(o=>zn(o)).join(", ")}function Fn(t,n){const r=structuredClone(t||{});(!r.settings||typeof r.settings!="object")&&(r.settings={});const o=r.settings;return o.cashInMode=n.safetyMode==="basis"?"basis":"conservative",o.cashInCalibrationEnabled=n.revenueBasisMode==="calibrated",o.cashInRecommendationIgnoreQ4=!n.q4SeasonalityEnabled,n.quoteMode==="recommendation"&&Array.isArray(r.incomings)&&(r.incomings=r.incomings.map(a=>!a||typeof a!="object"?a:{...a,payoutPct:null})),r}function et(t,n){return e.jsxs("span",{className:"v2-dashboard-signal-title",children:[t,e.jsx(L,{title:n,children:e.jsx(X,{})})]})}function ue(t,n){const[r,o=""]=String(t||"").split("?"),a=new URLSearchParams(o);Object.entries(n).forEach(([h,g])=>{if(g==null||g===""){a.delete(h);return}a.set(h,g)});const c=a.toString();return c?`${r}?${c}`:r}function kt(t){return ue("/v2/inventory/projektion",{source:"dashboard",risk:t.risk||"under_safety",abc:t.abc||"ab",month:t.month||null,sku:t.sku||null,mode:t.mode||null,expand:"all"})}function Pn(t){return ue("/v2/products",{source:"dashboard",issues:t.issues,sku:t.sku||null,expand:"all"})}function hs(t){return ue("/v2/forecast",{source:"dashboard",sku:t.sku||null,month:t.month||null})}function os(t){return ue("/v2/orders/fo",{source:t.source||"inventory_projection",sku:t.sku||null,month:t.month||null,suggestedUnits:Number.isFinite(Number(t.suggestedUnits))?String(Math.max(0,Math.round(Number(t.suggestedUnits)))):"0",requiredArrivalDate:t.requiredArrivalDate||null,recommendedOrderDate:t.recommendedOrderDate||null,phantomId:t.phantomId||null,firstRiskMonth:t.firstRiskMonth||null,orderMonth:t.orderMonth||null,leadTimeDays:Number.isFinite(Number(t.leadTimeDays))?String(Math.max(0,Math.round(Number(t.leadTimeDays)))):null,returnTo:t.returnTo||"/v2/dashboard"})}function xt(t){const n=String(t.route||"");if(n.startsWith("/v2/forecast"))return hs({sku:t.sku||null,month:t.month||null});if(n.startsWith("/v2/inventory/projektion")){const r=t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"under_safety":"all",o=t.sku?"all":t.actionId==="inventory_safety"||t.checkKey==="sku_coverage"?"ab":"all";return kt({risk:r,abc:o,month:t.month||null,sku:t.sku||null,mode:t.mode||null})}if(n.startsWith("/v2/products")){const r=t.actionId==="revenue_inputs"||t.checkKey==="revenue_inputs"?"revenue":"needs_fix";return Pn({issues:r,sku:t.sku||null})}return n}function On(t){const n=typeof t.portfolioBucket=="string"?t.portfolioBucket:null;if(n)return n;const r=t.meta&&typeof t.meta=="object"?t.meta:{};return typeof r.portfolioBucket=="string"?String(r.portfolioBucket):null}function St(t,n){const r=On(t);return!r||!ze.includes(r)?!0:n.has(r)}function Bn(t,n){var a;if(!t.length)return[];const r=Number(((a=t[0])==null?void 0:a.opening)||0);let o=r;return t.map((c,h)=>{const g=h===0?r:o,y=(Array.isArray(c.entries)?c.entries:[]).filter(k=>St(k,n)),x=y.filter(k=>String(k.direction||"").toLowerCase()==="in").reduce((k,q)=>k+Math.abs(Number(q.amount||0)),0),M=y.filter(k=>String(k.direction||"").toLowerCase()==="out").reduce((k,q)=>k+Math.abs(Number(q.amount||0)),0),z=x-M,v=g+z;return o=v,{...c,opening:g,inflow:x,outflow:M,net:z,closing:v,entries:y}})}function Rn(t){const n=t.map(r=>(Array.isArray(r.entries)?r.entries:[]).filter(c=>String(c.direction||"").toLowerCase()==="out"&&String(c.group||"")==="Fixkosten").reduce((c,h)=>c+Math.abs(Number(h.amount||0)),0)).filter(r=>r>0);return n.length?n.reduce((r,o)=>r+o,0)/n.length:0}function Tn(t,n,r){const o={fixcost:0,po:0,fo:0,phantomFo:0};return t.forEach(a=>{if(!a||typeof a!="object")return;const c=a;if(r&&!St(c,r)||String(c.direction||"").toLowerCase()!=="out")return;const h=Math.abs(Number(c.amount||0));if(!Number.isFinite(h)||h<=0)return;const g=String(c.source||"").toLowerCase();if(g==="po"){o.po+=h;return}if(g==="fo"){const x=String(c.sourceId||"").trim(),M=c.meta&&typeof c.meta=="object"?c.meta:{};c.provisional===!0||M.phantom===!0||(x?(n==null?void 0:n.has(x))===!0:!1)?o.phantomFo+=h:o.fo+=h;return}const y=String(c.group||"").toLowerCase();(g==="fixcosts"||y==="fixkosten")&&(o.fixcost+=h)}),o}function Ln(t,n){const r={amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0};return t.forEach(o=>{if(!o||typeof o!="object")return;const a=o;if(n&&!St(a,n)||String(a.direction||"").toLowerCase()!=="in")return;const c=Math.abs(Number(a.amount||0));if(!Number.isFinite(c)||c<=0)return;const h=String(a.source||"").toLowerCase(),g=String(a.kind||"").toLowerCase();if(h==="sales"||h==="sales-plan"||g==="sales-payout"){r.amazon+=c;const x=a.meta&&typeof a.meta=="object"?a.meta:{},M=x.cashIn&&typeof x.cashIn=="object"?x.cashIn:{},z=String(M.component||"").trim().toLowerCase(),v=String(a.portfolioBucket||x.portfolioBucket||"").trim(),k=Rs(v,_.CORE);h==="sales-plan"||z==="plan"?r.amazonNew+=c:k===_.CORE?r.amazonCore+=c:r.amazonPlanned+=c}else r.other+=c;r.total+=c}),r}function Kn(t){if(t.source!=="sales")return[];const n=t.cashInMeta;if(!n)return[];const r=[];if(n.component==="plan"&&r.push(e.jsx(d,{color:"geekblue",children:"Plan-Produkt"},"component")),n.quoteSource==="manual"?r.push(e.jsx(d,{color:"gold",children:"Quote manuell"},"quote-source")):n.quoteSource==="recommendation"&&r.push(e.jsx(d,{color:"blue",children:"Quote Empfehlung"},"quote-source")),n.revenueSource==="manual_override")r.push(e.jsx(d,{color:"gold",children:"Umsatz manuell"},"revenue-source"));else if(n.revenueSource==="forecast_calibrated"){const o=Number(n.calibrationFactorApplied);Number.isFinite(o)&&Math.abs(o-1)>1e-6?r.push(e.jsxs(d,{color:"orange",children:["Kalibriert ",o.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})]},"revenue-source")):r.push(e.jsx(d,{children:"Forecast"},"revenue-source"))}else n.revenueSource==="manual_no_forecast"&&r.push(e.jsx(d,{children:"Manuell (kein Forecast)"},"revenue-source"));return r}function $n(t,n){var r;for(let o=0;o<t.length;o+=1){const a=t[o].month;if((r=n.get(a))!=null&&r.robust&&Number(t[o].closing||0)<0)return a}return null}function _n(t){if(!t||typeof t!="object")return{toVersionId:null,foConflictsOpen:0};const n=t;return{toVersionId:n.toVersionId==null?null:String(n.toVersionId||"").trim()||null,foConflictsOpen:Math.max(0,Math.round(Number(n.foConflictsOpen||0)))}}function as(){if(typeof window>"u"||!window.sessionStorage)return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null};try{const t=window.sessionStorage.getItem(Mn);if(!t)return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null};const n=JSON.parse(t);return{errorAt:typeof n.errorAt=="string"?n.errorAt:null,routeKey:typeof n.routeKey=="string"?n.routeKey:null,routePath:typeof n.routePath=="string"?n.routePath:null,routeLabel:typeof n.routeLabel=="string"?n.routeLabel:null,message:typeof n.message=="string"?n.message:null}}catch{return{errorAt:null,routeKey:null,routePath:null,routeLabel:null,message:null}}}function Cr(){var Qt,Zt;const{state:t,loading:n,error:r}=tn(),o=Os(),a=sn("dashboard"),[c,h]=i.useState("next6"),[g,y]=i.useState(()=>es.slice()),[x,M]=i.useState("forecast"),[z,v]=i.useState("manual"),[k,q]=i.useState("basis"),[b,F]=i.useState(!0),[Q,ye]=i.useState(!1),[Fe,xe]=i.useState(!1),[he,ie]=i.useState(""),[ee,je]=i.useState(""),[Te,W]=i.useState([]),[rt,Mt]=i.useState(!1),[Le,ms]=i.useState(()=>as()),[ke,fs]=i.useState(()=>{const s=nn("dashboard");return a?ss(s):Cn.slice()}),te=t,ot=t.settings&&typeof t.settings=="object"?t.settings:{},Ke=t.forecast&&typeof t.forecast=="object"?t.forecast:{},at=ot.cashInCalibrationEnabled!==!1,gs=Math.max(1,Math.round(Number(ot.cashInCalibrationHorizonMonths||6))),Nt=ot.cashInRecommendationIgnoreQ4===!0;i.useEffect(()=>{Fe||(M(at?"calibrated":"forecast"),F(!Nt),xe(!0))},[Fe,at,Nt]);const U=i.useMemo(()=>Gs(te,18),[t.settings]),me=i.useMemo(()=>he&&U.includes(he)?he:U[U.length-1]||"",[he,U]),le=i.useMemo(()=>Hs({state:te,months:U,targetMonth:me||null}),[U,me,te]),Dt=i.useMemo(()=>new Map(le.map(s=>[s.id,s])),[le]),fe=i.useMemo(()=>new Set(le.map(s=>s.id)),[le]),Ct=i.useMemo(()=>Ws({state:te,suggestions:le}),[le,te]),Se=i.useMemo(()=>Fn(Ct,{quoteMode:z,safetyMode:k,revenueBasisMode:x,q4SeasonalityEnabled:b}),[Ct,b,z,x,k]),wt=i.useMemo(()=>Ls(Se),[Se]),it=wt.months||[],It=wt.breakdown||[],G=i.useMemo(()=>{const s=yt.find(l=>l.value===c);return!s||s.count==null?it:it.slice(0,s.count)},[it,c]),bs=i.useMemo(()=>{const s=yt.find(l=>l.value===c);return(s==null?void 0:s.label)||"Alle Monate"},[c]),At=i.useMemo(()=>new Set(G),[G]),Me=i.useMemo(()=>new Set(g),[g]),Z=i.useMemo(()=>{const s=It.filter(l=>At.has(l.month));return Bn(s,Me)},[It,Me,At]),A=i.useMemo(()=>ls({state:te,months:G}),[te,G]),se=i.useMemo(()=>kn({state:te,horizonMonths:12,runtimeErrorAt:Le.errorAt,runtimeErrorRoute:Le.routePath}),[Le.errorAt,Le.routePath,te]);i.useEffect(()=>{if(!U.length){ie("");return}ie(s=>s&&U.includes(s)?s:U[U.length-1])},[U]),i.useEffect(()=>{var s;if(!A.months.length){je("");return}if(!ee||!A.monthMap.has(ee)){const l=((s=A.months.find(j=>!j.robust))==null?void 0:s.month)||A.months[0].month;je(l)}},[A,ee]),i.useEffect(()=>{if(!Z.length){W([]);return}W(s=>{const l=new Set(Z.map(j=>j.month));return s.filter(j=>l.has(j))})},[Z]),i.useEffect(()=>{rn("dashboard",ke)},[ke]);const $e=s=>{fs(ss(wn(s)))},Pe=i.useCallback(s=>{s&&(je(s),Mt(!0))},[]),I=i.useMemo(()=>Z.map(s=>({...s})),[Z]),_e=i.useMemo(()=>{const s=new Map;return I.forEach(l=>{s.set(l.month,Ln(Array.isArray(l.entries)?l.entries:[],Me))}),s},[Me,I]),Y=i.useMemo(()=>I.map(s=>_e.get(s.month)||{amazon:0,amazonCore:0,amazonPlanned:0,amazonNew:0,other:0,total:0}),[_e,I]),Et=i.useMemo(()=>Y.map(s=>s.amazonCore),[Y]),zt=i.useMemo(()=>Y.map(s=>s.amazonPlanned),[Y]),Ft=i.useMemo(()=>Y.map(s=>s.amazonNew),[Y]),ps=i.useMemo(()=>Y.map(s=>s.amazon),[Y]),lt=i.useMemo(()=>Y.map(s=>s.other),[Y]),vs=ps.reduce((s,l)=>s+Number(l||0),0)+lt.reduce((s,l)=>s+Number(l||0),0),ys=I.reduce((s,l)=>s+Number(l.outflow||0),0),ct=I.reduce((s,l)=>s+Number(l.net||0),0),xs=i.useMemo(()=>I.length?Math.min(...I.map(s=>Number(s.closing||0))):null,[I]),Pt=i.useMemo(()=>rs(g),[g]),Ot=x==="calibrated"?"Kalibrierter Umsatz":"Forecast-Umsatz",Bt=z==="manual"?"Manuell je Monat":"Empfehlung",Rt=k==="basis"?"Basis":"Konservativ",Tt=b?"berücksichtigt":"ignoriert",dt=z==="recommendation",Ue=i.useMemo(()=>Rn(Z),[Z])*2,ut=i.useMemo(()=>I.filter(s=>{var l;return(l=A.monthMap.get(s.month))==null?void 0:l.robust}).map(s=>Number(s.closing||0)),[A.monthMap,I]),Lt=i.useMemo(()=>!ut.length||Ue<=0?null:Math.min(...ut)-Ue,[Ue,ut]),Kt=i.useMemo(()=>$n(I,A.monthMap),[A.monthMap,I]),Ve=i.useMemo(()=>{const s=structuredClone(Ke||{});return Qs(s),s},[Ke]),js=i.useMemo(()=>Zs(Ve),[Ve]),ht=_n(Ve.lastImpactSummary),$t=String(Ve.activeVersionId||"").trim()||null,qe=ht.toVersionId&&$t&&ht.toVersionId===$t?ht.foConflictsOpen:0,mt=typeof Ke.lastImportAt=="string"?Ke.lastImportAt:null,Ne=mt?new Date(mt):null,ks=new Date,Ss=24*60*60*1e3,Oe=Ne?Math.floor((ks.getTime()-Ne.getTime())/Ss):null,De=Ne?Oe!=null&&Oe<=35?"fresh":Oe!=null&&Oe<=45?"aging":"stale":"none",Ms=Ne?`${Oe} Tage seit Import`:"Kein Forecast-Import",_t=Ne?En(Ne,30):null,u=ee&&A.monthMap.get(ee)||null,ft=u?st(u.coverage.statusKey):null,Ge=i.useMemo(()=>{if(!u)return!1;const s=Qe(nt()),l=Qe(u.month);return l==null||s==null?!1:l<s},[u]),He=u?u.checks.filter(s=>s.key!=="sku_coverage"):[],Ut=i.useMemo(()=>{if(!u||u.coverage.statusKey==="full")return[];const s=u.month;return[{id:`coverage-warning:${s}`,message:`Coverage ist ${u.coverage.statusLabel}: ${Je(u.coverage.ratio*100)} (${u.coverage.coveredSkus}/${u.coverage.activeSkus}).`,route:kt({risk:"under_safety",abc:"ab",month:s,mode:u.coverage.projectionMode})}]},[u]),Vt=u?u.blockers.filter(s=>s.checkKey!=="sku_coverage"):[],Ns=i.useMemo(()=>{if(!u)return[];const s=u.coverage.projectionMode==="doh"?"DOH":"Units",l=u.coverage.stockIssueCount,j=u.coverage.orderDutyIssueCount,w=[{key:"stock",label:"Bestands-Check ok?",passed:l===0,description:l===0?`Alle aktiven SKUs im Monat ${V(u.month)} über Safety (${s}).`:`${l} SKU(s) mit OOS/unter Safety oder fehlendem Forecast.`},{key:"order_duty",label:"Bestellpflicht/Look-Ahead ok?",passed:j===0,description:j===0?"Keine SKU benötigt spätestens in diesem Monat eine neue FO/PO.":`${j} SKU(s) mit fälliger Bestellpflicht (inkl. Look-Ahead).`}],H=He.map(C=>({key:C.key,label:`${C.label} ok?`,passed:C.passed,description:C.detail}));return[...w,...H]},[u,He]),Ds=i.useMemo(()=>{if(!u)return[];const s=[],l=u.coverage.stockIssueCount,j=u.coverage.orderDutyIssueCount;return s.push({key:"stock_lookahead",label:"Bestand robust (mit Lookahead)",state:l===0?"ok":"fail",description:l===0?"Alle aktiven SKUs bleiben im Lookahead-Fenster über Safety.":`${l} aktive SKU(s) unterschreiten Safety im Lookahead-Fenster.`,route:"/v2/inventory/projektion"}),s.push({key:"order_duty",label:"Bestellpflicht rechtzeitig",state:j===0?"ok":u.coverage.overdueOrderDutySkuCount>0?"fail":"warn",description:j===0?"Keine fällige Bestellpflicht für PO/FO im Monat.":`${j} SKU(s) mit fälliger Bestellpflicht.`,route:"/v2/orders/fo"}),He.forEach(w=>{s.push({key:w.key,label:w.label,state:w.passed?"ok":"fail",description:w.detail,route:w.route||null})}),Ge&&s.push({key:"past-info",label:"Vergangen (Info)",state:"warn",description:"Vergangener Monat: Status dient zur Einordnung, nicht als offene To-Do-Pflicht.",route:null}),s},[u,Ge,He]),Cs=nt(),qt=Qe(Cs),Gt=i.useMemo(()=>{const s=new Map;return G.forEach(l=>{s.set(V(l),l)}),s},[G]),Ht=i.useCallback(s=>{if(!s||typeof s!="object")return;const l=s;let j=null;const w=Number(l.dataIndex);if(Number.isInteger(w)&&w>=0&&w<G.length&&(j=G[w]),!j){const H=[l.name,l.axisValue,l.value].map(C=>typeof C=="string"?C.trim():"").filter(Boolean);for(let C=0;C<H.length;C+=1){const K=Gt.get(H[C]);if(K){j=K;break}}}j&&Pe(j)},[Gt,Pe,G]),ws=i.useMemo(()=>({click:Ht}),[Ht]);i.useEffect(()=>{const s=()=>ms(as());return s(),window.addEventListener("v2:route-load-state",s),window.addEventListener("storage",s),()=>{window.removeEventListener("v2:route-load-state",s),window.removeEventListener("storage",s)}},[]);const Wt=i.useMemo(()=>Ks({breakdown:I,state:Se,provisionalFoIds:fe}),[Se,fe,I]),Is=i.useMemo(()=>{const s="Amazon: Kernprodukte",l="Amazon: Geplante Produkte",j="Amazon: Neue Produkte",w=new Set([s,l,j]),H=G.map(m=>V(m)),C=Z.map(m=>Number(m.closing||0)),K=Z.map(m=>{var P;return!!((P=A.monthMap.get(m.month))!=null&&P.robust)}),We=C.map((m,P)=>K[P]&&m>=0?m:null),N=C.map((m,P)=>K[P]&&m<0?m:null),E=C.map((m,P)=>!K[P]&&m>=0?m:null),Be=C.map((m,P)=>!K[P]&&m<0?m:null),B=I.map(m=>Tn(Array.isArray(m.entries)?m.entries:[],fe,Me)),D=B.map(m=>-m.fixcost),ne=B.map(m=>-m.po),ce=B.map(m=>-m.fo),ge=B.map(m=>-m.phantomFo);return{tooltip:{trigger:"axis",formatter:m=>{const P=Array.isArray(m)?m:[m],J=P[0],be=[`<div><strong>${(J==null?void 0:J.axisValueLabel)||""}</strong></div>`];let pe=0,Re=!1;return P.forEach(p=>{const R=p,Ce=Number(R==null?void 0:R.value);Number.isFinite(Ce)&&(w.has(String((R==null?void 0:R.seriesName)||""))&&(pe+=Ce,Re=!0),be.push(`<div>${(R==null?void 0:R.marker)||""}${(R==null?void 0:R.seriesName)||""}: ${T(Ce)}</div>`))}),Re&&be.push(`<div><strong>Amazon gesamt: ${T(pe)}</strong></div>`),be.join("")}},legend:[{top:0,left:0,itemGap:12,data:[s,l,j,"Sonstige Einzahlungen","Fixkosten","PO","FO","Phantom FO","Netto"]},{top:26,left:0,itemGap:12,data:["Kontostand belastbar","Kontostand belastbar (<0)","Kontostand orientierend","Kontostand orientierend (<0)"]}],grid:{left:56,right:70,top:78,bottom:32},xAxis:{type:"category",data:H,triggerEvent:!0},yAxis:[{type:"value",name:"Cashflow",axisLabel:{formatter:m=>ve(m)}},{type:"value",name:"Kontostand",position:"right",axisLabel:{formatter:m=>T(m)}}],series:[{name:s,type:"bar",stack:"cash",data:Et,itemStyle:{color:"#166534"}},{name:l,type:"bar",stack:"cash",data:zt,itemStyle:{color:"#22c55e"}},{name:j,type:"bar",stack:"cash",data:Ft,itemStyle:{color:"#86efac"}},{name:"Sonstige Einzahlungen",type:"bar",stack:"cash",data:lt,itemStyle:{color:"#6ee7b7"}},{name:"Fixkosten",type:"bar",stack:"cash",data:D,itemStyle:{color:"#7f1d1d"}},{name:"PO",type:"bar",stack:"cash",data:ne,itemStyle:{color:"#e74c3c"}},{name:"FO",type:"bar",stack:"cash",data:ce,itemStyle:{color:"#f97316"}},{name:"Phantom FO",type:"bar",stack:"cash",data:ge,itemStyle:{color:"#fbbf24"}},{name:"Netto",type:"line",smooth:!0,data:I.map(m=>Number(m.net||0)),itemStyle:{color:"#0f1b2d"},lineStyle:{width:2}},{name:"Kontostand belastbar",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:We,lineStyle:{width:2,color:"#3bc2a7"},itemStyle:{color:"#3bc2a7"}},{name:"Kontostand belastbar (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:N,lineStyle:{width:2,color:"#b42318"},itemStyle:{color:"#b42318"}},{name:"Kontostand orientierend",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:E,lineStyle:{width:2,type:"dashed",color:"#94a3b8"},itemStyle:{color:"#94a3b8"}},{name:"Kontostand orientierend (<0)",type:"line",smooth:!0,yAxisIndex:1,connectNulls:!1,data:Be,lineStyle:{width:2,type:"dashed",color:"#c2410c"},itemStyle:{color:"#c2410c"}}]}},[Et,Ft,zt,Me,lt,fe,A.monthMap,I,Z,G]),As=i.useMemo(()=>I.map(s=>{var We;const l=Wt.get(s.month)||[],j=l.filter(N=>N.provisional),w=Nn.map(N=>({...N,rows:l.filter(E=>E.group===N.key)})).filter(N=>N.rows.length>0),H=l.filter(N=>N.amount<0),C=_e.get(s.month)||{amazon:0,other:0,total:0},K=((We=A.monthMap.get(s.month))==null?void 0:We.robust)||!1;return{key:s.month,label:e.jsxs("div",{className:"v2-dashboard-pnl-header",children:[e.jsxs(S,{size:6,align:"center",children:[e.jsx(f,{strong:!0,children:V(s.month)}),e.jsx(O,{type:"text",size:"small",icon:e.jsx(X,{}),onClick:N=>{N.stopPropagation(),Pe(s.month)},children:"Details"})]}),e.jsxs(S,{wrap:!0,children:[e.jsxs(d,{color:"green",children:["Einzahlungen: ",T(C.total)]}),e.jsxs(d,{color:"green",children:["Amazon: ",T(C.amazon)]}),e.jsxs(d,{color:"lime",children:["Sonstige: ",T(C.other)]}),e.jsxs(d,{color:"red",children:["Auszahlungen: ",T(Math.abs(Ae(H)))]}),j.length?e.jsxs(d,{color:"gold",children:["Vorbehaltlich (enthalten): ",ve(Ae(j))]}):null,e.jsxs(d,{color:s.net>=0?"green":"red",children:["Netto: ",T(s.net)]}),e.jsxs(d,{color:K?"green":"red",children:["Robust: ",K?"ja":"nein"]})]})]}),children:e.jsx("div",{className:"v2-dashboard-pnl-month",children:w.map(N=>{if(N.key==="po_fo"){const E=new Map;N.rows.forEach(B=>{const D=B.source==="fo"?"fo":"po",ne=B.sourceId?String(B.sourceId):null,ce=B.sourceNumber?String(B.sourceNumber):null,ge=`${D}:${ne||ce||B.label}`,re=E.get(ge);if(re){re.rows.push(B),!re.sourceId&&ne&&(re.sourceId=ne),!re.sourceNumber&&ce&&(re.sourceNumber=ce);return}E.set(ge,{source:D,sourceId:ne,sourceNumber:ce,rows:[B]})});const Be=Array.from(E.entries()).map(([B,D])=>{var Re;const ne=Ae(D.rows),ce=Array.from(new Set(D.rows.map(p=>p.portfolioBucket).filter(p=>!!p))),ge=D.rows.filter(p=>p.provisional),re=ge.map(p=>String(p.sourceId||"").trim()).find(p=>p&&fe.has(p))||null,gt=D.source==="fo"?D.sourceId&&fe.has(D.sourceId)?D.sourceId:re:null,m=gt&&Dt.get(gt)||null,P=(Re=D.rows.find(p=>p.tooltipMeta))==null?void 0:Re.tooltipMeta,J=Array.from(new Set(D.rows.flatMap(p=>{var R;return((R=p.tooltipMeta)==null?void 0:R.aliases)||[]}).filter(Boolean))),be=J.length>3?`${J.slice(0,3).join(", ")} +${J.length-3}`:J.join(", "),pe=pn({state:Se,source:D.source,sourceId:D.sourceId,sourceNumber:D.sourceNumber});return{key:B,label:e.jsxs("div",{className:"v2-dashboard-pnl-order-row",children:[e.jsxs("div",{className:"v2-dashboard-pnl-order-row-main",children:[e.jsxs(f,{strong:!0,children:[String(D.source).toUpperCase()," ",D.sourceNumber||D.sourceId||"—"]}),be?J.length>3?e.jsx(L,{title:J.join(", "),children:e.jsxs(f,{type:"secondary",children:["· ",be]})}):e.jsxs(f,{type:"secondary",children:["· ",be]}):null]}),e.jsxs(S,{size:6,children:[e.jsx(d,{color:ne<0?"red":"green",children:ve(ne)}),ce.map(p=>e.jsx(d,{children:p},`${B}-${p}`)),ge.length?e.jsx(d,{color:"gold",children:"Vorbehaltlich"}):null,m?e.jsx(d,{color:"orange",children:"Phantom FO"}):null,(P==null?void 0:P.units)!=null?e.jsxs(d,{children:["Stück: ",ns(P.units,0)]}):null]})]}),children:e.jsxs("div",{className:"v2-dashboard-pnl-order-detail",children:[m?e.jsx("div",{className:"v2-dashboard-pnl-phantom-hint",children:e.jsxs(S,{wrap:!0,children:[e.jsx(d,{color:"gold",children:"Automatisch vorgeschlagen"}),e.jsxs(f,{type:"secondary",children:["Risikomonat ",V(m.firstRiskMonth)," · bestellen bis ",Xe(m.latestOrderDate)]}),e.jsx(O,{size:"small",type:"primary",onClick:()=>o(os({sku:m.sku,month:s.month,suggestedUnits:m.suggestedUnits,requiredArrivalDate:m.requiredArrivalDate,recommendedOrderDate:m.recommendedOrderDate,source:"phantom_fo",phantomId:m.id,firstRiskMonth:m.firstRiskMonth,orderMonth:m.orderMonth,leadTimeDays:m.leadTimeDays,returnTo:"/v2/dashboard"})),children:"Prüfen & bestätigen"})]})}):null,pe?e.jsx("div",{className:"v2-dashboard-order-timeline-shell",children:e.jsx(cn,{className:"v2-dashboard-order-timeline",items:pe.items,visibleStartMs:pe.visibleStartMs,visibleEndMs:pe.visibleEndMs,height:188})}):e.jsx(oe,{type:"info",showIcon:!0,message:`Keine Timeline-Daten für ${String(D.source).toUpperCase()} ${D.sourceNumber||D.sourceId||"—"} verfügbar.`}),e.jsx("div",{className:"v2-table-shell v2-scroll-host",children:e.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Milestone"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Fällig"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:D.rows.map((p,R)=>{var Yt;const Ce=p.tooltipMeta?e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("strong",{children:[String(p.source).toUpperCase()," ",p.sourceNumber||p.sourceId||"—"]})}),e.jsxs("div",{children:["Alias: ",p.tooltipMeta.aliases.join(", ")||"-"]}),e.jsxs("div",{children:["Stückzahl: ",p.tooltipMeta.units!=null?ns(p.tooltipMeta.units,0):"-"]}),e.jsxs("div",{children:["Fälligkeit: ",Xe(p.tooltipMeta.dueDate)]})]}):null;return e.jsxs("tr",{children:[e.jsx("td",{children:Ce?e.jsx(L,{title:Ce,children:p.label}):p.label}),e.jsx("td",{className:p.amount<0?"v2-negative":void 0,children:ve(p.amount)}),e.jsx("td",{children:Xe((Yt=p.tooltipMeta)==null?void 0:Yt.dueDate)}),e.jsx("td",{children:p.provisional?e.jsx(d,{color:"gold",children:"Vorbehaltlich"}):p.paid==null?e.jsx(d,{children:"—"}):p.paid?e.jsx(d,{color:"green",children:"Bezahlt"}):e.jsx(d,{color:"gold",children:"Offen"})})]},`${B}-${R}`)})})]})})]})}});return e.jsxs("div",{className:"v2-dashboard-pnl-group",children:[e.jsxs("div",{className:"v2-dashboard-pnl-group-head",children:[e.jsx(f,{strong:!0,children:N.label}),e.jsx(d,{color:"blue",children:ve(Ae(N.rows))})]}),e.jsx(we,{size:"small",items:Be,destroyInactivePanel:!0})]},`${s.month}-${N.key}`)}return e.jsxs("div",{className:"v2-dashboard-pnl-group",children:[e.jsxs("div",{className:"v2-dashboard-pnl-group-head",children:[e.jsx(f,{strong:!0,children:N.label}),e.jsx(d,{color:Ae(N.rows)<0?"red":"green",children:ve(Ae(N.rows))})]}),e.jsx("div",{className:"v2-table-shell v2-scroll-host",children:e.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Bucket"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:N.rows.map((E,Be)=>e.jsxs("tr",{children:[e.jsx("td",{children:E.tooltip?e.jsx(L,{title:E.tooltip,children:E.label}):E.label}),e.jsx("td",{children:E.portfolioBucket?e.jsx(d,{children:E.portfolioBucket}):"—"}),e.jsx("td",{className:E.amount<0?"v2-negative":void 0,children:ve(E.amount)}),e.jsx("td",{children:e.jsxs(S,{size:6,wrap:!0,children:[Kn(E),E.paid==null?e.jsx(d,{children:"—"}):E.paid?e.jsx(d,{color:"green",children:"Bezahlt"}):e.jsx(d,{color:"gold",children:"Offen"})]})})]},`${s.month}-${N.key}-${Be}`))})]})})]},`${s.month}-${N.key}`)})})}}),[Se,_e,o,Pe,Dt,fe,Wt,A.monthMap,I]);function Es(){h("next6"),y(es.slice()),M(at?"calibrated":"forecast"),v("manual"),q("basis"),F(!0),ye(!1)}function zs(s){if(!u)return;const l=s.month||u.month;if(s.checkKey==="cash_in"){o(ue("/v2/abschluss/eingaben",{source:"dashboard",month:l}));return}if(s.checkKey==="fixcost"){o(ue("/v2/abschluss/fixkosten",{source:"dashboard",month:l}));return}if(s.checkKey==="vat"){o(ue("/v2/abschluss/ust",{source:"dashboard",month:l}));return}if(s.checkKey==="revenue_inputs"&&s.sku){o(ue("/v2/products",{source:"dashboard",issues:"revenue",sku:s.sku}));return}if(s.issueType==="order_duty"&&s.sku){o(os({sku:s.sku,month:l,suggestedUnits:s.suggestedUnits??null,requiredArrivalDate:s.requiredArrivalDate||null,recommendedOrderDate:s.recommendedOrderDate||null,source:"inventory_projection",phantomId:null,firstRiskMonth:s.firstRiskMonth||null,orderMonth:s.orderMonth||null,leadTimeDays:s.leadTimeDays??null,returnTo:"/v2/dashboard"}));return}if(s.issueType==="forecast_missing"&&s.sku){o(hs({sku:s.sku,month:l}));return}if((s.issueType==="stock_oos"||s.issueType==="stock_under_safety")&&s.sku){o(kt({risk:s.issueType==="stock_oos"?"oos":"under_safety",abc:s.abcClass&&(s.abcClass==="A"||s.abcClass==="B")?"ab":"all",month:s.firstRiskMonth||l,sku:s.sku,mode:u.coverage.projectionMode||null}));return}o(xt({route:s.route,checkKey:s.checkKey,month:l,sku:s.sku||null,mode:u.coverage.projectionMode||null}))}return((Zt=(Qt=t.settings)==null?void 0:Qt.featureFlags)==null?void 0:Zt.executiveDashboardV2)!==!1?e.jsxs("div",{className:"v2-page",children:[e.jsxs($,{className:"v2-intro-card",children:[e.jsxs("div",{className:"v2-page-head",children:[e.jsxs("div",{children:[e.jsx(Ye,{level:3,children:"Dashboard"}),e.jsx(vt,{children:"Berechnungs-Cockpit für Kontostand und Cashflow. Details öffnest du bei Bedarf in den Fach-Tabs."})]}),e.jsxs("div",{className:"v2-toolbar-field",children:[e.jsx(f,{children:"Zeitraum"}),e.jsx(Jt,{value:c,onChange:s=>h(s),options:yt.map(s=>({value:s.value,label:s.label})),style:{width:220,maxWidth:"100%"}})]}),e.jsxs("div",{className:"v2-toolbar-field",children:[e.jsx(f,{children:"PFO bis"}),e.jsx(Jt,{value:me||void 0,onChange:s=>ie(String(s||"")),options:U.map(s=>({value:s,label:V(s)})),style:{width:220,maxWidth:"100%"},disabled:!U.length})]})]}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs(f,{type:"secondary",children:["Zeitraum: ",bs," (",G.length," Monate) · PFO bis: ",me?V(me):"—"]})})]}),r?e.jsx(oe,{type:"error",showIcon:!0,message:r}):null,n?e.jsx(oe,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,qe>0?e.jsx(oe,{type:"warning",showIcon:!0,message:`Forecast-Änderung: ${qe} FOs prüfen`,description:e.jsx(O,{size:"small",onClick:()=>o("/v2/forecast?panel=conflicts"),children:"Zur Konfliktliste"})}):null,e.jsx(Bs,{title:u?`Monats-Check: ${V(u.month)}`:"Monats-Check",placement:"right",width:520,open:rt&&!!u,onClose:()=>Mt(!1),destroyOnClose:!1,children:u?e.jsxs(S,{direction:"vertical",size:12,style:{width:"100%"},children:[e.jsxs(S,{wrap:!0,children:[e.jsx(d,{color:(ft==null?void 0:ft.color)||"default",children:u.coverage.statusLabel}),e.jsxs(f,{children:["Coverage ",Je(u.coverage.ratio*100)," (",u.coverage.coveredSkus,"/",u.coverage.activeSkus,"),"," ","Bestand ",u.coverage.stockIssueCount,","," ","Bestellpflicht ",u.coverage.orderDutyIssueCount,","," ","Blocker ",u.coverage.blockerCount]}),Ge?e.jsx(d,{children:"Vergangen (Info)"}):null]}),e.jsx($,{size:"small",title:"A) Kriterien (transparent & nachvollziehbar)",children:e.jsxs(S,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs(S,{wrap:!0,children:[e.jsx(L,{title:"Coverage zeigt den Anteil aktiver SKUs ohne Bestands- oder Bestellpflicht-Risiko im Monat.",children:e.jsx(d,{icon:e.jsx(X,{}),children:"Coverage"})}),e.jsx(L,{title:"Blocker sind harte Abweichungen, die den Monatsstatus verschlechtern und aktiv behoben werden sollten.",children:e.jsx(d,{icon:e.jsx(X,{}),children:"Blocker"})})]}),Ds.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(S,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsxs(f,{strong:!0,children:[An(s.state)," ",s.label]}),s.route?e.jsx(O,{size:"small",onClick:()=>o(xt({route:s.route,month:u.month,mode:u.coverage.projectionMode})),children:"Öffnen"}):null]}),e.jsx(f,{type:"secondary",children:s.description})]},s.key))]})}),e.jsx($,{size:"small",title:"B) Konkrete Blocker & To-Dos",children:u.coverage.statusKey==="full"?e.jsx(oe,{type:"success",showIcon:!0,message:"Status ist Vollständig. Es sind keine To-Dos offen."}):Ge?e.jsx(oe,{type:"info",showIcon:!0,message:"Vergangener Monat",description:"Zur Einordnung werden die Ursachen angezeigt, es besteht keine To-Do-Pflicht mehr."}):e.jsxs(S,{direction:"vertical",size:10,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"1) Blocker"}),u.blockers.length?e.jsx(S,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:u.blockers.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(S,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsx(d,{color:"red",children:"Blocker"}),e.jsx(O,{size:"small",onClick:()=>zs(s),children:"Öffnen"})]}),e.jsx(f,{children:s.message})]},s.id))}):e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Keine expliziten Blocker gelistet."})})]}),e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"2) Warnungen"}),Ut.length?e.jsx(S,{direction:"vertical",size:8,style:{width:"100%",marginTop:6},children:Ut.map(s=>e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:10},children:[e.jsxs(S,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[e.jsx(d,{color:"gold",children:"Warnung"}),e.jsx(O,{size:"small",onClick:()=>o(s.route),children:"Öffnen"})]}),e.jsx(f,{children:s.message})]},s.id))}):e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Keine Warnungen."})})]})]})})]}):e.jsx(f,{type:"secondary",children:"Kein Monat gewählt."})}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:$e,items:[{key:"signals",label:"Executive Signals",children:e.jsxs("div",{className:"v2-dashboard-signal-grid",children:[e.jsxs($,{className:"v2-dashboard-signal-card v2-dashboard-readiness-card",children:[e.jsx(Ze,{title:et("Readiness Gate","Go/No-Go vor großer Datenpflege. Alle Checks müssen grün sein."),value:se.ready?"Bereit":"Nicht bereit"}),e.jsxs(S,{wrap:!0,children:[e.jsx(d,{color:se.ready?"green":"red",children:se.ready?"Go":"No-Go"}),e.jsxs(d,{color:se.ready?"green":"gold",children:[se.robustMonthsCount,"/",se.robustRequiredCount," robuste Monate"]})]}),!se.ready&&se.blockers.length?e.jsx("div",{className:"v2-dashboard-readiness-blockers",children:se.blockers.slice(0,2).map(s=>e.jsxs("div",{className:"v2-dashboard-readiness-blocker-item",children:[e.jsxs(f,{type:"secondary",children:[s.label,": ",s.message]}),e.jsx(O,{size:"small",onClick:()=>o(s.route),children:"Öffnen"})]},s.id))}):e.jsx(f,{type:"secondary",children:"Alle Gate-Checks erfüllt."})]}),e.jsxs($,{className:"v2-dashboard-signal-card",children:[e.jsx(Ze,{title:et("Robust bis","Letzter Monat, in dem alle Hard-Checks erfüllt sind. Danach ist der Kontostand nur Orientierung."),value:A.robustUntilMonth?V(A.robustUntilMonth):"—"}),e.jsxs(f,{type:"secondary",children:[A.robustMonthsCount,"/",A.totalMonths," Monate robust"]})]}),e.jsxs($,{className:"v2-dashboard-signal-card",children:[e.jsx(Ze,{title:et("Erster negativer Monat (robust)","Erster belastbarer Monat mit negativem Kontostand. Nicht robuste Monate werden dafür ignoriert."),value:Kt?V(Kt):"Keiner"}),e.jsx(f,{type:"secondary",children:"Nur robuste Monate werden berücksichtigt"})]}),e.jsxs($,{className:"v2-dashboard-signal-card",children:[e.jsx(Ze,{title:et("Freier Cash nach Buffer","Minimaler belastbarer Kontostand minus Sicherheitsreserve aus 2 Monaten Fixkosten."),value:Lt!=null?T(Lt):"—"}),e.jsxs(f,{type:"secondary",children:["Buffer (2M Fixkosten): ",T(Ue)]})]}),e.jsxs($,{className:"v2-dashboard-signal-card",children:[e.jsxs("div",{className:"v2-dashboard-forecast-status-head",children:[e.jsxs(f,{strong:!0,children:["Forecast Freshness",e.jsx(L,{title:"Ampel nach Importalter: Grün <=35 Tage, Gelb 36-45 Tage, Rot >45 Tage.",children:e.jsx(X,{className:"v2-dashboard-inline-info"})})]}),e.jsx(d,{color:De==="fresh"?"green":De==="aging"?"gold":De==="stale"?"red":"default",children:De==="fresh"?"Grün":De==="aging"?"Gelb":De==="stale"?"Rot":"Keine Daten"})]}),e.jsxs("div",{className:"v2-dashboard-forecast-status-meta",children:[e.jsxs("div",{children:["Baseline Forecast: ",js]}),e.jsx("div",{children:Ms}),e.jsxs("div",{children:["Letzter Import: ",Xe(mt)]}),e.jsxs("div",{children:["Nächster Import empfohlen: ",_t?_t.toLocaleDateString("de-DE"):"—"]}),qe>0?e.jsx("div",{children:e.jsxs(O,{size:"small",onClick:()=>o("/v2/forecast?panel=conflicts"),children:["Forecast-Änderung: ",qe," FOs prüfen"]})}):null]})]})]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:$e,items:[{key:"cashflow",label:"Kontostand & Cashflow",children:e.jsxs($,{className:"v2-dashboard-chart-card",children:[e.jsxs("div",{className:"v2-calc-cockpit-shell",children:[e.jsxs("div",{className:"v2-calc-cockpit-status",children:[e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:"Aktive Berechnung"}),e.jsxs(S,{wrap:!0,style:{marginTop:6},children:[e.jsxs(d,{children:["Scope: ",Pt]}),e.jsxs(d,{children:["Umsatzbasis: ",Ot]}),e.jsxs(d,{children:["Auszahlungsquote: ",Bt]}),e.jsxs(d,{children:["Sicherheitsmodus: ",Rt]}),dt?e.jsxs(d,{children:["Q4: ",Tt]}):null]})]}),e.jsxs("div",{className:"v2-calc-cockpit-status-right",children:[e.jsxs(S,{wrap:!0,children:[e.jsxs(f,{type:"secondary",children:["Min. Kontostand: ",e.jsx("strong",{children:T(xs)})]}),e.jsxs(f,{type:"secondary",children:["Summe Netto: ",e.jsx("strong",{children:T(ct)})]})]}),e.jsxs(S,{wrap:!0,children:[e.jsx(on,{trigger:"click",open:Q,onOpenChange:ye,placement:"bottomRight",content:e.jsxs("div",{className:"v2-calc-cockpit-popover",children:[e.jsx(f,{strong:!0,children:"Aktive Einstellungen"}),e.jsxs("div",{children:["Scope: ",Pt]}),e.jsxs("div",{children:["Umsatzbasis: ",Ot]}),e.jsxs("div",{children:["Auszahlungsquote: ",Bt]}),e.jsxs("div",{children:["Sicherheitsmodus: ",Rt]}),dt?e.jsxs("div",{children:["Q4: ",Tt]}):null,e.jsx(f,{type:"secondary",children:"Diese Auswahl wirkt direkt auf Umsatz, Cash-In, Netto und Kontostand im Chart."}),e.jsxs(S,{wrap:!0,children:[e.jsx(O,{size:"small",type:"link",onClick:()=>o("/v2/abschluss/eingaben"),children:"Eingaben"}),e.jsx(O,{size:"small",type:"link",onClick:()=>o("/v2/forecast"),children:"Forecast"}),e.jsx(O,{size:"small",type:"link",onClick:()=>o("/v2/products"),children:"Produkte"})]})]}),children:e.jsx(O,{size:"small",children:"Details"})}),e.jsx(O,{size:"small",onClick:Es,children:"Zurücksetzen"})]})]})]}),e.jsxs("div",{className:"v2-calc-cockpit-modules",children:[e.jsxs($,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(S,{size:6,children:[e.jsx(f,{strong:!0,children:"Portfolio-Scope"}),e.jsx(L,{title:"Bestimmt, welche Produktgruppen in Umsatz, Cash-In, PnL und Kontostand einfließen. Stammdaten werden nicht verändert.",children:e.jsx(X,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx("div",{className:"v2-calc-cockpit-chip-row",children:us.map(s=>{const l=g.includes(s.value);return e.jsx(Sn,{checked:l,onChange:j=>{y(w=>{const H=Array.from(new Set((w||[]).filter(K=>ze.includes(K))));if(j)return Array.from(new Set([...H,s.value]));const C=H.filter(K=>K!==s.value);return C.length?C:H})},children:s.label},s.value)})}),e.jsxs(S,{wrap:!0,children:[e.jsx(O,{size:"small",type:g.length===1&&g[0]===_.CORE?"primary":"default",onClick:()=>y([_.CORE]),children:"Nur Kern"}),e.jsx(O,{size:"small",type:rs(g)==="Kern+Plan"?"primary":"default",onClick:()=>y([_.CORE,_.PLAN]),children:"Kern+Plan"}),e.jsx(O,{size:"small",type:g.length===ze.length?"primary":"default",onClick:()=>y(ze.slice()),children:"Alles"})]}),e.jsx(f,{type:"secondary",children:"Bestimmt nur die aktuelle Berechnung im Dashboard."})]}),e.jsxs($,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(S,{size:6,children:[e.jsx(f,{strong:!0,children:"Umsatzbasis"}),e.jsx(L,{title:"Forecast-Umsatz = Absatzprognose × Verkaufspreis. Kalibrierter Umsatz = Forecast-Umsatz mit Kalibrierfaktor aus Eingaben.",children:e.jsx(X,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx(bt,{block:!0,value:x,onChange:s=>M(String(s)==="calibrated"?"calibrated":"forecast"),options:[{label:"Forecast-Umsatz",value:"forecast"},{label:"Kalibrierter Umsatz",value:"calibrated"}]}),e.jsxs(f,{type:"secondary",children:[x==="calibrated"?`Kalibrierung aktiv (wirkt über ${gs} Monate).`:"Kalibrierung aus."," ",e.jsx(O,{size:"small",type:"link",onClick:()=>o("/v2/abschluss/eingaben"),children:x==="calibrated"?"Eingaben öffnen":"In Eingaben aktivieren"})]})]}),e.jsxs($,{size:"small",className:"v2-calc-cockpit-module",children:[e.jsxs(S,{size:6,children:[e.jsx(f,{strong:!0,children:"Amazon Auszahlung (Cash-In)"}),e.jsx(L,{title:"Manuell nutzt die Monatsquote aus Eingaben. Empfehlung berechnet die Quote automatisch als Vorschlag je Monat.",children:e.jsx(X,{})})]}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:"Wirkt auf Kontostand & PnL"})}),e.jsx(bt,{block:!0,value:z,onChange:s=>v(String(s)==="recommendation"?"recommendation":"manual"),options:[{label:"Manuell je Monat",value:"manual"},{label:"Empfehlung",value:"recommendation"}]}),e.jsxs(S,{direction:"vertical",size:6,style:{width:"100%"},children:[e.jsxs(S,{size:6,children:[e.jsx(f,{strong:!0,children:"Sicherheitsmodus"}),e.jsx(L,{title:"Basis: keine Sicherheitsmarge. Konservativ: reduziert die Quote in zukünftigen Monaten um 1pp pro Monat (max. 5pp).",children:e.jsx(X,{})})]}),e.jsx(bt,{block:!0,value:k,onChange:s=>q(String(s)==="conservative"?"conservative":"basis"),options:[{label:"Basis",value:"basis"},{label:"Konservativ",value:"conservative"}]})]}),dt?e.jsxs("div",{className:"v2-calc-cockpit-q4-row",children:[e.jsx(an,{checked:b,onChange:s=>F(s.target.checked),children:"Saisonalität (Q4) berücksichtigen"}),e.jsx(L,{title:"Q4 berücksichtigt saisonale Besonderheiten für Oktober bis Dezember. Gilt nur für die Empfehlung.",children:e.jsx(X,{})})]}):null,e.jsx(f,{type:"secondary",children:z==="manual"?"Verwendet die manuell gepflegte Auszahlungsquote je Monat.":"Empfehlung wird je Monat automatisch berechnet und direkt im Chart angewendet."})]})]})]}),e.jsx(Ye,{level:4,style:{marginTop:16},children:"Kontostand & Cashflow"}),e.jsxs(S,{wrap:!0,children:[e.jsxs(d,{color:"green",children:["Einzahlungen: ",T(vs)]}),e.jsxs(d,{color:"red",children:["Auszahlungen: ",T(ys)]}),e.jsxs(d,{color:ct>=0?"green":"red",children:["Netto: ",T(ct)]}),le.length?e.jsxs(d,{color:"gold",children:["Phantom-FOs: ",le.length]}):null,me?e.jsxs(d,{color:"gold",children:["PFO bis: ",V(me)]}):null]}),e.jsxs("div",{className:"v2-dashboard-legend-help",children:[e.jsx(f,{type:"secondary",className:"v2-dashboard-legend-note",children:"Die Legende steuert nur die Sichtbarkeit von Serien. Die Berechnung bleibt unverändert."}),e.jsx(L,{title:"Durchgezogene Linie: belastbarer Kontostand (alle Hard-Checks bestanden).",children:e.jsx(d,{className:"v2-dashboard-legend-tag",children:"Linie solid = belastbar"})}),e.jsx(L,{title:"Gestrichelte Linie: orientierend, weil mindestens ein Hard-Check fehlt.",children:e.jsx(d,{className:"v2-dashboard-legend-tag",children:"Linie gestrichelt = orientierend"})}),e.jsx(L,{title:"Rot markiert: Kontostand liegt unter 0 im jeweiligen Zustand.",children:e.jsx(d,{className:"v2-dashboard-legend-tag",children:"Rot = unter 0"})})]}),e.jsx(Ts,{style:{height:380},option:Is,onEvents:ws})]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:$e,items:[{key:"robustness",label:"Robustheits-Matrix",children:e.jsxs($,{children:[e.jsx(Ye,{level:4,children:"Robustheits-Matrix"}),e.jsx(vt,{type:"secondary",children:"Ein Monat wird nur dann grün, wenn Bestands-Check und Look-Ahead-Bestellpflicht passen. Die Stufen folgen den Schwellen: Vollständig 100 %, Weitgehend ≥95 % ohne A/B-Blocker, Teilweise ≥80 %, sonst Unzureichend."}),e.jsx("div",{className:"v2-dashboard-robust-legend",children:["full","wide","partial","insufficient"].map(s=>{const l=st(s);return e.jsxs("div",{className:"v2-dashboard-robust-legend-item",children:[e.jsx("span",{className:`v2-dashboard-robust-dot ${l.className}`}),e.jsx(f,{children:l.label})]},s)})}),e.jsx("div",{className:"v2-dashboard-robust-grid",children:A.months.map(s=>{const l=Qe(s.month),j=l!=null&&qt!=null&&l<qt,w=st(s.coverage.statusKey);return e.jsxs("button",{type:"button",className:["v2-dashboard-robust-item",ee===s.month?"is-selected":"",w.className,j?"is-past":""].filter(Boolean).join(" "),onClick:()=>Pe(s.month),children:[e.jsxs("div",{className:"v2-dashboard-robust-item-head",children:[e.jsx("span",{children:V(s.month)}),e.jsxs(S,{size:6,children:[e.jsx(d,{color:w.color,children:w.label}),j?e.jsx(d,{children:"Vergangen"}):null]})]}),e.jsxs("div",{className:"v2-dashboard-robust-item-meta",children:["Coverage: ",Je(s.coverage.ratio*100)," (",s.coverage.coveredSkus,"/",s.coverage.activeSkus,")"]}),e.jsxs("div",{className:"v2-dashboard-robust-item-meta",children:["Blocker SKUs: ",s.coverage.blockerCount," (A/B ",s.coverage.blockerAbCount," · C ",s.coverage.blockerCCount,")"]})]},s.month)})}),u?e.jsxs("div",{className:"v2-dashboard-robust-detail",children:[e.jsxs("div",{className:"v2-dashboard-robust-detail-head",children:[e.jsx(f,{strong:!0,children:V(u.month)}),e.jsxs(S,{wrap:!0,children:[In(u.coverage.statusKey),e.jsxs(d,{children:["Coverage: ",Je(u.coverage.ratio*100)]}),e.jsxs(d,{children:["Blocker: ",u.coverage.blockerCount]}),e.jsxs(d,{children:["A/B: ",u.coverage.blockerAbCount," · C: ",u.coverage.blockerCCount]}),u.coverage.overdueOrderDutySkuCount>0?e.jsxs(d,{color:"red",children:["Überfällig: ",u.coverage.overdueOrderDutySkuCount]}):null]})]}),e.jsx("div",{className:"v2-dashboard-robust-checklist",children:Ns.map(s=>e.jsxs("div",{className:`v2-dashboard-robust-checklist-item ${s.passed?"is-pass":"is-fail"}`,children:[e.jsx("span",{className:"v2-dashboard-robust-check-icon",children:s.passed?"✅":"❌"}),e.jsxs("div",{children:[e.jsx(f,{strong:!0,children:s.label}),e.jsx("div",{children:e.jsx(f,{type:"secondary",children:s.description})})]})]},s.key))}),e.jsxs("div",{className:"v2-dashboard-blockers",children:[e.jsx(f,{strong:!0,children:"Weitere Hard-Checks"}),Vt.length?e.jsx("div",{className:"v2-dashboard-blocker-list",children:Vt.map(s=>e.jsxs("div",{className:"v2-dashboard-blocker-item",children:[e.jsxs("div",{children:[e.jsx(f,{children:s.message}),s.sku?e.jsxs(f,{type:"secondary",children:[" · ",s.sku]}):null]}),e.jsx(O,{size:"small",onClick:()=>o(xt({route:s.route,checkKey:s.checkKey,month:s.month,sku:s.sku||null,mode:u.coverage.projectionMode})),children:"Öffnen"})]},s.id))}):e.jsx(f,{type:"secondary",children:"Keine weiteren Hard-Check-Blocker."})]})]}):null]})}]}),e.jsx(we,{className:"v2-dashboard-module-collapse",activeKey:ke,onChange:$e,items:[{key:"pnl",label:"Monatliche PnL (Drilldown)",children:e.jsxs($,{children:[e.jsx(Ye,{level:4,children:"Monatliche PnL (Drilldown)"}),e.jsx(vt,{type:"secondary",children:"Einzahlungen, PO/FO-Zahlungen, Fixkosten und Steuern je Monat. PO/FO-Positionen sind bis auf Milestone-Ebene aufklappbar."}),e.jsx(we,{className:"v2-dashboard-pnl-collapse",activeKey:Te,onChange:s=>W(Array.isArray(s)?s.map(String):[String(s)]),items:As})]})}]})]}):e.jsx("div",{className:"v2-page",children:e.jsx(oe,{type:"info",showIcon:!0,message:"Executive Dashboard ist per Feature-Flag deaktiviert (settings.featureFlags.executiveDashboardV2=false)."})})}export{Cr as default};
