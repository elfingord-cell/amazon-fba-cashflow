import{E as K,l as N}from"./index-CAzQztwo.js";import{c as V,b as $,a as M,t as j}from"./accountantReport-DKjKKWiG.js";import"./orderEditorFactory-3AxbAuwW.js";import"./store-BzgQ-F5B.js";import"./prefill-BxMihg1A.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-cLNRxzoZ.js";function e(l,r={},s=[]){const i=document.createElement(l);return Object.entries(r).forEach(([n,c])=>{n==="class"?i.className=c:n.startsWith("on")&&typeof c=="function"?i.addEventListener(n.slice(2),c):c!=null&&i.setAttribute(n,c)}),(Array.isArray(s)?s:[s]).forEach(n=>{n!=null&&i.append(n.nodeType?n:document.createTextNode(String(n)))}),i}function U(l){if(!l)return"-";const[r,s,i]=String(l).split("-").map(Number);if(!r||!s||!i)return"-";const n=new Date(r,s-1,i);return Number.isNaN(n.getTime())?"-":n.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function d(l,r=2){return Number.isFinite(Number(l))?Number(l).toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r}):"-"}function T(l,r,s){l.innerHTML="";const i=e("table",{class:"table-compact ui-table-standard ui-data-table","data-ui-table":"true"}),n=e("thead"),c=e("tr");r.forEach(p=>{c.append(e("th",{class:p.align==="right"?"num":null},[p.label]))}),n.append(c);const m=e("tbody");s.length?s.forEach(p=>{const y=e("tr");r.forEach(g=>{const b=typeof g.render=="function"?g.render(p):p[g.key];y.append(e("td",{class:g.align==="right"?"num":null},[b==null||b===""?"-":b]))}),m.append(y)}):m.append(e("tr",{},[e("td",{colspan:String(r.length),class:"muted"},["Keine Daten im gewaehlten Monat."])])),i.append(n,m),l.append(i)}async function H(l){const r=String(l||"");if(!r)return!1;if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(r),!0;const s=e("textarea",{style:"position:fixed;left:-9999px;top:-9999px;"},[r]);document.body.append(s),s.focus(),s.select();const i=document.execCommand("copy");return s.remove(),i}function C(l){const r=V(),s=K()||"Workspace";let i=null,n=null,c=!1;const m=e("input",{type:"month",value:r.month}),p=e("input",{type:"checkbox"}),y=e("input",{type:"text",placeholder:"optional, z.B. 150000"}),g=e("button",{class:"btn secondary",type:"button"},["Preview aktualisieren"]),b=e("button",{class:"btn primary",type:"button"},["Paket erstellen"]),x=e("button",{class:"btn",type:"button"},["E-Mail Text kopieren"]),h=e("div",{class:"muted"},[]),k=e("div",{class:"grid four accountant-summary-grid"}),A=e("div",{class:"card soft"},[e("h3",{class:"muted"},["Datenqualitaet"])]),v=e("ul",{class:"simple"});A.append(v);const L=e("div",{class:"table-wrap ui-table-shell ui-scroll-host"}),D=e("div",{class:"table-wrap ui-table-shell ui-scroll-host"}),P=e("div",{class:"table-wrap ui-table-shell ui-scroll-host"}),q=e("div",{class:"card soft"},[e("div",{class:"ui-page-head"},[e("h3",{},["Warenbestand (Monatsende)"])]),L]),F=e("div",{class:"card soft"},[e("div",{class:"ui-page-head"},[e("h3",{},["Lieferanzahlungen (PO, paidDate im Monat)"])]),D]),I=e("div",{class:"card soft"},[e("div",{class:"ui-page-head"},[e("h3",{},["Wareneingang (PO, Arrival/ETA im Monat)"])]),P]);function f(a,t=!1){h.textContent=a||"",h.classList.toggle("danger",!!t),h.classList.toggle("ok",!t&&!!a)}function S(){const a=p.checked?"core_plus_journal":"core",o=String(y.value||"").trim().replace(/\./g,"").replace(",","."),u=Number(o),w=Number.isFinite(u)?u:null;return{request:{month:m.value||r.month,scope:a},options:{workspaceName:s,inventoryValueOverrideEur:w}}}function O(a){k.innerHTML="",[{label:"Snapshot As Of",value:U(a.inventory.snapshotAsOf)},{label:"Warenwert EUR",value:Number.isFinite(Number(a.inventory.totalValueEur))?`${d(a.inventory.totalValueEur,2)} EUR`:"-"},{label:"Anzahlungen (PO)",value:String(a.deposits.length)},{label:"Wareneingaenge (PO)",value:String(a.arrivals.length)},{label:"Amazon Units",value:d(a.inventory.totalAmazonUnits,0)},{label:"3PL Units",value:d(a.inventory.total3plUnits,0)},{label:"In Transit Units",value:d(a.inventory.totalInTransitUnits,0)},{label:"Quality Issues",value:String((a.quality||[]).length)}].forEach(o=>{k.append(e("div",{class:"stat-card"},[e("div",{class:"label"},[o.label]),e("div",{class:"value"},[o.value])]))})}function z(a){var t;if(v.innerHTML="",!((t=a.quality)!=null&&t.length)){v.append(e("li",{class:"ok"},["Keine Hinweise."]));return}a.quality.forEach(o=>{v.append(e("li",{},[`[${o.severity||"info"}] ${o.code||"ISSUE"}: ${o.message||""}`]))})}function W(a){T(L,[{key:"sku",label:"SKU"},{key:"alias",label:"Alias"},{key:"category",label:"Kategorie"},{key:"amazonUnits",label:"Amazon",align:"right",render:t=>d(t.amazonUnits,0)},{key:"threePLUnits",label:"3PL",align:"right",render:t=>d(t.threePLUnits,0)},{key:"inTransitUnits",label:"In Transit",align:"right",render:t=>d(t.inTransitUnits,0)},{key:"rowValueEur",label:"Warenwert EUR",align:"right",render:t=>Number.isFinite(Number(t.rowValueEur))?d(t.rowValueEur,2):"-"}],a.inventoryRows||[]),T(D,[{key:"poNumber",label:"PO"},{key:"supplier",label:"Supplier"},{key:"skuAliases",label:"SKU Alias"},{key:"paidDate",label:"Paid Date",render:t=>U(t.paidDate)},{key:"actualEur",label:"Ist EUR",align:"right",render:t=>Number.isFinite(Number(t.actualEur))?d(t.actualEur,2):"-"},{key:"amountUsd",label:"USD",align:"right",render:t=>Number.isFinite(Number(t.amountUsd))?d(t.amountUsd,2):"-"},{key:"issues",label:"Issues",render:t=>(t.issues||[]).join(" | ")||"-"}],a.deposits||[]),T(P,[{key:"poNumber",label:"PO"},{key:"supplier",label:"Supplier"},{key:"skuAliases",label:"SKU Alias"},{key:"arrivalDate",label:"Arrival",render:t=>U(t.arrivalDate)},{key:"units",label:"Units",align:"right",render:t=>d(t.units,0)},{key:"goodsEur",label:"Goods EUR",align:"right",render:t=>Number.isFinite(Number(t.goodsEur))?d(t.goodsEur,2):"-"},{key:"issues",label:"Issues",render:t=>(t.issues||[]).join(" | ")||"-"}],a.arrivals||[])}function E(){const a=N(),{request:t,options:o}=S();i=$(a,t,o),O(i),z(i),W(i),f(`Preview aktualisiert fuer ${t.month}.`)}async function R(){if(!c){c=!0,b.setAttribute("disabled","disabled");try{const a=N(),{request:t,options:o}=S(),u=await M(a,t,o);n=u,i=u,O(u),z(u),W(u),await j(u.zipBlob,u.zipFileName),f(`Paket erstellt: ${u.zipFileName}`)}catch(a){console.error(a),f((a==null?void 0:a.message)||"Export fehlgeschlagen.",!0)}finally{c=!1,b.removeAttribute("disabled")}}}async function B(){var a;try{if(!n){const o=N(),{request:u,options:w}=S();n=await M(o,u,w)}const t=await H(((a=n==null?void 0:n.emailDraft)==null?void 0:a.text)||"");f(t?"E-Mail Text in Zwischenablage kopiert.":"Kopieren nicht moeglich.",!t)}catch(t){console.error(t),f((t==null?void 0:t.message)||"E-Mail Text konnte nicht kopiert werden.",!0)}}g.addEventListener("click",E),b.addEventListener("click",R),x.addEventListener("click",B),m.addEventListener("change",E),p.addEventListener("change",E),l.innerHTML="",l.append(e("section",{class:"card"},[e("div",{class:"ui-page-head"},[e("div",{},[e("h2",{},["Buchhalter Export"]),e("p",{class:"muted"},["One-Click Paket fuer Warenbestand, Lieferanzahlungen und Wareneingaenge inkl. E-Mail-Text."])])]),e("div",{class:"ui-toolbar"},[e("div",{class:"ui-toolbar-row"},[e("label",{class:"field"},[e("span",{},["Monat"]),m]),e("label",{class:"field"},[e("span",{},["Scope"]),e("span",{class:"row"},[p,e("span",{},["Zahlungsjournal zusaetzlich"])])]),e("label",{class:"field"},[e("span",{},["Warenwert Override EUR (optional)"]),y])]),e("div",{class:"ui-actions-inline"},[g,b,x])]),h,k,A,q,F,I])),E()}const ie={render:C};export{ie as default,C as render};
