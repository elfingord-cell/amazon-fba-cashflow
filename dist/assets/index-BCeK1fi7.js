import{Q as Le,t as o,U as Ce,V as Ue,W as De,L as Q,X as Be,Y as Te,Z as $e,$ as ge,a0 as We,a1 as Ke,a2 as _e,a3 as f,k as n,J as Ve,S as H,M as y,I as te,a4 as Pe,O as me,P as pe}from"./index-elUAAuqx.js";import{D as J}from"./DeNumberInput-Bxwtbnq1.js";import{b as Ge}from"./tableModels-CammutxZ.js";import{f as re}from"./months-DiLwPhVv.js";import{u as qe,C as he}from"./workspace-DMXjunb_.js";import{b as He,a as ke,c as Xe,m as ae,P as Ee,n as Ye,d as Ze}from"./planProducts-BY0Y95Lf.js";import{F as je}from"./Table-C_tyMDj7.js";import{g as Ie,P as Je,a as Qe}from"./index-BwrOZNWo.js";import{S as K}from"./index-BytK8p14.js";import{s as se}from"./index-4z8CX_jA.js";import"./index-DChuXDnn.js";import"./productCompletenessV2-C6U-GVjR.js";import"./Dropdown-onqalcmq.js";import"./index-CVrItAb4.js";import"./useBubbleLock-DQn9hN27.js";import"./index-CYEnK3OG.js";import"./Pagination-B4liCMYf.js";const en=r=>{const{componentCls:a,iconCls:u,antCls:i,zIndexPopup:c,colorText:w,colorWarning:P,marginXXS:b,marginXS:d,fontSize:I,fontWeightStrong:T,colorTextHeading:N}=r;return{[a]:{zIndex:c,[`&${i}-popover`]:{fontSize:I},[`${a}-message`]:{marginBottom:d,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${a}-message-icon ${u}`]:{color:P,fontSize:I,lineHeight:1,marginInlineEnd:d},[`${a}-title`]:{fontWeight:T,color:N,"&:only-child":{fontWeight:"normal"}},[`${a}-description`]:{marginTop:b,color:w}},[`${a}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:d}}}}},nn=r=>{const{zIndexPopupBase:a}=r;return{zIndexPopup:a+60}},Oe=Le("Popconfirm",r=>en(r),nn,{resetStyle:!1});var tn=function(r,a){var u={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.indexOf(i)<0&&(u[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(r);c<i.length;c++)a.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(r,i[c])&&(u[i[c]]=r[i[c]]);return u};const Ae=r=>{const{prefixCls:a,okButtonProps:u,cancelButtonProps:i,title:c,description:w,cancelText:P,okText:b,okType:d="primary",icon:I=o.createElement(Ce,null),showCancel:T=!0,close:N,onConfirm:O,onCancel:$,onPopupClick:M}=r,{getPrefixCls:k}=o.useContext(Ue),[g]=De("Popconfirm",$e.Popconfirm),F=Ie(c),W=Ie(w);return o.createElement("div",{className:`${a}-inner-content`,onClick:M},o.createElement("div",{className:`${a}-message`},I&&o.createElement("span",{className:`${a}-message-icon`},I),o.createElement("div",{className:`${a}-message-text`},F&&o.createElement("div",{className:`${a}-title`},F),W&&o.createElement("div",{className:`${a}-description`},W))),o.createElement("div",{className:`${a}-buttons`},T&&o.createElement(Q,Object.assign({onClick:$,size:"small"},i),P||(g==null?void 0:g.cancelText)),o.createElement(Be,{buttonProps:Object.assign(Object.assign({size:"small"},Te(d)),u),actionFn:O,close:N,prefixCls:k("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},b||(g==null?void 0:g.okText))))},rn=r=>{const{prefixCls:a,placement:u,className:i,style:c}=r,w=tn(r,["prefixCls","placement","className","style"]),{getPrefixCls:P}=o.useContext(Ue),b=P("popconfirm",a),[d]=Oe(b);return d(o.createElement(Je,{placement:u,className:ge(b,i),style:c,content:o.createElement(Ae,Object.assign({prefixCls:b},w))}))};var an=function(r,a){var u={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.indexOf(i)<0&&(u[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(r);c<i.length;c++)a.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(r,i[c])&&(u[i[c]]=r[i[c]]);return u};const sn=o.forwardRef((r,a)=>{var u,i;const{prefixCls:c,placement:w="top",trigger:P="click",okType:b="primary",icon:d=o.createElement(Ce,null),children:I,overlayClassName:T,onOpenChange:N,onVisibleChange:O,overlayStyle:$,styles:M,classNames:k}=r,g=an(r,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:F,className:W,style:X,classNames:R,styles:ee}=We("popconfirm"),[V,A]=Ke(!1,{value:(u=r.open)!==null&&u!==void 0?u:r.visible,defaultValue:(i=r.defaultOpen)!==null&&i!==void 0?i:r.defaultVisible}),L=(x,j)=>{A(x,!0),O==null||O(x),N==null||N(x,j)},D=x=>{L(!1,x)},p=x=>{var j;return(j=r.onConfirm)===null||j===void 0?void 0:j.call(void 0,x)},G=x=>{var j;L(!1,x),(j=r.onCancel)===null||j===void 0||j.call(void 0,x)},oe=(x,j)=>{const{disabled:e=!1}=r;e||L(x,j)},Y=F("popconfirm",c),le=ge(Y,W,T,R.root,k==null?void 0:k.root),ce=ge(R.body,k==null?void 0:k.body),[ue]=Oe(Y);return ue(o.createElement(Qe,Object.assign({},_e(g,["title"]),{trigger:P,placement:w,onOpenChange:oe,open:V,ref:a,classNames:{root:le,body:ce},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},ee.root),X),$),M==null?void 0:M.root),body:Object.assign(Object.assign({},ee.body),M==null?void 0:M.body)},content:o.createElement(Ae,Object.assign({okType:b,icon:d},r,{prefixCls:Y,close:D,onConfirm:p,onCancel:G})),"data-popover-inject":!0}),I))}),Fe=sn;Fe._InternalPanelDoNotUseOrYouWillBeFired=rn;const{Paragraph:Re,Text:_,Title:we}=Ve,Ne={standalone:"Standalone",variant_of_existing:"Variant of Existing",category_adjacent:"Category Adjacent"};function ie(){return new Date().toISOString()}function Me(r){return`${r}-${Math.random().toString(36).slice(2,9)}`}function l(r){if(r==null||r==="")return null;const a=Number(r);return Number.isFinite(a)?a:null}function ze(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}function v(r,a=0){const u=Number(r);return Number.isFinite(u)?u.toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a}):"—"}function fe(r){const a=Ze(r||{},0);return{id:a.id||"",alias:a.alias||"",plannedSku:a.plannedSku||"",relationType:a.relationType||Ee[0],categoryId:a.categoryId||null,status:a.status||"active",baselineReferenceMonth:l(a.baselineReferenceMonth),baselineUnitsInReferenceMonth:l(a.baselineUnitsInReferenceMonth),seasonalityReferenceSku:a.seasonalityReferenceSku||"",baselineReferenceSku:a.baselineReferenceSku||"",avgSellingPriceGrossEUR:l(a.avgSellingPriceGrossEUR),sellerboardMarginPct:l(a.sellerboardMarginPct),launchDate:a.launchDate||ze(),rampUpWeeks:l(a.rampUpWeeks),softLaunchStartSharePct:l(a.softLaunchStartSharePct)}}function In(){const{state:r,loading:a,saving:u,error:i,lastSavedAt:c,saveWith:w}=qe(),[P,b]=o.useState(!1),[d,I]=o.useState(null),[T,N]=o.useState(!1),[O,$]=o.useState(null),[M,k]=o.useState(""),[g]=f.useForm(),F=f.useWatch([],g),W=r,X=r.settings&&typeof r.settings=="object"?r.settings:{},R=o.useMemo(()=>Ge(X),[X.horizonMonths,X.startMonth]),ee=o.useMemo(()=>(Array.isArray(r.productCategories)?r.productCategories:[]).map(e=>({id:String(e.id||""),name:String(e.name||"Ohne Kategorie")})).filter(e=>e.id),[r.productCategories]),V=o.useMemo(()=>(Array.isArray(r.products)?r.products:[]).map(e=>{const t=e,s=String(t.sku||"").trim();if(!s)return null;const S=String(t.alias||s);return{value:s,label:`${S} · ${s}`}}).filter(Boolean),[r.products]),A=o.useMemo(()=>He({state:W,months:R}),[R,W]),L=o.useMemo(()=>d&&A.find(e=>String(e.id||"")===d)||null,[d,A]),D=o.useMemo(()=>O&&A.find(e=>String(e.id||"")===O)||null,[A,O]),p=o.useMemo(()=>{var t;if(!P)return null;const e=F||fe(L||void 0);return ke({planProduct:e,forecastImport:((t=r.forecast)==null?void 0:t.forecastImport)||{},months:R,fallbackIndex:0})},[F,L,P,R,r.forecast]),G=o.useMemo(()=>{var U;if(!P)return null;const e=F||fe(L||void 0),t=String(e.baselineReferenceSku||"").trim(),s=Number(e.baselineReferenceMonth||0);if(!t||s<1||s>12)return null;const S=((U=r.forecast)==null?void 0:U.forecastImport)||{},m=Xe(S,t);if(!m)return null;const C=l((m.averagesByMonthNumber||{})[s]);return Number.isFinite(C)?{sku:t,baselineMonth:s,monthAverageUnits:C}:null},[F,L,P,r.forecast]);function oe(){I(null),g.setFieldsValue({alias:"",plannedSku:"",relationType:"standalone",categoryId:null,status:"active",baselineReferenceMonth:new Date().getMonth()+1,baselineUnitsInReferenceMonth:null,seasonalityReferenceSku:"",baselineReferenceSku:"",avgSellingPriceGrossEUR:null,sellerboardMarginPct:null,launchDate:ze(),rampUpWeeks:8,softLaunchStartSharePct:0}),b(!0)}function Y(e){I(String(e.id||"")),g.setFieldsValue(fe(e)),b(!0)}async function le(e){await w(t=>{const s=pe(t),S=Array.isArray(s.planProducts)?s.planProducts:[];return s.planProducts=S.filter(m=>String(m.id||"")!==e),s},"v2:plan-products:delete"),se.success("Plan-Produkt entfernt.")}async function ce(e){const t=String(e.alias||"").trim();if(!t)throw new Error("Alias ist erforderlich.");if(!e.seasonalityReferenceSku)throw new Error("Bitte Referenz-SKU für Saisonalität wählen.");const s=Number(e.baselineReferenceMonth||0);if(!Number.isFinite(s)||s<1||s>12)throw new Error("Referenzmonat muss zwischen 1 und 12 liegen.");const S=Number(e.baselineUnitsInReferenceMonth||0);if(!Number.isFinite(S)||S<=0)throw new Error("Baseline Units im Referenzmonat müssen > 0 sein.");const m=Number(e.avgSellingPriceGrossEUR||0);if(!Number.isFinite(m)||m<=0)throw new Error("Bitte einen gültigen Preis (EUR) für Revenue-Berechnung pflegen.");const C=Number(e.sellerboardMarginPct||0);if(!Number.isFinite(C)||C<=0||C>100)throw new Error("Bitte eine gültige Brutto-Marge (%) > 0 und <= 100 pflegen.");const U=Ye(e.launchDate);if(!U)throw new Error("Launch-Datum ist erforderlich.");const z=Math.round(Number(e.rampUpWeeks||0));if(!Number.isFinite(z)||z<=0)throw new Error("Ramp-up Wochen müssen größer als 0 sein.");const B=Number(e.softLaunchStartSharePct||0);if(!Number.isFinite(B)||B<0||B>100)throw new Error("Soft-Launch Start in % muss zwischen 0 und 100 liegen.");await w(de=>{var ye;const h=pe(de),E=Array.isArray(h.planProducts)?[...h.planProducts]:[],ne=t.toLowerCase();if(E.find(Z=>{const ve=Z;return String(ve.alias||"").trim().toLowerCase()===ne?d?String(ve.id||"")!==d:!0:!1}))throw new Error(`Alias "${t}" existiert bereits bei einem Plan-Produkt.`);const q=d||Me("plan"),be={id:q,alias:t,plannedSku:String(e.plannedSku||"").trim(),relationType:String(e.relationType||"standalone"),categoryId:e.categoryId||null,status:e.status||"active",baselineReferenceMonth:s,baselineUnitsInReferenceMonth:S,seasonalityReferenceSku:String(e.seasonalityReferenceSku||"").trim(),baselineReferenceSku:String(e.baselineReferenceSku||"").trim(),avgSellingPriceGrossEUR:m,sellerboardMarginPct:C,launchDate:U,rampUpWeeks:z,softLaunchStartSharePct:B,updatedAt:ie(),createdAt:d?String(((ye=E.find(Z=>String(Z.id||"")===d))==null?void 0:ye.createdAt)||ie()):ie()},xe=E.findIndex(Z=>String(Z.id||"")===q);return xe>=0?E[xe]=be:E.push(be),h.planProducts=E,h},d?"v2:plan-products:update":"v2:plan-products:create"),se.success(d?"Plan-Produkt aktualisiert.":"Plan-Produkt angelegt."),b(!1),I(null),g.resetFields()}function ue(e){const t=String(e.id||"").trim();if(!t)return;$(t);const s=String(e.plannedSku||"").trim();k(s),N(!0)}async function x(){const e=String(O||"").trim(),t=String(M||"").trim();if(!e)throw new Error("Plan-Produkt nicht gefunden.");if(!t)throw new Error("Bitte SKU für die Übernahme wählen.");if(!V.some(S=>S.value===t))throw new Error("Die gewählte SKU ist nicht in der Live-Produktdatenbank vorhanden.");await w(S=>{const m=pe(S),C=m,U=Array.isArray(m.planProducts)?[...m.planProducts]:[],z=U.findIndex(q=>String(q.id||"")===e);if(z<0)throw new Error("Plan-Produkt wurde nicht gefunden.");const B=C.forecast&&typeof C.forecast=="object"?C.forecast:{},de=B.forecastImport&&typeof B.forecastImport=="object"?B.forecastImport:{},h=ke({planProduct:U[z],forecastImport:de,months:R,fallbackIndex:z}),E=ie(),ne={id:Me("plan-map"),planProductId:String(h.id||e),planProductAlias:String(h.alias||""),sku:t,plannedSku:String(h.plannedSku||""),mappedAt:E,launchDate:String(h.launchDate||""),rampUpWeeks:Number(h.rampUpWeeks||0)||null,softLaunchStartSharePct:Number(h.softLaunchStartSharePct||0),baselineReferenceMonth:Number(h.baselineReferenceMonth||0)||null,baselineUnitsInReferenceMonth:Number(h.baselineUnitsInReferenceMonth||0)||null,seasonalityReferenceSku:String(h.seasonalityReferenceSku||""),months:[...h.months],planUnitsByMonth:{...h.unitsByMonth||{}},planRevenueByMonth:{...h.revenueByMonth||{}},source:"plan_product"},Se=Array.isArray(m.planProductMappings)?[...m.planProductMappings]:[];return m.planProductMappings=[...Se.filter(q=>String(q.planProductId||"")!==ne.planProductId),ne],U[z]={...U[z],status:"archived",plannedSku:t,mappedSku:t,mappedAt:E,archivedAt:E,updatedAt:E},m.planProducts=U,m},"v2:plan-products:takeover"),se.success(`Plan-Produkt wurde als Live-SKU ${t} übernommen und archiviert.`),N(!1),$(null),k(""),window.location.hash=`#/v2/products?source=plan-products&sku=${encodeURIComponent(t)}`}const j=o.useMemo(()=>A.map(e=>({...e,monthPreview:R.slice(0,3).map(t=>{var s;return`${re(t)}: ${v((s=e.unitsByMonth)==null?void 0:s[t],0)}`}).join(" · ")})),[R,A]);return n.jsxs("div",{className:"v2-page",children:[n.jsxs(he,{className:"v2-intro-card",children:[n.jsxs("div",{className:"v2-page-head",children:[n.jsxs("div",{children:[n.jsx(we,{level:3,children:"Neue Produkte (Plan-Produkte)"}),n.jsx(Re,{children:"Pre-SKU Produkte mit Referenzmonat-Baseline und übernommener Saisonalität aus bestehender SKU. Monats-Units werden automatisch über den Forecast-Horizont berechnet."})]}),n.jsx(H,{children:n.jsx(Q,{type:"primary",onClick:oe,children:"Plan-Produkt hinzufügen"})})]}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsxs(y,{color:"blue",children:["Plan-Produkte: ",A.length]}),n.jsxs(y,{color:"green",children:["Aktiv: ",A.filter(e=>String(e.status||"")==="active").length]}),n.jsxs(y,{children:["Horizont: ",R.length," Monate"]}),u?n.jsx(y,{color:"processing",children:"Speichern..."}):null,c?n.jsxs(y,{color:"green",children:["Gespeichert: ",new Date(c).toLocaleTimeString("de-DE")]}):null]})})]}),i?n.jsx(te,{type:"error",showIcon:!0,message:i}):null,a?n.jsx(te,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsx(he,{children:n.jsx(je,{rowKey:e=>String(e.id||e.key||""),size:"small",pagination:!1,dataSource:j,columns:[{title:"Alias",dataIndex:"alias",key:"alias",sorter:(e,t)=>String(e.alias||"").localeCompare(String(t.alias||""),"de-DE"),render:e=>n.jsxs(H,{size:6,children:[n.jsx(y,{color:"blue",children:"Plan"}),n.jsx(_,{strong:!0,children:e||"—"})]})},{title:"Pre-SKU",dataIndex:"plannedSku",key:"plannedSku",sorter:(e,t)=>String(e.plannedSku||"").localeCompare(String(t.plannedSku||""),"de-DE"),render:e=>e||n.jsx(_,{type:"secondary",children:"ohne SKU"})},{title:"Relation",dataIndex:"relationType",key:"relationType",sorter:(e,t)=>String(e.relationType||"").localeCompare(String(t.relationType||""),"de-DE"),render:e=>Ne[e]||e||"—"},{title:"Baseline",key:"baseline",sorter:(e,t)=>Number(l(e.baselineUnitsInReferenceMonth)||0)-Number(l(t.baselineUnitsInReferenceMonth)||0),render:(e,t)=>n.jsxs("span",{children:[ae(t.baselineReferenceMonth)," · ",v(t.baselineUnitsInReferenceMonth,0)," Units"]})},{title:"Saisonalität von",dataIndex:"seasonalityReferenceSku",key:"seasonalityReferenceSku",sorter:(e,t)=>String(e.seasonalityReferenceSku||"").localeCompare(String(t.seasonalityReferenceSku||""),"de-DE"),render:e=>e||"—"},{title:"Preis (EUR)",dataIndex:"avgSellingPriceGrossEUR",key:"avgSellingPriceGrossEUR",align:"right",sorter:(e,t)=>Number(l(e.avgSellingPriceGrossEUR)||0)-Number(l(t.avgSellingPriceGrossEUR)||0),render:e=>v(e,2)},{title:"Brutto-Marge %",dataIndex:"sellerboardMarginPct",key:"sellerboardMarginPct",align:"right",sorter:(e,t)=>Number(l(e.sellerboardMarginPct)||0)-Number(l(t.sellerboardMarginPct)||0),render:e=>v(e,2)},{title:"Launch & Ramp",key:"launchRamp",sorter:(e,t)=>String(e.launchDate||"").localeCompare(String(t.launchDate||"")),render:(e,t)=>n.jsxs("span",{children:[String(t.launchDate||"—")," · ",v(l(t.rampUpWeeks),0),"W · Start ",v(l(t.softLaunchStartSharePct),0),"%"]})},{title:"Vorschau (Next 3)",dataIndex:"monthPreview",key:"monthPreview",sorter:(e,t)=>String(e.monthPreview||"").localeCompare(String(t.monthPreview||""),"de-DE")},{title:"Status",dataIndex:"status",key:"status",sorter:(e,t)=>String(e.status||"").localeCompare(String(t.status||""),"de-DE"),render:(e,t)=>{if(e==="archived"){const s=String(t.mappedSku||t.plannedSku||"");return n.jsxs(H,{direction:"vertical",size:2,children:[n.jsx(y,{children:"Archiviert"}),s?n.jsxs(_,{type:"secondary",children:["Live-SKU: ",s]}):null]})}return e==="draft"?n.jsx(y,{color:"gold",children:"Draft"}):n.jsx(y,{color:"green",children:"Aktiv"})}},{title:"Aktionen",key:"actions",render:(e,t)=>n.jsxs(H,{size:6,children:[n.jsx(Q,{size:"small",onClick:()=>Y(t),children:"Bearbeiten"}),n.jsx(Q,{size:"small",type:"primary",ghost:!0,onClick:()=>ue(t),disabled:String(t.status||"")==="archived",children:"Als gelauncht markieren"}),n.jsx(Fe,{title:"Plan-Produkt löschen?",onConfirm:()=>{le(String(t.id||""))},children:n.jsx(Q,{size:"small",danger:!0,children:"Löschen"})})]})}],locale:{emptyText:"Noch keine Plan-Produkte angelegt."}})}),n.jsxs(Pe,{title:d?"Plan-Produkt bearbeiten":"Plan-Produkt anlegen",rootClassName:"v2-form-modal",open:P,onCancel:()=>{b(!1),I(null),g.resetFields()},onOk:()=>{g.validateFields().then(e=>ce(e)).catch(()=>{})},width:980,children:[n.jsxs(f,{form:g,layout:"vertical",children:[n.jsxs("div",{className:"v2-form-row",children:[n.jsx(f.Item,{name:"alias",label:"Alias",rules:[{required:!0,message:"Alias ist erforderlich."}],children:n.jsx(me,{placeholder:"z. B. Messerblock Premium"})}),n.jsx(f.Item,{name:"plannedSku",label:"Planned SKU (optional)",children:n.jsx(me,{placeholder:"optional, falls intern bereits vergeben"})}),n.jsx(f.Item,{name:"status",label:"Status",initialValue:"active",children:n.jsx(K,{options:[{value:"active",label:"Aktiv"},{value:"draft",label:"Draft"},{value:"archived",label:"Archiviert"}]})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(f.Item,{name:"relationType",label:"Relation",rules:[{required:!0}],children:n.jsx(K,{options:Ee.map(e=>({value:e,label:Ne[e]||e}))})}),n.jsx(f.Item,{name:"categoryId",label:"Kategorie",children:n.jsx(K,{allowClear:!0,options:ee.map(e=>({value:e.id,label:e.name}))})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(f.Item,{name:"avgSellingPriceGrossEUR",label:"Preis (EUR) für Revenue",rules:[{required:!0,message:"Preis ist erforderlich."}],children:n.jsx(J,{mode:"decimal",min:0})}),n.jsx(f.Item,{name:"sellerboardMarginPct",label:"Brutto-Marge (%)",rules:[{required:!0,message:"Marge ist erforderlich."},{validator:(e,t)=>{const s=Number(t);return Number.isFinite(s)&&s>0&&s<=100?Promise.resolve():Promise.reject(new Error("Marge muss > 0 und <= 100 sein."))}}],children:n.jsx(J,{mode:"percent",min:0,max:100})})]}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(f.Item,{name:"baselineReferenceMonth",label:"Referenzmonat",rules:[{required:!0,message:"Referenzmonat ist erforderlich."}],children:n.jsx(K,{options:Array.from({length:12},(e,t)=>({value:t+1,label:`${ae(t+1)} (${t+1})`}))})}),n.jsx(f.Item,{name:"baselineUnitsInReferenceMonth",label:"Baseline Units im Referenzmonat",rules:[{required:!0,message:"Baseline Units sind erforderlich."}],children:n.jsx(J,{mode:"int",min:0})}),n.jsx(f.Item,{name:"seasonalityReferenceSku",label:"Saisonalität übernehmen von SKU",rules:[{required:!0,message:"Referenz-SKU ist erforderlich."}],children:n.jsx(K,{showSearch:!0,optionFilterProp:"label",options:V})})]}),n.jsx("div",{className:"v2-form-row",children:n.jsx(f.Item,{name:"baselineReferenceSku",label:"Baseline-Referenz-SKU (optional)",children:n.jsx(K,{allowClear:!0,showSearch:!0,optionFilterProp:"label",options:V})})}),n.jsxs("div",{className:"v2-form-row",children:[n.jsx(f.Item,{name:"launchDate",label:"Launch-Datum",rules:[{required:!0,message:"Launch-Datum ist erforderlich."}],children:n.jsx(me,{type:"date"})}),n.jsx(f.Item,{name:"rampUpWeeks",label:"Ramp-up (Wochen)",rules:[{required:!0,message:"Ramp-up Wochen sind erforderlich."}],children:n.jsx(J,{mode:"int",min:1})}),n.jsx(f.Item,{name:"softLaunchStartSharePct",label:"Soft-Launch Start (%)",extra:"Startniveau am Launch-Tag. 0 = Start bei 0 %, 20 = Start bei 20 %.",children:n.jsx(J,{mode:"percent",min:0,max:100})})]})]}),n.jsxs(he,{size:"small",children:[n.jsx(we,{level:5,children:"Forecast-Vorschau (berechnet)"}),n.jsx(Re,{type:"secondary",children:"Monatswerte werden aus Baseline im Referenzmonat, dem Saisonalitätsprofil der gewählten Referenz-SKU und einer taggenauen Launch-/Ramp-Aggregation berechnet."}),p!=null&&p.seasonality?n.jsxs(n.Fragment,{children:[n.jsxs(H,{wrap:!0,style:{marginBottom:8},children:[n.jsxs(y,{color:"blue",children:["Baseline: ",ae(p.baselineReferenceMonth)," · ",v(p.baselineUnitsInReferenceMonth,0)," Units"]}),n.jsxs(y,{color:"green",children:["Referenz-SKU: ",p.seasonalityReferenceSku]}),n.jsxs(y,{color:"purple",children:["Launch: ",String(p.launchDate||"—")," · Ramp: ",v(l(p.rampUpWeeks),0),"W · Start: ",v(l(p.softLaunchStartSharePct),0),"%"]}),n.jsxs(y,{children:["Zeitraum: ",re(p.seasonality.startMonth)," bis ",re(p.seasonality.endMonth)]}),G?n.jsxs(y,{color:"purple",children:["Orientierung: ",G.sku," hat in ",ae(G.baselineMonth)," im Schnitt ",v(G.monthAverageUnits,0)," Units"]}):null]}),n.jsx(je,{size:"small",pagination:!1,rowKey:e=>String(e.month||""),dataSource:R.map(e=>{var t,s,S,m;return{month:e,baseUnits:(t=p.baseUnitsByMonth)==null?void 0:t[e],rampFactor:(s=p.rampFactorByMonth)==null?void 0:s[e],units:(S=p.unitsByMonth)==null?void 0:S[e],revenue:(m=p.revenueByMonth)==null?void 0:m[e]}}),columns:[{title:"Monat",dataIndex:"month",key:"month",sorter:(e,t)=>String(e.month||"").localeCompare(String(t.month||"")),render:e=>re(e)},{title:"Base Units",dataIndex:"baseUnits",key:"baseUnits",align:"right",sorter:(e,t)=>Number(l(e.baseUnits)||0)-Number(l(t.baseUnits)||0),render:e=>v(l(e),2)},{title:"Ramp-Faktor",dataIndex:"rampFactor",key:"rampFactor",align:"right",sorter:(e,t)=>Number(l(e.rampFactor)||0)-Number(l(t.rampFactor)||0),render:e=>v(l(e),2)},{title:"Units (Plan)",dataIndex:"units",key:"units",align:"right",sorter:(e,t)=>Number(l(e.units)||0)-Number(l(t.units)||0),render:e=>v(e,0)},{title:"Revenue (Plan)",dataIndex:"revenue",key:"revenue",align:"right",sorter:(e,t)=>Number(l(e.revenue)||0)-Number(l(t.revenue)||0),render:e=>v(e,2)}]})]}):n.jsx(te,{type:"warning",showIcon:!0,message:"Saisonalitätsprofil noch nicht ableitbar",description:"Für die gewählte Referenz-SKU liegen noch keine verwertbaren Forecast-Monatswerte vor."})]})]}),n.jsx(Pe,{title:"Plan-Produkt in Live-SKU übernehmen",open:T,onCancel:()=>{N(!1),$(null),k("")},onOk:()=>{x().catch(e=>{se.error(e instanceof Error?e.message:String(e))})},children:n.jsxs(H,{direction:"vertical",style:{width:"100%"},children:[n.jsx(te,{type:"info",showIcon:!0,message:"Plan wird archiviert, Mapping bleibt für Plan-vs-Ist erhalten.",description:"Nach der Übernahme zählt im operativen Forecast/Cashflow nur noch die Live-SKU (CSV)."}),n.jsxs("div",{children:[n.jsx(_,{strong:!0,children:"Plan-Produkt: "}),n.jsx(_,{children:(D==null?void 0:D.alias)||"—"})]}),n.jsxs("div",{children:[n.jsx(_,{strong:!0,children:"Aktueller Status: "}),n.jsx(_,{children:(D==null?void 0:D.status)||"—"})]}),n.jsx(K,{value:M||void 0,showSearch:!0,optionFilterProp:"label",placeholder:"Live-SKU auswählen",options:V,onChange:e=>k(String(e||""))})]})})]})}export{In as default};
