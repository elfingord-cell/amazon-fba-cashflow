function b(o){return String(o||"").trim()}function w(o){const t=Number(o);return Number.isFinite(t)?t:0}function A(o){const t=Math.abs(w(o.amount));return String(o.direction||"").toLowerCase()==="out"?-t:t}function h(o){const t=String(o.source||"").toLowerCase();return t==="po"?"po":t==="fo"?"fo":t==="sales"?"sales":t==="fixcosts"?"fixcosts":t==="extras"?"extras":t==="dividends"?"dividends":t==="vat"?"vat":"unknown"}function k(o){const t=String(o.source||"").toLowerCase(),u=String(o.kind||"").toLowerCase(),e=String(o.group||"").toLowerCase();return t==="po"||t==="fo"?"po_fo":t==="sales"?"inflow":t==="fixcosts"||e==="fixkosten"?"fixcost":u.includes("duty")||u.includes("eust")||u.includes("vat")||e.includes("import")?"tax":String(o.direction||"").toLowerCase()==="in"?"inflow":String(o.direction||"").toLowerCase()==="out"?"outflow":"other"}function v(o){const t=Array.isArray(o.products)?o.products:[],u=new Map;t.forEach(n=>{const s=b(n.sku);if(!s)return;const r=String(n.alias||"").trim()||s;u.set(s,r)});const e=new Map,l=(n,s)=>{const r=(n==="po"?[s.poNo,s.id]:[s.foNo,s.foNumber,s.id]).map(i=>String(i||"").trim()).filter(Boolean);if(!r.length)return;const a=Array.isArray(s.items)&&s.items.length?s.items:[{sku:s.sku,units:s.units}],f=new Set;let c=0;a.forEach(i=>{const d=b(i.sku);if(!d)return;f.add(u.get(d)||d);const p=w(i.units??i.qty??i.quantity);c+=p});const m={aliases:Array.from(f),units:Number.isFinite(c)?c:null};Array.from(new Set(r)).forEach(i=>{e.set(`${n}:${i}`,m)})};return(Array.isArray(o.pos)?o.pos:[]).forEach(n=>l("po",n)),(Array.isArray(o.fos)?o.fos:[]).forEach(n=>l("fo",n)),e}function x(o){const t=new Map,u=v(o.state);return(Array.isArray(o.breakdown)?o.breakdown:[]).forEach(e=>{const l=String(e.month||"").trim();if(!l)return;const s=(Array.isArray(e.entries)?e.entries:[]).map(r=>{var S;const a=h(r),f=r.sourceNumber?String(r.sourceNumber):void 0,c=r.sourceId?String(r.sourceId):void 0,m=r.meta&&typeof r.meta=="object"?r.meta:{},i=a==="fo"&&(m.phantom===!0||(c?((S=o.provisionalFoIds)==null?void 0:S.has(c))===!0:!1)),d=r.provisional===!0||i,p=f&&(a==="po"||a==="fo")?`${a}:${f}`:null,g=p?u.get(p):null;return{month:l,group:k(r),label:String(r.label||"Eintrag"),amount:A(r),provisional:d,paid:typeof r.paid=="boolean"?r.paid:null,source:a,sourceNumber:f,sourceId:c,tooltipMeta:g?{aliases:g.aliases,units:g.units,milestone:String(r.label||""),dueDate:r.date?String(r.date):null}:void 0}});t.set(l,s)}),t}export{x as b};
