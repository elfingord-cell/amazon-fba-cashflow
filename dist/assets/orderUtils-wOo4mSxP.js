import{p as v}from"./index-CLY33OwN.js";import{g as K,b as X,c as J,f as Q}from"./foSuggestion-DyBAXRuI.js";const Z=["DRAFT","ACTIVE","CONVERTED","ARCHIVED"],tt={PLANNED:"ACTIVE",CANCELLED:"ARCHIVED"},vt=["SEA","RAIL","AIR"],Tt=["EXW","DDP","FCA"],et=["ORDER_DATE","PRODUCTION_END","ETD","ETA","DELIVERY"],nt=["EUR","USD","CNY"],Rt=["ORDER_DATE","PROD_DONE","ETD","ETA"];function G(t,e="DRAFT"){const n=String(t||"").trim().toUpperCase();return n?Z.includes(n)?n:tt[n]||e:e}function H(t){const e=G(t);return e==="DRAFT"||e==="ACTIVE"}function Pt(t){return H(t)}function rt(t,e){const n=Array.isArray(e)?e:[];if(!n.length)return t;const o=new Map(n.map(s=>[String((s==null?void 0:s.id)||""),s]));return t.map(s=>{const r=o.get(String(s.id||""));return r?{...s,dueDate:r.dueDateManuallySet?String(r.dueDate||s.dueDate||""):s.dueDate,dueDateManuallySet:r.dueDateManuallySet===!0?!0:s.dueDateManuallySet,isOverridden:r.isOverridden===!0?!0:s.isOverridden}:s})}function h(t,e=0){const n=v(t);return Number.isFinite(n)?Number(n):e}function S(t){const e=v(t);if(!Number.isFinite(e))return null;const n=Number(e);return n<=0?null:n}function u(t,e=0){return Math.max(0,h(t,e))}function P(t){return t==null?null:String(t).trim()||null}function E(t){if(!t)return null;const[e,n,o]=String(t).split("-").map(Number);if(!e||!n||!o)return null;const s=new Date(Date.UTC(e,n-1,o));return Number.isNaN(s.getTime())?null:s}function m(t){return!(t instanceof Date)||Number.isNaN(t.getTime())?null:t.toISOString().slice(0,10)}function p(t,e){const n=new Date(t.getTime());return n.setUTCDate(n.getUTCDate()+Number(e||0)),n}function st(t,e){const n=new Date(t.getTime());return n.setUTCMonth(n.getUTCMonth()+Number(e||0)),n}function U(t){return t==="PRODUCTION_END"?"PROD_DONE":t==="DELIVERY"?"ETA":t}function W(t){return Q.monthKey(t)}function R(t){const e=String(t||"").trim().toUpperCase();return et.includes(e)?e:"ORDER_DATE"}function C(t,e="EUR"){const n=String(t||e).trim().toUpperCase();return nt.includes(n)?n:e}function F(){return[{label:"Deposit",percent:30,triggerEvent:"ORDER_DATE",offsetDays:0,offsetMonths:0},{label:"Balance",percent:70,triggerEvent:"ETD",offsetDays:0,offsetMonths:0}]}function ot(t,e=0){const n=v(t);return Number.isFinite(n)?Math.round(Number(n)):e}function at(t){const e={freight:{triggerEvent:"ETD",offsetDays:0},duty:{triggerEvent:"ETA",offsetDays:0},eust:{triggerEvent:"ETA",offsetDays:0},eustRefund:{triggerEvent:"ETA",offsetDays:0}},n=t&&typeof t=="object"?t:{},o=n.fo&&typeof n.fo=="object"?n.fo:{},s=(r,c)=>{const a=o[r]&&typeof o[r]=="object"?o[r]:{};return{triggerEvent:R(a.triggerEvent??c.triggerEvent),offsetDays:ot(a.offsetDays,c.offsetDays)}};return{freight:s("freight",e.freight),duty:s("duty",e.duty),eust:s("eust",e.eust),eustRefund:s("eustRefund",e.eustRefund)}}function ut(t){const e={ORDER_DATE:E(t.orderDate),PRODUCTION_END:E(t.productionEndDate),ETD:E(t.etdDate),ETA:E(t.etaDate),DELIVERY:E(t.deliveryDate)};return!e.ETD&&e.ETA&&Number.isFinite(Number(t.logisticsLeadTimeDays))&&(e.ETD=p(e.ETA,-Number(t.logisticsLeadTimeDays||0))),e}function A(t,e,n,o){const s=o[t]||null;if(!s)return null;let r=p(s,Number(e||0));return n&&(r=st(r,Number(n||0))),m(r)}function T(t){return`${t}-${Math.random().toString(36).slice(2,9)}`}function N(){return new Date().toISOString()}function it(t){const e=new Date,n=t instanceof Date?t:typeof t=="string"||typeof t=="number"?new Date(t):null;return n instanceof Date&&!Number.isNaN(n.getTime())?String(n.getFullYear()).slice(-2):String(e.getFullYear()).slice(-2)}function ct(t,e){const n=String(t||"").trim().toUpperCase();if(!n)return null;const o=n.replace(/[\s_-]+/g,""),s=o.startsWith("FO")?o.slice(2):o;if(!/^\d+$/.test(s)||!s.startsWith(e))return null;const r=s.slice(e.length);if(!r)return null;const c=Number(r);return!Number.isFinite(c)||c<=0?null:c}function At(t,e){const n=it(e);let o=0;(t||[]).forEach(c=>{const a=c||{};[a.foNo,a.foNumber,a.id].forEach(i=>{const D=ct(i,n);D!=null&&D>o&&(o=D)})});const s=String(o+1).padStart(3,"0"),r=`${n}${s}`;return{foNo:r,foNumber:`FO${r}`}}function b(t,e,n){const o=h(t,0);if(String(e||"EUR").toUpperCase()==="EUR")return o;const r=u(n,0);return r?o/r:o}function Nt(t){const e=E(t.targetDeliveryDate),n=u(t.productionLeadTimeDays,0),o=u(t.logisticsLeadTimeDays,0),s=u(t.bufferDays,0);if(!e||n<=0)return{orderDate:null,productionEndDate:null,etdDate:null,etaDate:null,deliveryDate:e?m(e):null,logisticsLeadTimeDays:o};const r=p(e,-(n+o+s)),c=p(r,n),a=c,i=p(a,o);return{orderDate:m(r),productionEndDate:m(c),etdDate:m(a),etaDate:m(i),deliveryDate:m(e),logisticsLeadTimeDays:o}}function dt(t){const e=E(t.orderDate),n=u(t.productionLeadTimeDays,0),o=u(t.logisticsLeadTimeDays,0),s=u(t.bufferDays,0);if(!e)return{orderDate:null,productionEndDate:null,etdDate:null,etaDate:null,deliveryDate:t.deliveryDate?String(t.deliveryDate):null,logisticsLeadTimeDays:o};const r=p(e,n+s),c=r,a=p(c,o);return{orderDate:m(e),productionEndDate:m(r),etdDate:m(c),etaDate:m(a),deliveryDate:t.deliveryDate?String(t.deliveryDate):null,logisticsLeadTimeDays:o}}function Y(t){const e=t||{},n=String(e.sku||"").trim();if(!n)return null;const o=Math.max(0,Math.round(h(e.units,0))),s=u(e.unitCostUsd,0),r=u(e.unitExtraUsd,0),c=u(e.extraFlatUsd,0),a=Math.max(0,Math.round(S(e.prodDays)??u(e.productionLeadTimeDays,0))),i=Math.max(0,Math.round(S(e.transitDays)??u(e.logisticsLeadTimeDays,0))),D=u(e.freightEur,0);return{id:String(e.id||T("poi")),sku:n,units:o,unitCostUsd:s,unitExtraUsd:r,extraFlatUsd:c,prodDays:a,transitDays:i,freightEur:D}}function ft(t,e){const n=Array.isArray(t)?t.map(Y).filter(Boolean):[];if(n.length)return n;const o=String((e==null?void 0:e.sku)||"").trim();if(!o)return[];const s=Y({id:String((e==null?void 0:e.id)||T("poi")),sku:o,units:e==null?void 0:e.units,unitCostUsd:e==null?void 0:e.unitCostUsd,unitExtraUsd:e==null?void 0:e.unitExtraUsd,extraFlatUsd:e==null?void 0:e.extraFlatUsd,prodDays:e==null?void 0:e.prodDays,transitDays:e==null?void 0:e.transitDays,freightEur:e==null?void 0:e.freightEur});return s?[s]:[]}function bt(t){var g;const e=ft(t.items,t.fallback);let n=0,o=0,s=0,r=0,c=0;const a=E(t.orderDate);let i=null,D=null;e.forEach(l=>{const d=l.units*(l.unitCostUsd+l.unitExtraUsd)+l.extraFlatUsd;if(n+=d,o+=l.freightEur,s+=l.units,r=Math.max(r,l.prodDays),c=Math.max(c,l.transitDays),a){const f=p(a,l.prodDays+l.transitDays);(!i||f<i)&&(i=f),(!D||f>D)&&(D=f)}});const y=dt({orderDate:t.orderDate,productionLeadTimeDays:r,logisticsLeadTimeDays:c,bufferDays:0});return{items:e,goodsUsd:n,goodsEur:b(n,"USD",t.fxRate),freightEur:o,units:s,prodDays:r,transitDays:c,firstSku:((g=e[0])==null?void 0:g.sku)||"",minEtaDate:m(i),maxEtaDate:m(D),schedule:y}}function Ct(t){return lt([],t).map((n,o)=>({id:String(n.id||`ms-${o+1}-${Math.random().toString(36).slice(2,8)}`),label:String(n.label||"Milestone"),percent:u(n.percent,0),anchor:U(R(n.triggerEvent)),lagDays:h(n.offsetDays,0)}))}function Dt(t){const e=u(t.units,0),n=u(t.unitPrice,0),o=e*n,s=b(o,t.currency,t.fxRate),r=u(t.freight,0),c=b(r,t.freightCurrency,t.fxRate),a=u(t.dutyRatePct,0),i=u(t.eustRatePct,0),D=s*(a/100),y=(s+D+c)*(i/100),g=s+c+D+y;return{supplierCost:o,supplierCostEur:s,freightAmount:r,freightEur:c,dutyAmountEur:D,eustAmountEur:y,landedCostEur:g}}function lt(t,e){const n=Array.isArray(t)?t.filter(s=>String((s==null?void 0:s.category)||"supplier")==="supplier"):[];if(n.length)return n.map(s=>({id:s.id?String(s.id):void 0,label:String(s.label||"Milestone"),percent:u(s.percent,0),triggerEvent:R(s.triggerEvent),offsetDays:h(s.offsetDays,0),offsetMonths:h(s.offsetMonths,0)}));const o=Array.isArray(e==null?void 0:e.paymentTermsDefault)?e==null?void 0:e.paymentTermsDefault:[];return o.length?o.map(s=>({id:s.id?String(s.id):void 0,label:String(s.label||"Milestone"),percent:u(s.percent,0),triggerEvent:R(s.triggerEvent),offsetDays:h(s.offsetDays,0),offsetMonths:h(s.offsetMonths,0)})):F()}function gt(t){const e=Dt(t),n=ut(t.schedule),o=u(t.unitPrice,0)*u(t.units,0),s=(t.supplierTerms||[]).map((g,l)=>{const d=R(g.triggerEvent),f=h(g.offsetDays,0),M=h(g.offsetMonths,0);return{id:g.id||`supplier-${l}`,label:String(g.label||"Milestone"),percent:u(g.percent,0),amount:o*(u(g.percent,0)/100),currency:C(t.currency,"EUR"),triggerEvent:d,offsetDays:f,offsetMonths:M,dueDate:A(d,f,M,n),isOverridden:!1,dueDateManuallySet:!1,category:"supplier"}}),r=String(t.incoterm||"EXW").toUpperCase(),c=Math.max(0,Math.round(u(t.vatRefundLagMonths,2))),a=at(t.paymentDueDefaults),i=[...s];r!=="DDP"&&e.freightAmount>0&&i.push({id:"auto-freight",label:"Fracht",percent:0,amount:e.freightAmount,currency:C(t.freightCurrency,"EUR"),triggerEvent:a.freight.triggerEvent,offsetDays:a.freight.offsetDays,offsetMonths:0,dueDate:A(a.freight.triggerEvent,a.freight.offsetDays,0,n),category:"freight",isOverridden:!1,dueDateManuallySet:!1});const D=u(t.dutyRatePct,0);r!=="DDP"&&D>0&&i.push({id:"auto-duty",label:"Duty",percent:D,amount:e.dutyAmountEur,currency:"EUR",triggerEvent:a.duty.triggerEvent,offsetDays:a.duty.offsetDays,offsetMonths:0,dueDate:A(a.duty.triggerEvent,a.duty.offsetDays,0,n),category:"duty",isOverridden:!1,dueDateManuallySet:!1});const y=u(t.eustRatePct,0);return r!=="DDP"&&y>0&&(i.push({id:"auto-eust",label:"EUSt",percent:y,amount:e.eustAmountEur,currency:"EUR",triggerEvent:a.eust.triggerEvent,offsetDays:a.eust.offsetDays,offsetMonths:0,dueDate:A(a.eust.triggerEvent,a.eust.offsetDays,0,n),category:"eust",isOverridden:!1,dueDateManuallySet:!1}),i.push({id:"auto-eust-refund",label:"EUSt Erstattung",percent:y,amount:-e.eustAmountEur,currency:"EUR",triggerEvent:a.eustRefund.triggerEvent,offsetDays:a.eustRefund.offsetDays,offsetMonths:c,dueDate:A(a.eustRefund.triggerEvent,a.eustRefund.offsetDays,c,n),category:"eust_refund",isOverridden:!1,dueDateManuallySet:!1})),rt(i,t.existingPayments)}function Ut(t){return Math.round((t||[]).reduce((e,n)=>e+u(n.percent,0),0)*100)/100}function Ft(t){const e=N(),n=t.values||{},o=t.schedule,s=t.supplierTerms||[],r=t.existing||null,c=gt({supplierTerms:s,schedule:o,unitPrice:n.unitPrice,units:n.units,currency:n.currency,freight:n.freight,freightCurrency:n.freightCurrency,dutyRatePct:n.dutyRatePct,eustRatePct:n.eustRatePct,fxRate:n.fxRate,incoterm:n.incoterm,vatRefundLagMonths:t.vatRefundLagMonths,paymentDueDefaults:t.paymentDueDefaults,existingPayments:r==null?void 0:r.payments});return{...r||{},id:String(n.id||(r==null?void 0:r.id)||T("fo")),sku:String(n.sku||""),supplierId:String(n.supplierId||""),targetDeliveryDate:n.targetDeliveryDate?String(n.targetDeliveryDate):null,units:u(n.units,0),transportMode:String(n.transportMode||"SEA").toUpperCase(),incoterm:String(n.incoterm||"EXW").toUpperCase(),unitPrice:u(n.unitPrice,0),unitPriceIsOverridden:!!n.unitPriceIsOverridden,currency:C(n.currency,"EUR"),freight:u(n.freight,0),freightCurrency:C(n.freightCurrency,"EUR"),dutyRatePct:u(n.dutyRatePct,0),eustRatePct:u(n.eustRatePct,0),fxRate:u(n.fxRate,0),productionLeadTimeDays:u(n.productionLeadTimeDays,0),productionLeadTimeDaysManual:u(n.productionLeadTimeDaysManual,0),productionLeadTimeSource:n.productionLeadTimeSource||null,logisticsLeadTimeDays:u(n.logisticsLeadTimeDays,0),bufferDays:u(n.bufferDays,0),orderDate:o.orderDate,productionEndDate:o.productionEndDate,etdDate:o.etdDate,etaDate:o.etaDate,deliveryDate:o.deliveryDate,payments:c,status:G(n.status,"DRAFT"),convertedPoId:n.convertedPoId||(r==null?void 0:r.convertedPoId)||null,convertedPoNo:n.convertedPoNo||(r==null?void 0:r.convertedPoNo)||null,forecastBasisVersionId:P(n.forecastBasisVersionId??(r==null?void 0:r.forecastBasisVersionId)),forecastBasisVersionName:P(n.forecastBasisVersionName??(r==null?void 0:r.forecastBasisVersionName)),forecastBasisSetAt:P(n.forecastBasisSetAt??(r==null?void 0:r.forecastBasisSetAt)),forecastConflictState:P(n.forecastConflictState??(r==null?void 0:r.forecastConflictState)),supersedesFoId:P(n.supersedesFoId??(r==null?void 0:r.supersedesFoId)),supersededByFoId:P(n.supersededByFoId??(r==null?void 0:r.supersededByFoId)),createdAt:(r==null?void 0:r.createdAt)||e,updatedAt:e}}function It(t){const e=t.fo||{},n=String(t.poNumber||"").trim(),o=u(e.fxRate,0),s=b(e.freight,e.freightCurrency,o),r=u(e.productionLeadTimeDays,0),c=u(e.bufferDays,0),a=u(e.logisticsLeadTimeDays,0),i=r+c,D=Array.isArray(e.payments)?e.payments.filter(f=>String((f==null?void 0:f.category)||"")==="supplier"):[],y=D.length?D:F(),g=t.orderDateOverride||e.orderDate||null,l=E(g)?String(g):null;return{id:T("po"),poNo:n,sku:String(e.sku||""),supplierId:String(e.supplierId||""),units:u(e.units,0),unitCostUsd:u(e.unitPrice,0),unitExtraUsd:0,extraFlatUsd:0,orderDate:l,prodDays:i,transitDays:a,transport:String(e.transportMode||"SEA").toLowerCase(),freightEur:s,dutyRatePct:u(e.dutyRatePct,0),eustRatePct:u(e.eustRatePct,0),fxOverride:o||null,ddp:String(e.incoterm||"").toUpperCase()==="DDP",milestones:y.map(f=>({id:String(f.id||T("ms")),label:String(f.label||"Milestone"),percent:u(f.percent,0),anchor:U(R(f.triggerEvent)),lagDays:h(f.offsetDays,0)})),sourceFoIds:[String(e.id||"")].filter(Boolean),createdAt:N(),updatedAt:N()}}function yt(t){const e=E(t.orderDateOverride);if(e)return m(e);const n=E(t.targetDeliveryDate);if(n){const s=Math.max(0,Math.round(Number(t.maxProdDays||0)+Number(t.maxTransitDays||0)));return m(p(n,-s))}const o=E(t.fallbackOrderDate);return o?m(o):null}function mt(t){const e=u(t.productionLeadTimeDays,0),n=u(t.bufferDays,0);return{id:T("poi"),sku:String(t.sku||"").trim(),units:u(t.units,0),unitCostUsd:u(t.unitPrice,0),unitExtraUsd:0,extraFlatUsd:0,prodDays:Math.max(0,Math.round(e+n)),transitDays:Math.max(0,Math.round(u(t.logisticsLeadTimeDays,0))),freightEur:b(t.freight,t.freightCurrency,t.fxRate)}}function Ot(t){const e=Array.isArray(t.fos)?t.fos.filter(Boolean):[];if(!e.length)throw new Error("Keine FOs fuer Merge vorhanden.");const n=e[0];if(Array.from(new Set(e.map(d=>String((d==null?void 0:d.supplierId)||"").trim()).filter(Boolean))).length>1)throw new Error("FO-Merge erlaubt nur einen gemeinsamen Lieferanten.");const s=String(t.poNumber||"").trim(),r=e.map(d=>mt(d)),c=r.reduce((d,f)=>Math.max(d,Number(f.prodDays||0)),0),a=r.reduce((d,f)=>Math.max(d,Number(f.transitDays||0)),0),i=yt({orderDateOverride:t.orderDateOverride,targetDeliveryDate:t.targetDeliveryDate,maxProdDays:c,maxTransitDays:a,fallbackOrderDate:String(n.orderDate||"")}),D=Array.isArray(n.payments)?n.payments.filter(d=>String((d==null?void 0:d.category)||"")==="supplier"):[],y=D.length?D:F(),g=r.reduce((d,f)=>d+Number(f.units||0),0),l=r.reduce((d,f)=>d+Number(f.freightEur||0),0);return{id:T("po"),poNo:s,supplierId:String(n.supplierId||""),sku:String(n.sku||""),items:r,units:Math.max(0,Math.round(g)),unitCostUsd:u(n.unitPrice,0),unitExtraUsd:0,extraFlatUsd:0,orderDate:i,prodDays:c,transitDays:a,transport:String(n.transportMode||"SEA").toLowerCase(),freightEur:Math.max(0,Math.round(l*100)/100),dutyRatePct:u(n.dutyRatePct,0),eustRatePct:u(n.eustRatePct,0),fxOverride:u(n.fxRate,0)||null,ddp:String(n.incoterm||"").toUpperCase()==="DDP",etaManual:E(t.targetDeliveryDate)?String(t.targetDeliveryDate):null,milestones:y.map(d=>({id:String(d.id||T("ms")),label:String(d.label||"Milestone"),percent:u(d.percent,0),anchor:U(R(d.triggerEvent)),lagDays:h(d.offsetDays,0)})),sourceFoIds:e.map(d=>String(d.id||"")).filter(Boolean),createdAt:N(),updatedAt:N()}}function Et(t){var r,c;const e=((r=t==null?void 0:t.forecast)==null?void 0:r.forecastManual)||{},n=((c=t==null?void 0:t.forecast)==null?void 0:c.forecastImport)||{},o={},s=a=>{const i=String(a||"").trim();if(!i)return;o[i]||(o[i]={});const D=e[i]||{},y=n[i]||{};new Set([...Object.keys(y),...Object.keys(D)]).forEach(l=>{var M;const d=v(D[l]);if(Number.isFinite(d)){o[i][l]=Number(d);return}const f=v((M=y[l])==null?void 0:M.units);Number.isFinite(f)&&(o[i][l]=Number(f))})};return Object.keys(n).forEach(s),Object.keys(e).forEach(s),o}function ht(t){var o;const e={};return(((o=t==null?void 0:t.inventory)==null?void 0:o.snapshots)||[]).forEach(s=>{const r=String((s==null?void 0:s.month)||"");if(!r)return;(Array.isArray(s.items)?s.items:[]).forEach(a=>{const i=String((a==null?void 0:a.sku)||"").trim();if(!i)return;e[i]||(e[i]={});const D=v(a==null?void 0:a.amazonUnits),y=v(a==null?void 0:a.threePLUnits),g=v(a==null?void 0:a.units);if(Number.isFinite(D)||Number.isFinite(y)){const d=Number.isFinite(D)?Math.max(0,Number(D)):0,f=Number.isFinite(y)?Math.max(0,Number(y)):0;e[i][r]=d+f;return}e[i][r]=Number.isFinite(g)?Math.max(0,Number(g)):0})}),e}function w(t){const e=(t==null?void 0:t.arrivalDateDe)||(t==null?void 0:t.arrivalDate)||(t==null?void 0:t.etaDate)||(t==null?void 0:t.etaManual)||(t==null?void 0:t.eta);if(e)return E(e);const n=E(t==null?void 0:t.orderDate);if(!n)return null;const o=u((t==null?void 0:t.prodDays)??(t==null?void 0:t.productionLeadTimeDays),0),s=u((t==null?void 0:t.transitDays)??(t==null?void 0:t.logisticsLeadTimeDays),0);return p(n,o+s)}function $(t){if(Array.isArray(t==null?void 0:t.items)&&t.items.length>0)return t.items.map(n=>({sku:String((n==null?void 0:n.sku)||"").trim(),units:u(n==null?void 0:n.units,0)}));const e=String((t==null?void 0:t.sku)||"").trim();return e?[{sku:e,units:u(t==null?void 0:t.units,0)}]:[]}function St(t){const e={};let n=0;return(Array.isArray(t==null?void 0:t.pos)?t.pos:[]).forEach(r=>{if(r!=null&&r.archived)return;const c=w(r);if(!c){n+=1;return}const a=W(c);$(r).forEach(i=>{!i.sku||i.units<=0||(e[i.sku]||(e[i.sku]={}),e[i.sku][a]=(e[i.sku][a]||0)+i.units)})}),(Array.isArray(t==null?void 0:t.fos)?t.fos:[]).forEach(r=>{if(!H(r==null?void 0:r.status))return;const c=w(r);if(!c){n+=1;return}const a=W(c);$(r).forEach(i=>{!i.sku||i.units<=0||(e[i.sku]||(e[i.sku]={}),e[i.sku][a]=(e[i.sku][a]||0)+i.units)})}),{inboundBySku:e,inboundWithoutEtaCount:n}}function xt(t){var r;const e=K(((r=t==null?void 0:t.inventory)==null?void 0:r.snapshots)||[]),n=Et(t),o=ht(t),s=St(t);return{baselineMonth:e,plannedSalesBySku:n,closingStockBySku:o,inboundBySku:s.inboundBySku,inboundWithoutEtaCount:s.inboundWithoutEtaCount}}function Lt(t,e){const n=String(e||"").trim().toLowerCase();return n&&t.find(o=>String((o==null?void 0:o.sku)||"").trim().toLowerCase()===n)||null}function Bt(t){var l,d,f,M,I,O,x,L,B,k,V,_,z,q,j;const{context:e}=t;if(!e.baselineMonth)return null;const n=String(t.sku||"").trim();if(!n)return null;const o=S((l=t.product)==null?void 0:l.safetyStockDohOverride)??S((d=t.settings)==null?void 0:d.safetyStockDohDefault)??60,s=S((f=t.product)==null?void 0:f.foCoverageDohOverride)??S((M=t.settings)==null?void 0:M.foCoverageDohDefault)??90,r=S((I=t.product)==null?void 0:I.moqOverrideUnits)??S((O=t.product)==null?void 0:O.moqUnits)??S((x=t.settings)==null?void 0:x.moqDefaultUnits)??0,c=S((L=t.product)==null?void 0:L.unitsPerCarton)??null,a=S((B=t.settings)==null?void 0:B.foRecommendationRoundupCartonBlock)??10,i=Number((k=t.settings)==null?void 0:k.foRecommendationRoundupMaxPct),D=Number.isFinite(i)?Math.max(0,i):10,y=((_=(V=e.closingStockBySku)==null?void 0:V[n])==null?void 0:_[e.baselineMonth])??0,g=X({sku:n,baselineMonth:e.baselineMonth,stock0:y,forecastByMonth:((z=e.plannedSalesBySku)==null?void 0:z[n])||{},inboundByMonth:((q=e.inboundBySku)==null?void 0:q[n])||{},horizonMonths:Number(t.horizonMonths||12)});return J({sku:n,baselineMonth:e.baselineMonth,projection:g,plannedSalesBySku:e.plannedSalesBySku,safetyStockDays:o,coverageDays:s,leadTimeDays:Number(t.leadTimeDays||0),cnyPeriod:(j=t.settings)==null?void 0:j.cny,inboundWithoutEtaCount:e.inboundWithoutEtaCount,moqUnits:r,unitsPerCarton:c,roundupCartonBlock:a,roundupMaxPct:D,requiredArrivalMonth:t.requiredArrivalMonth})}export{Z as F,Tt as I,nt as P,vt as T,Nt as a,xt as b,Bt as c,Dt as d,gt as e,b as f,Ut as g,lt as h,Pt as i,et as j,N as k,Ft as l,It as m,G as n,dt as o,Ot as p,bt as q,Lt as r,At as s,ft as t,T as u,Rt as v,Ct as w};
