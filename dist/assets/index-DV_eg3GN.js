import{R as ct,al as mt,t as i,k as s,W as dt,X as y,Y as He,Z as ht,$ as We,ah as ft,V as w,a0 as F,ag as _e,aq as pt}from"./index-Dsq1NbgA.js";import{e as N,a as ke,E as gt}from"./chartPalette-B57jtk3U.js";import{b as St}from"./abcClassification-DMTDJ3gR.js";import{c as bt,g as yt}from"./inventoryProjection-BWCMGWlk.js";import{b as kt}from"./phantomFo-C9Q6wVDR.js";import{c as xt,m as Mt,b as jt,n as A,f as z}from"./months-D57QP-bs.js";import{a as vt}from"./forecastVersioning-D_WXxsjA.js";import{u as Ct,C as q}from"./workspace-DYbhLcOY.js";import{F as Pt}from"./Table-iT3qSGmN.js";import{E as Dt,S as Nt}from"./index-D7DbeJV5.js";import{S as At}from"./index-BR9pWJTQ.js";import{S as Ut}from"./index-Bihs0Hvp.js";import{T as It}from"./index-D5X-3Wzd.js";import"./productCompletenessV2-Bl9JV_fd.js";import"./orderUtils-Cu9aWhso.js";import"./foSuggestion-DyBAXRuI.js";import"./planProducts-8EK0Neth.js";import"./Dropdown-BjfOTMXt.js";import"./DownOutlined-QrMw0MBW.js";import"./index-3pXHqFLf.js";import"./useBubbleLock-l6JBo3uo.js";import"./index-DGYOOpUo.js";import"./Pagination-C71sWMmV.js";const{Paragraph:Et,Text:S,Title:Y}=dt;function le(n){return String(n||"").trim()}function Xe(n){const r=String(n||"").trim().toUpperCase();return r==="A"||r==="B"||r==="C"?r:"C"}function qe(n,r){return r==="a"?n==="A":r==="ab"?n==="A"||n==="B":!0}function wt(n){const r=Math.round(Number(n.skuPlanningHorizonMonths||0)),f=r===6||r===18?r:12,Q=String(n.skuPlanningAbcFilter||"abc").trim().toLowerCase(),G=Q==="a"||Q==="ab"?Q:"abc",U=Math.round(Number(n.skuPlanningMaxPhantomSuggestionsPerSku||0)),J=Number.isFinite(U)&&U>0?U:3;return{horizonMonths:f,abcScope:G,maxPhantomSuggestionsPerSku:J,showSimulationDefault:n.skuPlanningShowSimulationByDefault!==!1}}function Ft(n){if(!pt(n.includeInForecast,!0))return!1;if(typeof n.active=="boolean")return n.active;const r=String(n.status||"").trim().toLowerCase();return r?r==="active"||r==="aktiv":!0}function zt(n){const r=String(n||"").trim();return/^\d{4}-\d{2}-\d{2}$/.test(r)?r.slice(0,7):null}function Z(n){const r=A(n);return r?`${r}-01`:null}function L(n){const r=Number(n);return Number.isFinite(r)?Math.round(r).toLocaleString("de-DE"):"—"}function xe(n){if(!n)return"—";const r=new Date(n);return Number.isNaN(r.getTime())?n:r.toLocaleDateString("de-DE")}function Ot(n){if(!/^\d{4}-\d{2}$/.test(n||""))return 30;const[r,f]=n.split("-").map(Number);return new Date(r,f,0).getDate()}function x(n){const r=Number(n);return Number.isFinite(r)?r:null}function ue(n,r=0){const f=Math.round(Number(n));return!Number.isFinite(f)||f<=0?r:f}function Bt(n){return`${n}-${Math.random().toString(36).slice(2,10)}`}function Tt(n){const r=yt({projectionMode:"units",endAvailable:n.endAvailable,safetyUnits:n.safetyUnits,doh:n.doh,safetyDays:n.safetyDays});return r==="safety-negative"?"oos":r==="safety-low"?"under_safety":"ok"}function Qe(n){return n==="oos"?s.jsx(y,{color:"red",children:"OOS Risiko"}):n==="under_safety"?s.jsx(y,{color:"gold",children:"Unter Safety"}):s.jsx(y,{color:"green",children:"Stabil"})}function $t(n){const r=zt(n.requiredArrivalDate)||A(n.firstRiskMonth)||A(n.orderMonth);return r?{id:n.id,sku:le(n.sku),alias:String(n.alias||n.sku||""),abcClass:Xe(n.abcClass),arrivalMonth:r,arrivalDate:n.requiredArrivalDate||Z(r),suggestedUnits:Math.max(1,ue(n.suggestedUnits,1)),recommendedOrderDate:n.recommendedOrderDate||n.latestOrderDate||null,firstRiskMonth:A(n.firstRiskMonth),orderMonth:A(n.orderMonth),leadTimeDays:ue(n.leadTimeDays,0)||null,source:"auto",note:"Automatischer Vorschlag"}:null}function Me(n){const r=String(n||"").trim();return r.startsWith("/v2/")?r:"/v2/sku-planung"}function us(){const n=ct(),r=mt(),{state:f,loading:Q,error:G}=Ct(),U=f,J=f.settings||{},M=i.useMemo(()=>wt(J),[J]),[ee]=i.useState(()=>xt()),[ce,Ye]=i.useState(""),[d,me]=i.useState(""),[v,Ze]=i.useState("units"),[P,de]=i.useState(!0),je=i.useRef(!1),[I,R]=i.useState(""),he=i.useRef(""),[Ge,fe]=i.useState(!1),[te,ve]=i.useState(""),[se,Ce]=i.useState(0),[Pe,Je]=i.useState([]),[De,et]=i.useState([]),[Ne,Ae]=i.useState({}),[D,ne]=i.useState(null);i.useEffect(()=>{je.current||(je.current=!0,de(M.showSimulationDefault))},[M.showSimulationDefault]),i.useEffect(()=>{he.current=I},[I]);const h=i.useMemo(()=>Mt(ee,M.horizonMonths),[M.horizonMonths,ee]),Ue=i.useMemo(()=>jt(ee,-1),[ee]),pe=i.useMemo(()=>St(U).bySku,[f.forecast,f.products,U]),tt=i.useMemo(()=>{const e=f.forecast||{};return vt(e)},[f.forecast]),$=i.useMemo(()=>(Array.isArray(f.products)?f.products:[]).map(e=>e).map(e=>{const t=le(e.sku),a=String(e.alias||t),o=pe.get(t.toLowerCase())||pe.get(t);return{sku:t,alias:a,abcClass:Xe(o==null?void 0:o.abcClass),isActive:Ft(e)}}).filter(e=>e.sku&&e.isActive).filter(e=>qe(e.abcClass,M.abcScope)).sort((e,t)=>{const a=e.alias.localeCompare(t.alias,"de-DE",{sensitivity:"base"});return a!==0?a:e.sku.localeCompare(t.sku,"de-DE",{sensitivity:"base"})}),[pe,M.abcScope,f.products]),O=i.useMemo(()=>bt({state:U,months:h,products:$.map(e=>({sku:e.sku,alias:e.alias,status:"active"})),snapshot:null,snapshotMonth:Ue,projectionMode:"units"}),[h,$,Ue,U]),C=i.useMemo(()=>{const e=ce.trim().toLowerCase();return $.map(t=>{const a=O.perSkuMonth.get(t.sku);let o=null,c="ok";for(const l of h){const u=a==null?void 0:a.get(l);if(!u)continue;const g=Tt({endAvailable:x(u.endAvailable),safetyUnits:x(u.safetyUnits),doh:x(u.doh),safetyDays:x(u.safetyDays)});if(g!=="ok"){o=l,c=g;break}}return{key:t.sku,sku:t.sku,alias:t.alias,abcClass:t.abcClass,status:c,nextCriticalMonth:o}}).filter(t=>e?`${t.alias} ${t.sku}`.toLowerCase().includes(e):!0).sort((t,a)=>{const o=g=>g==="oos"?0:g==="under_safety"?1:2,c=o(t.status)-o(a.status);if(c!==0)return c;const l=String(t.nextCriticalMonth||"9999-12").localeCompare(String(a.nextCriticalMonth||"9999-12"));if(l!==0)return l;const u=t.alias.localeCompare(a.alias,"de-DE",{sensitivity:"base"});return u!==0?u:t.sku.localeCompare(a.sku,"de-DE",{sensitivity:"base"})})},[h,$,O.perSkuMonth,ce]),p=i.useMemo(()=>C.find(e=>e.sku===d)||null,[C,d]);i.useEffect(()=>{var a;const e=new URLSearchParams(r.search),t=le(e.get("sku"));if(t&&C.some(o=>o.sku===t)){d!==t&&me(t);return}(!d||!C.some(o=>o.sku===d))&&me(((a=C[0])==null?void 0:a.sku)||"")},[r.search,C,d]),i.useEffect(()=>{if(!h.length){R("");return}R(e=>e&&h.includes(e)?e:p!=null&&p.nextCriticalMonth&&h.includes(p.nextCriticalMonth)?p.nextCriticalMonth:h[0])},[h,p==null?void 0:p.nextCriticalMonth,d]);const Ie=i.useMemo(()=>{const e=new Map;return(Array.isArray(f.pos)?f.pos:[]).map(t=>t).forEach(t=>{const a=String(t.id||"").trim();if(!a)return;const o=String(t.poNo||a).trim();e.set(a,o||a)}),e},[f.pos]),Ee=i.useMemo(()=>{const e=new Map;return(Array.isArray(f.fos)?f.fos:[]).map(t=>t).forEach(t=>{const a=String(t.id||"").trim();if(!a)return;const o=String(t.foNo||t.foNumber||a.slice(-6).toUpperCase()||a);e.set(a,o)}),e},[f.fos]),we=i.useMemo(()=>!h.length||!$.length?[]:kt({state:U,months:h,targetMonth:h[h.length-1]||null,maxSuggestions:Math.max(20,$.length*M.maxPhantomSuggestionsPerSku*2)}),[h,M.maxPhantomSuggestionsPerSku,$.length,f.fos,f.forecast,f.pos,f.products,f.settings,U]),ae=i.useMemo(()=>new Set(De),[De]),Fe=i.useMemo(()=>new Set(Pe),[Pe]),K=i.useMemo(()=>d?we.map(e=>$t(e)).filter(e=>!!e).filter(e=>e.sku===d).filter(e=>qe(e.abcClass,M.abcScope)).filter(e=>!Fe.has(e.id)&&!ae.has(e.id)).slice(0,M.maxPhantomSuggestionsPerSku):[],[ae,we,Fe,M.abcScope,M.maxPhantomSuggestionsPerSku,d]),V=i.useMemo(()=>d?(Ne[d]||[]).filter(e=>!ae.has(e.id)):[],[ae,Ne,d]),oe=i.useMemo(()=>P?[...K,...V]:[],[K,V,P]),ze=i.useMemo(()=>{const e=new Map;return[...K,...V].forEach(t=>{e.set(t.id,t)}),e},[K,V]),E=i.useMemo(()=>{if(!d||!h.length)return[];const e=O.perSkuMonth.get(d),t=new Map;oe.forEach(c=>{const l=A(c.arrivalMonth);l&&t.set(l,(t.get(l)||0)+Math.max(0,Number(c.suggestedUnits||0)))});let a=Number(O.startAvailableBySku.get(d)||0),o=!1;return h.map(c=>{const l=e==null?void 0:e.get(c),u=x(l==null?void 0:l.forecastUnits),g=x(l==null?void 0:l.endAvailable),k=x(l==null?void 0:l.doh),W=x(l==null?void 0:l.safetyUnits),m=x(l==null?void 0:l.safetyDays),T=Math.max(0,Number((l==null?void 0:l.inboundUnits)||0)),j=Math.max(0,Number(t.get(c)||0));let b=g;P&&(o||!Number.isFinite(u)?(b=null,o=!0):(b=a+T+j-Number(u||0),a=b));const _=Number.isFinite(b)&&Number.isFinite(u)&&Number(u)>0?Math.max(0,Math.round(Number(b)/(Number(u)/Ot(c)))):null;return{month:c,forecastUnits:u,baseUnits:g,baseDoh:k,simulatedUnits:b,simulatedDoh:_,safetyUnits:W,safetyDoh:m,realInboundUnits:T,phantomInboundUnits:j}})},[oe,h,O.perSkuMonth,O.startAvailableBySku,d,P]),re=i.useMemo(()=>new Map(E.map(e=>[e.month,e])),[E]),B=i.useMemo(()=>{const e=new Map;if(h.forEach(o=>e.set(o,[])),!d)return e;const t=O.inboundDetailsMap.get(d);t==null||t.forEach((o,c)=>{if(!e.has(c))return;const l=e.get(c);(Array.isArray(o.poItems)?o.poItems:[]).forEach((u,g)=>{const k=Ie.get(String(u.id||""))||String(u.ref||"");l.push({id:`po-${c}-${g}-${String(u.id||"")}`,type:"po",label:k||"PO",units:Math.max(0,Math.round(Number(u.units||0))),month:c,date:u.arrivalDate||Z(c),poNo:k||null,foId:null,phantomEntryId:null})}),(Array.isArray(o.foItems)?o.foItems:[]).forEach((u,g)=>{const k=String(u.id||"").trim();l.push({id:`fo-${c}-${g}-${k}`,type:"fo",label:Ee.get(k)||String(u.ref||k||"FO"),units:Math.max(0,Math.round(Number(u.units||0))),month:c,date:u.arrivalDate||Z(c),poNo:null,foId:k||null,phantomEntryId:null})})}),P&&oe.forEach(o=>{if(!e.has(o.arrivalMonth))return;e.get(o.arrivalMonth).push({id:`phantom-${o.id}`,type:"phantom",label:`${o.source==="manual"?"Manuell":"Vorschlag"} ${o.id.slice(-6).toUpperCase()}`,units:Math.max(0,Math.round(Number(o.suggestedUnits||0))),month:o.arrivalMonth,date:o.arrivalDate||Z(o.arrivalMonth),poNo:null,foId:null,phantomEntryId:o.id})});const a=o=>o==="po"?0:o==="fo"?1:2;return e.forEach(o=>{o.sort((c,l)=>{const u=a(c.type)-a(l.type);if(u!==0)return u;const g=Number(l.units||0)-Number(c.units||0);return g!==0?g:c.label.localeCompare(l.label,"de-DE",{sensitivity:"base"})})}),e},[oe,Ee,h,Ie,O.inboundDetailsMap,d,P]),Oe=i.useMemo(()=>B.get(I)||[],[I,B]),st=i.useCallback(e=>{const t=le(e);if(!t)return;me(t);const a=new URLSearchParams(r.search);a.set("sku",t);const o=a.toString();n({pathname:r.pathname,search:o?`?${o}`:""},{replace:!0})},[r.pathname,r.search,n]),Be=i.useCallback(e=>{if(!d||!h.length)return;const t=A(e||I||h[0])||h[0];ve(t),Ce(0),fe(!0)},[I,h,d]),nt=i.useCallback(()=>{if(!d)return;const e=A(te),t=ue(se,0);if(!e||!h.includes(e)||t<=0)return;const a=C.find(c=>c.sku===d)||null,o={id:Bt("manual-phantom"),sku:d,alias:(a==null?void 0:a.alias)||d,abcClass:(a==null?void 0:a.abcClass)||"C",arrivalMonth:e,arrivalDate:Z(e),suggestedUnits:t,recommendedOrderDate:null,firstRiskMonth:e,orderMonth:e,leadTimeDays:null,source:"manual",note:"Manuell hinzugefuegt"};Ae(c=>({...c,[d]:[...c[d]||[],o]})),de(!0),fe(!1),R(e)},[te,se,C,h,d]),ge=i.useCallback(e=>{if(e.source==="auto"){Je(t=>t.includes(e.id)?t:[...t,e.id]);return}Ae(t=>{const a={...t};return a[e.sku]=(a[e.sku]||[]).filter(o=>o.id!==e.id),a})},[]),Te=i.useCallback(e=>{if(!e)return;const t=new URLSearchParams;t.set("source","fo_convert"),t.set("poNo",e),t.set("returnTo",Me(r.pathname)),d&&t.set("returnSku",d),n(`/v2/orders/po?${t.toString()}`)},[r.pathname,n,d]),$e=i.useCallback(e=>{if(!e)return;const t=new URLSearchParams;t.set("source","orders_sku"),t.set("foId",e),t.set("returnTo",Me(r.pathname)),d&&t.set("returnSku",d),n(`/v2/orders/fo?${t.toString()}`)},[r.pathname,n,d]),Se=i.useCallback(e=>{et(a=>a.includes(e.id)?a:[...a,e.id]);const t=new URLSearchParams;t.set("source","phantom_fo"),t.set("phantomId",e.id),t.set("sku",e.sku),t.set("month",e.arrivalMonth),t.set("suggestedUnits",String(Math.max(1,Math.round(Number(e.suggestedUnits||0))))),e.arrivalDate&&t.set("requiredArrivalDate",e.arrivalDate),e.recommendedOrderDate&&t.set("recommendedOrderDate",e.recommendedOrderDate),e.firstRiskMonth&&t.set("firstRiskMonth",e.firstRiskMonth),e.orderMonth&&t.set("orderMonth",e.orderMonth),Number.isFinite(Number(e.leadTimeDays))&&t.set("leadTimeDays",String(Math.max(1,Math.round(Number(e.leadTimeDays||0))))),t.set("returnTo",Me(r.pathname)),t.set("returnSku",e.sku),n(`/v2/orders/fo?${t.toString()}`)},[r.pathname,n]),be=i.useCallback(e=>{if(e.type==="po"){Te(e.poNo);return}if(e.type==="fo"){$e(e.foId);return}const t=e.phantomEntryId&&ze.get(e.phantomEntryId)||null;t&&ne(t)},[$e,Te,ze]),H=i.useMemo(()=>{const e=[],t=[],a=[];return h.forEach(o=>{const c=B.get(o)||[],l={po:[],fo:[],phantom:[]};c.forEach(u=>{l[u.type].push(u)}),["po","fo","phantom"].forEach(u=>{l[u].forEach((k,W)=>{const m=re.get(o),T=u==="phantom"?v==="doh"?m==null?void 0:m.simulatedDoh:m==null?void 0:m.simulatedUnits:v==="doh"?m==null?void 0:m.baseDoh:m==null?void 0:m.baseUnits,j=v==="doh"?m==null?void 0:m.safetyDoh:m==null?void 0:m.safetyUnits,b=Number.isFinite(T)?Number(T):Number.isFinite(j)?Number(j):0,_=(v==="doh"?1.2:30)*W,X={value:[o,Math.max(0,b+_)],month:o,eventType:k.type,eventId:k.id,label:k.label,units:k.units};u==="po"?e.push(X):u==="fo"?t.push(X):a.push(X)})})}),{po:e,fo:t,phantom:a}},[re,B,h,v]),at=i.useMemo(()=>{const e=E.map(m=>x(m.baseUnits)),t=E.map(m=>x(m.simulatedUnits)),a=E.map(m=>x(m.baseDoh)),o=E.map(m=>x(m.simulatedDoh)),c=E.map(m=>x(m.safetyUnits)),l=E.map(m=>x(m.safetyDoh)),u=E.map(m=>x(m.forecastUnits)),g=v==="doh"?a:e,k=v==="doh"?o:t,W=v==="doh"?l:c;return{animation:!1,grid:{left:56,right:62,top:42,bottom:58},legend:{top:8},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:m=>{var Ke,Ve;const T=Array.isArray(m)?m:[m],j=A(((Ke=T[0])==null?void 0:Ke.axisValue)||((Ve=T[0])==null?void 0:Ve.name)||"");j&&j!==he.current&&R(j);const b=j&&re.get(j)||null,_=j?B.get(j)||[]:[],X=v==="doh"?b==null?void 0:b.simulatedDoh:b==null?void 0:b.simulatedUnits,lt=v==="doh"?"Bestand (DOH)":"Bestand (Units)",ut=_.length?_.map(ye=>`${String(ye.type||"").toUpperCase()} ${ye.label}: ${L(ye.units)}`).join("<br/>"):"Keine Events";return[`<div><strong>${j?z(j):"—"}</strong></div>`,`<div>${lt}: ${L(X)}</div>`,`<div>Plan-Absatz: ${L(b==null?void 0:b.forecastUnits)}</div>`,"<div>Events:</div>",`<div>${ut}</div>`].join("")}},xAxis:{type:"category",data:h,axisLabel:{formatter:m=>z(String(m||""))}},yAxis:[{type:"value",min:0,name:v==="doh"?"DOH":"Units"},{type:"value",min:0,name:"Plan",splitLine:{show:!1}}],series:[{name:"Plan-Absatz",type:"bar",yAxisIndex:1,itemStyle:{color:N.demandBar,opacity:.26},emphasis:{itemStyle:{opacity:.35}},data:u},{name:"Safety Bereich",type:"line",smooth:!1,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:N.safetyArea},data:W},{name:"Safety",type:"line",smooth:!1,symbol:"none",lineStyle:{width:1,type:"dashed",color:N.safetyLine},data:W},{name:"Bestand Basis",type:"line",smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2,color:N.baseInventory},itemStyle:{color:N.baseInventory},markLine:{symbol:"none",lineStyle:{type:"dotted",color:N.oosLine},data:[{yAxis:0,name:"OOS"}]},data:g},...P?[{name:"Bestand Simulation",type:"line",smooth:!0,symbol:"diamond",symbolSize:6,lineStyle:{width:2,color:N.simulationInventory},itemStyle:{color:N.simulationInventory},data:k}]:[],{name:"PO Ankunft",type:"scatter",symbol:"circle",symbolSize:11,itemStyle:{color:N.markerPo,borderColor:ke.markerPoBorder,borderWidth:1},tooltip:{show:!1},data:H.po},{name:"FO Ankunft",type:"scatter",symbol:"diamond",symbolSize:11,itemStyle:{color:N.markerFo,borderColor:ke.markerFoBorder,borderWidth:1},tooltip:{show:!1},data:H.fo},...P?[{name:"Phantom Ankunft",type:"scatter",symbol:"triangle",symbolSize:13,itemStyle:{color:N.markerPhantom,borderColor:ke.markerPhantomBorder,borderWidth:1},tooltip:{show:!1},data:H.phantom}]:[]]}},[re,E,H.fo,H.phantom,H.po,B,h,P,v]),ot=i.useMemo(()=>({click:e=>{var l;const t=e!=null&&e.data&&typeof e.data=="object"?e.data:{},a=String(t.eventType||""),o=String(t.eventId||""),c=A(t.month||(e==null?void 0:e.name)||((l=e==null?void 0:e.value)==null?void 0:l[0])||"");if(c&&R(c),a&&o&&c){const u=(B.get(c)||[]).find(g=>g.id===o&&g.type===a);u&&be(u)}},updateAxisPointer:e=>{const t=Array.isArray(e==null?void 0:e.axesInfo)?e.axesInfo[0]:null;if(!t)return;let a=null;typeof t.value=="number"?a=h[t.value]||null:a=A(t.value),a&&a!==he.current&&R(a)}}),[B,be,h]),rt=i.useMemo(()=>[{title:"ABC",dataIndex:"abcClass",width:74,align:"center"},{title:"Alias",dataIndex:"alias",ellipsis:!0},{title:"SKU",dataIndex:"sku",width:180,ellipsis:!0},{title:"Status",dataIndex:"status",width:150,render:e=>Qe(e)},{title:"Naechster kritischer Monat",dataIndex:"nextCriticalMonth",width:190,render:e=>e?z(e):"—"}],[]),ie=i.useMemo(()=>{const e=C.filter(a=>a.status==="oos").length,t=C.filter(a=>a.status==="under_safety").length;return{oosCount:e,underSafetyCount:t}},[C]),it=i.useCallback(e=>e.type==="po"?`PO ${e.label}`:e.type==="fo"?`FO ${e.label}`:`Phantom ${e.label}`,[]),Le=(p==null?void 0:p.alias)||(p==null?void 0:p.sku)||"",Re=(p==null?void 0:p.nextCriticalMonth)||null;return s.jsxs("div",{className:"v2-page v2-sku-plan-page",children:[s.jsxs(q,{className:"v2-intro-card",children:[s.jsx("div",{className:"v2-page-head",children:s.jsxs("div",{children:[s.jsx(Y,{level:3,children:"SKU Planung"}),s.jsx(Et,{children:"Interaktive SKU-Planung mit Bestandsverlauf, PO/FO-Ankuenften und Phantom-FO Simulation als reines Overlay."})]})}),s.jsx("div",{className:"v2-toolbar",children:s.jsxs("div",{className:"v2-toolbar-row",children:[s.jsxs(y,{color:"blue",children:["Horizont: ",M.horizonMonths," Monate"]}),s.jsxs(y,{color:"default",children:["ABC Scope: ",M.abcScope.toUpperCase()]}),s.jsxs(y,{color:"default",children:["Max Phantom je SKU: ",M.maxPhantomSuggestionsPerSku]}),s.jsxs(y,{color:"green",children:["Forecast: ",tt]}),s.jsxs(y,{color:ie.oosCount>0?"red":"green",children:["OOS Risiko: ",ie.oosCount]}),s.jsxs(y,{color:ie.underSafetyCount>0?"gold":"green",children:["Unter Safety: ",ie.underSafetyCount]})]})})]}),G?s.jsx(He,{type:"error",showIcon:!0,message:G}):null,Q?s.jsx(He,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,s.jsxs(ht,{gutter:[12,12],children:[s.jsx(We,{xs:24,xl:10,children:s.jsxs(q,{children:[s.jsx("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:s.jsx(ft,{placeholder:"Suche Alias oder SKU",value:ce,onChange:e=>Ye(e.target.value)})}),s.jsx(Pt,{className:"v2-ant-table v2-sku-planning-overview",rowKey:"key",size:"small",pagination:!1,columns:rt,dataSource:C,locale:{emptyText:"Keine SKU im aktuellen Filter."},rowClassName:e=>e.sku===d?"v2-sku-plan-row-active":"",onRow:e=>({onClick:()=>st(e.sku)}),scroll:{y:560}})]})}),s.jsx(We,{xs:24,xl:14,children:s.jsx(q,{children:p?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"v2-page-head",style:{marginBottom:10},children:[s.jsxs("div",{children:[s.jsx(Y,{level:4,style:{marginBottom:2},children:Le}),s.jsxs(S,{type:"secondary",children:[p.sku," · ABC ",p.abcClass]})]}),s.jsxs(w,{wrap:!0,children:[Qe(p.status),Re?s.jsxs(y,{color:"gold",children:["Kritisch ab ",z(Re)]}):s.jsx(y,{color:"green",children:"Kein kritischer Monat"})]})]}),s.jsxs("div",{className:"v2-toolbar-row v2-sku-planning-controls",style:{marginBottom:8},children:[s.jsx(At,{value:v,options:[{value:"units",label:"Units"},{value:"doh",label:"DOH"}],onChange:e=>Ze(String(e)==="doh"?"doh":"units")}),s.jsxs(w,{size:8,children:[s.jsx(S,{type:"secondary",children:"Simulation"}),s.jsx(Ut,{checked:P,onChange:de})]}),s.jsx(F,{onClick:()=>Be(I||null),children:"+ Phantom-FO manuell"})]}),s.jsx(gt,{style:{height:420},option:at,onEvents:ot}),s.jsxs("div",{className:"v2-sku-planning-hints",children:[s.jsx(y,{children:"PO Marker: Kreis"}),s.jsx(y,{color:"green",children:"FO Marker: Diamant"}),P?s.jsx(y,{color:"orange",children:"Phantom Marker: Dreieck (Simulation)"}):s.jsx(y,{color:"default",children:"Simulation aus"}),s.jsx(S,{type:"secondary",children:"Marker anklicken oeffnet PO/FO/Phantom-Detail."})]}),s.jsxs(q,{size:"small",style:{marginTop:10},children:[s.jsxs(w,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[s.jsxs(Y,{level:5,style:{margin:0},children:["Monat im Fokus: ",I?z(I):"—"]}),s.jsx(F,{size:"small",onClick:()=>Be(I||null),children:"Phantom fuer Monat hinzufuegen"})]}),Oe.length?s.jsx("div",{className:"v2-sku-planning-focus-list",children:Oe.map(e=>s.jsx("div",{className:"v2-sku-planning-focus-item",children:s.jsxs(w,{wrap:!0,children:[s.jsx(y,{color:e.type==="po"?"blue":e.type==="fo"?"green":"orange",children:e.type.toUpperCase()}),s.jsx(S,{strong:!0,children:it(e)}),s.jsxs(S,{type:"secondary",children:["Menge: ",L(e.units)]}),s.jsxs(S,{type:"secondary",children:["Datum: ",xe(e.date)]}),s.jsx(F,{size:"small",onClick:()=>be(e),children:"Oeffnen"})]})},e.id))}):s.jsx(S,{type:"secondary",children:"Keine Events in diesem Monat."})]}),s.jsxs(q,{size:"small",style:{marginTop:10},children:[s.jsx(Y,{level:5,style:{marginTop:0},children:"Automatische Phantom-FO Vorschlaege"}),K.length?s.jsx("div",{className:"v2-sku-planning-focus-list",children:K.map(e=>s.jsx("div",{className:"v2-sku-planning-focus-item",children:s.jsxs(w,{wrap:!0,children:[s.jsx(y,{color:"orange",children:"Vorschlag"}),s.jsxs(S,{strong:!0,children:["Ankunft ",z(e.arrivalMonth)]}),s.jsxs(S,{children:["Menge ",L(e.suggestedUnits)]}),s.jsxs(S,{type:"secondary",children:["Bestellen bis: ",xe(e.recommendedOrderDate)]}),s.jsx(F,{size:"small",type:"primary",onClick:()=>Se(e),children:"Als echte FO anlegen"}),s.jsx(F,{size:"small",onClick:()=>ge(e),children:"Verwerfen"})]})},e.id))}):s.jsx(S,{type:"secondary",children:"Keine Vorschlaege fuer diese SKU im aktuellen Horizont."})]}),s.jsxs(q,{size:"small",style:{marginTop:10},children:[s.jsx(Y,{level:5,style:{marginTop:0},children:"Manuelle Phantom-FOs"}),V.length?s.jsx("div",{className:"v2-sku-planning-focus-list",children:V.map(e=>s.jsx("div",{className:"v2-sku-planning-focus-item",children:s.jsxs(w,{wrap:!0,children:[s.jsx(y,{children:"Manuell"}),s.jsxs(S,{strong:!0,children:["Ankunft ",z(e.arrivalMonth)]}),s.jsxs(S,{children:["Menge ",L(e.suggestedUnits)]}),s.jsx(F,{size:"small",type:"primary",onClick:()=>Se(e),children:"Als echte FO anlegen"}),s.jsx(F,{size:"small",onClick:()=>ge(e),children:"Entfernen"})]})},e.id))}):s.jsx(S,{type:"secondary",children:"Noch keine manuellen Phantom-FOs."})]})]}):s.jsx(Dt,{description:"Bitte eine SKU aus der Liste waehlen."})})})]}),s.jsx(_e,{title:"Phantom-FO manuell hinzufügen",open:Ge,onCancel:()=>fe(!1),onOk:nt,okButtonProps:{disabled:!te||se<=0},children:s.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[s.jsxs(S,{type:"secondary",children:["SKU: ",Le||d||"—"]}),s.jsx(Nt,{value:te||void 0,onChange:e=>ve(String(e||"")),options:h.map(e=>({value:e,label:z(e)}))}),s.jsx(It,{value:se,min:1,style:{width:"100%"},controls:!1,onChange:e=>Ce(ue(e,0)),placeholder:"Menge (Units)"})]})}),s.jsx(_e,{title:"Phantom-FO Detail",open:!!D,onCancel:()=>ne(null),footer:D?s.jsxs(w,{children:[s.jsx(F,{onClick:()=>{ge(D),ne(null)},children:"Verwerfen"}),s.jsx(F,{type:"primary",onClick:()=>{Se(D),ne(null)},children:"Als echte FO anlegen"})]}):null,children:D?s.jsxs(w,{direction:"vertical",children:[s.jsxs(S,{children:["SKU: ",s.jsxs("strong",{children:[D.alias," (",D.sku,")"]})]}),s.jsxs(S,{children:["ABC: ",D.abcClass]}),s.jsxs(S,{children:["Ankunft: ",z(D.arrivalMonth)]}),s.jsxs(S,{children:["Menge: ",L(D.suggestedUnits)]}),s.jsxs(S,{children:["Bestellen bis: ",xe(D.recommendedOrderDate)]}),s.jsx(S,{type:"secondary",children:"Hinweis: Phantom-FOs werden nur in der SKU Planung als Simulation angezeigt und nicht in P&L/Cashflow verbucht."})]}):null})]})}export{us as default};
