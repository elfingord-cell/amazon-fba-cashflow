import{t as g,k as e,J as w,L as i,M as k,S as A}from"./index-CAzQztwo.js";import{b as F}from"./abcClassification-D8Ca84qt.js";import{T as M}from"./TanStackGrid-DGGNjv9D.js";import{u as S,C as B}from"./workspace-xr5uOuIo.js";import"./Dropdown-CZlZd-6U.js";const{Paragraph:U,Text:p,Title:_}=w;function v(r,c=0){return Number.isFinite(r)?Number(r).toLocaleString("de-DE",{minimumFractionDigits:c,maximumFractionDigits:c}):"—"}function z(r){return r==="revenue_6m"?"Umsatz 6M":r==="units_6m_fallback"?"Units-Fallback 6M":"Keine Forecast-Daten"}function D(r){return r==="A"?e.jsx(i,{color:"green",children:"A"}):r==="B"?e.jsx(i,{color:"gold",children:"B"}):e.jsx(i,{children:"C"})}function G(){const{state:r,loading:c,error:f}=S(),x=r,u=g.useMemo(()=>{const s=F(x),l=Array.isArray(r.products)?r.products:[],j=new Map;l.forEach(o=>{const a=o||{},n=String(a.sku||"").trim();n&&j.set(n.toLowerCase(),String(a.alias||n))});const d=new Map;return s.bySku.forEach(o=>{const a=o||{},n=String(a.sku||"").trim();if(!n)return;const m=n.toLowerCase();if(d.has(m))return;const h=String(a.abcClass||"C").toUpperCase(),N=h==="A"||h==="B"?h:"C",b=String(a.abcBasis||"no_data"),y=b==="revenue_6m"||b==="units_6m_fallback"?b:"no_data";d.set(m,{sku:n,alias:j.get(m)||n,abcClass:N,abcBasis:y,revenue6m:Number.isFinite(Number(a.revenue6m))?Number(a.revenue6m):null,units6m:Number.isFinite(Number(a.units6m))?Number(a.units6m):null,vkPriceGross:Number.isFinite(Number(a.vkPriceGross))?Number(a.vkPriceGross):null,active:a.active!==!1})}),Array.from(d.values()).sort((o,a)=>o.alias.localeCompare(a.alias,"de-DE",{sensitivity:"base"}))},[r.products,x]),t=g.useMemo(()=>u.reduce((s,l)=>(l.active&&(s[l.abcClass]+=1,l.abcBasis==="revenue_6m"&&(s.revenueBasis+=1),l.abcBasis==="units_6m_fallback"&&(s.unitsFallback+=1),l.abcBasis==="no_data"&&(s.noData+=1)),s),{A:0,B:0,C:0,revenueBasis:0,unitsFallback:0,noData:0}),[u]),C=g.useMemo(()=>[{header:"Alias",accessorKey:"alias",meta:{minWidth:260,width:280},cell:({row:s})=>e.jsxs("div",{className:"v2-proj-alias",children:[e.jsx(p,{className:"v2-proj-alias-main",children:s.original.alias}),e.jsx(p,{className:"v2-proj-sku-secondary",type:"secondary",children:s.original.sku})]})},{header:"ABC",meta:{width:88,align:"center"},cell:({row:s})=>D(s.original.abcClass)},{header:"Basis",meta:{width:180},cell:({row:s})=>z(s.original.abcBasis)},{header:"Units (6M)",meta:{width:120,align:"right"},cell:({row:s})=>v(s.original.units6m,0)},{header:"Ø VK (EUR)",meta:{width:120,align:"right"},cell:({row:s})=>v(s.original.vkPriceGross,2)},{header:"Umsatz (6M EUR)",meta:{width:160,align:"right"},cell:({row:s})=>v(s.original.revenue6m,2)},{header:"Status",meta:{width:100},cell:({row:s})=>s.original.active?e.jsx(i,{color:"green",children:"Aktiv"}):e.jsx(i,{children:"Inaktiv"})}],[]);return e.jsxs("div",{className:"v2-page",children:[e.jsxs(B,{className:"v2-intro-card",children:[e.jsx("div",{className:"v2-page-head",children:e.jsxs("div",{children:[e.jsx(_,{level:3,children:"ABC Insights"}),e.jsx(U,{children:"Transparenz zur ABC-Klassifizierung: zuerst Umsatz der nächsten 6 Monate, bei fehlendem Preis Units-Fallback."})]})}),e.jsx("div",{className:"v2-toolbar",children:e.jsxs("div",{className:"v2-toolbar-row",children:[e.jsxs(i,{color:"green",children:["A: ",t.A]}),e.jsxs(i,{color:"gold",children:["B: ",t.B]}),e.jsxs(i,{children:["C: ",t.C]}),e.jsxs(i,{color:"blue",children:["Umsatz-Basis: ",t.revenueBasis]}),e.jsxs(i,{color:"purple",children:["Units-Fallback: ",t.unitsFallback]}),e.jsxs(i,{color:t.noData>0?"orange":"green",children:["Ohne Forecast: ",t.noData]})]})})]}),f?e.jsx(k,{type:"error",showIcon:!0,message:f}):null,c?e.jsx(k,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,e.jsx(B,{children:e.jsxs(A,{direction:"vertical",size:6,style:{width:"100%"},children:[e.jsx(p,{type:"secondary",children:"Regel: Ranking nach 6M-Umsatz. Falls kein belastbarer Verkaufspreis vorhanden ist, wird Units als Fallback verwendet."}),e.jsx(M,{data:u,columns:C,minTableWidth:1120,tableLayout:"fixed"})]})})]})}export{G as default};
