import{g as Oe}from"./planProducts-BpFPmIqP.js";import{bv as Be,J as Et,Q as Rt,a9 as De,bw as xt,af as Re,bx as te,P as J}from"./index-DN7VFcDZ.js";import{d as Ce,p as Ct,n as Le,e as Ue,a as _e,b as je,c as St}from"./cashInRules-r9rlv23d.js";function ze(t){return Number.isFinite(t)?t:0}function P(t){if(typeof t=="number")return t;if(!t)return 0;const e=String(t).trim().replace(/\./g,"").replace(",","."),o=Number(e);return Number.isFinite(o)?o:0}function G(t){if(t===""||t===null||t===void 0)return 0;const e=Number(String(t).replace(",","."));return Number.isFinite(e)?e:0}function vt(t,e=P){if(t==null)return null;if(typeof t=="number")return Number.isFinite(t)?t:null;const o=String(t).trim();if(!o)return null;const p=e(o);return Number.isFinite(p)?p:null}function Qe(t){return String(t||"").trim().toLowerCase()==="basis"?"basis":"conservative"}function qe(t){const e=Math.max(0,Math.round(Number(t||0)));return e<=0?0:Math.min(5,e)}function Kt(t){const e=Number(t);return Number.isFinite(e)?e.toLocaleString("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}):"0 €"}function Me(t,e=0){const o=Number(t);return Number.isFinite(o)?o.toLocaleString("de-DE",{minimumFractionDigits:e,maximumFractionDigits:e}):"0"}function Jt({forecastRevenue:t,calibrationFactorApplied:e,planRevenue:o,payoutPct:p,payoutAmount:s,quoteSource:i,recommendationSourceTag:l,mode:m,marginPct:c}){const b=m==="basis"?"Basis":"Konservativ",r=i==="manual"?"manuell":"Empfehlung",N=l==="IST"?"IST":l==="PROGNOSE"?"PROGNOSE":l==="BASELINE_Q4"?"BASELINE Q4":l==="BASELINE_NORMAL"?"BASELINE NORMAL":null,T=Number.isFinite(e)&&Math.abs(Number(e)-1)>1e-6?Number(e).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}):null,k=[`Forecast-Umsatz: ${Kt(t)}`,`Kalibrierfaktor: ${T||"1,00"}`,`Plan-Umsatz: ${Kt(o)}`,`Quote: ${Me(p)}% (${r}${N&&i!=="manual"?`, ${N}`:""}${c>0?`, ${b}`:""})`,`Auszahlung: ${Kt(s)}`];return c>0&&k.push(`Sicherheitsmarge: -${Me(c)}pp`),k.join(" · ")}function We(t){const e=t||{},o=new Map,p=e!=null&&e.monthlyActuals&&typeof e.monthlyActuals=="object"?e.monthlyActuals:{};return Object.entries(p).forEach(([i,l])=>{if(!i)return;const m=vt(l==null?void 0:l.realRevenueEUR,P),c=vt(l==null?void 0:l.realPayoutRatePct,G),b=vt(l==null?void 0:l.realClosingBalanceEUR,P),r={};Number.isFinite(m)&&(r.revenue=m),Number.isFinite(c)&&(r.payoutRatePct=c),Number.isFinite(m)&&Number.isFinite(c)&&(r.payout=m*(c/100)),Number.isFinite(b)&&(r.closing=b),Object.keys(r).length&&o.set(i,r)}),(Array.isArray(e.actuals)?e.actuals:[]).forEach(i=>{if(!i||!i.month)return;const l=i.month,m=vt(i.revenueEur,P),c=vt(i.payoutEur,P),b=vt(i.closingBalanceEur,P),r=o.get(l)||{};!Number.isFinite(r.revenue)&&Number.isFinite(m)&&(r.revenue=m),!Number.isFinite(r.payout)&&Number.isFinite(c)&&(r.payout=c),!Number.isFinite(r.closing)&&Number.isFinite(b)&&(r.closing=b),!Number.isFinite(r.payoutRatePct)&&Number.isFinite(m)&&m!==0&&Number.isFinite(c)&&(r.payoutRatePct=c/m*100),Object.keys(r).length&&o.set(l,r)}),o}function rn(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:2}).format(ze(Number(t)))}function He(t,e){const[o,p]=t.split("-").map(Number),s=new Date(o,p-1+e,1);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`}function Se(t,e){const o=[];for(let p=0;p<e;p++)o.push(He(t,p));return o}function ot(t){const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`}function w(t,e){const o=new Date(t.getTime());return o.setDate(o.getDate()+(e||0)),o}function mt(t){return!(t instanceof Date)||Number.isNaN(t.getTime())?null:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function Nt(t){if(!t)return null;const e=new Date(t);return Number.isNaN(e.getTime())?null:e}function wt(t){const[e,o]=t.split("-").map(Number);return new Date(e,o,0)}function Ye(t,e){var l;const o=t==null?void 0:t.cny;if(o!=null&&o.start&&(o!=null&&o.end)){const m=Nt(o.start),c=Nt(o.end);if(m&&c&&c>=m)return{start:m,end:c}}const p=(l=t==null?void 0:t.cnyBlackoutByYear)==null?void 0:l[String(e)];if(!p)return null;const s=Nt(p.start),i=Nt(p.end);return!s||!i||i<s?null:{start:s,end:i}}function Ze(t,e,o){if(!(t instanceof Date)||Number.isNaN(t.getTime()))return{prodDone:t,adjustmentDays:0};const p=Math.max(0,Number(e||0)),s=w(t,p);if(!o||p===0)return{prodDone:s,adjustmentDays:0};let i=0;const l=t.getUTCFullYear(),m=s.getUTCFullYear();for(let b=l;b<=m;b+=1){const r=Ye(o,b);if(!r)continue;const N=r.start>t?r.start:t,T=r.end<s?r.end:s;if(T<N)continue;const k=Math.round((T.getTime()-N.getTime())/(24*60*60*1e3))+1;i+=Math.max(0,k)}return{prodDone:i?w(s,i):s,adjustmentDays:i}}function Pe(t,e){const o=Nt(t.orderDate)||new Date,p=Number(t.productionLeadTimeDays??t.prodDays??0),s=Number(t.logisticsLeadTimeDays??t.transitDays??0),l=Ze(o,p,e).prodDone??w(o,p),m=l,c=w(m,s),b=Nt(t.etdManual),r=Nt(t.etaManual);return{ORDER_DATE:o,PROD_DONE:l,PRODUCTION_END:l,ETD:b||m,ETA:r||c}}function Ve(t,e){const o=new Date(t.getTime());return o.setMonth(o.getMonth()+e),o}function Ge(t){return new Date(t.getFullYear(),t.getMonth()+1,0)}function it(t){if(!/^\d{4}-\d{2}$/.test(t||""))return null;const[e,o]=t.split("-").map(Number);return e*12+(o-1)}function Xe(t,e){const o=Array.isArray(t==null?void 0:t.items)?t.items:[];let p=0,s=0;if(o.length)o.forEach(b=>{const r=P((b==null?void 0:b.units)??0),N=P((b==null?void 0:b.unitCostUsd)??0),T=P((b==null?void 0:b.unitExtraUsd)??0),k=P((b==null?void 0:b.extraFlatUsd)??0),$=(N+T)*r+k,D=Math.max(0,Math.round($*100)/100);Number.isFinite(D)&&(p+=D),Number.isFinite(r)&&(s+=r)});else{const b=P((t==null?void 0:t.units)??0),r=P((t==null?void 0:t.unitCostUsd)??0),N=P((t==null?void 0:t.unitExtraUsd)??0),T=P((t==null?void 0:t.extraFlatUsd)??0),k=(r+N)*b+T;p=Math.max(0,Math.round(k*100)/100),Number.isFinite(b)&&(s=b)}const i=P((t==null?void 0:t.fxOverride)??0),l=Number.isFinite(i)&&i>0?i:P((e==null?void 0:e.fxRate)??0)||0,m=l>0?Math.round(p/l*100)/100:0,c=P((t==null?void 0:t.goodsEur)??0);return{usd:p,eur:m>0?m:c,units:s}}function ke(t,e){if(((t==null?void 0:t.freightMode)==="per_unit"?"per_unit":"total")==="per_unit"){const p=P((t==null?void 0:t.freightPerUnitEur)??0),s=Number((e==null?void 0:e.units)??0)||0,i=p*s;return Math.round(i*100)/100}return P((t==null?void 0:t.freightEur)??0)}function Ke(t){if(Array.isArray(t==null?void 0:t.items)&&t.items.length)return t.items.map(s=>{const i=String((s==null?void 0:s.sku)||"").trim();if(!i)return null;const l=(s==null?void 0:s.units)??(s==null?void 0:s.qty)??(s==null?void 0:s.quantity)??0,m=Math.max(0,P(l));return{...s,sku:i,units:m}}).filter(Boolean);const e=String((t==null?void 0:t.sku)||"").trim();if(!e)return[];const o=(t==null?void 0:t.units)??0,p=Math.max(0,P(o));return[{sku:e,units:p,unitCostUsd:t==null?void 0:t.unitCostUsd,unitExtraUsd:t==null?void 0:t.unitExtraUsd,extraFlatUsd:t==null?void 0:t.extraFlatUsd,prodDays:t==null?void 0:t.prodDays,transitDays:t==null?void 0:t.transitDays,freightEur:t==null?void 0:t.freightEur}]}function Fe(t){const e=(t==null?void 0:t.order)||{},o=(t==null?void 0:t.profileBySku)instanceof Map?t.profileBySku:new Map,p=(t==null?void 0:t.poSkuSet)instanceof Set?t.poSkuSet:new Set,s=(t==null?void 0:t.fallbackBucket)||J.CORE,i=Ke(e);if(!i.length)return[{bucket:s,share:1,row:{...e,payments:Array.isArray(e==null?void 0:e.payments)?e.payments.filter(Boolean).map(c=>({...c})):e==null?void 0:e.payments}}];const l=new Map;let m=0;return i.forEach(c=>{const b=String((c==null?void 0:c.sku)||"").trim();if(!b)return;const r=xt(b),N=o.get(r);if(!(N?N.includeInForecast:Re(void 0,!0)))return;const k=N?N.effectivePortfolioBucket:te({sku:b,poSkuSet:p,fallbackBucket:s}),$=P((c==null?void 0:c.units)??0),D=Number.isFinite($)&&$>0?$:1;m+=D,l.has(k)||l.set(k,{bucket:k,items:[],weight:0});const L=l.get(k);L.items.push(c),L.weight+=D}),l.size?Array.from(l.values()).map((c,b,r)=>{const N=m>0?c.weight/m:r.length?1/r.length:1,T=Array.isArray(e==null?void 0:e.payments)?e.payments.filter(Boolean).map(L=>{const U=Number(L==null?void 0:L.amount);return Number.isFinite(U)?{...L,amount:Math.round(U*N*100)/100}:{...L}}):void 0,k=(e==null?void 0:e.freightMode)==="per_unit"?"per_unit":"total",$=P((e==null?void 0:e.freightEur)??0),D={...e,items:c.items.map(L=>({...L})),payments:T,freightMode:k,freightEur:k==="total"?Math.round($*N*100)/100:e==null?void 0:e.freightEur};return{bucket:c.bucket,share:N,row:D}}):[]}function Je(t,e,o){const p=new Date(t,e+1,0).getDate(),s=Math.min(Math.max(1,o),p);return new Date(t,e,s)}function ve(t,e){const o=it(t);if(o==null)return null;const p=Math.floor(o/12),s=o%12;if(!e||e==="LAST"||e==="Letzter Tag"||e==="EOM")return new Date(p,s+1,0);const i=Number(e);return Number.isFinite(i)?Je(p,s,i):new Date(p,s+1,0)}function we(t){const e=String(t||"").trim().toUpperCase();return e?e==="PLANNED"?"ACTIVE":e==="CANCELLED"?"ARCHIVED":e:"DRAFT"}function tn(t){const e=we(t);return e==="DRAFT"||e==="ACTIVE"}function en(t,e,o,p){if(!e||!e.proration||e.proration.enabled!==!0)return{amount:t,applied:!1};if(e.proration.method!=="daily")return{amount:t,applied:!1};const s=it(o);if(s==null)return{amount:t,applied:!1};const i=Math.floor(s/12),l=s%12,m=new Date(i,l+1,0).getDate(),c=p instanceof Date&&!Number.isNaN(p.getTime())?p:ve(o,e.anchor),b=c instanceof Date?c.getDate():m;let r=1;e.startMonth&&e.startMonth===o&&(r*=Math.max(0,m-b+1)/m),e.endMonth&&e.endMonth===o&&(r*=Math.max(0,b)/m);const N=Math.round(t*r*100)/100;return!Number.isFinite(N)||N===t?{amount:t,applied:!1}:{amount:N,applied:!0}}function xe({statusRecord:t,autoEligible:e,autoManualCheck:o,entryTime:p,todayTime:s,defaultPaid:i}){const l=typeof(t==null?void 0:t.manual)=="boolean"?t.manual:void 0;let m=!1,c=!1;typeof l=="boolean"?m=l:e&&!o&&p!=null&&p<=s?(m=!0,c=!0):m=!!i;const b=e&&o&&!c;let r=null;return e&&(c?r="Automatisch bezahlt am Fälligkeitstag":o?r="Automatische Zahlung – manuelle Prüfung aktiv":r="Automatische Zahlung"),{paid:m,autoApplied:c,manualOverride:typeof l=="boolean",autoSuppressed:b,autoTooltip:r}}function nn(t,e={}){const o=t||{},p=e.startMonth||o.settings&&o.settings.startMonth||"2025-01",s=Number(e.horizon||o.settings&&o.settings.horizonMonths||12),i=Array.isArray(e.months)&&e.months.length?e.months:Se(p,s),l=Array.isArray(o.fixcosts)?o.fixcosts:[],m=o.fixcostOverrides&&typeof o.fixcostOverrides=="object"?o.fixcostOverrides:{},c=e.status&&typeof e.status=="object"?e.status:o.status||{},b=e.statusEvents&&typeof e.statusEvents=="object"?e.statusEvents:c.events||{},r=e.autoManualCheck!=null?e.autoManualCheck===!0:c.autoManualCheck===!0,N=e.today?new Date(e.today):new Date;N.setHours(0,0,0,0);const T=N.getTime(),k=[],$=new Set(i);return l.forEach((D,L)=>{if(!D)return;const U=D.id||`fix-${L}`,H=D.startMonth||p,tt=it(H);if(tt==null)return;const Y=D.endMonth||null,Z=Y?it(Y):null,h=(D.frequency||"monthly").toLowerCase();let M=1;h==="quarterly"?M=3:h==="semiannual"||h==="halbjährlich"?M=6:h==="annual"||h==="jährlich"||h==="yearly"?M=12:(h==="custom"||h==="benutzerdefiniert")&&(M=Number(D.intervalMonths||D.everyMonths||1)||1),M<1&&(M=1);const _=D.anchor,F=!_||_==="Letzter Tag"?"LAST":String(_),A=m[U]&&typeof m[U]=="object"?m[U]:{},x=D.name||"Fixkosten",I=D.category||"Sonstiges",O=Math.abs(P(D.amount)),et=D.notes||"",S=D.autoPaid===!0;i.forEach(V=>{if(!$.has(V))return;const Dt=it(V);if(Dt==null||Dt<tt||Z!=null&&Dt>Z||(Dt-tt)%M!==0)return;const pt=ve(V,F),q=A[V]&&typeof A[V]=="object"?A[V]:{};let X=pt;if(q.dueDate&&/^\d{4}-\d{2}-\d{2}$/.test(q.dueDate)){const rt=new Date(q.dueDate);Number.isNaN(rt.getTime())||(X=rt)}let Mt=O,st=!1;q.amount!=null&&String(q.amount).trim()!==""&&(Mt=Math.abs(P(q.amount)),st=!0);let Pt=!1;if(!st){const rt=en(O,D,V,X);Mt=rt.amount,Pt=rt.applied}const zt=`fix-${U}-${V}`,Lt=X instanceof Date&&!Number.isNaN(X.getTime())?X.getTime():null,Qt=b[zt],ut=xe({statusRecord:Qt,autoEligible:S,autoManualCheck:r,entryTime:Lt,todayTime:T,defaultPaid:!1}),ht=X instanceof Date&&!Number.isNaN(X.getTime())?mt(X):null,It=q.note||"",ct=[x];st&&ct.push("Override aktiv"),Pt&&ct.push("Proratiert");const kt=ct.length>1?ct.join(" · "):null;k.push({id:zt,month:V,amount:Mt,baseAmount:O,label:x,category:I,dueDate:X,dueDateIso:ht,fixedCostId:U,autoPaid:S,notes:et,override:{amount:q.amount||"",dueDate:q.dueDate||"",note:It},overrideActive:st||!!q.dueDate||!!It,prorationApplied:Pt,paid:ut.paid,autoApplied:ut.autoApplied,manualOverride:ut.manualOverride,autoTooltip:ut.autoTooltip,autoSuppressed:ut.autoSuppressed,anchor:F,frequency:h,tooltip:kt})})}),k.sort((D,L)=>{if(D.month===L.month){const U=D.dueDate instanceof Date?D.dueDate.getTime():0,H=L.dueDate instanceof Date?L.dueDate.getTime():0;return U-H}return it(D.month)-it(L.month)}),k}function an(t){const e=t||{};return{dutyRatePct:G(e.dutyRatePct??0),dutyIncludeFreight:e.dutyIncludeFreight!==!1,eustRatePct:G(e.eustRatePct??0),vatRefundLagMonths:Number(e.vatRefundLagMonths??0)||0,vatRefundEnabled:e.vatRefundEnabled!==!1,freightLagDays:Number(e.freightLagDays??0)||0,fxFeePct:G(e.fxFeePct??0)}}function on(t,e,o){const p=["freight","duty","eust","vat_refund","fx_fee"],s=Array.isArray(t.autoEvents)?t.autoEvents.filter(Boolean).map(c=>({...c})):[],i=new Map;for(const c of s)!c||!c.type||(c.id||(c.id=`auto-${c.type}`),i.set(c.type,c));const l=(o||[])[0]||null;function m(c,b){if(!i.has(c)){const N={id:`auto-${c}`,type:c,...b};return s.push(N),i.set(c,N),N}const r=i.get(c);r.id||(r.id=`auto-${c}`);for(const[N,T]of Object.entries(b))r[N]===void 0&&(r[N]=T);return r}if(m("freight",{label:"Fracht",anchor:"ETA",lagDays:e.freightLagDays,enabled:!0}),m("duty",{label:"Zoll",percent:e.dutyRatePct,anchor:"ETA",lagDays:e.freightLagDays}),m("eust",{label:"EUSt",percent:e.eustRatePct,anchor:"ETA",lagDays:e.freightLagDays}),m("vat_refund",{label:"EUSt-Erstattung",percent:100,anchor:"ETA",lagMonths:e.vatRefundLagMonths,enabled:e.vatRefundEnabled}),m("fx_fee",{label:"FX-Gebühr",percent:e.fxFeePct,anchor:l&&l.anchor||"ORDER_DATE",lagDays:l&&Number(l.lagDays||0)||0}),s.sort((c,b)=>p.indexOf(c.type)-p.indexOf(b.type)),t.ddp)for(const c of s)(c.type==="freight"||c.type==="duty"||c.type==="eust"||c.type==="vat_refund")&&(c.enabled=!1);return s}function Ae(t,e,o,p){var Z;if(!t)return[];const s=o||"PO",i=t[p],l=i?`${s} ${i}`:s;if(Array.isArray(t.payments)&&t.payments.length){const h=Pe(t,e);return t.payments.filter(Boolean).map((M,_)=>{const F=M.triggerEvent||"ORDER_DATE",A=F==="PROD_DONE"?"PROD_DONE":F,x=h[A]||h.ORDER_DATE,I=M.dueDate?new Date(M.dueDate):w(x,Number(M.offsetDays||0)),O=Number(M.amount||0),et=O>=0?"out":"in",S=Math.abs(O);return{label:`${l}${M.label?` – ${M.label}`:""}`,amount:S,due:I,month:ot(I),direction:et,type:"manual",anchor:A,lagDays:Number(M.offsetDays||0)||0,percent:Number(M.percent||0),sourceType:s,sourceNumber:i,sourceId:t.id,id:M.id||`${t.id||s}-pay-${_}`,tooltip:`Fälligkeit: ${A} + ${Number(M.offsetDays||0)} Tage`}})}const m=Xe(t,e),c=m.eur,b=ke(t,m),r=Pe(t,e),N=Array.isArray(t.milestones)?t.milestones:[],T=on(t,e,N),k=[];for(const[h,M]of N.entries()){const _=G(M.percent),F=r[M.anchor||"ORDER_DATE"]||r.ORDER_DATE,A=w(F,Number(M.lagDays||0)),x=M.id||`${t.id||s}-${h}-${M.id||"manual"}`;k.push({label:`${l}${M.label?` – ${M.label}`:""}`,amount:c*(_/100),due:A,month:ot(A),direction:"out",type:"manual",anchor:M.anchor||"ORDER_DATE",lagDays:Number(M.lagDays||0)||0,percent:_,sourceType:s,sourceNumber:i,sourceId:t.id,id:x,tooltip:`Fälligkeit: ${M.anchor||"ORDER_DATE"} + ${Number(M.lagDays||0)} Tage`})}const $=t.dutyIncludeFreight!==!1,D=G(t.dutyRatePct??e.dutyRatePct??0),L=G(t.eustRatePct??e.eustRatePct??0),U=G(t.fxFeePct??e.fxFeePct??0),H=Number(t.vatRefundLagMonths??e.vatRefundLagMonths??0),tt=t.vatRefundEnabled!==!1,Y={};for(const h of T){if(!h||h.enabled===!1)continue;const M=h.anchor||"ETA",_=r[M]||r.ETA;if(!(!(_ instanceof Date)||Number.isNaN(_.getTime()))){if(h.type==="freight"){const F=ke(t,m);if(!F)continue;const A=h.id||`${t.id||s}-auto-freight`,x=w(_,Number(h.lagDays||0));k.push({label:`${l} – ${h.label||"Fracht"}`,amount:F,due:x,month:ot(x),direction:"out",type:"freight",anchor:h.anchor||"ETA",lagDays:Number(h.lagDays||0)||0,sourceType:s,sourceNumber:i,sourceId:t.id,id:A,tooltip:"Frachtkosten laut Eingabe"});continue}if(h.type==="duty"){const F=G(h.percent??D),A=w(_,Number(h.lagDays||0)),I=(c+($?b:0))*(F/100),O=h.id||`${t.id||s}-auto-duty`;Y.duty={amount:I,due:A},k.push({label:`${l} – ${h.label||"Zoll"}`,amount:I,due:A,month:ot(A),direction:"out",type:"duty",anchor:h.anchor||"ETA",lagDays:Number(h.lagDays||0)||0,percent:F,sourceType:s,sourceNumber:i,sourceId:t.id,id:O,tooltip:`Zoll = ${F}% × (Warenwert${$?" + Fracht":""})`});continue}if(h.type==="eust"){const F=G(h.percent??L),A=Math.abs(((Z=Y.duty)==null?void 0:Z.amount)||0),x=c+b+A,I=w(_,Number(h.lagDays||0)),O=x*(F/100),et=h.id||`${t.id||s}-auto-eust`;Y.eust={amount:O,due:I},k.push({label:`${l} – ${h.label||"EUSt"}`,amount:O,due:I,month:ot(I),direction:"out",type:"eust",anchor:h.anchor||"ETA",lagDays:Number(h.lagDays||0)||0,percent:F,sourceType:s,sourceNumber:i,sourceId:t.id,id:et,tooltip:`EUSt = ${F}% × (Warenwert + Fracht + Zoll)`});continue}if(h.type==="vat_refund"){const F=Y.eust;if(!tt||!F||F.amount===0)continue;const A=G(h.percent??100),x=Number((h.lagMonths??H)||0),I=w(F.due||_,Number(h.lagDays||0)),O=Ge(Ve(I,x)),et=Math.abs(F.amount)*(A/100),S=h.id||`${t.id||s}-auto-vat`;k.push({label:`${l} – ${h.label||"EUSt-Erstattung"}`,amount:et,due:O,month:ot(O),direction:"in",type:"vat_refund",anchor:h.anchor||"ETA",lagMonths:x,percent:A,sourceType:s,sourceNumber:i,sourceId:t.id,id:S,tooltip:`Erstattung am Monatsende nach ${x} Monaten`});continue}if(h.type==="fx_fee"){const F=G(h.percent??U);if(!F)continue;const A=w(_,Number(h.lagDays||0)),x=c*(F/100),I=h.id||`${t.id||s}-auto-fx`;k.push({label:`${l} – ${h.label||"FX-Gebühr"}`,amount:x,due:A,month:ot(A),direction:"out",type:"fx_fee",anchor:h.anchor||"ORDER_DATE",lagDays:Number(h.lagDays||0)||0,percent:F,sourceType:s,sourceNumber:i,sourceId:t.id,id:I,tooltip:`FX-Gebühr = ${F}% × Warenwert`})}}}return k}function ln(t){var re,ie,le,de,fe,me,pe,he,be,ge;const e=t||{},o=e.settings&&e.settings.startMonth||"2025-01",p=Number(e.settings&&e.settings.horizonMonths||12),s=Se(o,p),i=e.status&&typeof e.status=="object"?e.status:{},l=i.events&&typeof i.events=="object"?i.events:{},m=i.autoManualCheck===!0,c=new Date;c.setHours(0,0,0,0);const b=c.getTime(),r={};s.forEach(n=>{r[n]={entries:[]}});const{map:N,poSkuSet:T}=Be(e);function k(n){const a=xt(n);return a?N.get(a)||{includeInForecast:!0,effectivePortfolioBucket:te({sku:n,poSkuSet:T,fallbackBucket:J.CORE})}:{includeInForecast:!0,effectivePortfolioBucket:J.CORE}}function $(n,a){r[n]&&r[n].entries.push(a)}function D(n,a={}){const d=n.id||`${n.month||""}-${n.label||""}-${n.date||""}`,g=l[d],u=n.date?new Date(n.date):null,y=u&&Number.isFinite(u.getTime())?new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime():null,E=a.auto===!0,R=E&&a.autoEligible!==!1,v=typeof n.paid=="boolean"?n.paid:!!a.defaultPaid,B=xe({statusRecord:g,autoEligible:R,autoManualCheck:m,entryTime:y,todayTime:b,defaultPaid:v}),z={...n.meta&&typeof n.meta=="object"?n.meta:{}},Q=n.portfolioBucket?Rt(n.portfolioBucket,J.CORE):null;return Q&&(z.portfolioBucket=Q),{id:d,direction:n.direction||"in",amount:Math.abs(n.amount||0),label:n.label||"",month:n.month,date:n.date,kind:n.kind,group:n.group,paid:B.paid,source:n.source||null,anchor:n.anchor,lagDays:n.lagDays,lagMonths:n.lagMonths,percent:n.percent,scenarioDelta:n.scenarioDelta||0,scenarioAmount:n.scenarioAmount||n.amount||0,meta:z,portfolioBucket:Q,tooltip:n.tooltip,sourceTab:n.sourceTab,sourceNumber:n.sourceNumber,sourceId:n.sourceId,statusId:d,auto:E,autoEligible:R,autoApplied:B.autoApplied,autoManualCheck:m,manualOverride:B.manualOverride,autoSuppressed:B.autoSuppressed,autoTooltip:B.autoTooltip}}nn(e,{months:s,statusEvents:l,autoManualCheck:m,today:c}).map(n=>({id:n.id,direction:"out",amount:n.amount,label:n.label,month:n.month,date:n.dueDateIso,kind:"fixcost",group:"Fixkosten",source:"fixcosts",sourceTab:"#fixkosten",meta:{fixedCostId:n.fixedCostId,category:n.category,override:n.overrideActive,overrideAmount:n.override.amount,overrideDueDate:n.override.dueDate,overrideNote:n.override.note,notes:n.notes,baseAmount:n.baseAmount,prorationApplied:n.prorationApplied},tooltip:n.tooltip,auto:n.autoPaid,autoEligible:n.autoPaid})).forEach(n=>{$(n.month,D(n,{auto:n.auto,autoEligible:n.autoEligible}))});const U=!!((ie=(re=e==null?void 0:e.forecast)==null?void 0:re.settings)!=null&&ie.useForecast),H={},tt={},Y={},Z=Et.reduce((n,a)=>(n[a]={},n),{}),h=Et.reduce((n,a)=>(n[a]={},n),{});if(s.forEach(n=>{H[n]=0,tt[n]=0,Y[n]=0,Et.forEach(a=>{Z[a][n]=0,h[a][n]=0})}),U){(le=e==null?void 0:e.forecast)!=null&&le.forecastImport&&typeof e.forecast.forecastImport=="object"?Object.entries(e.forecast.forecastImport).forEach(([a,d])=>{const g=k(a);if(!g.includeInForecast)return;const u=Rt(g.effectivePortfolioBucket,J.CORE);Object.entries(d||{}).forEach(([y,E])=>{if(!y||!r[y])return;const R=P((E==null?void 0:E.revenueEur)??(E==null?void 0:E.revenue)??null);Number.isFinite(R)&&(H[y]=(H[y]||0)+R,Z[u][y]=(Z[u][y]||0)+R)})}):Array.isArray((de=e==null?void 0:e.forecast)==null?void 0:de.items)&&e.forecast.items.forEach(a=>{if(!a||!a.month||!a.sku)return;const d=k(a.sku);if(!d.includeInForecast)return;const g=Rt(d.effectivePortfolioBucket,J.CORE),u=a.month;if(!r[u])return;const y=Number(a.qty??a.quantity??0)||0,E=P(a.priceEur??a.price??0),R=y*E;H[u]=(H[u]||0)+R,Z[g][u]=(Z[g][u]||0)+R});const n=Oe({state:e,months:s});Object.entries((n==null?void 0:n.byBucket)||{}).forEach(([a,d])=>{const g=Rt(a,J.PLAN);Object.entries(d||{}).forEach(([u,y])=>{if(!r[u])return;const E=P(y);Number.isFinite(E)&&(tt[u]=(tt[u]||0)+E,h[g][u]=(h[g][u]||0)+E)})}),Object.keys(r).forEach(a=>{Y[a]=(H[a]||0)+(tt[a]||0)})}const M=Array.isArray(e.incomings)?e.incomings:[],_=new Map;M.forEach(n=>{if(!n||!n.month)return;const a=String(n.month||"").trim();a&&_.set(a,n)});const F=ot(c),A=it(F),x=Qe((fe=e==null?void 0:e.settings)==null?void 0:fe.cashInMode),I=je,O=_e,et=We(e),S=Ce({months:Object.keys(r),incomings:M,monthlyActuals:e==null?void 0:e.monthlyActuals,currentMonth:F,ignoreQ4:((me=e==null?void 0:e.settings)==null?void 0:me.cashInRecommendationIgnoreQ4)===!0,maxMonth:F,baselineNormalPct:(pe=e==null?void 0:e.settings)==null?void 0:pe.cashInRecommendationBaselineNormalPct,baselineQ4Pct:(he=e==null?void 0:e.settings)==null?void 0:he.cashInRecommendationBaselineQ4Pct,minSamples:4}),V=Ct(S.observedNormalMedianPct),Dt=Number.isFinite(V)?St(V,I,O):null,jt=Ct(S.baselineNormalPct),pt=Number.isFinite(jt)?St(jt,I,O):51,q=Ct(S.baselineQ4Pct),X=Number.isFinite(q)?St(q,I,O):pt,Mt="baseline_manual",st=((be=e==null?void 0:e.settings)==null?void 0:be.cashInCalibrationEnabled)!==!1,Pt=Le((ge=e==null?void 0:e.settings)==null?void 0:ge.cashInCalibrationHorizonMonths,6),Lt=Ue({incomings:st?M:[],months:Object.keys(r),forecastRevenueByMonth:Y,horizonMonths:Pt}),Qt=st&&Object.values(Lt.byMonth||{}).some(n=>{const a=Number((n==null?void 0:n.factor)||1);return Number.isFinite(a)&&Math.abs(a-1)>1e-6}),ut={},ht={};Object.keys(r).forEach(n=>{var Ee,Ne;const a=_.get(n)||null,d=String((a==null?void 0:a.source)||"").trim().toLowerCase(),u=(a==null?void 0:a.revenueEur)!=null&&String(a.revenueEur).trim()!==""?P(a.revenueEur):null,y=U&&d==="manual"&&Number.isFinite(u),E=(a==null?void 0:a.payoutPct)!=null&&String(a.payoutPct).trim()!=="",R=E?Ct(a.payoutPct):null,v=((Ee=S.byMonth)==null?void 0:Ee[n])||null,B=String((v==null?void 0:v.sourceTag)||"BASELINE_NORMAL"),z=String((v==null?void 0:v.explanation)||"").trim()||null,Q=Ct(v==null?void 0:v.quotePct),Ft=Number.isFinite(Q)?St(Q,I,O):pt,dt=E?"manual":"recommendation",Ut=St(E?R:Ft,I,O),bt=((Ne=Lt.byMonth)==null?void 0:Ne[n])||{factor:1,sourceMonth:null,method:null},gt=Number(Y[n]||0),at=Number(bt.factor||1),Tt=gt*at;let K=null,f=null;if(U)y?(K=Number(u),f="manual_override"):(K=Number(Tt||0),f="forecast_calibrated");else{if(!Number.isFinite(u))return;K=Number(u),f="manual_no_forecast"}if(!Number.isFinite(K))return;const C=it(n),At=C!=null&&A!=null?C-A:0,Zt=At>0,$t=Zt&&x==="conservative"?qe(At):0,$e=Zt?Ut-$t:Ut,ft=St($e,I,O),_t=U?Tt:K,Vt=U?gt:K;ut[n]=ft,ht[n]={mode:x,calibrationEnabled:st,isFutureMonth:Zt,horizonFromCurrentMonth:At,marginPct:$t,recommendationQuotePct:Ft,recommendationSourceTag:B,recommendationExplanation:z,payoutPct:ft,manualPayoutPct:R,quoteSource:dt,revenueSource:f,appliedRevenue:K,forecastRevenueRaw:gt,calibrationFactorApplied:at,calibrationSourceMonth:bt.sourceMonth||null,calibrationMethod:bt.method||null,planRevenueAfterCalibration:_t,fallbackUsed:Mt,quoteMinPct:I,quoteMaxPct:O};const Gt=wt(n);if(!U||y){const j=K*(ft/100),yt=Jt({forecastRevenue:Vt,calibrationFactorApplied:at,planRevenue:_t,payoutPct:ft,payoutAmount:j,quoteSource:dt,recommendationSourceTag:B,mode:x,marginPct:$t});$(n,D({id:`sales-${n}`,direction:j>=0?"in":"out",amount:Math.abs(j),label:"Amazon Payout",month:n,date:mt(Gt),kind:"sales-payout",group:j>=0?"Sales × Payout":"Extras (Out)",source:"sales",sourceTab:"#eingaben",tooltip:yt,portfolioBucket:null,meta:{cashIn:{...ht[n],revenue:K,payoutAmount:j}}},{auto:!1}));return}Et.forEach(j=>{var Bt;const yt=((Bt=Z[j])==null?void 0:Bt[n])||0,Ot=yt*at,W=Ot*(ft/100);if(Math.abs(W)>1e-6){const Xt=Jt({forecastRevenue:Vt,calibrationFactorApplied:at,planRevenue:_t,payoutPct:ft,payoutAmount:W,quoteSource:dt,recommendationSourceTag:B,mode:x,marginPct:$t});$(n,D({id:`sales-live-${j}-${n}`,direction:W>=0?"in":"out",amount:Math.abs(W),label:`Amazon Payout (Prognose - Live/CSV · ${j})`,month:n,date:mt(Gt),kind:"sales-payout",group:W>=0?"Sales × Payout":"Extras (Out)",source:"sales",sourceTab:"#forecast",tooltip:Xt,portfolioBucket:j,meta:{cashIn:{...ht[n],revenue:Ot,payoutAmount:W,component:"live",componentRevenueRaw:yt,portfolioBucket:j}}},{auto:!1}))}}),Et.forEach(j=>{var Bt;const yt=((Bt=h[j])==null?void 0:Bt[n])||0,Ot=yt*at,W=Ot*(ft/100);if(Math.abs(W)>1e-6){const Xt=Jt({forecastRevenue:Vt,calibrationFactorApplied:at,planRevenue:_t,payoutPct:ft,payoutAmount:W,quoteSource:dt,recommendationSourceTag:B,mode:x,marginPct:$t});$(n,D({id:`sales-plan-${j}-${n}`,direction:W>=0?"in":"out",amount:Math.abs(W),label:`Amazon Payout (Prognose - Plan · ${j})`,month:n,date:mt(Gt),kind:"sales-payout",group:W>=0?"Sales × Payout":"Extras (Out)",source:"sales-plan",sourceTab:"#forecast",tooltip:Xt,portfolioBucket:j,meta:{cashIn:{...ht[n],revenue:Ot,payoutAmount:W,component:"plan",componentRevenueRaw:yt,portfolioBucket:j}}},{auto:!1}))}})}),(Array.isArray(e.extras)?e.extras:[]).forEach(n=>{const a=n.month||(n.date?ot(n.date):null);if(!a||!r[a])return;const d=P(n.amountEur),g=d>=0?"in":"out",u=a,y=n.date?new Date(n.date):wt(u);$(u,D({id:`extra-${n.id||n.label||u}-${n.date||""}`,direction:g,amount:Math.abs(d),label:n.label||"Extra",month:u,date:mt(y),kind:"extra",group:g==="in"?"Extras (In)":"Extras (Out)",source:"extras",sourceTab:"#eingaben"},{auto:n.autoPaid===!0,autoEligible:n.autoPaid===!0}))}),(Array.isArray(e.dividends)?e.dividends:[]).forEach(n=>{const a=n.month||(n.date?ot(n.date):null);if(!a||!r[a])return;const d=P(n.amountEur),g=n.date?new Date(n.date):wt(a);$(a,D({id:`div-${n.id||n.label||a}`,direction:d>=0?"out":"in",amount:Math.abs(d),label:n.label||"Dividende",month:a,date:mt(g),kind:"dividend",group:"Dividende & KapESt",source:"dividends",sourceTab:"#eingaben"},{auto:!1}))}),(Array.isArray(e.products)?e.products:[]).forEach((n,a)=>{const d=n&&typeof n=="object"?n:{},g=String(d.sku||"").trim();if(!g)return;const u=k(g);if(!u.includeInForecast)return;const y=Rt(u.effectivePortfolioBucket,J.CORE),E=String(d.alias||g).trim()||g;De(d.launchCosts,`prod-${a+1}-lc`).forEach((v,B)=>{const z=String(v.date||"").slice(0,7);!z||!r[z]||$(z,D({id:`launch-product-${xt(g)}-${v.id||B+1}`,direction:"out",amount:Math.abs(P(v.amountEur)),label:`${E} · Launch-Kosten (${v.type||"Sonstiges"})`,month:z,date:v.date,kind:"launch-cost",group:"Launch-Kosten",source:"launch-costs",sourceTab:"#products",portfolioBucket:y,meta:{sku:g,alias:E,type:v.type||"Sonstiges",note:v.note||"",currency:v.currency||"EUR"}},{auto:!1}))})}),(Array.isArray(e.planProducts)?e.planProducts:[]).forEach((n,a)=>{const d=n&&typeof n=="object"?n:{};if(String(d.status||"active").trim().toLowerCase()!=="active"||!Re(d.includeInForecast,!0))return;const y=String(d.plannedSku||d.mappedSku||"").trim(),E=te({product:d,sku:y,poSkuSet:T,fallbackBucket:J.PLAN}),R=String(d.alias||y||`Planprodukt ${a+1}`).trim();De(d.launchCosts,`plan-${a+1}-lc`).forEach((B,z)=>{const Q=String(B.date||"").slice(0,7);!Q||!r[Q]||$(Q,D({id:`launch-plan-${xt(y||R)}-${B.id||z+1}`,direction:"out",amount:Math.abs(P(B.amountEur)),label:`${R} · Launch-Kosten (${B.type||"Sonstiges"})`,month:Q,date:B.date,kind:"launch-cost",group:"Launch-Kosten",source:"launch-costs",sourceTab:"#plan-products",portfolioBucket:E,meta:{sku:y||null,alias:R,type:B.type||"Sonstiges",note:B.note||"",currency:B.currency||"EUR",source:"plan-product"}},{auto:!1}))})});const It=an(e.settings);(Array.isArray(e.pos)?e.pos:[]).forEach(n=>{const a=Fe({order:n,profileBySku:N,poSkuSet:T,fallbackBucket:J.CORE}),d=a.length>1;a.forEach(g=>{Ae(g.row,It,"PO","poNo").forEach(u=>{const y=u.month;if(!r[y])return;const E=u.type==="manual"?"po":u.type==="vat_refund"?"po-refund":"po-import",R=E==="po"?"PO/FO-Zahlungen":"Importkosten";$(y,D({id:d?`${u.id||`po-${n.id||""}-${u.type}-${u.month}`}-${xt(g.bucket)}`:u.id||`po-${n.id||""}-${u.type}-${u.month}`,direction:u.direction==="in"?"in":"out",amount:Math.abs(u.amount||0),label:u.label,month:y,date:mt(u.due),kind:E,group:R,source:"po",sourceTab:"#po",anchor:u.anchor,lagDays:u.lagDays,lagMonths:u.lagMonths,percent:u.percent,sourceNumber:u.sourceNumber||n.poNo||n.id,sourceId:n.id||n.poNo||null,tooltip:u.tooltip,portfolioBucket:g.bucket,meta:{skuBucketShare:g.share}},{auto:u.type!=="manual",autoEligible:u.type!=="manual"}))})})}),(Array.isArray(e.fos)?e.fos:[]).forEach(n=>{if(!tn(n==null?void 0:n.status))return;const a=Fe({order:n,profileBySku:N,poSkuSet:T,fallbackBucket:J.CORE}),d=a.length>1;a.forEach(g=>{Ae(g.row,It,"FO","foNo").forEach(u=>{const y=u.month;if(!r[y])return;const E=u.type==="manual"?"fo":u.type==="vat_refund"?"fo-refund":"fo-import",R=E==="fo"?"PO/FO-Zahlungen":"Importkosten";$(y,D({id:d?`${u.id||`fo-${n.id||""}-${u.type}-${u.month}`}-${xt(g.bucket)}`:u.id||`fo-${n.id||""}-${u.type}-${u.month}`,direction:u.direction==="in"?"in":"out",amount:Math.abs(u.amount||0),label:u.label,month:y,date:mt(u.due),kind:E,group:R,source:"fo",sourceTab:"#fo",anchor:u.anchor,lagDays:u.lagDays,lagMonths:u.lagMonths,percent:u.percent,sourceNumber:u.sourceNumber||n.foNo||n.foNumber||n.id,sourceId:n.id||n.foNo||n.foNumber||null,tooltip:u.tooltip,portfolioBucket:g.bucket,meta:{skuBucketShare:g.share}},{auto:!1,autoEligible:!1,defaultPaid:!1}))})})});const ct=s.map(n=>{const d=r[n].entries||[],g=d.filter(f=>f.direction==="in"),u=d.filter(f=>f.direction==="out"),y=u.filter(f=>f.group==="Fixkosten"),E=y.reduce((f,C)=>f+(C.amount||0),0),R=y.filter(f=>f.paid).reduce((f,C)=>f+(C.amount||0),0),v=Math.max(0,E-R),B=y.slice().sort((f,C)=>(C.amount||0)-(f.amount||0)).slice(0,3).map(f=>({label:f.label,amount:f.amount,paid:f.paid,category:f.meta&&f.meta.category?f.meta.category:null})),z=g.reduce((f,C)=>f+(C.amount||0),0),Q=u.reduce((f,C)=>f+(C.amount||0),0),Ft=g.filter(f=>f.paid).reduce((f,C)=>f+(C.amount||0),0),dt=u.filter(f=>f.paid).reduce((f,C)=>f+(C.amount||0),0),ye=Math.max(0,z-Ft),Ut=Math.max(0,Q-dt),bt={},gt={};Et.forEach(f=>{bt[f]=0,gt[f]=0}),d.forEach(f=>{var At;const C=Rt((f==null?void 0:f.portfolioBucket)||((At=f==null?void 0:f.meta)==null?void 0:At.portfolioBucket),"");!C||!Et.includes(C)||(f.direction==="in"?bt[C]+=Math.abs(Number(f.amount||0)):f.direction==="out"&&(gt[C]+=Math.abs(Number(f.amount||0))))});const at=z-Q,Tt=Ft-dt,K=at-Tt;return{month:n,inflow:{total:z,paid:Ft,open:ye},outflow:{total:Q,paid:dt,open:Ut},bucketBreakdown:{inflow:bt,outflow:gt},net:{total:at,paid:Tt,open:K},fixcost:{total:E,paid:R,open:v,top:B},itemsIn:g.map(f=>({kind:f.kind,label:f.label,amount:f.amount})),itemsOut:u.map(f=>({kind:f.kind,label:f.label,amount:f.amount})),entries:d}}),kt=P(e.settings&&e.settings.openingBalance),rt=ct.map(n=>n.itemsIn.filter(a=>a.kind==="sales-payout").reduce((a,d)=>a+d.amount,0)),ee=rt.length?rt.reduce((n,a)=>n+a,0)/(rt.filter(n=>n>0).length||1):0,ne={},ae={};Object.keys(r).forEach(n=>{const a=ht[n];if(!a)return;const d=Number(a.appliedRevenue||0),g=Number.isFinite(ut[n])?Number(ut[n]):pt;ne[n]=d,ae[n]=d*(g/100)});const qt={opening:kt,openingToday:kt,salesPayoutAvg:ee,avgSalesPayout:ee,firstNegativeMonth:null,actuals:{},cashIn:{mode:x,basisMethod:"baseline",basisQuotePct:pt,istMonthsCount:S.sampleCount,hasIstData:S.sampleCount>0,fallbackUsed:Mt,quoteMinPct:I,quoteMaxPct:O,recommendationMedianPct:Dt,recommendationSampleCount:S.sampleCount,recommendationUsedMonths:S.usedMonths,recommendationUncertain:S.uncertain,recommendationIgnoreQ4:S.ignoreQ4,recommendationBaselineNormalPct:pt,recommendationBaselineQ4Pct:X,recommendationBaselineQ4SuggestedPct:S.baselineQ4SuggestedPct,recommendationObservedNormalMedianPct:S.observedNormalMedianPct,recommendationObservedNormalAveragePct:S.observedNormalAveragePct,recommendationObservedNormalSampleCount:S.observedNormalSampleCount,recommendationObservedNormalWithForecastMedianPct:S.observedNormalWithForecastMedianPct,recommendationObservedNormalWithForecastAveragePct:S.observedNormalWithForecastAveragePct,recommendationObservedNormalWithForecastSampleCount:S.observedNormalWithForecastSampleCount,recommendationCurrentMonthForecastQuotePct:S.currentMonthForecastQuotePct,recommendationCurrentMonth:S.currentMonth,calibrationEnabled:st,calibrationApplied:Qt,calibrationHorizonMonths:Pt,marginBucketsPct:{plus1:1,plus2:2,plus3:3,plus4:4,plus5plus:5}}};let Wt=kt;const oe=s.map((n,a)=>{const d=ct[a],g=Wt;return Wt+=d.net.total,{month:n,opening:g,closing:Wt,inflow:d.inflow.total,outflow:d.outflow.total,net:d.net.total,entries:d.entries}});let se=kt;const ue=s.map((n,a)=>{var v;const d=ct[a],g=se,u=g+d.net.total,y=(v=et.get(n))==null?void 0:v.closing,E=Number.isFinite(y),R=E?Number(y):u;return se=R,{month:n,opening:g,closing:R,inflow:d.inflow.total,outflow:d.outflow.total,net:d.net.total,entries:d.entries,plannedClosing:u,actualClosing:E?Number(y):null}}),ce=ue.find(n=>Number(n.closing||0)<0);qt.firstNegativeMonth=ce?ce.month:null;const lt=[];et.forEach((n,a)=>{const d=s.indexOf(a);if(d===-1)return;const g=d>=0&&d<oe.length?oe[d]:null,u=g?g.closing:null,y=ne[a]??null,E=ae[a]??null;lt.push({month:a,plannedRevenue:y,actualRevenue:n.revenue,revenueDelta:(n.revenue??0)-(y??0),revenueDeltaPct:y?((n.revenue??0)-y)/y*100:null,plannedPayout:E,actualPayout:n.payout,payoutDelta:(n.payout??0)-(E??0),payoutDeltaPct:E?((n.payout??0)-E)/E*100:null,plannedClosing:u,actualClosing:n.closing,closingDelta:(n.closing??0)-(u??0)})}),lt.sort((n,a)=>(n.month||"").localeCompare(a.month||""));const nt=lt[lt.length-1]||null,Ht=lt.map(n=>n.revenueDeltaPct).filter(n=>Number.isFinite(n)),Yt=lt.map(n=>n.payoutDeltaPct).filter(n=>Number.isFinite(n)),Ie=Ht.length?Ht.reduce((n,a)=>n+a,0)/Ht.length:null,Te=Yt.length?Yt.reduce((n,a)=>n+a,0)/Yt.length:null;return qt.actuals={count:lt.length,lastMonth:nt?nt.month:null,lastClosing:nt?nt.actualClosing:null,closingDelta:nt?nt.closingDelta:null,revenueDeltaPct:nt?nt.revenueDeltaPct:null,payoutDeltaPct:nt?nt.payoutDeltaPct:null,avgRevenueDeltaPct:Ie,avgPayoutDeltaPct:Te},{startMonth:o,horizon:p,months:s,series:ct,kpis:qt,breakdown:ue,actualComparisons:lt}}export{ln as c,nn as e,rn as f,P as p};
