function P(e){if(e==null||e==="")return null;if(typeof e=="number")return Number.isFinite(e)?e:null;const n=String(e).trim();if(!n)return null;const l=n.includes(",")?n.replace(/\./g,"").replace(",","."):n,a=Number(l);return Number.isFinite(a)?a:null}function N(e,n){const s=P(e),l=P(n);return s==null||l==null||l<=0?null:s/l}function A({unitPriceUsd:e,landedCostEur:n,fxUsdPerEur:s}){const l=[],a=P(e),i=P(n),t=P(s);if((a==null||a<=0)&&l.push("unitPriceUsd"),(i==null||i<=0)&&l.push("landedCostEur"),(t==null||t<=0)&&l.push("fxUsdPerEur"),l.length)return{value:null,warning:!1,goodsCostEur:null,missingFields:l};const u=N(a,t);if(u==null)return{value:null,warning:!1,goodsCostEur:null,missingFields:["fxUsdPerEur"]};const f=i-u,m=f<0;return{value:Number.isFinite(f)?Math.max(0,f):null,warning:m,goodsCostEur:u,missingFields:[]}}function r(e){if(e==null||e==="")return null;if(typeof e=="number")return Number.isFinite(e)?e:null;const n=String(e).trim();if(!n)return null;const s=n.includes(",")?n.replace(/\./g,"").replace(",","."):n,l=Number(s);return Number.isFinite(l)?l:null}function y(e){return String(e||"").trim().toLowerCase()}function K(e,n){const s=y(n);return s&&(e||[]).find(l=>y(l==null?void 0:l.sku)===s)||null}function w(e,n){if(!n)return null;const s=String(n||"").trim();return(e||[]).find(l=>String((l==null?void 0:l.id)||"").trim()===s)||null}function z(e,n){const s=y(n);if(!s)return null;const a=(e||[]).filter(Boolean).filter(i=>{const t=y(i==null?void 0:i.sku)===s,u=Array.isArray(i==null?void 0:i.items)?i.items.some(f=>y(f==null?void 0:f.sku)===s):!1;return t||u}).sort((i,t)=>String(t.orderDate||t.createdAt||"").localeCompare(String(i.orderDate||i.createdAt||""))).find(i=>(i==null?void 0:i.supplierId)||(i==null?void 0:i.supplier));return a&&String(a.supplierId||a.supplier||"").trim()||null}function q(e,n,s){const l=y(n);if(!l)return null;const a=((e==null?void 0:e.productSuppliers)||[]).filter(t=>y(t==null?void 0:t.sku)===l);if(!a.length)return null;if(s){const t=a.find(u=>String((u==null?void 0:u.supplierId)||"").trim()===String(s).trim());if(t)return t}return a.find(t=>t==null?void 0:t.isPreferred)||a[0]||null}function B(e,n,s){const l=K((e==null?void 0:e.products)||[],n),a=s||(l==null?void 0:l.supplierId),i=q(e,n,a),t=a||(i==null?void 0:i.supplierId)||z([...(e==null?void 0:e.pos)||[],...(e==null?void 0:e.fos)||[]],n)||"",u=w((e==null?void 0:e.suppliers)||[],t);return{product:l,supplier:u,supplierId:t,productSupplier:i}}function X(e,n){var a;const s=((a=e==null?void 0:e.template)==null?void 0:a.fields)||(e==null?void 0:e.template)||{},l=r((e==null?void 0:e.fxOverride)??(e==null?void 0:e.fxUsdPerEur)??s.fxRate??(n==null?void 0:n.fxRate));return l!=null&&l>0?{value:l,source:(e==null?void 0:e.fxOverride)!=null||(e==null?void 0:e.fxUsdPerEur)!=null||s.fxRate!=null?"product":"settings"}:{value:null,source:null}}function c({product:e,productSupplier:n,supplier:s,settings:l}){const a=r((e==null?void 0:e.productionLeadTimeDays)??(e==null?void 0:e.productionLeadTimeDaysDefault));if(a!=null&&a>0)return{value:a,source:"product"};const i=r(n==null?void 0:n.productionLeadTimeDays);if(i!=null&&i>0)return{value:i,source:"productSupplier"};const t=r(s==null?void 0:s.productionLeadTimeDaysDefault);if(t!=null&&t>0)return{value:t,source:"supplier"};const u=r(l==null?void 0:l.defaultProductionLeadTimeDays);return u!=null&&u>0?{value:u,source:"settings"}:{value:null,source:null}}function O({product:e,transportMode:n}){var a;const s=((a=e==null?void 0:e.template)==null?void 0:a.fields)||(e==null?void 0:e.template)||{},l=n||s.transportMode||(e==null?void 0:e.defaultTransportMode)||s.transport||"SEA";return String(l).toUpperCase()}function W({settings:e,product:n,transportMode:s}){var u;const l=((u=n==null?void 0:n.template)==null?void 0:u.fields)||(n==null?void 0:n.template)||{},a=r((n==null?void 0:n.transitDays)??l.transitDays);if(a!=null&&a>0)return{value:a,source:"product"};const i=(e==null?void 0:e.transportLeadTimesDays)||{},t=r(i[String(s||"SEA").toLowerCase()]);return t!=null&&t>0?{value:t,source:"settings"}:{value:null,source:null}}function G({product:e,productSupplier:n}){var i;const s=((i=e==null?void 0:e.template)==null?void 0:i.fields)||(e==null?void 0:e.template)||{},l=r(n==null?void 0:n.unitPrice);if(l!=null&&l>0)return{value:l,source:"productSupplier"};const a=r(s.unitPriceUsd??(e==null?void 0:e.unitPriceUsd)??(e==null?void 0:e.defaultUnitPrice)??(e==null?void 0:e.unitPrice));return a!=null&&a>0?{value:a,source:"product"}:{value:null,source:null}}function _({product:e,productSupplier:n,supplier:s,settings:l}){var u;const a=((u=e==null?void 0:e.template)==null?void 0:u.fields)||(e==null?void 0:e.template)||{},i=(n==null?void 0:n.currency)||(s==null?void 0:s.currencyDefault)||a.currency||(l==null?void 0:l.defaultCurrency),t=String(i||"EUR").trim().toUpperCase();return["EUR","USD","CNY"].includes(t)?t:"EUR"}function d({product:e,productSupplier:n,fxRate:s,unitPriceUsd:l}){var m;const a=((m=e==null?void 0:e.template)==null?void 0:m.fields)||(e==null?void 0:e.template)||{},i=r((e==null?void 0:e.logisticsPerUnitEur)??(e==null?void 0:e.freightPerUnitEur)??a.freightEur??(n==null?void 0:n.logisticsPerUnitEur));if(i!=null&&i>0)return{value:i,source:"product"};const t=r(a.extraPerUnitUsd)||0,u=r(e==null?void 0:e.landedUnitCostEur),f=A({unitPriceUsd:l!=null?l+t:null,landedCostEur:u,fxUsdPerEur:s});return f.value!=null?{value:f.value,source:"computed"}:{value:null,source:null,missingFields:f.missingFields||[]}}function p({product:e,settings:n}){var a;const s=((a=e==null?void 0:e.template)==null?void 0:a.fields)||(e==null?void 0:e.template)||{},l=r((e==null?void 0:e.dutyRatePct)??s.dutyPct??(n==null?void 0:n.dutyRatePct));return Number.isFinite(l)?l:null}function ee({product:e,settings:n}){var a;const s=((a=e==null?void 0:e.template)==null?void 0:a.fields)||(e==null?void 0:e.template)||{},l=r((e==null?void 0:e.eustRatePct)??s.vatImportPct??(n==null?void 0:n.eustRatePct));return Number.isFinite(l)?l:null}function ne({product:e,settings:n}){var l;const s=((l=e==null?void 0:e.template)==null?void 0:l.fields)||(e==null?void 0:e.template)||{};return typeof s.ddp=="boolean"?s.ddp:typeof(e==null?void 0:e.ddp)=="boolean"?e.ddp:typeof(n==null?void 0:n.defaultDdp)=="boolean"?n.defaultDdp:!1}function le({productSupplier:e,supplier:n}){return Array.isArray(e==null?void 0:e.paymentTermsTemplate)&&e.paymentTermsTemplate.length?{value:e.paymentTermsTemplate,source:"productSupplier"}:Array.isArray(n==null?void 0:n.paymentTermsDefault)&&n.paymentTermsDefault.length?{value:n.paymentTermsDefault,source:"supplier"}:{value:null,source:null}}function S(e){return String(e||"").trim()}function Q({product:e,productSupplier:n,supplier:s,settings:l}){var m;const a=((m=e==null?void 0:e.template)==null?void 0:m.fields)||(e==null?void 0:e.template)||{};let i=null,t=null;n!=null&&n.currency?(i="productSupplier",t=n.currency):s!=null&&s.currencyDefault?(i="supplier",t=s.currencyDefault):a.currency?(i="template",t=a.currency):l!=null&&l.defaultCurrency&&(i="settings",t=l.defaultCurrency);const u=String(t||"EUR").trim().toUpperCase(),f=["EUR","USD","CNY"].includes(u)?u:"EUR";return!i&&f==="EUR"?{value:f,source:"fallback"}:{value:f,source:i}}function Y({product:e,settings:n}){var t;const s=((t=e==null?void 0:e.template)==null?void 0:t.fields)||(e==null?void 0:e.template)||{},l=r(e==null?void 0:e.dutyRatePct);if(l!=null)return{value:l,source:"product"};const a=r(s.dutyPct);if(a!=null)return{value:a,source:"template"};const i=r(n==null?void 0:n.dutyRatePct);return i!=null?{value:i,source:"settings"}:{value:null,source:null}}function Z({product:e,settings:n}){var t;const s=((t=e==null?void 0:e.template)==null?void 0:t.fields)||(e==null?void 0:e.template)||{},l=r(e==null?void 0:e.eustRatePct);if(l!=null)return{value:l,source:"product"};const a=r(s.vatImportPct);if(a!=null)return{value:a,source:"template"};const i=r(n==null?void 0:n.eustRatePct);return i!=null?{value:i,source:"settings"}:{value:null,source:null}}function o(e,n){return{fieldKey:e,label:n}}function se(e,n={}){const s=n.state||{},l=n.settings||s.settings||{},a=n.suppliers||s.suppliers||[],i=n.productSuppliers||s.productSuppliers||[],t=n.pos||s.pos||[],u=n.fos||s.fos||[],f=[],m=[],U=[],k=S(e==null?void 0:e.sku);k||f.push(o("sku","SKU")),S(e==null?void 0:e.alias)||f.push(o("alias","Alias")),S(e==null?void 0:e.categoryId)||f.push(o("categoryId","Kategorie"));const{product:v,supplier:M,productSupplier:E}=B({products:[e].filter(Boolean),suppliers:a,productSuppliers:i,pos:t,fos:u},k,e==null?void 0:e.supplierId),h=G({product:v,productSupplier:E}),g=Q({product:v,productSupplier:E,supplier:M,settings:l}),x=h.value!=null&&h.value>0,L=!!g.value;!x||!L?f.push(o("unitPriceUsd","Stückpreis (Währung)")):(h.source!=="product"||!["product","template"].includes(g.source))&&m.push({fieldKey:"unitPriceUsd",label:"Stückpreis (Währung)",value:{amount:h.value,currency:g.value}});const D=c({product:v,productSupplier:E,supplier:M,settings:l});D.value?D.source!=="product"&&m.push({fieldKey:"productionLeadTimeDaysDefault",label:"Produktionszeit (Tage)",value:D.value}):f.push(o("productionLeadTimeDaysDefault","Produktionszeit (Tage)"));const I=O({product:v,transportMode:v==null?void 0:v.defaultTransportMode}),T=W({settings:l,product:v,transportMode:I});T.value?T.source!=="product"&&m.push({fieldKey:"transitDays",label:"Transit-Tage",value:T.value}):f.push(o("transitDays","Transit-Tage"));const V=r((e==null?void 0:e.moqOverrideUnits)??(e==null?void 0:e.moqUnits)),b=r(l==null?void 0:l.moqDefaultUnits);(V==null||V<=0)&&(b!=null&&b>0?m.push({fieldKey:"moqUnits",label:"MOQ",value:b}):f.push(o("moqUnits","MOQ")));const C=Y({product:v,settings:l});C.value==null?f.push(o("dutyPct","Zoll %")):C.source==="settings"&&m.push({fieldKey:"dutyPct",label:"Zoll %",value:C.value});const R=Z({product:v,settings:l});R.value==null?f.push(o("vatImportPct","EUSt %")):R.source==="settings"&&m.push({fieldKey:"vatImportPct",label:"EUSt %",value:R.value});const F=r(e==null?void 0:e.avgSellingPriceGrossEUR);return(F==null||F<=0)&&f.push(o("avgSellingPriceGrossEUR","Ø VK-Preis (Brutto)")),r(e==null?void 0:e.sellerboardMarginPct)==null&&U.push(o("sellerboardMarginPct","Sellerboard Marge")),r(e==null?void 0:e.landedUnitCostEur)==null&&U.push(o("landedUnitCostEur","Einstandspreis (EUR)")),{status:f.length?"blocked":"ok",blockingMissing:f,defaulted:m,suggestedMissing:U}}export{O as a,_ as b,A as c,X as d,se as e,c as f,W as g,G as h,d as i,p as j,ee as k,ne as l,le as m,B as r};
