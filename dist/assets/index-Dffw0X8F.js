import{a2 as Ve,t as c,a3 as De,a4 as Be,a5 as Xe,a6 as Je,Q as V,a7 as Qe,a8 as Ze,a9 as Ne,aa as et,ab as tt,ac as nt,ad as u,k as t,L as rt,S as H,M as x,N as ce,P as X,ae as Ee,af as re,K as at,ag as st,a0 as ke,ah as it,V as Oe}from"./index-D6pMtF0j.js";import{D as T}from"./DeNumberInput-CX2Y0IgS.js";import{b as ot}from"./tableModels-BBlqNR-D.js";import{f as ue}from"./months-BTPgK-LH.js";import{u as lt,C as je}from"./workspace-CPdCVGI9.js";import{b as ct,a as Ce,c as ut,m as de,P as ze,n as dt,d as _e}from"./planProducts-C4xIiO35.js";import{F as Ue}from"./Table-CdD2J4eb.js";import{g as Me,P as mt,a as pt}from"./index-LV2f79y9.js";import{S as D}from"./index-aM_fcGg-.js";import{C as ht}from"./index-B8Utj4Z_.js";import{s as me}from"./index-7KSmUmnD.js";import"./index-IqeLlo-_.js";import"./DownOutlined-BAIni2KE.js";import"./productCompletenessV2-Barv506d.js";import"./Dropdown-CGxjL3l8.js";import"./index-kRHecK7L.js";import"./useBubbleLock-CgXBP_Sr.js";import"./Pagination-BNx-A3KD.js";const ft=r=>{const{componentCls:s,iconCls:d,antCls:i,zIndexPopup:m,colorText:f,colorWarning:j,marginXXS:y,marginXS:g,fontSize:R,fontWeightStrong:K,colorTextHeading:U}=r;return{[s]:{zIndex:m,[`&${i}-popover`]:{fontSize:R},[`${s}-message`]:{marginBottom:g,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${s}-message-icon ${d}`]:{color:j,fontSize:R,lineHeight:1,marginInlineEnd:g},[`${s}-title`]:{fontWeight:K,color:U,"&:only-child":{fontWeight:"normal"}},[`${s}-description`]:{marginTop:y,color:f}},[`${s}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:g}}}}},gt=r=>{const{zIndexPopupBase:s}=r;return{zIndexPopup:s+60}},$e=Ve("Popconfirm",r=>ft(r),gt,{resetStyle:!1});var bt=function(r,s){var d={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&s.indexOf(i)<0&&(d[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,i=Object.getOwnPropertySymbols(r);m<i.length;m++)s.indexOf(i[m])<0&&Object.prototype.propertyIsEnumerable.call(r,i[m])&&(d[i[m]]=r[i[m]]);return d};const Ke=r=>{const{prefixCls:s,okButtonProps:d,cancelButtonProps:i,title:m,description:f,cancelText:j,okText:y,okType:g="primary",icon:R=c.createElement(De,null),showCancel:K=!0,close:U,onConfirm:F,onCancel:W,onPopupClick:M}=r,{getPrefixCls:I}=c.useContext(Be),[P]=Xe("Popconfirm",Je.Popconfirm),o=Me(m),G=Me(f);return c.createElement("div",{className:`${s}-inner-content`,onClick:M},c.createElement("div",{className:`${s}-message`},R&&c.createElement("span",{className:`${s}-message-icon`},R),c.createElement("div",{className:`${s}-message-text`},o&&c.createElement("div",{className:`${s}-title`},o),G&&c.createElement("div",{className:`${s}-description`},G))),c.createElement("div",{className:`${s}-buttons`},K&&c.createElement(V,Object.assign({onClick:W,size:"small"},i),j||(P==null?void 0:P.cancelText)),c.createElement(Qe,{buttonProps:Object.assign(Object.assign({size:"small"},Ze(g)),d),actionFn:F,close:U,prefixCls:I("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},y||(P==null?void 0:P.okText))))},St=r=>{const{prefixCls:s,placement:d,className:i,style:m}=r,f=bt(r,["prefixCls","placement","className","style"]),{getPrefixCls:j}=c.useContext(Be),y=j("popconfirm",s),[g]=$e(y);return g(c.createElement(mt,{placement:d,className:Ne(y,i),style:m,content:c.createElement(Ke,Object.assign({prefixCls:y},f))}))};var xt=function(r,s){var d={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&s.indexOf(i)<0&&(d[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,i=Object.getOwnPropertySymbols(r);m<i.length;m++)s.indexOf(i[m])<0&&Object.prototype.propertyIsEnumerable.call(r,i[m])&&(d[i[m]]=r[i[m]]);return d};const Pt=c.forwardRef((r,s)=>{var d,i;const{prefixCls:m,placement:f="top",trigger:j="click",okType:y="primary",icon:g=c.createElement(De,null),children:R,overlayClassName:K,onOpenChange:U,onVisibleChange:F,overlayStyle:W,styles:M,classNames:I}=r,P=xt(r,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:o,className:G,style:te,classNames:E,styles:ae}=et("popconfirm"),[J,A]=tt(!1,{value:(d=r.open)!==null&&d!==void 0?d:r.visible,defaultValue:(i=r.defaultOpen)!==null&&i!==void 0?i:r.defaultVisible}),O=(v,N)=>{A(v,!0),F==null||F(v),U==null||U(v,N)},z=v=>{O(!1,v)},b=v=>{var N;return(N=r.onConfirm)===null||N===void 0?void 0:N.call(void 0,v)},Q=v=>{var N;O(!1,v),(N=r.onCancel)===null||N===void 0||N.call(void 0,v)},fe=(v,N)=>{const{disabled:e=!1}=r;e||O(v,N)},ne=o("popconfirm",m),ge=Ne(ne,G,K,E.root,I==null?void 0:I.root),be=Ne(E.body,I==null?void 0:I.body),[Se]=$e(ne);return Se(c.createElement(pt,Object.assign({},nt(P,["title"]),{trigger:j,placement:f,onOpenChange:fe,open:J,ref:s,classNames:{root:ge,body:be},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},ae.root),te),W),M==null?void 0:M.root),body:Object.assign(Object.assign({},ae.body),M==null?void 0:M.body)},content:c.createElement(Ke,Object.assign({okType:y,icon:g},r,{prefixCls:ne,close:z,onConfirm:b,onCancel:Q})),"data-popover-inject":!0}),R))}),We=Pt;We._InternalPanelDoNotUseOrYouWillBeFired=St;const{Paragraph:Fe,Text:Y,Title:Ae}=rt,Le={standalone:"Standalone",variant_of_existing:"Variant of Existing",category_adjacent:"Category Adjacent"};function pe(){return new Date().toISOString()}function Te(r){return`${r}-${Math.random().toString(36).slice(2,9)}`}function l(r){if(r==null||r==="")return null;const s=Number(r);return Number.isFinite(s)?s:null}function Ge(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}function k(r,s=0){const d=Number(r);return Number.isFinite(d)?d.toLocaleString("de-DE",{minimumFractionDigits:s,maximumFractionDigits:s}):"—"}function he(r,s=0){const d=r&&typeof r=="object"?r:{},i=String(d.id||"").trim();return i||String(_e(d,s).id||"").trim()}function Ie(r){const s=_e(r||{},0),d=Array.isArray(s.launchCosts)?s.launchCosts:[];return{id:s.id||"",alias:s.alias||"",plannedSku:s.plannedSku||"",relationType:s.relationType||ze[0],categoryId:s.categoryId||null,status:s.status||"active",portfolioBucket:Oe(s.portfolioBucket,X.PLAN),includeInForecast:s.includeInForecast!==!1,launchCosts:d.map((i,m)=>{const f=i;return{id:String(f.id||`lc-${m+1}`),type:String(f.type||f.category||"Sonstiges"),amountEur:l(f.amountEur??f.amount),currency:String(f.currency||"EUR"),date:String(f.date||""),note:String(f.note||"")}}),baselineReferenceMonth:l(s.baselineReferenceMonth),baselineUnitsInReferenceMonth:l(s.baselineUnitsInReferenceMonth),seasonalityReferenceSku:s.seasonalityReferenceSku||"",baselineReferenceSku:s.baselineReferenceSku||"",avgSellingPriceGrossEUR:l(s.avgSellingPriceGrossEUR),sellerboardMarginPct:l(s.sellerboardMarginPct),productionLeadTimeDaysDefault:l(s.productionLeadTimeDaysDefault),transportMode:String(s.transportMode||"SEA").toUpperCase(),transitDays:l(s.transitDays),unitPriceUsd:l(s.unitPriceUsd),logisticsPerUnitEur:l(s.logisticsPerUnitEur),launchDate:s.launchDate||Ge(),rampUpWeeks:l(s.rampUpWeeks),softLaunchStartSharePct:l(s.softLaunchStartSharePct)}}function _t(){const{state:r,loading:s,saving:d,error:i,lastSavedAt:m,saveWith:f}=lt(),[j,y]=c.useState(!1),[g,R]=c.useState(null),[K,U]=c.useState(!1),[F,W]=c.useState(null),[M,I]=c.useState(""),[P]=u.useForm(),o=u.useWatch([],P),G=r,te=r.settings&&typeof r.settings=="object"?r.settings:{},E=c.useMemo(()=>ot(te),[te.horizonMonths,te.startMonth]),ae=c.useMemo(()=>(Array.isArray(r.productCategories)?r.productCategories:[]).map(e=>({id:String(e.id||""),name:String(e.name||"Ohne Kategorie")})).filter(e=>e.id),[r.productCategories]),J=c.useMemo(()=>(Array.isArray(r.products)?r.products:[]).map(e=>{const n=e,a=String(n.sku||"").trim();if(!a)return null;const p=String(n.alias||a);return{value:a,label:`${p} · ${a}`}}).filter(Boolean),[r.products]),A=c.useMemo(()=>ct({state:G,months:E}),[E,G]),O=c.useMemo(()=>g&&A.find(e=>String(e.id||"")===g)||null,[g,A]),z=c.useMemo(()=>F&&A.find(e=>String(e.id||"")===F)||null,[A,F]),b=c.useMemo(()=>{var n;if(!j)return null;const e=o||Ie(O||void 0);return Ce({planProduct:e,forecastImport:((n=r.forecast)==null?void 0:n.forecastImport)||{},months:E,fallbackIndex:0})},[o,O,j,E,r.forecast]),Q=c.useMemo(()=>{var w;if(!j)return null;const e=o||Ie(O||void 0),n=String(e.baselineReferenceSku||"").trim(),a=Number(e.baselineReferenceMonth||0);if(!n||a<1||a>12)return null;const p=((w=r.forecast)==null?void 0:w.forecastImport)||{},h=ut(p,n);if(!h)return null;const C=l((h.averagesByMonthNumber||{})[a]);return Number.isFinite(C)?{sku:n,baselineMonth:a,monthAverageUnits:C}:null},[o,O,j,r.forecast]);function fe(){R(null),P.setFieldsValue({alias:"",plannedSku:"",relationType:"standalone",categoryId:null,status:"active",portfolioBucket:X.PLAN,includeInForecast:!0,launchCosts:[],baselineReferenceMonth:new Date().getMonth()+1,baselineUnitsInReferenceMonth:null,seasonalityReferenceSku:"",baselineReferenceSku:"",avgSellingPriceGrossEUR:null,sellerboardMarginPct:null,productionLeadTimeDaysDefault:null,transportMode:"SEA",transitDays:null,unitPriceUsd:null,logisticsPerUnitEur:null,launchDate:Ge(),rampUpWeeks:8,softLaunchStartSharePct:0}),y(!0)}function ne(e){R(String(e.id||"")),P.setFieldsValue(Ie(e)),y(!0)}async function ge(e){await f(n=>{const a=ke(n),p=Array.isArray(a.planProducts)?a.planProducts:[];return a.planProducts=p.filter((h,C)=>he(h,C)!==e),a},"v2:plan-products:delete"),me.success("Plan-Produkt entfernt.")}async function be(e){const n=String(e.alias||"").trim();if(!n)throw new Error("Alias ist erforderlich.");const a=e.includeInForecast!==!1;if(a&&!e.seasonalityReferenceSku)throw new Error("Bitte Referenz-SKU für Saisonalität wählen.");const p=Number(e.baselineReferenceMonth||0);if(a&&(!Number.isFinite(p)||p<1||p>12))throw new Error("Referenzmonat muss zwischen 1 und 12 liegen.");const h=Number(e.baselineUnitsInReferenceMonth||0);if(a&&(!Number.isFinite(h)||h<=0))throw new Error("Baseline Units im Referenzmonat müssen > 0 sein.");const C=Number(e.avgSellingPriceGrossEUR||0);if(a&&(!Number.isFinite(C)||C<=0))throw new Error("Bitte einen gültigen Preis (EUR) für Revenue-Berechnung pflegen.");const w=Number(e.sellerboardMarginPct||0);if(a&&(!Number.isFinite(w)||w<=0||w>100))throw new Error("Bitte eine gültige Brutto-Marge (%) > 0 und <= 100 pflegen.");const L=Math.round(Number(e.productionLeadTimeDaysDefault||0));if(a&&(!Number.isFinite(L)||L<=0))throw new Error("Bitte Production Lead Time (Tage) > 0 pflegen.");const _=String(e.transportMode||"").trim().toUpperCase(),se=_==="AIR"||_==="SEA"||_==="RAIL"?_:"SEA",S=Math.round(Number(e.transitDays||0));if(a&&(!Number.isFinite(S)||S<=0))throw new Error("Bitte Transit Lead Time (Tage) > 0 pflegen.");const B=Number(e.unitPriceUsd||0);if(a&&(!Number.isFinite(B)||B<=0))throw new Error("Bitte einen gültigen Einkaufspreis pro Stück (USD) > 0 pflegen.");const $=Number(e.logisticsPerUnitEur||0);if(a&&(!Number.isFinite($)||$<0))throw new Error("Bitte gültige Frachtkosten pro Stück (EUR) pflegen.");const ie=dt(e.launchDate);if(!ie)throw new Error("Launch-Datum ist erforderlich.");const q=Math.round(Number(e.rampUpWeeks||0));if(!Number.isFinite(q)||q<=0)throw new Error("Ramp-up Wochen müssen größer als 0 sein.");const Z=Number(e.softLaunchStartSharePct||0);if(!Number.isFinite(Z)||Z<0||Z>100)throw new Error("Soft-Launch Start in % muss zwischen 0 und 100 liegen.");await f(qe=>{const oe=ke(qe),ee=Array.isArray(oe.planProducts)?[...oe.planProducts]:[],He=n.toLowerCase();if(ee.find((ye,ve)=>{const Re=ye;return String(Re.alias||"").trim().toLowerCase()===He?g?he(Re,ve)!==g:!0:!1}))throw new Error(`Alias "${n}" existiert bereits bei einem Plan-Produkt.`);const xe=g||Te("plan"),le=ee.findIndex((ye,ve)=>he(ye,ve)===xe),Pe=le>=0?ee[le]:null,Ye=it(e.launchCosts,`plan-${xe}-lc`),we={id:xe,alias:n,plannedSku:String(e.plannedSku||"").trim(),relationType:String(e.relationType||"standalone"),categoryId:e.categoryId||null,status:e.status||"active",portfolioBucket:Oe(e.portfolioBucket,X.PLAN),includeInForecast:a,launchCosts:Ye,baselineReferenceMonth:p,baselineUnitsInReferenceMonth:h,seasonalityReferenceSku:String(e.seasonalityReferenceSku||"").trim(),baselineReferenceSku:String(e.baselineReferenceSku||"").trim(),avgSellingPriceGrossEUR:C,sellerboardMarginPct:w,productionLeadTimeDaysDefault:L,transportMode:se,transitDays:S,unitPriceUsd:B,logisticsPerUnitEur:$,freightPerUnitEur:$,template:{scope:"SKU",name:"Planprodukt",fields:{transportMode:se,transitDays:S,productionDays:L,unitPriceUsd:B,freightEur:$}},launchDate:ie,rampUpWeeks:q,softLaunchStartSharePct:Z,updatedAt:pe(),createdAt:g?String((Pe==null?void 0:Pe.createdAt)||pe()):pe()};return le>=0?ee[le]=we:ee.push(we),oe.planProducts=ee,oe},g?"v2:plan-products:update":"v2:plan-products:create"),me.success(g?"Plan-Produkt aktualisiert.":"Plan-Produkt angelegt."),y(!1),R(null),P.resetFields()}function Se(e){const n=String(e.id||"").trim();if(!n)return;W(n);const a=String(e.plannedSku||"").trim();I(a),U(!0)}async function v(){const e=String(F||"").trim(),n=String(M||"").trim();if(!e)throw new Error("Plan-Produkt nicht gefunden.");if(!n)throw new Error("Bitte SKU für die Übernahme wählen.");if(!J.some(p=>p.value===n))throw new Error("Die gewählte SKU ist nicht in der Live-Produktdatenbank vorhanden.");await f(p=>{const h=ke(p),C=h,w=Array.isArray(h.planProducts)?[...h.planProducts]:[],L=w.findIndex((q,Z)=>he(q,Z)===e);if(L<0)throw new Error("Plan-Produkt wurde nicht gefunden.");const _=C.forecast&&typeof C.forecast=="object"?C.forecast:{},se=_.forecastImport&&typeof _.forecastImport=="object"?_.forecastImport:{},S=Ce({planProduct:w[L],forecastImport:se,months:E,fallbackIndex:L}),B=pe(),$={id:Te("plan-map"),planProductId:String(S.id||e),planProductAlias:String(S.alias||""),sku:n,plannedSku:String(S.plannedSku||""),mappedAt:B,launchDate:String(S.launchDate||""),rampUpWeeks:Number(S.rampUpWeeks||0)||null,softLaunchStartSharePct:Number(S.softLaunchStartSharePct||0),baselineReferenceMonth:Number(S.baselineReferenceMonth||0)||null,baselineUnitsInReferenceMonth:Number(S.baselineUnitsInReferenceMonth||0)||null,seasonalityReferenceSku:String(S.seasonalityReferenceSku||""),months:[...S.months],planUnitsByMonth:{...S.unitsByMonth||{}},planRevenueByMonth:{...S.revenueByMonth||{}},source:"plan_product"},ie=Array.isArray(h.planProductMappings)?[...h.planProductMappings]:[];return h.planProductMappings=[...ie.filter(q=>String(q.planProductId||"")!==$.planProductId),$],w[L]={...w[L],status:"archived",plannedSku:n,mappedSku:n,mappedAt:B,archivedAt:B,updatedAt:B},h.planProducts=w,h},"v2:plan-products:takeover"),me.success(`Plan-Produkt wurde als Live-SKU ${n} übernommen und archiviert.`),U(!1),W(null),I(""),window.location.hash=`#/v2/products?source=plan-products&sku=${encodeURIComponent(n)}`}const N=c.useMemo(()=>A.map(e=>({...e,monthPreview:E.slice(0,3).map(n=>{var a;return`${ue(n)}: ${k((a=e.unitsByMonth)==null?void 0:a[n],0)}`}).join(" · ")})),[E,A]);return t.jsxs("div",{className:"v2-page",children:[t.jsxs(je,{className:"v2-intro-card",children:[t.jsxs("div",{className:"v2-page-head",children:[t.jsxs("div",{children:[t.jsx(Ae,{level:3,children:"Neue Produkte (Plan-Produkte)"}),t.jsx(Fe,{children:"Pre-SKU Produkte mit Referenzmonat-Baseline und übernommener Saisonalität aus bestehender SKU. Monats-Units werden automatisch über den Forecast-Horizont berechnet."})]}),t.jsx(H,{children:t.jsx(V,{type:"primary",onClick:fe,children:"Plan-Produkt hinzufügen"})})]}),t.jsx("div",{className:"v2-toolbar",children:t.jsxs("div",{className:"v2-toolbar-row",children:[t.jsxs(x,{color:"blue",children:["Plan-Produkte: ",A.length]}),t.jsxs(x,{color:"green",children:["Aktiv: ",A.filter(e=>String(e.status||"")==="active").length]}),t.jsxs(x,{children:["Horizont: ",E.length," Monate"]}),d?t.jsx(x,{color:"processing",children:"Speichern..."}):null,m?t.jsxs(x,{color:"green",children:["Gespeichert: ",new Date(m).toLocaleTimeString("de-DE")]}):null]})})]}),i?t.jsx(ce,{type:"error",showIcon:!0,message:i}):null,s?t.jsx(ce,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,t.jsx(je,{children:t.jsx(Ue,{className:"v2-ant-table",rowKey:e=>String(e.id||e.key||""),size:"small",pagination:!1,scroll:{x:"max-content"},dataSource:N,columns:[{title:"Alias",dataIndex:"alias",key:"alias",sorter:(e,n)=>String(e.alias||"").localeCompare(String(n.alias||""),"de-DE"),render:e=>t.jsxs(H,{size:6,children:[t.jsx(x,{color:"blue",children:"Plan"}),t.jsx(Y,{strong:!0,children:e||"—"})]})},{title:"Pre-SKU",dataIndex:"plannedSku",key:"plannedSku",sorter:(e,n)=>String(e.plannedSku||"").localeCompare(String(n.plannedSku||""),"de-DE"),render:e=>e||t.jsx(Y,{type:"secondary",children:"ohne SKU"})},{title:"Relation",dataIndex:"relationType",key:"relationType",sorter:(e,n)=>String(e.relationType||"").localeCompare(String(n.relationType||""),"de-DE"),render:e=>Le[e]||e||"—"},{title:"Bucket",dataIndex:"portfolioBucket",key:"portfolioBucket",sorter:(e,n)=>String(e.portfolioBucket||"").localeCompare(String(n.portfolioBucket||""),"de-DE"),render:e=>t.jsx(x,{color:e===X.CORE?"green":e===X.PLAN?"gold":"blue",children:e||X.PLAN})},{title:"Forecast",dataIndex:"includeInForecast",key:"includeInForecast",sorter:(e,n)=>+!!e.includeInForecast-+!!n.includeInForecast,render:e=>e===!1?t.jsx(x,{children:"Nein"}):t.jsx(x,{color:"green",children:"Ja"})},{title:"Baseline",key:"baseline",sorter:(e,n)=>Number(l(e.baselineUnitsInReferenceMonth)||0)-Number(l(n.baselineUnitsInReferenceMonth)||0),render:(e,n)=>t.jsxs("span",{children:[de(n.baselineReferenceMonth)," · ",k(n.baselineUnitsInReferenceMonth,0)," Units"]})},{title:"Saisonalität von",dataIndex:"seasonalityReferenceSku",key:"seasonalityReferenceSku",sorter:(e,n)=>String(e.seasonalityReferenceSku||"").localeCompare(String(n.seasonalityReferenceSku||""),"de-DE"),render:e=>e||"—"},{title:"Preis (EUR)",dataIndex:"avgSellingPriceGrossEUR",key:"avgSellingPriceGrossEUR",align:"right",sorter:(e,n)=>Number(l(e.avgSellingPriceGrossEUR)||0)-Number(l(n.avgSellingPriceGrossEUR)||0),render:e=>k(e,2)},{title:"Brutto-Marge %",dataIndex:"sellerboardMarginPct",key:"sellerboardMarginPct",align:"right",sorter:(e,n)=>Number(l(e.sellerboardMarginPct)||0)-Number(l(n.sellerboardMarginPct)||0),render:e=>k(e,2)},{title:"Launch & Ramp",key:"launchRamp",sorter:(e,n)=>String(e.launchDate||"").localeCompare(String(n.launchDate||"")),render:(e,n)=>t.jsxs("span",{children:[String(n.launchDate||"—")," · ",k(l(n.rampUpWeeks),0),"W · Start ",k(l(n.softLaunchStartSharePct),0),"%"]})},{title:"Vorschau (Next 3)",dataIndex:"monthPreview",key:"monthPreview",sorter:(e,n)=>String(e.monthPreview||"").localeCompare(String(n.monthPreview||""),"de-DE")},{title:"Status",dataIndex:"status",key:"status",sorter:(e,n)=>String(e.status||"").localeCompare(String(n.status||""),"de-DE"),render:(e,n)=>{if(e==="archived"){const a=String(n.mappedSku||n.plannedSku||"");return t.jsxs(H,{direction:"vertical",size:2,children:[t.jsx(x,{children:"Archiviert"}),a?t.jsxs(Y,{type:"secondary",children:["Live-SKU: ",a]}):null]})}return e==="draft"?t.jsx(x,{color:"gold",children:"Draft"}):t.jsx(x,{color:"green",children:"Aktiv"})}},{title:"Aktionen",key:"actions",render:(e,n)=>t.jsxs(H,{size:6,children:[t.jsx(V,{size:"small",onClick:()=>ne(n),children:"Bearbeiten"}),t.jsx(V,{size:"small",type:"primary",ghost:!0,onClick:()=>Se(n),disabled:String(n.status||"")==="archived",children:"Als gelauncht markieren"}),t.jsx(We,{title:"Plan-Produkt löschen?",onConfirm:()=>{ge(String(n.id||""))},children:t.jsx(V,{size:"small",danger:!0,children:"Löschen"})})]})}],locale:{emptyText:"Noch keine Plan-Produkte angelegt."}})}),t.jsxs(Ee,{title:g?"Plan-Produkt bearbeiten":"Plan-Produkt anlegen",rootClassName:"v2-form-modal",open:j,onCancel:()=>{y(!1),R(null),P.resetFields()},onOk:()=>{P.validateFields().then(e=>be(e)).catch(()=>{})},width:980,children:[t.jsxs(u,{form:P,layout:"vertical",children:[t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"alias",label:"Alias",rules:[{required:!0,message:"Alias ist erforderlich."}],children:t.jsx(re,{placeholder:"z. B. Messerblock Premium"})}),t.jsx(u.Item,{name:"plannedSku",label:"Planned SKU (optional)",children:t.jsx(re,{placeholder:"optional, falls intern bereits vergeben"})}),t.jsx(u.Item,{name:"portfolioBucket",label:"Portfolio Bucket",initialValue:X.PLAN,children:t.jsx(D,{options:at.map(e=>({value:e,label:e}))})}),t.jsx(u.Item,{name:"status",label:"Status",initialValue:"active",children:t.jsx(D,{options:[{value:"active",label:"Aktiv"},{value:"draft",label:"Draft"},{value:"archived",label:"Archiviert"}]})})]}),t.jsx("div",{className:"v2-form-row",children:t.jsx(u.Item,{name:"includeInForecast",valuePropName:"checked",initialValue:!0,children:t.jsx(ht,{children:"Im Forecast berücksichtigen"})})}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"relationType",label:"Relation",rules:[{required:!0}],children:t.jsx(D,{options:ze.map(e=>({value:e,label:Le[e]||e}))})}),t.jsx(u.Item,{name:"categoryId",label:"Kategorie",children:t.jsx(D,{allowClear:!0,options:ae.map(e=>({value:e.id,label:e.name}))})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"productionLeadTimeDaysDefault",label:"Production Lead Time (Tage)",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Math.round(Number(n||0));return Number.isFinite(a)&&a>0?Promise.resolve():Promise.reject(new Error("Production Lead Time > 0 erforderlich."))}}],children:t.jsx(T,{mode:"int",min:0})}),t.jsx(u.Item,{name:"transportMode",label:"Freight / Transport",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=String(n||"").trim().toUpperCase();return a==="SEA"||a==="RAIL"||a==="AIR"?Promise.resolve():Promise.reject(new Error("Transportmodus erforderlich."))}}],children:t.jsx(D,{options:[{value:"SEA",label:"SEA"},{value:"RAIL",label:"RAIL"},{value:"AIR",label:"AIR"}]})}),t.jsx(u.Item,{name:"unitPriceUsd",label:"Einkaufskosten / Stk. (USD)",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>0?Promise.resolve():Promise.reject(new Error("Einkaufskosten > 0 erforderlich."))}}],children:t.jsx(T,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:"transitDays",label:"Transit Lead Time (Tage)",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Math.round(Number(n||0));return Number.isFinite(a)&&a>0?Promise.resolve():Promise.reject(new Error("Transit Lead Time > 0 erforderlich."))}}],children:t.jsx(T,{mode:"int",min:0})}),t.jsx(u.Item,{name:"logisticsPerUnitEur",label:"Frachtkosten / Stk. (EUR)",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>=0?Promise.resolve():Promise.reject(new Error("Frachtkosten pro Stück erforderlich."))}}],children:t.jsx(T,{mode:"decimal",min:0})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"avgSellingPriceGrossEUR",label:"Preis (EUR) für Revenue",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>0?Promise.resolve():Promise.reject(new Error("Preis ist erforderlich."))}}],children:t.jsx(T,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:"sellerboardMarginPct",label:"Brutto-Marge (%)",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>0&&a<=100?Promise.resolve():Promise.reject(new Error("Marge muss > 0 und <= 100 sein."))}}],children:t.jsx(T,{mode:"percent",min:0,max:100})})]}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"baselineReferenceMonth",label:"Referenzmonat",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>=1&&a<=12?Promise.resolve():Promise.reject(new Error("Referenzmonat ist erforderlich."))}}],children:t.jsx(D,{options:Array.from({length:12},(e,n)=>({value:n+1,label:`${de(n+1)} (${n+1})`}))})}),t.jsx(u.Item,{name:"baselineUnitsInReferenceMonth",label:"Baseline Units im Referenzmonat",rules:[{validator:(e,n)=>{if((o==null?void 0:o.includeInForecast)===!1)return Promise.resolve();const a=Number(n);return Number.isFinite(a)&&a>0?Promise.resolve():Promise.reject(new Error("Baseline Units sind erforderlich."))}}],children:t.jsx(T,{mode:"int",min:0})}),t.jsx(u.Item,{name:"seasonalityReferenceSku",label:"Saisonalität übernehmen von SKU",rules:[{validator:(e,n)=>(o==null?void 0:o.includeInForecast)===!1||String(n||"").trim()?Promise.resolve():Promise.reject(new Error("Referenz-SKU ist erforderlich."))}],children:t.jsx(D,{showSearch:!0,optionFilterProp:"label",options:J})})]}),t.jsx("div",{className:"v2-form-row",children:t.jsx(u.Item,{name:"baselineReferenceSku",label:"Baseline-Referenz-SKU (optional)",children:t.jsx(D,{allowClear:!0,showSearch:!0,optionFilterProp:"label",options:J})})}),t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:"launchDate",label:"Launch-Datum",rules:[{required:!0,message:"Launch-Datum ist erforderlich."}],children:t.jsx(re,{type:"date"})}),t.jsx(u.Item,{name:"rampUpWeeks",label:"Ramp-up (Wochen)",rules:[{required:!0,message:"Ramp-up Wochen sind erforderlich."}],children:t.jsx(T,{mode:"int",min:1})}),t.jsx(u.Item,{name:"softLaunchStartSharePct",label:"Soft-Launch Start (%)",extra:"Startniveau am Launch-Tag. 0 = Start bei 0 %, 20 = Start bei 20 %.",children:t.jsx(T,{mode:"percent",min:0,max:100})})]}),t.jsx("div",{className:"v2-form-row",children:t.jsx("div",{style:{gridColumn:"1 / -1"},children:t.jsx(u.List,{name:"launchCosts",children:(e,{add:n,remove:a})=>t.jsxs(H,{direction:"vertical",style:{width:"100%"},children:[e.map(p=>t.jsxs("div",{className:"v2-form-row",children:[t.jsx(u.Item,{name:[p.name,"type"],label:"Launch-Kosten Typ",style:{minWidth:180,flex:1},rules:[{required:!0,message:"Typ fehlt."}],children:t.jsx(D,{options:st.map(h=>({value:h,label:h}))})}),t.jsx(u.Item,{name:[p.name,"amountEur"],label:"Betrag (EUR)",style:{minWidth:160,flex:1},rules:[{required:!0,message:"Betrag fehlt."}],children:t.jsx(T,{mode:"decimal",min:0})}),t.jsx(u.Item,{name:[p.name,"date"],label:"Datum",style:{minWidth:170},rules:[{required:!0,message:"Datum fehlt."}],children:t.jsx(re,{type:"date"})}),t.jsx(u.Item,{name:[p.name,"note"],label:"Notiz",style:{flex:2},children:t.jsx(re,{placeholder:"Optional"})}),t.jsx(u.Item,{style:{marginTop:30},children:t.jsx(V,{danger:!0,onClick:()=>a(p.name),children:"Entfernen"})})]},p.key)),t.jsx(V,{onClick:()=>n({type:"Sonstiges",amountEur:null,currency:"EUR",date:"",note:""}),children:"Launch-Kosten hinzufügen"})]})})})})]}),t.jsxs(je,{size:"small",children:[t.jsx(Ae,{level:5,children:"Forecast-Vorschau (berechnet)"}),t.jsx(Fe,{type:"secondary",children:"Monatswerte werden aus Baseline im Referenzmonat, dem Saisonalitätsprofil der gewählten Referenz-SKU und einer taggenauen Launch-/Ramp-Aggregation berechnet."}),b!=null&&b.seasonality?t.jsxs(t.Fragment,{children:[t.jsxs(H,{wrap:!0,style:{marginBottom:8},children:[t.jsxs(x,{color:"blue",children:["Baseline: ",de(b.baselineReferenceMonth)," · ",k(b.baselineUnitsInReferenceMonth,0)," Units"]}),t.jsxs(x,{color:"green",children:["Referenz-SKU: ",b.seasonalityReferenceSku]}),t.jsxs(x,{color:"purple",children:["Launch: ",String(b.launchDate||"—")," · Ramp: ",k(l(b.rampUpWeeks),0),"W · Start: ",k(l(b.softLaunchStartSharePct),0),"%"]}),t.jsxs(x,{children:["Zeitraum: ",ue(b.seasonality.startMonth)," bis ",ue(b.seasonality.endMonth)]}),Q?t.jsxs(x,{color:"purple",children:["Orientierung: ",Q.sku," hat in ",de(Q.baselineMonth)," im Schnitt ",k(Q.monthAverageUnits,0)," Units"]}):null]}),t.jsx(Ue,{className:"v2-ant-table",size:"small",pagination:!1,rowKey:e=>String(e.month||""),dataSource:E.map(e=>{var n,a,p,h;return{month:e,baseUnits:(n=b.baseUnitsByMonth)==null?void 0:n[e],rampFactor:(a=b.rampFactorByMonth)==null?void 0:a[e],units:(p=b.unitsByMonth)==null?void 0:p[e],revenue:(h=b.revenueByMonth)==null?void 0:h[e]}}),columns:[{title:"Monat",dataIndex:"month",key:"month",sorter:(e,n)=>String(e.month||"").localeCompare(String(n.month||"")),render:e=>ue(e)},{title:"Base Units",dataIndex:"baseUnits",key:"baseUnits",align:"right",sorter:(e,n)=>Number(l(e.baseUnits)||0)-Number(l(n.baseUnits)||0),render:e=>k(l(e),2)},{title:"Ramp-Faktor",dataIndex:"rampFactor",key:"rampFactor",align:"right",sorter:(e,n)=>Number(l(e.rampFactor)||0)-Number(l(n.rampFactor)||0),render:e=>k(l(e),2)},{title:"Units (Plan)",dataIndex:"units",key:"units",align:"right",sorter:(e,n)=>Number(l(e.units)||0)-Number(l(n.units)||0),render:e=>k(e,0)},{title:"Revenue (Plan)",dataIndex:"revenue",key:"revenue",align:"right",sorter:(e,n)=>Number(l(e.revenue)||0)-Number(l(n.revenue)||0),render:e=>k(e,2)}]})]}):t.jsx(ce,{type:"warning",showIcon:!0,message:"Saisonalitätsprofil noch nicht ableitbar",description:"Für die gewählte Referenz-SKU liegen noch keine verwertbaren Forecast-Monatswerte vor."})]})]}),t.jsx(Ee,{title:"Plan-Produkt in Live-SKU übernehmen",open:K,onCancel:()=>{U(!1),W(null),I("")},onOk:()=>{v().catch(e=>{me.error(e instanceof Error?e.message:String(e))})},children:t.jsxs(H,{direction:"vertical",style:{width:"100%"},children:[t.jsx(ce,{type:"info",showIcon:!0,message:"Plan wird archiviert, Mapping bleibt für Plan-vs-Ist erhalten.",description:"Nach der Übernahme zählt im operativen Forecast/Cashflow nur noch die Live-SKU (CSV)."}),t.jsxs("div",{children:[t.jsx(Y,{strong:!0,children:"Plan-Produkt: "}),t.jsx(Y,{children:(z==null?void 0:z.alias)||"—"})]}),t.jsxs("div",{children:[t.jsx(Y,{strong:!0,children:"Aktueller Status: "}),t.jsx(Y,{children:(z==null?void 0:z.status)||"—"})]}),t.jsx(D,{value:M||void 0,showSearch:!0,optionFilterProp:"label",placeholder:"Live-SKU auswählen",options:J,onChange:e=>I(String(e||""))})]})})]})}export{_t as default};
