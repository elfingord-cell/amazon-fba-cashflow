const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-calendar-timeline.es-DzeLLxS0.js","assets/index-o-D_rC2a.js","assets/index-SEHjz9nR.css"])))=>i.map(i=>d[i]);
import{aE as Ht,t as o,a1 as gt,aC as On,aF as Fn,aG as vs,at as tt,aH as _e,as as ce,aD as Cn,aI as cr,aJ as Ot,a3 as fn,aK as hn,aL as ys,aM as bs,aN as Pn,au as ot,aO as Ss,aP as Wa,aQ as ia,ar as Vn,aR as xs,aS as Ds,a4 as Ka,aT as Cs,ag as Xr,av as at,ax as Cr,aU as Ms,al as ks,aV as Ps,aW as ws,aX as js,aY as Ns,W as Is,aZ as Es,a_ as Rs,ai as va,a$ as Ts,b0 as $s,b1 as Os,b2 as Fs,b3 as As,b4 as Ls,b5 as Us,b6 as ya,b7 as sa,a2 as _s,N as je,Y as qa,b8 as Va,b9 as Za,ba as Ga,az as Xa,ay as Qa,bb as Ja,Z as ei,bc as ti,bd as ni,be as ri,bf as ai,bg as ii,bh as si,bi as Hs,k as n,M as kt,K as Rn,aa as oa,I as kr,ab as oi,a5 as Ce,ad as li,ae as ui,S as Ke,a6 as $t,V as mn,L as ft,a7 as yt,af as Bs,T as ci}from"./index-o-D_rC2a.js";import{D as di}from"./DataTable-Bmr5ONUk.js";import{D as bt}from"./DeNumberInput-czRHznbw.js";import{S as lr}from"./StatsTableShell-BXhs60qu.js";import{S as mi}from"./SkuAliasCell-C0LCWFyE.js";import{n as fi,b as hi,f as Qr}from"./months-BTPgK-LH.js";import{g as zs}from"./forecastVersioning-Bk55l2iS.js";import{r as Tn,a as ir,s as Qt,b as pi}from"./productCompletenessV2-4tJuiHUR.js";import{u as Pr,C as Et,T as Ys}from"./workspace-CYYiY6ES.js";import{u as gi}from"./modalCollaboration-DkXrCWTB.js";import{b as Ws,a as xr,d as ba,c as Sa,r as Rr,n as In,i as Zt,e as Tr,f as Ks,g as xa,F as qs,T as Vs,I as Zs,P as Gs,h as jn,j as Xs,k as xn,l as Qs,s as Js,m as eo,o as Kn,p as to,q as ur,t as Xt,u as Wt,v as no,w as Da}from"./orderUtils-DW9cnzFm.js";import{C as en}from"./index-DS8YiSJw.js";import{s as tn}from"./index-Dp_s4GXx.js";import{S as la}from"./index-C5SGBOij.js";import{g as ro,a as ao,i as Ca,u as io,S as Ct}from"./index-CPjrUd6P.js";import{b as $r,n as Or,i as Jr,a as so}from"./orderEditorFactory-DQgjKvTF.js";import{b as oo,c as vi}from"./categoryOrder-C77cYWrY.js";import{r as lo,b as uo}from"./phantomFo-fuJ3NSBN.js";import"./index-CyWWOfYr.js";import"./DownOutlined-CXkcgpir.js";import"./Dropdown-BL05MYkh.js";import"./foSuggestion-DyBAXRuI.js";import"./useBubbleLock-Bq7y8b-t.js";import"./store-CHRRPpyj.js";import"./prefill-cbidmeqR.js";import"./productCompleteness-CNODPsSo.js";import"./costing-CmZrILJ2.js";import"./dateUtils-D7NmXfd-.js";import"./shipping-9Dzo5wwm.js";import"./deepEqual-CGWqzo0t.js";import"./useDraftForm-CEnr1RbW.js";import"./abcClassification-Czyc8_9u.js";import"./inventoryProjection-B9saLoLy.js";function yi(e,...t){const r=e||{};return t.reduce((a,s)=>(Object.keys(s||{}).forEach(u=>{const c=r[u],m=s[u];if(c&&typeof c=="object")if(m&&typeof m=="object")a[u]=yi(c,a[u],m);else{const{_default:p}=c;p&&(a[u]=a[u]||{},a[u][p]=gt(a[u][p],m))}else a[u]=gt(a[u],m)}),a),{})}function co(e,...t){return o.useMemo(()=>yi.apply(void 0,[e].concat(t)),[t,e])}function mo(...e){return o.useMemo(()=>e.reduce((t,r={})=>(Object.keys(r).forEach(a=>{t[a]=Object.assign(Object.assign({},t[a]),r[a])}),t),{}),[e])}function ea(e,t){const r=Object.assign({},e);return Object.keys(t).forEach(a=>{if(a!=="_default"){const s=t[a],u=r[a]||{};r[a]=s?ea(u,s):u}}),r}const fo=(e,t,r)=>{const a=co.apply(void 0,[r].concat(Ht(e))),s=mo.apply(void 0,Ht(t));return o.useMemo(()=>[ea(a,r),ea(s,r)],[a,s,r])};var bi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){var r=1e3,a=6e4,s=36e5,u="millisecond",c="second",m="minute",p="hour",v="day",h="week",y="month",D="quarter",I="year",P="date",T="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,N=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,O={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function($){var k=["th","st","nd","rd"],g=$%100;return"["+$+(k[(g-20)%10]||k[g]||k[0])+"]"}},E=function($,k,g){var C=String($);return!C||C.length>=k?$:""+Array(k+1-C.length).join(g)+$},j={s:E,z:function($){var k=-$.utcOffset(),g=Math.abs(k),C=Math.floor(g/60),M=g%60;return(k<=0?"+":"-")+E(C,2,"0")+":"+E(M,2,"0")},m:function $(k,g){if(k.date()<g.date())return-$(g,k);var C=12*(g.year()-k.year())+(g.month()-k.month()),M=k.clone().add(C,y),A=g-M<0,Y=k.clone().add(C+(A?-1:1),y);return+(-(C+(g-M)/(A?M-Y:Y-M))||0)},a:function($){return $<0?Math.ceil($)||0:Math.floor($)},p:function($){return{M:y,y:I,w:h,d:v,D:P,h:p,m,s:c,ms:u,Q:D}[$]||String($||"").toLowerCase().replace(/s$/,"")},u:function($){return $===void 0}},B="en",z={};z[B]=O;var F="$isDayjsObject",q=function($){return $ instanceof Z||!(!$||!$[F])},ee=function $(k,g,C){var M;if(!k)return B;if(typeof k=="string"){var A=k.toLowerCase();z[A]&&(M=A),g&&(z[A]=g,M=A);var Y=k.split("-");if(!M&&Y.length>1)return $(Y[0])}else{var U=k.name;z[U]=k,M=U}return!C&&M&&(B=M),M||!C&&B},W=function($,k){if(q($))return $.clone();var g=typeof k=="object"?k:{};return g.date=$,g.args=arguments,new Z(g)},_=j;_.l=ee,_.i=q,_.w=function($,k){return W($,{locale:k.$L,utc:k.$u,x:k.$x,$offset:k.$offset})};var Z=function(){function $(g){this.$L=ee(g.locale,null,!0),this.parse(g),this.$x=this.$x||g.x||{},this[F]=!0}var k=$.prototype;return k.parse=function(g){this.$d=function(C){var M=C.date,A=C.utc;if(M===null)return new Date(NaN);if(_.u(M))return new Date;if(M instanceof Date)return new Date(M);if(typeof M=="string"&&!/Z$/i.test(M)){var Y=M.match(b);if(Y){var U=Y[2]-1||0,L=(Y[7]||"0").substring(0,3);return A?new Date(Date.UTC(Y[1],U,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,L)):new Date(Y[1],U,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,L)}}return new Date(M)}(g),this.init()},k.init=function(){var g=this.$d;this.$y=g.getFullYear(),this.$M=g.getMonth(),this.$D=g.getDate(),this.$W=g.getDay(),this.$H=g.getHours(),this.$m=g.getMinutes(),this.$s=g.getSeconds(),this.$ms=g.getMilliseconds()},k.$utils=function(){return _},k.isValid=function(){return this.$d.toString()!==T},k.isSame=function(g,C){var M=W(g);return this.startOf(C)<=M&&M<=this.endOf(C)},k.isAfter=function(g,C){return W(g)<this.startOf(C)},k.isBefore=function(g,C){return this.endOf(C)<W(g)},k.$g=function(g,C,M){return _.u(g)?this[C]:this.set(M,g)},k.unix=function(){return Math.floor(this.valueOf()/1e3)},k.valueOf=function(){return this.$d.getTime()},k.startOf=function(g,C){var M=this,A=!!_.u(C)||C,Y=_.p(g),U=function(Q,ie){var me=_.w(M.$u?Date.UTC(M.$y,ie,Q):new Date(M.$y,ie,Q),M);return A?me:me.endOf(v)},L=function(Q,ie){return _.w(M.toDate()[Q].apply(M.toDate("s"),(A?[0,0,0,0]:[23,59,59,999]).slice(ie)),M)},X=this.$W,J=this.$M,w=this.$D,ne="set"+(this.$u?"UTC":"");switch(Y){case I:return A?U(1,0):U(31,11);case y:return A?U(1,J):U(0,J+1);case h:var se=this.$locale().weekStart||0,V=(X<se?X+7:X)-se;return U(A?w-V:w+(6-V),J);case v:case P:return L(ne+"Hours",0);case p:return L(ne+"Minutes",1);case m:return L(ne+"Seconds",2);case c:return L(ne+"Milliseconds",3);default:return this.clone()}},k.endOf=function(g){return this.startOf(g,!1)},k.$set=function(g,C){var M,A=_.p(g),Y="set"+(this.$u?"UTC":""),U=(M={},M[v]=Y+"Date",M[P]=Y+"Date",M[y]=Y+"Month",M[I]=Y+"FullYear",M[p]=Y+"Hours",M[m]=Y+"Minutes",M[c]=Y+"Seconds",M[u]=Y+"Milliseconds",M)[A],L=A===v?this.$D+(C-this.$W):C;if(A===y||A===I){var X=this.clone().set(P,1);X.$d[U](L),X.init(),this.$d=X.set(P,Math.min(this.$D,X.daysInMonth())).$d}else U&&this.$d[U](L);return this.init(),this},k.set=function(g,C){return this.clone().$set(g,C)},k.get=function(g){return this[_.p(g)]()},k.add=function(g,C){var M,A=this;g=Number(g);var Y=_.p(C),U=function(J){var w=W(A);return _.w(w.date(w.date()+Math.round(J*g)),A)};if(Y===y)return this.set(y,this.$M+g);if(Y===I)return this.set(I,this.$y+g);if(Y===v)return U(1);if(Y===h)return U(7);var L=(M={},M[m]=a,M[p]=s,M[c]=r,M)[Y]||1,X=this.$d.getTime()+g*L;return _.w(X,this)},k.subtract=function(g,C){return this.add(-1*g,C)},k.format=function(g){var C=this,M=this.$locale();if(!this.isValid())return M.invalidDate||T;var A=g||"YYYY-MM-DDTHH:mm:ssZ",Y=_.z(this),U=this.$H,L=this.$m,X=this.$M,J=M.weekdays,w=M.months,ne=M.meridiem,se=function(ie,me,we,ae){return ie&&(ie[me]||ie(C,A))||we[me].slice(0,ae)},V=function(ie){return _.s(U%12||12,ie,"0")},Q=ne||function(ie,me,we){var ae=ie<12?"AM":"PM";return we?ae.toLowerCase():ae};return A.replace(N,function(ie,me){return me||function(we){switch(we){case"YY":return String(C.$y).slice(-2);case"YYYY":return _.s(C.$y,4,"0");case"M":return X+1;case"MM":return _.s(X+1,2,"0");case"MMM":return se(M.monthsShort,X,w,3);case"MMMM":return se(w,X);case"D":return C.$D;case"DD":return _.s(C.$D,2,"0");case"d":return String(C.$W);case"dd":return se(M.weekdaysMin,C.$W,J,2);case"ddd":return se(M.weekdaysShort,C.$W,J,3);case"dddd":return J[C.$W];case"H":return String(U);case"HH":return _.s(U,2,"0");case"h":return V(1);case"hh":return V(2);case"a":return Q(U,L,!0);case"A":return Q(U,L,!1);case"m":return String(L);case"mm":return _.s(L,2,"0");case"s":return String(C.$s);case"ss":return _.s(C.$s,2,"0");case"SSS":return _.s(C.$ms,3,"0");case"Z":return Y}return null}(ie)||Y.replace(":","")})},k.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},k.diff=function(g,C,M){var A,Y=this,U=_.p(C),L=W(g),X=(L.utcOffset()-this.utcOffset())*a,J=this-L,w=function(){return _.m(Y,L)};switch(U){case I:A=w()/12;break;case y:A=w();break;case D:A=w()/3;break;case h:A=(J-X)/6048e5;break;case v:A=(J-X)/864e5;break;case p:A=J/s;break;case m:A=J/a;break;case c:A=J/r;break;default:A=J}return M?A:_.a(A)},k.daysInMonth=function(){return this.endOf(y).$D},k.$locale=function(){return z[this.$L]},k.locale=function(g,C){if(!g)return this.$L;var M=this.clone(),A=ee(g,C,!0);return A&&(M.$L=A),M},k.clone=function(){return _.w(this.$d,this)},k.toDate=function(){return new Date(this.valueOf())},k.toJSON=function(){return this.isValid()?this.toISOString():null},k.toISOString=function(){return this.$d.toISOString()},k.toString=function(){return this.$d.toUTCString()},$}(),re=Z.prototype;return W.prototype=re,[["$ms",u],["$s",c],["$m",m],["$H",p],["$W",v],["$M",y],["$y",I],["$D",P]].forEach(function($){re[$[1]]=function(k){return this.$g(k,$[0],$[1])}}),W.extend=function($,k){return $.$i||($(k,Z,W),$.$i=!0),W},W.locale=ee,W.isDayjs=q,W.unix=function($){return W(1e3*$)},W.en=z[B],W.Ls=z,W.p={},W})})(bi);var ho=bi.exports;const Pt=On(ho);var Si={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){return function(r,a){a.prototype.weekday=function(s){var u=this.$locale().weekStart||0,c=this.$W,m=(c<u?c+7:c)-u;return this.$utils().u(s)?m:this.subtract(m,"day").add(s,"day")}}})})(Si);var po=Si.exports;const go=On(po);var xi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){return function(r,a,s){var u=a.prototype,c=function(y){return y&&(y.indexOf?y:y.s)},m=function(y,D,I,P,T){var b=y.name?y:y.$locale(),N=c(b[D]),O=c(b[I]),E=N||O.map(function(B){return B.slice(0,P)});if(!T)return E;var j=b.weekStart;return E.map(function(B,z){return E[(z+(j||0))%7]})},p=function(){return s.Ls[s.locale()]},v=function(y,D){return y.formats[D]||function(I){return I.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(P,T,b){return T||b.slice(1)})}(y.formats[D.toUpperCase()])},h=function(){var y=this;return{months:function(D){return D?D.format("MMMM"):m(y,"months")},monthsShort:function(D){return D?D.format("MMM"):m(y,"monthsShort","months",3)},firstDayOfWeek:function(){return y.$locale().weekStart||0},weekdays:function(D){return D?D.format("dddd"):m(y,"weekdays")},weekdaysMin:function(D){return D?D.format("dd"):m(y,"weekdaysMin","weekdays",2)},weekdaysShort:function(D){return D?D.format("ddd"):m(y,"weekdaysShort","weekdays",3)},longDateFormat:function(D){return v(y.$locale(),D)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};u.localeData=function(){return h.bind(this)()},s.localeData=function(){var y=p();return{firstDayOfWeek:function(){return y.weekStart||0},weekdays:function(){return s.weekdays()},weekdaysShort:function(){return s.weekdaysShort()},weekdaysMin:function(){return s.weekdaysMin()},months:function(){return s.months()},monthsShort:function(){return s.monthsShort()},longDateFormat:function(D){return v(y,D)},meridiem:y.meridiem,ordinal:y.ordinal}},s.months=function(){return m(p(),"months")},s.monthsShort=function(){return m(p(),"monthsShort","months",3)},s.weekdays=function(y){return m(p(),"weekdays",null,null,y)},s.weekdaysShort=function(y){return m(p(),"weekdaysShort","weekdays",3,y)},s.weekdaysMin=function(y){return m(p(),"weekdaysMin","weekdays",2,y)}}})})(xi);var vo=xi.exports;const yo=On(vo);var Di={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){var r="week",a="year";return function(s,u,c){var m=u.prototype;m.week=function(p){if(p===void 0&&(p=null),p!==null)return this.add(7*(p-this.week()),"day");var v=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var h=c(this).startOf(a).add(1,a).date(v),y=c(this).endOf(r);if(h.isBefore(y))return 1}var D=c(this).startOf(a).date(v).startOf(r).subtract(1,"millisecond"),I=this.diff(D,r,!0);return I<0?c(this).startOf("week").week():Math.ceil(I)},m.weeks=function(p){return p===void 0&&(p=null),this.week(p)}}})})(Di);var bo=Di.exports;const So=On(bo);var Ci={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){return function(r,a){a.prototype.weekYear=function(){var s=this.month(),u=this.week(),c=this.year();return u===1&&s===11?c+1:s===0&&u>=52?c-1:c}}})})(Ci);var xo=Ci.exports;const Do=On(xo);var Mi={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){return function(r,a){var s=a.prototype,u=s.format;s.format=function(c){var m=this,p=this.$locale();if(!this.isValid())return u.bind(this)(c);var v=this.$utils(),h=(c||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(y){switch(y){case"Q":return Math.ceil((m.$M+1)/3);case"Do":return p.ordinal(m.$D);case"gggg":return m.weekYear();case"GGGG":return m.isoWeekYear();case"wo":return p.ordinal(m.week(),"W");case"w":case"ww":return v.s(m.week(),y==="w"?1:2,"0");case"W":case"WW":return v.s(m.isoWeek(),y==="W"?1:2,"0");case"k":case"kk":return v.s(String(m.$H===0?24:m.$H),y==="k"?1:2,"0");case"X":return Math.floor(m.$d.getTime()/1e3);case"x":return m.$d.getTime();case"z":return"["+m.offsetName()+"]";case"zzz":return"["+m.offsetName("long")+"]";default:return y}});return u.bind(this)(h)}}})})(Mi);var Co=Mi.exports;const Mo=On(Co);var ki={exports:{}};(function(e,t){(function(r,a){e.exports=a()})(Fn,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},a=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,s=/\d/,u=/\d\d/,c=/\d\d?/,m=/\d*[^-_:/,()\s\d]+/,p={},v=function(b){return(b=+b)+(b>68?1900:2e3)},h=function(b){return function(N){this[b]=+N}},y=[/[+-]\d\d:?(\d\d)?|Z/,function(b){(this.zone||(this.zone={})).offset=function(N){if(!N||N==="Z")return 0;var O=N.match(/([+-]|\d\d)/g),E=60*O[1]+(+O[2]||0);return E===0?0:O[0]==="+"?-E:E}(b)}],D=function(b){var N=p[b];return N&&(N.indexOf?N:N.s.concat(N.f))},I=function(b,N){var O,E=p.meridiem;if(E){for(var j=1;j<=24;j+=1)if(b.indexOf(E(j,0,N))>-1){O=j>12;break}}else O=b===(N?"pm":"PM");return O},P={A:[m,function(b){this.afternoon=I(b,!1)}],a:[m,function(b){this.afternoon=I(b,!0)}],Q:[s,function(b){this.month=3*(b-1)+1}],S:[s,function(b){this.milliseconds=100*+b}],SS:[u,function(b){this.milliseconds=10*+b}],SSS:[/\d{3}/,function(b){this.milliseconds=+b}],s:[c,h("seconds")],ss:[c,h("seconds")],m:[c,h("minutes")],mm:[c,h("minutes")],H:[c,h("hours")],h:[c,h("hours")],HH:[c,h("hours")],hh:[c,h("hours")],D:[c,h("day")],DD:[u,h("day")],Do:[m,function(b){var N=p.ordinal,O=b.match(/\d+/);if(this.day=O[0],N)for(var E=1;E<=31;E+=1)N(E).replace(/\[|\]/g,"")===b&&(this.day=E)}],w:[c,h("week")],ww:[u,h("week")],M:[c,h("month")],MM:[u,h("month")],MMM:[m,function(b){var N=D("months"),O=(D("monthsShort")||N.map(function(E){return E.slice(0,3)})).indexOf(b)+1;if(O<1)throw new Error;this.month=O%12||O}],MMMM:[m,function(b){var N=D("months").indexOf(b)+1;if(N<1)throw new Error;this.month=N%12||N}],Y:[/[+-]?\d+/,h("year")],YY:[u,function(b){this.year=v(b)}],YYYY:[/\d{4}/,h("year")],Z:y,ZZ:y};function T(b){var N,O;N=b,O=p&&p.formats;for(var E=(b=N.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(W,_,Z){var re=Z&&Z.toUpperCase();return _||O[Z]||r[Z]||O[re].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function($,k,g){return k||g.slice(1)})})).match(a),j=E.length,B=0;B<j;B+=1){var z=E[B],F=P[z],q=F&&F[0],ee=F&&F[1];E[B]=ee?{regex:q,parser:ee}:z.replace(/^\[|\]$/g,"")}return function(W){for(var _={},Z=0,re=0;Z<j;Z+=1){var $=E[Z];if(typeof $=="string")re+=$.length;else{var k=$.regex,g=$.parser,C=W.slice(re),M=k.exec(C)[0];g.call(_,M),W=W.replace(M,"")}}return function(A){var Y=A.afternoon;if(Y!==void 0){var U=A.hours;Y?U<12&&(A.hours+=12):U===12&&(A.hours=0),delete A.afternoon}}(_),_}}return function(b,N,O){O.p.customParseFormat=!0,b&&b.parseTwoDigitYear&&(v=b.parseTwoDigitYear);var E=N.prototype,j=E.parse;E.parse=function(B){var z=B.date,F=B.utc,q=B.args;this.$u=F;var ee=q[1];if(typeof ee=="string"){var W=q[2]===!0,_=q[3]===!0,Z=W||_,re=q[2];_&&(re=q[2]),p=this.$locale(),!W&&re&&(p=O.Ls[re]),this.$d=function(C,M,A,Y){try{if(["x","X"].indexOf(M)>-1)return new Date((M==="X"?1e3:1)*C);var U=T(M)(C),L=U.year,X=U.month,J=U.day,w=U.hours,ne=U.minutes,se=U.seconds,V=U.milliseconds,Q=U.zone,ie=U.week,me=new Date,we=J||(L||X?1:me.getDate()),ae=L||me.getFullYear(),Me=0;L&&!X||(Me=X>0?X-1:me.getMonth());var Ee,ge=w||0,ke=ne||0,ve=se||0,Ne=V||0;return Q?new Date(Date.UTC(ae,Me,we,ge,ke,ve,Ne+60*Q.offset*1e3)):A?new Date(Date.UTC(ae,Me,we,ge,ke,ve,Ne)):(Ee=new Date(ae,Me,we,ge,ke,ve,Ne),ie&&(Ee=Y(Ee).week(ie).toDate()),Ee)}catch{return new Date("")}}(z,ee,F,O),this.init(),re&&re!==!0&&(this.$L=this.locale(re).$L),Z&&z!=this.format(ee)&&(this.$d=new Date("")),p={}}else if(ee instanceof Array)for(var $=ee.length,k=1;k<=$;k+=1){q[1]=ee[k-1];var g=O.apply(this,q);if(g.isValid()){this.$d=g.$d,this.$L=g.$L,this.init();break}k===$&&(this.$d=new Date(""))}else j.call(this,B)}}})})(ki);var ko=ki.exports;const Po=On(ko);Pt.extend(Po);Pt.extend(Mo);Pt.extend(go);Pt.extend(yo);Pt.extend(So);Pt.extend(Do);Pt.extend(function(e,t){var r=t.prototype,a=r.format;r.format=function(u){var c=(u||"").replace("Wo","wo");return a.bind(this)(c)}});var wo={bn_BD:"bn-bd",by_BY:"be",en_GB:"en-gb",en_US:"en",fr_BE:"fr",fr_CA:"fr-ca",hy_AM:"hy-am",kmr_IQ:"ku",nl_BE:"nl-be",pt_BR:"pt-br",zh_CN:"zh-cn",zh_HK:"zh-hk",zh_TW:"zh-tw"},Nn=function(t){var r=wo[t];return r||t.split("_")[0]},jo={getNow:function(){var t=Pt();return typeof t.tz=="function"?t.tz():t},getFixedDate:function(t){return Pt(t,["YYYY-M-DD","YYYY-MM-DD"])},getEndDate:function(t){return t.endOf("month")},getWeekDay:function(t){var r=t.locale("en");return r.weekday()+r.localeData().firstDayOfWeek()},getYear:function(t){return t.year()},getMonth:function(t){return t.month()},getDate:function(t){return t.date()},getHour:function(t){return t.hour()},getMinute:function(t){return t.minute()},getSecond:function(t){return t.second()},getMillisecond:function(t){return t.millisecond()},addYear:function(t,r){return t.add(r,"year")},addMonth:function(t,r){return t.add(r,"month")},addDate:function(t,r){return t.add(r,"day")},setYear:function(t,r){return t.year(r)},setMonth:function(t,r){return t.month(r)},setDate:function(t,r){return t.date(r)},setHour:function(t,r){return t.hour(r)},setMinute:function(t,r){return t.minute(r)},setSecond:function(t,r){return t.second(r)},setMillisecond:function(t,r){return t.millisecond(r)},isAfter:function(t,r){return t.isAfter(r)},isValidate:function(t){return t.isValid()},locale:{getWeekFirstDay:function(t){return Pt().locale(Nn(t)).localeData().firstDayOfWeek()},getWeekFirstDate:function(t,r){return r.locale(Nn(t)).weekday(0)},getWeek:function(t,r){return r.locale(Nn(t)).week()},getShortWeekDays:function(t){return Pt().locale(Nn(t)).localeData().weekdaysMin()},getShortMonths:function(t){return Pt().locale(Nn(t)).localeData().monthsShort()},format:function(t,r,a){return r.locale(Nn(t)).format(a)},parse:function(t,r,a){for(var s=Nn(t),u=0;u<a.length;u+=1){var c=a[u],m=r;if(c.includes("wo")||c.includes("Wo")){for(var p=m.split("-")[0],v=m.split("-")[1],h=Pt(p,"YYYY").startOf("year").locale(s),y=0;y<=52;y+=1){var D=h.add(y,"week");if(D.format("Wo")===v)return D}return null}var I=Pt(m,c,!0).locale(s);if(I.isValid())return I}return null}}};function No(e,t){return e!==void 0?e:t?"bottomRight":"bottomLeft"}var nn=o.createContext(null),Io={bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:0,adjustY:1}}};function Pi(e){var t=e.popupElement,r=e.popupStyle,a=e.popupClassName,s=e.popupAlign,u=e.transitionName,c=e.getPopupContainer,m=e.children,p=e.range,v=e.placement,h=e.builtinPlacements,y=h===void 0?Io:h,D=e.direction,I=e.visible,P=e.onClose,T=o.useContext(nn),b=T.prefixCls,N="".concat(b,"-dropdown"),O=No(v,D==="rtl");return o.createElement(vs,{showAction:[],hideAction:["click"],popupPlacement:O,builtinPlacements:y,prefixCls:N,popupTransitionName:u,popup:t,popupAlign:s,popupVisible:I,popupClassName:gt(a,tt(tt({},"".concat(N,"-range"),p),"".concat(N,"-rtl"),D==="rtl")),popupStyle:r,stretch:"minWidth",getPopupContainer:c,onPopupVisibleChange:function(j){j||P()}},m)}function ua(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0",a=String(e);a.length<t;)a="".concat(r).concat(a);return a}function An(e){return e==null?[]:Array.isArray(e)?e:[e]}function sr(e,t,r){var a=Ht(e);return a[t]=r,a}function wr(e,t){var r={},a=t||Object.keys(e);return a.forEach(function(s){e[s]!==void 0&&(r[s]=e[s])}),r}function wi(e,t,r){if(r)return r;switch(e){case"time":return t.fieldTimeFormat;case"datetime":return t.fieldDateTimeFormat;case"month":return t.fieldMonthFormat;case"year":return t.fieldYearFormat;case"quarter":return t.fieldQuarterFormat;case"week":return t.fieldWeekFormat;default:return t.fieldDateFormat}}function ji(e,t,r){var a=r!==void 0?r:t[t.length-1],s=t.find(function(u){return e[u]});return a!==s?e[s]:void 0}function Ni(e){return wr(e,["placement","builtinPlacements","popupAlign","getPopupContainer","transitionName","direction"])}function ca(e,t,r,a){var s=o.useMemo(function(){return e||function(c,m){var p=c;return t&&m.type==="date"?t(p,m.today):r&&m.type==="month"?r(p,m.locale):m.originNode}},[e,r,t]),u=o.useCallback(function(c,m){return s(c,_e(_e({},m),{},{range:a}))},[s,a]);return u}function Ii(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=o.useState([!1,!1]),s=ce(a,2),u=s[0],c=s[1],m=function(h,y){c(function(D){return sr(D,y,h)})},p=o.useMemo(function(){return u.map(function(v,h){if(v)return!0;var y=e[h];return y?!!(!r[h]&&!y||y&&t(y,{activeIndex:h})):!1})},[e,u,t,r]);return[p,m]}function Ei(e,t,r,a,s){var u="",c=[];return e&&c.push(s?"hh":"HH"),t&&c.push("mm"),r&&c.push("ss"),u=c.join(":"),a&&(u+=".SSS"),s&&(u+=" A"),u}function Eo(e,t,r,a,s,u){var c=e.fieldDateTimeFormat,m=e.fieldDateFormat,p=e.fieldTimeFormat,v=e.fieldMonthFormat,h=e.fieldYearFormat,y=e.fieldWeekFormat,D=e.fieldQuarterFormat,I=e.yearFormat,P=e.cellYearFormat,T=e.cellQuarterFormat,b=e.dayFormat,N=e.cellDateFormat,O=Ei(t,r,a,s,u);return _e(_e({},e),{},{fieldDateTimeFormat:c||"YYYY-MM-DD ".concat(O),fieldDateFormat:m||"YYYY-MM-DD",fieldTimeFormat:p||O,fieldMonthFormat:v||"YYYY-MM",fieldYearFormat:h||"YYYY",fieldWeekFormat:y||"gggg-wo",fieldQuarterFormat:D||"YYYY-[Q]Q",yearFormat:I||"YYYY",cellYearFormat:P||"YYYY",cellQuarterFormat:T||"[Q]Q",cellDateFormat:N||b||"D"})}function Ri(e,t){var r=t.showHour,a=t.showMinute,s=t.showSecond,u=t.showMillisecond,c=t.use12Hours;return Cn.useMemo(function(){return Eo(e,r,a,s,u,c)},[e,r,a,s,u,c])}function Qn(e,t,r){return r??t.some(function(a){return e.includes(a)})}var Ro=["showNow","showHour","showMinute","showSecond","showMillisecond","use12Hours","hourStep","minuteStep","secondStep","millisecondStep","hideDisabledOptions","defaultValue","disabledHours","disabledMinutes","disabledSeconds","disabledMilliseconds","disabledTime","changeOnScroll","defaultOpenValue"];function To(e){var t=wr(e,Ro),r=e.format,a=e.picker,s=null;return r&&(s=r,Array.isArray(s)&&(s=s[0]),s=cr(s)==="object"?s.format:s),a==="time"&&(t.format=s),[t,s]}function $o(e){return e&&typeof e=="string"}function Ti(e,t,r,a){return[e,t,r,a].some(function(s){return s!==void 0})}function $i(e,t,r,a,s){var u=t,c=r,m=a;if(!e&&!u&&!c&&!m&&!s)u=!0,c=!0,m=!0;else if(e){var p,v,h,y=[u,c,m].some(function(P){return P===!1}),D=[u,c,m].some(function(P){return P===!0}),I=y?!0:!D;u=(p=u)!==null&&p!==void 0?p:I,c=(v=c)!==null&&v!==void 0?v:I,m=(h=m)!==null&&h!==void 0?h:I}return[u,c,m,s]}function Oi(e){var t=e.showTime,r=To(e),a=ce(r,2),s=a[0],u=a[1],c=t&&cr(t)==="object"?t:{},m=_e(_e({defaultOpenValue:c.defaultOpenValue||c.defaultValue},s),c),p=m.showMillisecond,v=m.showHour,h=m.showMinute,y=m.showSecond,D=Ti(v,h,y,p),I=$i(D,v,h,y,p),P=ce(I,3);return v=P[0],h=P[1],y=P[2],[m,_e(_e({},m),{},{showHour:v,showMinute:h,showSecond:y,showMillisecond:p}),m.format,u]}function Fi(e,t,r,a,s){var u=e==="time";if(e==="datetime"||u){for(var c=a,m=wi(e,s,null),p=m,v=[t,r],h=0;h<v.length;h+=1){var y=An(v[h])[0];if($o(y)){p=y;break}}var D=c.showHour,I=c.showMinute,P=c.showSecond,T=c.showMillisecond,b=c.use12Hours,N=Qn(p,["a","A","LT","LLL","LTS"],b),O=Ti(D,I,P,T);O||(D=Qn(p,["H","h","k","LT","LLL"]),I=Qn(p,["m","LT","LLL"]),P=Qn(p,["s","LTS"]),T=Qn(p,["SSS"]));var E=$i(O,D,I,P,T),j=ce(E,3);D=j[0],I=j[1],P=j[2];var B=t||Ei(D,I,P,T,N);return _e(_e({},c),{},{format:B,showHour:D,showMinute:I,showSecond:P,showMillisecond:T,use12Hours:N})}return null}function Oo(e,t,r){if(t===!1)return null;var a=t&&cr(t)==="object"?t:{};return a.clearIcon||r||o.createElement("span",{className:"".concat(e,"-clear-btn")})}var Fr=7;function wn(e,t,r){return!e&&!t||e===t?!0:!e||!t?!1:r()}function ta(e,t,r){return wn(t,r,function(){var a=Math.floor(e.getYear(t)/10),s=Math.floor(e.getYear(r)/10);return a===s})}function $n(e,t,r){return wn(t,r,function(){return e.getYear(t)===e.getYear(r)})}function Ma(e,t){var r=Math.floor(e.getMonth(t)/3);return r+1}function Fo(e,t,r){return wn(t,r,function(){return $n(e,t,r)&&Ma(e,t)===Ma(e,r)})}function da(e,t,r){return wn(t,r,function(){return $n(e,t,r)&&e.getMonth(t)===e.getMonth(r)})}function ma(e,t,r){return wn(t,r,function(){return $n(e,t,r)&&da(e,t,r)&&e.getDate(t)===e.getDate(r)})}function Ai(e,t,r){return wn(t,r,function(){return e.getHour(t)===e.getHour(r)&&e.getMinute(t)===e.getMinute(r)&&e.getSecond(t)===e.getSecond(r)})}function Li(e,t,r){return wn(t,r,function(){return ma(e,t,r)&&Ai(e,t,r)&&e.getMillisecond(t)===e.getMillisecond(r)})}function nr(e,t,r,a){return wn(r,a,function(){var s=e.locale.getWeekFirstDate(t,r),u=e.locale.getWeekFirstDate(t,a);return $n(e,s,u)&&e.locale.getWeek(t,r)===e.locale.getWeek(t,a)})}function _t(e,t,r,a,s){switch(s){case"date":return ma(e,r,a);case"week":return nr(e,t.locale,r,a);case"month":return da(e,r,a);case"quarter":return Fo(e,r,a);case"year":return $n(e,r,a);case"decade":return ta(e,r,a);case"time":return Ai(e,r,a);default:return Li(e,r,a)}}function jr(e,t,r,a){return!t||!r||!a?!1:e.isAfter(a,t)&&e.isAfter(r,a)}function mr(e,t,r,a,s){return _t(e,t,r,a,s)?!0:e.isAfter(r,a)}function Ao(e,t,r){var a=t.locale.getWeekFirstDay(e),s=t.setDate(r,1),u=t.getWeekDay(s),c=t.addDate(s,a-u);return t.getMonth(c)===t.getMonth(r)&&t.getDate(c)>1&&(c=t.addDate(c,-7)),c}function wt(e,t){var r=t.generateConfig,a=t.locale,s=t.format;return e?typeof s=="function"?s(e):r.locale.format(a.locale,e,s):""}function Mr(e,t,r){var a=t,s=["getHour","getMinute","getSecond","getMillisecond"],u=["setHour","setMinute","setSecond","setMillisecond"];return u.forEach(function(c,m){r?a=e[c](a,e[s[m]](r)):a=e[c](a,0)}),a}function Lo(e,t,r,a,s){var u=Ot(function(c,m){return!!(r&&r(c,m)||a&&e.isAfter(a,c)&&!_t(e,t,a,c,m.type)||s&&e.isAfter(c,s)&&!_t(e,t,s,c,m.type))});return u}function Uo(e,t,r){return o.useMemo(function(){var a=wi(e,t,r),s=An(a),u=s[0],c=cr(u)==="object"&&u.type==="mask"?u.format:null;return[s.map(function(m){return typeof m=="string"||typeof m=="function"?m:m.format}),c]},[e,t,r])}function _o(e,t,r){return typeof e[0]=="function"||r?!0:t}function Ho(e,t,r,a){var s=Ot(function(u,c){var m=_e({type:t},c);if(delete m.activeIndex,!e.isValidate(u)||r&&r(u,m))return!0;if((t==="date"||t==="time")&&a){var p,v=c&&c.activeIndex===1?"end":"start",h=((p=a.disabledTime)===null||p===void 0?void 0:p.call(a,u,v,{from:m.from}))||{},y=h.disabledHours,D=h.disabledMinutes,I=h.disabledSeconds,P=h.disabledMilliseconds,T=a.disabledHours,b=a.disabledMinutes,N=a.disabledSeconds,O=y||T,E=D||b,j=I||N,B=e.getHour(u),z=e.getMinute(u),F=e.getSecond(u),q=e.getMillisecond(u);if(O&&O().includes(B)||E&&E(B).includes(z)||j&&j(B,z).includes(F)||P&&P(B,z,F).includes(q))return!0}return!1});return s}function fr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=o.useMemo(function(){var a=e&&An(e);return t&&a&&(a[1]=a[1]||a[0]),a},[e,t]);return r}function Ui(e,t){var r=e.generateConfig,a=e.locale,s=e.picker,u=s===void 0?"date":s,c=e.prefixCls,m=c===void 0?"rc-picker":c,p=e.styles,v=p===void 0?{}:p,h=e.classNames,y=h===void 0?{}:h,D=e.order,I=D===void 0?!0:D,P=e.components,T=P===void 0?{}:P,b=e.inputRender,N=e.allowClear,O=e.clearIcon,E=e.needConfirm,j=e.multiple,B=e.format,z=e.inputReadOnly,F=e.disabledDate,q=e.minDate,ee=e.maxDate,W=e.showTime,_=e.value,Z=e.defaultValue,re=e.pickerValue,$=e.defaultPickerValue,k=fr(_),g=fr(Z),C=fr(re),M=fr($),A=u==="date"&&W?"datetime":u,Y=A==="time"||A==="datetime",U=Y||j,L=E??Y,X=Oi(e),J=ce(X,4),w=J[0],ne=J[1],se=J[2],V=J[3],Q=Ri(a,ne),ie=o.useMemo(function(){return Fi(A,se,V,w,Q)},[A,se,V,w,Q]),me=o.useMemo(function(){return _e(_e({},e),{},{prefixCls:m,locale:Q,picker:u,styles:v,classNames:y,order:I,components:_e({input:b},T),clearIcon:Oo(m,N,O),showTime:ie,value:k,defaultValue:g,pickerValue:C,defaultPickerValue:M},t==null?void 0:t())},[e]),we=Uo(A,Q,B),ae=ce(we,2),Me=ae[0],Ee=ae[1],ge=_o(Me,z,j),ke=Lo(r,a,F,q,ee),ve=Ho(r,u,ke,ie),Ne=o.useMemo(function(){return _e(_e({},me),{},{needConfirm:L,inputReadOnly:ge,disabledDate:ke})},[me,L,ge,ke]);return[Ne,A,U,Me,Ee,ve]}function Bo(e,t,r){var a=fn(t,{value:e}),s=ce(a,2),u=s[0],c=s[1],m=Cn.useRef(e),p=Cn.useRef(),v=function(){hn.cancel(p.current)},h=Ot(function(){c(m.current),r&&u!==m.current&&r(m.current)}),y=Ot(function(D,I){v(),m.current=D,D||I?h():p.current=hn(h)});return Cn.useEffect(function(){return v},[]),[u,y]}function _i(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,s=r.every(function(h){return h})?!1:e,u=Bo(s,t||!1,a),c=ce(u,2),m=c[0],p=c[1];function v(h){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!y.inherit||m)&&p(h,y.force)}return[m,v]}function Hi(e){var t=o.useRef();return o.useImperativeHandle(e,function(){var r;return{nativeElement:(r=t.current)===null||r===void 0?void 0:r.nativeElement,focus:function(s){var u;(u=t.current)===null||u===void 0||u.focus(s)},blur:function(){var s;(s=t.current)===null||s===void 0||s.blur()}}}),t}function Bi(e,t){return o.useMemo(function(){return e||(t?(ys(!1,"`ranges` is deprecated. Please use `presets` instead."),Object.entries(t).map(function(r){var a=ce(r,2),s=a[0],u=a[1];return{label:s,value:u}})):[])},[e,t])}function fa(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=o.useRef(t);a.current=t,bs(function(){if(e)a.current(e);else{var s=hn(function(){a.current(e)},r);return function(){hn.cancel(s)}}},[e])}function zi(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=o.useState(0),s=ce(a,2),u=s[0],c=s[1],m=o.useState(!1),p=ce(m,2),v=p[0],h=p[1],y=o.useRef([]),D=o.useRef(null),I=o.useRef(null),P=function(j){D.current=j},T=function(j){return D.current===j},b=function(j){h(j)},N=function(j){return j&&(I.current=j),I.current},O=function(j){var B=y.current,z=new Set(B.filter(function(q){return j[q]||t[q]})),F=B[B.length-1]===0?1:0;return z.size>=2||e[F]?null:F};return fa(v||r,function(){v||(y.current=[],P(null))}),o.useEffect(function(){v&&y.current.push(u)},[v,u]),[v,b,N,u,c,O,y.current,P,T]}function zo(e,t,r,a,s,u){var c=r[r.length-1],m=function(v,h){var y=ce(e,2),D=y[0],I=y[1],P=_e(_e({},h),{},{from:ji(e,r)});return c===1&&t[0]&&D&&!_t(a,s,D,v,P.type)&&a.isAfter(D,v)||c===0&&t[1]&&I&&!_t(a,s,I,v,P.type)&&a.isAfter(v,I)?!0:u==null?void 0:u(v,P)};return m}function rr(e,t,r,a){switch(t){case"date":case"week":return e.addMonth(r,a);case"month":case"quarter":return e.addYear(r,a);case"year":return e.addYear(r,a*10);case"decade":return e.addYear(r,a*100);default:return r}}var Ar=[];function Yi(e,t,r,a,s,u,c,m){var p=arguments.length>8&&arguments[8]!==void 0?arguments[8]:Ar,v=arguments.length>9&&arguments[9]!==void 0?arguments[9]:Ar,h=arguments.length>10&&arguments[10]!==void 0?arguments[10]:Ar,y=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0,I=arguments.length>13?arguments[13]:void 0,P=c==="time",T=u||0,b=function(C){var M=e.getNow();return P&&(M=Mr(e,M)),p[C]||r[C]||M},N=ce(v,2),O=N[0],E=N[1],j=fn(function(){return b(0)},{value:O}),B=ce(j,2),z=B[0],F=B[1],q=fn(function(){return b(1)},{value:E}),ee=ce(q,2),W=ee[0],_=ee[1],Z=o.useMemo(function(){var g=[z,W][T];return P?g:Mr(e,g,h[T])},[P,z,W,T,e,h]),re=function(C){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"panel",A=[F,_][T];A(C);var Y=[z,W];Y[T]=C,y&&(!_t(e,t,z,Y[0],c)||!_t(e,t,W,Y[1],c))&&y(Y,{source:M,range:T===1?"end":"start",mode:a})},$=function(C,M){if(m){var A={date:"month",week:"month",month:"year",quarter:"year"},Y=A[c];if(Y&&!_t(e,t,C,M,Y))return rr(e,c,M,-1);if(c==="year"&&C){var U=Math.floor(e.getYear(C)/10),L=Math.floor(e.getYear(M)/10);if(U!==L)return rr(e,c,M,-1)}}return M},k=o.useRef(null);return Pn(function(){if(s&&!p[T]){var g=P?null:e.getNow();if(k.current!==null&&k.current!==T?g=[z,W][T^1]:r[T]?g=T===0?r[0]:$(r[0],r[1]):r[T^1]&&(g=r[T^1]),g){D&&e.isAfter(D,g)&&(g=D);var C=m?rr(e,c,g,1):g;I&&e.isAfter(C,I)&&(g=m?rr(e,c,I,-1):I),re(g,"reset")}}},[s,T,r[T]]),o.useEffect(function(){s?k.current=T:k.current=null},[s,T]),Pn(function(){s&&p&&p[T]&&re(p[T],"reset")},[s,T]),[Z,re]}function Wi(e,t){var r=o.useRef(e),a=o.useState({}),s=ce(a,2),u=s[1],c=function(v){return v&&t!==void 0?t:r.current},m=function(v){r.current=v,u({})};return[c,m,c(!0)]}var Yo=[];function Ki(e,t,r){var a=function(c){return c.map(function(m){return wt(m,{generateConfig:e,locale:t,format:r[0]})})},s=function(c,m){for(var p=Math.max(c.length,m.length),v=-1,h=0;h<p;h+=1){var y=c[h]||null,D=m[h]||null;if(y!==D&&!Li(e,y,D)){v=h;break}}return[v<0,v!==0]};return[a,s]}function qi(e,t){return Ht(e).sort(function(r,a){return t.isAfter(r,a)?1:-1})}function Wo(e){var t=Wi(e),r=ce(t,2),a=r[0],s=r[1],u=Ot(function(){s(e)});return o.useEffect(function(){u()},[e]),[a,s]}function Vi(e,t,r,a,s,u,c,m,p){var v=fn(u,{value:c}),h=ce(v,2),y=h[0],D=h[1],I=y||Yo,P=Wo(I),T=ce(P,2),b=T[0],N=T[1],O=Ki(e,t,r),E=ce(O,2),j=E[0],B=E[1],z=Ot(function(q){var ee=Ht(q);if(a)for(var W=0;W<2;W+=1)ee[W]=ee[W]||null;else s&&(ee=qi(ee.filter(function(g){return g}),e));var _=B(b(),ee),Z=ce(_,2),re=Z[0],$=Z[1];if(!re&&(N(ee),m)){var k=j(ee);m(ee,k,{range:$?"end":"start"})}}),F=function(){p&&p(b())};return[I,D,b,z,F]}function Zi(e,t,r,a,s,u,c,m,p,v){var h=e.generateConfig,y=e.locale,D=e.picker,I=e.onChange,P=e.allowEmpty,T=e.order,b=u.some(function(re){return re})?!1:T,N=Ki(h,y,c),O=ce(N,2),E=O[0],j=O[1],B=Wi(t),z=ce(B,2),F=z[0],q=z[1],ee=Ot(function(){q(t)});o.useEffect(function(){ee()},[t]);var W=Ot(function(re){var $=re===null,k=Ht(re||F());if($)for(var g=Math.max(u.length,k.length),C=0;C<g;C+=1)u[C]||(k[C]=null);b&&k[0]&&k[1]&&(k=qi(k,h)),s(k);var M=k,A=ce(M,2),Y=A[0],U=A[1],L=!Y,X=!U,J=P?(!L||P[0])&&(!X||P[1]):!0,w=!T||L||X||_t(h,y,Y,U,D)||h.isAfter(U,Y),ne=(u[0]||!Y||!v(Y,{activeIndex:0}))&&(u[1]||!U||!v(U,{from:Y,activeIndex:1})),se=$||J&&w&&ne;if(se){r(k);var V=j(k,t),Q=ce(V,1),ie=Q[0];I&&!ie&&I($&&k.every(function(me){return!me})?null:k,E(k))}return se}),_=Ot(function(re,$){var k=sr(F(),re,a()[re]);q(k),$&&W()}),Z=!m&&!p;return fa(!Z,function(){Z&&(W(),s(t),ee())},2),[_,W]}function Gi(e,t,r,a,s){return t!=="date"&&t!=="time"?!1:r!==void 0?r:a!==void 0?a:!s&&(e==="date"||e==="time")}function Ko(e,t,r,a,s,u){var c=e;function m(y,D,I){var P=u[y](c),T=I.find(function(E){return E.value===P});if(!T||T.disabled){var b=I.filter(function(E){return!E.disabled}),N=Ht(b).reverse(),O=N.find(function(E){return E.value<=P})||b[0];O&&(P=O.value,c=u[D](c,P))}return P}var p=m("getHour","setHour",t()),v=m("getMinute","setMinute",r(p)),h=m("getSecond","setSecond",a(p,v));return m("getMillisecond","setMillisecond",s(p,v,h)),c}function hr(){return[]}function pr(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:2,c=[],m=r>=1?r|0:1,p=e;p<=t;p+=m){var v=s.includes(p);(!v||!a)&&c.push({label:ua(p,u),value:p,disabled:v})}return c}function ha(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=t||{},s=a.use12Hours,u=a.hourStep,c=u===void 0?1:u,m=a.minuteStep,p=m===void 0?1:m,v=a.secondStep,h=v===void 0?1:v,y=a.millisecondStep,D=y===void 0?100:y,I=a.hideDisabledOptions,P=a.disabledTime,T=a.disabledHours,b=a.disabledMinutes,N=a.disabledSeconds,O=o.useMemo(function(){return r||e.getNow()},[r,e]),E=o.useCallback(function(M){var A=(P==null?void 0:P(M))||{};return[A.disabledHours||T||hr,A.disabledMinutes||b||hr,A.disabledSeconds||N||hr,A.disabledMilliseconds||hr]},[P,T,b,N]),j=o.useMemo(function(){return E(O)},[O,E]),B=ce(j,4),z=B[0],F=B[1],q=B[2],ee=B[3],W=o.useCallback(function(M,A,Y,U){var L=pr(0,23,c,I,M()),X=s?L.map(function(se){return _e(_e({},se),{},{label:ua(se.value%12||12,2)})}):L,J=function(V){return pr(0,59,p,I,A(V))},w=function(V,Q){return pr(0,59,h,I,Y(V,Q))},ne=function(V,Q,ie){return pr(0,999,D,I,U(V,Q,ie),3)};return[X,J,w,ne]},[I,c,s,D,p,h]),_=o.useMemo(function(){return W(z,F,q,ee)},[W,z,F,q,ee]),Z=ce(_,4),re=Z[0],$=Z[1],k=Z[2],g=Z[3],C=function(A,Y){var U=function(){return re},L=$,X=k,J=g;if(Y){var w=E(Y),ne=ce(w,4),se=ne[0],V=ne[1],Q=ne[2],ie=ne[3],me=W(se,V,Q,ie),we=ce(me,4),ae=we[0],Me=we[1],Ee=we[2],ge=we[3];U=function(){return ae},L=Me,X=Ee,J=ge}var ke=Ko(A,U,L,X,J,e);return ke};return[C,re,$,k,g]}function qo(e){var t=e.mode,r=e.internalMode,a=e.renderExtraFooter,s=e.showNow,u=e.showTime,c=e.onSubmit,m=e.onNow,p=e.invalid,v=e.needConfirm,h=e.generateConfig,y=e.disabledDate,D=o.useContext(nn),I=D.prefixCls,P=D.locale,T=D.button,b=T===void 0?"button":T,N=h.getNow(),O=ha(h,u,N),E=ce(O,1),j=E[0],B=a==null?void 0:a(t),z=y(N,{type:t}),F=function(){if(!z){var $=j(N);m($)}},q="".concat(I,"-now"),ee="".concat(q,"-btn"),W=s&&o.createElement("li",{className:q},o.createElement("a",{className:gt(ee,z&&"".concat(ee,"-disabled")),"aria-disabled":z,onClick:F},r==="date"?P.today:P.now)),_=v&&o.createElement("li",{className:"".concat(I,"-ok")},o.createElement(b,{disabled:p,onClick:c},P.ok)),Z=(W||_)&&o.createElement("ul",{className:"".concat(I,"-ranges")},W,_);return!B&&!Z?null:o.createElement("div",{className:"".concat(I,"-footer")},B&&o.createElement("div",{className:"".concat(I,"-footer-extra")},B),Z)}function Xi(e,t,r){function a(s,u){var c=s.findIndex(function(p){return _t(e,t,p,u,r)});if(c===-1)return[].concat(Ht(s),[u]);var m=Ht(s);return m.splice(c,1),m}return a}var Ln=o.createContext(null);function Nr(){return o.useContext(Ln)}function Zn(e,t){var r=e.prefixCls,a=e.generateConfig,s=e.locale,u=e.disabledDate,c=e.minDate,m=e.maxDate,p=e.cellRender,v=e.hoverValue,h=e.hoverRangeValue,y=e.onHover,D=e.values,I=e.pickerValue,P=e.onSelect,T=e.prevIcon,b=e.nextIcon,N=e.superPrevIcon,O=e.superNextIcon,E=a.getNow(),j={now:E,values:D,pickerValue:I,prefixCls:r,disabledDate:u,minDate:c,maxDate:m,cellRender:p,hoverValue:v,hoverRangeValue:h,onHover:y,locale:s,generateConfig:a,onSelect:P,panelType:t,prevIcon:T,nextIcon:b,superPrevIcon:N,superNextIcon:O};return[j,E]}var kn=o.createContext({});function dr(e){for(var t=e.rowNum,r=e.colNum,a=e.baseDate,s=e.getCellDate,u=e.prefixColumn,c=e.rowClassName,m=e.titleFormat,p=e.getCellText,v=e.getCellClassName,h=e.headerCells,y=e.cellSelection,D=y===void 0?!0:y,I=e.disabledDate,P=Nr(),T=P.prefixCls,b=P.panelType,N=P.now,O=P.disabledDate,E=P.cellRender,j=P.onHover,B=P.hoverValue,z=P.hoverRangeValue,F=P.generateConfig,q=P.values,ee=P.locale,W=P.onSelect,_=I||O,Z="".concat(T,"-cell"),re=o.useContext(kn),$=re.onCellDblClick,k=function(X){return q.some(function(J){return J&&_t(F,ee,X,J,b)})},g=[],C=0;C<t;C+=1){for(var M=[],A=void 0,Y=function(){var X=C*r+U,J=s(a,X),w=_==null?void 0:_(J,{type:b});U===0&&(A=J,u&&M.push(u(A)));var ne=!1,se=!1,V=!1;if(D&&z){var Q=ce(z,2),ie=Q[0],me=Q[1];ne=jr(F,ie,me,J),se=_t(F,ee,J,ie,b),V=_t(F,ee,J,me,b)}var we=m?wt(J,{locale:ee,format:m,generateConfig:F}):void 0,ae=o.createElement("div",{className:"".concat(Z,"-inner")},p(J));M.push(o.createElement("td",{key:U,title:we,className:gt(Z,_e(tt(tt(tt(tt(tt(tt({},"".concat(Z,"-disabled"),w),"".concat(Z,"-hover"),(B||[]).some(function(Me){return _t(F,ee,J,Me,b)})),"".concat(Z,"-in-range"),ne&&!se&&!V),"".concat(Z,"-range-start"),se),"".concat(Z,"-range-end"),V),"".concat(T,"-cell-selected"),!z&&b!=="week"&&k(J)),v(J))),onClick:function(){w||W(J)},onDoubleClick:function(){!w&&$&&$()},onMouseEnter:function(){w||j==null||j(J)},onMouseLeave:function(){w||j==null||j(null)}},E?E(J,{prefixCls:T,originNode:ae,today:N,type:b,locale:ee}):ae))},U=0;U<r;U+=1)Y();g.push(o.createElement("tr",{key:C,className:c==null?void 0:c(A)},M))}return o.createElement("div",{className:"".concat(T,"-body")},o.createElement("table",{className:"".concat(T,"-content")},h&&o.createElement("thead",null,o.createElement("tr",null,h)),o.createElement("tbody",null,g)))}var gr={visibility:"hidden"};function Gn(e){var t=e.offset,r=e.superOffset,a=e.onChange,s=e.getStart,u=e.getEnd,c=e.children,m=Nr(),p=m.prefixCls,v=m.prevIcon,h=v===void 0?"‹":v,y=m.nextIcon,D=y===void 0?"›":y,I=m.superPrevIcon,P=I===void 0?"«":I,T=m.superNextIcon,b=T===void 0?"»":T,N=m.minDate,O=m.maxDate,E=m.generateConfig,j=m.locale,B=m.pickerValue,z=m.panelType,F="".concat(p,"-header"),q=o.useContext(kn),ee=q.hidePrev,W=q.hideNext,_=q.hideHeader,Z=o.useMemo(function(){if(!N||!t||!u)return!1;var L=u(t(-1,B));return!mr(E,j,L,N,z)},[N,t,B,u,E,j,z]),re=o.useMemo(function(){if(!N||!r||!u)return!1;var L=u(r(-1,B));return!mr(E,j,L,N,z)},[N,r,B,u,E,j,z]),$=o.useMemo(function(){if(!O||!t||!s)return!1;var L=s(t(1,B));return!mr(E,j,O,L,z)},[O,t,B,s,E,j,z]),k=o.useMemo(function(){if(!O||!r||!s)return!1;var L=s(r(1,B));return!mr(E,j,O,L,z)},[O,r,B,s,E,j,z]),g=function(X){t&&a(t(X,B))},C=function(X){r&&a(r(X,B))};if(_)return null;var M="".concat(F,"-prev-btn"),A="".concat(F,"-next-btn"),Y="".concat(F,"-super-prev-btn"),U="".concat(F,"-super-next-btn");return o.createElement("div",{className:F},r&&o.createElement("button",{type:"button","aria-label":j.previousYear,onClick:function(){return C(-1)},tabIndex:-1,className:gt(Y,re&&"".concat(Y,"-disabled")),disabled:re,style:ee?gr:{}},P),t&&o.createElement("button",{type:"button","aria-label":j.previousMonth,onClick:function(){return g(-1)},tabIndex:-1,className:gt(M,Z&&"".concat(M,"-disabled")),disabled:Z,style:ee?gr:{}},h),o.createElement("div",{className:"".concat(F,"-view")},c),t&&o.createElement("button",{type:"button","aria-label":j.nextMonth,onClick:function(){return g(1)},tabIndex:-1,className:gt(A,$&&"".concat(A,"-disabled")),disabled:$,style:W?gr:{}},D),r&&o.createElement("button",{type:"button","aria-label":j.nextYear,onClick:function(){return C(1)},tabIndex:-1,className:gt(U,k&&"".concat(U,"-disabled")),disabled:k,style:W?gr:{}},b))}function Ir(e){var t=e.prefixCls,r=e.panelName,a=r===void 0?"date":r,s=e.locale,u=e.generateConfig,c=e.pickerValue,m=e.onPickerValueChange,p=e.onModeChange,v=e.mode,h=v===void 0?"date":v,y=e.disabledDate,D=e.onSelect,I=e.onHover,P=e.showWeek,T="".concat(t,"-").concat(a,"-panel"),b="".concat(t,"-cell"),N=h==="week",O=Zn(e,h),E=ce(O,2),j=E[0],B=E[1],z=u.locale.getWeekFirstDay(s.locale),F=u.setDate(c,1),q=Ao(s.locale,u,F),ee=u.getMonth(c),W=P===void 0?N:P,_=W?function(L){var X=y==null?void 0:y(L,{type:"week"});return o.createElement("td",{key:"week",className:gt(b,"".concat(b,"-week"),tt({},"".concat(b,"-disabled"),X)),onClick:function(){X||D(L)},onMouseEnter:function(){X||I==null||I(L)},onMouseLeave:function(){X||I==null||I(null)}},o.createElement("div",{className:"".concat(b,"-inner")},u.locale.getWeek(s.locale,L)))}:null,Z=[],re=s.shortWeekDays||(u.locale.getShortWeekDays?u.locale.getShortWeekDays(s.locale):[]);_&&Z.push(o.createElement("th",{key:"empty"},o.createElement("span",{style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0}},s.week)));for(var $=0;$<Fr;$+=1)Z.push(o.createElement("th",{key:$},re[($+z)%Fr]));var k=function(X,J){return u.addDate(X,J)},g=function(X){return wt(X,{locale:s,format:s.cellDateFormat,generateConfig:u})},C=function(X){var J=tt(tt({},"".concat(t,"-cell-in-view"),da(u,X,c)),"".concat(t,"-cell-today"),ma(u,X,B));return J},M=s.shortMonths||(u.locale.getShortMonths?u.locale.getShortMonths(s.locale):[]),A=o.createElement("button",{type:"button","aria-label":s.yearSelect,key:"year",onClick:function(){p("year",c)},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(c,{locale:s,format:s.yearFormat,generateConfig:u})),Y=o.createElement("button",{type:"button","aria-label":s.monthSelect,key:"month",onClick:function(){p("month",c)},tabIndex:-1,className:"".concat(t,"-month-btn")},s.monthFormat?wt(c,{locale:s,format:s.monthFormat,generateConfig:u}):M[ee]),U=s.monthBeforeYear?[Y,A]:[A,Y];return o.createElement(Ln.Provider,{value:j},o.createElement("div",{className:gt(T,P&&"".concat(T,"-show-week"))},o.createElement(Gn,{offset:function(X){return u.addMonth(c,X)},superOffset:function(X){return u.addYear(c,X)},onChange:m,getStart:function(X){return u.setDate(X,1)},getEnd:function(X){var J=u.setDate(X,1);return J=u.addMonth(J,1),u.addDate(J,-1)}},U),o.createElement(dr,ot({titleFormat:s.fieldDateFormat},e,{colNum:Fr,rowNum:6,baseDate:q,headerCells:Z,getCellDate:k,getCellText:g,getCellClassName:C,prefixColumn:_,cellSelection:!N}))))}var Vo=1/3;function Zo(e,t){var r=o.useRef(!1),a=o.useRef(null),s=o.useRef(null),u=function(){return r.current},c=function(){hn.cancel(a.current),r.current=!1},m=o.useRef(),p=function(){var y=e.current;if(s.current=null,m.current=0,y){var D=y.querySelector('[data-value="'.concat(t,'"]')),I=y.querySelector("li"),P=function T(){c(),r.current=!0,m.current+=1;var b=y.scrollTop,N=I.offsetTop,O=D.offsetTop,E=O-N;if(O===0&&D!==I||!Ss(y)){m.current<=5&&(a.current=hn(T));return}var j=b+(E-b)*Vo,B=Math.abs(E-j);if(s.current!==null&&s.current<B){c();return}if(s.current=B,B<=1){y.scrollTop=E,c();return}y.scrollTop=j,a.current=hn(T)};D&&I&&P()}},v=Ot(p);return[v,c,u]}var Go=300;function Xo(e){return e.map(function(t){var r=t.value,a=t.label,s=t.disabled;return[r,a,s].join(",")}).join(";")}function Jn(e){var t=e.units,r=e.value,a=e.optionalValue,s=e.type,u=e.onChange,c=e.onHover,m=e.onDblClick,p=e.changeOnScroll,v=Nr(),h=v.prefixCls,y=v.cellRender,D=v.now,I=v.locale,P="".concat(h,"-time-panel"),T="".concat(h,"-time-panel-cell"),b=o.useRef(null),N=o.useRef(),O=function(){clearTimeout(N.current)},E=Zo(b,r??a),j=ce(E,3),B=j[0],z=j[1],F=j[2];Pn(function(){return B(),O(),function(){z(),O()}},[r,a,Xo(t)]);var q=function(_){O();var Z=_.target;!F()&&p&&(N.current=setTimeout(function(){var re=b.current,$=re.querySelector("li").offsetTop,k=Array.from(re.querySelectorAll("li")),g=k.map(function(U){return U.offsetTop-$}),C=g.map(function(U,L){return t[L].disabled?Number.MAX_SAFE_INTEGER:Math.abs(U-Z.scrollTop)}),M=Math.min.apply(Math,Ht(C)),A=C.findIndex(function(U){return U===M}),Y=t[A];Y&&!Y.disabled&&u(Y.value)},Go))},ee="".concat(P,"-column");return o.createElement("ul",{className:ee,ref:b,"data-type":s,onScroll:q},t.map(function(W){var _=W.label,Z=W.value,re=W.disabled,$=o.createElement("div",{className:"".concat(T,"-inner")},_);return o.createElement("li",{key:Z,className:gt(T,tt(tt({},"".concat(T,"-selected"),r===Z),"".concat(T,"-disabled"),re)),onClick:function(){re||u(Z)},onDoubleClick:function(){!re&&m&&m()},onMouseEnter:function(){c(Z)},onMouseLeave:function(){c(null)},"data-value":Z},y?y(Z,{prefixCls:h,originNode:$,today:D,type:"time",subType:s,locale:I}):$)}))}function Sn(e){return e<12}function Qo(e){var t=e.showHour,r=e.showMinute,a=e.showSecond,s=e.showMillisecond,u=e.use12Hours,c=e.changeOnScroll,m=Nr(),p=m.prefixCls,v=m.values,h=m.generateConfig,y=m.locale,D=m.onSelect,I=m.onHover,P=I===void 0?function(){}:I,T=m.pickerValue,b=(v==null?void 0:v[0])||null,N=o.useContext(kn),O=N.onCellDblClick,E=ha(h,e,b),j=ce(E,5),B=j[0],z=j[1],F=j[2],q=j[3],ee=j[4],W=function(fe){var Ge=b&&h[fe](b),it=T&&h[fe](T);return[Ge,it]},_=W("getHour"),Z=ce(_,2),re=Z[0],$=Z[1],k=W("getMinute"),g=ce(k,2),C=g[0],M=g[1],A=W("getSecond"),Y=ce(A,2),U=Y[0],L=Y[1],X=W("getMillisecond"),J=ce(X,2),w=J[0],ne=J[1],se=re===null?null:Sn(re)?"am":"pm",V=o.useMemo(function(){return u?Sn(re)?z.filter(function(d){return Sn(d.value)}):z.filter(function(d){return!Sn(d.value)}):z},[re,z,u]),Q=function(fe,Ge){var it,Be=fe.filter(function(Rt){return!Rt.disabled});return Ge??(Be==null||(it=Be[0])===null||it===void 0?void 0:it.value)},ie=Q(z,re),me=o.useMemo(function(){return F(ie)},[F,ie]),we=Q(me,C),ae=o.useMemo(function(){return q(ie,we)},[q,ie,we]),Me=Q(ae,U),Ee=o.useMemo(function(){return ee(ie,we,Me)},[ee,ie,we,Me]),ge=Q(Ee,w),ke=o.useMemo(function(){if(!u)return[];var d=h.getNow(),fe=h.setHour(d,6),Ge=h.setHour(d,18),it=function(Rt,Xe){var ht=y.cellMeridiemFormat;return ht?wt(Rt,{generateConfig:h,locale:y,format:ht}):Xe};return[{label:it(fe,"AM"),value:"am",disabled:z.every(function(Be){return Be.disabled||!Sn(Be.value)})},{label:it(Ge,"PM"),value:"pm",disabled:z.every(function(Be){return Be.disabled||Sn(Be.value)})}]},[z,u,h,y]),ve=function(fe){var Ge=B(fe);D(Ge)},Ne=o.useMemo(function(){var d=b||T||h.getNow(),fe=function(it){return it!=null};return fe(re)?(d=h.setHour(d,re),d=h.setMinute(d,C),d=h.setSecond(d,U),d=h.setMillisecond(d,w)):fe($)?(d=h.setHour(d,$),d=h.setMinute(d,M),d=h.setSecond(d,L),d=h.setMillisecond(d,ne)):fe(ie)&&(d=h.setHour(d,ie),d=h.setMinute(d,we),d=h.setSecond(d,Me),d=h.setMillisecond(d,ge)),d},[b,T,re,C,U,w,ie,we,Me,ge,$,M,L,ne,h]),Te=function(fe,Ge){return fe===null?null:h[Ge](Ne,fe)},oe=function(fe){return Te(fe,"setHour")},Ae=function(fe){return Te(fe,"setMinute")},Oe=function(fe){return Te(fe,"setSecond")},Ze=function(fe){return Te(fe,"setMillisecond")},$e=function(fe){return fe===null?null:fe==="am"&&!Sn(re)?h.setHour(Ne,re-12):fe==="pm"&&Sn(re)?h.setHour(Ne,re+12):Ne},Le=function(fe){ve(oe(fe))},ct=function(fe){ve(Ae(fe))},lt=function(fe){ve(Oe(fe))},G=function(fe){ve(Ze(fe))},qe=function(fe){ve($e(fe))},Je=function(fe){P(oe(fe))},xe=function(fe){P(Ae(fe))},Ve=function(fe){P(Oe(fe))},H=function(fe){P(Ze(fe))},pe=function(fe){P($e(fe))},Ie={onDblClick:O,changeOnScroll:c};return o.createElement("div",{className:"".concat(p,"-content")},t&&o.createElement(Jn,ot({units:V,value:re,optionalValue:$,type:"hour",onChange:Le,onHover:Je},Ie)),r&&o.createElement(Jn,ot({units:me,value:C,optionalValue:M,type:"minute",onChange:ct,onHover:xe},Ie)),a&&o.createElement(Jn,ot({units:ae,value:U,optionalValue:L,type:"second",onChange:lt,onHover:Ve},Ie)),s&&o.createElement(Jn,ot({units:Ee,value:w,optionalValue:ne,type:"millisecond",onChange:G,onHover:H},Ie)),u&&o.createElement(Jn,ot({units:ke,value:se,type:"meridiem",onChange:qe,onHover:pe},Ie)))}function Qi(e){var t=e.prefixCls,r=e.value,a=e.locale,s=e.generateConfig,u=e.showTime,c=u||{},m=c.format,p="".concat(t,"-time-panel"),v=Zn(e,"time"),h=ce(v,1),y=h[0];return o.createElement(Ln.Provider,{value:y},o.createElement("div",{className:gt(p)},o.createElement(Gn,null,r?wt(r,{locale:a,format:m,generateConfig:s}):" "),o.createElement(Qo,u)))}function Jo(e){var t=e.prefixCls,r=e.generateConfig,a=e.showTime,s=e.onSelect,u=e.value,c=e.pickerValue,m=e.onHover,p="".concat(t,"-datetime-panel"),v=ha(r,a),h=ce(v,1),y=h[0],D=function(b){return u?Mr(r,b,u):Mr(r,b,c)},I=function(b){m==null||m(b&&D(b))},P=function(b){var N=D(b);s(y(N,N))};return o.createElement("div",{className:p},o.createElement(Ir,ot({},e,{onSelect:P,onHover:I})),o.createElement(Qi,e))}function el(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,s=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,m="".concat(t,"-decade-panel"),p=Zn(e,"decade"),v=ce(p,1),h=v[0],y=function(z){var F=Math.floor(a.getYear(z)/100)*100;return a.setYear(z,F)},D=function(z){var F=y(z);return a.addYear(F,99)},I=y(s),P=D(s),T=a.addYear(I,-10),b=function(z,F){return a.addYear(z,F*10)},N=function(z){var F=r.cellYearFormat,q=wt(z,{locale:r,format:F,generateConfig:a}),ee=wt(a.addYear(z,9),{locale:r,format:F,generateConfig:a});return"".concat(q,"-").concat(ee)},O=function(z){return tt({},"".concat(t,"-cell-in-view"),ta(a,z,I)||ta(a,z,P)||jr(a,I,P,z))},E=u?function(B,z){var F=a.setDate(B,1),q=a.setMonth(F,0),ee=a.setYear(q,Math.floor(a.getYear(q)/10)*10),W=a.addYear(ee,10),_=a.addDate(W,-1);return u(ee,z)&&u(_,z)}:null,j="".concat(wt(I,{locale:r,format:r.yearFormat,generateConfig:a}),"-").concat(wt(P,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(Ln.Provider,{value:h},o.createElement("div",{className:m},o.createElement(Gn,{superOffset:function(z){return a.addYear(s,z*100)},onChange:c,getStart:y,getEnd:D},j),o.createElement(dr,ot({},e,{disabledDate:E,colNum:3,rowNum:4,baseDate:T,getCellDate:b,getCellText:N,getCellClassName:O}))))}function tl(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,s=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,m=e.onModeChange,p="".concat(t,"-month-panel"),v=Zn(e,"month"),h=ce(v,1),y=h[0],D=a.setMonth(s,0),I=r.shortMonths||(a.locale.getShortMonths?a.locale.getShortMonths(r.locale):[]),P=function(j,B){return a.addMonth(j,B)},T=function(j){var B=a.getMonth(j);return r.monthFormat?wt(j,{locale:r,format:r.monthFormat,generateConfig:a}):I[B]},b=function(){return tt({},"".concat(t,"-cell-in-view"),!0)},N=u?function(E,j){var B=a.setDate(E,1),z=a.setMonth(B,a.getMonth(B)+1),F=a.addDate(z,-1);return u(B,j)&&u(F,j)}:null,O=o.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){m("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(s,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(Ln.Provider,{value:y},o.createElement("div",{className:p},o.createElement(Gn,{superOffset:function(j){return a.addYear(s,j)},onChange:c,getStart:function(j){return a.setMonth(j,0)},getEnd:function(j){return a.setMonth(j,11)}},O),o.createElement(dr,ot({},e,{disabledDate:N,titleFormat:r.fieldMonthFormat,colNum:3,rowNum:4,baseDate:D,getCellDate:P,getCellText:T,getCellClassName:b}))))}function nl(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,s=e.pickerValue,u=e.onPickerValueChange,c=e.onModeChange,m="".concat(t,"-quarter-panel"),p=Zn(e,"quarter"),v=ce(p,1),h=v[0],y=a.setMonth(s,0),D=function(N,O){return a.addMonth(N,O*3)},I=function(N){return wt(N,{locale:r,format:r.cellQuarterFormat,generateConfig:a})},P=function(){return tt({},"".concat(t,"-cell-in-view"),!0)},T=o.createElement("button",{type:"button",key:"year","aria-label":r.yearSelect,onClick:function(){c("year")},tabIndex:-1,className:"".concat(t,"-year-btn")},wt(s,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(Ln.Provider,{value:h},o.createElement("div",{className:m},o.createElement(Gn,{superOffset:function(N){return a.addYear(s,N)},onChange:u,getStart:function(N){return a.setMonth(N,0)},getEnd:function(N){return a.setMonth(N,11)}},T),o.createElement(dr,ot({},e,{titleFormat:r.fieldQuarterFormat,colNum:4,rowNum:1,baseDate:y,getCellDate:D,getCellText:I,getCellClassName:P}))))}function rl(e){var t=e.prefixCls,r=e.generateConfig,a=e.locale,s=e.value,u=e.hoverValue,c=e.hoverRangeValue,m=a.locale,p="".concat(t,"-week-panel-row"),v=function(y){var D={};if(c){var I=ce(c,2),P=I[0],T=I[1],b=nr(r,m,P,y),N=nr(r,m,T,y);D["".concat(p,"-range-start")]=b,D["".concat(p,"-range-end")]=N,D["".concat(p,"-range-hover")]=!b&&!N&&jr(r,P,T,y)}return u&&(D["".concat(p,"-hover")]=u.some(function(O){return nr(r,m,y,O)})),gt(p,tt({},"".concat(p,"-selected"),!c&&nr(r,m,s,y)),D)};return o.createElement(Ir,ot({},e,{mode:"week",panelName:"week",rowClassName:v}))}function al(e){var t=e.prefixCls,r=e.locale,a=e.generateConfig,s=e.pickerValue,u=e.disabledDate,c=e.onPickerValueChange,m=e.onModeChange,p="".concat(t,"-year-panel"),v=Zn(e,"year"),h=ce(v,1),y=h[0],D=function(F){var q=Math.floor(a.getYear(F)/10)*10;return a.setYear(F,q)},I=function(F){var q=D(F);return a.addYear(q,9)},P=D(s),T=I(s),b=a.addYear(P,-1),N=function(F,q){return a.addYear(F,q)},O=function(F){return wt(F,{locale:r,format:r.cellYearFormat,generateConfig:a})},E=function(F){return tt({},"".concat(t,"-cell-in-view"),$n(a,F,P)||$n(a,F,T)||jr(a,P,T,F))},j=u?function(z,F){var q=a.setMonth(z,0),ee=a.setDate(q,1),W=a.addYear(ee,1),_=a.addDate(W,-1);return u(ee,F)&&u(_,F)}:null,B=o.createElement("button",{type:"button",key:"decade","aria-label":r.decadeSelect,onClick:function(){m("decade")},tabIndex:-1,className:"".concat(t,"-decade-btn")},wt(P,{locale:r,format:r.yearFormat,generateConfig:a}),"-",wt(T,{locale:r,format:r.yearFormat,generateConfig:a}));return o.createElement(Ln.Provider,{value:y},o.createElement("div",{className:p},o.createElement(Gn,{superOffset:function(F){return a.addYear(s,F*10)},onChange:c,getStart:D,getEnd:I},B),o.createElement(dr,ot({},e,{disabledDate:j,titleFormat:r.fieldYearFormat,colNum:3,rowNum:4,baseDate:b,getCellDate:N,getCellText:O,getCellClassName:E}))))}var il={date:Ir,datetime:Jo,week:rl,month:tl,quarter:nl,year:al,decade:el,time:Qi};function sl(e,t){var r,a=e.locale,s=e.generateConfig,u=e.direction,c=e.prefixCls,m=e.tabIndex,p=m===void 0?0:m,v=e.multiple,h=e.defaultValue,y=e.value,D=e.onChange,I=e.onSelect,P=e.defaultPickerValue,T=e.pickerValue,b=e.onPickerValueChange,N=e.mode,O=e.onPanelChange,E=e.picker,j=E===void 0?"date":E,B=e.showTime,z=e.hoverValue,F=e.hoverRangeValue,q=e.cellRender,ee=e.dateRender,W=e.monthCellRender,_=e.components,Z=_===void 0?{}:_,re=e.hideHeader,$=((r=o.useContext(nn))===null||r===void 0?void 0:r.prefixCls)||c||"rc-picker",k=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:k.current}});var g=Oi(e),C=ce(g,4),M=C[0],A=C[1],Y=C[2],U=C[3],L=Ri(a,A),X=j==="date"&&B?"datetime":j,J=o.useMemo(function(){return Fi(X,Y,U,M,L)},[X,Y,U,M,L]),w=s.getNow(),ne=fn(j,{value:N,postState:function(pe){return pe||"date"}}),se=ce(ne,2),V=se[0],Q=se[1],ie=V==="date"&&J?"datetime":V,me=Xi(s,a,X),we=fn(h,{value:y}),ae=ce(we,2),Me=ae[0],Ee=ae[1],ge=o.useMemo(function(){var H=An(Me).filter(function(pe){return pe});return v?H:H.slice(0,1)},[Me,v]),ke=Ot(function(H){Ee(H),D&&(H===null||ge.length!==H.length||ge.some(function(pe,Ie){return!_t(s,a,pe,H[Ie],X)}))&&(D==null||D(v?H:H[0]))}),ve=Ot(function(H){if(I==null||I(H),V===j){var pe=v?me(ge,H):[H];ke(pe)}}),Ne=fn(P||ge[0]||w,{value:T}),Te=ce(Ne,2),oe=Te[0],Ae=Te[1];o.useEffect(function(){ge[0]&&!T&&Ae(ge[0])},[ge[0]]);var Oe=function(pe,Ie){O==null||O(pe||T,Ie||V)},Ze=function(pe){var Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;Ae(pe),b==null||b(pe),Ie&&Oe(pe)},$e=function(pe,Ie){Q(pe),Ie&&Ze(Ie),Oe(Ie,pe)},Le=function(pe){if(ve(pe),Ze(pe),V!==j){var Ie=["decade","year"],d=[].concat(Ie,["month"]),fe={quarter:[].concat(Ie,["quarter"]),week:[].concat(Ht(d),["week"]),date:[].concat(Ht(d),["date"])},Ge=fe[j]||d,it=Ge.indexOf(V),Be=Ge[it+1];Be&&$e(Be,pe)}},ct=o.useMemo(function(){var H,pe;if(Array.isArray(F)){var Ie=ce(F,2);H=Ie[0],pe=Ie[1]}else H=F;return!H&&!pe?null:(H=H||pe,pe=pe||H,s.isAfter(H,pe)?[pe,H]:[H,pe])},[F,s]),lt=ca(q,ee,W),G=Z[ie]||il[ie]||Ir,qe=o.useContext(kn),Je=o.useMemo(function(){return _e(_e({},qe),{},{hideHeader:re})},[qe,re]),xe="".concat($,"-panel"),Ve=wr(e,["showWeek","prevIcon","nextIcon","superPrevIcon","superNextIcon","disabledDate","minDate","maxDate","onHover"]);return o.createElement(kn.Provider,{value:Je},o.createElement("div",{ref:k,tabIndex:p,className:gt(xe,tt({},"".concat(xe,"-rtl"),u==="rtl"))},o.createElement(G,ot({},Ve,{showTime:J,prefixCls:$,locale:L,generateConfig:s,onModeChange:$e,pickerValue:oe,onPickerValueChange:function(pe){Ze(pe,!0)},value:ge[0],onSelect:Le,values:ge,cellRender:lt,hoverRangeValue:ct,hoverValue:z}))))}var Lr=o.memo(o.forwardRef(sl));function ol(e){var t=e.picker,r=e.multiplePanel,a=e.pickerValue,s=e.onPickerValueChange,u=e.needConfirm,c=e.onSubmit,m=e.range,p=e.hoverValue,v=o.useContext(nn),h=v.prefixCls,y=v.generateConfig,D=o.useCallback(function(O,E){return rr(y,t,O,E)},[y,t]),I=o.useMemo(function(){return D(a,1)},[a,D]),P=function(E){s(D(E,-1))},T={onCellDblClick:function(){u&&c()}},b=t==="time",N=_e(_e({},e),{},{hoverValue:null,hoverRangeValue:null,hideHeader:b});return m?N.hoverRangeValue=p:N.hoverValue=p,r?o.createElement("div",{className:"".concat(h,"-panels")},o.createElement(kn.Provider,{value:_e(_e({},T),{},{hideNext:!0})},o.createElement(Lr,N)),o.createElement(kn.Provider,{value:_e(_e({},T),{},{hidePrev:!0})},o.createElement(Lr,ot({},N,{pickerValue:I,onPickerValueChange:P})))):o.createElement(kn.Provider,{value:_e({},T)},o.createElement(Lr,N))}function ka(e){return typeof e=="function"?e():e}function ll(e){var t=e.prefixCls,r=e.presets,a=e.onClick,s=e.onHover;return r.length?o.createElement("div",{className:"".concat(t,"-presets")},o.createElement("ul",null,r.map(function(u,c){var m=u.label,p=u.value;return o.createElement("li",{key:c,onClick:function(){a(ka(p))},onMouseEnter:function(){s(ka(p))},onMouseLeave:function(){s(null)}},m)}))):null}function Ji(e){var t=e.panelRender,r=e.internalMode,a=e.picker,s=e.showNow,u=e.range,c=e.multiple,m=e.activeInfo,p=m===void 0?[0,0,0]:m,v=e.presets,h=e.onPresetHover,y=e.onPresetSubmit,D=e.onFocus,I=e.onBlur,P=e.onPanelMouseDown,T=e.direction,b=e.value,N=e.onSelect,O=e.isInvalid,E=e.defaultOpenValue,j=e.onOk,B=e.onSubmit,z=o.useContext(nn),F=z.prefixCls,q="".concat(F,"-panel"),ee=T==="rtl",W=o.useRef(null),_=o.useRef(null),Z=o.useState(0),re=ce(Z,2),$=re[0],k=re[1],g=o.useState(0),C=ce(g,2),M=C[0],A=C[1],Y=o.useState(0),U=ce(Y,2),L=U[0],X=U[1],J=function(Le){Le.width&&k(Le.width)},w=ce(p,3),ne=w[0],se=w[1],V=w[2],Q=o.useState(0),ie=ce(Q,2),me=ie[0],we=ie[1];o.useEffect(function(){we(10)},[ne]),o.useEffect(function(){if(u&&_.current){var $e,Le=(($e=W.current)===null||$e===void 0?void 0:$e.offsetWidth)||0,ct=_.current.getBoundingClientRect();if(!ct.height||ct.right<0){we(function(Je){return Math.max(0,Je-1)});return}var lt=(ee?se-Le:ne)-ct.left;if(X(lt),$&&$<V){var G=ee?ct.right-(se-Le+$):ne+Le-ct.left-$,qe=Math.max(0,G);A(qe)}else A(0)}},[me,ee,$,ne,se,V,u]);function ae($e){return $e.filter(function(Le){return Le})}var Me=o.useMemo(function(){return ae(An(b))},[b]),Ee=a==="time"&&!Me.length,ge=o.useMemo(function(){return Ee?ae([E]):Me},[Ee,Me,E]),ke=Ee?E:Me,ve=o.useMemo(function(){return ge.length?ge.some(function($e){return O($e)}):!0},[ge,O]),Ne=function(){Ee&&N(E),j(),B()},Te=o.createElement("div",{className:"".concat(F,"-panel-layout")},o.createElement(ll,{prefixCls:F,presets:v,onClick:y,onHover:h}),o.createElement("div",null,o.createElement(ol,ot({},e,{value:ke})),o.createElement(qo,ot({},e,{showNow:c?!1:s,invalid:ve,onSubmit:Ne}))));t&&(Te=t(Te));var oe="".concat(q,"-container"),Ae="marginLeft",Oe="marginRight",Ze=o.createElement("div",{onMouseDown:P,tabIndex:-1,className:gt(oe,"".concat(F,"-").concat(r,"-panel-container")),style:tt(tt({},ee?Oe:Ae,M),ee?Ae:Oe,"auto"),onFocus:D,onBlur:I},Te);return u&&(Ze=o.createElement("div",{onMouseDown:P,ref:_,className:gt("".concat(F,"-range-wrapper"),"".concat(F,"-").concat(a,"-range-wrapper"))},o.createElement("div",{ref:W,className:"".concat(F,"-range-arrow"),style:{left:L}}),o.createElement(Wa,{onResize:J},Ze))),Ze}function es(e,t){var r=e.format,a=e.maskFormat,s=e.generateConfig,u=e.locale,c=e.preserveInvalidOnBlur,m=e.inputReadOnly,p=e.required,v=e["aria-required"],h=e.onSubmit,y=e.onFocus,D=e.onBlur,I=e.onInputChange,P=e.onInvalid,T=e.open,b=e.onOpenChange,N=e.onKeyDown,O=e.onChange,E=e.activeHelp,j=e.name,B=e.autoComplete,z=e.id,F=e.value,q=e.invalid,ee=e.placeholder,W=e.disabled,_=e.activeIndex,Z=e.allHelp,re=e.picker,$=function(L,X){var J=s.locale.parse(u.locale,L,[X]);return J&&s.isValidate(J)?J:null},k=r[0],g=o.useCallback(function(U){return wt(U,{locale:u,format:k,generateConfig:s})},[u,s,k]),C=o.useMemo(function(){return F.map(g)},[F,g]),M=o.useMemo(function(){var U=re==="time"?8:10,L=typeof k=="function"?k(s.getNow()).length:k.length;return Math.max(U,L)+2},[k,re,s]),A=function(L){for(var X=0;X<r.length;X+=1){var J=r[X];if(typeof J=="string"){var w=$(L,J);if(w)return w}}return!1},Y=function(L){function X(ne){return L!==void 0?ne[L]:ne}var J=ia(e,{aria:!0,data:!0}),w=_e(_e({},J),{},{format:a,validateFormat:function(se){return!!A(se)},preserveInvalidOnBlur:c,readOnly:m,required:p,"aria-required":v,name:j,autoComplete:B,size:M,id:X(z),value:X(C)||"",invalid:X(q),placeholder:X(ee),active:_===L,helped:Z||E&&_===L,disabled:X(W),onFocus:function(se){y(se,L)},onBlur:function(se){D(se,L)},onSubmit:h,onChange:function(se){I();var V=A(se);if(V){P(!1,L),O(V,L);return}P(!!se,L)},onHelp:function(){b(!0,{index:L})},onKeyDown:function(se){var V=!1;if(N==null||N(se,function(){V=!0}),!se.defaultPrevented&&!V)switch(se.key){case"Escape":b(!1,{index:L});break;case"Enter":T||b(!0);break}}},t==null?void 0:t({valueTexts:C}));return Object.keys(w).forEach(function(ne){w[ne]===void 0&&delete w[ne]}),w};return[Y,g]}var ul=["onMouseEnter","onMouseLeave"];function ts(e){return o.useMemo(function(){return wr(e,ul)},[e])}var cl=["icon","type"],dl=["onClear"];function Er(e){var t=e.icon,r=e.type,a=Vn(e,cl),s=o.useContext(nn),u=s.prefixCls;return t?o.createElement("span",ot({className:"".concat(u,"-").concat(r)},a),t):null}function na(e){var t=e.onClear,r=Vn(e,dl);return o.createElement(Er,ot({},r,{type:"clear",role:"button",onMouseDown:function(s){s.preventDefault()},onClick:function(s){s.stopPropagation(),t()}}))}var Ur=["YYYY","MM","DD","HH","mm","ss","SSS"],Pa="顧",ml=function(){function e(t){Ds(this,e),tt(this,"format",void 0),tt(this,"maskFormat",void 0),tt(this,"cells",void 0),tt(this,"maskCells",void 0),this.format=t;var r=Ur.map(function(m){return"(".concat(m,")")}).join("|"),a=new RegExp(r,"g");this.maskFormat=t.replace(a,function(m){return Pa.repeat(m.length)});var s=new RegExp("(".concat(Ur.join("|"),")")),u=(t.split(s)||[]).filter(function(m){return m}),c=0;this.cells=u.map(function(m){var p=Ur.includes(m),v=c,h=c+m.length;return c=h,{text:m,mask:p,start:v,end:h}}),this.maskCells=this.cells.filter(function(m){return m.mask})}return xs(e,[{key:"getSelection",value:function(r){var a=this.maskCells[r]||{},s=a.start,u=a.end;return[s||0,u||0]}},{key:"match",value:function(r){for(var a=0;a<this.maskFormat.length;a+=1){var s=this.maskFormat[a],u=r[a];if(!u||s!==Pa&&s!==u)return!1}return!0}},{key:"size",value:function(){return this.maskCells.length}},{key:"getMaskCellIndex",value:function(r){for(var a=Number.MAX_SAFE_INTEGER,s=0,u=0;u<this.maskCells.length;u+=1){var c=this.maskCells[u],m=c.start,p=c.end;if(r>=m&&r<=p)return u;var v=Math.min(Math.abs(r-m),Math.abs(r-p));v<a&&(a=v,s=u)}return s}}]),e}();function fl(e){var t={YYYY:[0,9999,new Date().getFullYear()],MM:[1,12],DD:[1,31],HH:[0,23],mm:[0,59],ss:[0,59],SSS:[0,999]};return t[e]}var hl=["active","showActiveCls","suffixIcon","format","validateFormat","onChange","onInput","helped","onHelp","onSubmit","onKeyDown","preserveInvalidOnBlur","invalid","clearIcon"],ra=o.forwardRef(function(e,t){var r=e.active,a=e.showActiveCls,s=a===void 0?!0:a,u=e.suffixIcon,c=e.format,m=e.validateFormat,p=e.onChange;e.onInput;var v=e.helped,h=e.onHelp,y=e.onSubmit,D=e.onKeyDown,I=e.preserveInvalidOnBlur,P=I===void 0?!1:I,T=e.invalid,b=e.clearIcon,N=Vn(e,hl),O=e.value,E=e.onFocus,j=e.onBlur,B=e.onMouseUp,z=o.useContext(nn),F=z.prefixCls,q=z.input,ee=q===void 0?"input":q,W="".concat(F,"-input"),_=o.useState(!1),Z=ce(_,2),re=Z[0],$=Z[1],k=o.useState(O),g=ce(k,2),C=g[0],M=g[1],A=o.useState(""),Y=ce(A,2),U=Y[0],L=Y[1],X=o.useState(null),J=ce(X,2),w=J[0],ne=J[1],se=o.useState(null),V=ce(se,2),Q=V[0],ie=V[1],me=C||"";o.useEffect(function(){M(O)},[O]);var we=o.useRef(),ae=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:we.current,inputElement:ae.current,focus:function(H){ae.current.focus(H)},blur:function(){ae.current.blur()}}});var Me=o.useMemo(function(){return new ml(c||"")},[c]),Ee=o.useMemo(function(){return v?[0,0]:Me.getSelection(w)},[Me,w,v]),ge=ce(Ee,2),ke=ge[0],ve=ge[1],Ne=function(H){H&&H!==c&&H!==O&&h()},Te=Ot(function(Ve){m(Ve)&&p(Ve),M(Ve),Ne(Ve)}),oe=function(H){if(!c){var pe=H.target.value;Ne(pe),M(pe),p(pe)}},Ae=function(H){var pe=H.clipboardData.getData("text");m(pe)&&Te(pe)},Oe=o.useRef(!1),Ze=function(){Oe.current=!0},$e=function(H){var pe=H.target,Ie=pe.selectionStart,d=Me.getMaskCellIndex(Ie);ne(d),ie({}),B==null||B(H),Oe.current=!1},Le=function(H){$(!0),ne(0),L(""),E(H)},ct=function(H){j(H)},lt=function(H){$(!1),ct(H)};fa(r,function(){!r&&!P&&M(O)});var G=function(H){H.key==="Enter"&&m(me)&&y(),D==null||D(H)},qe=function(H){G(H);var pe=H.key,Ie=null,d=null,fe=ve-ke,Ge=c.slice(ke,ve),it=function(ht){ne(function(mt){var xt=mt+ht;return xt=Math.max(xt,0),xt=Math.min(xt,Me.size()-1),xt})},Be=function(ht){var mt=fl(Ge),xt=ce(mt,3),jt=xt[0],Bt=xt[1],Gt=xt[2],ut=me.slice(ke,ve),Ft=Number(ut);if(isNaN(Ft))return String(Gt||(ht>0?jt:Bt));var qt=Ft+ht,Ue=Bt-jt+1;return String(jt+(Ue+qt-jt)%Ue)};switch(pe){case"Backspace":case"Delete":Ie="",d=Ge;break;case"ArrowLeft":Ie="",it(-1);break;case"ArrowRight":Ie="",it(1);break;case"ArrowUp":Ie="",d=Be(1);break;case"ArrowDown":Ie="",d=Be(-1);break;default:isNaN(Number(pe))||(Ie=U+pe,d=Ie);break}if(Ie!==null&&(L(Ie),Ie.length>=fe&&(it(1),L(""))),d!==null){var Rt=me.slice(0,ke)+ua(d,fe)+me.slice(ve);Te(Rt.slice(0,c.length))}ie({})},Je=o.useRef();Pn(function(){if(!(!re||!c||Oe.current)){if(!Me.match(me)){Te(c);return}return ae.current.setSelectionRange(ke,ve),Je.current=hn(function(){ae.current.setSelectionRange(ke,ve)}),function(){hn.cancel(Je.current)}}},[Me,c,re,me,w,ke,ve,Q,Te]);var xe=c?{onFocus:Le,onBlur:lt,onKeyDown:qe,onMouseDown:Ze,onMouseUp:$e,onPaste:Ae}:{};return o.createElement("div",{ref:we,className:gt(W,tt(tt({},"".concat(W,"-active"),r&&s),"".concat(W,"-placeholder"),v))},o.createElement(ee,ot({ref:ae,"aria-invalid":T,autoComplete:"off"},N,{onKeyDown:G,onBlur:ct},xe,{value:me,onChange:oe})),o.createElement(Er,{type:"suffix",icon:u}),b)}),pl=["id","prefix","clearIcon","suffixIcon","separator","activeIndex","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","value","onChange","onSubmit","onInputChange","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onActiveInfo","placement","onMouseDown","required","aria-required","autoFocus","tabIndex"],gl=["index"];function vl(e,t){var r=e.id,a=e.prefix,s=e.clearIcon,u=e.suffixIcon,c=e.separator,m=c===void 0?"~":c,p=e.activeIndex;e.activeHelp,e.allHelp;var v=e.focused;e.onFocus,e.onBlur,e.onKeyDown,e.locale,e.generateConfig;var h=e.placeholder,y=e.className,D=e.style,I=e.onClick,P=e.onClear,T=e.value;e.onChange,e.onSubmit,e.onInputChange,e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var b=e.disabled,N=e.invalid;e.inputReadOnly;var O=e.direction;e.onOpenChange;var E=e.onActiveInfo;e.placement;var j=e.onMouseDown;e.required,e["aria-required"];var B=e.autoFocus,z=e.tabIndex,F=Vn(e,pl),q=O==="rtl",ee=o.useContext(nn),W=ee.prefixCls,_=o.useMemo(function(){if(typeof r=="string")return[r];var Q=r||{};return[Q.start,Q.end]},[r]),Z=o.useRef(),re=o.useRef(),$=o.useRef(),k=function(ie){var me;return(me=[re,$][ie])===null||me===void 0?void 0:me.current};o.useImperativeHandle(t,function(){return{nativeElement:Z.current,focus:function(ie){if(cr(ie)==="object"){var me,we=ie||{},ae=we.index,Me=ae===void 0?0:ae,Ee=Vn(we,gl);(me=k(Me))===null||me===void 0||me.focus(Ee)}else{var ge;(ge=k(ie??0))===null||ge===void 0||ge.focus()}},blur:function(){var ie,me;(ie=k(0))===null||ie===void 0||ie.blur(),(me=k(1))===null||me===void 0||me.blur()}}});var g=ts(F),C=o.useMemo(function(){return Array.isArray(h)?h:[h,h]},[h]),M=es(_e(_e({},e),{},{id:_,placeholder:C})),A=ce(M,1),Y=A[0],U=o.useState({position:"absolute",width:0}),L=ce(U,2),X=L[0],J=L[1],w=Ot(function(){var Q=k(p);if(Q){var ie=Q.nativeElement.getBoundingClientRect(),me=Z.current.getBoundingClientRect(),we=ie.left-me.left;J(function(ae){return _e(_e({},ae),{},{width:ie.width,left:we})}),E([ie.left,ie.right,me.width])}});o.useEffect(function(){w()},[p]);var ne=s&&(T[0]&&!b[0]||T[1]&&!b[1]),se=B&&!b[0],V=B&&!se&&!b[1];return o.createElement(Wa,{onResize:w},o.createElement("div",ot({},g,{className:gt(W,"".concat(W,"-range"),tt(tt(tt(tt({},"".concat(W,"-focused"),v),"".concat(W,"-disabled"),b.every(function(Q){return Q})),"".concat(W,"-invalid"),N.some(function(Q){return Q})),"".concat(W,"-rtl"),q),y),style:D,ref:Z,onClick:I,onMouseDown:function(ie){var me=ie.target;me!==re.current.inputElement&&me!==$.current.inputElement&&ie.preventDefault(),j==null||j(ie)}}),a&&o.createElement("div",{className:"".concat(W,"-prefix")},a),o.createElement(ra,ot({ref:re},Y(0),{autoFocus:se,tabIndex:z,"date-range":"start"})),o.createElement("div",{className:"".concat(W,"-range-separator")},m),o.createElement(ra,ot({ref:$},Y(1),{autoFocus:V,tabIndex:z,"date-range":"end"})),o.createElement("div",{className:"".concat(W,"-active-bar"),style:X}),o.createElement(Er,{type:"suffix",icon:u}),ne&&o.createElement(na,{icon:s,onClear:P})))}var yl=o.forwardRef(vl);function wa(e,t){var r=e??t;return Array.isArray(r)?r:[r,r]}function vr(e){return e===1?"end":"start"}function bl(e,t){var r=Ui(e,function(){var st=e.disabled,We=e.allowEmpty,et=wa(st,!1),St=wa(We,!1);return{disabled:et,allowEmpty:St}}),a=ce(r,6),s=a[0],u=a[1],c=a[2],m=a[3],p=a[4],v=a[5],h=s.prefixCls,y=s.styles,D=s.classNames,I=s.defaultValue,P=s.value,T=s.needConfirm,b=s.onKeyDown,N=s.disabled,O=s.allowEmpty,E=s.disabledDate,j=s.minDate,B=s.maxDate,z=s.defaultOpen,F=s.open,q=s.onOpenChange,ee=s.locale,W=s.generateConfig,_=s.picker,Z=s.showNow,re=s.showToday,$=s.showTime,k=s.mode,g=s.onPanelChange,C=s.onCalendarChange,M=s.onOk,A=s.defaultPickerValue,Y=s.pickerValue,U=s.onPickerValueChange,L=s.inputReadOnly,X=s.suffixIcon,J=s.onFocus,w=s.onBlur,ne=s.presets,se=s.ranges,V=s.components,Q=s.cellRender,ie=s.dateRender,me=s.monthCellRender,we=s.onClick,ae=Hi(t),Me=_i(F,z,N,q),Ee=ce(Me,2),ge=Ee[0],ke=Ee[1],ve=function(We,et){(N.some(function(St){return!St})||!We)&&ke(We,et)},Ne=Vi(W,ee,m,!0,!1,I,P,C,M),Te=ce(Ne,5),oe=Te[0],Ae=Te[1],Oe=Te[2],Ze=Te[3],$e=Te[4],Le=Oe(),ct=zi(N,O,ge),lt=ce(ct,9),G=lt[0],qe=lt[1],Je=lt[2],xe=lt[3],Ve=lt[4],H=lt[5],pe=lt[6],Ie=lt[7],d=lt[8],fe=function(We,et){qe(!0),J==null||J(We,{range:vr(et??xe)})},Ge=function(We,et){qe(!1),w==null||w(We,{range:vr(et??xe)})},it=o.useMemo(function(){if(!$)return null;var st=$.disabledTime,We=st?function(et){var St=vr(xe),Tt=ji(Le,pe,xe);return st(et,St,{from:Tt})}:void 0;return _e(_e({},$),{},{disabledTime:We})},[$,xe,Le,pe]),Be=fn([_,_],{value:k}),Rt=ce(Be,2),Xe=Rt[0],ht=Rt[1],mt=Xe[xe]||_,xt=mt==="date"&&it?"datetime":mt,jt=xt===_&&xt!=="time",Bt=Gi(_,mt,Z,re,!0),Gt=Zi(s,oe,Ae,Oe,Ze,N,m,G,ge,v),ut=ce(Gt,2),Ft=ut[0],qt=ut[1],Ue=zo(Le,N,pe,W,ee,E),Vt=Ii(Le,v,O),pn=ce(Vt,2),sn=pn[0],gn=pn[1],on=Yi(W,ee,Le,Xe,ge,xe,u,jt,A,Y,it==null?void 0:it.defaultOpenValue,U,j,B),vn=ce(on,2),yn=vn[0],zt=vn[1],At=Ot(function(st,We,et){var St=sr(Xe,xe,We);if((St[0]!==Xe[0]||St[1]!==Xe[1])&&ht(St),g&&et!==!1){var Tt=Ht(Le);st&&(Tt[xe]=st),g(Tt,St)}}),ln=function(We,et){return sr(Le,et,We)},Lt=function(We,et){var St=Le;We&&(St=ln(We,xe)),Ie(xe);var Tt=H(St);Ze(St),Ft(xe,Tt===null),Tt===null?ve(!1,{force:!0}):et||ae.current.focus({index:Tt})},bn=function(We){var et,St=We.target.getRootNode();if(!ae.current.nativeElement.contains((et=St.activeElement)!==null&&et!==void 0?et:document.activeElement)){var Tt=N.findIndex(function(gs){return!gs});Tt>=0&&ae.current.focus({index:Tt})}ve(!0),we==null||we(We)},un=function(){qt(null),ve(!1,{force:!0})},l=o.useState(null),i=ce(l,2),f=i[0],x=i[1],S=o.useState(null),K=ce(S,2),te=K[0],be=K[1],R=o.useMemo(function(){return te||Le},[Le,te]);o.useEffect(function(){ge||be(null)},[ge]);var de=o.useState([0,0,0]),le=ce(de,2),ye=le[0],Pe=le[1],he=Bi(ne,se),ue=function(We){be(We),x("preset")},Se=function(We){var et=qt(We);et&&ve(!1,{force:!0})},Re=function(We){Lt(We)},ze=function(We){be(We?ln(We,xe):null),x("cell")},De=function(We){ve(!0),fe(We)},He=function(){Je("panel")},dt=function(We){var et=sr(Le,xe,We);Ze(et),!T&&!c&&u===xt&&Lt(We)},vt=function(){ve(!1)},Dt=ca(Q,ie,me,vr(xe)),rn=Le[xe]||null,Jt=Ot(function(st){return v(st,{activeIndex:xe})}),Ye=o.useMemo(function(){var st=ia(s,!1),We=Ka(s,[].concat(Ht(Object.keys(st)),["onChange","onCalendarChange","style","className","onPanelChange","disabledTime"]));return We},[s]),Fe=o.createElement(Ji,ot({},Ye,{showNow:Bt,showTime:it,range:!0,multiplePanel:jt,activeInfo:ye,disabledDate:Ue,onFocus:De,onBlur:Ge,onPanelMouseDown:He,picker:_,mode:mt,internalMode:xt,onPanelChange:At,format:p,value:rn,isInvalid:Jt,onChange:null,onSelect:dt,pickerValue:yn,defaultOpenValue:An($==null?void 0:$.defaultOpenValue)[xe],onPickerValueChange:zt,hoverValue:R,onHover:ze,needConfirm:T,onSubmit:Lt,onOk:$e,presets:he,onPresetHover:ue,onPresetSubmit:Se,onNow:Re,cellRender:Dt})),nt=function(We,et){var St=ln(We,et);Ze(St)},Ut=function(){Je("input")},cn=function(We,et){var St=pe.length,Tt=pe[St-1];if(St&&Tt!==et&&T&&!O[Tt]&&!d(Tt)&&Le[Tt]){ae.current.focus({index:Tt});return}Je("input"),ve(!0,{inherit:!0}),xe!==et&&ge&&!T&&c&&Lt(null,!0),Ve(et),fe(We,et)},fs=function(We,et){if(ve(!1),!T&&Je()==="input"){var St=H(Le);Ft(xe,St===null)}Ge(We,et)},hs=function(We,et){We.key==="Tab"&&Lt(null,!0),b==null||b(We,et)},ps=o.useMemo(function(){return{prefixCls:h,locale:ee,generateConfig:W,button:V.button,input:V.input}},[h,ee,W,V.button,V.input]);return Pn(function(){ge&&xe!==void 0&&At(null,_,!1)},[ge,xe,_]),Pn(function(){var st=Je();!ge&&st==="input"&&(ve(!1),Lt(null,!0)),!ge&&c&&!T&&st==="panel"&&(ve(!0),Lt())},[ge]),o.createElement(nn.Provider,{value:ps},o.createElement(Pi,ot({},Ni(s),{popupElement:Fe,popupStyle:y.popup,popupClassName:D.popup,visible:ge,onClose:vt,range:!0}),o.createElement(yl,ot({},s,{ref:ae,suffixIcon:X,activeIndex:G||ge?xe:null,activeHelp:!!te,allHelp:!!te&&f==="preset",focused:G,onFocus:cn,onBlur:fs,onKeyDown:hs,onSubmit:Lt,value:R,maskFormat:p,onChange:nt,onInputChange:Ut,format:m,inputReadOnly:L,disabled:N,open:ge,onOpenChange:ve,onClick:bn,onClear:un,invalid:sn,onInvalid:gn,onActiveInfo:Pe}))))}var Sl=o.forwardRef(bl);function xl(e){var t=e.prefixCls,r=e.value,a=e.onRemove,s=e.removeIcon,u=s===void 0?"×":s,c=e.formatDate,m=e.disabled,p=e.maxTagCount,v=e.placeholder,h="".concat(t,"-selector"),y="".concat(t,"-selection"),D="".concat(y,"-overflow");function I(b,N){return o.createElement("span",{className:gt("".concat(y,"-item")),title:typeof b=="string"?b:null},o.createElement("span",{className:"".concat(y,"-item-content")},b),!m&&N&&o.createElement("span",{onMouseDown:function(E){E.preventDefault()},onClick:N,className:"".concat(y,"-item-remove")},u))}function P(b){var N=c(b),O=function(j){j&&j.stopPropagation(),a(b)};return I(N,O)}function T(b){var N="+ ".concat(b.length," ...");return I(N)}return o.createElement("div",{className:h},o.createElement(Cs,{prefixCls:D,data:r,renderItem:P,renderRest:T,itemKey:function(N){return c(N)},maxCount:p}),!r.length&&o.createElement("span",{className:"".concat(t,"-selection-placeholder")},v))}var Dl=["id","open","prefix","clearIcon","suffixIcon","activeHelp","allHelp","focused","onFocus","onBlur","onKeyDown","locale","generateConfig","placeholder","className","style","onClick","onClear","internalPicker","value","onChange","onSubmit","onInputChange","multiple","maxTagCount","format","maskFormat","preserveInvalidOnBlur","onInvalid","disabled","invalid","inputReadOnly","direction","onOpenChange","onMouseDown","required","aria-required","autoFocus","tabIndex","removeIcon"];function Cl(e,t){e.id;var r=e.open,a=e.prefix,s=e.clearIcon,u=e.suffixIcon;e.activeHelp,e.allHelp;var c=e.focused;e.onFocus,e.onBlur,e.onKeyDown;var m=e.locale,p=e.generateConfig,v=e.placeholder,h=e.className,y=e.style,D=e.onClick,I=e.onClear,P=e.internalPicker,T=e.value,b=e.onChange,N=e.onSubmit;e.onInputChange;var O=e.multiple,E=e.maxTagCount;e.format,e.maskFormat,e.preserveInvalidOnBlur,e.onInvalid;var j=e.disabled,B=e.invalid;e.inputReadOnly;var z=e.direction;e.onOpenChange;var F=e.onMouseDown;e.required,e["aria-required"];var q=e.autoFocus,ee=e.tabIndex,W=e.removeIcon,_=Vn(e,Dl),Z=z==="rtl",re=o.useContext(nn),$=re.prefixCls,k=o.useRef(),g=o.useRef();o.useImperativeHandle(t,function(){return{nativeElement:k.current,focus:function(se){var V;(V=g.current)===null||V===void 0||V.focus(se)},blur:function(){var se;(se=g.current)===null||se===void 0||se.blur()}}});var C=ts(_),M=function(se){b([se])},A=function(se){var V=T.filter(function(Q){return Q&&!_t(p,m,Q,se,P)});b(V),r||N()},Y=es(_e(_e({},e),{},{onChange:M}),function(ne){var se=ne.valueTexts;return{value:se[0]||"",active:c}}),U=ce(Y,2),L=U[0],X=U[1],J=!!(s&&T.length&&!j),w=O?o.createElement(o.Fragment,null,o.createElement(xl,{prefixCls:$,value:T,onRemove:A,formatDate:X,maxTagCount:E,disabled:j,removeIcon:W,placeholder:v}),o.createElement("input",{className:"".concat($,"-multiple-input"),value:T.map(X).join(","),ref:g,readOnly:!0,autoFocus:q,tabIndex:ee}),o.createElement(Er,{type:"suffix",icon:u}),J&&o.createElement(na,{icon:s,onClear:I})):o.createElement(ra,ot({ref:g},L(),{autoFocus:q,tabIndex:ee,suffixIcon:u,clearIcon:J&&o.createElement(na,{icon:s,onClear:I}),showActiveCls:!1}));return o.createElement("div",ot({},C,{className:gt($,tt(tt(tt(tt(tt({},"".concat($,"-multiple"),O),"".concat($,"-focused"),c),"".concat($,"-disabled"),j),"".concat($,"-invalid"),B),"".concat($,"-rtl"),Z),h),style:y,ref:k,onClick:D,onMouseDown:function(se){var V,Q=se.target;Q!==((V=g.current)===null||V===void 0?void 0:V.inputElement)&&se.preventDefault(),F==null||F(se)}}),a&&o.createElement("div",{className:"".concat($,"-prefix")},a),w)}var Ml=o.forwardRef(Cl);function kl(e,t){var r=Ui(e),a=ce(r,6),s=a[0],u=a[1],c=a[2],m=a[3],p=a[4],v=a[5],h=s,y=h.prefixCls,D=h.styles,I=h.classNames,P=h.order,T=h.defaultValue,b=h.value,N=h.needConfirm,O=h.onChange,E=h.onKeyDown,j=h.disabled,B=h.disabledDate,z=h.minDate,F=h.maxDate,q=h.defaultOpen,ee=h.open,W=h.onOpenChange,_=h.locale,Z=h.generateConfig,re=h.picker,$=h.showNow,k=h.showToday,g=h.showTime,C=h.mode,M=h.onPanelChange,A=h.onCalendarChange,Y=h.onOk,U=h.multiple,L=h.defaultPickerValue,X=h.pickerValue,J=h.onPickerValueChange,w=h.inputReadOnly,ne=h.suffixIcon,se=h.removeIcon,V=h.onFocus,Q=h.onBlur,ie=h.presets,me=h.components,we=h.cellRender,ae=h.dateRender,Me=h.monthCellRender,Ee=h.onClick,ge=Hi(t);function ke(Ye){return Ye===null?null:U?Ye:Ye[0]}var ve=Xi(Z,_,u),Ne=_i(ee,q,[j],W),Te=ce(Ne,2),oe=Te[0],Ae=Te[1],Oe=function(Fe,nt,Ut){if(A){var cn=_e({},Ut);delete cn.range,A(ke(Fe),ke(nt),cn)}},Ze=function(Fe){Y==null||Y(ke(Fe))},$e=Vi(Z,_,m,!1,P,T,b,Oe,Ze),Le=ce($e,5),ct=Le[0],lt=Le[1],G=Le[2],qe=Le[3],Je=Le[4],xe=G(),Ve=zi([j]),H=ce(Ve,4),pe=H[0],Ie=H[1],d=H[2],fe=H[3],Ge=function(Fe){Ie(!0),V==null||V(Fe,{})},it=function(Fe){Ie(!1),Q==null||Q(Fe,{})},Be=fn(re,{value:C}),Rt=ce(Be,2),Xe=Rt[0],ht=Rt[1],mt=Xe==="date"&&g?"datetime":Xe,xt=Gi(re,Xe,$,k),jt=O&&function(Ye,Fe){O(ke(Ye),ke(Fe))},Bt=Zi(_e(_e({},s),{},{onChange:jt}),ct,lt,G,qe,[],m,pe,oe,v),Gt=ce(Bt,2),ut=Gt[1],Ft=Ii(xe,v),qt=ce(Ft,2),Ue=qt[0],Vt=qt[1],pn=o.useMemo(function(){return Ue.some(function(Ye){return Ye})},[Ue]),sn=function(Fe,nt){if(J){var Ut=_e(_e({},nt),{},{mode:nt.mode[0]});delete Ut.range,J(Fe[0],Ut)}},gn=Yi(Z,_,xe,[Xe],oe,fe,u,!1,L,X,An(g==null?void 0:g.defaultOpenValue),sn,z,F),on=ce(gn,2),vn=on[0],yn=on[1],zt=Ot(function(Ye,Fe,nt){if(ht(Fe),M&&nt!==!1){var Ut=Ye||xe[xe.length-1];M(Ut,Fe)}}),At=function(){ut(G()),Ae(!1,{force:!0})},ln=function(Fe){!j&&!ge.current.nativeElement.contains(document.activeElement)&&ge.current.focus(),Ae(!0),Ee==null||Ee(Fe)},Lt=function(){ut(null),Ae(!1,{force:!0})},bn=o.useState(null),un=ce(bn,2),l=un[0],i=un[1],f=o.useState(null),x=ce(f,2),S=x[0],K=x[1],te=o.useMemo(function(){var Ye=[S].concat(Ht(xe)).filter(function(Fe){return Fe});return U?Ye:Ye.slice(0,1)},[xe,S,U]),be=o.useMemo(function(){return!U&&S?[S]:xe.filter(function(Ye){return Ye})},[xe,S,U]);o.useEffect(function(){oe||K(null)},[oe]);var R=Bi(ie),de=function(Fe){K(Fe),i("preset")},le=function(Fe){var nt=U?ve(G(),Fe):[Fe],Ut=ut(nt);Ut&&!U&&Ae(!1,{force:!0})},ye=function(Fe){le(Fe)},Pe=function(Fe){K(Fe),i("cell")},he=function(Fe){Ae(!0),Ge(Fe)},ue=function(Fe){if(d("panel"),!(U&&mt!==re)){var nt=U?ve(G(),Fe):[Fe];qe(nt),!N&&!c&&u===mt&&At()}},Se=function(){Ae(!1)},Re=ca(we,ae,Me),ze=o.useMemo(function(){var Ye=ia(s,!1),Fe=Ka(s,[].concat(Ht(Object.keys(Ye)),["onChange","onCalendarChange","style","className","onPanelChange"]));return _e(_e({},Fe),{},{multiple:s.multiple})},[s]),De=o.createElement(Ji,ot({},ze,{showNow:xt,showTime:g,disabledDate:B,onFocus:he,onBlur:it,picker:re,mode:Xe,internalMode:mt,onPanelChange:zt,format:p,value:xe,isInvalid:v,onChange:null,onSelect:ue,pickerValue:vn,defaultOpenValue:g==null?void 0:g.defaultOpenValue,onPickerValueChange:yn,hoverValue:te,onHover:Pe,needConfirm:N,onSubmit:At,onOk:Je,presets:R,onPresetHover:de,onPresetSubmit:le,onNow:ye,cellRender:Re})),He=function(Fe){qe(Fe)},dt=function(){d("input")},vt=function(Fe){d("input"),Ae(!0,{inherit:!0}),Ge(Fe)},Dt=function(Fe){Ae(!1),it(Fe)},rn=function(Fe,nt){Fe.key==="Tab"&&At(),E==null||E(Fe,nt)},Jt=o.useMemo(function(){return{prefixCls:y,locale:_,generateConfig:Z,button:me.button,input:me.input}},[y,_,Z,me.button,me.input]);return Pn(function(){oe&&fe!==void 0&&zt(null,re,!1)},[oe,fe,re]),Pn(function(){var Ye=d();!oe&&Ye==="input"&&(Ae(!1),At()),!oe&&c&&!N&&Ye==="panel"&&At()},[oe]),o.createElement(nn.Provider,{value:Jt},o.createElement(Pi,ot({},Ni(s),{popupElement:De,popupStyle:D.popup,popupClassName:I.popup,visible:oe,onClose:Se}),o.createElement(Ml,ot({},s,{ref:ge,suffixIcon:ne,removeIcon:se,activeHelp:!!S,allHelp:!!S&&l==="preset",focused:pe,onFocus:vt,onBlur:Dt,onKeyDown:rn,onSubmit:At,value:be,maskFormat:p,onChange:He,onInputChange:dt,internalPicker:u,format:m,inputReadOnly:w,disabled:j,open:oe,onOpenChange:Ae,onClick:ln,onClear:Lt,invalid:pn,onInvalid:function(Fe){Vt(Fe,0)}}))))}var Pl=o.forwardRef(kl);const _r=(e,t)=>{const{componentCls:r,controlHeight:a}=e,s=t?`${r}-${t}`:"",u=ao(e);return[{[`${r}-multiple${s}`]:{paddingBlock:u.containerPadding,paddingInlineStart:u.basePadding,minHeight:a,[`${r}-selection-item`]:{height:u.itemHeight,lineHeight:at(u.itemLineHeight)}}}]},wl=e=>{const{componentCls:t,calc:r,lineWidth:a}=e,s=Xr(e,{fontHeight:e.fontSize,selectHeight:e.controlHeightSM,multipleSelectItemHeight:e.multipleItemHeightSM,borderRadius:e.borderRadiusSM,borderRadiusSM:e.borderRadiusXS,controlHeight:e.controlHeightSM}),u=Xr(e,{fontHeight:r(e.multipleItemHeightLG).sub(r(a).mul(2).equal()).equal(),fontSize:e.fontSizeLG,selectHeight:e.controlHeightLG,multipleSelectItemHeight:e.multipleItemHeightLG,borderRadius:e.borderRadiusLG,borderRadiusSM:e.borderRadius,controlHeight:e.controlHeightLG});return[_r(s,"small"),_r(e),_r(u,"large"),{[`${t}${t}-multiple`]:Object.assign(Object.assign({width:"100%",cursor:"text",[`${t}-selector`]:{flex:"auto",padding:0,position:"relative","&:after":{margin:0},[`${t}-selection-placeholder`]:{position:"absolute",top:"50%",insetInlineStart:e.inputPaddingHorizontalBase,insetInlineEnd:0,transform:"translateY(-50%)",transition:`all ${e.motionDurationSlow}`,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",flex:1,color:e.colorTextPlaceholder,pointerEvents:"none"}}},ro(e)),{[`${t}-multiple-input`]:{width:0,height:0,border:0,visibility:"hidden",position:"absolute",zIndex:-1}})}]},jl=e=>{const{pickerCellCls:t,pickerCellInnerCls:r,cellHeight:a,borderRadiusSM:s,motionDurationMid:u,cellHoverBg:c,lineWidth:m,lineType:p,colorPrimary:v,cellActiveWithRangeBg:h,colorTextLightSolid:y,colorTextDisabled:D,cellBgDisabled:I,colorFillSecondary:P}=e;return{"&::before":{position:"absolute",top:"50%",insetInlineStart:0,insetInlineEnd:0,zIndex:1,height:a,transform:"translateY(-50%)",content:'""',pointerEvents:"none"},[r]:{position:"relative",zIndex:2,display:"inline-block",minWidth:a,height:a,lineHeight:at(a),borderRadius:s,transition:`background ${u}`},[`&:hover:not(${t}-in-view):not(${t}-disabled),
    &:hover:not(${t}-selected):not(${t}-range-start):not(${t}-range-end):not(${t}-disabled)`]:{[r]:{background:c}},[`&-in-view${t}-today ${r}`]:{"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:1,border:`${at(m)} ${p} ${v}`,borderRadius:s,content:'""'}},[`&-in-view${t}-in-range,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{position:"relative",[`&:not(${t}-disabled):before`]:{background:h}},[`&-in-view${t}-selected,
      &-in-view${t}-range-start,
      &-in-view${t}-range-end`]:{[`&:not(${t}-disabled) ${r}`]:{color:y,background:v},[`&${t}-disabled ${r}`]:{background:P}},[`&-in-view${t}-range-start:not(${t}-disabled):before`]:{insetInlineStart:"50%"},[`&-in-view${t}-range-end:not(${t}-disabled):before`]:{insetInlineEnd:"50%"},[`&-in-view${t}-range-start:not(${t}-range-end) ${r}`]:{borderStartStartRadius:s,borderEndStartRadius:s,borderStartEndRadius:0,borderEndEndRadius:0},[`&-in-view${t}-range-end:not(${t}-range-start) ${r}`]:{borderStartStartRadius:0,borderEndStartRadius:0,borderStartEndRadius:s,borderEndEndRadius:s},"&-disabled":{color:D,cursor:"not-allowed",[r]:{background:"transparent"},"&::before":{background:I}},[`&-disabled${t}-today ${r}::before`]:{borderColor:D}}},Nl=e=>{const{componentCls:t,pickerCellCls:r,pickerCellInnerCls:a,pickerYearMonthCellWidth:s,pickerControlIconSize:u,cellWidth:c,paddingSM:m,paddingXS:p,paddingXXS:v,colorBgContainer:h,lineWidth:y,lineType:D,borderRadiusLG:I,colorPrimary:P,colorTextHeading:T,colorSplit:b,pickerControlIconBorderWidth:N,colorIcon:O,textHeight:E,motionDurationMid:j,colorIconHover:B,fontWeightStrong:z,cellHeight:F,pickerCellPaddingVertical:q,colorTextDisabled:ee,colorText:W,fontSize:_,motionDurationSlow:Z,withoutTimeCellHeight:re,pickerQuarterPanelContentHeight:$,borderRadiusSM:k,colorTextLightSolid:g,cellHoverBg:C,timeColumnHeight:M,timeColumnWidth:A,timeCellHeight:Y,controlItemBgActive:U,marginXXS:L,pickerDatePanelPaddingHorizontal:X,pickerControlIconMargin:J}=e,w=e.calc(c).mul(7).add(e.calc(X).mul(2)).equal();return{[t]:{"&-panel":{display:"inline-flex",flexDirection:"column",textAlign:"center",background:h,borderRadius:I,outline:"none","&-focused":{borderColor:P},"&-rtl":{[`${t}-prev-icon,
              ${t}-super-prev-icon`]:{transform:"rotate(45deg)"},[`${t}-next-icon,
              ${t}-super-next-icon`]:{transform:"rotate(-135deg)"},[`${t}-time-panel`]:{[`${t}-content`]:{direction:"ltr","> *":{direction:"rtl"}}}}},"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel,\n        &-week-panel,\n        &-date-panel,\n        &-time-panel":{display:"flex",flexDirection:"column",width:w},"&-header":{display:"flex",padding:`0 ${at(p)}`,color:T,borderBottom:`${at(y)} ${D} ${b}`,"> *":{flex:"none"},button:{padding:0,color:O,lineHeight:at(E),background:"transparent",border:0,cursor:"pointer",transition:`color ${j}`,fontSize:"inherit",display:"inline-flex",alignItems:"center",justifyContent:"center","&:empty":{display:"none"}},"> button":{minWidth:"1.6em",fontSize:_,"&:hover":{color:B},"&:disabled":{opacity:.25,pointerEvents:"none"}},"&-view":{flex:"auto",fontWeight:z,lineHeight:at(E),"> button":{color:"inherit",fontWeight:"inherit",verticalAlign:"top","&:not(:first-child)":{marginInlineStart:p},"&:hover":{color:P}}}},"&-prev-icon,\n        &-next-icon,\n        &-super-prev-icon,\n        &-super-next-icon":{position:"relative",width:u,height:u,"&::before":{position:"absolute",top:0,insetInlineStart:0,width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:N,borderInlineStartWidth:N,content:'""'}},"&-super-prev-icon,\n        &-super-next-icon":{"&::after":{position:"absolute",top:J,insetInlineStart:J,display:"inline-block",width:u,height:u,border:"0 solid currentcolor",borderBlockStartWidth:N,borderInlineStartWidth:N,content:'""'}},"&-prev-icon, &-super-prev-icon":{transform:"rotate(-45deg)"},"&-next-icon, &-super-next-icon":{transform:"rotate(135deg)"},"&-content":{width:"100%",tableLayout:"fixed",borderCollapse:"collapse","th, td":{position:"relative",minWidth:F,fontWeight:"normal"},th:{height:e.calc(F).add(e.calc(q).mul(2)).equal(),color:W,verticalAlign:"middle"}},"&-cell":Object.assign({padding:`${at(q)} 0`,color:ee,cursor:"pointer","&-in-view":{color:W}},jl(e)),"&-decade-panel,\n        &-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-content`]:{height:e.calc(re).mul(4).equal()},[a]:{padding:`0 ${at(p)}`}},"&-quarter-panel":{[`${t}-content`]:{height:$}},"&-decade-panel":{[a]:{padding:`0 ${at(e.calc(p).div(2).equal())}`},[`${t}-cell::before`]:{display:"none"}},"&-year-panel,\n        &-quarter-panel,\n        &-month-panel":{[`${t}-body`]:{padding:`0 ${at(p)}`},[a]:{width:s}},"&-date-panel":{[`${t}-body`]:{padding:`${at(p)} ${at(X)}`},[`${t}-content th`]:{boxSizing:"border-box",padding:0}},"&-week-panel-row":{td:{"&:before":{transition:`background ${j}`},"&:first-child:before":{borderStartStartRadius:k,borderEndStartRadius:k},"&:last-child:before":{borderStartEndRadius:k,borderEndEndRadius:k}},"&:hover td:before":{background:C},"&-range-start td, &-range-end td, &-selected td, &-hover td":{[`&${r}`]:{"&:before":{background:P},[`&${t}-cell-week`]:{color:new Cr(g).setA(.5).toHexString()},[a]:{color:g}}},"&-range-hover td:before":{background:U}},"&-week-panel, &-date-panel-show-week":{[`${t}-body`]:{padding:`${at(p)} ${at(m)}`},[`${t}-content th`]:{width:"auto"}},"&-datetime-panel":{display:"flex",[`${t}-time-panel`]:{borderInlineStart:`${at(y)} ${D} ${b}`},[`${t}-date-panel,
          ${t}-time-panel`]:{transition:`opacity ${Z}`},"&-active":{[`${t}-date-panel,
            ${t}-time-panel`]:{opacity:.3,"&-active":{opacity:1}}}},"&-time-panel":{width:"auto",minWidth:"auto",[`${t}-content`]:{display:"flex",flex:"auto",height:M},"&-column":{flex:"1 0 auto",width:A,margin:`${at(v)} 0`,padding:0,overflowY:"hidden",textAlign:"start",listStyle:"none",transition:`background ${j}`,overflowX:"hidden","&::-webkit-scrollbar":{width:8,backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:e.colorTextTertiary,borderRadius:e.borderRadiusSM},"&":{scrollbarWidth:"thin",scrollbarColor:`${e.colorTextTertiary} transparent`},"&::after":{display:"block",height:`calc(100% - ${at(Y)})`,content:'""'},"&:not(:first-child)":{borderInlineStart:`${at(y)} ${D} ${b}`},"&-active":{background:new Cr(U).setA(.2).toHexString()},"&:hover":{overflowY:"auto"},"> li":{margin:0,padding:0,[`&${t}-time-panel-cell`]:{marginInline:L,[`${t}-time-panel-cell-inner`]:{display:"block",width:e.calc(A).sub(e.calc(L).mul(2)).equal(),height:Y,margin:0,paddingBlock:0,paddingInlineEnd:0,paddingInlineStart:e.calc(A).sub(Y).div(2).equal(),color:W,lineHeight:at(Y),borderRadius:k,cursor:"pointer",transition:`background ${j}`,"&:hover":{background:C}},"&-selected":{[`${t}-time-panel-cell-inner`]:{background:U}},"&-disabled":{[`${t}-time-panel-cell-inner`]:{color:ee,background:"transparent",cursor:"not-allowed"}}}}}}}}},Il=e=>{const{componentCls:t,textHeight:r,lineWidth:a,paddingSM:s,antCls:u,colorPrimary:c,cellActiveWithRangeBg:m,colorPrimaryBorder:p,lineType:v,colorSplit:h}=e;return{[`${t}-dropdown`]:{[`${t}-footer`]:{borderTop:`${at(a)} ${v} ${h}`,"&-extra":{padding:`0 ${at(s)}`,lineHeight:at(e.calc(r).sub(e.calc(a).mul(2)).equal()),textAlign:"start","&:not(:last-child)":{borderBottom:`${at(a)} ${v} ${h}`}}},[`${t}-panels + ${t}-footer ${t}-ranges`]:{justifyContent:"space-between"},[`${t}-ranges`]:{marginBlock:0,paddingInline:at(s),overflow:"hidden",textAlign:"start",listStyle:"none",display:"flex",justifyContent:"center",alignItems:"center","> li":{lineHeight:at(e.calc(r).sub(e.calc(a).mul(2)).equal()),display:"inline-block"},[`${t}-now-btn-disabled`]:{pointerEvents:"none",color:e.colorTextDisabled},[`${t}-preset > ${u}-tag-blue`]:{color:c,background:m,borderColor:p,cursor:"pointer"},[`${t}-ok`]:{paddingBlock:e.calc(a).mul(2).equal(),marginInlineStart:"auto"}}}}},El=e=>{const{componentCls:t,controlHeightLG:r,paddingXXS:a,padding:s}=e;return{pickerCellCls:`${t}-cell`,pickerCellInnerCls:`${t}-cell-inner`,pickerYearMonthCellWidth:e.calc(r).mul(1.5).equal(),pickerQuarterPanelContentHeight:e.calc(r).mul(1.4).equal(),pickerCellPaddingVertical:e.calc(a).add(e.calc(a).div(2)).equal(),pickerCellBorderGap:2,pickerControlIconSize:7,pickerControlIconMargin:4,pickerControlIconBorderWidth:1.5,pickerDatePanelPaddingHorizontal:e.calc(s).add(e.calc(a).div(2)).equal()}},Rl=e=>{const{colorBgContainerDisabled:t,controlHeight:r,controlHeightSM:a,controlHeightLG:s,paddingXXS:u,lineWidth:c}=e,m=u*2,p=c*2,v=Math.min(r-m,r-p),h=Math.min(a-m,a-p),y=Math.min(s-m,s-p);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(u/2),cellHoverBg:e.controlItemBgHover,cellActiveWithRangeBg:e.controlItemBgActive,cellHoverWithRangeBg:new Cr(e.colorPrimary).lighten(35).toHexString(),cellRangeBorderColor:new Cr(e.colorPrimary).lighten(20).toHexString(),cellBgDisabled:t,timeColumnWidth:s*1.4,timeColumnHeight:28*8,timeCellHeight:28,cellWidth:a*1.5,cellHeight:a,textHeight:s,withoutTimeCellHeight:s*1.65,multipleItemBg:e.colorFillSecondary,multipleItemBorderColor:"transparent",multipleItemHeight:v,multipleItemHeightSM:h,multipleItemHeightLG:y,multipleSelectorBgDisabled:t,multipleItemColorDisabled:e.colorTextDisabled,multipleItemBorderColorDisabled:"transparent"}},Tl=e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ms(e)),Rl(e)),ks(e)),{presetsWidth:120,presetsMaxWidth:200,zIndexPopup:e.zIndexPopupBase+50}),$l=e=>{const{componentCls:t}=e;return{[t]:[Object.assign(Object.assign(Object.assign(Object.assign({},Ps(e)),ws(e)),js(e)),Ns(e)),{"&-outlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${at(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-filled":{[`&${t}-multiple ${t}-selection-item`]:{background:e.colorBgContainer,border:`${at(e.lineWidth)} ${e.lineType} ${e.colorSplit}`}},"&-borderless":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${at(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}},"&-underlined":{[`&${t}-multiple ${t}-selection-item`]:{background:e.multipleItemBg,border:`${at(e.lineWidth)} ${e.lineType} ${e.multipleItemBorderColor}`}}}]}},Hr=(e,t)=>({padding:`${at(e)} ${at(t)}`}),Ol=e=>{const{componentCls:t,colorError:r,colorWarning:a}=e;return{[`${t}:not(${t}-disabled):not([disabled])`]:{[`&${t}-status-error`]:{[`${t}-active-bar`]:{background:r}},[`&${t}-status-warning`]:{[`${t}-active-bar`]:{background:a}}}}},Fl=e=>{var t;const{componentCls:r,antCls:a,paddingInline:s,lineWidth:u,lineType:c,colorBorder:m,borderRadius:p,motionDurationMid:v,colorTextDisabled:h,colorTextPlaceholder:y,colorTextQuaternary:D,fontSizeLG:I,inputFontSizeLG:P,fontSizeSM:T,inputFontSizeSM:b,controlHeightSM:N,paddingInlineSM:O,paddingXS:E,marginXS:j,colorIcon:B,lineWidthBold:z,colorPrimary:F,motionDurationSlow:q,zIndexPopup:ee,paddingXXS:W,sizePopupArrow:_,colorBgElevated:Z,borderRadiusLG:re,boxShadowSecondary:$,borderRadiusSM:k,colorSplit:g,cellHoverBg:C,presetsWidth:M,presetsMaxWidth:A,boxShadowPopoverArrow:Y,fontHeight:U,lineHeightLG:L}=e;return[{[r]:Object.assign(Object.assign(Object.assign({},va(e)),Hr(e.paddingBlock,e.paddingInline)),{position:"relative",display:"inline-flex",alignItems:"center",lineHeight:1,borderRadius:p,transition:`border ${v}, box-shadow ${v}, background ${v}`,[`${r}-prefix`]:{flex:"0 0 auto",marginInlineEnd:e.inputAffixPadding},[`${r}-input`]:{position:"relative",display:"inline-flex",alignItems:"center",width:"100%","> input":Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",color:"inherit",fontSize:(t=e.inputFontSize)!==null&&t!==void 0?t:e.fontSize,lineHeight:e.lineHeight,transition:`all ${v}`},Us(y)),{flex:"auto",minWidth:1,height:"auto",padding:0,background:"transparent",border:0,fontFamily:"inherit","&:focus":{boxShadow:"none",outline:0},"&[disabled]":{background:"transparent",color:h,cursor:"not-allowed"}}),"&-placeholder":{"> input":{color:y}}},"&-large":Object.assign(Object.assign({},Hr(e.paddingBlockLG,e.paddingInlineLG)),{[`${r}-input > input`]:{fontSize:P??I,lineHeight:L}}),"&-small":Object.assign(Object.assign({},Hr(e.paddingBlockSM,e.paddingInlineSM)),{[`${r}-input > input`]:{fontSize:b??T}}),[`${r}-suffix`]:{display:"flex",flex:"none",alignSelf:"center",marginInlineStart:e.calc(E).div(2).equal(),color:D,lineHeight:1,pointerEvents:"none",transition:`opacity ${v}, color ${v}`,"> *":{verticalAlign:"top","&:not(:last-child)":{marginInlineEnd:j}}},[`${r}-clear`]:{position:"absolute",top:"50%",insetInlineEnd:0,color:D,lineHeight:1,transform:"translateY(-50%)",cursor:"pointer",opacity:0,transition:`opacity ${v}, color ${v}`,"> *":{verticalAlign:"top"},"&:hover":{color:B}},"&:hover":{[`${r}-clear`]:{opacity:1},[`${r}-suffix:not(:last-child)`]:{opacity:0}},[`${r}-separator`]:{position:"relative",display:"inline-block",width:"1em",height:I,color:D,fontSize:I,verticalAlign:"top",cursor:"default",[`${r}-focused &`]:{color:B},[`${r}-range-separator &`]:{[`${r}-disabled &`]:{cursor:"not-allowed"}}},"&-range":{position:"relative",display:"inline-flex",[`${r}-active-bar`]:{bottom:e.calc(u).mul(-1).equal(),height:z,background:F,opacity:0,transition:`all ${q} ease-out`,pointerEvents:"none"},[`&${r}-focused`]:{[`${r}-active-bar`]:{opacity:1}},[`${r}-range-separator`]:{alignItems:"center",padding:`0 ${at(E)}`,lineHeight:1}},"&-range, &-multiple":{[`${r}-clear`]:{insetInlineEnd:s},[`&${r}-small`]:{[`${r}-clear`]:{insetInlineEnd:O}}},"&-dropdown":Object.assign(Object.assign(Object.assign({},va(e)),Nl(e)),{pointerEvents:"none",position:"absolute",top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:ee,[`&${r}-dropdown-hidden`]:{display:"none"},"&-rtl":{direction:"rtl"},[`&${r}-dropdown-placement-bottomLeft,
            &${r}-dropdown-placement-bottomRight`]:{[`${r}-range-arrow`]:{top:0,display:"block",transform:"translateY(-100%)"}},[`&${r}-dropdown-placement-topLeft,
            &${r}-dropdown-placement-topRight`]:{[`${r}-range-arrow`]:{bottom:0,display:"block",transform:"translateY(100%) rotate(180deg)"}},[`&${a}-slide-up-appear, &${a}-slide-up-enter`]:{[`${r}-range-arrow${r}-range-arrow`]:{transition:"none"}},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-topRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-topRight`]:{animationName:Fs},[`&${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-enter${a}-slide-up-enter-active${r}-dropdown-placement-bottomRight,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-appear${a}-slide-up-appear-active${r}-dropdown-placement-bottomRight`]:{animationName:Os},[`&${a}-slide-up-leave ${r}-panel-container`]:{pointerEvents:"none"},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-topRight`]:{animationName:$s},[`&${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomLeft,
          &${a}-slide-up-leave${a}-slide-up-leave-active${r}-dropdown-placement-bottomRight`]:{animationName:Ts},[`${r}-panel > ${r}-time-panel`]:{paddingTop:W},[`${r}-range-wrapper`]:{display:"flex",position:"relative"},[`${r}-range-arrow`]:Object.assign(Object.assign({position:"absolute",zIndex:1,display:"none",paddingInline:e.calc(s).mul(1.5).equal(),boxSizing:"content-box",transition:`all ${q} ease-out`},Ls(e,Z,Y)),{"&:before":{insetInlineStart:e.calc(s).mul(1.5).equal()}}),[`${r}-panel-container`]:{overflow:"hidden",verticalAlign:"top",background:Z,borderRadius:re,boxShadow:$,transition:`margin ${q}`,display:"inline-block",pointerEvents:"auto",[`${r}-panel-layout`]:{display:"flex",flexWrap:"nowrap",alignItems:"stretch"},[`${r}-presets`]:{display:"flex",flexDirection:"column",minWidth:M,maxWidth:A,ul:{height:0,flex:"auto",listStyle:"none",overflow:"auto",margin:0,padding:E,borderInlineEnd:`${at(u)} ${c} ${g}`,li:Object.assign(Object.assign({},As),{borderRadius:k,paddingInline:E,paddingBlock:e.calc(N).sub(U).div(2).equal(),cursor:"pointer",transition:`all ${q}`,"+ li":{marginTop:j},"&:hover":{background:C}})}},[`${r}-panels`]:{display:"inline-flex",flexWrap:"nowrap","&:last-child":{[`${r}-panel`]:{borderWidth:0}}},[`${r}-panel`]:{verticalAlign:"top",background:"transparent",borderRadius:0,borderWidth:0,[`${r}-content, table`]:{textAlign:"center"},"&-focused":{borderColor:m}}}}),"&-dropdown-range":{padding:`${at(e.calc(_).mul(2).div(3).equal())} 0`,"&-hidden":{display:"none"}},"&-rtl":{direction:"rtl",[`${r}-separator`]:{transform:"scale(-1, 1)"},[`${r}-footer`]:{"&-extra":{direction:"rtl"}}}})},ya(e,"slide-up"),ya(e,"slide-down"),Ca(e,"move-up"),Ca(e,"move-down")]},ns=Is("DatePicker",e=>{const t=Xr(Es(e),El(e),{inputPaddingHorizontalBase:e.calc(e.paddingSM).sub(1).equal(),multipleSelectItemHeight:e.multipleItemHeight,selectHeight:e.controlHeight});return[Il(t),Fl(t),$l(t),Ol(t),wl(t),Rs(e,{focusElCls:`${e.componentCls}-focused`})]},Tl);var Al={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M873.1 596.2l-164-208A32 32 0 00684 376h-64.8c-6.7 0-10.4 7.7-6.3 13l144.3 183H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h695.9c26.8 0 41.7-30.8 25.2-51.8z"}}]},name:"swap-right",theme:"outlined"},Ll=function(t,r){return o.createElement(sa,ot({},t,{ref:r,icon:Al}))},Ul=o.forwardRef(Ll);const rs=(e,t,r,a,s)=>{const{classNames:u,styles:c}=_s(e),[m,p]=fo([u,t],[c,r],{popup:{_default:"root"}});return o.useMemo(()=>{var v,h;const y=Object.assign(Object.assign({},m),{popup:Object.assign(Object.assign({},m.popup),{root:gt((v=m.popup)===null||v===void 0?void 0:v.root,a)})}),D=Object.assign(Object.assign({},p),{popup:Object.assign(Object.assign({},p.popup),{root:Object.assign(Object.assign({},(h=p.popup)===null||h===void 0?void 0:h.root),s)})});return[y,D]},[m,p,a,s])};function _l(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.yearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.quarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.monthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.weekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.placeholder:e.lang.placeholder}function Hl(e,t,r){return r!==void 0?r:t==="year"&&e.lang.yearPlaceholder?e.lang.rangeYearPlaceholder:t==="quarter"&&e.lang.quarterPlaceholder?e.lang.rangeQuarterPlaceholder:t==="month"&&e.lang.monthPlaceholder?e.lang.rangeMonthPlaceholder:t==="week"&&e.lang.weekPlaceholder?e.lang.rangeWeekPlaceholder:t==="time"&&e.timePickerLocale.placeholder?e.timePickerLocale.rangePlaceholder:e.lang.rangePlaceholder}function as(e,t){const{allowClear:r=!0}=e,{clearIcon:a,removeIcon:s}=io(Object.assign(Object.assign({},e),{prefixCls:t,componentName:"DatePicker"}));return[o.useMemo(()=>r===!1?!1:Object.assign({clearIcon:a},r===!0?{}:r),[r,a]),s]}const[Bl,zl]=["week","WeekPicker"],[Yl,Wl]=["month","MonthPicker"],[Kl,ql]=["year","YearPicker"],[Vl,Zl]=["quarter","QuarterPicker"],[pa,ja]=["time","TimePicker"];var Gl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"},Xl=function(t,r){return o.createElement(sa,ot({},t,{ref:r,icon:Gl}))},Ql=o.forwardRef(Xl),Jl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},eu=function(t,r){return o.createElement(sa,ot({},t,{ref:r,icon:Jl}))},tu=o.forwardRef(eu);const is=({picker:e,hasFeedback:t,feedbackIcon:r,suffixIcon:a})=>a===null||a===!1?null:a===!0||a===void 0?Cn.createElement(Cn.Fragment,null,e===pa?Cn.createElement(tu,null):Cn.createElement(Ql,null),t&&r):a,nu=e=>o.createElement(je,Object.assign({size:"small",type:"primary"},e));function ss(e){return o.useMemo(()=>Object.assign({button:nu},e),[e])}var ru=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]]);return r};const au=e=>o.forwardRef((r,a)=>{var s;const{prefixCls:u,getPopupContainer:c,components:m,className:p,style:v,placement:h,size:y,disabled:D,bordered:I=!0,placeholder:P,popupStyle:T,popupClassName:b,dropdownClassName:N,status:O,rootClassName:E,variant:j,picker:B,styles:z,classNames:F,suffixIcon:q}=r,ee=ru(r,["prefixCls","getPopupContainer","components","className","style","placement","size","disabled","bordered","placeholder","popupStyle","popupClassName","dropdownClassName","status","rootClassName","variant","picker","styles","classNames","suffixIcon"]),W=B===pa?"timePicker":"datePicker",_=o.useRef(null),{getPrefixCls:Z,direction:re,getPopupContainer:$,rangePicker:k}=o.useContext(qa),g=Z("picker",u),{compactSize:C,compactItemClassnames:M}=Va(g,re),A=Z(),[Y,U]=Za("rangePicker",j,I),L=Ga(g),[X,J,w]=ns(g,L),[ne,se]=rs(W,F,z,b||N,T),[V]=as(r,g),Q=ss(m),ie=Xa(oe=>{var Ae;return(Ae=y??C)!==null&&Ae!==void 0?Ae:oe}),me=o.useContext(Qa),we=D??me,ae=o.useContext(Ja),{hasFeedback:Me,status:Ee,feedbackIcon:ge}=ae,ke=o.createElement(is,{picker:B,hasFeedback:Me,feedbackIcon:ge,suffixIcon:q});o.useImperativeHandle(a,()=>_.current);const[ve]=ei("Calendar",ti),Ne=Object.assign(Object.assign({},ve),r.locale),[Te]=ni("DatePicker",(s=se.popup.root)===null||s===void 0?void 0:s.zIndex);return X(o.createElement(ri,{space:!0},o.createElement(Sl,Object.assign({separator:o.createElement("span",{"aria-label":"to",className:`${g}-separator`},o.createElement(Ul,null)),disabled:we,ref:_,placement:h,placeholder:Hl(Ne,B,P),suffixIcon:ke,prevIcon:o.createElement("span",{className:`${g}-prev-icon`}),nextIcon:o.createElement("span",{className:`${g}-next-icon`}),superPrevIcon:o.createElement("span",{className:`${g}-super-prev-icon`}),superNextIcon:o.createElement("span",{className:`${g}-super-next-icon`}),transitionName:`${A}-slide-up`,picker:B},ee,{className:gt({[`${g}-${ie}`]:ie,[`${g}-${Y}`]:U},ai(g,ii(Ee,O),Me),J,M,p,k==null?void 0:k.className,w,L,E,ne.root),style:Object.assign(Object.assign(Object.assign({},k==null?void 0:k.style),v),se.root),locale:Ne.lang,prefixCls:g,getPopupContainer:c||$,generateConfig:e,components:Q,direction:re,classNames:{popup:gt(J,w,L,E,ne.popup.root)},styles:{popup:Object.assign(Object.assign({},se.popup.root),{zIndex:Te})},allowClear:V}))))});var iu=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]]);return r};const su=e=>{const t=(p,v)=>{const h=v===ja?"timePicker":"datePicker";return o.forwardRef((D,I)=>{var P;const{prefixCls:T,getPopupContainer:b,components:N,style:O,className:E,rootClassName:j,size:B,bordered:z,placement:F,placeholder:q,popupStyle:ee,popupClassName:W,dropdownClassName:_,disabled:Z,status:re,variant:$,onCalendarChange:k,styles:g,classNames:C,suffixIcon:M}=D,A=iu(D,["prefixCls","getPopupContainer","components","style","className","rootClassName","size","bordered","placement","placeholder","popupStyle","popupClassName","dropdownClassName","disabled","status","variant","onCalendarChange","styles","classNames","suffixIcon"]),{getPrefixCls:Y,direction:U,getPopupContainer:L,[h]:X}=o.useContext(qa),J=Y("picker",T),{compactSize:w,compactItemClassnames:ne}=Va(J,U),se=o.useRef(null),[V,Q]=Za("datePicker",$,z),ie=Ga(J),[me,we,ae]=ns(J,ie);o.useImperativeHandle(I,()=>se.current);const Me={showToday:!0},Ee=p||D.picker,ge=Y(),{onSelect:ke,multiple:ve}=A,Ne=ke&&p==="time"&&!ve,Te=(d,fe,Ge)=>{k==null||k(d,fe,Ge),Ne&&ke(d)},[oe,Ae]=rs(h,C,g,W||_,ee),[Oe,Ze]=as(D,J),$e=ss(N),Le=Xa(d=>{var fe;return(fe=B??w)!==null&&fe!==void 0?fe:d}),ct=o.useContext(Qa),lt=Z??ct,G=o.useContext(Ja),{hasFeedback:qe,status:Je,feedbackIcon:xe}=G,Ve=o.createElement(is,{picker:Ee,hasFeedback:qe,feedbackIcon:xe,suffixIcon:M}),[H]=ei("DatePicker",ti),pe=Object.assign(Object.assign({},H),D.locale),[Ie]=ni("DatePicker",(P=Ae.popup.root)===null||P===void 0?void 0:P.zIndex);return me(o.createElement(ri,{space:!0},o.createElement(Pl,Object.assign({ref:se,placeholder:_l(pe,Ee,q),suffixIcon:Ve,placement:F,prevIcon:o.createElement("span",{className:`${J}-prev-icon`}),nextIcon:o.createElement("span",{className:`${J}-next-icon`}),superPrevIcon:o.createElement("span",{className:`${J}-super-prev-icon`}),superNextIcon:o.createElement("span",{className:`${J}-super-next-icon`}),transitionName:`${ge}-slide-up`,picker:p,onCalendarChange:Te},Me,A,{locale:pe.lang,className:gt({[`${J}-${Le}`]:Le,[`${J}-${V}`]:Q},ai(J,ii(Je,re),qe),we,ne,X==null?void 0:X.className,E,ae,ie,j,oe.root),style:Object.assign(Object.assign(Object.assign({},X==null?void 0:X.style),O),Ae.root),prefixCls:J,getPopupContainer:b||L,generateConfig:e,components:$e,direction:U,disabled:lt,classNames:{popup:gt(we,ae,ie,j,oe.popup.root)},styles:{popup:Object.assign(Object.assign({},Ae.popup.root),{zIndex:Ie})},allowClear:Oe,removeIcon:Ze}))))})},r=t(),a=t(Bl,zl),s=t(Yl,Wl),u=t(Kl,ql),c=t(Vl,Zl),m=t(pa,ja);return{DatePicker:r,WeekPicker:a,MonthPicker:s,YearPicker:u,TimePicker:m,QuarterPicker:c}},os=e=>{const{DatePicker:t,WeekPicker:r,MonthPicker:a,YearPicker:s,TimePicker:u,QuarterPicker:c}=su(e),m=au(e),p=t;return p.WeekPicker=r,p.MonthPicker=a,p.YearPicker=s,p.RangePicker=m,p.TimePicker=u,p.QuarterPicker=c,p},Xn=os(jo),ou=si(Xn,"popupAlign",void 0,"picker");Xn._InternalPanelDoNotUseOrYouWillBeFired=ou;const lu=si(Xn.RangePicker,"popupAlign",void 0,"picker");Xn._InternalRangePanelDoNotUseOrYouWillBeFired=lu;Xn.generatePicker=os;const zn=24*60*60*1e3;function ls(e){if(!e)return null;const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return null;const s=new Date(Date.UTC(t,r-1,a));return Number.isNaN(s.getTime())?null:s}function us(e){const t=e.state.settings||{},r=fi(t.startMonth),a=e.dates.filter(y=>!!(y&&/^\d{4}-\d{2}-\d{2}$/.test(y))).sort()[0],s=r||(a==null?void 0:a.slice(0,7))||new Date().toISOString().slice(0,7),u=Number.isFinite(Number(e.fallbackHorizon))?Number(e.fallbackHorizon):12,c=Number(t.horizonMonths||0),m=Number.isFinite(c)&&c>0?Math.round(c):Math.max(1,Math.round(u)),p=hi(s,m),v=ls(`${s}-01`)||new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),1)),h=new Date(v.getTime());return h.setUTCMonth(h.getUTCMonth()+m),{startMonth:s,horizonMonths:m,months:p,visibleStartMs:v.getTime(),visibleEndMs:h.getTime()}}function Mn(e){const t=Number.isFinite(Number(e.fallbackMs))?Number(e.fallbackMs):zn,r=Number.isFinite(e.startMs)?e.startMs:Date.now(),a=Number.isFinite(e.endMs)?e.endMs:r+t,s=a>r?a:r+t;return{startMs:r,endMs:s}}function dn(e){const t=ls(e);return t?t.getTime():null}const{Text:uu}=Rn;function cu(e){const t=e==null?void 0:e[0];return!t||typeof t.toDate!="function"?"":t.toDate().toLocaleDateString("de-DE",{month:"short",year:"numeric"})}function cs({className:e,groups:t,items:r,visibleStartMs:a,visibleEndMs:s,sidebarWidth:u=290,lineHeight:c=56,itemHeightRatio:m=.7,stackItems:p=!0,sidebarHeaderLabel:v="SKU / Orders",emptyMessage:h="Keine Einträge für den aktuellen Filter.",showTodayMarker:y=!0,itemRenderer:D,onItemSelect:I}){const[P,T]=o.useState(null),[b,N]=o.useState(null);o.useEffect(()=>{if(typeof window>"u")return;let _=!0;return Hs(()=>import("./react-calendar-timeline.es-DzeLLxS0.js"),__vite__mapDeps([0,1,2])).then(Z=>{_&&T(Z)}).catch(Z=>{_&&N(Z instanceof Error?Z.message:"Timeline library konnte nicht geladen werden.")}),()=>{_=!1}},[]);const O=o.useMemo(()=>t.map(_=>({id:_.id,title:_.title,rightTitle:_.rightTitle,height:_.height,stackItems:_.stackItems})),[t]),E=o.useMemo(()=>{const _=Math.max(6e4,Math.floor(zn/2));return r.map(Z=>{const re=Math.max(6e4,Number.isFinite(Number(Z.minDurationMs))?Number(Z.minDurationMs):_),$=Mn({startMs:Number(Z.startMs||0),endMs:Number(Z.endMs||0),fallbackMs:re}),k={...Z.itemProps||{}};return Z.tooltip&&!k.title&&(k.title=Z.tooltip),{id:Z.id,group:Z.group,title:Z.title,start_time:$.startMs,end_time:$.endMs,className:Z.className,style:Z.style,meta:Z.meta,itemProps:k,canSelect:Z.canSelect!==!1,canMove:!1,canResize:!1,canChangeGroup:!1}})},[r]);if(!O.length||!E.length)return n.jsx(kt,{type:"info",showIcon:!0,message:h});if(b)return n.jsx(kt,{type:"warning",showIcon:!0,message:`Timeline konnte nicht geladen werden: ${b}`});if(!P)return n.jsx("div",{className:"v2-orders-gantt-loading",children:n.jsx(uu,{type:"secondary",children:"Timeline wird geladen..."})});const j=P.default,B=P.TimelineHeaders,z=P.SidebarHeader,F=P.DateHeader,q=P.TimelineMarkers,ee=P.TodayMarker,W=Mn({startMs:a,endMs:s,fallbackMs:30*zn});return n.jsx("div",{className:["v2-orders-gantt-wrap",e||""].filter(Boolean).join(" "),children:n.jsxs(j,{className:"v2-orders-gantt",groups:O,items:E,defaultTimeStart:W.startMs,defaultTimeEnd:W.endMs,visibleTimeStart:W.startMs,visibleTimeEnd:W.endMs,onTimeChange:(_,Z,re)=>{re(W.startMs,W.endMs)},canMove:!1,canResize:!1,canChangeGroup:!1,canSelect:!0,stackItems:p,lineHeight:c,itemHeightRatio:m,sidebarWidth:u,rightSidebarWidth:0,minZoom:7*zn,maxZoom:Math.max(W.endMs-W.startMs,7*zn),dragSnap:zn,buffer:1,itemRenderer:D,onItemSelect:_=>{I&&I(String(_||""))},children:[n.jsxs(B,{className:"v2-orders-gantt-headers",children:[n.jsx(z,{children:({getRootProps:_})=>{const Z=_();return n.jsx("div",{...Z,children:n.jsx("div",{className:"v2-orders-gantt-sidebar-header",children:v})})}}),n.jsx(F,{unit:"primaryHeader"}),n.jsx(F,{unit:"month",labelFormat:cu})]}),n.jsx(q,{children:y?n.jsx(ee,{children:({styles:_})=>n.jsx("div",{style:{..._,width:2,background:"rgba(220, 38, 38, 0.82)",zIndex:35}})}):void 0})]})})}const{Paragraph:du,Text:Qe,Title:mu}=Rn;function Mt(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const s=new Date(Date.UTC(t,r-1,a));return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function pt(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function yr(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function fu(e){return Array.isArray(e)?e.map(t=>t).map(t=>({month:String(t.month||""),daysCovered:Math.max(0,Number(t.daysCovered||0)),forecastMonthUnits:Number.isFinite(Number(t.forecastMonthUnits))?Number(t.forecastMonthUnits):null,demandUnitsInWindow:Number.isFinite(Number(t.demandUnitsInWindow))?Number(t.demandUnitsInWindow):0,usedFallback:!!t.usedFallback})).filter(t=>/^\d{4}-\d{2}$/.test(t.month)):[]}function Br(e){const t=In(e);return t==="ACTIVE"?n.jsx(ft,{color:"green",children:"Active"}):t==="CONVERTED"?n.jsx(ft,{color:"blue",children:"Converted"}):t==="ARCHIVED"?n.jsx(ft,{color:"default",children:"Archived"}):n.jsx(ft,{color:"gold",children:"Draft"})}function hu(e){const t=String(e||"").trim().toLowerCase();return t?t==="review_needed"?"Review nötig":t==="reviewed_updated"?"Aktualisiert":t==="superseded"?"Superseded":t==="ignored"?"Ignoriert":String(e||"—"):"—"}function pu(e){return e==="ACTIVE"?"DRAFT":"ACTIVE"}function gu(e){return e==="supplier"?"Supplier":e==="freight"?"Shipping China -> 3PL":e==="duty"?"Custom Duties":e==="eust"?"Einfuhrumsatzsteuer":"EUSt Erstattung"}function vu(e){if(!Bs(e.includeInForecast,!0))return!1;if(typeof e.active=="boolean")return e.active;const t=String(e.status||"").trim().toLowerCase();return t?t==="active"||t==="aktiv":!0}function Na(e){let t=0;const r=/(\d+)(?!.*\d)/;return(e||[]).forEach(a=>{const s=a,u=r.exec(String(s.poNo||""));if(!u)return;const c=Number(u[1]);Number.isFinite(c)&&c>t&&(t=c)}),t>0?String(t+1):String((e||[]).length+1)}function Ia(e){const t=String(e||"").trim();if(!t)return"";const r=t.toUpperCase().replace(/[\s_-]+/g,"");return r.startsWith("FO")?r.slice(2):r}function Ea(e){const t=Ia(e.foNo);if(t)return t;const r=Ia(e.foNumber);return r||String(e.id||"").slice(-6).toUpperCase()}function qn(e){const t=String(e||"").trim();if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return null;const r=new Date(`${t}T00:00:00Z`);return Number.isNaN(r.getTime())?null:t}function yu(e){const t=String(e||"").trim();return!t||!t.startsWith("/v2/")?null:t}function Ra(e,t){return!e&&!t?0:e?t?e.localeCompare(t):-1:1}function bu(e){return new URLSearchParams(e).get("view")==="timeline"?"timeline":"table"}function Su(e){return qn(e==null?void 0:e.etaDate)||"9999-12-31"}function zr(e){return qn(e.targetDeliveryDate)||qn(e.deliveryDate)||qn(e.etaDate)}function ar(e){return Math.round(e*100)/100}function xu(e){const t=Number(e);return Number.isFinite(t)?t:null}function Kt(e){const t=Number(e);return!Number.isFinite(t)||t<=0?null:t}function En(e){const t=String(e||"").trim().toUpperCase();return t==="AIR"||t==="SEA"||t==="RAIL"?t:"RAIL"}function Yn(e){return Number(Kt(e.fxRate)??0)}function or(e,t){const r=e.transportLeadTimesDays||{},s=[En(t),"RAIL","SEA","AIR"],u=new Set;for(let c=0;c<s.length;c+=1){const m=s[c];if(u.has(m))continue;u.add(m);const p=Number(r[m.toLowerCase()]);if(!(!Number.isFinite(p)||p<0))return{days:Math.max(0,Math.round(p)),sourceMode:m}}return{days:0,sourceMode:null}}function ga(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function Dr(e){const t=ga(e);return Number(Kt(t.unitPriceUsd)??Kt(e==null?void 0:e.unitPriceUsd)??Kt(e==null?void 0:e.unitPrice)??0)}function Du(e){const t=ga(e);return Number(Kt(e==null?void 0:e.logisticsPerUnitEur)??Kt(e==null?void 0:e.freightPerUnitEur)??Kt(t.logisticsPerUnitEur)??Kt(t.freightEur)??0)}function Yr(e){const t=e.product||{},r=e.supplier||{},a=e.settings||{},s=Tn({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"fo"}),u=Dr(t),c=Yn(a),m=Du(t),p=Math.max(0,ar(m)),v=En(e.transportMode||"RAIL"),h=or(a,v).days,y=Number(s.fields.productionLeadTimeDays.value||45),D=s.fields.ddp.value===!0,I=String(r.incotermDefault||s.fields.incoterm.value||(D?"DDP":"EXW")).toUpperCase();return{transportMode:v,incoterm:I,unitPrice:u,currency:"USD",freight:p,freightCurrency:"EUR",dutyRatePct:Number(s.fields.dutyRatePct.value||0),eustRatePct:Number(s.fields.eustRatePct.value||0),fxRate:c,productionLeadTimeDays:Math.max(0,Math.round(y)),logisticsLeadTimeDays:Math.max(0,Math.round(h)),bufferDays:Math.max(0,Math.round(xu(a.defaultBufferDays)??0))}}function Cu(e){const t=e.product||{},r=e.settings||{},a=ga(t),s=En(e.transportMode||"RAIL"),u=or(r,s);let c="Fallback";Kt(t.productionLeadTimeDaysDefault)!=null?c="Produkt-Override":Kt(a.productionDays)!=null?c="Beschaffungs-Template":Kt(r.defaultProductionLeadTimeDays)!=null&&(c="Settings-Default");let m="Fallback";return u.sourceMode&&(m=`Settings-Default (${u.sourceMode})`),{production:c,logistics:m}}function Mu({embedded:e=!1}={}){var l;const t=oa(),r=kr(),{state:a,loading:s,saving:u,error:c,lastSavedAt:m,saveWith:p}=Pr(),v=oi(),[h,y]=o.useState(""),[D,I]=o.useState("ALL"),[P,T]=o.useState(!1),[b,N]=o.useState(null),[O,E]=o.useState(!1),[j,B]=o.useState(null),[z,F]=o.useState(""),[q,ee]=o.useState(""),[W,_]=o.useState([]),[Z,re]=o.useState(!1),[$,k]=o.useState(""),[g,C]=o.useState(""),[M,A]=o.useState("earliest"),[Y,U]=o.useState(""),[L,X]=o.useState(!1),[J,w]=o.useState(null),[ne]=Ce.useForm(),se=o.useMemo(()=>bu(t.search),[t.search]),V=a,Q=a.settings||{},ie=o.useMemo(()=>li(Q),[Q]),me=o.useMemo(()=>ui({userId:v.userId,userEmail:v.email},ie),[ie,v.email,v.userId]),we=o.useMemo(()=>`fo:edit:${String(b||"new")}`,[b]),ae=gi({workspaceId:v.workspaceId,modalScope:we,isOpen:P,userId:v.userId,userEmail:v.email,userDisplayName:me,displayNames:ie});function Me(i){const f=new URLSearchParams(t.search);i==="timeline"?f.set("view","timeline"):f.delete("view");const x=f.toString();r({pathname:t.pathname,search:x?`?${x}`:""},{replace:!0})}const Ee=o.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(i=>i).map(i=>({id:String(i.id||""),name:String(i.name||"—"),productionLeadTimeDaysDefault:Number(i.productionLeadTimeDaysDefault)||0,incotermDefault:String(i.incotermDefault||"EXW").toUpperCase(),currencyDefault:String(i.currencyDefault||"EUR").toUpperCase(),raw:i})).filter(i=>i.id),[a.suppliers]),ge=o.useMemo(()=>new Map(Ee.map(i=>[i.id,i.raw])),[Ee]),ke=o.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(i=>i).map(i=>({sku:String(i.sku||""),alias:String(i.alias||i.sku||""),status:String(i.status||"active"),supplierId:String(i.supplierId||""),productionLeadTimeDaysDefault:Number(i.productionLeadTimeDaysDefault)||0,raw:i})).filter(i=>i.sku),[a.products]),ve=o.useMemo(()=>new Map(ke.map(i=>[i.sku,i])),[ke]),Ne=o.useMemo(()=>zs(a.forecast||{}),[a.forecast]),Te=o.useMemo(()=>Ws(V),[a.forecast,a.inventory,a.pos,a.fos]),oe=o.useMemo(()=>{const i=(Array.isArray(a.fos)?a.fos:[]).map(x=>{const S=x,K=String(S.sku||""),te=ve.get(K),be=Ee.find(Se=>Se.id===String(S.supplierId||"")),R=xr({targetDeliveryDate:S.targetDeliveryDate,productionLeadTimeDays:S.productionLeadTimeDays,logisticsLeadTimeDays:S.logisticsLeadTimeDays,bufferDays:S.bufferDays}),de={orderDate:String(S.orderDate||R.orderDate||""),etdDate:String(S.etdDate||R.etdDate||""),etaDate:String(S.etaDate||R.etaDate||"")},le=ba({units:S.units,unitPrice:S.unitPrice,currency:S.currency,freight:S.freight,freightCurrency:S.freightCurrency,dutyRatePct:S.dutyRatePct,eustRatePct:S.eustRatePct,fxRate:S.fxRate}),ye=Number(S.productionLeadTimeDays||0)+Number(S.logisticsLeadTimeDays||0)+Number(S.bufferDays||0),Pe=Sa({context:Te,sku:K,leadTimeDays:ye,product:Rr(ke.map(Se=>Se.raw),K),settings:Q,horizonMonths:12});let he="—",ue=null;return Pe&&(Pe.status==="no_fo_needed"?he="Keine FO erforderlich":Pe.status==="ok"?(ue=Number(Pe.recommendedUnits||0),he=`${pt(ue,0)} Units`):he="Nicht berechenbar"),{id:String(S.id||""),foNo:String(S.foNo||"").trim()||null,foNumber:String(S.foNumber||"").trim()||null,displayNumber:Ea({foNo:S.foNo,foNumber:S.foNumber,id:S.id}),sku:K,alias:(te==null?void 0:te.alias)||K||"—",supplierId:String(S.supplierId||""),supplierName:(be==null?void 0:be.name)||"—",units:Number(S.units||0),targetDeliveryDate:S.targetDeliveryDate?String(S.targetDeliveryDate):null,orderDate:de.orderDate||null,etdDate:de.etdDate||null,etaDate:de.etaDate||null,landedCostEur:ar(le.landedCostEur),status:In(S.status),convertedPoNo:S.convertedPoNo?String(S.convertedPoNo):null,forecastBasisLabel:String(S.forecastBasisVersionName||S.forecastBasisVersionId||"—"),forecastConflictState:String(S.forecastConflictState||"").trim()||null,recommendationText:he,recommendationUnits:ue,raw:S}}),f=h.trim().toLowerCase();return i.filter(x=>D!=="ALL"&&x.status!==D?!1:f?[x.displayNumber,x.foNo||"",x.foNumber||"",x.alias,x.sku,x.supplierName,x.status].join(" ").toLowerCase().includes(f):!0).sort((x,S)=>(x.targetDeliveryDate||"").localeCompare(S.targetDeliveryDate||""))},[ve,ke,Te,h,Q,a.fos,D,Ee]),Ae=o.useMemo(()=>{const i=new Map;return(Array.isArray(a.fos)?a.fos:[]).forEach(f=>{const x=f,S=String(x.id||"").trim();S&&i.set(S,x)}),i},[a.fos]),Oe=o.useMemo(()=>W.map(i=>Ae.get(i)||null).filter(i=>!!i).filter(i=>Zt(i.status)),[Ae,W]),Ze=o.useMemo(()=>Oe.map(i=>zr(i)).filter(i=>!!i).sort((i,f)=>Ra(i,f))[0]||"",[Oe]),$e=o.useMemo(()=>M==="manual"?qn(Y)||null:qn(Ze)||null,[Ze,Y,M]),ct=o.useMemo(()=>Array.from(new Set(Oe.map(i=>String(i.supplierId||"").trim()).filter(Boolean))),[Oe]).length>1,lt=o.useMemo(()=>Array.from(new Set(Oe.map(i=>String(i.transportMode||"").trim().toUpperCase()).filter(Boolean))),[Oe]),G=o.useMemo(()=>Array.from(new Set(Oe.map(i=>String(i.incoterm||"").trim().toUpperCase()).filter(Boolean))),[Oe]),qe=lt.length>1||G.length>1,Je=o.useMemo(()=>$e?Oe.map(i=>{const f=zr(i),x=Ra(f,$e),S=x<0?"Zu spät bei gemeinsamer PO":x>0?"Früher als Ziel":"Passt";return{id:String(i.id||""),sku:String(i.sku||""),targetDate:f,deviation:S,status:x}}):[],[$e,Oe]);function xe(i,f){_(x=>f?Array.from(new Set([...x,i])):x.filter(S=>S!==i))}function Ve(i){B(i.id),F(Na(Array.isArray(a.pos)?a.pos:[])),ee(i.orderDate||""),E(!0)}const H=o.useMemo(()=>us({state:V,dates:oe.flatMap(i=>[i.orderDate,i.etdDate,i.etaDate,i.targetDeliveryDate]),fallbackHorizon:12}),[oe,V]),pe=o.useMemo(()=>{const i=[],f=[],x=new Map;return oe.forEach(S=>{const K=Zt(S.status);i.push({id:S.id,title:n.jsxs("div",{className:"v2-orders-gantt-meta",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(en,{checked:W.includes(S.id),disabled:!K,onChange:ye=>xe(S.id,ye.target.checked)}),n.jsxs(Qe,{strong:!0,children:["FO ",S.displayNumber]}),Br(S.status)]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[S.alias," (",S.sku,") · ",S.supplierName]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:["Target ",Mt(S.targetDeliveryDate)," · ETA ",Mt(S.etaDate)]}),n.jsxs("div",{className:"v2-orders-gantt-actionline",children:[n.jsx(je,{size:"small",onClick:()=>At(S.raw),children:K?"Bearbeiten":"Details"}),n.jsx(je,{size:"small",disabled:!K,onClick:()=>Ve(S),children:"Convert"}),S.convertedPoNo?n.jsx(je,{size:"small",onClick:()=>{const ye=new URLSearchParams;ye.set("source","fo_convert"),ye.set("poNo",String(S.convertedPoNo||"")),r(`/v2/orders/po?${ye.toString()}`)},children:"PO öffnen"}):null]})]})});const te=dn(S.orderDate),be=dn(S.etdDate),R=dn(S.etaDate||S.targetDeliveryDate),de=te??be,le=be;if(de!=null&&le!=null){const ye=Mn({startMs:de,endMs:le}),Pe=`${S.id}:production`;f.push({id:Pe,group:S.id,title:`FO ${S.displayNumber} · Produktion`,startMs:ye.startMs,endMs:ye.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-production",tooltip:[`FO: ${S.displayNumber}`,`Produkt: ${S.alias} (${S.sku})`,`Produktion: ${Mt(S.orderDate)} bis ${Mt(S.etdDate)}`].join(`
`)}),x.set(Pe,S)}if(R!=null){const Pe=Mn({startMs:be??te??R,endMs:R}),he=`${S.id}:transit`;f.push({id:he,group:S.id,title:`FO ${S.displayNumber} · Transit`,startMs:Pe.startMs,endMs:Pe.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--fo-transit",tooltip:[`FO: ${S.displayNumber}`,`Produkt: ${S.alias} (${S.sku})`,`Transit: ${Mt(S.etdDate||S.orderDate)} bis ${Mt(S.etaDate||S.targetDeliveryDate)}`].join(`
`)}),x.set(he,S)}}),{groups:i,items:f,itemRowMap:x}},[W,r,oe,a.pos]);o.useEffect(()=>{_(i=>i.filter(f=>{const x=Ae.get(f);return!!x&&Zt(x==null?void 0:x.status)}))},[Ae]);const Ie=o.useMemo(()=>[{header:"Merge",meta:{width:84,minWidth:84},cell:({row:i})=>{const f=Zt(i.original.status);return n.jsx(en,{checked:W.includes(i.original.id),disabled:!f,onChange:x=>{xe(i.original.id,x.target.checked)}})}},{header:"FO",cell:({row:i})=>i.original.displayNumber},{header:"Produkt",meta:{width:220,minWidth:220},cell:({row:i})=>n.jsx(mi,{alias:i.original.alias,sku:i.original.sku})},{header:"Supplier",accessorKey:"supplierName"},{header:"Units",cell:({row:i})=>pt(i.original.units,0)},{header:"Target",cell:({row:i})=>Mt(i.original.targetDeliveryDate)},{header:"Order",cell:({row:i})=>Mt(i.original.orderDate)},{header:"ETD / ETA",meta:{sortAccessor:Su},cell:({row:i})=>n.jsxs(Ke,{direction:"vertical",size:0,children:[n.jsxs(Qe,{children:["ETD ",Mt(i.original.etdDate)]}),n.jsxs(Qe,{type:"secondary",children:["ETA ",Mt(i.original.etaDate)]})]})},{header:"Landed EUR",cell:({row:i})=>yr(i.original.landedCostEur)},{header:"Empfehlung",cell:({row:i})=>i.original.recommendationText},{header:"Forecast-Basis",meta:{width:210,minWidth:210},cell:({row:i})=>n.jsxs(Ke,{direction:"vertical",size:0,children:[n.jsx(Qe,{children:i.original.forecastBasisLabel||"—"}),n.jsx(Qe,{type:"secondary",children:hu(i.original.forecastConflictState)})]})},{header:"Status",cell:({row:i})=>Br(i.original.status)},{header:"Aktionen",meta:{width:250,minWidth:250},cell:({row:i})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(je,{size:"small",onClick:()=>{At(i.original.raw)},children:Zt(i.original.status)?"Bearbeiten":"Details"}),n.jsx(je,{size:"small",disabled:!Zt(i.original.status),onClick:()=>{Ve(i.original)},children:"Convert"}),i.original.convertedPoNo?n.jsx(je,{size:"small",onClick:()=>{const f=new URLSearchParams;f.set("source","fo_convert"),f.set("poNo",String(i.original.convertedPoNo||"")),r(`/v2/orders/po?${f.toString()}`)},children:"PO öffnen"}):null,n.jsx(je,{size:"small",danger:!0,disabled:!Zt(i.original.status),onClick:()=>{$t.confirm({title:"FO loeschen?",onOk:async()=>{await p(f=>{const x=mn(f);return x.fos=(Array.isArray(x.fos)?x.fos:[]).filter(S=>String(S.id||"")!==i.original.id),x},"v2:fo:delete")}})},children:"Loeschen"})]})}],[W,r,p,a.pos]),d=Ce.useWatch([],ne),fe=o.useMemo(()=>b&&oe.find(i=>i.id===b)||null,[b,oe]),Ge=o.useMemo(()=>In((d==null?void 0:d.status)||(fe==null?void 0:fe.status)||"DRAFT"),[d==null?void 0:d.status,fe==null?void 0:fe.status]),it=!Zt(Ge),Be=ae.readOnly||it,Rt=String((fe==null?void 0:fe.convertedPoNo)||((l=fe==null?void 0:fe.raw)==null?void 0:l.convertedPoNo)||"").trim(),Xe=o.useMemo(()=>{var f;const i=String((d==null?void 0:d.sku)||"").trim();return i&&((f=ve.get(i))==null?void 0:f.raw)||null},[d==null?void 0:d.sku,ve]),ht=o.useMemo(()=>Tn({state:V,product:Xe||void 0,sku:String((d==null?void 0:d.sku)||""),supplierId:String((d==null?void 0:d.supplierId)||(Xe==null?void 0:Xe.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:d==null?void 0:d.unitPrice,productionLeadTimeDays:d==null?void 0:d.productionLeadTimeDays,logisticsLeadTimeDays:d==null?void 0:d.logisticsLeadTimeDays,dutyRatePct:d==null?void 0:d.dutyRatePct,eustRatePct:d==null?void 0:d.eustRatePct,incoterm:d==null?void 0:d.incoterm,currency:d==null?void 0:d.currency,fxRate:d==null?void 0:d.fxRate}}),[d==null?void 0:d.currency,d==null?void 0:d.dutyRatePct,d==null?void 0:d.eustRatePct,d==null?void 0:d.fxRate,d==null?void 0:d.incoterm,d==null?void 0:d.logisticsLeadTimeDays,d==null?void 0:d.productionLeadTimeDays,d==null?void 0:d.sku,d==null?void 0:d.supplierId,d==null?void 0:d.unitPrice,Xe,V]),mt=o.useMemo(()=>Tn({state:V,product:Xe||void 0,sku:String((d==null?void 0:d.sku)||""),supplierId:String((d==null?void 0:d.supplierId)||(Xe==null?void 0:Xe.supplierId)||""),orderContext:"fo"}),[d==null?void 0:d.sku,d==null?void 0:d.supplierId,Xe,V]),xt=o.useMemo(()=>ir({product:Xe,state:V,supplierId:String((d==null?void 0:d.supplierId)||(Xe==null?void 0:Xe.supplierId)||""),orderContext:"fo",orderOverrides:{unitPrice:d==null?void 0:d.unitPrice,productionLeadTimeDays:d==null?void 0:d.productionLeadTimeDays,logisticsLeadTimeDays:d==null?void 0:d.logisticsLeadTimeDays,dutyRatePct:d==null?void 0:d.dutyRatePct,eustRatePct:d==null?void 0:d.eustRatePct,incoterm:d==null?void 0:d.incoterm}}),[d==null?void 0:d.dutyRatePct,d==null?void 0:d.eustRatePct,d==null?void 0:d.incoterm,d==null?void 0:d.logisticsLeadTimeDays,d==null?void 0:d.productionLeadTimeDays,d==null?void 0:d.supplierId,d==null?void 0:d.unitPrice,Xe,V]);function jt(i){if(i==="unitPrice"){ne.setFieldValue("unitPrice",Dr(Xe));return}if(i==="productionLeadTimeDays"){ne.setFieldValue("productionLeadTimeDays",Number(mt.fields.productionLeadTimeDays.value||0));return}if(i==="logisticsLeadTimeDays"){const f=En(ne.getFieldValue("transportMode"));ne.setFieldValue("logisticsLeadTimeDays",or(Q,f).days);return}if(i==="dutyRatePct"){ne.setFieldValue("dutyRatePct",Number(mt.fields.dutyRatePct.value||0));return}if(i==="eustRatePct"){ne.setFieldValue("eustRatePct",Number(mt.fields.eustRatePct.value||0));return}if(i==="incoterm"){const f=ge.get(String(ne.getFieldValue("supplierId")||""));ne.setFieldValue("incoterm",String((f==null?void 0:f.incotermDefault)||mt.fields.incoterm.value||"EXW").toUpperCase());return}if(i==="currency"){ne.setFieldValue("currency","USD");return}ne.setFieldValue("fxRate",Yn(Q))}function Bt(i,f){const x=String((Xe==null?void 0:Xe.sku)||(d==null?void 0:d.sku)||"").trim();x&&$t.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${x}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{$t.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await p(S=>{const K=mn(S),te=Array.isArray(K.products)?[...K.products]:[],be=te.findIndex(de=>String(de.sku||"").trim().toLowerCase()===x.toLowerCase());if(be<0)return K;const R=te[be];return te[be]={...pi({product:R,field:i,value:f}),updatedAt:xn()},K.products=te,K},"v2:fo:adopt-masterdata"),tn.success("Produkt-Stammdaten aktualisiert.")}})}})}const Gt=o.useMemo(()=>{var x;const i=String((d==null?void 0:d.sku)||"").trim(),f=i&&((x=ve.get(i))==null?void 0:x.raw)||null;return Cu({product:f,settings:Q,transportMode:(d==null?void 0:d.transportMode)||null})},[d==null?void 0:d.sku,d==null?void 0:d.transportMode,ve,Q]),ut=o.useMemo(()=>xr({targetDeliveryDate:d==null?void 0:d.targetDeliveryDate,productionLeadTimeDays:d==null?void 0:d.productionLeadTimeDays,logisticsLeadTimeDays:d==null?void 0:d.logisticsLeadTimeDays,bufferDays:d==null?void 0:d.bufferDays}),[d]),Ft=o.useMemo(()=>{const i=Math.max(0,Number((d==null?void 0:d.units)||0)),f=Math.max(0,Number((d==null?void 0:d.freight)||0));return ar(i*f)},[d==null?void 0:d.freight,d==null?void 0:d.units]),qt=o.useMemo(()=>ba({units:d==null?void 0:d.units,unitPrice:d==null?void 0:d.unitPrice,currency:d==null?void 0:d.currency,freight:Ft,freightCurrency:d==null?void 0:d.freightCurrency,dutyRatePct:d==null?void 0:d.dutyRatePct,eustRatePct:d==null?void 0:d.eustRatePct,fxRate:d==null?void 0:d.fxRate}),[d,Ft]),Ue=o.useMemo(()=>{const i=(d==null?void 0:d.sku)||"";if(!i)return null;const f=Number((d==null?void 0:d.productionLeadTimeDays)||0)+Number((d==null?void 0:d.logisticsLeadTimeDays)||0)+Number((d==null?void 0:d.bufferDays)||0),x=Rr(ke.map(S=>S.raw),i);return Sa({context:Te,sku:i,leadTimeDays:f,product:x,settings:Q,horizonMonths:12,requiredArrivalMonth:d!=null&&d.targetDeliveryDate?String(d.targetDeliveryDate).slice(0,7):null})},[d,ke,Te,Q]),Vt=o.useMemo(()=>fu(Ue==null?void 0:Ue.coverageDemandBreakdown),[Ue==null?void 0:Ue.coverageDemandBreakdown]),pn=o.useMemo(()=>Vt.reduce((i,f)=>i+Number(f.demandUnitsInWindow||0),0),[Vt]),sn=o.useMemo(()=>d?Tr({supplierTerms:Array.isArray(d.paymentTerms)?d.paymentTerms:[],schedule:ut,unitPrice:d.unitPrice,units:d.units,currency:d.currency,freight:Ft,freightCurrency:d.freightCurrency,dutyRatePct:d.dutyRatePct,eustRatePct:d.eustRatePct,fxRate:d.fxRate,incoterm:d.incoterm,vatRefundLagMonths:Q.vatRefundLagMonths,paymentDueDefaults:Q.paymentDueDefaults}).map(f=>{const x=f.currency==="EUR"?Number(f.amount||0):Ks(f.amount,f.currency,d.fxRate);return{id:String(f.id||""),label:String(f.label||""),category:f.category,currency:String(f.currency||"EUR"),amount:Number(f.amount||0),plannedEur:Number.isFinite(x)?x:0,dueDate:f.dueDate?String(f.dueDate):null,triggerEvent:String(f.triggerEvent||"ORDER_DATE"),offsetDays:Number(f.offsetDays||0),offsetMonths:Number(f.offsetMonths||0)}}):[],[d,ut,Ft,Q.paymentDueDefaults,Q.vatRefundLagMonths]),gn=o.useMemo(()=>xa((d==null?void 0:d.paymentTerms)||[]),[d==null?void 0:d.paymentTerms]);o.useEffect(()=>{!P||!ae.readOnly||!ae.remoteDraftPatch||ne.setFieldsValue(ae.remoteDraftPatch)},[ne,ae.readOnly,ae.remoteDraftPatch,ae.remoteDraftVersion,P]);function on(i,f){var ue;const x=ke.find(Se=>vu(Se.raw))||ke[0]||null,S=String((f==null?void 0:f.sku)||(i==null?void 0:i.sku)||(x==null?void 0:x.sku)||""),K=ve.get(S)||x,te=String((f==null?void 0:f.supplierId)||(i==null?void 0:i.supplierId)||(K==null?void 0:K.supplierId)||((ue=Ee[0])==null?void 0:ue.id)||""),be=ge.get(te)||null,R=Number((f==null?void 0:f.units)??(i==null?void 0:i.units)??0),de=Yr({state:V,product:(K==null?void 0:K.raw)||null,supplier:be||null,settings:Q,supplierId:te}),le=jn(i==null?void 0:i.payments,be||void 0),ye=Kt(i==null?void 0:i.units),Pe=Kt(i==null?void 0:i.freight),he=ye!=null&&Pe!=null?ar(Pe/ye):null;return{id:i!=null&&i.id?String(i.id):void 0,sku:S,supplierId:te,status:In((i==null?void 0:i.status)||(f==null?void 0:f.status)||"DRAFT"),targetDeliveryDate:String((f==null?void 0:f.targetDeliveryDate)||(i==null?void 0:i.targetDeliveryDate)||new Date().toISOString().slice(0,10)),units:R,transportMode:En((i==null?void 0:i.transportMode)||de.transportMode||"RAIL"),incoterm:String((i==null?void 0:i.incoterm)||de.incoterm||"EXW").toUpperCase(),unitPrice:Number((i==null?void 0:i.unitPrice)??de.unitPrice??0),currency:String((i==null?void 0:i.currency)||de.currency||"USD").toUpperCase(),freight:Number(he??(f==null?void 0:f.freight)??de.freight??0),freightCurrency:"EUR",dutyRatePct:Number((i==null?void 0:i.dutyRatePct)??de.dutyRatePct??0),eustRatePct:Number((i==null?void 0:i.eustRatePct)??de.eustRatePct??0),fxRate:Number((i==null?void 0:i.fxRate)??de.fxRate??Yn(Q)),productionLeadTimeDays:Number((i==null?void 0:i.productionLeadTimeDays)??de.productionLeadTimeDays??45),logisticsLeadTimeDays:Number((i==null?void 0:i.logisticsLeadTimeDays)??de.logisticsLeadTimeDays??45),bufferDays:Number((i==null?void 0:i.bufferDays)??de.bufferDays??Q.defaultBufferDays??0),paymentTerms:le}}function vn(i,f){const x=String(i||"").trim();if(!x)return;const S=ve.get(x)||null;if(!S)return;const K=ne.getFieldsValue(),te=String(S.supplierId||K.supplierId||""),be=ge.get(te)||null,R=Yr({state:V,product:S.raw,supplier:be||null,settings:Q,supplierId:te,transportMode:"RAIL",units:Number(K.units??0)});ne.setFieldsValue({supplierId:te||K.supplierId,transportMode:R.transportMode,incoterm:R.incoterm,unitPrice:Dr(S.raw),currency:R.currency,freight:R.freight,freightCurrency:"EUR",dutyRatePct:R.dutyRatePct,eustRatePct:R.eustRatePct,fxRate:Yn(Q),productionLeadTimeDays:R.productionLeadTimeDays,logisticsLeadTimeDays:R.logisticsLeadTimeDays,bufferDays:R.bufferDays,paymentTerms:jn([],be||void 0)})}function yn(i){var le;const f=String(i||"").trim(),x=ne.getFieldsValue(),S=String(x.sku||"").trim(),K=S&&((le=ve.get(S))==null?void 0:le.raw)||null,te=ge.get(f)||null,be=En(x.transportMode||"RAIL"),R=Yr({state:V,product:K,supplier:te||null,settings:Q,supplierId:f,transportMode:be,units:Number(x.units||0)}),de=Kt(te==null?void 0:te.productionLeadTimeDaysDefault);ne.setFieldsValue({supplierId:f,incoterm:String((te==null?void 0:te.incotermDefault)||R.incoterm||x.incoterm||"EXW").toUpperCase(),productionLeadTimeDays:Number(de??R.productionLeadTimeDays??x.productionLeadTimeDays??0),logisticsLeadTimeDays:or(Q,be).days,paymentTerms:jn([],te||void 0),unitPrice:Dr(K),currency:"USD",fxRate:Yn(Q),freight:R.freight,freightCurrency:"EUR"})}function zt(i,f){N(null),f!=null&&f.preserveReturnContext||w(null);const x=on(null,i);ne.setFieldsValue({...x,...i||{}}),T(!0)}function At(i,f){N(String(i.id||"")),f!=null&&f.preserveReturnContext||w(null),ne.setFieldsValue(on(i)),T(!0)}function ln(){if(Oe.length<2){tn.warning("Bitte mindestens 2 aktive FOs fuer den Merge auswaehlen.");return}const f=Ze||"";k(Na(Array.isArray(a.pos)?a.pos:[])),C(""),A("earliest"),U(f),X(!1),re(!0)}async function Lt(i){var De;if(ae.readOnly)throw new Error("Dieser FO wird gerade von einem anderen Nutzer bearbeitet.");const f=String(i.sku||"").trim(),x=f?Rr(ke.map(He=>He.raw),f):null,S=String((x==null?void 0:x.supplierId)||"").trim(),K=String(i.supplierId||S||"").trim();if(!K)throw new Error("Supplier ist erforderlich.");if(!x&&!i.supplierId)throw new Error("SKU nicht gefunden. Bitte Produkt prüfen.");const te=b&&((De=oe.find(He=>He.id===b))==null?void 0:De.raw)||null,be=In((te==null?void 0:te.status)||"DRAFT"),R=In(i.status||be||"DRAFT");let de=R;te&&!Zt(be)?de=be:Zt(R)||(de=te?be:"DRAFT");const le={...i,supplierId:K,status:de},ye=ir({product:x,state:V,supplierId:K,orderContext:"fo",orderOverrides:{unitPrice:le.unitPrice,productionLeadTimeDays:le.productionLeadTimeDays,logisticsLeadTimeDays:le.logisticsLeadTimeDays,dutyRatePct:le.dutyRatePct,eustRatePct:le.eustRatePct,incoterm:le.incoterm}});if(ye.blocked)throw new Error(`Blockierende Stammdaten fehlen: ${ye.issues.map(He=>He.label).join(", ")}`);const Pe=(i.paymentTerms||[]).map(He=>({id:He.id,label:String(He.label||"Milestone"),percent:Number(He.percent||0),triggerEvent:String(He.triggerEvent||"ORDER_DATE").toUpperCase(),offsetDays:Number(He.offsetDays||0),offsetMonths:Number(He.offsetMonths||0)})),he=xa(Pe);if(Math.abs(he-100)>.01)throw new Error("Supplier Payment Terms muessen in Summe 100% ergeben.");const ue=xr({targetDeliveryDate:le.targetDeliveryDate,productionLeadTimeDays:le.productionLeadTimeDays,logisticsLeadTimeDays:le.logisticsLeadTimeDays,bufferDays:le.bufferDays}),Se=Math.max(0,Number(le.freight||0)),Re=ar(Se*Math.max(0,Number(le.units||0))),ze=Qs({existing:te,supplierTerms:Pe,values:{...le,freight:Re,freightCurrency:"EUR",forecastBasisVersionId:(Ne==null?void 0:Ne.id)||null,forecastBasisVersionName:(Ne==null?void 0:Ne.name)||null,forecastBasisSetAt:xn()},schedule:ue,vatRefundLagMonths:Q.vatRefundLagMonths,paymentDueDefaults:Q.paymentDueDefaults});await p(He=>{const dt=mn(He),vt=Array.isArray(dt.fos)?[...dt.fos]:[],Dt={...ze},rn=vt.findIndex(Jt=>String(Jt.id||"")===String(Dt.id||""));if(rn>=0)vt[rn]=Dt;else{if(!String(Dt.foNo||"").trim()||!String(Dt.foNumber||"").trim()){const Jt=Js(vt,Dt.createdAt||Dt.updatedAt||xn());String(Dt.foNo||"").trim()||(Dt.foNo=Jt.foNo),String(Dt.foNumber||"").trim()||(Dt.foNumber=Jt.foNumber)}vt.push(Dt)}return dt.fos=vt,dt},b?"v2:fo:update":"v2:fo:create"),ae.clearDraft(),T(!1),N(null),w(null),ne.resetFields()}async function bn(){const i=j;if(!i)return;const f=String(z||"").trim();if(!f)throw new Error("PO Nummer ist erforderlich.");await p(x=>{var Se,Re;const S=mn(x),K=Array.isArray(S.pos)?[...S.pos]:[],te=Array.isArray(S.fos)?[...S.fos]:[];if(K.some(ze=>String(ze.poNo||"")===f))throw new Error(`PO Nummer ${f} existiert bereits.`);const be=te.findIndex(ze=>String(ze.id||"")===i);if(be<0)throw new Error("FO nicht gefunden.");const R={...te[be]};if(!Zt(R.status))throw new Error("Nur aktive FOs (Draft/Active) koennen konvertiert werden.");const de=eo({fo:R,poNumber:f,orderDateOverride:q||String(R.orderDate||"")});K.push(de);const ye=new Map((Array.isArray(S.suppliers)?S.suppliers:[]).map(ze=>ze).map(ze=>[String(ze.id||""),ze])).get(String(R.supplierId||""))||null,Pe=jn(R.payments,ye||void 0),he=Kn({orderDate:q||R.orderDate,productionLeadTimeDays:R.productionLeadTimeDays,logisticsLeadTimeDays:R.logisticsLeadTimeDays,bufferDays:R.bufferDays,deliveryDate:R.targetDeliveryDate}),ue=Tr({supplierTerms:Pe,schedule:he,unitPrice:R.unitPrice,units:R.units,currency:R.currency,freight:R.freight,freightCurrency:R.freightCurrency,dutyRatePct:R.dutyRatePct,eustRatePct:R.eustRatePct,fxRate:R.fxRate,incoterm:R.incoterm,vatRefundLagMonths:(Se=S.settings)==null?void 0:Se.vatRefundLagMonths,paymentDueDefaults:(Re=S.settings)==null?void 0:Re.paymentDueDefaults});return te[be]={...R,...he,payments:ue,status:"CONVERTED",convertedPoId:de.id,convertedPoNo:de.poNo,updatedAt:xn()},S.pos=K,S.fos=te,S},"v2:fo:convert"),E(!1),B(null),_(x=>x.filter(S=>S!==i)),tn.success(`FO wurde in PO ${f} konvertiert.`)}async function un(){const i=Oe;if(i.length<2)throw new Error("Bitte mindestens 2 FOs auswaehlen.");if(ct)throw new Error("Merge ist nur mit gleichem Lieferanten erlaubt.");if(qe&&!L)throw new Error("Bitte gemischte Transport/Incoterm explizit bestaetigen.");const f=String($||"").trim();if(!f)throw new Error("PO Nummer ist erforderlich.");const x=$e;if(M==="manual"&&!x)throw new Error("Bitte ein manuelles Ziel-Lieferdatum setzen.");await p(S=>{var ue;const K=mn(S),te=Array.isArray(K.pos)?[...K.pos]:[],be=Array.isArray(K.fos)?[...K.fos]:[];if(te.some(Se=>String(Se.poNo||"")===f))throw new Error(`PO Nummer ${f} existiert bereits.`);const R=i.map(Se=>String(Se.id||"")),de=be.filter(Se=>R.includes(String(Se.id||""))).map(Se=>({...Se}));if(de.length!==i.length)throw new Error("Nicht alle ausgewaehlten FOs konnten geladen werden.");if(de.some(Se=>!Zt(Se.status)))throw new Error("Enthaelt bereits konvertierte oder archivierte FOs.");const le=to({fos:de,poNumber:f,orderDateOverride:g||null,targetDeliveryDate:x});te.push(le);const ye=new Map((Array.isArray(K.suppliers)?K.suppliers:[]).map(Se=>Se).map(Se=>[String(Se.id||""),Se])),Pe=(ue=K.settings)==null?void 0:ue.vatRefundLagMonths,he=be.map(Se=>{var Dt;const Re=Se,ze=String(Re.id||"");if(!R.includes(ze))return Re;const De=ye.get(String(Re.supplierId||""))||null,He=jn(Re.payments,De||void 0),dt=Kn({orderDate:g||le.orderDate||Re.orderDate,productionLeadTimeDays:Re.productionLeadTimeDays,logisticsLeadTimeDays:Re.logisticsLeadTimeDays,bufferDays:Re.bufferDays,deliveryDate:x||Re.targetDeliveryDate}),vt=Tr({supplierTerms:He,schedule:dt,unitPrice:Re.unitPrice,units:Re.units,currency:Re.currency,freight:Re.freight,freightCurrency:Re.freightCurrency,dutyRatePct:Re.dutyRatePct,eustRatePct:Re.eustRatePct,fxRate:Re.fxRate,incoterm:Re.incoterm,vatRefundLagMonths:Pe,paymentDueDefaults:(Dt=K.settings)==null?void 0:Dt.paymentDueDefaults});return{...Re,...dt,payments:vt,status:"CONVERTED",convertedPoId:le.id,convertedPoNo:le.poNo,updatedAt:xn()}});return K.pos=te,K.fos=he,K},"v2:fo:merge-convert"),re(!1),_([]),X(!1),C(""),U(""),k(""),A("earliest"),tn.success(`FO-Merge erstellt PO ${f}.`)}return o.useEffect(()=>{const i=new URLSearchParams(t.search),f=i.get("source"),x=yu(i.get("returnTo")),S=String(i.get("returnSku")||"").trim()||null,K=()=>{if(!x){w(null);return}w({path:x,sku:S})},te=Pe=>{const he=new URLSearchParams(t.search);Pe.forEach(Se=>he.delete(Se));const ue=he.toString();r({pathname:t.pathname,search:ue?`?${ue}`:""},{replace:!0})};if(f==="orders_sku"){const Pe=String(i.get("foId")||"").trim();if(Pe){const he=(Array.isArray(a.fos)?a.fos:[]).map(ue=>ue).find(ue=>String(ue.id||"")===Pe);he&&(K(),At(he,{preserveReturnContext:!0}))}te(["source","foId","returnTo","returnSku"]);return}if(f==="phantom_fo"){const Pe=String(i.get("sku")||"").trim();if(!Pe){te(["source","phantomId","sku","month","suggestedUnits","requiredArrivalDate","recommendedOrderDate","firstRiskMonth","orderMonth","leadTimeDays","returnTo","returnSku"]);return}const he=ve.get(Pe)||null,ue=Math.max(0,Math.round(Number(i.get("suggestedUnits")||0))),Se=String(i.get("requiredArrivalDate")||""),Re={sku:Pe,units:ue,status:"ACTIVE"};he!=null&&he.supplierId&&(Re.supplierId=String(he.supplierId)),Se&&(Re.targetDeliveryDate=Se),K(),zt(Re,{preserveReturnContext:!0}),tn.info("Phantom-FO geladen. Bitte Daten prüfen, bei Bedarf anpassen und speichern."),te(["source","phantomId","sku","month","suggestedUnits","requiredArrivalDate","recommendedOrderDate","firstRiskMonth","orderMonth","leadTimeDays","returnTo","returnSku"]);return}if(f!=="inventory_projection")return;const be=String(i.get("sku")||"").trim();if(!be){te(["source","returnTo","returnSku"]);return}const R=ve.get(be)||null,de=Math.max(0,Math.round(Number(i.get("suggestedUnits")||0))),le=String(i.get("requiredArrivalDate")||""),ye={sku:be,units:de,status:"ACTIVE"};R!=null&&R.supplierId&&(ye.supplierId=String(R.supplierId)),le&&(ye.targetDeliveryDate=le),K(),zt(ye,{preserveReturnContext:!0}),te(["source","sku","month","suggestedUnits","projectedEnd","mode","requiredArrivalDate","recommendedOrderDate","returnTo","nextSku","nextMonth","nextSuggestedUnits","nextRequiredArrivalDate","nextRecommendedOrderDate","returnTo","returnSku"])},[t.pathname,t.search,r,ve,a.fos]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(Et,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(mu,{level:3,children:"Forecast Orders"}),n.jsx(du,{children:"FO ist ein Planobjekt je SKU (inkl. Plan-Meilensteinen). Zahlungen werden erst nach PO-Conversion im PO-Flow bestätigt."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(je,{type:"primary",onClick:()=>zt(),children:"Create FO"}),n.jsx(la,{value:se,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:i=>Me(String(i)==="timeline"?"timeline":"table")}),u?n.jsx(ft,{color:"processing",children:"Speichern..."}):null,m?n.jsxs(ft,{color:"green",children:["Gespeichert: ",new Date(m).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(kt,{type:"error",showIcon:!0,message:c}):null,s?n.jsx(kt,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(Et,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(yt,{placeholder:"Alias, SKU, Supplier",value:h,onChange:i=>y(i.target.value),style:{width:280}}),n.jsx(Ct,{value:D,onChange:i=>I(i),options:[{value:"ALL",label:"Alle Status"},...qs.map(i=>({value:i,label:i}))],style:{width:190}}),n.jsx(je,{onClick:ln,disabled:Oe.length<2,children:"Create PO from FOs"}),n.jsxs(ft,{children:[Oe.length," ausgewählt"]})]}),se==="table"?n.jsx(di,{data:oe,columns:Ie,minTableWidth:1400,tableLayout:"auto"}):n.jsx(cs,{className:"v2-orders-gantt--fo",groups:pe.groups,items:pe.items,visibleStartMs:H.visibleStartMs,visibleEndMs:H.visibleEndMs,sidebarWidth:340,lineHeight:72,sidebarHeaderLabel:"FO / Produkt",emptyMessage:"Keine Forecast Orders für die aktuelle Suche/Filter.",onItemSelect:i=>{const f=pe.itemRowMap.get(i);f&&At(f.raw)}})]}),n.jsxs($t,{title:b?"FO bearbeiten":"FO anlegen",open:P,width:1120,onCancel:()=>{ae.clearDraft(),T(!1),w(null)},onOk:()=>{if(Be){if(it&&!ae.readOnly){$t.info({title:"Read-only FO",content:"Konvertierte oder archivierte FOs sind schreibgeschuetzt. Bitte ueber PO weiterarbeiten."});return}$t.warning({title:"Nur Lesemodus",content:`${ae.remoteUserLabel||"Kollege"} bearbeitet diesen FO. Bitte Bearbeitung übernehmen oder warten.`});return}ne.validateFields().then(i=>Lt(i)).catch(()=>{})},children:[ae.banner?n.jsx(kt,{style:{marginBottom:10},type:ae.banner.tone,showIcon:!0,message:ae.banner.text,action:ae.readOnly?n.jsx(je,{size:"small",onClick:ae.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,ae.readOnly&&ae.remoteDraftVersion>0?n.jsxs(ft,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",ae.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,n.jsxs(Ke,{style:{width:"100%",marginBottom:10},wrap:!0,children:[n.jsx(Qe,{type:"secondary",children:"Status:"}),Br(Ge),Zt(Ge)?n.jsx(je,{size:"small",disabled:Be,onClick:()=>ne.setFieldValue("status",pu(Ge)),children:Ge==="ACTIVE"?"Als Draft markieren":"Als Active markieren"}):n.jsx(ft,{color:"default",children:"Read-only"}),Rt?n.jsx(je,{size:"small",onClick:()=>{const i=new URLSearchParams;i.set("source","fo_convert"),i.set("poNo",Rt),r(`/v2/orders/po?${i.toString()}`)},children:"Zugehoerige PO oeffnen"}):null,J?n.jsx(je,{size:"small",onClick:()=>{const i=new URLSearchParams;J.sku&&i.set("sku",J.sku);const f=i.toString();r({pathname:J.path,search:f?`?${f}`:""})},children:"Zurueck zur SKU Planung"}):null]}),n.jsxs(Ce,{name:"v2-fo-modal",form:ne,layout:"vertical",disabled:Be,onValuesChange:i=>{Be||ae.publishDraftPatch(i)},children:[n.jsx(Ce.Item,{name:"id",hidden:!0,children:n.jsx(yt,{})}),n.jsx(Ce.Item,{name:"status",hidden:!0,children:n.jsx(yt,{})}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"sku",label:"Produkt (SKU)",style:{minWidth:230,flex:1},rules:[{required:!0,message:"SKU ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:ke.map(i=>({value:i.sku,label:`${i.alias} (${i.sku})`})),onChange:i=>{vn(String(i||""))}})}),n.jsx(Ce.Item,{name:"supplierId",label:"Supplier",style:{minWidth:230,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:Ee.map(i=>({value:i.id,label:i.name})),onChange:i=>{yn(String(i||""))}})})]}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"units",label:"Units",style:{width:130},rules:[{required:!0,message:"Units sind erforderlich."}],children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(Ce.Item,{name:"targetDeliveryDate",label:"Target Delivery",style:{width:190},rules:[{required:!0,message:"Zieltermin ist erforderlich."}],children:n.jsx(yt,{type:"date"})}),n.jsx(Ce.Item,{name:"transportMode",label:"Transport",style:{width:140},children:n.jsx(Ct,{options:Vs.map(i=>({value:i,label:i})),onChange:i=>{const f=En(i);ne.setFieldsValue({transportMode:f,logisticsLeadTimeDays:or(Q,f).days})}})}),n.jsx(Ce.Item,{name:"incoterm",label:"Incoterm",style:{width:130},children:n.jsx(Ct,{options:Zs.map(i=>({value:i,label:i}))})}),n.jsx(Ce.Item,{name:"currency",label:"Currency",style:{width:130},children:n.jsx(Ct,{options:Gs.map(i=>({value:i,label:i}))})}),n.jsx(Ce.Item,{name:"fxRate",label:"FX Rate",style:{width:140},children:n.jsx(bt,{mode:"fx",min:0})})]}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"unitPrice",label:"Unit Price (USD/Stück)",style:{width:190},children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{name:"freight",label:"Shipping costs (EUR/Stück)",style:{width:210},children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{name:"freightCurrency",label:"Shipping Currency",style:{width:160},children:n.jsx(Ct,{disabled:!0,options:[{value:"EUR",label:"EUR"}]})}),n.jsx(Ce.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(bt,{mode:"percent",min:0,max:100})}),n.jsx(Ce.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(bt,{mode:"percent",min:0,max:100})})]}),n.jsx("div",{style:{marginTop:-6,marginBottom:10},children:n.jsxs(Qe,{type:"secondary",children:["Shipping total: ",yr(Ft)," (",pt((d==null?void 0:d.units)||0,0)," x ",pt((d==null?void 0:d.freight)||0,2)," EUR/Stück)"]})}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"productionLeadTimeDays",label:"Production Lead Days",style:{width:220},children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(Ce.Item,{name:"logisticsLeadTimeDays",label:"Logistics Lead Days",style:{width:220},children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(Ce.Item,{name:"bufferDays",label:"Buffer Days",style:{width:180},children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(je,{disabled:Be,onClick:()=>{const i=ne.getFieldsValue(),f=ge.get(String(i.supplierId||"")),x=jn([],f||void 0);ne.setFieldsValue({incoterm:String((f==null?void 0:f.incotermDefault)||i.incoterm||"EXW").toUpperCase(),currency:"USD",fxRate:Yn(Q),paymentTerms:x})},children:"Supplier Terms"})]}),n.jsx("div",{style:{marginTop:-2,marginBottom:10},children:n.jsxs(Qe,{type:"secondary",children:["Quelle Leadtime: Produktion = ",Gt.production," · Logistik = ",Gt.logistics]})}),xt.blocked?n.jsx(kt,{type:"error",showIcon:!0,style:{marginBottom:12},message:"Blockierende Stammdaten fehlen",description:xt.issues.map(i=>i.label).join(", ")}):null,n.jsx(Et,{size:"small",style:{marginBottom:12},children:n.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(Qe,{strong:!0,children:"Stammdaten-Herkunft (FO)"}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Price"}),n.jsx("span",{className:Qt(ht.fields.unitPriceUsd.source,!0),children:ht.fields.unitPriceUsd.label}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("unitPrice"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("unitPriceUsd",d==null?void 0:d.unitPrice),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Production Lead"}),n.jsx("span",{className:Qt(ht.fields.productionLeadTimeDays.source,!0),children:ht.fields.productionLeadTimeDays.label}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("productionLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("productionLeadTimeDays",d==null?void 0:d.productionLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Logistics Lead"}),n.jsx("span",{className:Qt(ht.fields.transitDays.source,!1),children:ht.fields.transitDays.label}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("logisticsLeadTimeDays"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("transitDays",d==null?void 0:d.logisticsLeadTimeDays),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Qt(ht.fields.dutyRatePct.source,!1),children:ht.fields.dutyRatePct.label}),n.jsx("span",{className:Qt(ht.fields.eustRatePct.source,!1),children:ht.fields.eustRatePct.label}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("dutyRatePct"),children:"Duty reset"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("eustRatePct"),children:"EUSt reset"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("dutyRatePct",d==null?void 0:d.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("eustRatePct",d==null?void 0:d.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Incoterm"}),n.jsx("span",{className:Qt(ht.fields.incoterm.source,!0),children:ht.fields.incoterm.label}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>jt("incoterm"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",disabled:Be,onClick:()=>Bt("ddp",String((d==null?void 0:d.incoterm)||"").toUpperCase()==="DDP"),children:"Als Produktwert uebernehmen"})]})]})}),n.jsx(Et,{size:"small",style:{marginBottom:12},children:n.jsxs(Ke,{direction:"vertical",size:4,children:[n.jsx(Qe,{strong:!0,children:"Schedule Preview"}),n.jsxs(Qe,{children:["Order Date: ",Mt(ut.orderDate)]}),n.jsxs(Qe,{children:["Production End: ",Mt(ut.productionEndDate)]}),n.jsxs(Qe,{children:["ETD: ",Mt(ut.etdDate)]}),n.jsxs(Qe,{children:["ETA: ",Mt(ut.etaDate)]}),n.jsxs(Qe,{children:["Landed Cost: ",yr(qt.landedCostEur)]})]})}),n.jsx(Et,{size:"small",style:{marginBottom:12},children:n.jsxs(Ke,{direction:"vertical",size:4,children:[n.jsx(Qe,{strong:!0,children:"FO Empfehlung"}),Te.baselineMonth?null:n.jsx(Qe,{type:"secondary",children:"Kein Inventory Snapshot vorhanden."}),Ue?n.jsxs(n.Fragment,{children:[n.jsxs(Qe,{children:["Baseline: ",String(Ue.baselineMonth||"—")]}),n.jsxs(Qe,{children:["Status: ",String(Ue.status||"—")]}),n.jsx(Qe,{type:"secondary",children:"Empfehlung basiert auf Forecast + Coverage DOH + MOQ + Karton-Logik."}),n.jsxs(Qe,{children:["Reichweite-Bedarf (",pt(Ue.coverageDaysForOrder,0)," Tage): ",pt(Ue.coverageDemandUnits,0)]}),Vt.length?n.jsx("div",{className:"v2-fo-breakdown-wrap",children:n.jsxs("table",{className:"v2-fo-breakdown-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Monat"}),n.jsx("th",{children:"Tage im Fenster"}),n.jsx("th",{children:"Forecast Monat"}),n.jsx("th",{children:"Beitrags-Units"})]})}),n.jsxs("tbody",{children:[Vt.map(i=>n.jsxs("tr",{children:[n.jsx("td",{children:i.month}),n.jsx("td",{children:pt(i.daysCovered,0)}),n.jsxs("td",{children:[i.forecastMonthUnits==null?"—":pt(i.forecastMonthUnits,0),i.usedFallback?n.jsx("span",{className:"v2-fo-breakdown-flag",children:" (Fallback)"}):null]}),n.jsx("td",{children:pt(i.demandUnitsInWindow,0)})]},`${i.month}-${i.daysCovered}`)),n.jsxs("tr",{className:"is-total",children:[n.jsx("td",{children:"Summe"}),n.jsx("td",{children:pt(Ue.coverageDaysForOrder,0)}),n.jsx("td",{children:"—"}),n.jsx("td",{children:pt(pn,0)})]})]})]})}):null,n.jsxs(Qe,{children:["Rohwert (aufgerundet): ",pt(Ue.recommendedUnitsRaw,0)]}),n.jsxs(Qe,{children:["Empfohlene Units: ",pt(Ue.recommendedUnits,0)]}),Ue.moqApplied?n.jsxs(Qe,{type:"warning",children:["MOQ-Aufrundung: ",pt(Ue.recommendedUnitsRaw,0)," → ",pt(Ue.unitsAfterMoq,0)]}):null,Number(Ue.unitsPerCarton||0)>1?n.jsxs(Qe,{type:"secondary",children:["Kartonbasis: ",pt(Ue.unitsPerCarton,0)," Units/Karton",Number(Ue.recommendedCartons||0)>0?` · ${pt(Ue.recommendedCartons,0)} Kartons`:""]}):null,Ue.cartonRoundingApplied?n.jsxs(Qe,{type:"secondary",children:["Karton-Aufrundung: ",pt(Ue.unitsAfterMoq,0)," → ",pt(Ue.unitsAfterCartonRounding,0)]}):null,Ue.blockRoundupApplied?n.jsxs(Qe,{type:"warning",children:["Block-Roundup (",pt(Ue.roundupCartonBlock,0)," Kartons, max ",pt(Ue.roundupMaxPct,2),"%):"," ",pt(Ue.unitsAfterCartonRounding,0)," → ",pt(Ue.recommendedUnits,0)]}):null,n.jsxs(Qe,{children:["Arrival: ",Mt(Ue.requiredArrivalDate)]}),n.jsxs(Qe,{children:["Order: ",Mt(Ue.orderDateAdjusted||Ue.orderDate)]})]}):n.jsx(Qe,{type:"secondary",children:"Bitte SKU waehlen."})]})}),n.jsxs(Et,{size:"small",children:[n.jsxs(Ke,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(Qe,{strong:!0,children:"Supplier Payment Terms"}),n.jsxs(Qe,{type:Math.abs(gn-100)<=.01?"secondary":"danger",children:["Summe: ",pt(gn,2),"%"]})]}),n.jsx(Ce.List,{name:"paymentTerms",children:(i,{add:f,remove:x})=>n.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%"},children:[i.map(S=>n.jsxs(Ke,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(Ce.Item,{...S,name:[S.name,"label"],style:{flex:2,minWidth:220},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(yt,{placeholder:"Label"})}),n.jsx(Ce.Item,{...S,name:[S.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(bt,{mode:"percent",min:0,max:100})}),n.jsx(Ce.Item,{...S,name:[S.name,"triggerEvent"],style:{width:170},rules:[{required:!0,message:"Trigger fehlt."}],children:n.jsx(Ct,{options:Xs.map(K=>({value:K,label:K}))})}),n.jsx(Ce.Item,{...S,name:[S.name,"offsetDays"],style:{width:110},children:n.jsx(bt,{mode:"int"})}),n.jsx(je,{danger:!0,disabled:Be,onClick:()=>x(S.name),children:"X"})]},S.key)),n.jsxs(Ke,{children:[n.jsx(je,{disabled:Be,onClick:()=>f({label:"Milestone",percent:0,triggerEvent:"ORDER_DATE",offsetDays:0,offsetMonths:0}),children:"Milestone"}),n.jsx(je,{disabled:Be,onClick:()=>{const S=String(ne.getFieldValue("supplierId")||""),K=ge.get(S)||null;ne.setFieldsValue({paymentTerms:jn([],K||void 0)})},children:"Terms laden"})]})]})}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx(Qe,{strong:!0,children:"Zahlungsfaelligkeiten (Plan)"}),n.jsx(kt,{type:"info",showIcon:!0,style:{marginTop:8},message:"FOs erzeugen nur Plan-Meilensteine. Zahlungen werden ausschließlich in POs bestätigt."}),n.jsx(lr,{style:{marginTop:8},children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Label"}),n.jsx("th",{children:"Soll"}),n.jsx("th",{children:"Waehrung"}),n.jsx("th",{children:"Fällig"}),n.jsx("th",{children:"Regel"})]})}),n.jsx("tbody",{children:sn.length?sn.map(i=>n.jsxs("tr",{children:[n.jsx("td",{children:gu(i.category)}),n.jsx("td",{children:i.label}),n.jsx("td",{children:yr(i.plannedEur)}),n.jsx("td",{children:i.currency}),n.jsx("td",{children:Mt(i.dueDate)}),n.jsx("td",{children:`${i.triggerEvent} + ${pt(i.offsetDays,0)}d + ${pt(i.offsetMonths,0)}m`})]},i.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Keine Zahlungszeilen."})})})]})})]})]})]})]}),n.jsx($t,{title:"Einzel-FO in PO konvertieren",open:O,onCancel:()=>E(!1),onOk:()=>{bn().catch(i=>{$t.error({title:"Konvertierung fehlgeschlagen",content:i instanceof Error?i.message:String(i)})})},children:n.jsxs(Ke,{direction:"vertical",style:{width:"100%"},children:[n.jsx(Qe,{children:"PO Nummer"}),n.jsx(yt,{value:z,onChange:i=>F(i.target.value)}),n.jsx(Qe,{children:"Order Date (optional)"}),n.jsx(yt,{type:"date",value:q,onChange:i=>ee(i.target.value)})]})}),n.jsx($t,{title:"Mehrere FOs zu einer PO bündeln",open:Z,width:960,onCancel:()=>re(!1),onOk:()=>{un().catch(i=>{$t.error({title:"Merge fehlgeschlagen",content:i instanceof Error?i.message:String(i)})})},children:n.jsxs(Ke,{direction:"vertical",style:{width:"100%"},size:12,children:[n.jsxs(Qe,{type:"secondary",children:[Oe.length," FO(s) ausgewählt. Ergebnis ist eine Multi-SKU-PO mit PO-basierten Zahlungsmeilensteinen."]}),n.jsxs(Ke,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Qe,{children:"PO Nummer"}),n.jsx(yt,{value:$,onChange:i=>k(i.target.value)})]}),n.jsxs("div",{style:{minWidth:220,flex:1},children:[n.jsx(Qe,{children:"Order Date (optional)"}),n.jsx(yt,{type:"date",value:g,onChange:i=>C(i.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(Qe,{strong:!0,children:"Ziel-Liefertermin der PO"}),n.jsxs(Ke,{direction:"vertical",style:{marginTop:6,width:"100%"},children:[n.jsxs(en,{checked:M==="earliest",onChange:i=>A(i.target.checked?"earliest":"manual"),children:["Frühester FO-Zieltermin verwenden (",Mt(Ze||null),")"]}),n.jsx(en,{checked:M==="manual",onChange:i=>A(i.target.checked?"manual":"earliest"),children:"Manuelles Ziel setzen"}),M==="manual"?n.jsx(yt,{type:"date",value:Y,onChange:i=>U(i.target.value),style:{maxWidth:240}}):null]})]}),ct?n.jsx(kt,{type:"error",showIcon:!0,message:"FO-Merge nur bei gleichem Lieferanten erlaubt."}):null,qe?n.jsx(kt,{type:"warning",showIcon:!0,message:"Gemischte Incoterms/Transportmodi erkannt.",description:n.jsxs("div",{children:[n.jsxs("div",{children:["Incoterms: ",G.join(", ")||"—"]}),n.jsxs("div",{children:["Transport: ",lt.join(", ")||"—"]}),n.jsx(en,{checked:L,onChange:i=>X(i.target.checked),style:{marginTop:8},children:"Ich habe den Mix geprüft und möchte trotzdem bündeln."})]})}):null,n.jsx(lr,{children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"FO"}),n.jsx("th",{children:"SKU"}),n.jsx("th",{children:"Units"}),n.jsx("th",{children:"FO Ziel"}),n.jsx("th",{children:"Abweichung zur PO"})]})}),n.jsx("tbody",{children:Oe.length?Oe.map(i=>{const f=zr(i),x=Je.find(S=>S.id===String(i.id||""));return n.jsxs("tr",{children:[n.jsx("td",{children:Ea({foNo:i.foNo,foNumber:i.foNumber,id:i.id})}),n.jsx("td",{children:String(i.sku||"—")}),n.jsx("td",{children:pt(i.units,0)}),n.jsx("td",{children:Mt(f)}),n.jsx("td",{children:x?x.status<0?n.jsx(ft,{color:"red",children:x.deviation}):x.status>0?n.jsx(ft,{color:"gold",children:x.deviation}):n.jsx(ft,{color:"green",children:x.deviation}):"—"})]},String(i.id||""))}):n.jsx("tr",{children:n.jsx("td",{colSpan:5,children:"Keine FOs gewählt."})})})]})})]})})]})}const{Paragraph:ku,Text:rt,Title:Pu}=Rn,Wr={slug:"po",entityLabel:"PO",numberField:"poNo"},ds=24*60*60*1e3;function Un(e){if(!e)return null;const t=String(e||"").trim(),[r,a,s]=t.split("-").map(Number);if(!r||!a||!s)return null;const u=new Date(Date.UTC(r,a-1,s));return Number.isNaN(u.getTime())?null:u}function wu(e){const t=String(e||"").trim();return!t||!/^\d{4}-\d{2}-\d{2}$/.test(t)?null:t}function ju(e){const t=String(e||"").trim();return!t||!t.startsWith("/v2/")?null:t}function Nu(e){return wu(e==null?void 0:e.etaDate)||"9999-12-31"}function _n(e,t){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return 0;const a=(Math.min(Math.max(e.getTime(),t.startMs),t.endMs)-t.startMs)/ds;return Math.max(0,Math.min(100,a/t.totalDays*100))}function Iu(e){const t=e.state.settings||{},r=fi(t.startMonth);if(r)return r;const a=e.rows.map(s=>s.orderDate).filter(s=>!!(s&&/^\d{4}-\d{2}-\d{2}$/.test(s))).sort()[0];return a?a.slice(0,7):new Date().toISOString().slice(0,7)}function Eu(e){const t=e.settings||{},r=Number(t.horizonMonths||0);return!Number.isFinite(r)||r<=0?12:Math.round(r)}function Nt(e){if(!e)return"—";const[t,r,a]=String(e).split("-").map(Number);if(!t||!r||!a)return"—";const s=new Date(Date.UTC(t,r-1,a));return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})}function er(e,t=0){const r=Number(e);return Number.isFinite(r)?r.toLocaleString("de-DE",{minimumFractionDigits:t,maximumFractionDigits:t}):"—"}function an(e){const t=Number(e);return Number.isFinite(t)?t.toLocaleString("de-DE",{style:"currency",currency:"EUR"}):"—"}function Ta(e){return String(e||"").slice(-6).toUpperCase()}function Ru(e){return e==="paid_only"?n.jsx(ft,{color:"green",children:"Bezahlt"}):e==="mixed"?n.jsx(ft,{color:"gold",children:"Teilweise bezahlt"}):n.jsx(ft,{color:"blue",children:"Offen"})}function Kr(e){const r=(Array.isArray(e.eventIds)?e.eventIds:[]).map(s=>String(s||"").trim()).filter(Boolean);if(r.length)return Array.from(new Set(r));const a=String(e.id||"").trim();return a?[a]:[]}function aa(e){const t=String(e.eventType||"").toLowerCase(),r=`${String(e.typeLabel||"")} ${String(e.label||"")}`.toLowerCase();return r.includes("deposit")?1:r.includes("balance")?2:t==="freight"||r.includes("shipping")||r.includes("fracht")?3:t==="tax_duty_combined"||t==="duty"||t==="eust"||r.includes("zoll")||r.includes("umsatzsteuer")?4:5}function $a(e){return[...e].sort((t,r)=>{const a=String(t.dueDate||"").localeCompare(String(r.dueDate||""));if(a!==0)return a;const s=aa(t)-aa(r);return s!==0?s:String(t.label||"").localeCompare(String(r.label||""))})}function qr(e){return{id:String(e.id||""),eventIds:[String(e.id||"")],typeLabel:String(e.typeLabel||""),label:String(e.label||""),dueDate:e.dueDate?String(e.dueDate):null,plannedEur:Number(e.plannedEur||0),status:e.status==="paid"?"paid":"open",paidDate:e.paidDate?String(e.paidDate):null,paidEurActual:Number.isFinite(Number(e.paidEurActual))?Number(e.paidEurActual):null,paymentId:e.paymentId?String(e.paymentId):null,method:e.method?String(e.method):null,paidBy:e.paidBy?String(e.paidBy):null,note:String(e.note||""),invoiceDriveUrl:String(e.invoiceDriveUrl||""),invoiceFolderDriveUrl:String(e.invoiceFolderDriveUrl||""),eventType:e.eventType?String(e.eventType):null,direction:e.direction==="in"?"in":e.direction==="neutral"?"neutral":"out"}}function Wn(e){return e.eventType==="tax_duty_combined"?"Umsatzsteuer + Zoll":e.eventType==="duty"?"Zoll":e.eventType==="eust"?"EUSt":e.eventType==="vat_refund"?"EUSt-Erstattung":e.eventType==="freight"?"Shipping":e.eventType==="fx_fee"?"FX Gebuehr":String(e.typeLabel||e.label||"").trim()||"Payment"}function Oa(e){return aa({eventType:e.eventType,label:e.label,typeLabel:e.typeLabel})}function Tu(){return[{value:"Alibaba Trade Assurance",label:"Alibaba Trade Assurance"},{value:"Wise Transfer",label:"Wise Transfer"},{value:"PayPal",label:"PayPal"},{value:"SEPA Bank Transfer",label:"SEPA Bank Transfer"},{value:"Kreditkarte",label:"Kreditkarte"}]}function $u(e){const t=new Set;return Object.entries(e.displayNameMap||{}).forEach(([r,a])=>{const s=String(a||r||"").trim();s&&t.add(s)}),e.syncEmail&&t.add(String(e.syncEmail).trim()),t.size?Array.from(t).sort((r,a)=>r.localeCompare(a,"de-DE",{sensitivity:"base"})).map(r=>({value:r,label:r})):[]}function br(e){const t=String(e||"").trim();return t.length>0&&Jr(t)}function Ou(e){const r=String(e.paidDate||"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/),a=r?`${r[3]}-${r[2]}-${r[1]}`:"DD-MM-YYYY",s=String(e.poNo||"").trim()||"PO",u=String(e.alias||"").trim().replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")||"Alias",c=Number.isFinite(Number(e.units))?Math.max(0,Math.round(Number(e.units))):0,m=Array.from(new Set((e.selectedRows||[]).map(v=>Wn(v)))).map(v=>v.replace(/\s+/g,"-").replace(/[\\/:*?"<>|]/g,"-")),p=m.length?m.join("+"):"Payment";return`${a}_PO-${s}_${u}_${c}u_${p}.pdf`.replace(/-+/g,"-")}function Vr(e){const t=Number(e);return Number.isFinite(t)?Math.round(t*100)/100:0}function Fu(e){const t=e.settings||{};return{fxRate:Number(t.fxRate||0),fxFeePct:Number(t.fxFeePct||0),dutyRatePct:Number(t.dutyRatePct||0),dutyIncludeFreight:t.dutyIncludeFreight!==!1,eustRatePct:Number(t.eustRatePct||0),vatRefundEnabled:t.vatRefundEnabled!==!1,vatRefundLagMonths:Number(t.vatRefundLagMonths||0),freightLagDays:Number(t.freightLagDays||0),paymentDueDefaults:t.paymentDueDefaults||{},cny:t.cny||{start:"",end:""},cnyBlackoutByYear:t.cnyBlackoutByYear||{}}}function Zr(){return[{label:"Deposit",percent:30,anchor:"ORDER_DATE",lagDays:0},{label:"Balance",percent:70,anchor:"PROD_DONE",lagDays:0}]}function tr(e){return Math.round((e||[]).reduce((t,r)=>t+Number(r.percent||0),0)*100)/100}function It(e){const t=Number(e);return Number.isFinite(t)?t:null}function ms(e){const t=e!=null&&e.template&&typeof e.template=="object"?e.template:{};return(t.fields&&typeof t.fields=="object"?t.fields:t)||{}}function Hn(e){const t=e.product||{},r=e.settings||{},a=ms(t),s=Tn({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),u=String(a.transportMode||"SEA").toLowerCase(),c=r.transportLeadTimesDays||{},m=It(s.fields.transitDays.value)??It(a.transitDays)??It(c[u])??45,p=It(s.fields.productionLeadTimeDays.value)??It(t.productionLeadTimeDaysDefault??a.productionDays)??It(e.supplierDefaultProdDays)??It(r.defaultProductionLeadTimeDays)??60,v=It(s.fields.unitPriceUsd.value)??It(a.unitPriceUsd)??0,h=It(a.fxRate??r.fxRate)??0,y=Math.max(0,It(s.fields.logisticsPerUnitEur.value)??It(t.logisticsPerUnitEur??t.freightPerUnitEur??a.freightEur)??0),D=Math.max(0,Math.round(y*Math.max(0,Number(e.units||0))*100)/100);return{transport:u,prodDays:Math.max(0,Math.round(p)),transitDays:Math.max(0,Math.round(m)),unitCostUsd:v,unitExtraUsd:0,extraFlatUsd:0,freightEur:D,dutyRatePct:It(s.fields.dutyRatePct.value)??It(t.dutyRatePct??a.dutyPct??r.dutyRatePct)??0,eustRatePct:It(s.fields.eustRatePct.value)??It(t.eustRatePct??a.vatImportPct??r.eustRatePct)??0,fxOverride:h,ddp:s.fields.ddp.value===!0||a.ddp===!0}}function Au(e){const t=e.product||{},r=ms(t),a=Tn({state:e.state||{},product:t,sku:String(t.sku||""),supplierId:e.supplierId||String(t.supplierId||""),orderContext:"po"}),s=Math.max(0,It(a.fields.logisticsPerUnitEur.value)??It(t.logisticsPerUnitEur??t.freightPerUnitEur??r.freightEur)??0);return Math.max(0,Math.round(s*Math.max(0,Number(e.units||0))*100)/100)}function Yt(e,t=""){return{id:String(e.id||Wt("poi")),sku:String(e.sku||t||"").trim(),units:Math.max(0,Math.round(Number(e.units||0))),unitCostUsd:Number(e.unitCostUsd||0),unitExtraUsd:Number(e.unitExtraUsd||0),extraFlatUsd:Number(e.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(e.prodDays||0))),transitDays:Math.max(0,Math.round(Number(e.transitDays||0))),freightEur:Math.max(0,Number(e.freightEur||0))}}function Lu(e){const t=e!=null&&e.paymentLog&&typeof e.paymentLog=="object"?e.paymentLog:{};return Object.values(t).filter(r=>String((r==null?void 0:r.status)||"")==="paid").length}function Fa(e,t){const r=ur({items:e==null?void 0:e.items,orderDate:e==null?void 0:e.orderDate,fxRate:(e==null?void 0:e.fxOverride)??t.fxRate,fallback:e});return{goodsUsd:Vr(r.goodsUsd),goodsEur:Vr(r.goodsEur),freightEur:Vr(r.freightEur),units:Math.round(r.units),prodDays:Math.round(r.prodDays),transitDays:Math.round(r.transitDays)}}function Aa(e,t){const r=xn(),a=Xt(e.items,t).map(m=>({id:String(m.id||Wt("poi")),sku:String(m.sku||"").trim(),units:Math.max(0,Math.round(Number(m.units||0))),unitCostUsd:Number(m.unitCostUsd||0),unitExtraUsd:Number(m.unitExtraUsd||0),extraFlatUsd:Number(m.extraFlatUsd||0),prodDays:Math.max(0,Math.round(Number(m.prodDays||0))),transitDays:Math.max(0,Math.round(Number(m.transitDays||0))),freightEur:Math.max(0,Number(m.freightEur||0))})),s=ur({items:a,orderDate:e.orderDate,fxRate:e.fxOverride,fallback:t}),u=a[0]||null,c=(e.milestones||[]).map(m=>({id:String(m.id||Wt("ms")),label:String(m.label||"Milestone"),percent:Number(m.percent||0),anchor:String(m.anchor||"ORDER_DATE"),lagDays:Number(m.lagDays||0)}));return{...t||{},id:String(e.id||(t==null?void 0:t.id)||Wt("po")),poNo:String(e.poNo||"").trim(),sku:String((u==null?void 0:u.sku)||(t==null?void 0:t.sku)||"").trim(),supplierId:String(e.supplierId||"").trim(),orderDate:e.orderDate||null,etdManual:e.etdManual||null,etaManual:e.etaManual||null,arrivalDate:e.arrivalDate||null,units:Math.max(0,Math.round(s.units||0)),unitCostUsd:Number((u==null?void 0:u.unitCostUsd)||0),unitExtraUsd:Number((u==null?void 0:u.unitExtraUsd)||0),extraFlatUsd:Number((u==null?void 0:u.extraFlatUsd)||0),prodDays:Number(s.prodDays||0),transitDays:Number(s.transitDays||0),transport:String(e.transport||"sea").toLowerCase(),freightEur:Number(s.freightEur||0),freightMode:"total",freightPerUnitEur:0,dutyRatePct:Number(e.dutyRatePct||0),dutyIncludeFreight:e.dutyIncludeFreight!==!1,eustRatePct:Number(e.eustRatePct||0),fxOverride:Number(e.fxOverride||0),ddp:e.ddp===!0,items:a,milestones:c,archived:e.archived===!0,createdAt:(t==null?void 0:t.createdAt)||r,updatedAt:r,paymentLog:(t==null?void 0:t.paymentLog)||{},autoEvents:(t==null?void 0:t.autoEvents)||void 0}}function Uu({embedded:e=!1}={}){const t=oa(),r=kr(),{state:a,loading:s,saving:u,error:c,lastSavedAt:m,saveWith:p}=Pr(),v=oi(),[h,y]=o.useState(""),[D,I]=o.useState("active"),[P,T]=o.useState("all"),[b,N]=o.useState(!1),[O,E]=o.useState(!1),[j,B]=o.useState(null),[z,F]=o.useState([]),[q]=Ce.useForm(),[ee]=Ce.useForm(),[W,_]=o.useState(!1),[Z,re]=o.useState(null),[$,k]=o.useState(null),[g,C]=o.useState([]),[M,A]=o.useState(null),[Y,U]=o.useState(null),[L,X]=o.useState(null),J=o.useRef(null),w=o.useRef(new Set),ne=o.useRef(!1),se=o.useMemo(()=>new URLSearchParams(t.search).get("view")==="timeline"?"timeline":"table",[t.search]),V=a,Q=a.settings||{},ie=o.useMemo(()=>li(Q),[Q]),me=o.useMemo(()=>ui({userId:v.userId,userEmail:v.email},ie),[ie,v.email,v.userId]),we=o.useMemo(()=>`po:edit:${String(j||"new")}`,[j]),ae=gi({workspaceId:v.workspaceId,modalScope:we,isOpen:O,userId:v.userId,userEmail:v.email,userDisplayName:me,displayNames:ie}),Me=o.useMemo(()=>Fu(V),[a.settings]),Ee=o.useMemo(()=>(Array.isArray(a.suppliers)?a.suppliers:[]).map(l=>l).map(l=>({id:String(l.id||""),name:String(l.name||"—"),productionLeadTimeDaysDefault:Number(l.productionLeadTimeDaysDefault||0),paymentTermsDefault:Array.isArray(l.paymentTermsDefault)?l.paymentTermsDefault:[],raw:l})).filter(l=>l.id),[a.suppliers]),ge=o.useMemo(()=>new Map(Ee.map(l=>[l.id,l.name])),[Ee]),ke=o.useMemo(()=>new Map(Ee.map(l=>[l.id,l])),[Ee]),ve=o.useMemo(()=>(Array.isArray(a.products)?a.products:[]).map(l=>l).map(l=>({sku:String(l.sku||""),alias:String(l.alias||l.sku||""),supplierId:String(l.supplierId||""),raw:l})).filter(l=>l.sku),[a.products]),Ne=o.useMemo(()=>new Map(ve.map(l=>[l.sku,l])),[ve]),Te=o.useMemo(()=>{const l=Array.isArray(a.payments)?a.payments:[];return(Array.isArray(a.pos)?a.pos:[]).map(i=>{var Re;const f=i,x=ur({items:f.items,orderDate:f.orderDate,fxRate:f.fxOverride??Me.fxRate,fallback:f}),S=String(x.firstSku||f.sku||""),K=Kn({orderDate:f.orderDate,productionLeadTimeDays:x.prodDays||f.prodDays,logisticsLeadTimeDays:x.transitDays||f.transitDays,bufferDays:0}),te=String(f.etdManual||K.etdDate||""),be=String(f.etaManual||K.etaDate||""),R=Number(x.goodsEur||0),de=x.items.length,le=Array.isArray(f.items)?f.items.map(ze=>String((ze==null?void 0:ze.sku)||"")).join(" "):"",ye=(()=>{try{const ze=structuredClone(f);return $r(ze,Wr,Me,l)}catch{return[]}})(),Pe=(()=>{try{return $a(ye.map(De=>qr(De)).filter(De=>De.eventType!=="vat_refund").filter(De=>De.id&&De.plannedEur>0)).map(De=>({id:De.id,eventIds:Kr(De),typeLabel:De.typeLabel,label:De.label,dueDate:De.dueDate,plannedEur:De.plannedEur,status:De.status,paidDate:De.paidDate,eventType:De.eventType,direction:De.direction||"out"})).sort((De,He)=>{const dt=String(De.dueDate||"").localeCompare(String(He.dueDate||""));if(dt!==0)return dt;const vt=Oa(De)-Oa(He);return vt!==0?vt:String(De.label||"").localeCompare(String(He.label||""))})}catch{return[]}})(),he=ye.filter(ze=>ze.status==="paid").reduce((ze,De)=>ze+Number(De.plannedEur||0),0),ue=ye.filter(ze=>ze.status!=="paid").reduce((ze,De)=>ze+Number(De.plannedEur||0),0),Se=ue<=0&&he>0?"paid_only":ue>0&&he>0?"mixed":"open";return{id:String(f.id||""),poNo:String(f.poNo||""),sku:S,alias:((Re=Ne.get(S))==null?void 0:Re.alias)||S||"—",skuCount:de,supplierName:ge.get(String(f.supplierId||""))||"—",orderDate:f.orderDate?String(f.orderDate):null,productionEndDate:K.productionEndDate?String(K.productionEndDate):null,etdDate:te||null,etaDate:be||null,arrivalDate:f.arrivalDate?String(f.arrivalDate):null,goodsEur:R,openEur:ue,paidEur:he,statusText:Se,itemSkusText:le,timelineMarkers:Pe,raw:f}}).sort((i,f)=>String(i.poNo||"").localeCompare(String(f.poNo||"")))},[Me,Ne,a.payments,a.pos,ge]),oe=o.useMemo(()=>{const l=h.trim().toLowerCase();return Te.filter(i=>{const f=i.raw.archived===!0;return D==="active"&&f||D==="archived"&&!f||P!=="all"&&i.statusText!==P||b&&i.openEur<=0?!1:l?[i.poNo,i.sku,i.alias,i.supplierName,i.itemSkusText].join(" ").toLowerCase().includes(l):!0})},[D,Te,b,P,h]),Ae=o.useMemo(()=>Iu({state:V,rows:oe}),[oe,V]),Oe=o.useMemo(()=>Eu(V),[V]),Ze=o.useMemo(()=>hi(Ae,Oe),[Oe,Ae]),$e=o.useMemo(()=>{if(!Ze.length)return null;const l=Un(`${Ze[0]}-01`);if(!l)return null;const i=new Date(l.getTime());return i.setUTCMonth(i.getUTCMonth()+Oe),{startMs:l.getTime(),endMs:i.getTime(),totalDays:Math.max(1,(i.getTime()-l.getTime())/ds)}},[Oe,Ze]),Le=o.useMemo(()=>$e?_n(new Date,$e):0,[$e]);function ct(l){const i=new URLSearchParams(t.search);l==="timeline"?i.set("view","timeline"):i.delete("view");const f=i.toString();r({pathname:t.pathname,search:f?`?${f}`:""},{replace:!0})}const lt=o.useMemo(()=>[{header:"PO",accessorKey:"poNo",meta:{width:98}},{header:"Produkt",meta:{width:260},cell:({row:l})=>l.original.skuCount>1?n.jsxs("div",{className:"v2-proj-alias",children:[n.jsxs("div",{className:"v2-proj-alias-main",title:`${l.original.skuCount} SKUs`,children:[n.jsxs("span",{children:[l.original.skuCount," SKUs"]}),n.jsx(ft,{className:"v2-po-sku-count-tag",style:{marginInlineStart:6},children:"Multi-SKU"})]}),n.jsxs(rt,{className:"v2-proj-sku-secondary",type:"secondary",title:l.original.sku,children:["Start-SKU: ",l.original.sku]})]}):n.jsx(mi,{alias:l.original.alias,sku:l.original.sku})},{header:"Supplier",accessorKey:"supplierName",meta:{width:150}},{header:"Order",meta:{width:112},cell:({row:l})=>Nt(l.original.orderDate)},{header:"ETD / ETA",meta:{width:162,sortAccessor:Nu},cell:({row:l})=>n.jsxs(Ke,{direction:"vertical",size:0,children:[n.jsxs(rt,{children:["ETD ",Nt(l.original.etdDate)]}),n.jsxs(rt,{type:"secondary",children:["ETA ",Nt(l.original.etaDate)]})]})},{header:"Warenwert",meta:{width:130,align:"right"},cell:({row:l})=>an(l.original.goodsEur)},{header:"Open / Paid",meta:{width:160,align:"right"},cell:({row:l})=>n.jsxs(Ke,{direction:"vertical",size:0,children:[n.jsxs(rt,{children:["Open: ",an(l.original.openEur)]}),n.jsxs(rt,{type:"secondary",children:["Paid: ",an(l.original.paidEur)]})]})},{header:"Status",meta:{width:110},cell:({row:l})=>Ru(l.original.statusText)},{header:"Aktionen",meta:{width:190,minWidth:190},cell:({row:l})=>n.jsxs("div",{className:"v2-actions-nowrap",children:[n.jsx(je,{size:"small",onClick:()=>zt(l.original.raw),children:"Bearbeiten"}),n.jsx(je,{size:"small",danger:!0,onClick:()=>{$t.confirm({title:"PO loeschen?",onOk:async()=>{await p(i=>{const f=mn(i);return f.pos=(Array.isArray(f.pos)?f.pos:[]).filter(x=>String(x.id||"")!==l.original.id),f},"v2:po:delete")}})},children:"Loeschen"})]})}],[p]),G=Ce.useWatch([],q),qe=Ce.useWatch("supplierId",q),Je=o.useMemo(()=>Xt(G==null?void 0:G.items,null).map(l=>Yt(l)),[G==null?void 0:G.items]),xe=o.useMemo(()=>{var i;if(!G)return null;const l=j&&((i=Te.find(f=>f.id===j))==null?void 0:i.raw)||null;return Aa({...G,items:Je},l)},[Te,Je,G,j]),Ve=o.useMemo(()=>ur({items:Je,orderDate:G==null?void 0:G.orderDate,fxRate:(G==null?void 0:G.fxOverride)??Me.fxRate,fallback:Je.length?xe:null}),[Je,xe,G==null?void 0:G.fxOverride,G==null?void 0:G.orderDate,Me.fxRate]),H=Je[0]||null,pe=o.useMemo(()=>{var l;return H!=null&&H.sku&&((l=Ne.get(H.sku))==null?void 0:l.raw)||null},[H==null?void 0:H.sku,Ne]),Ie=o.useMemo(()=>Tn({state:V,product:pe||void 0,sku:String((H==null?void 0:H.sku)||""),supplierId:String((G==null?void 0:G.supplierId)||(pe==null?void 0:pe.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:H==null?void 0:H.unitCostUsd,prodDays:H==null?void 0:H.prodDays,transitDays:H==null?void 0:H.transitDays,dutyRatePct:G==null?void 0:G.dutyRatePct,eustRatePct:G==null?void 0:G.eustRatePct,ddp:G==null?void 0:G.ddp,incoterm:G!=null&&G.ddp?"DDP":"EXW"}}),[G==null?void 0:G.ddp,G==null?void 0:G.dutyRatePct,G==null?void 0:G.eustRatePct,G==null?void 0:G.supplierId,H==null?void 0:H.prodDays,H==null?void 0:H.sku,H==null?void 0:H.transitDays,H==null?void 0:H.unitCostUsd,pe,V]),d=o.useMemo(()=>Tn({state:V,product:pe||void 0,sku:String((H==null?void 0:H.sku)||""),supplierId:String((G==null?void 0:G.supplierId)||(pe==null?void 0:pe.supplierId)||""),orderContext:"po"}),[G==null?void 0:G.supplierId,H==null?void 0:H.sku,pe,V]),fe=o.useMemo(()=>ir({product:pe,state:V,supplierId:String((G==null?void 0:G.supplierId)||(pe==null?void 0:pe.supplierId)||""),orderContext:"po",orderOverrides:{unitCostUsd:H==null?void 0:H.unitCostUsd,prodDays:H==null?void 0:H.prodDays,transitDays:H==null?void 0:H.transitDays,dutyRatePct:G==null?void 0:G.dutyRatePct,eustRatePct:G==null?void 0:G.eustRatePct,ddp:G==null?void 0:G.ddp,incoterm:G!=null&&G.ddp?"DDP":"EXW"}}),[G==null?void 0:G.ddp,G==null?void 0:G.dutyRatePct,G==null?void 0:G.eustRatePct,G==null?void 0:G.supplierId,H==null?void 0:H.prodDays,H==null?void 0:H.transitDays,H==null?void 0:H.unitCostUsd,pe,V]);function Ge(l){if(!H)return;const i=Xt(q.getFieldValue("items"),null).map(x=>Yt(x)),f=i.findIndex(x=>x.id===H.id);if(l==="unitCostUsd"&&f>=0){i[f]={...i[f],unitCostUsd:Number(d.fields.unitPriceUsd.value||0)},q.setFieldValue("items",i);return}if(l==="prodDays"&&f>=0){i[f]={...i[f],prodDays:Math.round(Number(d.fields.productionLeadTimeDays.value||0))},q.setFieldValue("items",i);return}if(l==="transitDays"&&f>=0){i[f]={...i[f],transitDays:Math.round(Number(d.fields.transitDays.value||0))},q.setFieldValue("items",i);return}if(l==="dutyRatePct"){q.setFieldValue("dutyRatePct",Number(d.fields.dutyRatePct.value||0));return}if(l==="eustRatePct"){q.setFieldValue("eustRatePct",Number(d.fields.eustRatePct.value||0));return}q.setFieldValue("ddp",d.fields.ddp.value===!0)}function it(l,i){const f=String((H==null?void 0:H.sku)||"").trim();f&&$t.confirm({title:"Als neuen Produkt-Stammdatenwert uebernehmen?",content:`SKU ${f}: Wert wird in den Produktstammdaten gespeichert.`,okText:"Uebernehmen",cancelText:"Abbrechen",onOk:()=>{$t.confirm({title:"Bist du sicher?",content:"Diese Aenderung beeinflusst zukuenftige FO/PO Prefills.",okText:"Ja, speichern",cancelText:"Nein",onOk:async()=>{await p(x=>{const S=mn(x),K=Array.isArray(S.products)?[...S.products]:[],te=K.findIndex(R=>String(R.sku||"").trim().toLowerCase()===f.toLowerCase());if(te<0)return S;const be=K[te];return K[te]={...pi({product:be,field:l,value:i}),updatedAt:xn()},S.products=K,S},"v2:po:adopt-masterdata"),tn.success("Produkt-Stammdaten aktualisiert.")}})}})}const Be=o.useMemo(()=>{const l=String(qe||"");if(!l)return[];const i=new Set(Je.map(f=>f.sku));return ve.filter(f=>f.supplierId===l).map(f=>({value:f.sku,label:`${f.alias} (${f.sku})`,disabled:i.has(f.sku)}))},[Je,ve,qe]),Rt=o.useMemo(()=>{const l=[];return Je.forEach(i=>{const f=[];i.units<=0&&f.push("Units <= 0"),i.unitCostUsd<=0&&f.push("Unit Cost fehlt"),i.prodDays<=0&&f.push("Prod Days fehlen"),i.transitDays<=0&&f.push("Transit Days fehlen"),f.length&&l.push(`${i.sku||"SKU?"}: ${f.join(", ")}`)}),l},[Je]),Xe=o.useMemo(()=>{if(!xe)return[];try{const l=structuredClone(xe);return $r(l,Wr,Me,Array.isArray(a.payments)?a.payments:[]).map(f=>qr(f)).filter(f=>f.direction!=="in").filter(f=>f.id&&f.plannedEur>0)}catch{return[]}},[xe,Me,a.payments]),ht=o.useMemo(()=>{if(!xe)return[];try{const l=structuredClone(xe);return $r(l,Wr,Me,Array.isArray(a.payments)?a.payments:[],{includeIncoming:!0}).map(f=>qr(f)).filter(f=>f.eventType==="vat_refund"||f.direction==="in").filter(f=>f.id&&f.plannedEur>0).sort((f,x)=>String(f.dueDate||"").localeCompare(String(x.dueDate||"")))}catch{return[]}},[xe,Me,a.payments]),mt=o.useMemo(()=>$a(Xe),[Xe]);o.useEffect(()=>{if(!M||!O||j!==M.poId||!xe)return;const l=mt.find(i=>i.id===M.eventId)||null;if(l){Lt(l),A(null);return}U("payments"),A(null)},[mt,xe,j,M,O]),o.useEffect(()=>{if(!O||!Y)return;const l=f=>{f&&(f.scrollIntoView({block:"center",behavior:"smooth"}),f.focus())},i=window.requestAnimationFrame(()=>{if(Y==="payments"){const f=J.current;f&&f.scrollIntoView({block:"center",behavior:"smooth"}),U(null);return}if(Y==="shipping"){l(document.getElementById("v2-po-etd-manual")),U(null);return}Y==="arrival"&&(l(document.getElementById("v2-po-arrival-date")),U(null))});return()=>{window.cancelAnimationFrame(i)}},[Y,O]);const xt=o.useMemo(()=>{const l=new Map;return(Array.isArray(a.payments)?a.payments:[]).forEach(i=>{const f=i,x=String(f.id||"").trim();x&&l.set(x,f)}),l},[a.payments]),jt=o.useMemo(()=>$u({displayNameMap:ie,syncEmail:v.email}),[ie,v.email]),Bt=o.useMemo(()=>Tu(),[]),Gt=Ce.useWatch("selectedEventIds",ee),ut=Ce.useWatch([],ee),Ft=o.useMemo(()=>{const l=new Set((Gt||[]).map(i=>String(i||"")));return mt.filter(i=>l.has(i.id))},[mt,Gt]),qt=o.useMemo(()=>{var S,K;if(!xe||!ut)return"";const l=Xt(xe.items,xe),i=String(((S=l[0])==null?void 0:S.sku)||xe.sku||""),f=l.length,x=f>1?`Multi-SKU-${f}`:((K=Ne.get(i))==null?void 0:K.alias)||i||"Alias";return Ou({paidDate:ut.paidDate,poNo:String(xe.poNo||""),alias:x,units:Number(xe.units||0),selectedRows:Ft})},[xe,ut,Ft,Ne]);o.useEffect(()=>{!O||!ae.readOnly||!ae.remoteDraftPatch||q.setFieldsValue(ae.remoteDraftPatch)},[q,ae.readOnly,ae.remoteDraftPatch,ae.remoteDraftVersion,O]);function Ue(l){ne.current=!0,l(),Promise.resolve().then(()=>{ne.current=!1})}function Vt(l){const i=new Set(l.map(f=>String(f.id||"").trim()).filter(Boolean));Array.from(w.current).forEach(f=>{i.has(f)||w.current.delete(f)})}function pn(l){if(ne.current)return;const i=Array.isArray(l.items)?l.items:null;if(!(i!=null&&i.length))return;const f=Xt(q.getFieldValue("items"),null).map(x=>Yt(x));Vt(f),i.forEach((x,S)=>{var te;if(!x)return;const K=String(((te=f[S])==null?void 0:te.id)||"").trim();K&&(Object.prototype.hasOwnProperty.call(x,"sku")&&w.current.delete(K),Object.prototype.hasOwnProperty.call(x,"freightEur")&&w.current.add(K))})}function sn(l,i){var ue,Se,Re,ze;const f=String((i==null?void 0:i.sku)||"").trim(),x=Math.max(0,Math.round(Number((i==null?void 0:i.units)||0))),S=f?String(((ue=Ne.get(f))==null?void 0:ue.supplierId)||""):"",K=String((i==null?void 0:i.supplierId)||(l==null?void 0:l.supplierId)||S||((Se=Ee[0])==null?void 0:Se.id)||""),te=ke.get(K)||null,be=Xt(l==null?void 0:l.items,l).map(De=>Yt(De)),R=Xt(i==null?void 0:i.items,null).map(De=>Yt(De));let de=R.length?R:be;if(!de.length&&f){const De=Ne.get(f)||null,He=Hn({state:V,product:(De==null?void 0:De.raw)||null,settings:Q,supplierId:K,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:x});de=[Yt({id:Wt("poi"),sku:f,units:x,unitCostUsd:He.unitCostUsd,unitExtraUsd:He.unitExtraUsd,extraFlatUsd:He.extraFlatUsd,prodDays:He.prodDays,transitDays:He.transitDays,freightEur:He.freightEur})]}if(!de.length&&(l!=null&&l.sku)){const De=String(l.sku||"").trim(),He=Math.max(0,Math.round(Number(l.units||0))),dt=Ne.get(De)||null,vt=Hn({state:V,product:(dt==null?void 0:dt.raw)||null,settings:Q,supplierId:K,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:He});de=[Yt({id:Wt("poi"),sku:De,units:He,unitCostUsd:Number(l.unitCostUsd??vt.unitCostUsd??0),unitExtraUsd:Number(l.unitExtraUsd??vt.unitExtraUsd??0),extraFlatUsd:Number(l.extraFlatUsd??vt.extraFlatUsd??0),prodDays:Number(l.prodDays??vt.prodDays??0),transitDays:Number(l.transitDays??vt.transitDays??0),freightEur:Number(l.freightEur??vt.freightEur??0)})]}const le=de.filter(De=>{var dt;if(!K)return!0;const He=String(((dt=Ne.get(De.sku))==null?void 0:dt.supplierId)||"");return He?He===K:!0}),ye=Ne.get(String(((Re=le[0])==null?void 0:Re.sku)||f||(l==null?void 0:l.sku)||""))||null,Pe=Hn({state:V,product:(ye==null?void 0:ye.raw)||null,settings:Q,supplierId:K,supplierDefaultProdDays:te==null?void 0:te.productionLeadTimeDaysDefault,units:((ze=le[0])==null?void 0:ze.units)||x}),he=Da((te==null?void 0:te.raw)||null).map(De=>({id:De.id,label:De.label,percent:De.percent,anchor:De.anchor,lagDays:De.lagDays}));return{id:l!=null&&l.id?String(l.id):void 0,poNo:String((l==null?void 0:l.poNo)||""),supplierId:K,orderDate:String((i==null?void 0:i.orderDate)||(l==null?void 0:l.orderDate)||new Date().toISOString().slice(0,10)),etdManual:String((i==null?void 0:i.etdManual)||(l==null?void 0:l.etdManual)||""),etaManual:String((i==null?void 0:i.etaManual)||(l==null?void 0:l.etaManual)||""),arrivalDate:String((i==null?void 0:i.arrivalDate)||(l==null?void 0:l.arrivalDate)||""),transport:String((l==null?void 0:l.transport)||Pe.transport||"sea").toLowerCase(),dutyRatePct:Number((l==null?void 0:l.dutyRatePct)??Pe.dutyRatePct??Q.dutyRatePct??0),dutyIncludeFreight:(l==null?void 0:l.dutyIncludeFreight)!==!1,eustRatePct:Number((l==null?void 0:l.eustRatePct)??Pe.eustRatePct??Q.eustRatePct??0),fxOverride:Number((l==null?void 0:l.fxOverride)??Pe.fxOverride??Q.fxRate??0),ddp:(l==null?void 0:l.ddp)===!0?!0:!!Pe.ddp,archived:(l==null?void 0:l.archived)===!0,milestones:Array.isArray(l==null?void 0:l.milestones)?(l==null?void 0:l.milestones).map(De=>({id:String(De.id||Wt("ms")),label:String(De.label||"Milestone"),percent:Number(De.percent||0),anchor:String(De.anchor||"ORDER_DATE"),lagDays:Number(De.lagDays||0)})):he.length?he:Zr(),items:le}}function gn(l,i){var ye,Pe,he;const f=String(i||"").trim();if(!f)return;const x=Ne.get(f)||null;if(!x)return;const S=q.getFieldsValue(),K=Xt(S.items,null).map(ue=>Yt(ue));if(l<0||l>=K.length)return;const te=String(S.supplierId||x.supplierId||""),be=ke.get(te)||null,R=String(((ye=K[l])==null?void 0:ye.id)||"").trim(),de=Hn({state:V,product:x.raw,settings:Q,supplierId:te,supplierDefaultProdDays:be==null?void 0:be.productionLeadTimeDaysDefault,units:Number(((Pe=K[l])==null?void 0:Pe.units)||0)});K[l]=Yt({...K[l],sku:f,unitCostUsd:de.unitCostUsd,unitExtraUsd:de.unitExtraUsd,extraFlatUsd:de.extraFlatUsd,prodDays:de.prodDays,transitDays:de.transitDays,freightEur:de.freightEur});const le=String(((he=K[l])==null?void 0:he.id)||"").trim();R&&w.current.delete(R),le&&w.current.delete(le),Vt(K),Ue(()=>{q.setFieldsValue({items:K,supplierId:te||S.supplierId,transport:S.transport||de.transport,dutyRatePct:Number(S.dutyRatePct||de.dutyRatePct||0),eustRatePct:Number(S.eustRatePct||de.eustRatePct||0),fxOverride:Number(S.fxOverride||de.fxOverride||0),ddp:S.ddp===!0?!0:de.ddp})})}function on(l){const i=q.getFieldsValue(),f=Xt(i.items,null).map(R=>Yt(R)),x=new Set(f.map(R=>R.sku)),S=String(i.supplierId||""),K=ke.get(S)||null,te=[];if(l.forEach(R=>{const de=String(R||"").trim();if(!de||x.has(de))return;const le=Ne.get(de);if(!le||String(le.supplierId||"")!==S)return;const ye=Hn({state:V,product:le.raw,settings:Q,supplierId:S,supplierDefaultProdDays:K==null?void 0:K.productionLeadTimeDaysDefault,units:0});te.push(Yt({id:Wt("poi"),sku:de,units:0,unitCostUsd:ye.unitCostUsd,unitExtraUsd:ye.unitExtraUsd,extraFlatUsd:ye.extraFlatUsd,prodDays:ye.prodDays,transitDays:ye.transitDays,freightEur:ye.freightEur}))}),!te.length)return;const be=[...f,...te];Vt(be),Ue(()=>{var R;q.setFieldsValue({items:be,transport:i.transport||Hn({state:V,product:((R=Ne.get(te[0].sku))==null?void 0:R.raw)||null,settings:Q,supplierId:S,supplierDefaultProdDays:K==null?void 0:K.productionLeadTimeDaysDefault,units:te[0].units}).transport})}),F([])}function vn(l){const i=String(l||""),f=q.getFieldsValue(),x=Xt(f.items,null).map(R=>Yt(R)),S=x.filter(R=>{var le;const de=String(((le=Ne.get(R.sku))==null?void 0:le.supplierId)||"");return de?de===i:!0});x.length!==S.length&&tn.info(`${x.length-S.length} SKU(s) wurden entfernt, da sie nicht zum Lieferanten passen.`);const K=ke.get(i)||null,te=Da((K==null?void 0:K.raw)||null).map(R=>({id:R.id,label:R.label,percent:R.percent,anchor:R.anchor,lagDays:R.lagDays})),be=!j&&(!Array.isArray(f.milestones)||tr(f.milestones)===tr(Zr()));w.current.clear(),Ue(()=>{q.setFieldsValue({supplierId:i,items:S,milestones:be?te.length?te:Zr():f.milestones})}),F([])}function yn(l,i){B(null),U(null),i!=null&&i.preserveReturnContext||X(null);const f=sn(null,l);w.current.clear(),Ue(()=>{q.resetFields(),q.setFieldsValue({...f,...l||{}})}),F([]),E(!0)}function zt(l,i=null,f){B(String(l.id||"")),U(i),f!=null&&f.preserveReturnContext||X(null),w.current.clear(),Ue(()=>{q.resetFields(),q.setFieldsValue(sn(l))}),F([]),E(!0)}function At(l){const i=Array.isArray(l.items)?l.items:null;if(!(i!=null&&i.length)||!i.some(R=>R&&(Object.prototype.hasOwnProperty.call(R,"units")||Object.prototype.hasOwnProperty.call(R,"sku"))))return;const x=q.getFieldsValue(),S=String(x.supplierId||""),K=Xt(x.items,null).map(R=>Yt(R));Vt(K);let te=!1;const be=K.map((R,de)=>{const le=i[de],ye=!!(le&&Object.prototype.hasOwnProperty.call(le,"units")),Pe=!!(le&&Object.prototype.hasOwnProperty.call(le,"sku"));if(!ye&&!Pe)return R;const he=String(R.id||"").trim();if(Pe&&he&&w.current.delete(he),!R.sku||he&&w.current.has(he))return R;const ue=Ne.get(R.sku)||null;if(!ue)return R;const Se=Au({state:V,product:ue.raw,supplierId:S||ue.supplierId,units:R.units});return Math.abs(Number(R.freightEur||0)-Se)<=1e-4?R:(te=!0,{...R,freightEur:Se})});te&&Ue(()=>{q.setFieldValue("items",be)})}function ln(l,i){A({poId:l.id,eventId:i.id}),zt(l.raw,"payments")}function Lt(l){if(!j){tn.info("Bitte PO zuerst speichern, danach koennen Zahlungen verbucht werden.");return}const i=new Date().toISOString().slice(0,10),f=l||null,x=(f==null?void 0:f.paymentId)||null,S=x?mt.filter(le=>le.paymentId===x):f?[f]:mt.filter(le=>le.status!=="paid"),K=S.map(le=>le.id),te=Array.from(new Set(S.flatMap(le=>Kr(le)))),be=S.reduce((le,ye)=>le+Number(ye.plannedEur||0),0),R=x&&xt.get(x)||null,de=String((R==null?void 0:R.id)||x||Or(Wt("pay"))||Wt("pay"));ee.setFieldsValue({selectedEventIds:K,paidDate:String((R==null?void 0:R.paidDate)||(f==null?void 0:f.paidDate)||i),method:String((R==null?void 0:R.method)||(f==null?void 0:f.method)||"Alibaba Trade Assurance"),paidBy:String((R==null?void 0:R.payer)||(f==null?void 0:f.paidBy)||me||v.email||""),amountActualEur:Number.isFinite(Number(R==null?void 0:R.amountActualEurTotal))?Number(R==null?void 0:R.amountActualEurTotal):Math.round(be*100)/100,amountActualUsd:Number.isFinite(Number(R==null?void 0:R.amountActualUsdTotal))?Number(R==null?void 0:R.amountActualUsdTotal):null,paymentId:de,invoiceDriveUrl:String((R==null?void 0:R.invoiceDriveUrl)||(f==null?void 0:f.invoiceDriveUrl)||""),invoiceFolderDriveUrl:String((R==null?void 0:R.invoiceFolderDriveUrl)||(f==null?void 0:f.invoiceFolderDriveUrl)||""),note:String((R==null?void 0:R.note)||(f==null?void 0:f.note)||"")}),C(te),re(R!=null&&R.id?String(R.id):null),k(null),_(!0)}async function bn(l){if(ae.readOnly)throw new Error("Nur Lesemodus: keine Zahlungen speichern.");if(!j)throw new Error("PO muss zuerst gespeichert werden.");const i=Array.from(new Set((l.selectedEventIds||[]).map(he=>String(he||"").trim()).filter(Boolean)));if(!i.length)throw new Error("Bitte mindestens einen Zahlungsbaustein auswaehlen.");if(!l.paidDate)throw new Error("Bitte ein Zahlungsdatum setzen.");if(!l.method.trim())throw new Error("Bitte eine Zahlungsmethode waehlen.");if(!l.paidBy.trim())throw new Error("Bitte angeben, wer gezahlt hat.");const f=Number(l.amountActualEur);if(!Number.isFinite(f)||f<0)throw new Error("Bitte einen gueltigen Ist-Betrag in EUR eingeben.");if(l.invoiceDriveUrl&&!Jr(l.invoiceDriveUrl))throw new Error("Invoice-Link muss mit http:// oder https:// beginnen.");if(l.invoiceFolderDriveUrl&&!Jr(l.invoiceFolderDriveUrl))throw new Error("Folder-Link muss mit http:// oder https:// beginnen.");const x=String(Or(l.paymentId)||Or(Wt("pay"))||Wt("pay")),S=mt.filter(he=>i.includes(he.id)),K=Array.from(new Set(S.flatMap(he=>Kr(he))));if(!K.length)throw new Error("Bitte mindestens einen gueltigen Zahlungsbaustein auswaehlen.");const te=Xe.filter(he=>K.includes(he.id)),be=so(f,te.map(he=>({id:he.id,plannedEur:he.plannedEur})));if(!be||!be.length)throw new Error("Konnte die Zahlung nicht auf die gewaehlten Bausteine verteilen.");const R=Number(l.amountActualUsd),de=Number.isFinite(R)?R:null,le=te.reduce((he,ue)=>he+Number(ue.plannedEur||0),0),ye=de!=null&&le>0?te.map(he=>{const ue=Number(he.plannedEur||0)/le;return{eventId:he.id,actual:Math.round(de*ue*100)/100}}):[],Pe=new Map(ye.map(he=>[he.eventId,he.actual]));await p(he=>{var Jt,Ye,Fe;const ue=mn(he),Se=Array.isArray(ue.pos)?[...ue.pos]:[],Re=Se.findIndex(nt=>String(nt.id||"")===j);if(Re<0)throw new Error("PO nicht gefunden.");const ze={...Se[Re]},De=ze.paymentLog&&typeof ze.paymentLog=="object"?{...ze.paymentLog}:{},He=Z?String(Z):null;g.forEach(nt=>{if(K.includes(nt))return;const Ut=De[nt]&&typeof De[nt]=="object"?{...De[nt]}:{};De[nt]={...Ut,status:"open",paidDate:null,paymentId:null,amountActualEur:null,amountActualUsd:null,method:null,payer:null,note:null}}),be.forEach(nt=>{var cn;const Ut=De[nt.eventId]&&typeof De[nt.eventId]=="object"?{...De[nt.eventId]}:{};De[nt.eventId]={...Ut,paymentInternalId:String(Ut.paymentInternalId||Wt("payrow")),status:"paid",paidDate:l.paidDate,paymentId:x,amountActualEur:Number(nt.actual||0),amountActualUsd:Pe.get(nt.eventId)??null,method:l.method.trim(),payer:l.paidBy.trim(),note:((cn=l.note)==null?void 0:cn.trim())||null}}),ze.paymentLog=De,ze.updatedAt=xn(),Se[Re]=ze,ue.pos=Se;const dt=Array.isArray(ue.payments)?[...ue.payments]:[],vt=dt.findIndex(nt=>String(nt.id||"")===x);if(vt>=0&&(!He||String(dt[vt].id||"")!==He)){const nt=new Set(dt[vt].coveredEventIds||[]);if(!K.some(cn=>nt.has(cn))&&x!==He)throw new Error(`Payment-ID ${x} ist bereits vergeben.`)}const Dt={id:x,paidDate:l.paidDate,method:l.method.trim(),payer:l.paidBy.trim(),currency:"EUR",amountActualEurTotal:f,amountActualUsdTotal:de,coveredEventIds:K,note:((Jt=l.note)==null?void 0:Jt.trim())||null,invoiceDriveUrl:((Ye=l.invoiceDriveUrl)==null?void 0:Ye.trim())||"",invoiceFolderDriveUrl:((Fe=l.invoiceFolderDriveUrl)==null?void 0:Fe.trim())||""},rn=dt.findIndex(nt=>String(nt.id||"")===x);return rn>=0?dt[rn]={...dt[rn],...Dt}:dt.push(Dt),ue.payments=dt,ue},"v2:po:payment-booking"),_(!1),re(null),C([]),k(null),ee.resetFields(),tn.success("Zahlung wurde gespeichert.")}async function un(l,i=!1){var Pe,he;if(ae.readOnly)throw new Error("Diese PO wird gerade von einem anderen Nutzer bearbeitet.");if(!l.poNo.trim())throw new Error("PO Nummer ist erforderlich.");const f=Xt(l.items,null).map(ue=>Yt(ue));if(!f.length)throw new Error("Bitte mindestens eine SKU in der PO erfassen.");const x=String(l.supplierId||"").trim();if(!x)throw new Error("Bitte einen Lieferanten auswaehlen.");const S=f.find(ue=>{var Se;return String(((Se=Ne.get(ue.sku))==null?void 0:Se.supplierId)||"")!==x});if(S)throw new Error(`SKU ${S.sku} gehoert nicht zum gewaehlten Lieferanten.`);const K=f.find(ue=>ue.units<=0||ue.unitCostUsd<=0||ue.prodDays<=0||ue.transitDays<=0);if(K)throw new Error(`SKU ${K.sku} ist unvollstaendig. Bitte Units, Unit Cost, Prod Days und Transit Days pflegen.`);const te=f.find(ue=>{var ze;const Se=((ze=Ne.get(ue.sku))==null?void 0:ze.raw)||null;return Se?ir({product:Se,state:V,supplierId:x,orderContext:"po",orderOverrides:{unitCostUsd:ue.unitCostUsd,prodDays:ue.prodDays,transitDays:ue.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}}).blocked:!1});if(te){const ue=((Pe=Ne.get(te.sku))==null?void 0:Pe.raw)||null,Se=ir({product:ue,state:V,supplierId:x,orderContext:"po",orderOverrides:{unitCostUsd:te.unitCostUsd,prodDays:te.prodDays,transitDays:te.transitDays,dutyRatePct:l.dutyRatePct,eustRatePct:l.eustRatePct,ddp:l.ddp,incoterm:l.ddp?"DDP":"EXW"}});throw new Error(`SKU ${te.sku}: blockierende Stammdaten fehlen (${Se.issues.map(Re=>Re.label).join(", ")}).`)}const be=tr(l.milestones||[]);if(Math.abs(be-100)>.01)throw new Error("Milestone Prozentwerte muessen 100% ergeben.");const R=j&&((he=Te.find(ue=>ue.id===j))==null?void 0:he.raw)||null,de={...l,supplierId:x,items:f},le=Aa(de,R);if(Lu(R)>0&&!i){const ue=Fa(R,Me),Se=Fa(le,Me);if(ue.goodsUsd!==Se.goodsUsd||ue.goodsEur!==Se.goodsEur||ue.freightEur!==Se.freightEur||ue.units!==Se.units||ue.prodDays!==Se.prodDays||ue.transitDays!==Se.transitDays){$t.confirm({title:"Bereits bezahlte Events vorhanden",content:"Du hast Positionen oder Summen geaendert, obwohl bereits Zahlungen verbucht sind. Bitte bewusst bestaetigen.",okText:"Trotzdem speichern",cancelText:"Abbrechen",onOk:()=>void un(de,!0)});return}}await p(ue=>{const Se=mn(ue),Re=Array.isArray(Se.pos)?[...Se.pos]:[];if(Re.find(He=>String(He.poNo||"")===le.poNo&&String(He.id||"")!==String(le.id||"")))throw new Error(`PO Nummer ${le.poNo} existiert bereits.`);const De=Re.findIndex(He=>String(He.id||"")===String(le.id||""));return De>=0?Re[De]=le:Re.push(le),Se.pos=Re,Se},j?"v2:po:update":"v2:po:create"),ae.clearDraft(),E(!1),U(null),A(null),B(null),F([]),X(null),q.resetFields()}return o.useEffect(()=>{const l=new URLSearchParams(t.search),i=l.get("source"),f=ju(l.get("returnTo")),x=String(l.get("returnSku")||"").trim()||null,S=()=>{if(!f){X(null);return}X({path:f,sku:x})},K=Pe=>{let he=!1;if(Pe.forEach(Se=>{l.has(Se)&&(l.delete(Se),he=!0)}),!he)return;const ue=l.toString();r({pathname:t.pathname,search:ue?`?${ue}`:""},{replace:!0})};if(i==="fo_convert"){const Pe=String(l.get("poNo")||"").trim();if(Pe){y(Pe);const he=Te.find(ue=>String(ue.poNo||"").trim()===Pe||String(ue.id||"").trim()===Pe);he!=null&&he.raw&&(S(),zt(he.raw,null,{preserveReturnContext:!0}))}K(["source","poNo","returnTo","returnSku"]);return}if(i!=="inventory_projection")return;const te=String(l.get("sku")||"").trim();if(!te){K(["source","returnTo","returnSku"]);return}const be=ve.find(Pe=>Pe.sku===te)||null,R=Math.max(0,Math.round(Number(l.get("suggestedUnits")||0))),de=String(l.get("requiredArrivalDate")||""),le=String(l.get("recommendedOrderDate")||""),ye={sku:te,units:R};be!=null&&be.supplierId&&(ye.supplierId=String(be.supplierId)),de&&(ye.etaManual=de),le&&(ye.orderDate=le),S(),yn(ye,{preserveReturnContext:!0}),K(["source","sku","suggestedUnits","requiredArrivalDate","recommendedOrderDate","returnTo","returnSku"])},[Te,t.pathname,t.search,r,ve]),n.jsxs("div",{className:"v2-page",children:[n.jsxs(Et,{className:"v2-intro-card",children:[e?null:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Pu,{level:3,children:"Purchase Orders"}),n.jsx(ku,{children:"PO-Stammdaten, Milestones, Auto-Events und Payment-Status in einem konsistenten Arbeitsbereich."})]})}),n.jsx("div",{className:"v2-toolbar",children:n.jsxs("div",{className:"v2-toolbar-row",children:[n.jsx(je,{type:"primary",onClick:()=>yn(),children:"Neue PO"}),n.jsx(la,{value:se,options:[{label:"Tabelle",value:"table"},{label:"Timeline",value:"timeline"}],onChange:l=>ct(String(l)==="timeline"?"timeline":"table")}),u?n.jsx(ft,{color:"processing",children:"Speichern..."}):null,m?n.jsxs(ft,{color:"green",children:["Gespeichert: ",new Date(m).toLocaleTimeString("de-DE")]}):null]})})]}),c?n.jsx(kt,{type:"error",showIcon:!0,message:c}):null,s?n.jsx(kt,{type:"info",showIcon:!0,message:"Workspace wird geladen..."}):null,n.jsxs(Et,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(yt,{placeholder:"PO Nummer, SKU, Alias, Supplier",value:h,onChange:l=>y(l.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Ct,{value:D,onChange:l=>I(String(l)),options:[{value:"active",label:"Aktiv"},{value:"archived",label:"Archiv"},{value:"all",label:"Aktiv + Archiv"}],style:{width:170}}),n.jsx(Ct,{value:P,onChange:l=>T(String(l)),options:[{value:"all",label:"Status: Alle"},{value:"open",label:"Status: Offen"},{value:"mixed",label:"Status: Teilweise bezahlt"},{value:"paid_only",label:"Status: Bezahlt"}],style:{width:220}}),n.jsx(en,{checked:b,onChange:l=>N(l.target.checked),children:"Nur POs mit offenen Zahlungen"})]}),se==="table"?n.jsx(di,{data:oe,columns:lt,minTableWidth:1360,tableLayout:"auto"}):n.jsxs("div",{className:"v2-po-timeline",children:[n.jsxs("div",{className:"v2-po-timeline-head",style:{"--po-timeline-cols":Ze.length},children:[n.jsx("div",{className:"v2-po-timeline-head-cell v2-po-timeline-head-cell--meta",children:"PO / Supplier"}),Ze.map(l=>n.jsx("div",{className:"v2-po-timeline-head-cell",children:Qr(l)},l))]}),oe.length?null:n.jsx(kt,{type:"info",showIcon:!0,message:"Keine POs für die aktuelle Suche/Filter."}),oe.map(l=>{const i=Un(l.orderDate),f=Un(l.productionEndDate),x=Un(l.etdDate),S=Un(l.etaDate),K=$e?_n(i,$e):0,te=$e?_n(f,$e):0,be=$e?_n(x,$e):0,R=$e?_n(S,$e):0,de=Math.max(.75,te-K),le=Math.max(.75,R-be);return n.jsxs("div",{className:"v2-po-timeline-row",children:[n.jsxs("button",{type:"button",className:"v2-po-timeline-meta",onClick:()=>zt(l.raw),children:[n.jsx("div",{className:"v2-po-timeline-title",children:l.poNo||"PO"}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:[l.supplierName," · ",l.skuCount>1?`Multi-SKU (${l.skuCount}), Start ${l.sku}`:l.alias]}),n.jsxs("div",{className:"v2-po-timeline-subtitle",children:["Order ",Nt(l.orderDate)," · ETA ",Nt(l.etaDate)]}),n.jsxs("div",{className:"v2-po-timeline-action-row",children:[n.jsx(je,{size:"small",onClick:ye=>{ye.stopPropagation(),zt(l.raw,"shipping")},children:"Versendet am..."}),n.jsx(je,{size:"small",onClick:ye=>{ye.stopPropagation(),zt(l.raw,"arrival")},children:"Empfangen am..."})]})]}),n.jsxs("div",{className:"v2-po-timeline-track",children:[n.jsx("div",{className:"v2-po-timeline-track-bg"}),$e?n.jsx("div",{className:"v2-po-timeline-today",style:{left:`${Le}%`},title:"Heute"}):null,$e&&de>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--production",style:{left:`${K}%`,width:`${de}%`},title:"Produktion"}):null,$e&&le>0?n.jsx("div",{className:"v2-po-timeline-segment v2-po-timeline-segment--transit",style:{left:`${be}%`,width:`${le}%`},title:"Transit"}):null,$e?l.timelineMarkers.map(ye=>{const Pe=Un(ye.dueDate),he=_n(Pe,$e),ue=ye.status==="paid"?"v2-po-timeline-marker v2-po-timeline-marker--paid":"v2-po-timeline-marker v2-po-timeline-marker--open",Se=ye.direction==="in"?"v2-po-timeline-marker--incoming":"",Re=[`${Wn(ye)} (${ye.status==="paid"?"bezahlt":"offen"})`,`Soll: ${an(ye.plannedEur)}`,`Faellig: ${Nt(ye.dueDate)}`,ye.paidDate?`Bezahlt am: ${Nt(ye.paidDate)}`:"Bezahlt am: —"].join(`
`);return n.jsx(ci,{title:n.jsx("span",{style:{whiteSpace:"pre-line"},children:Re}),children:n.jsx("button",{type:"button",className:`${ue} ${Se}`.trim(),style:{left:`${he}%`},onClick:()=>ln(l,ye),"aria-label":`${Wn(ye)} fuer ${l.poNo}`})},ye.id)}):null]})]},l.id)}),n.jsxs("div",{className:"v2-po-timeline-legend",children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--production"})," Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-box v2-po-timeline-legend-box--transit"})," Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--open"})," Zahlung offen"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-dot v2-po-timeline-legend-dot--paid"})," Zahlung bezahlt"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-po-timeline-legend-line"})," Heute"]})]})]})]}),n.jsxs($t,{title:j?"PO bearbeiten":"PO anlegen",open:O,width:1120,onCancel:()=>{ae.clearDraft(),E(!1),U(null),A(null),F([]),X(null)},onOk:()=>{if(ae.readOnly){$t.warning({title:"Nur Lesemodus",content:`${ae.remoteUserLabel||"Kollege"} bearbeitet diese PO. Bitte Bearbeitung übernehmen oder warten.`});return}q.validateFields().then(l=>un(l)).catch(l=>{if(l&&typeof l=="object"&&"errorFields"in l)return;const i=l instanceof Error?l.message:l&&typeof l=="object"&&"message"in l?String(l.message||""):"";i&&tn.error(i)})},children:[ae.banner?n.jsx(kt,{style:{marginBottom:10},type:ae.banner.tone,showIcon:!0,message:ae.banner.text,action:ae.readOnly?n.jsx(je,{size:"small",onClick:ae.takeOver,children:"Bearbeitung uebernehmen"}):null}):null,ae.readOnly&&ae.remoteDraftVersion>0?n.jsxs(ft,{color:"orange",style:{marginBottom:10},children:["Entwurf von ",ae.remoteUserLabel||"Kollege"," wird live gespiegelt."]}):null,L?n.jsxs(Ke,{style:{width:"100%",marginBottom:10},wrap:!0,children:[n.jsx(je,{size:"small",onClick:()=>{const l=new URLSearchParams;L.sku&&l.set("sku",L.sku);const i=l.toString();r({pathname:L.path,search:i?`?${i}`:""})},children:"Zurueck zur SKU Planung"}),L.sku?n.jsxs(rt,{type:"secondary",children:["Fokus: ",L.sku]}):null]}):null,n.jsxs(Ce,{name:"v2-po-modal",form:q,layout:"vertical",disabled:ae.readOnly,onValuesChange:l=>{ae.readOnly||(pn(l),At(l),ae.publishDraftPatch(l))},children:[n.jsx(Ce.Item,{name:"id",hidden:!0,children:n.jsx(yt,{})}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"poNo",label:"PO Nummer",style:{width:190},rules:[{required:!0,message:"PO Nummer ist erforderlich."}],children:n.jsx(yt,{})}),n.jsx(Ce.Item,{name:"supplierId",label:"Supplier",style:{minWidth:260,flex:1},rules:[{required:!0,message:"Supplier ist erforderlich."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:Ee.map(l=>({value:l.id,label:l.name})),onChange:l=>vn(String(l||""))})}),n.jsx(Ce.Item,{name:"transport",label:"Transport",style:{width:150},children:n.jsx(Ct,{options:[{value:"sea",label:"SEA"},{value:"rail",label:"RAIL"},{value:"air",label:"AIR"}]})})]}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"orderDate",label:"Order Date",style:{width:190},rules:[{required:!0}],children:n.jsx(yt,{type:"date"})}),n.jsx(Ce.Item,{name:"etdManual",label:"ETD Manual",style:{width:190},children:n.jsx(yt,{id:"v2-po-etd-manual",type:"date"})}),n.jsx(Ce.Item,{name:"etaManual",label:"ETA Manual",style:{width:190},children:n.jsx(yt,{type:"date"})}),n.jsx(Ce.Item,{name:"arrivalDate",label:"Empfangen am",style:{width:190},children:n.jsx(yt,{id:"v2-po-arrival-date",type:"date"})}),n.jsx(Ce.Item,{name:"fxOverride",label:"FX Override",style:{width:150},children:n.jsx(bt,{mode:"fx",min:0})}),n.jsx(Ce.Item,{name:"dutyRatePct",label:"Duty %",style:{width:140},children:n.jsx(bt,{mode:"percent",min:0,max:100})}),n.jsx(Ce.Item,{name:"eustRatePct",label:"EUSt %",style:{width:140},children:n.jsx(bt,{mode:"percent",min:0,max:100})})]}),n.jsxs(Ke,{style:{width:"100%"},align:"start",wrap:!0,children:[n.jsx(Ce.Item,{name:"dutyIncludeFreight",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"Duty inkl. Freight"})}),n.jsx(Ce.Item,{name:"ddp",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"DDP"})}),n.jsx(Ce.Item,{name:"archived",valuePropName:"checked",style:{marginTop:31},children:n.jsx(en,{children:"Archiviert"})})]}),n.jsxs(Et,{size:"small",className:"v2-po-items-card",style:{marginBottom:12},children:[n.jsxs(Ke,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(rt,{strong:!0,children:"PO Positionen (Supplier-first)"}),n.jsxs(rt,{type:"secondary",children:[Je.length," SKU(s)"]})]}),n.jsxs(Ke,{style:{width:"100%",marginTop:8},align:"start",wrap:!0,children:[n.jsx(Ct,{mode:"multiple",allowClear:!0,placeholder:qe?"SKUs auswaehlen":"Zuerst Supplier waehlen",value:z,onChange:l=>F((l||[]).map(i=>String(i||""))),options:Be,style:{minWidth:420,flex:1},optionFilterProp:"label",disabled:!qe||!Be.length}),n.jsx(je,{onClick:()=>on(z),disabled:!qe||!z.length,children:"SKUs hinzufuegen"})]}),n.jsx(Ce.List,{name:"items",children:(l,{add:i,remove:f})=>n.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%",marginTop:10},children:[l.map(x=>n.jsxs("div",{className:"v2-po-item-row",children:[n.jsxs("div",{className:"v2-po-item-row-main",children:[n.jsx(Ce.Item,{...x,name:[x.name,"sku"],label:"SKU",className:"v2-po-item-col v2-po-item-col--sku",rules:[{required:!0,message:"SKU fehlt."}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:ve.filter(S=>String(S.supplierId||"")===String(qe||"")).map(S=>({value:S.sku,label:`${S.alias} (${S.sku})`})),onChange:S=>gn(Number(x.name),String(S||"")),disabled:!qe})}),n.jsx(Ce.Item,{...x,name:[x.name,"units"],label:"Units",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Units fehlen."}],children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"unitCostUsd"],label:"Unit Cost USD",className:"v2-po-item-col",rules:[{required:!0,message:"Preis fehlt."}],children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"unitExtraUsd"],label:"Unit Extra USD",className:"v2-po-item-col",children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"extraFlatUsd"],label:"Extra Flat USD",className:"v2-po-item-col",children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"freightEur"],label:"Shipping EUR",className:"v2-po-item-col",children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"prodDays"],label:"Prod Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Prod fehlt."}],children:n.jsx(bt,{mode:"int",min:0})}),n.jsx(Ce.Item,{...x,name:[x.name,"transitDays"],label:"Transit Days",className:"v2-po-item-col v2-po-item-col--narrow",rules:[{required:!0,message:"Transit fehlt."}],children:n.jsx(bt,{mode:"int",min:0})})]}),n.jsx(je,{danger:!0,size:"small",style:{marginTop:31},onClick:()=>f(x.name),children:"Entfernen"})]},x.key)),n.jsx(je,{onClick:()=>i(Yt({id:Wt("poi"),sku:"",units:0,unitCostUsd:0,unitExtraUsd:0,extraFlatUsd:0,prodDays:0,transitDays:0,freightEur:0})),disabled:!qe,children:"Leere Position"})]})})]}),n.jsxs(Et,{size:"small",className:"v2-po-aggregate-card",style:{marginBottom:12},children:[n.jsxs(Ke,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(rt,{strong:!0,children:"Aggregierte Sicht (kritischer Pfad)"}),n.jsx(ft,{className:"v2-po-critical-path-tag",children:"ETA folgt langsamster SKU"})]}),n.jsxs("div",{className:"v2-po-aggregate-grid",children:[n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Goods USD"}),n.jsx("div",{children:er(Ve.goodsUsd,2)})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Goods EUR"}),n.jsx("div",{children:an(Ve.goodsEur)})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Freight EUR"}),n.jsx("div",{children:an(Ve.freightEur)})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Units gesamt"}),n.jsx("div",{children:er(Ve.units,0)})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Prod/Transit (kritisch)"}),n.jsxs("div",{children:[er(Ve.prodDays,0)," / ",er(Ve.transitDays,0)," Tage"]})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"ETD / ETA"}),n.jsxs("div",{children:[Nt(Ve.schedule.etdDate)," / ",Nt(Ve.schedule.etaDate)]})]}),n.jsxs("div",{children:[n.jsx(rt,{type:"secondary",children:"Ankunftsfenster"}),n.jsx("div",{children:Ve.minEtaDate||Ve.maxEtaDate?`${Nt(Ve.minEtaDate)} - ${Nt(Ve.maxEtaDate)}`:"—"})]})]})]}),n.jsx(Et,{size:"small",style:{marginBottom:12},children:n.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%"},children:[n.jsx(rt,{strong:!0,children:"Stammdaten-Herkunft (PO)"}),H?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Primary SKU"}),n.jsx(rt,{children:H.sku})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Unit Cost USD"}),n.jsx("span",{className:Qt(Ie.fields.unitPriceUsd.source,!0),children:Ie.fields.unitPriceUsd.label}),n.jsx(je,{size:"small",onClick:()=>Ge("unitCostUsd"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",onClick:()=>it("unitPriceUsd",H.unitCostUsd),children:"Als Produktwert uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Prod / Transit"}),n.jsx("span",{className:Qt(Ie.fields.productionLeadTimeDays.source,!0),children:Ie.fields.productionLeadTimeDays.label}),n.jsx("span",{className:Qt(Ie.fields.transitDays.source,!1),children:Ie.fields.transitDays.label}),n.jsx(je,{size:"small",onClick:()=>Ge("prodDays"),children:"Prod reset"}),n.jsx(je,{size:"small",onClick:()=>Ge("transitDays"),children:"Transit reset"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"Duty / EUSt"}),n.jsx("span",{className:Qt(Ie.fields.dutyRatePct.source,!1),children:Ie.fields.dutyRatePct.label}),n.jsx("span",{className:Qt(Ie.fields.eustRatePct.source,!1),children:Ie.fields.eustRatePct.label}),n.jsx(je,{size:"small",onClick:()=>Ge("dutyRatePct"),children:"Duty reset"}),n.jsx(je,{size:"small",onClick:()=>Ge("eustRatePct"),children:"EUSt reset"}),n.jsx(je,{size:"small",onClick:()=>it("dutyRatePct",G==null?void 0:G.dutyRatePct),children:"Duty uebernehmen"}),n.jsx(je,{size:"small",onClick:()=>it("eustRatePct",G==null?void 0:G.eustRatePct),children:"EUSt uebernehmen"})]}),n.jsxs("div",{className:"v2-source-row",children:[n.jsx("span",{children:"DDP"}),n.jsx("span",{className:Qt(Ie.fields.ddp.source,!0),children:Ie.fields.ddp.label}),n.jsx(je,{size:"small",onClick:()=>Ge("ddp"),children:"Zuruecksetzen"}),n.jsx(je,{size:"small",onClick:()=>it("ddp",(G==null?void 0:G.ddp)===!0),children:"Als Produktwert uebernehmen"})]})]}):n.jsx(rt,{type:"secondary",children:"Bitte mindestens eine SKU erfassen."})]})}),H!=null&&H.sku&&fe.blocked?n.jsx(kt,{className:"v2-po-warning",type:"error",showIcon:!0,message:"Blockierende Stammdaten fehlen",description:fe.issues.map(l=>l.label).join(", ")}):null,qe&&!Be.length?n.jsx(kt,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Dieser Lieferant hat aktuell keine zugeordneten SKUs. Bitte zuerst Stammdaten pflegen."}):null,Rt.length?n.jsx(kt,{className:"v2-po-warning",type:"warning",showIcon:!0,message:"Einige Positionen sind unvollstaendig.",description:Rt.slice(0,6).join(" | ")}):null,n.jsxs(Et,{size:"small",style:{marginBottom:12},children:[n.jsxs(Ke,{style:{width:"100%",justifyContent:"space-between"},children:[n.jsx(rt,{strong:!0,children:"Milestones"}),n.jsxs(rt,{type:Math.abs(tr((G==null?void 0:G.milestones)||[])-100)<=.01?"secondary":"danger",children:["Summe: ",er(tr((G==null?void 0:G.milestones)||[]),2),"%"]})]}),n.jsx(Ce.List,{name:"milestones",children:(l,{add:i,remove:f})=>n.jsxs(Ke,{direction:"vertical",size:8,style:{width:"100%"},children:[l.map(x=>n.jsxs(Ke,{align:"start",style:{width:"100%"},wrap:!0,children:[n.jsx(Ce.Item,{...x,name:[x.name,"label"],style:{minWidth:240,flex:2},rules:[{required:!0,message:"Label fehlt."}],children:n.jsx(yt,{placeholder:"Label"})}),n.jsx(Ce.Item,{...x,name:[x.name,"percent"],style:{width:100},rules:[{required:!0,message:"%"}],children:n.jsx(bt,{mode:"percent",min:0,max:100})}),n.jsx(Ce.Item,{...x,name:[x.name,"anchor"],style:{width:160},rules:[{required:!0,message:"Anchor fehlt."}],children:n.jsx(Ct,{options:no.map(S=>({value:S,label:S}))})}),n.jsx(Ce.Item,{...x,name:[x.name,"lagDays"],style:{width:120},children:n.jsx(bt,{mode:"int"})}),n.jsx(je,{danger:!0,onClick:()=>f(x.name),children:"X"})]},x.key)),n.jsx(je,{onClick:()=>i({id:Wt("ms"),label:"Milestone",percent:0,anchor:"ORDER_DATE",lagDays:0}),children:"Milestone"})]})})]}),n.jsx("div",{ref:J,children:n.jsxs(Et,{size:"small",children:[n.jsxs(Ke,{style:{width:"100%",justifyContent:"space-between"},wrap:!0,children:[n.jsx(rt,{strong:!0,children:"Event / Payment Preview"}),n.jsx(je,{size:"small",onClick:()=>Lt(null),disabled:!j||!mt.length||ae.readOnly,children:"Sammelzahlung buchen"})]}),xe?n.jsxs(Ke,{direction:"vertical",size:4,style:{width:"100%",marginTop:8},children:[n.jsxs(rt,{children:["Timeline: Order ",Nt(xe.orderDate)," · ETD ",Nt(xe.etdManual||Kn({orderDate:xe.orderDate,productionLeadTimeDays:xe.prodDays,logisticsLeadTimeDays:xe.transitDays,bufferDays:0}).etdDate)," · ETA ",Nt(xe.etaManual||Kn({orderDate:xe.orderDate,productionLeadTimeDays:xe.prodDays,logisticsLeadTimeDays:xe.transitDays,bufferDays:0}).etaDate)]}),j?null:n.jsx(kt,{type:"info",showIcon:!0,message:"PO zuerst speichern, danach koennen Zahlungen (inkl. Sammelzahlung) verbucht werden."}),n.jsx(lr,{children:n.jsxs("table",{className:"v2-stats-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Due"}),n.jsx("th",{children:"Planned EUR"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode / Von"}),n.jsx("th",{children:"Invoice / Folder"}),n.jsx("th",{children:"Aktionen"})]})}),n.jsx("tbody",{children:mt.map(l=>n.jsxs("tr",{children:[n.jsx("td",{children:Ta(String(l.id||""))}),n.jsx("td",{children:Wn(l)}),n.jsx("td",{children:Nt(l.dueDate)}),n.jsx("td",{children:an(l.plannedEur)}),n.jsx("td",{children:l.paidEurActual!=null?an(l.paidEurActual):"—"}),n.jsx("td",{children:l.status==="paid"?"Bezahlt":"Offen"}),n.jsx("td",{children:Nt(l.paidDate)}),n.jsx("td",{children:l.method||l.paidBy?n.jsxs(Ke,{direction:"vertical",size:0,children:[n.jsx(rt,{children:l.method||"—"}),n.jsx(rt,{type:"secondary",children:l.paidBy||"—"})]}):"—"}),n.jsx("td",{children:n.jsxs(Ke,{direction:"vertical",size:0,children:[br(l.invoiceDriveUrl)?n.jsx("a",{href:String(l.invoiceDriveUrl),target:"_blank",rel:"noreferrer",children:"Invoice"}):n.jsx(rt,{type:"secondary",children:"Invoice —"}),br(l.invoiceFolderDriveUrl)?n.jsx("a",{href:String(l.invoiceFolderDriveUrl),target:"_blank",rel:"noreferrer",children:"Folder"}):n.jsx(rt,{type:"secondary",children:"Folder —"})]})}),n.jsx("td",{children:n.jsx(je,{size:"small",onClick:()=>Lt(l),disabled:!j||ae.readOnly,children:l.status==="paid"?"Bearbeiten":"Zahlung buchen"})})]},l.id))})]})}),ht.length?n.jsxs(Ke,{direction:"vertical",size:6,style:{width:"100%",marginTop:8},children:[n.jsx(rt,{strong:!0,children:"Automatische Eingaenge (Info)"}),n.jsx(kt,{type:"info",showIcon:!0,message:"EUSt-Erstattung wird automatisch verbucht und muss nicht manuell als Zahlung validiert werden."}),n.jsx(lr,{children:n.jsxs("table",{className:"v2-stats-table",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"Typ"}),n.jsx("th",{children:"Due"}),n.jsx("th",{children:"Planned EUR"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Hinweis"})]})}),n.jsx("tbody",{children:ht.map(l=>n.jsxs("tr",{children:[n.jsx("td",{children:Ta(String(l.id||""))}),n.jsx("td",{children:Wn(l)}),n.jsx("td",{children:Nt(l.dueDate)}),n.jsx("td",{children:an(l.plannedEur)}),n.jsx("td",{children:l.status==="paid"?"Bereits eingegangen":"Geplant"}),n.jsx("td",{children:"Automatisch (kein Zahlung buchen)"})]},`incoming-${l.id}`))})]})})]}):null]}):n.jsx(rt,{type:"secondary",children:"Preview erscheint nach Eingabe."})]})})]})]}),n.jsxs($t,{title:"PO Zahlung verbuchen",open:W,width:920,onCancel:()=>{_(!1),re(null),C([]),k(null),ee.resetFields()},onOk:()=>{k(null),ee.validateFields().then(l=>bn(l)).catch(l=>{l!=null&&l.errorFields||k(String(l instanceof Error?l.message:l))})},children:[$?n.jsx(kt,{type:"error",showIcon:!0,message:$,style:{marginBottom:10}}):null,n.jsxs(Ce,{form:ee,layout:"vertical",onFinish:l=>{k(null),bn(l).catch(i=>{k(String(i instanceof Error?i.message:i))})},children:[n.jsx(Ce.Item,{name:"selectedEventIds",label:"Welche Zahlungsbausteine sind in dieser Zahlung enthalten?",rules:[{required:!0,message:"Bitte mindestens einen Baustein waehlen."}],children:n.jsx(en.Group,{style:{width:"100%"},children:n.jsx(Ke,{direction:"vertical",style:{width:"100%"},children:mt.map(l=>{const i=l.status==="paid"&&l.paymentId&&l.paymentId!==Z&&!g.includes(l.id);return n.jsx(Et,{size:"small",style:{width:"100%"},children:n.jsx(en,{value:l.id,disabled:i,children:n.jsxs(Ke,{size:10,wrap:!0,children:[n.jsx(rt,{strong:!0,children:Wn(l)}),n.jsxs(rt,{type:"secondary",children:["Due ",Nt(l.dueDate)]}),n.jsx(rt,{children:an(l.plannedEur)}),l.status==="paid"?n.jsx(ft,{color:"green",children:"Bereits bezahlt"}):n.jsx(ft,{children:"Offen"}),l.paymentId?n.jsxs(rt,{type:"secondary",children:["Payment-ID ",l.paymentId]}):null]})})},l.id)})})})}),n.jsxs(Ke,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Ce.Item,{name:"paidDate",label:"Zahlungsdatum",style:{width:170},rules:[{required:!0}],children:n.jsx(yt,{type:"date"})}),n.jsx(Ce.Item,{name:"method",label:"Zahlungsmethode",style:{minWidth:240,flex:1},rules:[{required:!0}],children:n.jsx(Ct,{showSearch:!0,optionFilterProp:"label",options:Bt,placeholder:"z. B. Alibaba Trade Assurance"})}),n.jsx(Ce.Item,{name:"paidBy",label:"Bezahlt durch",style:{minWidth:220,flex:1},rules:[{required:!0}],children:n.jsx(yt,{placeholder:jt.map(l=>l.label).join(" / ")||"Name oder E-Mail"})})]}),n.jsxs(Ke,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Ce.Item,{name:"amountActualEur",label:"Ist-Betrag EUR",style:{width:190},rules:[{required:!0}],children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{name:"amountActualUsd",label:"Ist-Betrag USD (optional)",style:{width:210},children:n.jsx(bt,{mode:"decimal",min:0})}),n.jsx(Ce.Item,{name:"paymentId",label:"Payment-ID (intern)",style:{minWidth:300,flex:1},children:n.jsx(yt,{placeholder:"pay-..."})})]}),n.jsxs(Ke,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Ce.Item,{name:"invoiceDriveUrl",label:"Invoice Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(yt,{placeholder:"https://..."})}),n.jsx(je,{style:{marginTop:31},disabled:!br(String((ut==null?void 0:ut.invoiceDriveUrl)||"")),onClick:()=>window.open(String((ut==null?void 0:ut.invoiceDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Link oeffnen"})]}),n.jsxs(Ke,{align:"start",wrap:!0,style:{width:"100%"},children:[n.jsx(Ce.Item,{name:"invoiceFolderDriveUrl",label:"Ordner-Link (Google Drive)",style:{minWidth:360,flex:1},children:n.jsx(yt,{placeholder:"https://..."})}),n.jsx(je,{style:{marginTop:31},disabled:!br(String((ut==null?void 0:ut.invoiceFolderDriveUrl)||"")),onClick:()=>window.open(String((ut==null?void 0:ut.invoiceFolderDriveUrl)||""),"_blank","noopener,noreferrer"),children:"Ordner oeffnen"})]}),n.jsx(Ce.Item,{name:"note",label:"Notiz",children:n.jsx(yt.TextArea,{rows:2,placeholder:"Optionaler Hinweis"})}),n.jsx(Et,{size:"small",children:n.jsxs(Ke,{direction:"vertical",style:{width:"100%"},size:6,children:[n.jsx(rt,{strong:!0,children:"Dateiname-Vorschlag fuer Rechnung"}),n.jsx(rt,{code:!0,children:qt||"—"}),n.jsx("div",{children:n.jsx(je,{size:"small",onClick:()=>{qt&&(navigator.clipboard.writeText(qt),tn.success("Dateiname kopiert."))},children:"Dateiname kopieren"})})]})})]})]})]})}const{Text:Sr}=Rn,{RangePicker:_u}=Xn,Hu={"3m":3,"6m":6,"12m":12,"18m":18},Dn="-";function Gr(e){return String(e||"").trim()}function Bu(e){const t=e.archived===!0,r=String(e.status||"").trim().toUpperCase()==="CANCELLED";return t||r?"closed":"planning"}function zu(e){const t=In(e.status);return t==="DRAFT"||t==="ACTIVE"?"planning":"closed"}function Yu(e,t,r){const a=vi(e.categoryLabel,t.categoryLabel,r);if(a!==0)return a;const s=String(e.alias||"").localeCompare(String(t.alias||""),"de-DE",{sensitivity:"base"});return s!==0?s:e.sku.localeCompare(t.sku,"de-DE",{sensitivity:"base"})}function La(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):null}function Wu(e){return Number.isFinite(e)?`${Number(e).toLocaleString("de-DE",{maximumFractionDigits:0})} Stk`:Dn}function Ua(e){if(!e)return Dn;const t=Pt(e);return t.isValid()?t.format("DD.MM.YYYY"):e}function _a(e){const t=[e.destination,e.destinationName,e.targetWarehouse,e.warehouse,e.warehouseName,e.fulfillmentCenter,e.portTo];for(const r of t){const a=String(r||"").trim();if(a)return a}return null}function Ha(e,t){const r=String(t||"").trim().replace(/\s+/g,"");if(!r)return e;const a=r.toUpperCase();return a.startsWith(e)?a:`${e}${r}`}function Ku(e){const t=String(e||"");return t?Math.max(38,Math.round(t.length*6.4+12)):38}function qu(e){var u;const t=((u=e==null?void 0:e.itemContext)==null?void 0:u.dimensions)||{},r=Number(t.width||0),a=Number(t.height||0),s=Math.min(Math.max(0,a/2),Math.max(0,r/2-1),10);return Number.isFinite(s)?Math.max(0,s):0}function Vu(e,t){var h,y;const r=((h=e==null?void 0:e.itemContext)==null?void 0:h.dimensions)||{},a=Number(r.width||0),s=Number(r.left||0),u=Ku(t),c=typeof((y=e==null?void 0:e.timelineContext)==null?void 0:y.getTimelineState)=="function"?e.timelineContext.getTimelineState():null,m=Number((c==null?void 0:c.timelineWidth)||0);if(m<=0)return"right";const p=Math.max(0,m-(s+a)),v=Math.max(0,s);return p>=u+6?"right":v>=u+6?"left":"right"}function Ba(e){if(!e.length)return e;let t=0;for(let r=1;r<e.length;r+=1)e[r].endMs>=e[t].endMs&&(t=r);return e.map((r,a)=>({...r,tooltipData:{...r.tooltipData,showReferenceLabel:a===t}}))}function Bn(e){return String(e||"").trim()||Dn}function Zu(e){const t=[{key:"Typ",value:Bn(e.type)},{key:"Nummer",value:Bn(e.identifier)},{key:"Phase",value:Bn(e.phase)},{key:"Menge",value:Wu(e.units??null)},{key:"Zeitraum",value:`${Ua(String(e.startDate||""))} - ${Ua(String(e.endDate||""))}`},{key:"Supplier",value:Bn(e.supplier)}];return e.destination&&t.push({key:"Ziel",value:Bn(e.destination)}),e.isPhantom&&t.push({key:"Hinweis",value:Bn(e.phantomReason||"Phantom FO (vorbehaltlich)")}),n.jsx("div",{className:"v2-orders-gantt-tooltip",children:t.map(r=>n.jsxs("div",{className:"v2-orders-gantt-tooltip-row",children:[n.jsx("span",{className:"v2-orders-gantt-tooltip-key",children:r.key}),n.jsx("span",{className:"v2-orders-gantt-tooltip-value",children:r.value})]},r.key))})}function Gu(){const e=kr(),{state:t}=Pr(),[r,a]=o.useState(""),[s,u]=o.useState("all"),[c,m]=o.useState("all"),[p,v]=o.useState("all"),[h,y]=o.useState("planning"),[D,I]=o.useState("12m"),[P,T]=o.useState(""),[b,N]=o.useState(null),O=t,E=o.useMemo(()=>oo(O),[t.productCategories]),j=o.useMemo(()=>{const g=new Map;return(Array.isArray(t.productCategories)?t.productCategories:[]).forEach(C=>{const M=C,A=String(M.id||"");A&&g.set(A,String(M.name||"Ohne Kategorie"))}),g},[t.productCategories]),B=o.useMemo(()=>{const g=new Map;return(Array.isArray(t.suppliers)?t.suppliers:[]).forEach(C=>{const M=C,A=String(M.id||"");A&&g.set(A,String(M.name||Dn))}),g},[t.suppliers]),z=o.useMemo(()=>{const g=new Map;return(Array.isArray(t.products)?t.products:[]).forEach(C=>{const M=C,A=Gr(M.sku);A&&g.set(A,M)}),g},[t.products]),F=o.useMemo(()=>lo(O,18),[t.settings]),q=o.useMemo(()=>P&&F.includes(P)?P:F[F.length-1]||"",[P,F]);o.useEffect(()=>{if(!F.length){T("");return}T(g=>g&&F.includes(g)?g:F[F.length-1])},[F]);const ee=o.useMemo(()=>uo({state:O,months:F,targetMonth:q||null}),[F,q,O]),W=o.useMemo(()=>new Map(ee.map(g=>[g.id,g])),[ee]),_=o.useMemo(()=>{const g=(Array.isArray(t.productCategories)?t.productCategories:[]).map(C=>C).map(C=>({value:String(C.id||""),label:String(C.name||"Ohne Kategorie")})).filter(C=>C.value).sort((C,M)=>vi(C.label,M.label,E));return[{value:"all",label:"Kategorie: Alle"},...g,{value:"__uncat__",label:"Ohne Kategorie"}]},[E,t.productCategories]),Z=o.useMemo(()=>{const g=Array.from(B.entries()).map(([C,M])=>({value:C,label:M})).sort((C,M)=>C.label.localeCompare(M.label,"de-DE",{sensitivity:"base"}));return[{value:"all",label:"Supplier: Alle"},...g]},[B]),re=o.useCallback(g=>{const C=(g==null?void 0:g.item)||{},M=C.meta&&typeof C.meta=="object"?C.meta:{},A=String(M.referenceLabel||""),Y=M.showReferenceLabel===!0&&!!A,U=Y?Vu(g,A):"right",L=qu(g),X=g.getItemProps({className:`${String(C.className||"")} v2-orders-gantt-pill v2-orders-gantt-pill--minimal`.trim(),style:{borderRadius:`${L}px`}});return n.jsx(ci,{title:Zu(M),placement:"top",mouseEnterDelay:.12,overlayClassName:"v2-orders-gantt-tooltip-overlay",children:n.jsx("div",{...X,children:Y?n.jsx("span",{className:`v2-orders-gantt-ref v2-orders-gantt-ref--${U}`,children:A}):null})})},[]),$=o.useMemo(()=>{const g=new Map,C=[],M=(w,ne="")=>{if(g.has(w))return g.get(w);const se=z.get(w)||{},V=String(se.supplierId||ne||""),Q=B.get(V)||Dn,me=String(se.categoryId||"")||null,we=me&&j.get(me)||"Ohne Kategorie",ae=String(se.alias||w),Me={sku:w,alias:ae,supplierId:V,supplierName:Q,categoryId:me,categoryLabel:we,items:[],references:[]};return g.set(w,Me),Me};(Array.isArray(t.pos)?t.pos:[]).map(w=>w).forEach(w=>{var Te;const ne=Bu(w);if(h==="planning"&&ne!=="planning"||h==="closed"&&ne!=="closed")return;const se=ur({items:w.items,orderDate:w.orderDate,fxRate:Number(((Te=t.settings)==null?void 0:Te.fxRate)||0),fallback:w}),V=Kn({orderDate:w.orderDate,productionLeadTimeDays:se.prodDays||w.prodDays,logisticsLeadTimeDays:se.transitDays||w.transitDays,bufferDays:0}),Q=String(w.orderDate||""),ie=String(w.etdManual||V.etdDate||""),me=String(w.etaManual||V.etaDate||""),we=dn(Q),ae=dn(ie),Me=dn(me),Ee=_a(w);Q&&C.push(Q),ie&&C.push(ie),me&&C.push(me);const ge=String(w.poNo||String(w.id||"").slice(-6).toUpperCase()||"PO"),ke=Ha("PO",ge),ve=String(w.supplierId||"");(Array.isArray(w.items)&&w.items.length?w.items:[{sku:w.sku,units:w.units}]).forEach((oe,Ae)=>{const Oe=Gr((oe==null?void 0:oe.sku)||w.sku);if(!Oe)return;const Ze=M(Oe,ve),$e=La((oe==null?void 0:oe.units)??(oe==null?void 0:oe.qty)??(oe==null?void 0:oe.quantity)??w.units),Le=Ze.supplierName!==Dn?Ze.supplierName:null,ct=[],lt=we??ae,G=ae;if(lt!=null&&G!=null){const qe=Mn({startMs:lt,endMs:G});ct.push({id:`po:${String(w.id||ge)}:${Oe}:${Ae}:production`,startMs:qe.startMs,endMs:qe.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-production",tooltipData:{type:"PO",identifier:ke,phase:"Production",units:$e,startDate:Q||ie,endDate:ie||Q,supplier:Le,destination:Ee,referenceLabel:ke,showReferenceLabel:!1},openTarget:{entity:"po",poNo:ge}})}if(Me!=null){const Je=Mn({startMs:ae??we??Me,endMs:Me});ct.push({id:`po:${String(w.id||ge)}:${Oe}:${Ae}:transit`,startMs:Je.startMs,endMs:Je.endMs,className:"v2-orders-gantt-item v2-orders-gantt-item--po-transit",tooltipData:{type:"PO",identifier:ke,phase:"Transit",units:$e,startDate:ie||Q||me,endDate:me||ie||Q,supplier:Le,destination:Ee,referenceLabel:ke,showReferenceLabel:!1},openTarget:{entity:"po",poNo:ge}})}Ba(ct).forEach(qe=>{Ze.items.push(qe)}),Ze.references.push(ke)})}),[...(Array.isArray(t.fos)?t.fos:[]).map(w=>w),...ee.map(w=>w.foRecord)].forEach(w=>{var lt,G;const ne=zu(w);if(h==="planning"&&ne!=="planning"||h==="closed"&&ne!=="closed")return;const se=xr({targetDeliveryDate:w.targetDeliveryDate||w.deliveryDate||w.etaDate,productionLeadTimeDays:w.productionLeadTimeDays,logisticsLeadTimeDays:w.logisticsLeadTimeDays,bufferDays:w.bufferDays}),V=String(w.orderDate||se.orderDate||""),Q=String(w.etdDate||se.etdDate||""),ie=String(w.etaDate||se.etaDate||w.targetDeliveryDate||""),me=dn(V),we=dn(Q),ae=dn(ie),Me=_a(w),Ee=La(w.units??w.qty??w.quantity);V&&C.push(V),Q&&C.push(Q),ie&&C.push(ie);const ge=Gr(w.sku);if(!ge)return;const ke=M(ge,String(w.supplierId||"")),ve=String(w.id||""),Ne=String(w.foNo||w.foNumber||ve.slice(-6).toUpperCase()||Dn),Te=Ha("FO",Ne),oe=ve&&W.get(ve)||null,Ae=!!(w.phantom===!0||oe),Oe=Ae?{id:String((oe==null?void 0:oe.id)||ve),sku:ge,month:String((oe==null?void 0:oe.firstRiskMonth)||""),suggestedUnits:Math.max(0,Math.round(Number((oe==null?void 0:oe.suggestedUnits)||w.units||0))),requiredArrivalDate:String((oe==null?void 0:oe.requiredArrivalDate)||w.targetDeliveryDate||w.etaDate||"")||null,recommendedOrderDate:String((oe==null?void 0:oe.recommendedOrderDate)||(oe==null?void 0:oe.latestOrderDate)||w.orderDate||"")||null,firstRiskMonth:String((oe==null?void 0:oe.firstRiskMonth)||"")||null,orderMonth:String((oe==null?void 0:oe.orderMonth)||"")||null,leadTimeDays:Number.isFinite(Number(oe==null?void 0:oe.leadTimeDays))?Math.max(0,Math.round(Number(oe==null?void 0:oe.leadTimeDays))):null}:null,Ze=ke.supplierName!==Dn?ke.supplierName:null,$e=[],Le=me??we,ct=we;if(Le!=null&&ct!=null){const qe=Mn({startMs:Le,endMs:ct});$e.push({id:`fo:${ve}:${ge}:production`,startMs:qe.startMs,endMs:qe.endMs,className:["v2-orders-gantt-item","v2-orders-gantt-item--fo-production",Ae?"v2-orders-gantt-item--fo-phantom":""].join(" ").trim(),tooltipData:{type:"FO",identifier:Te,phase:"Production",units:Ee,startDate:V||Q,endDate:Q||V,supplier:Ze,destination:Me,referenceLabel:Te,showReferenceLabel:!1,isPhantom:Ae,phantomReason:String((lt=oe==null?void 0:oe.foRecord)!=null&&lt.phantomMeta&&typeof oe.foRecord.phantomMeta=="object"?oe.foRecord.phantomMeta.reason:w.phantomMeta&&typeof w.phantomMeta=="object"?w.phantomMeta.reason:"")||null},openTarget:{entity:"fo",foId:ve,phantomMeta:Oe}})}if(ae!=null){const Je=Mn({startMs:we??me??ae,endMs:ae});$e.push({id:`fo:${ve}:${ge}:transit`,startMs:Je.startMs,endMs:Je.endMs,className:["v2-orders-gantt-item","v2-orders-gantt-item--fo-transit",Ae?"v2-orders-gantt-item--fo-phantom":""].join(" ").trim(),tooltipData:{type:"FO",identifier:Te,phase:"Transit",units:Ee,startDate:Q||V||ie,endDate:ie||Q||V,supplier:Ze,destination:Me,referenceLabel:Te,showReferenceLabel:!1,isPhantom:Ae,phantomReason:String((G=oe==null?void 0:oe.foRecord)!=null&&G.phantomMeta&&typeof oe.foRecord.phantomMeta=="object"?oe.foRecord.phantomMeta.reason:w.phantomMeta&&typeof w.phantomMeta=="object"?w.phantomMeta.reason:"")||null},openTarget:{entity:"fo",foId:ve,phantomMeta:Oe}})}Ba($e).forEach(qe=>{ke.items.push(qe)}),ke.references.push(Te)});const Y=Array.from(g.values()).sort((w,ne)=>Yu(w,ne,E)),U=[],L=[],X=new Map,J=r.trim().toLowerCase();return Y.forEach(w=>{if(s==="__uncat__"&&w.categoryId||s!=="all"&&s!=="__uncat__"&&w.categoryId!==s||c!=="all"&&w.supplierId!==c)return;const ne=w.items.filter(V=>p==="all"||V.openTarget.entity===p);if(!ne.length)return;const se=[w.sku,w.alias,w.supplierName,w.categoryLabel,...w.references].join(" ").toLowerCase();J&&!se.includes(J)||(U.push({id:w.sku,title:n.jsxs("div",{className:"v2-orders-gantt-meta v2-orders-gantt-meta--sku",children:[n.jsxs("div",{className:"v2-orders-gantt-topline",children:[n.jsx(Sr,{strong:!0,className:"v2-orders-gantt-sku-title",children:w.alias}),n.jsx(ft,{className:"v2-orders-gantt-lane-tag",children:w.sku})]}),n.jsxs("div",{className:"v2-orders-gantt-subline",children:[w.supplierName," · ",w.categoryLabel]})]})}),ne.forEach(V=>{L.push({id:V.id,group:w.sku,startMs:V.startMs,endMs:V.endMs,className:V.className,meta:V.tooltipData}),X.set(V.id,V.openTarget)}))}),{groups:U,items:L,targetByItemId:X,timelineWindow:us({state:O,dates:C,fallbackHorizon:12})}},[j,s,E,W,ee,z,r,t.fos,t.pos,t.settings,O,h,B,c,p]),k=o.useMemo(()=>{var Y,U;const g=$.timelineWindow;if(D==="custom"){const L=(Y=b==null?void 0:b[0])==null?void 0:Y.startOf("day").valueOf(),X=(U=b==null?void 0:b[1])==null?void 0:U.endOf("day").valueOf();return Number.isFinite(L)&&Number.isFinite(X)&&Number(X)>Number(L)?{visibleStartMs:Number(L),visibleEndMs:Number(X)}:g}const C=Pt(g.visibleStartMs).startOf("month").valueOf(),M=Hu[D],A=Pt(C).add(M,"month").endOf("day").valueOf();return{visibleStartMs:C,visibleEndMs:A}},[b,D,$.timelineWindow]);return n.jsxs(Et,{children:[n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsx(yt,{placeholder:"Suche SKU, Alias, PO/FO, Supplier",value:r,onChange:g=>a(g.target.value),style:{width:320,maxWidth:"100%"}}),n.jsx(Ct,{value:s,options:_,onChange:g=>u(String(g||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Ct,{value:c,options:Z,onChange:g=>m(String(g||"all")),style:{width:220,maxWidth:"100%"}}),n.jsx(Ct,{value:p,onChange:g=>v(String(g||"all")),options:[{value:"all",label:"Typ: PO + FO"},{value:"po",label:"Typ: nur PO"},{value:"fo",label:"Typ: nur FO"}],style:{width:170}}),n.jsx(Ct,{value:h,onChange:g=>y(String(g||"planning")),options:[{value:"planning",label:"Status: Planungsrelevant"},{value:"all",label:"Status: Alle"},{value:"closed",label:"Status: Abgeschlossen"}],style:{width:220}})]}),n.jsxs("div",{className:"v2-toolbar-row v2-orders-gantt-range-row",style:{marginBottom:10},children:[n.jsx(Sr,{type:"secondary",children:"Zeitraum:"}),n.jsx(la,{value:D,options:[{value:"3m",label:"3M"},{value:"6m",label:"6M"},{value:"12m",label:"12M"},{value:"18m",label:"18M"},{value:"custom",label:"Custom"}],onChange:g=>{const C=String(g||"12m");I(C),C==="custom"&&!b&&N([Pt($.timelineWindow.visibleStartMs),Pt($.timelineWindow.visibleEndMs)])}}),n.jsx(Sr,{type:"secondary",children:"PFO bis:"}),n.jsx(Ct,{value:q||void 0,onChange:g=>T(String(g||"")),options:F.map(g=>({value:g,label:Qr(g)})),style:{width:170,maxWidth:"100%"},disabled:!F.length}),D==="custom"?n.jsx(_u,{className:"v2-orders-gantt-range-picker",value:b||void 0,format:"DD.MM.YYYY",allowClear:!0,onChange:g=>{if(!g){N(null);return}N(g)}}):null]}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:10},children:[n.jsxs(ft,{children:[$.groups.length," SKUs"]}),n.jsxs(ft,{children:[$.items.length," Segmente"]}),ee.length?n.jsxs(ft,{color:"gold",children:["Phantom FO: ",ee.length]}):null,q?n.jsxs(ft,{color:"gold",children:["PFO bis: ",Qr(q)]}):null,n.jsx(ft,{color:"green",children:"SKU Timeline"})]}),n.jsxs("div",{className:"v2-orders-gantt-legend",style:{marginBottom:10},children:[n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-production"})," PO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--po-transit"})," PO Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-production"})," FO Produktion"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-transit"})," FO Transit"]}),n.jsxs("span",{children:[n.jsx("span",{className:"v2-orders-gantt-legend-box v2-orders-gantt-legend-box--fo-phantom"})," Phantom FO (vorbehaltlich)"]})]}),n.jsx(cs,{className:"v2-orders-gantt--sku",groups:$.groups,items:$.items,visibleStartMs:k.visibleStartMs,visibleEndMs:k.visibleEndMs,sidebarHeaderLabel:"SKU",sidebarWidth:500,lineHeight:66,itemHeightRatio:.58,stackItems:!0,showTodayMarker:!1,emptyMessage:"Keine SKU-Eintraege fuer die aktuelle Suche/Filter.",itemRenderer:re,onItemSelect:g=>{const C=$.targetByItemId.get(g);if(C){if(C.entity==="po"&&C.poNo){const M=new URLSearchParams;M.set("source","fo_convert"),M.set("poNo",C.poNo),e(`/v2/orders/po?${M.toString()}`);return}if(C.entity==="fo"&&C.phantomMeta){const M=new URLSearchParams;M.set("source","phantom_fo"),M.set("phantomId",C.phantomMeta.id),M.set("sku",C.phantomMeta.sku),M.set("month",C.phantomMeta.month),M.set("suggestedUnits",String(Math.max(0,Math.round(Number(C.phantomMeta.suggestedUnits||0))))),C.phantomMeta.requiredArrivalDate&&M.set("requiredArrivalDate",C.phantomMeta.requiredArrivalDate),C.phantomMeta.recommendedOrderDate&&M.set("recommendedOrderDate",C.phantomMeta.recommendedOrderDate),C.phantomMeta.firstRiskMonth&&M.set("firstRiskMonth",C.phantomMeta.firstRiskMonth),C.phantomMeta.orderMonth&&M.set("orderMonth",C.phantomMeta.orderMonth),Number.isFinite(Number(C.phantomMeta.leadTimeDays))&&M.set("leadTimeDays",String(Math.max(0,Math.round(Number(C.phantomMeta.leadTimeDays||0))))),M.set("returnTo","/v2/orders/sku"),e(`/v2/orders/fo?${M.toString()}`);return}if(C.entity==="fo"&&C.foId){const M=new URLSearchParams;M.set("source","orders_sku"),M.set("foId",C.foId),e(`/v2/orders/fo?${M.toString()}`)}}}}),n.jsxs(Ke,{style:{marginTop:10},wrap:!0,children:[n.jsx(Sr,{type:"secondary",children:"Klick auf ein Segment oeffnet den Datensatz; Phantom-FOs öffnen den vorausgefüllten FO-Entwurf."}),n.jsx(je,{size:"small",onClick:()=>e("/v2/orders/po?view=timeline"),children:"PO Timeline oeffnen"}),n.jsx(je,{size:"small",onClick:()=>e("/v2/orders/fo?view=timeline"),children:"FO Timeline oeffnen"})]})]})}const{Paragraph:za,Title:Ya}=Rn;function Xu(e){return e.includes("/orders/sku")?"sku":e.includes("/orders/fo")?"fo":"po"}function Ec(){const e=oa(),t=kr(),{state:r}=Pr(),a=o.useMemo(()=>Xu(e.pathname),[e.pathname]),s=o.useMemo(()=>(Array.isArray(r.payments)?r.payments:[]).map(c=>c).map(c=>({id:String(c.id||""),paidDate:String(c.paidDate||""),method:String(c.method||"—"),payer:String(c.payer||"—"),amountActualEurTotal:Number(c.amountActualEurTotal||0),coveredCount:Array.isArray(c.coveredEventIds)?c.coveredEventIds.length:0})).filter(c=>c.id).sort((c,m)=>String(m.paidDate||"").localeCompare(String(c.paidDate||""))).slice(0,12),[r.payments]),u=o.useMemo(()=>s.reduce((c,m)=>c+Number(m.amountActualEurTotal||0),0),[s]);return n.jsxs("div",{className:"v2-page",children:[n.jsx(Et,{className:"v2-intro-card",children:n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Ya,{level:3,children:"Bestellungen"}),n.jsx(za,{children:"Gemeinsamer Arbeitsbereich für Forecast Orders und Purchase Orders mit schneller FO-zu-PO Übergabe."})]})})}),n.jsxs(Et,{style:{marginBottom:12},children:[n.jsx("div",{className:"v2-page-head",children:n.jsxs("div",{children:[n.jsx(Ya,{level:5,children:"Zahlungsprotokoll (PO-Ist)"}),n.jsx(za,{children:"Tatsächlich bestätigte Zahlungen werden nur auf POs gebucht. FOs bleiben Planobjekte."})]})}),n.jsxs("div",{className:"v2-toolbar-row",style:{marginBottom:8},children:[n.jsxs(Rn.Text,{type:"secondary",children:["Eintraege: ",s.length]}),n.jsxs(Rn.Text,{type:"secondary",children:["Summe Ist: ",u.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]})]}),n.jsx(lr,{children:n.jsxs("table",{className:"v2-stats-table","data-layout":"auto",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Payment-ID"}),n.jsx("th",{children:"Paid Date"}),n.jsx("th",{children:"Methode"}),n.jsx("th",{children:"Durch"}),n.jsx("th",{children:"Ist EUR"}),n.jsx("th",{children:"Abgedeckte Events"})]})}),n.jsx("tbody",{children:s.length?s.map(c=>n.jsxs("tr",{children:[n.jsx("td",{children:c.id}),n.jsx("td",{children:c.paidDate||"—"}),n.jsx("td",{children:c.method}),n.jsx("td",{children:c.payer}),n.jsxs("td",{children:[Number(c.amountActualEurTotal||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," €"]}),n.jsx("td",{children:c.coveredCount})]},c.id)):n.jsx("tr",{children:n.jsx("td",{colSpan:6,children:"Noch keine Zahlungen verbucht."})})})]})})]}),n.jsx(Ys,{activeKey:a,onChange:c=>t(`/v2/orders/${c}`),items:[{key:"po",label:"Bestellungen (PO)",children:n.jsx(Uu,{embedded:!0})},{key:"fo",label:"Forecast Orders (FO)",children:n.jsx(Mu,{embedded:!0})},{key:"sku",label:"SKU Sicht",children:n.jsx(Gu,{})}]})]})}export{Ec as default};
